(function(e){typeof define==="function"&&define.amd?define(e):e()})((function(){"use strict";function e(e,t){const i=Object.create(null);const r=e.split(",");for(let n=0;n<r.length;n++){i[r[n]]=true}return t?e=>!!i[e.toLowerCase()]:e=>!!i[e]}const t=!!({}.NODE_ENV!=="production")?Object.freeze({}):{};const i=!!({}.NODE_ENV!=="production")?Object.freeze([]):[];const r=()=>{};const n=()=>false;const s=/^on[^a-z]/;const o=e=>s.test(e);const a=e=>e.startsWith("onUpdate:");const c=Object.assign;const l=(e,t)=>{const i=e.indexOf(t);if(i>-1){e.splice(i,1)}};const d=Object.prototype.hasOwnProperty;const u=(e,t)=>d.call(e,t);const h=Array.isArray;const f=e=>C(e)==="[object Map]";const p=e=>C(e)==="[object Set]";const g=e=>typeof e==="function";const m=e=>typeof e==="string";const v=e=>typeof e==="symbol";const S=e=>e!==null&&typeof e==="object";const b=e=>S(e)&&g(e.then)&&g(e.catch);const y=Object.prototype.toString;const C=e=>y.call(e);const w=e=>C(e).slice(8,-1);const _=e=>C(e)==="[object Object]";const E=e=>m(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e;const T=e(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted");const I=e("bind,cloak,else-if,else,for,html,if,model,on,once,pre,show,slot,text,memo");const P=e=>{const t=Object.create(null);return i=>{const r=t[i];return r||(t[i]=e(i))}};const A=/-(\w)/g;const M=P((e=>e.replace(A,((e,t)=>t?t.toUpperCase():""))));const D=/\B([A-Z])/g;const R=P((e=>e.replace(D,"-$1").toLowerCase()));const O=P((e=>e.charAt(0).toUpperCase()+e.slice(1)));const N=P((e=>e?`on${O(e)}`:``));const x=(e,t)=>!Object.is(e,t);const L=(e,t)=>{for(let i=0;i<e.length;i++){e[i](t)}};const k=(e,t,i)=>{Object.defineProperty(e,t,{configurable:true,enumerable:false,value:i})};const F=e=>{const t=parseFloat(e);return isNaN(t)?e:t};const U=e=>{const t=m(e)?Number(e):NaN;return isNaN(t)?e:t};let j;const W=()=>j||(j=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:typeof window!=="undefined"?window:typeof global!=="undefined"?global:{});function B(e){if(h(e)){const t={};for(let i=0;i<e.length;i++){const r=e[i];const n=m(r)?G(r):B(r);if(n){for(const e in n){t[e]=n[e]}}}return t}else if(m(e)){return e}else if(S(e)){return e}}const H=/;(?![^(]*\))/g;const V=/:([^]+)/;const Y=/\/\*[^]*?\*\//g;function G(e){const t={};e.replace(Y,"").split(H).forEach((e=>{if(e){const i=e.split(V);i.length>1&&(t[i[0].trim()]=i[1].trim())}}));return t}function z(e){let t="";if(m(e)){t=e}else if(h(e)){for(let i=0;i<e.length;i++){const r=z(e[i]);if(r){t+=r+" "}}}else if(S(e)){for(const i in e){if(e[i]){t+=i+" "}}}return t.trim()}const J=`itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly`;const q=e(J);function K(e){return!!e||e===""}const X=e=>m(e)?e:e==null?"":h(e)||S(e)&&(e.toString===y||!g(e.toString))?JSON.stringify(e,Q,2):String(e);const Q=(e,t)=>{if(t&&t.__v_isRef){return Q(e,t.value)}else if(f(t)){return{[`Map(${t.size})`]:[...t.entries()].reduce(((e,[t,i])=>{e[`${t} =>`]=i;return e}),{})}}else if(p(t)){return{[`Set(${t.size})`]:[...t.values()]}}else if(S(t)&&!h(t)&&!_(t)){return String(t)}return t};function Z(e,...t){console.warn(`[Vue warn] ${e}`,...t)}let ee;class te{constructor(e=false){this.detached=e;this._active=true;this.effects=[];this.cleanups=[];this.parent=ee;if(!e&&ee){this.index=(ee.scopes||(ee.scopes=[])).push(this)-1}}get active(){return this._active}run(e){if(this._active){const t=ee;try{ee=this;return e()}finally{ee=t}}else if(!!({}.NODE_ENV!=="production")){Z(`cannot run an inactive effect scope.`)}}on(){ee=this}off(){ee=this.parent}stop(e){if(this._active){let t,i;for(t=0,i=this.effects.length;t<i;t++){this.effects[t].stop()}for(t=0,i=this.cleanups.length;t<i;t++){this.cleanups[t]()}if(this.scopes){for(t=0,i=this.scopes.length;t<i;t++){this.scopes[t].stop(true)}}if(!this.detached&&this.parent&&!e){const e=this.parent.scopes.pop();if(e&&e!==this){this.parent.scopes[this.index]=e;e.index=this.index}}this.parent=void 0;this._active=false}}}function ie(e,t=ee){if(t&&t.active){t.effects.push(e)}}function re(){return ee}const ne=e=>{const t=new Set(e);t.w=0;t.n=0;return t};const se=e=>(e.w&ue)>0;const oe=e=>(e.n&ue)>0;const ae=({deps:e})=>{if(e.length){for(let t=0;t<e.length;t++){e[t].w|=ue}}};const ce=e=>{const{deps:t}=e;if(t.length){let i=0;for(let r=0;r<t.length;r++){const n=t[r];if(se(n)&&!oe(n)){n.delete(e)}else{t[i++]=n}n.w&=~ue;n.n&=~ue}t.length=i}};const le=new WeakMap;let de=0;let ue=1;const he=30;let fe;const pe=Symbol(!!({}.NODE_ENV!=="production")?"iterate":"");const ge=Symbol(!!({}.NODE_ENV!=="production")?"Map key iterate":"");class me{constructor(e,t=null,i){this.fn=e;this.scheduler=t;this.active=true;this.deps=[];this.parent=void 0;ie(this,i)}run(){if(!this.active){return this.fn()}let e=fe;let t=Se;while(e){if(e===this){return}e=e.parent}try{this.parent=fe;fe=this;Se=true;ue=1<<++de;if(de<=he){ae(this)}else{ve(this)}return this.fn()}finally{if(de<=he){ce(this)}ue=1<<--de;fe=this.parent;Se=t;this.parent=void 0;if(this.deferStop){this.stop()}}}stop(){if(fe===this){this.deferStop=true}else if(this.active){ve(this);if(this.onStop){this.onStop()}this.active=false}}}function ve(e){const{deps:t}=e;if(t.length){for(let i=0;i<t.length;i++){t[i].delete(e)}t.length=0}}let Se=true;const be=[];function ye(){be.push(Se);Se=false}function Ce(){const e=be.pop();Se=e===void 0?true:e}function we(e,t,i){if(Se&&fe){let r=le.get(e);if(!r){le.set(e,r=new Map)}let n=r.get(i);if(!n){r.set(i,n=ne())}const s=!!({}.NODE_ENV!=="production")?{effect:fe,target:e,type:t,key:i}:void 0;_e(n,s)}}function _e(e,t){let i=false;if(de<=he){if(!oe(e)){e.n|=ue;i=!se(e)}}else{i=!e.has(fe)}if(i){e.add(fe);fe.deps.push(e);if(!!({}.NODE_ENV!=="production")&&fe.onTrack){fe.onTrack(c({effect:fe},t))}}}function Ee(e,t,i,r,n,s){const o=le.get(e);if(!o){return}let a=[];if(t==="clear"){a=[...o.values()]}else if(i==="length"&&h(e)){const e=Number(r);o.forEach(((t,i)=>{if(i==="length"||i>=e){a.push(t)}}))}else{if(i!==void 0){a.push(o.get(i))}switch(t){case"add":if(!h(e)){a.push(o.get(pe));if(f(e)){a.push(o.get(ge))}}else if(E(i)){a.push(o.get("length"))}break;case"delete":if(!h(e)){a.push(o.get(pe));if(f(e)){a.push(o.get(ge))}}break;case"set":if(f(e)){a.push(o.get(pe))}break}}const c=!!({}.NODE_ENV!=="production")?{target:e,type:t,key:i,newValue:r,oldValue:n,oldTarget:s}:void 0;if(a.length===1){if(a[0]){if(!!({}.NODE_ENV!=="production")){Te(a[0],c)}else{Te(a[0])}}}else{const e=[];for(const t of a){if(t){e.push(...t)}}if(!!({}.NODE_ENV!=="production")){Te(ne(e),c)}else{Te(ne(e))}}}function Te(e,t){const i=h(e)?e:[...e];for(const r of i){if(r.computed){Ie(r,t)}}for(const r of i){if(!r.computed){Ie(r,t)}}}function Ie(e,t){if(e!==fe||e.allowRecurse){if(!!({}.NODE_ENV!=="production")&&e.onTrigger){e.onTrigger(c({effect:e},t))}if(e.scheduler){e.scheduler()}else{e.run()}}}const Pe=e(`__proto__,__v_isRef,__isVue`);const Ae=new Set(Object.getOwnPropertyNames(Symbol).filter((e=>e!=="arguments"&&e!=="caller")).map((e=>Symbol[e])).filter(v));const Me=ke();const De=ke(false,true);const Re=ke(true);const Oe=ke(true,true);const Ne=xe();function xe(){const e={};["includes","indexOf","lastIndexOf"].forEach((t=>{e[t]=function(...e){const i=Rt(this);for(let t=0,n=this.length;t<n;t++){we(i,"get",t+"")}const r=i[t](...e);if(r===-1||r===false){return i[t](...e.map(Rt))}else{return r}}}));["push","pop","shift","unshift","splice"].forEach((t=>{e[t]=function(...e){ye();const i=Rt(this)[t].apply(this,e);Ce();return i}}));return e}function Le(e){const t=Rt(this);we(t,"has",e);return t.hasOwnProperty(e)}function ke(e=false,t=false){return function i(r,n,s){if(n==="__v_isReactive"){return!e}else if(n==="__v_isReadonly"){return e}else if(n==="__v_isShallow"){return t}else if(n==="__v_raw"&&s===(e?t?bt:St:t?vt:mt).get(r)){return r}const o=h(r);if(!e){if(o&&u(Ne,n)){return Reflect.get(Ne,n,s)}if(n==="hasOwnProperty"){return Le}}const a=Reflect.get(r,n,s);if(v(n)?Ae.has(n):Pe(n)){return a}if(!e){we(r,"get",n)}if(t){return a}if(Ft(a)){return o&&E(n)?a:a.value}if(S(a)){return e?Et(a):wt(a)}return a}}const Fe=je();const Ue=je(true);function je(e=false){return function t(i,r,n,s){let o=i[r];if(At(o)&&Ft(o)&&!Ft(n)){return false}if(!e){if(!Mt(n)&&!At(n)){o=Rt(o);n=Rt(n)}if(!h(i)&&Ft(o)&&!Ft(n)){o.value=n;return true}}const a=h(i)&&E(r)?Number(r)<i.length:u(i,r);const c=Reflect.set(i,r,n,s);if(i===Rt(s)){if(!a){Ee(i,"add",r,n)}else if(x(n,o)){Ee(i,"set",r,n,o)}}return c}}function We(e,t){const i=u(e,t);const r=e[t];const n=Reflect.deleteProperty(e,t);if(n&&i){Ee(e,"delete",t,void 0,r)}return n}function Be(e,t){const i=Reflect.has(e,t);if(!v(t)||!Ae.has(t)){we(e,"has",t)}return i}function He(e){we(e,"iterate",h(e)?"length":pe);return Reflect.ownKeys(e)}const Ve={get:Me,set:Fe,deleteProperty:We,has:Be,ownKeys:He};const Ye={get:Re,set(e,t){if(!!({}.NODE_ENV!=="production")){Z(`Set operation on key "${String(t)}" failed: target is readonly.`,e)}return true},deleteProperty(e,t){if(!!({}.NODE_ENV!=="production")){Z(`Delete operation on key "${String(t)}" failed: target is readonly.`,e)}return true}};const Ge=c({},Ve,{get:De,set:Ue});const $e=c({},Ye,{get:Oe});const ze=e=>e;const Je=e=>Reflect.getPrototypeOf(e);function qe(e,t,i=false,r=false){e=e["__v_raw"];const n=Rt(e);const s=Rt(t);if(!i){if(t!==s){we(n,"get",t)}we(n,"get",s)}const{has:o}=Je(n);const a=r?ze:i?xt:Nt;if(o.call(n,t)){return a(e.get(t))}else if(o.call(n,s)){return a(e.get(s))}else if(e!==n){e.get(t)}}function Ke(e,t=false){const i=this["__v_raw"];const r=Rt(i);const n=Rt(e);if(!t){if(e!==n){we(r,"has",e)}we(r,"has",n)}return e===n?i.has(e):i.has(e)||i.has(n)}function Xe(e,t=false){e=e["__v_raw"];!t&&we(Rt(e),"iterate",pe);return Reflect.get(e,"size",e)}function Qe(e){e=Rt(e);const t=Rt(this);const i=Je(t);const r=i.has.call(t,e);if(!r){t.add(e);Ee(t,"add",e,e)}return this}function Ze(e,t){t=Rt(t);const i=Rt(this);const{has:r,get:n}=Je(i);let s=r.call(i,e);if(!s){e=Rt(e);s=r.call(i,e)}else if(!!({}.NODE_ENV!=="production")){gt(i,r,e)}const o=n.call(i,e);i.set(e,t);if(!s){Ee(i,"add",e,t)}else if(x(t,o)){Ee(i,"set",e,t,o)}return this}function et(e){const t=Rt(this);const{has:i,get:r}=Je(t);let n=i.call(t,e);if(!n){e=Rt(e);n=i.call(t,e)}else if(!!({}.NODE_ENV!=="production")){gt(t,i,e)}const s=r?r.call(t,e):void 0;const o=t.delete(e);if(n){Ee(t,"delete",e,void 0,s)}return o}function tt(){const e=Rt(this);const t=e.size!==0;const i=!!({}.NODE_ENV!=="production")?f(e)?new Map(e):new Set(e):void 0;const r=e.clear();if(t){Ee(e,"clear",void 0,void 0,i)}return r}function it(e,t){return function i(r,n){const s=this;const o=s["__v_raw"];const a=Rt(o);const c=t?ze:e?xt:Nt;!e&&we(a,"iterate",pe);return o.forEach(((e,t)=>r.call(n,c(e),c(t),s)))}}function rt(e,t,i){return function(...r){const n=this["__v_raw"];const s=Rt(n);const o=f(s);const a=e==="entries"||e===Symbol.iterator&&o;const c=e==="keys"&&o;const l=n[e](...r);const d=i?ze:t?xt:Nt;!t&&we(s,"iterate",c?ge:pe);return{next(){const{value:e,done:t}=l.next();return t?{value:e,done:t}:{value:a?[d(e[0]),d(e[1])]:d(e),done:t}},[Symbol.iterator](){return this}}}}function nt(e){return function(...t){if(!!({}.NODE_ENV!=="production")){const i=t[0]?`on key "${t[0]}" `:``;console.warn(`${O(e)} operation ${i}failed: target is readonly.`,Rt(this))}return e==="delete"?false:this}}function st(){const e={get(e){return qe(this,e)},get size(){return Xe(this)},has:Ke,add:Qe,set:Ze,delete:et,clear:tt,forEach:it(false,false)};const t={get(e){return qe(this,e,false,true)},get size(){return Xe(this)},has:Ke,add:Qe,set:Ze,delete:et,clear:tt,forEach:it(false,true)};const i={get(e){return qe(this,e,true)},get size(){return Xe(this,true)},has(e){return Ke.call(this,e,true)},add:nt("add"),set:nt("set"),delete:nt("delete"),clear:nt("clear"),forEach:it(true,false)};const r={get(e){return qe(this,e,true,true)},get size(){return Xe(this,true)},has(e){return Ke.call(this,e,true)},add:nt("add"),set:nt("set"),delete:nt("delete"),clear:nt("clear"),forEach:it(true,true)};const n=["keys","values","entries",Symbol.iterator];n.forEach((n=>{e[n]=rt(n,false,false);i[n]=rt(n,true,false);t[n]=rt(n,false,true);r[n]=rt(n,true,true)}));return[e,i,t,r]}const[ot,at,ct,lt]=st();function dt(e,t){const i=t?e?lt:ct:e?at:ot;return(t,r,n)=>{if(r==="__v_isReactive"){return!e}else if(r==="__v_isReadonly"){return e}else if(r==="__v_raw"){return t}return Reflect.get(u(i,r)&&r in t?i:t,r,n)}}const ut={get:dt(false,false)};const ht={get:dt(false,true)};const ft={get:dt(true,false)};const pt={get:dt(true,true)};function gt(e,t,i){const r=Rt(i);if(r!==i&&t.call(e,r)){const t=w(e);console.warn(`Reactive ${t} contains both the raw and reactive versions of the same object${t===`Map`?` as keys`:``}, which can lead to inconsistencies. Avoid differentiating between the raw and reactive versions of an object and only use the reactive version if possible.`)}}const mt=new WeakMap;const vt=new WeakMap;const St=new WeakMap;const bt=new WeakMap;function yt(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Ct(e){return e["__v_skip"]||!Object.isExtensible(e)?0:yt(w(e))}function wt(e){if(At(e)){return e}return It(e,false,Ve,ut,mt)}function _t(e){return It(e,false,Ge,ht,vt)}function Et(e){return It(e,true,Ye,ft,St)}function Tt(e){return It(e,true,$e,pt,bt)}function It(e,t,i,r,n){if(!S(e)){if(!!({}.NODE_ENV!=="production")){console.warn(`value cannot be made reactive: ${String(e)}`)}return e}if(e["__v_raw"]&&!(t&&e["__v_isReactive"])){return e}const s=n.get(e);if(s){return s}const o=Ct(e);if(o===0){return e}const a=new Proxy(e,o===2?r:i);n.set(e,a);return a}function Pt(e){if(At(e)){return Pt(e["__v_raw"])}return!!(e&&e["__v_isReactive"])}function At(e){return!!(e&&e["__v_isReadonly"])}function Mt(e){return!!(e&&e["__v_isShallow"])}function Dt(e){return Pt(e)||At(e)}function Rt(e){const t=e&&e["__v_raw"];return t?Rt(t):e}function Ot(e){k(e,"__v_skip",true);return e}const Nt=e=>S(e)?wt(e):e;const xt=e=>S(e)?Et(e):e;function Lt(e){if(Se&&fe){e=Rt(e);if(!!({}.NODE_ENV!=="production")){_e(e.dep||(e.dep=ne()),{target:e,type:"get",key:"value"})}else{_e(e.dep||(e.dep=ne()))}}}function kt(e,t){e=Rt(e);const i=e.dep;if(i){if(!!({}.NODE_ENV!=="production")){Te(i,{target:e,type:"set",key:"value",newValue:t})}else{Te(i)}}}function Ft(e){return!!(e&&e.__v_isRef===true)}function Ut(e){return Ft(e)?e.value:e}const jt={get:(e,t,i)=>Ut(Reflect.get(e,t,i)),set:(e,t,i,r)=>{const n=e[t];if(Ft(n)&&!Ft(i)){n.value=i;return true}else{return Reflect.set(e,t,i,r)}}};function Wt(e){return Pt(e)?e:new Proxy(e,jt)}class Bt{constructor(e,t,i,r){this._setter=t;this.dep=void 0;this.__v_isRef=true;this["__v_isReadonly"]=false;this._dirty=true;this.effect=new me(e,(()=>{if(!this._dirty){this._dirty=true;kt(this)}}));this.effect.computed=this;this.effect.active=this._cacheable=!r;this["__v_isReadonly"]=i}get value(){const e=Rt(this);Lt(e);if(e._dirty||!e._cacheable){e._dirty=false;e._value=e.effect.run()}return e._value}set value(e){this._setter(e)}}function Ht(e,t,i=false){let n;let s;const o=g(e);if(o){n=e;s=!!({}.NODE_ENV!=="production")?()=>{console.warn("Write operation failed: computed value is readonly")}:r}else{n=e.get;s=e.set}const a=new Bt(n,s,o||!s,i);if(!!({}.NODE_ENV!=="production")&&t&&!i){a.effect.onTrack=t.onTrack;a.effect.onTrigger=t.onTrigger}return a}const Vt=[];function Yt(e){Vt.push(e)}function Gt(){Vt.pop()}function $t(e,...t){if(!!!({}.NODE_ENV!=="production"))return;ye();const i=Vt.length?Vt[Vt.length-1].component:null;const r=i&&i.appContext.config.warnHandler;const n=zt();if(r){Zt(r,i,11,[e+t.join(""),i&&i.proxy,n.map((({vnode:e})=>`at <${_o(i,e.type)}>`)).join("\n"),n])}else{const i=[`[Vue warn]: ${e}`,...t];if(n.length&&true){i.push(`\n`,...Jt(n))}console.warn(...i)}Ce()}function zt(){let e=Vt[Vt.length-1];if(!e){return[]}const t=[];while(e){const i=t[0];if(i&&i.vnode===e){i.recurseCount++}else{t.push({vnode:e,recurseCount:0})}const r=e.component&&e.component.parent;e=r&&r.vnode}return t}function Jt(e){const t=[];e.forEach(((e,i)=>{t.push(...i===0?[]:[`\n`],...qt(e))}));return t}function qt({vnode:e,recurseCount:t}){const i=t>0?`... (${t} recursive calls)`:``;const r=e.component?e.component.parent==null:false;const n=` at <${_o(e.component,e.type,r)}`;const s=`>`+i;return e.props?[n,...Kt(e.props),s]:[n+s]}function Kt(e){const t=[];const i=Object.keys(e);i.slice(0,3).forEach((i=>{t.push(...Xt(i,e[i]))}));if(i.length>3){t.push(` ...`)}return t}function Xt(e,t,i){if(m(t)){t=JSON.stringify(t);return i?t:[`${e}=${t}`]}else if(typeof t==="number"||typeof t==="boolean"||t==null){return i?t:[`${e}=${t}`]}else if(Ft(t)){t=Xt(e,Rt(t.value),true);return i?t:[`${e}=Ref<`,t,`>`]}else if(g(t)){return[`${e}=fn${t.name?`<${t.name}>`:``}`]}else{t=Rt(t);return i?t:[`${e}=`,t]}}const Qt={["sp"]:"serverPrefetch hook",["bc"]:"beforeCreate hook",["c"]:"created hook",["bm"]:"beforeMount hook",["m"]:"mounted hook",["bu"]:"beforeUpdate hook",["u"]:"updated",["bum"]:"beforeUnmount hook",["um"]:"unmounted hook",["a"]:"activated hook",["da"]:"deactivated hook",["ec"]:"errorCaptured hook",["rtc"]:"renderTracked hook",["rtg"]:"renderTriggered hook",[0]:"setup function",[1]:"render function",[2]:"watcher getter",[3]:"watcher callback",[4]:"watcher cleanup function",[5]:"native event handler",[6]:"component event handler",[7]:"vnode hook",[8]:"directive hook",[9]:"transition hook",[10]:"app errorHandler",[11]:"app warnHandler",[12]:"ref function",[13]:"async component loader",[14]:"scheduler flush. This is likely a Vue internals bug. Please open an issue at https://new-issue.vuejs.org/?repo=vuejs/core"};function Zt(e,t,i,r){let n;try{n=r?e(...r):e()}catch(s){ti(s,t,i)}return n}function ei(e,t,i,r){if(g(e)){const n=Zt(e,t,i,r);if(n&&b(n)){n.catch((e=>{ti(e,t,i)}))}return n}const n=[];for(let s=0;s<e.length;s++){n.push(ei(e[s],t,i,r))}return n}function ti(e,t,i,r=true){const n=t?t.vnode:null;if(t){let r=t.parent;const n=t.proxy;const s=!!({}.NODE_ENV!=="production")?Qt[i]:i;while(r){const t=r.ec;if(t){for(let i=0;i<t.length;i++){if(t[i](e,n,s)===false){return}}}r=r.parent}const o=t.appContext.config.errorHandler;if(o){Zt(o,null,10,[e,n,s]);return}}ii(e,i,n,r)}function ii(e,t,i,r=true){if(!!({}.NODE_ENV!=="production")){const n=Qt[t];if(i){Yt(i)}$t(`Unhandled error${n?` during execution of ${n}`:``}`);if(i){Gt()}if(r){throw e}else{console.error(e)}}else{console.error(e)}}let ri=false;let ni=false;const si=[];let oi=0;const ai=[];let ci=null;let li=0;const di=Promise.resolve();let ui=null;const hi=100;function fi(e){const t=ui||di;return e?t.then(this?e.bind(this):e):t}function pi(e){let t=oi+1;let i=si.length;while(t<i){const r=t+i>>>1;const n=Ci(si[r]);n<e?t=r+1:i=r}return t}function gi(e){if(!si.length||!si.includes(e,ri&&e.allowRecurse?oi+1:oi)){if(e.id==null){si.push(e)}else{si.splice(pi(e.id),0,e)}mi()}}function mi(){if(!ri&&!ni){ni=true;ui=di.then(_i)}}function vi(e){const t=si.indexOf(e);if(t>oi){si.splice(t,1)}}function Si(e){if(!h(e)){if(!ci||!ci.includes(e,e.allowRecurse?li+1:li)){ai.push(e)}}else{ai.push(...e)}mi()}function bi(e,t=(ri?oi+1:0)){if(!!({}.NODE_ENV!=="production")){e=e||new Map}for(;t<si.length;t++){const i=si[t];if(i&&i.pre){if(!!({}.NODE_ENV!=="production")&&Ei(e,i)){continue}si.splice(t,1);t--;i()}}}function yi(e){if(ai.length){const t=[...new Set(ai)];ai.length=0;if(ci){ci.push(...t);return}ci=t;if(!!({}.NODE_ENV!=="production")){e=e||new Map}ci.sort(((e,t)=>Ci(e)-Ci(t)));for(li=0;li<ci.length;li++){if(!!({}.NODE_ENV!=="production")&&Ei(e,ci[li])){continue}ci[li]()}ci=null;li=0}}const Ci=e=>e.id==null?Infinity:e.id;const wi=(e,t)=>{const i=Ci(e)-Ci(t);if(i===0){if(e.pre&&!t.pre)return-1;if(t.pre&&!e.pre)return 1}return i};function _i(e){ni=false;ri=true;if(!!({}.NODE_ENV!=="production")){e=e||new Map}si.sort(wi);const t=!!({}.NODE_ENV!=="production")?t=>Ei(e,t):r;try{for(oi=0;oi<si.length;oi++){const e=si[oi];if(e&&e.active!==false){if(!!({}.NODE_ENV!=="production")&&t(e)){continue}Zt(e,null,14)}}}finally{oi=0;si.length=0;yi(e);ri=false;ui=null;if(si.length||ai.length){_i(e)}}}function Ei(e,t){if(!e.has(t)){e.set(t,1)}else{const i=e.get(t);if(i>hi){const e=t.ownerInstance;const i=e&&wo(e.type);$t(`Maximum recursive updates exceeded${i?` in component <${i}>`:``}. This means you have a reactive effect that is mutating its own dependencies and thus recursively triggering itself. Possible sources include component template, render function, updated hook or watcher source function.`);return true}else{e.set(t,i+1)}}}let Ti=false;const Ii=new Set;if(!!({}.NODE_ENV!=="production")){W().__VUE_HMR_RUNTIME__={createRecord:Li(Di),rerender:Li(Oi),reload:Li(Ni)}}const Pi=new Map;function Ai(e){const t=e.type.__hmrId;let i=Pi.get(t);if(!i){Di(t,e.type);i=Pi.get(t)}i.instances.add(e)}function Mi(e){Pi.get(e.type.__hmrId).instances.delete(e)}function Di(e,t){if(Pi.has(e)){return false}Pi.set(e,{initialDef:Ri(t),instances:new Set});return true}function Ri(e){return Eo(e)?e.__vccOpts:e}function Oi(e,t){const i=Pi.get(e);if(!i){return}i.initialDef.render=t;[...i.instances].forEach((e=>{if(t){e.render=t;Ri(e.type).render=t}e.renderCache=[];Ti=true;e.update();Ti=false}))}function Ni(e,t){const i=Pi.get(e);if(!i)return;t=Ri(t);xi(i.initialDef,t);const r=[...i.instances];for(const n of r){const e=Ri(n.type);if(!Ii.has(e)){if(e!==i.initialDef){xi(e,t)}Ii.add(e)}n.appContext.propsCache.delete(n.type);n.appContext.emitsCache.delete(n.type);n.appContext.optionsCache.delete(n.type);if(n.ceReload){Ii.add(e);n.ceReload(t.styles);Ii.delete(e)}else if(n.parent){gi(n.parent.update)}else if(n.appContext.reload){n.appContext.reload()}else if(typeof window!=="undefined"){window.location.reload()}else{console.warn("[HMR] Root or manually mounted instance modified. Full reload required.")}}Si((()=>{for(const e of r){Ii.delete(Ri(e.type))}}))}function xi(e,t){c(e,t);for(const i in e){if(i!=="__file"&&!(i in t)){delete e[i]}}}function Li(e){return(t,i)=>{try{return e(t,i)}catch(r){console.error(r);console.warn(`[HMR] Something went wrong during Vue component hot-reload. Full reload required.`)}}}let ki;let Fi=[];let Ui=false;function ji(e,...t){if(ki){ki.emit(e,...t)}else if(!Ui){Fi.push({event:e,args:t})}}function Wi(e,t){var i,r;ki=e;if(ki){ki.enabled=true;Fi.forEach((({event:e,args:t})=>ki.emit(e,...t)));Fi=[]}else if(typeof window!=="undefined"&&window.HTMLElement&&!((r=(i=window.navigator)==null?void 0:i.userAgent)==null?void 0:r.includes("jsdom"))){const e=t.__VUE_DEVTOOLS_HOOK_REPLAY__=t.__VUE_DEVTOOLS_HOOK_REPLAY__||[];e.push((e=>{Wi(e,t)}));setTimeout((()=>{if(!ki){t.__VUE_DEVTOOLS_HOOK_REPLAY__=null;Ui=true;Fi=[]}}),3e3)}else{Ui=true;Fi=[]}}function Bi(e,t){ji("app:init",e,t,{Fragment:Ss,Text:bs,Comment:ys,Static:Cs})}function Hi(e){ji("app:unmount",e)}const Vi=zi("component:added");const Yi=zi("component:updated");const Gi=zi("component:removed");const $i=e=>{if(ki&&typeof ki.cleanupBuffer==="function"&&!ki.cleanupBuffer(e)){Gi(e)}};function zi(e){return t=>{ji(e,t.appContext.app,t.uid,t.parent?t.parent.uid:void 0,t)}}const Ji=Ki("perf:start");const qi=Ki("perf:end");function Ki(e){return(t,i,r)=>{ji(e,t.appContext.app,t.uid,t,i,r)}}function Xi(e,t,i){ji("component:emit",e.appContext.app,e,t,i)}function Qi(e,i,...r){if(e.isUnmounted)return;const n=e.vnode.props||t;if(!!({}.NODE_ENV!=="production")){const{emitsOptions:t,propsOptions:[n]}=e;if(t){if(!(i in t)&&true){if(!n||!(N(i)in n)){$t(`Component emitted event "${i}" but it is neither declared in the emits option nor as an "${N(i)}" prop.`)}}else{const e=t[i];if(g(e)){const t=e(...r);if(!t){$t(`Invalid event arguments: event validation failed for event "${i}".`)}}}}}let s=r;const o=i.startsWith("update:");const a=o&&i.slice(7);if(a&&a in n){const e=`${a==="modelValue"?"model":a}Modifiers`;const{number:i,trim:o}=n[e]||t;if(o){s=r.map((e=>m(e)?e.trim():e))}if(i){s=r.map(F)}}if(!!({}.NODE_ENV!=="production")||false){Xi(e,i,s)}if(!!({}.NODE_ENV!=="production")){const t=i.toLowerCase();if(t!==i&&n[N(t)]){$t(`Event "${t}" is emitted in component ${_o(e,e.type)} but the handler is registered for "${i}". Note that HTML attributes are case-insensitive and you cannot use v-on to listen to camelCase events when using in-DOM templates. You should probably use "${R(i)}" instead of "${i}".`)}}let c;let l=n[c=N(i)]||n[c=N(M(i))];if(!l&&o){l=n[c=N(R(i))]}if(l){ei(l,e,6,s)}const d=n[c+`Once`];if(d){if(!e.emitted){e.emitted={}}else if(e.emitted[c]){return}e.emitted[c]=true;ei(d,e,6,s)}}function Zi(e,t,i=false){const r=t.emitsCache;const n=r.get(e);if(n!==void 0){return n}const s=e.emits;let o={};let a=false;if(!g(e)){const r=e=>{const i=Zi(e,t,true);if(i){a=true;c(o,i)}};if(!i&&t.mixins.length){t.mixins.forEach(r)}if(e.extends){r(e.extends)}if(e.mixins){e.mixins.forEach(r)}}if(!s&&!a){if(S(e)){r.set(e,null)}return null}if(h(s)){s.forEach((e=>o[e]=null))}else{c(o,s)}if(S(e)){r.set(e,o)}return o}function er(e,t){if(!e||!o(t)){return false}t=t.slice(2).replace(/Once$/,"");return u(e,t[0].toLowerCase()+t.slice(1))||u(e,R(t))||u(e,t)}let tr=null;let ir=null;function rr(e){const t=tr;tr=e;ir=e&&e.type.__scopeId||null;return t}function nr(e){ir=e}function sr(){ir=null}function or(e,t=tr,i){if(!t)return e;if(e._n){return e}const r=(...i)=>{if(r._d){Ps(-1)}const n=rr(t);let s;try{s=e(...i)}finally{rr(n);if(r._d){Ps(1)}}if(!!({}.NODE_ENV!=="production")||false){Yi(t)}return s};r._n=true;r._c=true;r._d=true;return r}let ar=false;function cr(){ar=true}function lr(e){const{type:t,vnode:i,proxy:r,withProxy:n,props:s,propsOptions:[c],slots:l,attrs:d,emit:u,render:h,renderCache:f,data:p,setupState:g,ctx:m,inheritAttrs:v}=e;let S;let b;const y=rr(e);if(!!({}.NODE_ENV!=="production")){ar=false}try{if(i.shapeFlag&4){const e=n||r;S=Gs(h.call(e,e,f,s,g,p,m));b=d}else{const e=t;if(!!({}.NODE_ENV!=="production")&&d===s){cr()}S=Gs(e.length>1?e(s,!!({}.NODE_ENV!=="production")?{get attrs(){cr();return d},slots:l,emit:u}:{attrs:d,slots:l,emit:u}):e(s,null));b=t.props?d:hr(d)}}catch(_){ws.length=0;ti(_,e,1);S=Us(ys)}let C=S;let w=void 0;if(!!({}.NODE_ENV!=="production")&&S.patchFlag>0&&S.patchFlag&2048){[C,w]=dr(S)}if(b&&v!==false){const e=Object.keys(b);const{shapeFlag:t}=C;if(e.length){if(t&(1|6)){if(c&&e.some(a)){b=fr(b,c)}C=Bs(C,b)}else if(!!({}.NODE_ENV!=="production")&&!ar&&C.type!==ys){const e=Object.keys(d);const t=[];const i=[];for(let r=0,n=e.length;r<n;r++){const n=e[r];if(o(n)){if(!a(n)){t.push(n[2].toLowerCase()+n.slice(3))}}else{i.push(n)}}if(i.length){$t(`Extraneous non-props attributes (${i.join(", ")}) were passed to component but could not be automatically inherited because component renders fragment or text root nodes.`)}if(t.length){$t(`Extraneous non-emits event listeners (${t.join(", ")}) were passed to component but could not be automatically inherited because component renders fragment or text root nodes. If the listener is intended to be a component custom event listener only, declare it using the "emits" option.`)}}}}if(i.dirs){if(!!({}.NODE_ENV!=="production")&&!pr(C)){$t(`Runtime directive used on component with non-element root node. The directives will not function as intended.`)}C=Bs(C);C.dirs=C.dirs?C.dirs.concat(i.dirs):i.dirs}if(i.transition){if(!!({}.NODE_ENV!=="production")&&!pr(C)){$t(`Component inside <Transition> renders non-element root node that cannot be animated.`)}C.transition=i.transition}if(!!({}.NODE_ENV!=="production")&&w){w(C)}else{S=C}rr(y);return S}const dr=e=>{const t=e.children;const i=e.dynamicChildren;const r=ur(t);if(!r){return[e,void 0]}const n=t.indexOf(r);const s=i?i.indexOf(r):-1;const o=r=>{t[n]=r;if(i){if(s>-1){i[s]=r}else if(r.patchFlag>0){e.dynamicChildren=[...i,r]}}};return[Gs(r),o]};function ur(e){let t;for(let i=0;i<e.length;i++){const r=e[i];if(Rs(r)){if(r.type!==ys||r.children==="v-if"){if(t){return}else{t=r}}}else{return}}return t}const hr=e=>{let t;for(const i in e){if(i==="class"||i==="style"||o(i)){(t||(t={}))[i]=e[i]}}return t};const fr=(e,t)=>{const i={};for(const r in e){if(!a(r)||!(r.slice(9)in t)){i[r]=e[r]}}return i};const pr=e=>e.shapeFlag&(6|1)||e.type===ys;function gr(e,t,i){const{props:r,children:n,component:s}=e;const{props:o,children:a,patchFlag:c}=t;const l=s.emitsOptions;if(!!({}.NODE_ENV!=="production")&&(n||a)&&Ti){return true}if(t.dirs||t.transition){return true}if(i&&c>=0){if(c&1024){return true}if(c&16){if(!r){return!!o}return mr(r,o,l)}else if(c&8){const e=t.dynamicProps;for(let t=0;t<e.length;t++){const i=e[t];if(o[i]!==r[i]&&!er(l,i)){return true}}}}else{if(n||a){if(!a||!a.$stable){return true}}if(r===o){return false}if(!r){return!!o}if(!o){return true}return mr(r,o,l)}return false}function mr(e,t,i){const r=Object.keys(t);if(r.length!==Object.keys(e).length){return true}for(let n=0;n<r.length;n++){const s=r[n];if(t[s]!==e[s]&&!er(i,s)){return true}}return false}function vr({vnode:e,parent:t},i){while(t&&t.subTree===e){(e=t.vnode).el=i;t=t.parent}}const Sr=e=>e.__isSuspense;function br(e,t){if(t&&t.pendingBranch){if(h(e)){t.effects.push(...e)}else{t.effects.push(e)}}else{Si(e)}}const yr={};function Cr(e,t,i){if(!!({}.NODE_ENV!=="production")&&!g(t)){$t(`\`watch(fn, options?)\` signature has been moved to a separate API. Use \`watchEffect(fn, options?)\` instead. \`watch\` now only supports \`watch(source, cb, options?) signature.`)}return wr(e,t,i)}function wr(e,i,{immediate:n,deep:s,flush:o,onTrack:a,onTrigger:c}=t){var d;if(!!({}.NODE_ENV!=="production")&&!i){if(n!==void 0){$t(`watch() "immediate" option is only respected when using the watch(source, callback, options?) signature.`)}if(s!==void 0){$t(`watch() "deep" option is only respected when using the watch(source, callback, options?) signature.`)}}const u=e=>{$t(`Invalid watch source: `,e,`A watch source can only be a getter/effect function, a ref, a reactive object, or an array of these types.`)};const f=re()===((d=Zs)==null?void 0:d.scope)?Zs:null;let p;let m=false;let v=false;if(Ft(e)){p=()=>e.value;m=Mt(e)}else if(Pt(e)){p=()=>e;s=true}else if(h(e)){v=true;m=e.some((e=>Pt(e)||Mt(e)));p=()=>e.map((e=>{if(Ft(e)){return e.value}else if(Pt(e)){return Tr(e)}else if(g(e)){return Zt(e,f,2)}else{!!({}.NODE_ENV!=="production")&&u(e)}}))}else if(g(e)){if(i){p=()=>Zt(e,f,2)}else{p=()=>{if(f&&f.isUnmounted){return}if(S){S()}return ei(e,f,3,[b])}}}else{p=r;!!({}.NODE_ENV!=="production")&&u(e)}if(i&&s){const e=p;p=()=>Tr(e())}let S;let b=e=>{S=E.onStop=()=>{Zt(e,f,4)}};let y;if(co){b=r;if(!i){p()}else if(n){ei(i,f,3,[p(),v?[]:void 0,b])}if(o==="sync"){const e=Po();y=e.__watcherHandles||(e.__watcherHandles=[])}else{return r}}let C=v?new Array(e.length).fill(yr):yr;const w=()=>{if(!E.active){return}if(i){const e=E.run();if(s||m||(v?e.some(((e,t)=>x(e,C[t]))):x(e,C))||false){if(S){S()}ei(i,f,3,[e,C===yr?void 0:v&&C[0]===yr?[]:C,b]);C=e}}else{E.run()}};w.allowRecurse=!!i;let _;if(o==="sync"){_=w}else if(o==="post"){_=()=>us(w,f&&f.suspense)}else{w.pre=true;if(f)w.id=f.uid;_=()=>gi(w)}const E=new me(p,_);if(!!({}.NODE_ENV!=="production")){E.onTrack=a;E.onTrigger=c}if(i){if(n){w()}else{C=E.run()}}else if(o==="post"){us(E.run.bind(E),f&&f.suspense)}else{E.run()}const T=()=>{E.stop();if(f&&f.scope){l(f.scope.effects,E)}};if(y)y.push(T);return T}function _r(e,t,i){const r=this.proxy;const n=m(e)?e.includes(".")?Er(r,e):()=>r[e]:e.bind(r,r);let s;if(g(t)){s=t}else{s=t.handler;i=t}const o=Zs;ro(this);const a=wr(n,s.bind(r),i);if(o){ro(o)}else{no()}return a}function Er(e,t){const i=t.split(".");return()=>{let t=e;for(let e=0;e<i.length&&t;e++){t=t[i[e]]}return t}}function Tr(e,t){if(!S(e)||e["__v_skip"]){return e}t=t||new Set;if(t.has(e)){return e}t.add(e);if(Ft(e)){Tr(e.value,t)}else if(h(e)){for(let i=0;i<e.length;i++){Tr(e[i],t)}}else if(p(e)||f(e)){e.forEach((e=>{Tr(e,t)}))}else if(_(e)){for(const i in e){Tr(e[i],t)}}return e}function Ir(e){if(I(e)){$t("Do not use built-in directive ids as custom directive id: "+e)}}function Pr(e,t,i,r){const n=e.dirs;const s=t&&t.dirs;for(let o=0;o<n.length;o++){const a=n[o];if(s){a.oldValue=s[o].value}let c=a.dir[r];if(c){ye();ei(c,i,8,[e.el,a,e,t]);Ce()}}}function Ar(e,t){return g(e)?(()=>c({name:e.name},t,{setup:e}))():e}const Mr=e=>!!e.type.__asyncLoader;const Dr=e=>e.type.__isKeepAlive;function Rr(e,t){Nr(e,"a",t)}function Or(e,t){Nr(e,"da",t)}function Nr(e,t,i=Zs){const r=e.__wdc||(e.__wdc=()=>{let t=i;while(t){if(t.isDeactivated){return}t=t.parent}return e()});Lr(t,r,i);if(i){let e=i.parent;while(e&&e.parent){if(Dr(e.parent.vnode)){xr(r,t,i,e)}e=e.parent}}}function xr(e,t,i,r){const n=Lr(t,e,r,true);Hr((()=>{l(r[t],n)}),i)}function Lr(e,t,i=Zs,r=false){if(i){const n=i[e]||(i[e]=[]);const s=t.__weh||(t.__weh=(...r)=>{if(i.isUnmounted){return}ye();ro(i);const n=ei(t,i,e,r);no();Ce();return n});if(r){n.unshift(s)}else{n.push(s)}return s}else if(!!({}.NODE_ENV!=="production")){const t=N(Qt[e].replace(/ hook$/,""));$t(`${t} is called when there is no active component instance to be associated with. Lifecycle injection APIs can only be used during execution of setup(). If you are using async setup(), make sure to register lifecycle hooks before the first await statement.`)}}const kr=e=>(t,i=Zs)=>(!co||e==="sp")&&Lr(e,((...e)=>t(...e)),i);const Fr=kr("bm");const Ur=kr("m");const jr=kr("bu");const Wr=kr("u");const Br=kr("bum");const Hr=kr("um");const Vr=kr("sp");const Yr=kr("rtg");const Gr=kr("rtc");function $r(e,t=Zs){Lr("ec",e,t)}const zr="components";function Jr(e,t){return Kr(zr,e,true,t)||e}const qr=Symbol.for("v-ndc");function Kr(e,t,i=true,r=false){const n=tr||Zs;if(n){const s=n.type;if(e===zr){const e=wo(s,false);if(e&&(e===t||e===M(t)||e===O(M(t)))){return s}}const o=Xr(n[e]||s[e],t)||Xr(n.appContext[e],t);if(!o&&r){return s}if(!!({}.NODE_ENV!=="production")&&i&&!o){const i=e===zr?`\nIf this is a native custom element, make sure to exclude it from component resolution via compilerOptions.isCustomElement.`:``;$t(`Failed to resolve ${e.slice(0,-1)}: ${t}${i}`)}return o}else if(!!({}.NODE_ENV!=="production")){$t(`resolve${O(e.slice(0,-1))} can only be used in render() or setup().`)}}function Xr(e,t){return e&&(e[t]||e[M(t)]||e[O(M(t))])}function Qr(e,t,i,r){let n;const s=i&&i[r];if(h(e)||m(e)){n=new Array(e.length);for(let i=0,r=e.length;i<r;i++){n[i]=t(e[i],i,void 0,s&&s[i])}}else if(typeof e==="number"){if(!!({}.NODE_ENV!=="production")&&!Number.isInteger(e)){$t(`The v-for range expect an integer value but got ${e}.`)}n=new Array(e);for(let i=0;i<e;i++){n[i]=t(i+1,i,void 0,s&&s[i])}}else if(S(e)){if(e[Symbol.iterator]){n=Array.from(e,((e,i)=>t(e,i,void 0,s&&s[i])))}else{const i=Object.keys(e);n=new Array(i.length);for(let r=0,o=i.length;r<o;r++){const o=i[r];n[r]=t(e[o],o,r,s&&s[r])}}}else{n=[]}if(i){i[r]=n}return n}function Zr(e,t,i={},r,n){if(tr.isCE||tr.parent&&Mr(tr.parent)&&tr.parent.isCE){if(t!=="default")i.name=t;return Us("slot",i,r&&r())}let s=e[t];if(!!({}.NODE_ENV!=="production")&&s&&s.length>1){$t(`SSR-optimized slot function detected in a non-SSR-optimized render function. You need to mark this component with $dynamic-slots in the parent template.`);s=()=>[]}if(s&&s._c){s._d=false}Es();const o=s&&en(s(i));const a=Ds(Ss,{key:i.key||o&&o.key||`_${t}`},o||(r?r():[]),o&&e._===1?64:-2);if(!n&&a.scopeId){a.slotScopeIds=[a.scopeId+"-s"]}if(s&&s._c){s._d=true}return a}function en(e){return e.some((e=>{if(!Rs(e))return true;if(e.type===ys)return false;if(e.type===Ss&&!en(e.children))return false;return true}))?e:null}const tn=e=>{if(!e)return null;if(ao(e))return bo(e)||e.proxy;return tn(e.parent)};const rn=c(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>!!({}.NODE_ENV!=="production")?Tt(e.props):e.props,$attrs:e=>!!({}.NODE_ENV!=="production")?Tt(e.attrs):e.attrs,$slots:e=>!!({}.NODE_ENV!=="production")?Tt(e.slots):e.slots,$refs:e=>!!({}.NODE_ENV!=="production")?Tt(e.refs):e.refs,$parent:e=>tn(e.parent),$root:e=>tn(e.root),$emit:e=>e.emit,$options:e=>vn(e),$forceUpdate:e=>e.f||(e.f=()=>gi(e.update)),$nextTick:e=>e.n||(e.n=fi.bind(e.proxy)),$watch:e=>_r.bind(e)});const nn=e=>e==="_"||e==="$";const sn=(e,i)=>e!==t&&!e.__isScriptSetup&&u(e,i);const on={get({_:e},i){const{ctx:r,setupState:n,data:s,props:o,accessCache:a,type:c,appContext:l}=e;if(!!({}.NODE_ENV!=="production")&&i==="__isVue"){return true}let d;if(i[0]!=="$"){const c=a[i];if(c!==void 0){switch(c){case 1:return n[i];case 2:return s[i];case 4:return r[i];case 3:return o[i]}}else if(sn(n,i)){a[i]=1;return n[i]}else if(s!==t&&u(s,i)){a[i]=2;return s[i]}else if((d=e.propsOptions[0])&&u(d,i)){a[i]=3;return o[i]}else if(r!==t&&u(r,i)){a[i]=4;return r[i]}else if(hn){a[i]=0}}const h=rn[i];let f,p;if(h){if(i==="$attrs"){we(e,"get",i);!!({}.NODE_ENV!=="production")&&cr()}else if(!!({}.NODE_ENV!=="production")&&i==="$slots"){we(e,"get",i)}return h(e)}else if((f=c.__cssModules)&&(f=f[i])){return f}else if(r!==t&&u(r,i)){a[i]=4;return r[i]}else if(p=l.config.globalProperties,u(p,i)){{return p[i]}}else if(!!({}.NODE_ENV!=="production")&&tr&&(!m(i)||i.indexOf("__v")!==0)){if(s!==t&&nn(i[0])&&u(s,i)){$t(`Property ${JSON.stringify(i)} must be accessed via $data because it starts with a reserved character ("$" or "_") and is not proxied on the render context.`)}else if(e===tr){$t(`Property ${JSON.stringify(i)} was accessed during render but is not defined on instance.`)}}},set({_:e},i,r){const{data:n,setupState:s,ctx:o}=e;if(sn(s,i)){s[i]=r;return true}else if(!!({}.NODE_ENV!=="production")&&s.__isScriptSetup&&u(s,i)){$t(`Cannot mutate <script setup> binding "${i}" from Options API.`);return false}else if(n!==t&&u(n,i)){n[i]=r;return true}else if(u(e.props,i)){!!({}.NODE_ENV!=="production")&&$t(`Attempting to mutate prop "${i}". Props are readonly.`);return false}if(i[0]==="$"&&i.slice(1)in e){!!({}.NODE_ENV!=="production")&&$t(`Attempting to mutate public property "${i}". Properties starting with $ are reserved and readonly.`);return false}else{if(!!({}.NODE_ENV!=="production")&&i in e.appContext.config.globalProperties){Object.defineProperty(o,i,{enumerable:true,configurable:true,value:r})}else{o[i]=r}}return true},has({_:{data:e,setupState:i,accessCache:r,ctx:n,appContext:s,propsOptions:o}},a){let c;return!!r[a]||e!==t&&u(e,a)||sn(i,a)||(c=o[0])&&u(c,a)||u(n,a)||u(rn,a)||u(s.config.globalProperties,a)},defineProperty(e,t,i){if(i.get!=null){e._.accessCache[t]=0}else if(u(i,"value")){this.set(e,t,i.value,null)}return Reflect.defineProperty(e,t,i)}};if(!!({}.NODE_ENV!=="production")&&true){on.ownKeys=e=>{$t(`Avoid app logic that relies on enumerating keys on a component instance. The keys will be empty in production mode to avoid performance overhead.`);return Reflect.ownKeys(e)}}function an(e){const t={};Object.defineProperty(t,`_`,{configurable:true,enumerable:false,get:()=>e});Object.keys(rn).forEach((i=>{Object.defineProperty(t,i,{configurable:true,enumerable:false,get:()=>rn[i](e),set:r})}));return t}function cn(e){const{ctx:t,propsOptions:[i]}=e;if(i){Object.keys(i).forEach((i=>{Object.defineProperty(t,i,{enumerable:true,configurable:true,get:()=>e.props[i],set:r})}))}}function ln(e){const{ctx:t,setupState:i}=e;Object.keys(Rt(i)).forEach((e=>{if(!i.__isScriptSetup){if(nn(e[0])){$t(`setup() return property ${JSON.stringify(e)} should not start with "$" or "_" which are reserved prefixes for Vue internals.`);return}Object.defineProperty(t,e,{enumerable:true,configurable:true,get:()=>i[e],set:r})}}))}function dn(e){return h(e)?e.reduce(((e,t)=>(e[t]=null,e)),{}):e}function un(){const e=Object.create(null);return(t,i)=>{if(e[i]){$t(`${t} property "${i}" is already defined in ${e[i]}.`)}else{e[i]=t}}}let hn=true;function fn(e){const t=vn(e);const i=e.proxy;const n=e.ctx;hn=false;if(t.beforeCreate){gn(t.beforeCreate,e,"bc")}const{data:s,computed:o,methods:a,watch:c,provide:l,inject:d,created:u,beforeMount:f,mounted:p,beforeUpdate:m,updated:v,activated:y,deactivated:C,beforeDestroy:w,beforeUnmount:_,destroyed:E,unmounted:T,render:I,renderTracked:P,renderTriggered:A,errorCaptured:M,serverPrefetch:D,expose:R,inheritAttrs:O,components:N,directives:x,filters:L}=t;const k=!!({}.NODE_ENV!=="production")?un():null;if(!!({}.NODE_ENV!=="production")){const[t]=e.propsOptions;if(t){for(const e in t){k("Props",e)}}}if(d){pn(d,n,k)}if(a){for(const e in a){const t=a[e];if(g(t)){if(!!({}.NODE_ENV!=="production")){Object.defineProperty(n,e,{value:t.bind(i),configurable:true,enumerable:true,writable:true})}else{n[e]=t.bind(i)}if(!!({}.NODE_ENV!=="production")){k("Methods",e)}}else if(!!({}.NODE_ENV!=="production")){$t(`Method "${e}" has type "${typeof t}" in the component definition. Did you reference the function correctly?`)}}}if(s){if(!!({}.NODE_ENV!=="production")&&!g(s)){$t(`The data option must be a function. Plain object usage is no longer supported.`)}const t=s.call(i,i);if(!!({}.NODE_ENV!=="production")&&b(t)){$t(`data() returned a Promise - note data() cannot be async; If you intend to perform data fetching before component renders, use async setup() + <Suspense>.`)}if(!S(t)){!!({}.NODE_ENV!=="production")&&$t(`data() should return an object.`)}else{e.data=wt(t);if(!!({}.NODE_ENV!=="production")){for(const e in t){k("Data",e);if(!nn(e[0])){Object.defineProperty(n,e,{configurable:true,enumerable:true,get:()=>t[e],set:r})}}}}}hn=true;if(o){for(const e in o){const t=o[e];const s=g(t)?t.bind(i,i):g(t.get)?t.get.bind(i,i):r;if(!!({}.NODE_ENV!=="production")&&s===r){$t(`Computed property "${e}" has no getter.`)}const a=!g(t)&&g(t.set)?t.set.bind(i):!!({}.NODE_ENV!=="production")?()=>{$t(`Write operation failed: computed property "${e}" is readonly.`)}:r;const c=To({get:s,set:a});Object.defineProperty(n,e,{enumerable:true,configurable:true,get:()=>c.value,set:e=>c.value=e});if(!!({}.NODE_ENV!=="production")){k("Computed",e)}}}if(c){for(const e in c){mn(c[e],n,i,e)}}if(l){const e=g(l)?l.call(i):l;Reflect.ownKeys(e).forEach((t=>{Rn(t,e[t])}))}if(u){gn(u,e,"c")}function F(e,t){if(h(t)){t.forEach((t=>e(t.bind(i))))}else if(t){e(t.bind(i))}}F(Fr,f);F(Ur,p);F(jr,m);F(Wr,v);F(Rr,y);F(Or,C);F($r,M);F(Gr,P);F(Yr,A);F(Br,_);F(Hr,T);F(Vr,D);if(h(R)){if(R.length){const t=e.exposed||(e.exposed={});R.forEach((e=>{Object.defineProperty(t,e,{get:()=>i[e],set:t=>i[e]=t})}))}else if(!e.exposed){e.exposed={}}}if(I&&e.render===r){e.render=I}if(O!=null){e.inheritAttrs=O}if(N)e.components=N;if(x)e.directives=x}function pn(e,t,i=r){if(h(e)){e=wn(e)}for(const r in e){const n=e[r];let s;if(S(n)){if("default"in n){s=On(n.from||r,n.default,true)}else{s=On(n.from||r)}}else{s=On(n)}if(Ft(s)){Object.defineProperty(t,r,{enumerable:true,configurable:true,get:()=>s.value,set:e=>s.value=e})}else{t[r]=s}if(!!({}.NODE_ENV!=="production")){i("Inject",r)}}}function gn(e,t,i){ei(h(e)?e.map((e=>e.bind(t.proxy))):e.bind(t.proxy),t,i)}function mn(e,t,i,r){const n=r.includes(".")?Er(i,r):()=>i[r];if(m(e)){const i=t[e];if(g(i)){Cr(n,i)}else if(!!({}.NODE_ENV!=="production")){$t(`Invalid watch handler specified by key "${e}"`,i)}}else if(g(e)){Cr(n,e.bind(i))}else if(S(e)){if(h(e)){e.forEach((e=>mn(e,t,i,r)))}else{const r=g(e.handler)?e.handler.bind(i):t[e.handler];if(g(r)){Cr(n,r,e)}else if(!!({}.NODE_ENV!=="production")){$t(`Invalid watch handler specified by key "${e.handler}"`,r)}}}else if(!!({}.NODE_ENV!=="production")){$t(`Invalid watch option: "${r}"`,e)}}function vn(e){const t=e.type;const{mixins:i,extends:r}=t;const{mixins:n,optionsCache:s,config:{optionMergeStrategies:o}}=e.appContext;const a=s.get(t);let c;if(a){c=a}else if(!n.length&&!i&&!r){{c=t}}else{c={};if(n.length){n.forEach((e=>Sn(c,e,o,true)))}Sn(c,t,o)}if(S(t)){s.set(t,c)}return c}function Sn(e,t,i,r=false){const{mixins:n,extends:s}=t;if(s){Sn(e,s,i,true)}if(n){n.forEach((t=>Sn(e,t,i,true)))}for(const o in t){if(r&&o==="expose"){!!({}.NODE_ENV!=="production")&&$t(`"expose" option is ignored when declared in mixins or extends. It should only be declared in the base component itself.`)}else{const r=bn[o]||i&&i[o];e[o]=r?r(e[o],t[o]):t[o]}}return e}const bn={data:yn,props:Tn,emits:Tn,methods:En,computed:En,beforeCreate:_n,created:_n,beforeMount:_n,mounted:_n,beforeUpdate:_n,updated:_n,beforeDestroy:_n,beforeUnmount:_n,destroyed:_n,unmounted:_n,activated:_n,deactivated:_n,errorCaptured:_n,serverPrefetch:_n,components:En,directives:En,watch:In,provide:yn,inject:Cn};function yn(e,t){if(!t){return e}if(!e){return t}return function i(){return c(g(e)?e.call(this,this):e,g(t)?t.call(this,this):t)}}function Cn(e,t){return En(wn(e),wn(t))}function wn(e){if(h(e)){const t={};for(let i=0;i<e.length;i++){t[e[i]]=e[i]}return t}return e}function _n(e,t){return e?[...new Set([].concat(e,t))]:t}function En(e,t){return e?c(Object.create(null),e,t):t}function Tn(e,t){if(e){if(h(e)&&h(t)){return[...new Set([...e,...t])]}return c(Object.create(null),dn(e),dn(t!=null?t:{}))}else{return t}}function In(e,t){if(!e)return t;if(!t)return e;const i=c(Object.create(null),e);for(const r in t){i[r]=_n(e[r],t[r])}return i}function Pn(){return{app:null,config:{isNativeTag:n,performance:false,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let An=0;function Mn(e,t){return function i(r,n=null){if(!g(r)){r=c({},r)}if(n!=null&&!S(n)){!!({}.NODE_ENV!=="production")&&$t(`root props passed to app.mount() must be an object.`);n=null}const s=Pn();if(!!({}.NODE_ENV!=="production")){Object.defineProperty(s.config,"unwrapInjectedRef",{get(){return true},set(){$t(`app.config.unwrapInjectedRef has been deprecated. 3.3 now alawys unwraps injected refs in Options API.`)}})}const o=new Set;let a=false;const l=s.app={_uid:An++,_component:r,_props:n,_container:null,_context:s,_instance:null,version:Do,get config(){return s.config},set config(e){if(!!({}.NODE_ENV!=="production")){$t(`app.config cannot be replaced. Modify individual options instead.`)}},use(e,...t){if(o.has(e)){!!({}.NODE_ENV!=="production")&&$t(`Plugin has already been applied to target app.`)}else if(e&&g(e.install)){o.add(e);e.install(l,...t)}else if(g(e)){o.add(e);e(l,...t)}else if(!!({}.NODE_ENV!=="production")){$t(`A plugin must either be a function or an object with an "install" function.`)}return l},mixin(e){{if(!s.mixins.includes(e)){s.mixins.push(e)}else if(!!({}.NODE_ENV!=="production")){$t("Mixin has already been applied to target app"+(e.name?`: ${e.name}`:""))}}return l},component(e,t){if(!!({}.NODE_ENV!=="production")){oo(e,s.config)}if(!t){return s.components[e]}if(!!({}.NODE_ENV!=="production")&&s.components[e]){$t(`Component "${e}" has already been registered in target app.`)}s.components[e]=t;return l},directive(e,t){if(!!({}.NODE_ENV!=="production")){Ir(e)}if(!t){return s.directives[e]}if(!!({}.NODE_ENV!=="production")&&s.directives[e]){$t(`Directive "${e}" has already been registered in target app.`)}s.directives[e]=t;return l},mount(i,o,c){if(!a){if(!!({}.NODE_ENV!=="production")&&i.__vue_app__){$t(`There is already an app instance mounted on the host container.\n If you want to mount another app on the same host container, you need to unmount the previous app by calling \`app.unmount()\` first.`)}const d=Us(r,n);d.appContext=s;if(!!({}.NODE_ENV!=="production")){s.reload=()=>{e(Bs(d),i,c)}}if(o&&t){t(d,i)}else{e(d,i,c)}a=true;l._container=i;i.__vue_app__=l;if(!!({}.NODE_ENV!=="production")||false){l._instance=d.component;Bi(l,Do)}return bo(d.component)||d.component.proxy}else if(!!({}.NODE_ENV!=="production")){$t(`App has already been mounted.\nIf you want to remount the same app, move your app creation logic into a factory function and create fresh app instances for each mount - e.g. \`const createMyApp = () => createApp(App)\``)}},unmount(){if(a){e(null,l._container);if(!!({}.NODE_ENV!=="production")||false){l._instance=null;Hi(l)}delete l._container.__vue_app__}else if(!!({}.NODE_ENV!=="production")){$t(`Cannot unmount an app that is not mounted.`)}},provide(e,t){if(!!({}.NODE_ENV!=="production")&&e in s.provides){$t(`App already provides property with key "${String(e)}". It will be overwritten with the new value.`)}s.provides[e]=t;return l},runWithContext(e){Dn=l;try{return e()}finally{Dn=null}}};return l}}let Dn=null;function Rn(e,t){if(!Zs){if(!!({}.NODE_ENV!=="production")){$t(`provide() can only be used inside setup().`)}}else{let i=Zs.provides;const r=Zs.parent&&Zs.parent.provides;if(r===i){i=Zs.provides=Object.create(r)}i[e]=t}}function On(e,t,i=false){const r=Zs||tr;if(r||Dn){const n=r?r.parent==null?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:Dn._context.provides;if(n&&e in n){return n[e]}else if(arguments.length>1){return i&&g(t)?t.call(r&&r.proxy):t}else if(!!({}.NODE_ENV!=="production")){$t(`injection "${String(e)}" not found.`)}}else if(!!({}.NODE_ENV!=="production")){$t(`inject() can only be used inside setup() or functional components.`)}}function Nn(e,t,i,r=false){const n={};const s={};k(s,xs,1);e.propsDefaults=Object.create(null);kn(e,t,n,s);for(const o in e.propsOptions[0]){if(!(o in n)){n[o]=void 0}}if(!!({}.NODE_ENV!=="production")){Vn(t||{},n,e)}if(i){e.props=r?n:_t(n)}else{if(!e.type.props){e.props=s}else{e.props=n}}e.attrs=s}function xn(e){while(e){if(e.type.__hmrId)return true;e=e.parent}}function Ln(e,t,i,r){const{props:n,attrs:s,vnode:{patchFlag:o}}=e;const a=Rt(n);const[c]=e.propsOptions;let l=false;if(!(!!({}.NODE_ENV!=="production")&&xn(e))&&(r||o>0)&&!(o&16)){if(o&8){const i=e.vnode.dynamicProps;for(let r=0;r<i.length;r++){let o=i[r];if(er(e.emitsOptions,o)){continue}const d=t[o];if(c){if(u(s,o)){if(d!==s[o]){s[o]=d;l=true}}else{const t=M(o);n[t]=Fn(c,a,t,d,e,false)}}else{if(d!==s[o]){s[o]=d;l=true}}}}}else{if(kn(e,t,n,s)){l=true}let r;for(const s in a){if(!t||!u(t,s)&&((r=R(s))===s||!u(t,r))){if(c){if(i&&(i[s]!==void 0||i[r]!==void 0)){n[s]=Fn(c,a,s,void 0,e,true)}}else{delete n[s]}}}if(s!==a){for(const e in s){if(!t||!u(t,e)&&true){delete s[e];l=true}}}}if(l){Ee(e,"set","$attrs")}if(!!({}.NODE_ENV!=="production")){Vn(t||{},n,e)}}function kn(e,i,r,n){const[s,o]=e.propsOptions;let a=false;let c;if(i){for(let t in i){if(T(t)){continue}const l=i[t];let d;if(s&&u(s,d=M(t))){if(!o||!o.includes(d)){r[d]=l}else{(c||(c={}))[d]=l}}else if(!er(e.emitsOptions,t)){if(!(t in n)||l!==n[t]){n[t]=l;a=true}}}}if(o){const i=Rt(r);const n=c||t;for(let t=0;t<o.length;t++){const a=o[t];r[a]=Fn(s,i,a,n[a],e,!u(n,a))}}return a}function Fn(e,t,i,r,n,s){const o=e[i];if(o!=null){const e=u(o,"default");if(e&&r===void 0){const e=o.default;if(o.type!==Function&&!o.skipFactory&&g(e)){const{propsDefaults:s}=n;if(i in s){r=s[i]}else{ro(n);r=s[i]=e.call(null,t);no()}}else{r=e}}if(o[0]){if(s&&!e){r=false}else if(o[1]&&(r===""||r===R(i))){r=true}}}return r}function Un(e,r,n=false){const s=r.propsCache;const o=s.get(e);if(o){return o}const a=e.props;const l={};const d=[];let f=false;if(!g(e)){const t=e=>{f=true;const[t,i]=Un(e,r,true);c(l,t);if(i)d.push(...i)};if(!n&&r.mixins.length){r.mixins.forEach(t)}if(e.extends){t(e.extends)}if(e.mixins){e.mixins.forEach(t)}}if(!a&&!f){if(S(e)){s.set(e,i)}return i}if(h(a)){for(let e=0;e<a.length;e++){if(!!({}.NODE_ENV!=="production")&&!m(a[e])){$t(`props must be strings when using array syntax.`,a[e])}const i=M(a[e]);if(jn(i)){l[i]=t}}}else if(a){if(!!({}.NODE_ENV!=="production")&&!S(a)){$t(`invalid props options`,a)}for(const e in a){const t=M(e);if(jn(t)){const i=a[e];const r=l[t]=h(i)||g(i)?{type:i}:c({},i);if(r){const e=Hn(Boolean,r.type);const i=Hn(String,r.type);r[0]=e>-1;r[1]=i<0||e<i;if(e>-1||u(r,"default")){d.push(t)}}}}}const p=[l,d];if(S(e)){s.set(e,p)}return p}function jn(e){if(e[0]!=="$"){return true}else if(!!({}.NODE_ENV!=="production")){$t(`Invalid prop name: "${e}" is a reserved property.`)}return false}function Wn(e){const t=e&&e.toString().match(/^\s*(function|class) (\w+)/);return t?t[2]:e===null?"null":""}function Bn(e,t){return Wn(e)===Wn(t)}function Hn(e,t){if(h(t)){return t.findIndex((t=>Bn(t,e)))}else if(g(t)){return Bn(t,e)?0:-1}return-1}function Vn(e,t,i){const r=Rt(t);const n=i.propsOptions[0];for(const s in n){let t=n[s];if(t==null)continue;Yn(s,r[s],t,!u(e,s)&&!u(e,R(s)))}}function Yn(e,t,i,r){const{type:n,required:s,validator:o,skipCheck:a}=i;if(s&&r){$t('Missing required prop: "'+e+'"');return}if(t==null&&!s){return}if(n!=null&&n!==true&&!a){let i=false;const r=h(n)?n:[n];const s=[];for(let e=0;e<r.length&&!i;e++){const{valid:n,expectedType:o}=$n(t,r[e]);s.push(o||"");i=n}if(!i){$t(zn(e,t,s));return}}if(o&&!o(t)){$t('Invalid prop: custom validator check failed for prop "'+e+'".')}}const Gn=e("String,Number,Boolean,Function,Symbol,BigInt");function $n(e,t){let i;const r=Wn(t);if(Gn(r)){const n=typeof e;i=n===r.toLowerCase();if(!i&&n==="object"){i=e instanceof t}}else if(r==="Object"){i=S(e)}else if(r==="Array"){i=h(e)}else if(r==="null"){i=e===null}else{i=e instanceof t}return{valid:i,expectedType:r}}function zn(e,t,i){let r=`Invalid prop: type check failed for prop "${e}". Expected ${i.map(O).join(" | ")}`;const n=i[0];const s=w(t);const o=Jn(t,n);const a=Jn(t,s);if(i.length===1&&qn(n)&&!Kn(n,s)){r+=` with value ${o}`}r+=`, got ${s} `;if(qn(s)){r+=`with value ${a}.`}return r}function Jn(e,t){if(t==="String"){return`"${e}"`}else if(t==="Number"){return`${Number(e)}`}else{return`${e}`}}function qn(e){const t=["string","number","boolean"];return t.some((t=>e.toLowerCase()===t))}function Kn(...e){return e.some((e=>e.toLowerCase()==="boolean"))}const Xn=e=>e[0]==="_"||e==="$stable";const Qn=e=>h(e)?e.map(Gs):[Gs(e)];const Zn=(e,t,i)=>{if(t._n){return t}const r=or(((...i)=>{if(!!({}.NODE_ENV!=="production")&&Zs){$t(`Slot "${e}" invoked outside of the render function: this will not track dependencies used in the slot. Invoke the slot function inside the render function instead.`)}return Qn(t(...i))}),i);r._c=false;return r};const es=(e,t,i)=>{const r=e._ctx;for(const n in e){if(Xn(n))continue;const i=e[n];if(g(i)){t[n]=Zn(n,i,r)}else if(i!=null){if(!!({}.NODE_ENV!=="production")&&true){$t(`Non-function value encountered for slot "${n}". Prefer function slots for better performance.`)}const e=Qn(i);t[n]=()=>e}}};const ts=(e,t)=>{if(!!({}.NODE_ENV!=="production")&&!Dr(e.vnode)&&true){$t(`Non-function value encountered for default slot. Prefer function slots for better performance.`)}const i=Qn(t);e.slots.default=()=>i};const is=(e,t)=>{if(e.vnode.shapeFlag&32){const i=t._;if(i){e.slots=Rt(t);k(t,"_",i)}else{es(t,e.slots={})}}else{e.slots={};if(t){ts(e,t)}}k(e.slots,xs,1)};const rs=(e,i,r)=>{const{vnode:n,slots:s}=e;let o=true;let a=t;if(n.shapeFlag&32){const t=i._;if(t){if(!!({}.NODE_ENV!=="production")&&Ti){c(s,i);Ee(e,"set","$slots")}else if(r&&t===1){o=false}else{c(s,i);if(!r&&t===1){delete s._}}}else{o=!i.$stable;es(i,s)}a=i}else if(i){ts(e,i);a={default:1}}if(o){for(const e in s){if(!Xn(e)&&!(e in a)){delete s[e]}}}};function ns(e,i,r,n,s=false){if(h(e)){e.forEach(((e,t)=>ns(e,i&&(h(i)?i[t]:i),r,n,s)));return}if(Mr(n)&&!s){return}const o=n.shapeFlag&4?bo(n.component)||n.component.proxy:n.el;const a=s?null:o;const{i:c,r:d}=e;if(!!({}.NODE_ENV!=="production")&&!c){$t(`Missing ref owner context. ref cannot be used on hoisted vnodes. A vnode with ref must be created inside the render function.`);return}const f=i&&i.r;const p=c.refs===t?c.refs={}:c.refs;const v=c.setupState;if(f!=null&&f!==d){if(m(f)){p[f]=null;if(u(v,f)){v[f]=null}}else if(Ft(f)){f.value=null}}if(g(d)){Zt(d,c,12,[a,p])}else{const t=m(d);const i=Ft(d);if(t||i){const n=()=>{if(e.f){const i=t?u(v,d)?v[d]:p[d]:d.value;if(s){h(i)&&l(i,o)}else{if(!h(i)){if(t){p[d]=[o];if(u(v,d)){v[d]=p[d]}}else{d.value=[o];if(e.k)p[e.k]=d.value}}else if(!i.includes(o)){i.push(o)}}}else if(t){p[d]=a;if(u(v,d)){v[d]=a}}else if(i){d.value=a;if(e.k)p[e.k]=a}else if(!!({}.NODE_ENV!=="production")){$t("Invalid template ref type:",d,`(${typeof d})`)}};if(a){n.id=-1;us(n,r)}else{n()}}else if(!!({}.NODE_ENV!=="production")){$t("Invalid template ref type:",d,`(${typeof d})`)}}}let ss;let os;function as(e,t){if(e.appContext.config.performance&&ls()){os.mark(`vue-${t}-${e.uid}`)}if(!!({}.NODE_ENV!=="production")||false){Ji(e,t,ls()?os.now():Date.now())}}function cs(e,t){if(e.appContext.config.performance&&ls()){const i=`vue-${t}-${e.uid}`;const r=i+`:end`;os.mark(r);os.measure(`<${_o(e,e.type)}> ${t}`,i,r);os.clearMarks(i);os.clearMarks(r)}if(!!({}.NODE_ENV!=="production")||false){qi(e,t,ls()?os.now():Date.now())}}function ls(){if(ss!==void 0){return ss}if(typeof window!=="undefined"&&window.performance){ss=true;os=window.performance}else{ss=false}return ss}function ds(){const e=[];if(!!({}.NODE_ENV!=="production")&&e.length){const t=e.length>1;console.warn(`Feature flag${t?`s`:``} ${e.join(", ")} ${t?`are`:`is`} not explicitly defined. You are running the esm-bundler build of Vue, which expects these compile-time feature flags to be globally injected via the bundler config in order to get better tree-shaking in the production bundle.\n\nFor more details, see https://link.vuejs.org/feature-flags.`)}}const us=br;function hs(e){return fs(e)}function fs(e,n){{ds()}const s=W();s.__VUE__=true;if(!!({}.NODE_ENV!=="production")||false){Wi(s.__VUE_DEVTOOLS_GLOBAL_HOOK__,s)}const{insert:o,remove:a,patchProp:c,createElement:l,createText:d,createComment:u,setText:h,setElementText:f,parentNode:p,nextSibling:g,setScopeId:m=r,insertStaticContent:v}=e;const S=(e,t,i,r=null,n=null,s=null,o=false,a=null,c=(!!({}.NODE_ENV!=="production")&&Ti?false:!!t.dynamicChildren))=>{if(e===t){return}if(e&&!Os(e,t)){r=K(e);G(e,n,s,true);e=null}if(t.patchFlag===-2){c=false;t.dynamicChildren=null}const{type:l,ref:d,shapeFlag:u}=t;switch(l){case bs:b(e,t,i,r);break;case ys:y(e,t,i,r);break;case Cs:if(e==null){C(t,i,r,o)}else if(!!({}.NODE_ENV!=="production")){w(e,t,i,o)}break;case Ss:N(e,t,i,r,n,s,o,a,c);break;default:if(u&1){I(e,t,i,r,n,s,o,a,c)}else if(u&6){x(e,t,i,r,n,s,o,a,c)}else if(u&64){l.process(e,t,i,r,n,s,o,a,c,Q)}else if(u&128){l.process(e,t,i,r,n,s,o,a,c,Q)}else if(!!({}.NODE_ENV!=="production")){$t("Invalid VNode type:",l,`(${typeof l})`)}}if(d!=null&&n){ns(d,e&&e.ref,s,t||e,!t)}};const b=(e,t,i,r)=>{if(e==null){o(t.el=d(t.children),i,r)}else{const i=t.el=e.el;if(t.children!==e.children){h(i,t.children)}}};const y=(e,t,i,r)=>{if(e==null){o(t.el=u(t.children||""),i,r)}else{t.el=e.el}};const C=(e,t,i,r)=>{[e.el,e.anchor]=v(e.children,t,i,r,e.el,e.anchor)};const w=(e,t,i,r)=>{if(t.children!==e.children){const n=g(e.anchor);E(e);[t.el,t.anchor]=v(t.children,i,n,r)}else{t.el=e.el;t.anchor=e.anchor}};const _=({el:e,anchor:t},i,r)=>{let n;while(e&&e!==t){n=g(e);o(e,i,r);e=n}o(t,i,r)};const E=({el:e,anchor:t})=>{let i;while(e&&e!==t){i=g(e);a(e);e=i}a(t)};const I=(e,t,i,r,n,s,o,a,c)=>{o=o||t.type==="svg";if(e==null){P(t,i,r,n,s,o,a,c)}else{D(e,t,n,s,o,a,c)}};const P=(e,t,i,r,n,s,a,d)=>{let u;let h;const{type:p,props:g,shapeFlag:m,transition:v,dirs:S}=e;u=e.el=l(e.type,s,g&&g.is,g);if(m&8){f(u,e.children)}else if(m&16){M(e.children,u,null,r,n,s&&p!=="foreignObject",a,d)}if(S){Pr(e,null,r,"created")}A(u,e,e.scopeId,a,r);if(g){for(const t in g){if(t!=="value"&&!T(t)){c(u,t,null,g[t],s,e.children,r,n,q)}}if("value"in g){c(u,"value",null,g.value)}if(h=g.onVnodeBeforeMount){qs(h,r,e)}}if(!!({}.NODE_ENV!=="production")||false){Object.defineProperty(u,"__vnode",{value:e,enumerable:false});Object.defineProperty(u,"__vueParentComponent",{value:r,enumerable:false})}if(S){Pr(e,null,r,"beforeMount")}const b=(!n||n&&!n.pendingBranch)&&v&&!v.persisted;if(b){v.beforeEnter(u)}o(u,t,i);if((h=g&&g.onVnodeMounted)||b||S){us((()=>{h&&qs(h,r,e);b&&v.enter(u);S&&Pr(e,null,r,"mounted")}),n)}};const A=(e,t,i,r,n)=>{if(i){m(e,i)}if(r){for(let t=0;t<r.length;t++){m(e,r[t])}}if(n){let i=n.subTree;if(!!({}.NODE_ENV!=="production")&&i.patchFlag>0&&i.patchFlag&2048){i=ur(i.children)||i}if(t===i){const t=n.vnode;A(e,t,t.scopeId,t.slotScopeIds,n.parent)}}};const M=(e,t,i,r,n,s,o,a,c=0)=>{for(let l=c;l<e.length;l++){const c=e[l]=a?$s(e[l]):Gs(e[l]);S(null,c,t,i,r,n,s,o,a)}};const D=(e,i,r,n,s,o,a)=>{const l=i.el=e.el;let{patchFlag:d,dynamicChildren:u,dirs:h}=i;d|=e.patchFlag&16;const p=e.props||t;const g=i.props||t;let m;r&&ps(r,false);if(m=g.onVnodeBeforeUpdate){qs(m,r,i,e)}if(h){Pr(i,e,r,"beforeUpdate")}r&&ps(r,true);if(!!({}.NODE_ENV!=="production")&&Ti){d=0;a=false;u=null}const v=s&&i.type!=="foreignObject";if(u){R(e.dynamicChildren,u,l,r,n,v,o);if(!!({}.NODE_ENV!=="production")){gs(e,i)}}else if(!a){B(e,i,l,null,r,n,v,o,false)}if(d>0){if(d&16){O(l,i,p,g,r,n,s)}else{if(d&2){if(p.class!==g.class){c(l,"class",null,g.class,s)}}if(d&4){c(l,"style",p.style,g.style,s)}if(d&8){const t=i.dynamicProps;for(let i=0;i<t.length;i++){const o=t[i];const a=p[o];const d=g[o];if(d!==a||o==="value"){c(l,o,a,d,s,e.children,r,n,q)}}}}if(d&1){if(e.children!==i.children){f(l,i.children)}}}else if(!a&&u==null){O(l,i,p,g,r,n,s)}if((m=g.onVnodeUpdated)||h){us((()=>{m&&qs(m,r,i,e);h&&Pr(i,e,r,"updated")}),n)}};const R=(e,t,i,r,n,s,o)=>{for(let a=0;a<t.length;a++){const c=e[a];const l=t[a];const d=c.el&&(c.type===Ss||!Os(c,l)||c.shapeFlag&(6|64))?p(c.el):i;S(c,l,d,null,r,n,s,o,true)}};const O=(e,i,r,n,s,o,a)=>{if(r!==n){if(r!==t){for(const t in r){if(!T(t)&&!(t in n)){c(e,t,r[t],null,a,i.children,s,o,q)}}}for(const t in n){if(T(t))continue;const l=n[t];const d=r[t];if(l!==d&&t!=="value"){c(e,t,d,l,a,i.children,s,o,q)}}if("value"in n){c(e,"value",r.value,n.value)}}};const N=(e,t,i,r,n,s,a,c,l)=>{const u=t.el=e?e.el:d("");const h=t.anchor=e?e.anchor:d("");let{patchFlag:f,dynamicChildren:p,slotScopeIds:g}=t;if(!!({}.NODE_ENV!=="production")&&(Ti||f&2048)){f=0;l=false;p=null}if(g){c=c?c.concat(g):g}if(e==null){o(u,i,r);o(h,i,r);M(t.children,i,h,n,s,a,c,l)}else{if(f>0&&f&64&&p&&e.dynamicChildren){R(e.dynamicChildren,p,i,n,s,a,c);if(!!({}.NODE_ENV!=="production")){gs(e,t)}else if(t.key!=null||n&&t===n.subTree){gs(e,t,true)}}else{B(e,t,i,h,n,s,a,c,l)}}};const x=(e,t,i,r,n,s,o,a,c)=>{t.slotScopeIds=a;if(e==null){if(t.shapeFlag&512){n.ctx.activate(t,i,r,o,c)}else{k(t,i,r,n,s,o,c)}}else{F(e,t,c)}};const k=(e,t,i,r,n,s,o)=>{const a=e.component=Qs(e,r,n);if(!!({}.NODE_ENV!=="production")&&a.type.__hmrId){Ai(a)}if(!!({}.NODE_ENV!=="production")){Yt(e);as(a,`mount`)}if(Dr(e)){a.ctx.renderer=Q}{if(!!({}.NODE_ENV!=="production")){as(a,`init`)}lo(a);if(!!({}.NODE_ENV!=="production")){cs(a,`init`)}}if(a.asyncDep){n&&n.registerDep(a,U);if(!e.el){const e=a.subTree=Us(ys);y(null,e,t,i)}return}U(a,e,t,i,n,s,o);if(!!({}.NODE_ENV!=="production")){Gt();cs(a,`mount`)}};const F=(e,t,i)=>{const r=t.component=e.component;if(gr(e,t,i)){if(r.asyncDep&&!r.asyncResolved){if(!!({}.NODE_ENV!=="production")){Yt(t)}j(r,t,i);if(!!({}.NODE_ENV!=="production")){Gt()}return}else{r.next=t;vi(r.update);r.update()}}else{t.el=e.el;r.vnode=t}};const U=(e,t,i,r,n,s,o)=>{const a=()=>{if(!e.isMounted){let o;const{el:a,props:c}=t;const{bm:l,m:d,parent:u}=e;const h=Mr(t);ps(e,false);if(l){L(l)}if(!h&&(o=c&&c.onVnodeBeforeMount)){qs(o,u,t)}ps(e,true);if(a&&ee){const i=()=>{if(!!({}.NODE_ENV!=="production")){as(e,`render`)}e.subTree=lr(e);if(!!({}.NODE_ENV!=="production")){cs(e,`render`)}if(!!({}.NODE_ENV!=="production")){as(e,`hydrate`)}ee(a,e.subTree,e,n,null);if(!!({}.NODE_ENV!=="production")){cs(e,`hydrate`)}};if(h){t.type.__asyncLoader().then((()=>!e.isUnmounted&&i()))}else{i()}}else{if(!!({}.NODE_ENV!=="production")){as(e,`render`)}const o=e.subTree=lr(e);if(!!({}.NODE_ENV!=="production")){cs(e,`render`)}if(!!({}.NODE_ENV!=="production")){as(e,`patch`)}S(null,o,i,r,e,n,s);if(!!({}.NODE_ENV!=="production")){cs(e,`patch`)}t.el=o.el}if(d){us(d,n)}if(!h&&(o=c&&c.onVnodeMounted)){const e=t;us((()=>qs(o,u,e)),n)}if(t.shapeFlag&256||u&&Mr(u.vnode)&&u.vnode.shapeFlag&256){e.a&&us(e.a,n)}e.isMounted=true;if(!!({}.NODE_ENV!=="production")||false){Vi(e)}t=i=r=null}else{let{next:t,bu:i,u:r,parent:a,vnode:c}=e;let l=t;let d;if(!!({}.NODE_ENV!=="production")){Yt(t||e.vnode)}ps(e,false);if(t){t.el=c.el;j(e,t,o)}else{t=c}if(i){L(i)}if(d=t.props&&t.props.onVnodeBeforeUpdate){qs(d,a,t,c)}ps(e,true);if(!!({}.NODE_ENV!=="production")){as(e,`render`)}const u=lr(e);if(!!({}.NODE_ENV!=="production")){cs(e,`render`)}const h=e.subTree;e.subTree=u;if(!!({}.NODE_ENV!=="production")){as(e,`patch`)}S(h,u,p(h.el),K(h),e,n,s);if(!!({}.NODE_ENV!=="production")){cs(e,`patch`)}t.el=u.el;if(l===null){vr(e,u.el)}if(r){us(r,n)}if(d=t.props&&t.props.onVnodeUpdated){us((()=>qs(d,a,t,c)),n)}if(!!({}.NODE_ENV!=="production")||false){Yi(e)}if(!!({}.NODE_ENV!=="production")){Gt()}}};const c=e.effect=new me(a,(()=>gi(l)),e.scope);const l=e.update=()=>c.run();l.id=e.uid;ps(e,true);if(!!({}.NODE_ENV!=="production")){c.onTrack=e.rtc?t=>L(e.rtc,t):void 0;c.onTrigger=e.rtg?t=>L(e.rtg,t):void 0;l.ownerInstance=e}l()};const j=(e,t,i)=>{t.component=e;const r=e.vnode.props;e.vnode=t;e.next=null;Ln(e,t.props,r,i);rs(e,t.children,i);ye();bi();Ce()};const B=(e,t,i,r,n,s,o,a,c=false)=>{const l=e&&e.children;const d=e?e.shapeFlag:0;const u=t.children;const{patchFlag:h,shapeFlag:p}=t;if(h>0){if(h&128){V(l,u,i,r,n,s,o,a,c);return}else if(h&256){H(l,u,i,r,n,s,o,a,c);return}}if(p&8){if(d&16){q(l,n,s)}if(u!==l){f(i,u)}}else{if(d&16){if(p&16){V(l,u,i,r,n,s,o,a,c)}else{q(l,n,s,true)}}else{if(d&8){f(i,"")}if(p&16){M(u,i,r,n,s,o,a,c)}}}};const H=(e,t,r,n,s,o,a,c,l)=>{e=e||i;t=t||i;const d=e.length;const u=t.length;const h=Math.min(d,u);let f;for(f=0;f<h;f++){const i=t[f]=l?$s(t[f]):Gs(t[f]);S(e[f],i,r,null,s,o,a,c,l)}if(d>u){q(e,s,o,true,false,h)}else{M(t,r,n,s,o,a,c,l,h)}};const V=(e,t,r,n,s,o,a,c,l)=>{let d=0;const u=t.length;let h=e.length-1;let f=u-1;while(d<=h&&d<=f){const i=e[d];const n=t[d]=l?$s(t[d]):Gs(t[d]);if(Os(i,n)){S(i,n,r,null,s,o,a,c,l)}else{break}d++}while(d<=h&&d<=f){const i=e[h];const n=t[f]=l?$s(t[f]):Gs(t[f]);if(Os(i,n)){S(i,n,r,null,s,o,a,c,l)}else{break}h--;f--}if(d>h){if(d<=f){const e=f+1;const i=e<u?t[e].el:n;while(d<=f){S(null,t[d]=l?$s(t[d]):Gs(t[d]),r,i,s,o,a,c,l);d++}}}else if(d>f){while(d<=h){G(e[d],s,o,true);d++}}else{const p=d;const g=d;const m=new Map;for(d=g;d<=f;d++){const e=t[d]=l?$s(t[d]):Gs(t[d]);if(e.key!=null){if(!!({}.NODE_ENV!=="production")&&m.has(e.key)){$t(`Duplicate keys found during update:`,JSON.stringify(e.key),`Make sure keys are unique.`)}m.set(e.key,d)}}let v;let b=0;const y=f-g+1;let C=false;let w=0;const _=new Array(y);for(d=0;d<y;d++)_[d]=0;for(d=p;d<=h;d++){const i=e[d];if(b>=y){G(i,s,o,true);continue}let n;if(i.key!=null){n=m.get(i.key)}else{for(v=g;v<=f;v++){if(_[v-g]===0&&Os(i,t[v])){n=v;break}}}if(n===void 0){G(i,s,o,true)}else{_[n-g]=d+1;if(n>=w){w=n}else{C=true}S(i,t[n],r,null,s,o,a,c,l);b++}}const E=C?ms(_):i;v=E.length-1;for(d=y-1;d>=0;d--){const e=g+d;const i=t[e];const h=e+1<u?t[e+1].el:n;if(_[d]===0){S(null,i,r,h,s,o,a,c,l)}else if(C){if(v<0||d!==E[v]){Y(i,r,h,2)}else{v--}}}}};const Y=(e,t,i,r,n=null)=>{const{el:s,type:a,transition:c,children:l,shapeFlag:d}=e;if(d&6){Y(e.component.subTree,t,i,r);return}if(d&128){e.suspense.move(t,i,r);return}if(d&64){a.move(e,t,i,Q);return}if(a===Ss){o(s,t,i);for(let e=0;e<l.length;e++){Y(l[e],t,i,r)}o(e.anchor,t,i);return}if(a===Cs){_(e,t,i);return}const u=r!==2&&d&1&&c;if(u){if(r===0){c.beforeEnter(s);o(s,t,i);us((()=>c.enter(s)),n)}else{const{leave:e,delayLeave:r,afterLeave:n}=c;const a=()=>o(s,t,i);const l=()=>{e(s,(()=>{a();n&&n()}))};if(r){r(s,a,l)}else{l()}}}else{o(s,t,i)}};const G=(e,t,i,r=false,n=false)=>{const{type:s,props:o,ref:a,children:c,dynamicChildren:l,shapeFlag:d,patchFlag:u,dirs:h}=e;if(a!=null){ns(a,null,i,e,true)}if(d&256){t.ctx.deactivate(e);return}const f=d&1&&h;const p=!Mr(e);let g;if(p&&(g=o&&o.onVnodeBeforeUnmount)){qs(g,t,e)}if(d&6){J(e.component,i,r)}else{if(d&128){e.suspense.unmount(i,r);return}if(f){Pr(e,null,t,"beforeUnmount")}if(d&64){e.type.remove(e,t,i,n,Q,r)}else if(l&&(s!==Ss||u>0&&u&64)){q(l,t,i,false,true)}else if(s===Ss&&u&(128|256)||!n&&d&16){q(c,t,i)}if(r){$(e)}}if(p&&(g=o&&o.onVnodeUnmounted)||f){us((()=>{g&&qs(g,t,e);f&&Pr(e,null,t,"unmounted")}),i)}};const $=e=>{const{type:t,el:i,anchor:r,transition:n}=e;if(t===Ss){if(!!({}.NODE_ENV!=="production")&&e.patchFlag>0&&e.patchFlag&2048&&n&&!n.persisted){e.children.forEach((e=>{if(e.type===ys){a(e.el)}else{$(e)}}))}else{z(i,r)}return}if(t===Cs){E(e);return}const s=()=>{a(i);if(n&&!n.persisted&&n.afterLeave){n.afterLeave()}};if(e.shapeFlag&1&&n&&!n.persisted){const{leave:t,delayLeave:r}=n;const o=()=>t(i,s);if(r){r(e.el,s,o)}else{o()}}else{s()}};const z=(e,t)=>{let i;while(e!==t){i=g(e);a(e);e=i}a(t)};const J=(e,t,i)=>{if(!!({}.NODE_ENV!=="production")&&e.type.__hmrId){Mi(e)}const{bum:r,scope:n,update:s,subTree:o,um:a}=e;if(r){L(r)}n.stop();if(s){s.active=false;G(o,e,t,i)}if(a){us(a,t)}us((()=>{e.isUnmounted=true}),t);if(t&&t.pendingBranch&&!t.isUnmounted&&e.asyncDep&&!e.asyncResolved&&e.suspenseId===t.pendingId){t.deps--;if(t.deps===0){t.resolve()}}if(!!({}.NODE_ENV!=="production")||false){$i(e)}};const q=(e,t,i,r=false,n=false,s=0)=>{for(let o=s;o<e.length;o++){G(e[o],t,i,r,n)}};const K=e=>{if(e.shapeFlag&6){return K(e.component.subTree)}if(e.shapeFlag&128){return e.suspense.next()}return g(e.anchor||e.el)};const X=(e,t,i)=>{if(e==null){if(t._vnode){G(t._vnode,null,null,true)}}else{S(t._vnode||null,e,t,null,null,null,i)}bi();yi();t._vnode=e};const Q={p:S,um:G,m:Y,r:$,mt:k,mc:M,pc:B,pbc:R,n:K,o:e};let Z;let ee;if(n){[Z,ee]=n(Q)}return{render:X,hydrate:Z,createApp:Mn(X,Z)}}function ps({effect:e,update:t},i){e.allowRecurse=t.allowRecurse=i}function gs(e,t,i=false){const r=e.children;const n=t.children;if(h(r)&&h(n)){for(let e=0;e<r.length;e++){const t=r[e];let s=n[e];if(s.shapeFlag&1&&!s.dynamicChildren){if(s.patchFlag<=0||s.patchFlag===32){s=n[e]=$s(n[e]);s.el=t.el}if(!i)gs(t,s)}if(s.type===bs){s.el=t.el}if(!!({}.NODE_ENV!=="production")&&s.type===ys&&!s.el){s.el=t.el}}}}function ms(e){const t=e.slice();const i=[0];let r,n,s,o,a;const c=e.length;for(r=0;r<c;r++){const c=e[r];if(c!==0){n=i[i.length-1];if(e[n]<c){t[r]=n;i.push(r);continue}s=0;o=i.length-1;while(s<o){a=s+o>>1;if(e[i[a]]<c){s=a+1}else{o=a}}if(c<e[i[s]]){if(s>0){t[r]=i[s-1]}i[s]=r}}}s=i.length;o=i[s-1];while(s-- >0){i[s]=o;o=t[o]}return i}const vs=e=>e.__isTeleport;const Ss=Symbol.for("v-fgt");const bs=Symbol.for("v-txt");const ys=Symbol.for("v-cmt");const Cs=Symbol.for("v-stc");const ws=[];let _s=null;function Es(e=false){ws.push(_s=e?null:[])}function Ts(){ws.pop();_s=ws[ws.length-1]||null}let Is=1;function Ps(e){Is+=e}function As(e){e.dynamicChildren=Is>0?_s||i:null;Ts();if(Is>0&&_s){_s.push(e)}return e}function Ms(e,t,i,r,n,s){return As(Fs(e,t,i,r,n,s,true))}function Ds(e,t,i,r,n){return As(Us(e,t,i,r,n,true))}function Rs(e){return e?e.__v_isVNode===true:false}function Os(e,t){if(!!({}.NODE_ENV!=="production")&&t.shapeFlag&6&&Ii.has(t.type)){e.shapeFlag&=~256;t.shapeFlag&=~512;return false}return e.type===t.type&&e.key===t.key}const Ns=(...e)=>js(...e);const xs=`__vInternal`;const Ls=({key:e})=>e!=null?e:null;const ks=({ref:e,ref_key:t,ref_for:i})=>{if(typeof e==="number"){e=""+e}return e!=null?m(e)||Ft(e)||g(e)?{i:tr,r:e,k:t,f:!!i}:e:null};function Fs(e,t=null,i=null,r=0,n=null,s=(e===Ss?0:1),o=false,a=false){const c={__v_isVNode:true,__v_skip:true,type:e,props:t,key:t&&Ls(t),ref:t&&ks(t),scopeId:ir,slotScopeIds:null,children:i,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:s,patchFlag:r,dynamicProps:n,dynamicChildren:null,appContext:null,ctx:tr};if(a){zs(c,i);if(s&128){e.normalize(c)}}else if(i){c.shapeFlag|=m(i)?8:16}if(!!({}.NODE_ENV!=="production")&&c.key!==c.key){$t(`VNode created with invalid key (NaN). VNode type:`,c.type)}if(Is>0&&!o&&_s&&(c.patchFlag>0||s&6)&&c.patchFlag!==32){_s.push(c)}return c}const Us=!!({}.NODE_ENV!=="production")?Ns:js;function js(e,t=null,i=null,r=0,n=null,s=false){if(!e||e===qr){if(!!({}.NODE_ENV!=="production")&&!e){$t(`Invalid vnode type when creating vnode: ${e}.`)}e=ys}if(Rs(e)){const r=Bs(e,t,true);if(i){zs(r,i)}if(Is>0&&!s&&_s){if(r.shapeFlag&6){_s[_s.indexOf(e)]=r}else{_s.push(r)}}r.patchFlag|=-2;return r}if(Eo(e)){e=e.__vccOpts}if(t){t=Ws(t);let{class:e,style:i}=t;if(e&&!m(e)){t.class=z(e)}if(S(i)){if(Dt(i)&&!h(i)){i=c({},i)}t.style=B(i)}}const o=m(e)?1:Sr(e)?128:vs(e)?64:S(e)?4:g(e)?2:0;if(!!({}.NODE_ENV!=="production")&&o&4&&Dt(e)){e=Rt(e);$t(`Vue received a Component which was made a reactive object. This can lead to unnecessary performance overhead, and should be avoided by marking the component with \`markRaw\` or using \`shallowRef\` instead of \`ref\`.`,`\nComponent that was made reactive: `,e)}return Fs(e,t,i,r,n,o,s,true)}function Ws(e){if(!e)return null;return Dt(e)||xs in e?c({},e):e}function Bs(e,t,i=false){const{props:r,ref:n,patchFlag:s,children:o}=e;const a=t?Js(r||{},t):r;const c={__v_isVNode:true,__v_skip:true,type:e.type,props:a,key:a&&Ls(a),ref:t&&t.ref?i&&n?h(n)?n.concat(ks(t)):[n,ks(t)]:ks(t):n,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:!!({}.NODE_ENV!=="production")&&s===-1&&h(o)?o.map(Hs):o,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==Ss?s===-1?16:s|16:s,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Bs(e.ssContent),ssFallback:e.ssFallback&&Bs(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return c}function Hs(e){const t=Bs(e);if(h(e.children)){t.children=e.children.map(Hs)}return t}function Vs(e=" ",t=0){return Us(bs,null,e,t)}function Ys(e="",t=false){return t?(Es(),Ds(ys,null,e)):Us(ys,null,e)}function Gs(e){if(e==null||typeof e==="boolean"){return Us(ys)}else if(h(e)){return Us(Ss,null,e.slice())}else if(typeof e==="object"){return $s(e)}else{return Us(bs,null,String(e))}}function $s(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:Bs(e)}function zs(e,t){let i=0;const{shapeFlag:r}=e;if(t==null){t=null}else if(h(t)){i=16}else if(typeof t==="object"){if(r&(1|64)){const i=t.default;if(i){i._c&&(i._d=false);zs(e,i());i._c&&(i._d=true)}return}else{i=32;const r=t._;if(!r&&!(xs in t)){t._ctx=tr}else if(r===3&&tr){if(tr.slots._===1){t._=1}else{t._=2;e.patchFlag|=1024}}}}else if(g(t)){t={default:t,_ctx:tr};i=32}else{t=String(t);if(r&64){i=16;t=[Vs(t)]}else{i=8}}e.children=t;e.shapeFlag|=i}function Js(...e){const t={};for(let i=0;i<e.length;i++){const r=e[i];for(const e in r){if(e==="class"){if(t.class!==r.class){t.class=z([t.class,r.class])}}else if(e==="style"){t.style=B([t.style,r.style])}else if(o(e)){const i=t[e];const n=r[e];if(n&&i!==n&&!(h(i)&&i.includes(n))){t[e]=i?[].concat(i,n):n}}else if(e!==""){t[e]=r[e]}}}return t}function qs(e,t,i,r=null){ei(e,t,7,[i,r])}const Ks=Pn();let Xs=0;function Qs(e,i,r){const n=e.type;const s=(i?i.appContext:e.appContext)||Ks;const o={uid:Xs++,vnode:e,type:n,parent:i,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,scope:new te(true),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:i?i.provides:Object.create(s.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Un(n,s),emitsOptions:Zi(n,s),emit:null,emitted:null,propsDefaults:t,inheritAttrs:n.inheritAttrs,ctx:t,data:t,props:t,attrs:t,slots:t,refs:t,setupState:t,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:r,suspenseId:r?r.pendingId:0,asyncDep:null,asyncResolved:false,isMounted:false,isUnmounted:false,isDeactivated:false,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};if(!!({}.NODE_ENV!=="production")){o.ctx=an(o)}else{o.ctx={_:o}}o.root=i?i.root:o;o.emit=Qi.bind(null,o);if(e.ce){e.ce(o)}return o}let Zs=null;let eo;let to;let io="__VUE_INSTANCE_SETTERS__";{if(!(to=W()[io])){to=W()[io]=[]}to.push((e=>Zs=e));eo=e=>{if(to.length>1){to.forEach((t=>t(e)))}else{to[0](e)}}}const ro=e=>{eo(e);e.scope.on()};const no=()=>{Zs&&Zs.scope.off();eo(null)};const so=e("slot,component");function oo(e,t){const i=t.isNativeTag||n;if(so(e)||i(e)){$t("Do not use built-in or reserved HTML elements as component id: "+e)}}function ao(e){return e.vnode.shapeFlag&4}let co=false;function lo(e,t=false){co=t;const{props:i,children:r}=e.vnode;const n=ao(e);Nn(e,i,n,t);is(e,r);const s=n?uo(e,t):void 0;co=false;return s}function uo(e,t){var i;const r=e.type;if(!!({}.NODE_ENV!=="production")){if(r.name){oo(r.name,e.appContext.config)}if(r.components){const t=Object.keys(r.components);for(let i=0;i<t.length;i++){oo(t[i],e.appContext.config)}}if(r.directives){const e=Object.keys(r.directives);for(let t=0;t<e.length;t++){Ir(e[t])}}if(r.compilerOptions&&po()){$t(`"compilerOptions" is only supported when using a build of Vue that includes the runtime compiler. Since you are using a runtime-only build, the options should be passed via your build tool config instead.`)}}e.accessCache=Object.create(null);e.proxy=Ot(new Proxy(e.ctx,on));if(!!({}.NODE_ENV!=="production")){cn(e)}const{setup:n}=r;if(n){const s=e.setupContext=n.length>1?So(e):null;ro(e);ye();const o=Zt(n,e,0,[!!({}.NODE_ENV!=="production")?Tt(e.props):e.props,s]);Ce();no();if(b(o)){o.then(no,no);if(t){return o.then((i=>{ho(e,i,t)})).catch((t=>{ti(t,e,0)}))}else{e.asyncDep=o;if(!!({}.NODE_ENV!=="production")&&!e.suspense){const e=(i=r.name)!=null?i:"Anonymous";$t(`Component <${e}>: setup function returned a promise, but no <Suspense> boundary was found in the parent component tree. A component with async setup() must be nested in a <Suspense> in order to be rendered.`)}}}else{ho(e,o,t)}}else{go(e,t)}}function ho(e,t,i){if(g(t)){if(e.type.__ssrInlineRender){e.ssrRender=t}else{e.render=t}}else if(S(t)){if(!!({}.NODE_ENV!=="production")&&Rs(t)){$t(`setup() should not return VNodes directly - return a render function instead.`)}if(!!({}.NODE_ENV!=="production")||false){e.devtoolsRawSetupState=t}e.setupState=Wt(t);if(!!({}.NODE_ENV!=="production")){ln(e)}}else if(!!({}.NODE_ENV!=="production")&&t!==void 0){$t(`setup() should return an object. Received: ${t===null?"null":typeof t}`)}go(e,i)}let fo;const po=()=>!fo;function go(e,t,i){const n=e.type;if(!e.render){if(!t&&fo&&!n.render){const t=n.template||vn(e).template;if(t){if(!!({}.NODE_ENV!=="production")){as(e,`compile`)}const{isCustomElement:i,compilerOptions:r}=e.appContext.config;const{delimiters:s,compilerOptions:o}=n;const a=c(c({isCustomElement:i,delimiters:s},r),o);n.render=fo(t,a);if(!!({}.NODE_ENV!=="production")){cs(e,`compile`)}}}e.render=n.render||r}{ro(e);ye();fn(e);Ce();no()}if(!!({}.NODE_ENV!=="production")&&!n.render&&e.render===r&&!t){if(n.template){$t(`Component provided template option but runtime compilation is not supported in this build of Vue. Configure your bundler to alias "vue" to "vue/dist/vue.esm-bundler.js".`)}else{$t(`Component is missing template or render function.`)}}}function mo(e){return e.attrsProxy||(e.attrsProxy=new Proxy(e.attrs,!!({}.NODE_ENV!=="production")?{get(t,i){cr();we(e,"get","$attrs");return t[i]},set(){$t(`setupContext.attrs is readonly.`);return false},deleteProperty(){$t(`setupContext.attrs is readonly.`);return false}}:{get(t,i){we(e,"get","$attrs");return t[i]}}))}function vo(e){return e.slotsProxy||(e.slotsProxy=new Proxy(e.slots,{get(t,i){we(e,"get","$slots");return t[i]}}))}function So(e){const t=t=>{if(!!({}.NODE_ENV!=="production")){if(e.exposed){$t(`expose() should be called only once per setup().`)}if(t!=null){let e=typeof t;if(e==="object"){if(h(t)){e="array"}else if(Ft(t)){e="ref"}}if(e!=="object"){$t(`expose() should be passed a plain object, received ${e}.`)}}}e.exposed=t||{}};if(!!({}.NODE_ENV!=="production")){return Object.freeze({get attrs(){return mo(e)},get slots(){return vo(e)},get emit(){return(t,...i)=>e.emit(t,...i)},expose:t})}else{return{get attrs(){return mo(e)},slots:e.slots,emit:e.emit,expose:t}}}function bo(e){if(e.exposed){return e.exposeProxy||(e.exposeProxy=new Proxy(Wt(Ot(e.exposed)),{get(t,i){if(i in t){return t[i]}else if(i in rn){return rn[i](e)}},has(e,t){return t in e||t in rn}}))}}const yo=/(?:^|[-_])(\w)/g;const Co=e=>e.replace(yo,(e=>e.toUpperCase())).replace(/[-_]/g,"");function wo(e,t=true){return g(e)?e.displayName||e.name:e.name||t&&e.__name}function _o(e,t,i=false){let r=wo(t);if(!r&&t.__file){const e=t.__file.match(/([^/\\]+)\.\w+$/);if(e){r=e[1]}}if(!r&&e&&e.parent){const i=e=>{for(const i in e){if(e[i]===t){return i}}};r=i(e.components||e.parent.type.components)||i(e.appContext.components)}return r?Co(r):i?`App`:`Anonymous`}function Eo(e){return g(e)&&"__vccOpts"in e}const To=(e,t)=>Ht(e,t,co);const Io=Symbol.for("v-scx");const Po=()=>{{const e=On(Io);if(!e){!!({}.NODE_ENV!=="production")&&$t(`Server rendering context not provided. Make sure to only call useSSRContext() conditionally in the server build.`)}return e}};function Ao(e){return!!(e&&e["__v_isShallow"])}function Mo(){if(!!!({}.NODE_ENV!=="production")||typeof window==="undefined"){return}const e={style:"color:#3ba776"};const i={style:"color:#0b1bc9"};const r={style:"color:#b62e24"};const n={style:"color:#9d288c"};const s={header(t){if(!S(t)){return null}if(t.__isVue){return["div",e,`VueInstance`]}else if(Ft(t)){return["div",{},["span",e,f(t)],"<",l(t.value),`>`]}else if(Pt(t)){return["div",{},["span",e,Ao(t)?"ShallowReactive":"Reactive"],"<",l(t),`>${At(t)?` (readonly)`:``}`]}else if(At(t)){return["div",{},["span",e,Ao(t)?"ShallowReadonly":"Readonly"],"<",l(t),">"]}return null},hasBody(e){return e&&e.__isVue},body(e){if(e&&e.__isVue){return["div",{},...o(e.$)]}}};function o(e){const i=[];if(e.type.props&&e.props){i.push(a("props",Rt(e.props)))}if(e.setupState!==t){i.push(a("setup",e.setupState))}if(e.data!==t){i.push(a("data",Rt(e.data)))}const r=d(e,"computed");if(r){i.push(a("computed",r))}const s=d(e,"inject");if(s){i.push(a("injected",s))}i.push(["div",{},["span",{style:n.style+";opacity:0.66"},"$ (internal): "],["object",{object:e}]]);return i}function a(e,t){t=c({},t);if(!Object.keys(t).length){return["span",{}]}return["div",{style:"line-height:1.25em;margin-bottom:0.6em"},["div",{style:"color:#476582"},e],["div",{style:"padding-left:1.25em"},...Object.keys(t).map((e=>["div",{},["span",n,e+": "],l(t[e],false)]))]]}function l(e,t=true){if(typeof e==="number"){return["span",i,e]}else if(typeof e==="string"){return["span",r,JSON.stringify(e)]}else if(typeof e==="boolean"){return["span",n,e]}else if(S(e)){return["object",{object:t?Rt(e):e}]}else{return["span",r,String(e)]}}function d(e,t){const i=e.type;if(g(i)){return}const r={};for(const n in e.ctx){if(u(i,n,t)){r[n]=e.ctx[n]}}return r}function u(e,t,i){const r=e[i];if(h(r)&&r.includes(t)||S(r)&&t in r){return true}if(e.extends&&u(e.extends,t,i)){return true}if(e.mixins&&e.mixins.some((e=>u(e,t,i)))){return true}}function f(e){if(Ao(e)){return`ShallowRef`}if(e.effect){return`ComputedRef`}return`Ref`}if(window.devtoolsFormatters){window.devtoolsFormatters.push(s)}else{window.devtoolsFormatters=[s]}}const Do="3.3.4";const Ro="http://www.w3.org/2000/svg";const Oo=typeof document!=="undefined"?document:null;const No=Oo&&Oo.createElement("template");const xo={insert:(e,t,i)=>{t.insertBefore(e,i||null)},remove:e=>{const t=e.parentNode;if(t){t.removeChild(e)}},createElement:(e,t,i,r)=>{const n=t?Oo.createElementNS(Ro,e):Oo.createElement(e,i?{is:i}:void 0);if(e==="select"&&r&&r.multiple!=null){n.setAttribute("multiple",r.multiple)}return n},createText:e=>Oo.createTextNode(e),createComment:e=>Oo.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>Oo.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,i,r,n,s){const o=i?i.previousSibling:t.lastChild;if(n&&(n===s||n.nextSibling)){while(true){t.insertBefore(n.cloneNode(true),i);if(n===s||!(n=n.nextSibling))break}}else{No.innerHTML=r?`<svg>${e}</svg>`:e;const n=No.content;if(r){const e=n.firstChild;while(e.firstChild){n.appendChild(e.firstChild)}n.removeChild(e)}t.insertBefore(n,i)}return[o?o.nextSibling:t.firstChild,i?i.previousSibling:t.lastChild]}};function Lo(e,t,i){const r=e._vtc;if(r){t=(t?[t,...r]:[...r]).join(" ")}if(t==null){e.removeAttribute("class")}else if(i){e.setAttribute("class",t)}else{e.className=t}}function ko(e,t,i){const r=e.style;const n=m(i);if(i&&!n){if(t&&!m(t)){for(const e in t){if(i[e]==null){jo(r,e,"")}}}for(const e in i){jo(r,e,i[e])}}else{const s=r.display;if(n){if(t!==i){r.cssText=i}}else if(t){e.removeAttribute("style")}if("_vod"in e){r.display=s}}}const Fo=/[^\\];\s*$/;const Uo=/\s*!important$/;function jo(e,t,i){if(h(i)){i.forEach((i=>jo(e,t,i)))}else{if(i==null)i="";if(!!({}.NODE_ENV!=="production")){if(Fo.test(i)){$t(`Unexpected semicolon at the end of '${t}' style value: '${i}'`)}}if(t.startsWith("--")){e.setProperty(t,i)}else{const r=Ho(e,t);if(Uo.test(i)){e.setProperty(R(r),i.replace(Uo,""),"important")}else{e[r]=i}}}}const Wo=["Webkit","Moz","ms"];const Bo={};function Ho(e,t){const i=Bo[t];if(i){return i}let r=M(t);if(r!=="filter"&&r in e){return Bo[t]=r}r=O(r);for(let n=0;n<Wo.length;n++){const i=Wo[n]+r;if(i in e){return Bo[t]=i}}return t}const Vo="http://www.w3.org/1999/xlink";function Yo(e,t,i,r,n){if(r&&t.startsWith("xlink:")){if(i==null){e.removeAttributeNS(Vo,t.slice(6,t.length))}else{e.setAttributeNS(Vo,t,i)}}else{const r=q(t);if(i==null||r&&!K(i)){e.removeAttribute(t)}else{e.setAttribute(t,r?"":i)}}}function Go(e,t,i,r,n,s,o){if(t==="innerHTML"||t==="textContent"){if(r){o(r,n,s)}e[t]=i==null?"":i;return}const a=e.tagName;if(t==="value"&&a!=="PROGRESS"&&!a.includes("-")){e._value=i;const r=a==="OPTION"?e.getAttribute("value"):e.value;const n=i==null?"":i;if(r!==n){e.value=n}if(i==null){e.removeAttribute(t)}return}let c=false;if(i===""||i==null){const r=typeof e[t];if(r==="boolean"){i=K(i)}else if(i==null&&r==="string"){i="";c=true}else if(r==="number"){i=0;c=true}}try{e[t]=i}catch(l){if(!!({}.NODE_ENV!=="production")&&!c){$t(`Failed setting prop "${t}" on <${a.toLowerCase()}>: value ${i} is invalid.`,l)}}c&&e.removeAttribute(t)}function $o(e,t,i,r){e.addEventListener(t,i,r)}function zo(e,t,i,r){e.removeEventListener(t,i,r)}function Jo(e,t,i,r,n=null){const s=e._vei||(e._vei={});const o=s[t];if(r&&o){o.value=r}else{const[i,a]=Ko(t);if(r){const o=s[t]=ea(r,n);$o(e,i,o,a)}else if(o){zo(e,i,o,a);s[t]=void 0}}}const qo=/(?:Once|Passive|Capture)$/;function Ko(e){let t;if(qo.test(e)){t={};let i;while(i=e.match(qo)){e=e.slice(0,e.length-i[0].length);t[i[0].toLowerCase()]=true}}const i=e[2]===":"?e.slice(3):R(e.slice(2));return[i,t]}let Xo=0;const Qo=Promise.resolve();const Zo=()=>Xo||(Qo.then((()=>Xo=0)),Xo=Date.now());function ea(e,t){const i=e=>{if(!e._vts){e._vts=Date.now()}else if(e._vts<=i.attached){return}ei(ta(e,i.value),t,5,[e])};i.value=e;i.attached=Zo();return i}function ta(e,t){if(h(t)){const i=e.stopImmediatePropagation;e.stopImmediatePropagation=()=>{i.call(e);e._stopped=true};return t.map((e=>t=>!t._stopped&&e&&e(t)))}else{return t}}const ia=/^on[a-z]/;const ra=(e,t,i,r,n=false,s,c,l,d)=>{if(t==="class"){Lo(e,r,n)}else if(t==="style"){ko(e,i,r)}else if(o(t)){if(!a(t)){Jo(e,t,i,r,c)}}else if(t[0]==="."?(t=t.slice(1),true):t[0]==="^"?(t=t.slice(1),false):na(e,t,r,n)){Go(e,t,r,s,c,l,d)}else{if(t==="true-value"){e._trueValue=r}else if(t==="false-value"){e._falseValue=r}Yo(e,t,r,n)}};function na(e,t,i,r){if(r){if(t==="innerHTML"||t==="textContent"){return true}if(t in e&&ia.test(t)&&g(i)){return true}return false}if(t==="spellcheck"||t==="draggable"||t==="translate"){return false}if(t==="form"){return false}if(t==="list"&&e.tagName==="INPUT"){return false}if(t==="type"&&e.tagName==="TEXTAREA"){return false}if(ia.test(t)&&m(i)){return false}return t in e}function sa(e,t){const i=Ar(e);class r extends aa{constructor(e){super(i,e,t)}}r.def=i;return r}const oa=typeof HTMLElement!=="undefined"?HTMLElement:class{};class aa extends oa{constructor(e,t={},i){super();this._def=e;this._props=t;this._instance=null;this._connected=false;this._resolved=false;this._numberProps=null;if(this.shadowRoot&&i){i(this._createVNode(),this.shadowRoot)}else{if(!!({}.NODE_ENV!=="production")&&this.shadowRoot){$t(`Custom element has pre-rendered declarative shadow root but is not defined as hydratable. Use \`defineSSRCustomElement\`.`)}this.attachShadow({mode:"open"});if(!this._def.__asyncLoader){this._resolveProps(this._def)}}}connectedCallback(){this._connected=true;if(!this._instance){if(this._resolved){this._update()}else{this._resolveDef()}}}disconnectedCallback(){this._connected=false;fi((()=>{if(!this._connected){pa(null,this.shadowRoot);this._instance=null}}))}_resolveDef(){this._resolved=true;for(let i=0;i<this.attributes.length;i++){this._setAttr(this.attributes[i].name)}new MutationObserver((e=>{for(const t of e){this._setAttr(t.attributeName)}})).observe(this,{attributes:true});const e=(e,t=false)=>{const{props:i,styles:r}=e;let n;if(i&&!h(i)){for(const e in i){const t=i[e];if(t===Number||t&&t.type===Number){if(e in this._props){this._props[e]=U(this._props[e])}(n||(n=Object.create(null)))[M(e)]=true}}}this._numberProps=n;if(t){this._resolveProps(e)}this._applyStyles(r);this._update()};const t=this._def.__asyncLoader;if(t){t().then((t=>e(t,true)))}else{e(this._def)}}_resolveProps(e){const{props:t}=e;const i=h(t)?t:Object.keys(t||{});for(const r of Object.keys(this)){if(r[0]!=="_"&&i.includes(r)){this._setProp(r,this[r],true,false)}}for(const r of i.map(M)){Object.defineProperty(this,r,{get(){return this._getProp(r)},set(e){this._setProp(r,e)}})}}_setAttr(e){let t=this.getAttribute(e);const i=M(e);if(this._numberProps&&this._numberProps[i]){t=U(t)}this._setProp(i,t,false)}_getProp(e){return this._props[e]}_setProp(e,t,i=true,r=true){if(t!==this._props[e]){this._props[e]=t;if(r&&this._instance){this._update()}if(i){if(t===true){this.setAttribute(R(e),"")}else if(typeof t==="string"||typeof t==="number"){this.setAttribute(R(e),t+"")}else if(!t){this.removeAttribute(R(e))}}}}_update(){pa(this._createVNode(),this.shadowRoot)}_createVNode(){const e=Us(this._def,c({},this._props));if(!this._instance){e.ce=e=>{this._instance=e;e.isCE=true;if(!!({}.NODE_ENV!=="production")){e.ceReload=e=>{if(this._styles){this._styles.forEach((e=>this.shadowRoot.removeChild(e)));this._styles.length=0}this._applyStyles(e);this._instance=null;this._update()}}const t=(e,t)=>{this.dispatchEvent(new CustomEvent(e,{detail:t}))};e.emit=(e,...i)=>{t(e,i);if(R(e)!==e){t(R(e),i)}};let i=this;while(i=i&&(i.parentNode||i.host)){if(i instanceof aa){e.parent=i._instance;e.provides=i._instance.provides;break}}}}return e}_applyStyles(e){if(e){e.forEach((e=>{const t=document.createElement("style");t.textContent=e;this.shadowRoot.appendChild(t);if(!!({}.NODE_ENV!=="production")){(this._styles||(this._styles=[])).push(t)}}))}}}const ca=["ctrl","shift","alt","meta"];const la={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&e.button!==0,middle:e=>"button"in e&&e.button!==1,right:e=>"button"in e&&e.button!==2,exact:(e,t)=>ca.some((i=>e[`${i}Key`]&&!t.includes(i)))};const da=(e,t)=>(i,...r)=>{for(let e=0;e<t.length;e++){const r=la[t[e]];if(r&&r(i,t))return}return e(i,...r)};const ua=c({patchProp:ra},xo);let ha;function fa(){return ha||(ha=hs(ua))}const pa=(...e)=>{fa().render(...e)};function ga(){{Mo()}}if(!!({}.NODE_ENV!=="production")){ga()}const ma={state:wt({editMessage:null}),setState(e,t){this.state[e]=t}};function va(e){const t={};e.forEach((e=>{t[e]=function(){return ma.state[e]}}));return t}const Sa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAfCAMAAACxiD++AAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAtUExURUxpcf///////////////////////////////////////////////////////3EAnbYAAAAOdFJOUwADZ66SoQjEhnS7/gsNGQL7+wAAAKtJREFUKM+F01sOhCAQRNESFV/I/pc70Og0YJfyJbmHhBAbGGYHstw8IPV4EOGOmERYIhGpxyUAJxHSz/xlC+1FxE64qB1yj1ZID7oXsel+63ovnj2JXUXue+hvrcLugL+EdG+9XBG8X+Kl34J3YM1g/egvIvdx5EK691RIz78YEXdnQrst6m6JqemXmNo+D/WJNAyVePZWWL0WdlfB+l+UAQQReaAc65DB/wGsZgzLN0IQWAAAAABJRU5ErkJggg==";const ba=".sc-header[data-v-396683d7]{min-height:40px;border-top-left-radius:9px;border-top-right-radius:9px;padding:10px;box-shadow:0 1px 4px #0003;position:relative;box-sizing:border-box;display:flex}.sc-header--img[data-v-396683d7]{border-radius:50%;align-self:center;padding:10px}.sc-header--title[data-v-396683d7]{align-self:center;padding:10px;flex:1;-webkit-user-select:none;user-select:none;font-size:20px}.sc-header--title.enabled[data-v-396683d7]{cursor:pointer;border-radius:5px}.sc-header--title.enabled[data-v-396683d7]:hover{box-shadow:0 2px 5px #0000011a}.sc-header--close-button[data-v-396683d7]{width:40px;align-self:center;height:40px;margin-right:10px;box-sizing:border-box;cursor:pointer;border-radius:5px;margin-left:auto}.sc-header--close-button[data-v-396683d7]:hover{box-shadow:0 2px 5px #0000011a}.sc-header--close-button img[data-v-396683d7]{width:100%;height:100%;padding:13px;box-sizing:border-box}@media (max-width: 450px){.sc-header[data-v-396683d7]{border-radius:0}}\n";const ya=(e,t)=>{const i=e.__vccOpts||e;for(const[r,n]of t){i[r]=n}return i};const Ca={props:{icons:{type:Object,default:function(){return{close:{img:Sa,name:"default"}}}},colors:{type:Object,required:true},onUserInitiateCall:{type:Function,required:true},onUserReleaseCall:{type:Function,required:true},isCallAuthorized:{type:Boolean,required:true},isCallEstablished:{type:Boolean,required:true}},data(){return{}},computed:{...va(["titleImageUrl"])},methods:{}};const wa=["src"];const _a=["src"];function Ea(e,t,i,r,n,s){return Es(),Ms("div",{class:"sc-header",style:B({background:i.colors.header.bg,color:i.colors.header.text})},[i.isCallAuthorized&&!i.isCallEstablished?(Es(),Ms("span",{key:0,onClick:t[0]||(t[0]=e=>i.onUserInitiateCall())},[Fs("img",{src:"./assets/call.svg",height:"30"},null,8,wa)])):Ys("",true),i.isCallAuthorized&&i.isCallEstablished?(Es(),Ms("span",{key:1,onClick:t[1]||(t[1]=e=>i.onUserReleaseCall())},[Fs("img",{src:"./assets/release.svg",height:"30"},null,8,_a)])):Ys("",true)],4)}const Ta=ya(Ca,[["render",Ea],["styles",[ba]],["__scopeId","data-v-396683d7"]]);const Ia="svg[data-v-8e316579]{display:inline-block;vertical-align:baseline;margin-bottom:-2px}\n";const Pa={props:{iconName:{type:String,default:"box"},width:{type:[Number,String],default:18},height:{type:[Number,String],default:18},iconColor:{type:String,default:"currentColor"}}};const Aa=["width","height","aria-labelledby"];const Ma=["id"];const Da=["fill"];function Ra(e,t,i,r,n,s){return Es(),Ms("svg",{xmlns:"http://www.w3.org/2000/svg",width:i.width,height:i.height,viewBox:"0 0 18 18","aria-labelledby":i.iconName,role:"presentation"},[Fs("title",{id:i.iconName,lang:"en"},X(i.iconName),9,Ma),Fs("g",{fill:i.iconColor},[Zr(e.$slots,"default",{},void 0,true)],8,Da)],8,Aa)}const Oa=ya(Pa,[["render",Ra],["styles",[Ia]],["__scopeId","data-v-8e316579"]]);const Na={};const xa={d:"M19.404,6.65l-5.998-5.996c-0.292-0.292-0.765-0.292-1.056,0l-2.22,2.22l-8.311,8.313l-0.003,0.001v0.003l-0.161,0.161c-0.114,0.112-0.187,0.258-0.21,0.417l-1.059,7.051c-0.035,0.233,0.044,0.47,0.21,0.639c0.143,0.14,0.333,0.219,0.528,0.219c0.038,0,0.073-0.003,0.111-0.009l7.054-1.055c0.158-0.025,0.306-0.098,0.417-0.211l8.478-8.476l2.22-2.22C19.695,7.414,19.695,6.941,19.404,6.65z M8.341,16.656l-0.989-0.99l7.258-7.258l0.989,0.99L8.341,16.656z M2.332,15.919l0.411-2.748l4.143,4.143l-2.748,0.41L2.332,15.919z M13.554,7.351L6.296,14.61l-0.849-0.848l7.259-7.258l0.423,0.424L13.554,7.351zM10.658,4.457l0.992,0.99l-7.259,7.258L3.4,11.715L10.658,4.457z M16.656,8.342l-1.517-1.517V6.823h-0.003l-0.951-0.951l-2.471-2.471l1.164-1.164l4.942,4.94L16.656,8.342z"};function La(e,t){return Es(),Ms("path",xa)}const ka=ya(Na,[["render",La]]);const Fa={};const Ua={d:"M15.898,4.045c-0.271-0.272-0.713-0.272-0.986,0l-4.71,4.711L5.493,4.045c-0.272-0.272-0.714-0.272-0.986,0s-0.272,0.714,0,0.986l4.709,4.711l-4.71,4.711c-0.272,0.271-0.272,0.713,0,0.986c0.136,0.136,0.314,0.203,0.492,0.203c0.179,0,0.357-0.067,0.493-0.203l4.711-4.711l4.71,4.711c0.137,0.136,0.314,0.203,0.494,0.203c0.178,0,0.355-0.067,0.492-0.203c0.273-0.273,0.273-0.715,0-0.986l-4.711-4.711l4.711-4.711C16.172,4.759,16.172,4.317,15.898,4.045z"};function ja(e,t){return Es(),Ms("path",Ua)}const Wa=ya(Fa,[["render",ja]]);var Ba="4.0.0";function Ha(e){return e===void 0}function Va(e){return typeof e==="boolean"}function Ya(e,t){for(var i in t){if(t.hasOwnProperty(i)&&Ha(e[i])){e[i]=t[i]}}return e}function Ga(e,t,i){var r;if(e.length>t){if(i==null){i="&hellip;";r=3}else{r=i.length}e=e.substring(0,t-r)+i}return e}function $a(e,t){for(var i=e.length-1;i>=0;i--){if(e[i]===t){e.splice(i,1)}}}function za(e,t){for(var i=e.length-1;i>=0;i--){if(t(e[i])===true){e.splice(i,1)}}}function Ja(e){throw new Error("Unhandled case for value: '".concat(e,"'"))}var qa=/[A-Za-z]/;var Ka=/[\d]/;var Xa=/\s/;var Qa=/['"]/;var Za=/[\x00-\x1F\x7F]/;var ec=/A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC/.source;var tc=/\u2700-\u27bf\udde6-\uddff\ud800-\udbff\udc00-\udfff\ufe0e\ufe0f\u0300-\u036f\ufe20-\ufe23\u20d0-\u20f0\ud83c\udffb-\udfff\u200d\u3299\u3297\u303d\u3030\u24c2\ud83c\udd70-\udd71\udd7e-\udd7f\udd8e\udd91-\udd9a\udde6-\uddff\ude01-\ude02\ude1a\ude2f\ude32-\ude3a\ude50-\ude51\u203c\u2049\u25aa-\u25ab\u25b6\u25c0\u25fb-\u25fe\u00a9\u00ae\u2122\u2139\udc04\u2600-\u26FF\u2b05\u2b06\u2b07\u2b1b\u2b1c\u2b50\u2b55\u231a\u231b\u2328\u23cf\u23e9-\u23f3\u23f8-\u23fa\udccf\u2935\u2934\u2190-\u21ff/.source;var ic=/\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D4-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C03\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D01-\u0D03\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF5\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F/.source;var rc=ec+tc+ic;var nc=/0-9\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0BE6-\u0BEF\u0C66-\u0C6F\u0CE6-\u0CEF\u0D66-\u0D6F\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F29\u1040-\u1049\u1090-\u1099\u17E0-\u17E9\u1810-\u1819\u1946-\u194F\u19D0-\u19D9\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\uA620-\uA629\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19/.source;var sc=rc+nc;var oc=new RegExp("[".concat(sc,"]"));var ac=function(){function e(e){if(e===void 0){e={}}this.tagName="";this.attrs={};this.innerHTML="";this.tagName=e.tagName||"";this.attrs=e.attrs||{};this.innerHTML=e.innerHtml||e.innerHTML||""}e.prototype.setTagName=function(e){this.tagName=e;return this};e.prototype.getTagName=function(){return this.tagName||""};e.prototype.setAttr=function(e,t){var i=this.getAttrs();i[e]=t;return this};e.prototype.getAttr=function(e){return this.getAttrs()[e]};e.prototype.setAttrs=function(e){Object.assign(this.getAttrs(),e);return this};e.prototype.getAttrs=function(){return this.attrs||(this.attrs={})};e.prototype.setClass=function(e){return this.setAttr("class",e)};e.prototype.addClass=function(e){var t=this.getClass(),i=!t?[]:t.split(Xa),r=e.split(Xa),n;while(n=r.shift()){if(i.indexOf(n)===-1){i.push(n)}}this.getAttrs()["class"]=i.join(" ");return this};e.prototype.removeClass=function(e){var t=this.getClass(),i=!t?[]:t.split(Xa),r=e.split(Xa),n;while(i.length&&(n=r.shift())){var s=i.indexOf(n);if(s!==-1){i.splice(s,1)}}this.getAttrs()["class"]=i.join(" ");return this};e.prototype.getClass=function(){return this.getAttrs()["class"]||""};e.prototype.hasClass=function(e){return(" "+this.getClass()+" ").indexOf(" "+e+" ")!==-1};e.prototype.setInnerHTML=function(e){this.innerHTML=e;return this};e.prototype.setInnerHtml=function(e){return this.setInnerHTML(e)};e.prototype.getInnerHTML=function(){return this.innerHTML||""};e.prototype.getInnerHtml=function(){return this.getInnerHTML()};e.prototype.toAnchorString=function(){var e=this.getTagName(),t=this.buildAttrsStr();t=t?" "+t:"";return["<",e,t,">",this.getInnerHtml(),"</",e,">"].join("")};e.prototype.buildAttrsStr=function(){if(!this.attrs)return"";var e=this.getAttrs(),t=[];for(var i in e){if(e.hasOwnProperty(i)){t.push(i+'="'+e[i]+'"')}}return t.join(" ")};return e}();function cc(e,t,i){var r;var n;if(i==null){i="&hellip;";n=3;r=8}else{n=i.length;r=i.length}var s=function(e){var t={};var i=e;var r=i.match(/^([a-z]+):\/\//i);if(r){t.scheme=r[1];i=i.substr(r[0].length)}r=i.match(/^(.*?)(?=(\?|#|\/|$))/i);if(r){t.host=r[1];i=i.substr(r[0].length)}r=i.match(/^\/(.*?)(?=(\?|#|$))/i);if(r){t.path=r[1];i=i.substr(r[0].length)}r=i.match(/^\?(.*?)(?=(#|$))/i);if(r){t.query=r[1];i=i.substr(r[0].length)}r=i.match(/^#(.*?)$/i);if(r){t.fragment=r[1]}return t};var o=function(e){var t="";if(e.scheme&&e.host){t+=e.scheme+"://"}if(e.host){t+=e.host}if(e.path){t+="/"+e.path}if(e.query){t+="?"+e.query}if(e.fragment){t+="#"+e.fragment}return t};var a=function(e,t){var r=t/2,n=Math.ceil(r),s=-1*Math.floor(r),o="";if(s<0){o=e.substr(s)}return e.substr(0,n)+i+o};if(e.length<=t){return e}var c=t-n;var l=s(e);if(l.query){var d=l.query.match(/^(.*?)(?=(\?|\#))(.*?)$/i);if(d){l.query=l.query.substr(0,d[1].length);e=o(l)}}if(e.length<=t){return e}if(l.host){l.host=l.host.replace(/^www\./,"");e=o(l)}if(e.length<=t){return e}var u="";if(l.host){u+=l.host}if(u.length>=c){if(l.host.length==t){return(l.host.substr(0,t-n)+i).substr(0,c+r)}return a(u,c).substr(0,c+r)}var h="";if(l.path){h+="/"+l.path}if(l.query){h+="?"+l.query}if(h){if((u+h).length>=c){if((u+h).length==t){return(u+h).substr(0,t)}var f=c-u.length;return(u+a(h,f)).substr(0,c+r)}else{u+=h}}if(l.fragment){var p="#"+l.fragment;if((u+p).length>=c){if((u+p).length==t){return(u+p).substr(0,t)}var g=c-u.length;return(u+a(p,g)).substr(0,c+r)}else{u+=p}}if(l.scheme&&l.host){var m=l.scheme+"://";if((u+m).length<c){return(m+u).substr(0,t)}}if(u.length<=t){return u}var v="";if(c>0){v=u.substr(-1*Math.floor(c/2))}return(u.substr(0,Math.ceil(c/2))+i+v).substr(0,c+r)}function lc(e,t,i){if(e.length<=t){return e}var r;var n;if(i==null){i="&hellip;";r=8;n=3}else{r=i.length;n=i.length}var s=t-n;var o="";if(s>0){o=e.substr(-1*Math.floor(s/2))}return(e.substr(0,Math.ceil(s/2))+i+o).substr(0,s+r)}function dc(e,t,i){return Ga(e,t,i)}var uc=function(){function e(e){if(e===void 0){e={}}this.newWindow=false;this.truncate={};this.className="";this.newWindow=e.newWindow||false;this.truncate=e.truncate||{};this.className=e.className||""}e.prototype.build=function(e){return new ac({tagName:"a",attrs:this.createAttrs(e),innerHtml:this.processAnchorText(e.getAnchorText())})};e.prototype.createAttrs=function(e){var t={href:e.getAnchorHref()};var i=this.createCssClass(e);if(i){t["class"]=i}if(this.newWindow){t["target"]="_blank";t["rel"]="noopener noreferrer"}if(this.truncate){if(this.truncate.length&&this.truncate.length<e.getAnchorText().length){t["title"]=e.getAnchorHref()}}return t};e.prototype.createCssClass=function(e){var t=this.className;if(!t){return""}else{var i=[t],r=e.getCssClassSuffixes();for(var n=0,s=r.length;n<s;n++){i.push(t+"-"+r[n])}return i.join(" ")}};e.prototype.processAnchorText=function(e){e=this.doTruncate(e);return e};e.prototype.doTruncate=function(e){var t=this.truncate;if(!t||!t.length)return e;var i=t.length,r=t.location;if(r==="smart"){return cc(e,i)}else if(r==="middle"){return lc(e,i)}else{return dc(e,i)}};return e}();var hc=function(e,t){hc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i))e[i]=t[i]};return hc(e,t)};function fc(e,t){if(typeof t!=="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");hc(e,t);function i(){this.constructor=e}e.prototype=t===null?Object.create(t):(i.prototype=t.prototype,new i)}var pc=function(){pc=Object.assign||function e(t){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var s in i)if(Object.prototype.hasOwnProperty.call(i,s))t[s]=i[s]}return t};return pc.apply(this,arguments)};var gc=function(){function e(e){this._=null;this.matchedText="";this.offset=0;this.tagBuilder=e.tagBuilder;this.matchedText=e.matchedText;this.offset=e.offset}e.prototype.getMatchedText=function(){return this.matchedText};e.prototype.setOffset=function(e){this.offset=e};e.prototype.getOffset=function(){return this.offset};e.prototype.getCssClassSuffixes=function(){return[this.type]};e.prototype.buildTag=function(){return this.tagBuilder.build(this)};return e}();var mc="(?:xn--vermgensberatung-pwb|xn--vermgensberater-ctb|xn--clchc0ea0b2g2a9gcd|xn--w4r85el8fhu5dnra|northwesternmutual|travelersinsurance|vermgensberatung|xn--5su34j936bgsg|xn--bck1b9a5dre4c|xn--mgbah1a3hjkrd|xn--mgbai9azgqp6j|xn--mgberp4a5d4ar|xn--xkc2dl3a5ee0h|vermgensberater|xn--fzys8d69uvgm|xn--mgba7c0bbn0a|xn--mgbcpq6gpa1a|xn--xkc2al3hye2a|americanexpress|kerryproperties|sandvikcoromant|xn--i1b6b1a6a2e|xn--kcrx77d1x4a|xn--lgbbat1ad8j|xn--mgba3a4f16a|xn--mgbaakc7dvf|xn--mgbc0a9azcg|xn--nqv7fs00ema|americanfamily|bananarepublic|cancerresearch|cookingchannel|kerrylogistics|weatherchannel|xn--54b7fta0cc|xn--6qq986b3xl|xn--80aqecdr1a|xn--b4w605ferd|xn--fiq228c5hs|xn--h2breg3eve|xn--jlq480n2rg|xn--jlq61u9w7b|xn--mgba3a3ejt|xn--mgbaam7a8h|xn--mgbayh7gpa|xn--mgbbh1a71e|xn--mgbca7dzdo|xn--mgbi4ecexp|xn--mgbx4cd0ab|xn--rvc1e0am3e|international|lifeinsurance|travelchannel|wolterskluwer|xn--cckwcxetd|xn--eckvdtc9d|xn--fpcrj9c3d|xn--fzc2c9e2c|xn--h2brj9c8c|xn--tiq49xqyj|xn--yfro4i67o|xn--ygbi2ammx|construction|lplfinancial|scholarships|versicherung|xn--3e0b707e|xn--45br5cyl|xn--4dbrk0ce|xn--80adxhks|xn--80asehdb|xn--8y0a063a|xn--gckr3f0f|xn--mgb9awbf|xn--mgbab2bd|xn--mgbgu82a|xn--mgbpl2fh|xn--mgbt3dhd|xn--mk1bu44c|xn--ngbc5azd|xn--ngbe9e0a|xn--ogbpf8fl|xn--qcka1pmc|accountants|barclaycard|blackfriday|blockbuster|bridgestone|calvinklein|contractors|creditunion|engineering|enterprises|foodnetwork|investments|kerryhotels|lamborghini|motorcycles|olayangroup|photography|playstation|productions|progressive|redumbrella|williamhill|xn--11b4c3d|xn--1ck2e1b|xn--1qqw23a|xn--2scrj9c|xn--3bst00m|xn--3ds443g|xn--3hcrj9c|xn--42c2d9a|xn--45brj9c|xn--55qw42g|xn--6frz82g|xn--80ao21a|xn--9krt00a|xn--cck2b3b|xn--czr694b|xn--d1acj3b|xn--efvy88h|xn--fct429k|xn--fjq720a|xn--flw351e|xn--g2xx48c|xn--gecrj9c|xn--gk3at1e|xn--h2brj9c|xn--hxt814e|xn--imr513n|xn--j6w193g|xn--jvr189m|xn--kprw13d|xn--kpry57d|xn--mgbbh1a|xn--mgbtx2b|xn--mix891f|xn--nyqy26a|xn--otu796d|xn--pgbs0dh|xn--q9jyb4c|xn--rhqv96g|xn--rovu88b|xn--s9brj9c|xn--ses554g|xn--t60b56a|xn--vuq861b|xn--w4rs40l|xn--xhq521b|xn--zfr164b||accountant|apartments|associates|basketball|bnpparibas|boehringer|capitalone|consulting|creditcard|cuisinella|eurovision|extraspace|foundation|healthcare|immobilien|industries|management|mitsubishi|nextdirect|properties|protection|prudential|realestate|republican|restaurant|schaeffler|tatamotors|technology|university|vlaanderen|volkswagen|xn--30rr7y|xn--3pxu8k|xn--45q11c|xn--4gbrim|xn--55qx5d|xn--5tzm5g|xn--80aswg|xn--90a3ac|xn--9dbq2a|xn--9et52u|xn--c2br7g|xn--cg4bki|xn--czrs0t|xn--czru2d|xn--fiq64b|xn--fiqs8s|xn--fiqz9s|xn--io0a7i|xn--kput3i|xn--mxtq1m|xn--o3cw4h|xn--pssy2u|xn--q7ce6a|xn--unup4y|xn--wgbh1c|xn--wgbl6a|xn--y9a3aq|accenture|alfaromeo|allfinanz|amsterdam|analytics|aquarelle|barcelona|bloomberg|christmas|community|directory|education|equipment|fairwinds|financial|firestone|fresenius|frontdoor|furniture|goldpoint|hisamitsu|homedepot|homegoods|homesense|institute|insurance|kuokgroup|lancaster|landrover|lifestyle|marketing|marshalls|melbourne|microsoft|panasonic|passagens|pramerica|richardli|shangrila|solutions|statebank|statefarm|stockholm|travelers|vacations|xn--90ais|xn--c1avg|xn--d1alf|xn--e1a4c|xn--fhbei|xn--j1aef|xn--j1amh|xn--l1acc|xn--ngbrx|xn--nqv7f|xn--p1acf|xn--qxa6a|xn--tckwe|xn--vhquv|yodobashi||abudhabi|airforce|allstate|attorney|barclays|barefoot|bargains|baseball|boutique|bradesco|broadway|brussels|builders|business|capetown|catering|catholic|cipriani|cityeats|cleaning|clinique|clothing|commbank|computer|delivery|deloitte|democrat|diamonds|discount|discover|download|engineer|ericsson|etisalat|exchange|feedback|fidelity|firmdale|football|frontier|goodyear|grainger|graphics|guardian|hdfcbank|helsinki|holdings|hospital|infiniti|ipiranga|istanbul|jpmorgan|lighting|lundbeck|marriott|maserati|mckinsey|memorial|merckmsd|mortgage|observer|partners|pharmacy|pictures|plumbing|property|redstone|reliance|saarland|samsclub|security|services|shopping|showtime|softbank|software|stcgroup|supplies|training|vanguard|ventures|verisign|woodside|xn--90ae|xn--node|xn--p1ai|xn--qxam|yokohama||abogado|academy|agakhan|alibaba|android|athleta|auction|audible|auspost|avianca|banamex|bauhaus|bentley|bestbuy|booking|brother|bugatti|capital|caravan|careers|channel|charity|chintai|citadel|clubmed|college|cologne|comcast|company|compare|contact|cooking|corsica|country|coupons|courses|cricket|cruises|dentist|digital|domains|exposed|express|farmers|fashion|ferrari|ferrero|finance|fishing|fitness|flights|florist|flowers|forsale|frogans|fujitsu|gallery|genting|godaddy|grocery|guitars|hamburg|hangout|hitachi|holiday|hosting|hoteles|hotmail|hyundai|ismaili|jewelry|juniper|kitchen|komatsu|lacaixa|lanxess|lasalle|latrobe|leclerc|limited|lincoln|markets|monster|netbank|netflix|network|neustar|okinawa|oldnavy|organic|origins|philips|pioneer|politie|realtor|recipes|rentals|reviews|rexroth|samsung|sandvik|schmidt|schwarz|science|shiksha|singles|staples|storage|support|surgery|systems|temasek|theater|theatre|tickets|tiffany|toshiba|trading|walmart|wanggou|watches|weather|website|wedding|whoswho|windows|winners|xfinity|yamaxun|youtube|zuerich|||||||||abarth|abbott|abbvie|africa|agency|airbus|airtel|alipay|alsace|alstom|amazon|anquan|aramco|author|bayern|beauty|berlin|bharti|bostik|boston|broker|camera|career|casino|center|chanel|chrome|church|circle|claims|clinic|coffee|comsec|condos|coupon|credit|cruise|dating|datsun|dealer|degree|dental|design|direct|doctor|dunlop|dupont|durban|emerck|energy|estate|events|expert|family|flickr|futbol|gallup|garden|george|giving|global|google|gratis|health|hermes|hiphop|hockey|hotels|hughes|imamat|insure|intuit|jaguar|joburg|juegos|kaufen|kinder|kindle|kosher|lancia|latino|lawyer|lefrak|living|locker|london|luxury|madrid|maison|makeup|market|mattel|mobile|monash|mormon|moscow|museum|mutual|nagoya|natura|nissan|nissay|norton|nowruz|office|olayan|online|oracle|orange|otsuka|pfizer|photos|physio|pictet|quebec|racing|realty|reisen|repair|report|review|rocher|rogers|ryukyu|safety|sakura|sanofi|school|schule|search|secure|select|shouji|soccer|social|stream|studio|supply|suzuki|swatch|sydney|taipei|taobao|target|tattoo|tennis|tienda|tjmaxx|tkmaxx|toyota|travel|unicom|viajes|viking|villas|virgin|vision|voting|voyage|vuelos|walter|webcam|xihuan|yachts|yandex|zappos|||||||||||||actor|adult|aetna|amfam|amica|apple|archi|audio|autos|azure|baidu|beats|bible|bingo|black|boats|bosch|build|canon|cards|chase|cheap|cisco|citic|click|cloud|coach|codes|crown|cymru|dabur|dance|deals|delta|drive|dubai|earth|edeka|email|epson|faith|fedex|final|forex|forum|gallo|games|gifts|gives|glass|globo|gmail|green|gripe|group|gucci|guide|homes|honda|horse|house|hyatt|ikano|irish|jetzt|koeln|kyoto|lamer|lease|legal|lexus|lilly|linde|lipsy|loans|locus|lotte|lotto|macys|mango|media|miami|money|movie|music|nexus|nikon|ninja|nokia|nowtv|omega|osaka|paris|parts|party|phone|photo|pizza|place|poker|praxi|press|prime|promo|quest|radio|rehab|reise|ricoh|rocks|rodeo|rugby|salon|sener|seven|sharp|shell|shoes|skype|sling|smart|smile|solar|space|sport|stada|store|study|style|sucks|swiss|tatar|tires|tirol|tmall|today|tokyo|tools|toray|total|tours|trade|trust|tunes|tushu|ubank|vegas|video|vodka|volvo|wales|watch|weber|weibo|works|world|xerox|yahoo||||||||||||||aarp|able|adac|aero|akdn|ally|amex|arab|army|arpa|arte|asda|asia|audi|auto|baby|band|bank|bbva|beer|best|bike|bing|blog|blue|bofa|bond|book|buzz|cafe|call|camp|care|cars|casa|case|cash|cbre|cern|chat|citi|city|club|cool|coop|cyou|data|date|dclk|deal|dell|desi|diet|dish|docs|dvag|erni|fage|fail|fans|farm|fast|fiat|fido|film|fire|fish|flir|food|ford|free|fund|game|gbiz|gent|ggee|gift|gmbh|gold|golf|goog|guge|guru|hair|haus|hdfc|help|here|hgtv|host|hsbc|icbc|ieee|imdb|immo|info|itau|java|jeep|jobs|jprs|kddi|kids|kiwi|kpmg|kred|land|lego|lgbt|lidl|life|like|limo|link|live|loan|loft|love|ltda|luxe|maif|meet|meme|menu|mini|mint|mobi|moda|moto|name|navy|news|next|nico|nike|ollo|open|page|pars|pccw|pics|ping|pink|play|plus|pohl|porn|post|prod|prof|qpon|read|reit|rent|rest|rich|room|rsvp|ruhr|safe|sale|sarl|save|saxo|scot|seat|seek|sexy|shaw|shia|shop|show|silk|sina|site|skin|sncf|sohu|song|sony|spot|star|surf|talk|taxi|team|tech|teva|tiaa|tips|town|toys|tube|vana|visa|viva|vivo|vote|voto|wang|weir|wien|wiki|wine|work|xbox|yoga|zara|zero|zone||||||||||||||||||||||||||aaa|abb|abc|aco|ads|aeg|afl|aig|anz|aol|app|art|aws|axa|bar|bbc|bbt|bcg|bcn|bet|bid|bio|biz|bms|bmw|bom|boo|bot|box|buy|bzh|cab|cal|cam|car|cat|cba|cbn|cbs|ceo|cfa|cfd|com|cpa|crs|dad|day|dds|dev|dhl|diy|dnp|dog|dot|dtv|dvr|eat|eco|edu|esq|eus|fan|fit|fly|foo|fox|frl|ftr|fun|fyi|gal|gap|gay|gdn|gea|gle|gmo|gmx|goo|gop|got|gov|hbo|hiv|hkt|hot|how|ibm|ice|icu|ifm|inc|ing|ink|int|ist|itv|jcb|jio|jll|jmp|jnj|jot|joy|kfh|kia|kim|kpn|krd|lat|law|lds|llc|llp|lol|lpl|ltd|man|map|mba|med|men|mil|mit|mlb|mls|mma|moe|moi|mom|mov|msd|mtn|mtr|nab|nba|nec|net|new|nfl|ngo|nhk|now|nra|nrw|ntt|nyc|obi|one|ong|onl|ooo|org|ott|ovh|pay|pet|phd|pid|pin|pnc|pro|pru|pub|pwc|red|ren|ril|rio|rip|run|rwe|sap|sas|sbi|sbs|sca|scb|ses|sew|sex|sfr|ski|sky|soy|spa|srl|stc|tab|tax|tci|tdk|tel|thd|tjx|top|trv|tui|tvs|ubs|uno|uol|ups|vet|vig|vin|vip|wed|win|wme|wow|wtc|wtf|xin|xxx|xyz|you|yun|zip||||||||||||||||||||||||||||||||ac|ad|ae|af|ag|ai|al|am|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw|||||||||||||||||||||||||||||||||||||||||||||||||||||||||||)";var vc=new RegExp("^"+mc+"$");var Sc=/[\/?#]/;var bc=/[-+&@#/%=~_()|'$*\[\]{}\u2713]/;var yc=/[?!:,.;^]/;var Cc=/https?:\/\//i;var wc=new RegExp("^"+Cc.source,"i");var _c=new RegExp(yc.source+"$");var Ec=/^(javascript|vbscript):/i;var Tc=/^[A-Za-z][-.+A-Za-z0-9]*:(\/\/)?([^:/]*)/;var Ic=/^(?:\/\/)?([^/#?:]+)/;function Pc(e){return qa.test(e)}function Ac(e){return qa.test(e)||Ka.test(e)||e==="+"||e==="-"||e==="."}function Mc(e){return oc.test(e)}function Dc(e){return e==="_"||Mc(e)}function Rc(e){return oc.test(e)||bc.test(e)||yc.test(e)}function Oc(e){return Sc.test(e)}function Nc(e){return vc.test(e.toLowerCase())}function xc(e){if(Ec.test(e)){return false}var t=e.match(Tc);if(!t){return false}var i=!!t[1];var r=t[2];if(i){return true}if(r.indexOf(".")===-1||!qa.test(r)){return false}return true}function Lc(e){var t=e.match(Ic);if(!t){return false}var i=t[0];var r=i.split(".");if(r.length<2){return false}var n=r[r.length-1];if(!Nc(n)){return false}return true}var kc=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;var Fc=/[:/?#]/;function Uc(e){var t=e.split(Fc,1)[0];return kc.test(t)}var jc=/^(https?:\/\/)?(www\.)?/i;var Wc=/^\/\//;var Bc=function(e){fc(t,e);function t(t){var i=e.call(this,t)||this;i.type="url";i.url="";i.urlMatchType="scheme";i.protocolRelativeMatch=false;i.stripPrefix={scheme:true,www:true};i.stripTrailingSlash=true;i.decodePercentEncoding=true;i.protocolPrepended=false;i.urlMatchType=t.urlMatchType;i.url=t.url;i.protocolRelativeMatch=t.protocolRelativeMatch;i.stripPrefix=t.stripPrefix;i.stripTrailingSlash=t.stripTrailingSlash;i.decodePercentEncoding=t.decodePercentEncoding;return i}t.prototype.getType=function(){return"url"};t.prototype.getUrlMatchType=function(){return this.urlMatchType};t.prototype.getUrl=function(){var e=this.url;if(!this.protocolRelativeMatch&&this.urlMatchType!=="scheme"&&!this.protocolPrepended){e=this.url="http://"+e;this.protocolPrepended=true}return e};t.prototype.getAnchorHref=function(){var e=this.getUrl();return e.replace(/&amp;/g,"&")};t.prototype.getAnchorText=function(){var e=this.getMatchedText();if(this.protocolRelativeMatch){e=Yc(e)}if(this.stripPrefix.scheme){e=Hc(e)}if(this.stripPrefix.www){e=Vc(e)}if(this.stripTrailingSlash){e=Gc(e)}if(this.decodePercentEncoding){e=$c(e)}return e};return t}(gc);function Hc(e){return e.replace(wc,"")}function Vc(e){return e.replace(jc,"$1")}function Yc(e){return e.replace(Wc,"")}function Gc(e){if(e.charAt(e.length-1)==="/"){e=e.slice(0,-1)}return e}function $c(e){var t=e.replace(/%22/gi,"&quot;").replace(/%26/gi,"&amp;").replace(/%27/gi,"&#39;").replace(/%3C/gi,"&lt;").replace(/%3E/gi,"&gt;");try{return decodeURIComponent(t)}catch(i){return t}}var zc=/^mailto:/i;var Jc=new RegExp("[".concat(sc,"!#$%&'*+/=?^_`{|}~-]"));function qc(e){return oc.test(e)}function Kc(e){return Jc.test(e)}function Xc(e){var t=e.split(".").pop()||"";return Nc(t)}var Qc=function(e){fc(t,e);function t(t){var i=e.call(this,t)||this;i.type="email";i.email="";i.email=t.email;return i}t.prototype.getType=function(){return"email"};t.prototype.getEmail=function(){return this.email};t.prototype.getAnchorHref=function(){return"mailto:"+this.email};t.prototype.getAnchorText=function(){return this.email};return t}(gc);function Zc(e){return e==="_"||oc.test(e)}function el(e){return e.length<=140}var tl=["twitter","facebook","instagram","tiktok"];var il=function(e){fc(t,e);function t(t){var i=e.call(this,t)||this;i.type="hashtag";i.serviceName="twitter";i.hashtag="";i.serviceName=t.serviceName;i.hashtag=t.hashtag;return i}t.prototype.getType=function(){return"hashtag"};t.prototype.getServiceName=function(){return this.serviceName};t.prototype.getHashtag=function(){return this.hashtag};t.prototype.getAnchorHref=function(){var e=this.serviceName,t=this.hashtag;switch(e){case"twitter":return"https://twitter.com/hashtag/"+t;case"facebook":return"https://www.facebook.com/hashtag/"+t;case"instagram":return"https://instagram.com/explore/tags/"+t;case"tiktok":return"https://www.tiktok.com/tag/"+t;default:Ja(e);throw new Error("Invalid hashtag service: ".concat(e))}};t.prototype.getAnchorText=function(){return"#"+this.hashtag};t.prototype.getCssClassSuffixes=function(){var t=e.prototype.getCssClassSuffixes.call(this),i=this.getServiceName();if(i){t.push(i)}return t};return t}(gc);var rl={twitter:/^@\w{1,15}$/,instagram:/^@[_\w]{1,30}$/,soundcloud:/^@[-a-z0-9_]{3,25}$/,tiktok:/^@[.\w]{1,23}[\w]$/};var nl=/[-\w.]/;function sl(e){return nl.test(e)}function ol(e,t){var i=rl[t];return i.test(e)}var al=["twitter","instagram","soundcloud","tiktok"];var cl=function(e){fc(t,e);function t(t){var i=e.call(this,t)||this;i.type="mention";i.serviceName="twitter";i.mention="";i.mention=t.mention;i.serviceName=t.serviceName;return i}t.prototype.getType=function(){return"mention"};t.prototype.getMention=function(){return this.mention};t.prototype.getServiceName=function(){return this.serviceName};t.prototype.getAnchorHref=function(){switch(this.serviceName){case"twitter":return"https://twitter.com/"+this.mention;case"instagram":return"https://instagram.com/"+this.mention;case"soundcloud":return"https://soundcloud.com/"+this.mention;case"tiktok":return"https://www.tiktok.com/@"+this.mention;default:throw new Error("Unknown service name to point mention to: "+this.serviceName)}};t.prototype.getAnchorText=function(){return"@"+this.mention};t.prototype.getCssClassSuffixes=function(){var t=e.prototype.getCssClassSuffixes.call(this),i=this.getServiceName();if(i){t.push(i)}return t};return t}(gc);var ll=/[-. ]/;var dl=/[-. ()]/;var ul=/[,;]/;var hl=/(?:(?:(?:(\+)?\d{1,3}[-. ]?)?\(?\d{3}\)?[-. ]?\d{3}[-. ]?\d{4})|(?:(\+)(?:9[976]\d|8[987530]\d|6[987]\d|5[90]\d|42\d|3[875]\d|2[98654321]\d|9[8543210]|8[6421]|6[6543210]|5[87654321]|4[987654310]|3[9643210]|2[70]|7|1)[-. ]?(?:\d[-. ]?){6,12}\d+))([,;]+[0-9]+#?)*/;var fl=/(0([1-9]-?[1-9]\d{3}|[1-9]{2}-?\d{3}|[1-9]{2}\d{1}-?\d{2}|[1-9]{2}\d{2}-?\d{1})-?\d{4}|0[789]0-?\d{4}-?\d{4}|050-?\d{4}-?\d{4})/;var pl=new RegExp("^".concat(hl.source,"|").concat(fl.source,"$"));function gl(e){return ll.test(e)}function ml(e){return ul.test(e)}function vl(e){var t=e.charAt(0)==="+"||dl.test(e);return t&&pl.test(e)}var Sl=function(e){fc(t,e);function t(t){var i=e.call(this,t)||this;i.type="phone";i.number="";i.plusSign=false;i.number=t.number;i.plusSign=t.plusSign;return i}t.prototype.getType=function(){return"phone"};t.prototype.getPhoneNumber=function(){return this.number};t.prototype.getNumber=function(){return this.getPhoneNumber()};t.prototype.getAnchorHref=function(){return"tel:"+(this.plusSign?"+":"")+this.number};t.prototype.getAnchorText=function(){return this.matchedText};return t}(gc);function bl(e,t){var i=t.tagBuilder;var r=t.stripPrefix;var n=t.stripTrailingSlash;var s=t.decodePercentEncoding;var o=t.hashtagServiceName;var a=t.mentionServiceName;var c=[];var l=e.length;var d=[];var u=0;for(;u<l;u++){var h=e.charAt(u);if(d.length===0){m(h)}else{for(var f=d.length-1;f>=0;f--){var p=d[f];switch(p.state){case 11:w(p,h);break;case 12:_(p,h);break;case 0:v(p,h);break;case 1:S(p,h);break;case 2:b(p,h);break;case 3:y(p,h);break;case 4:C(p,h);break;case 5:E(p,h);break;case 6:T(p,h);break;case 7:I(p,h);break;case 13:P(p,h);break;case 14:A(p,h);break;case 8:M(p,h);break;case 9:D(p,h);break;case 10:R(p,h);break;case 15:O(p,h);break;case 16:N(p,h);break;case 17:x(p,h);break;case 18:L(p,h);break;case 19:k(p,h);break;case 20:F(p,h);break;case 21:U(p,h);break;case 22:j(p,h);break;case 23:W(p,h);break;case 24:B(p,h);break;case 25:H(p,h);break;case 26:V(p,h);break;case 27:Y(p,h);break;case 28:G(p,h);break;case 29:$(p,h);break;case 30:z(p,h);break;case 31:J(p,h);break;case 32:K(p,h);break;case 33:X(p,h);break;case 34:Q(p,h);break;case 35:Z(p,h);break;case 36:ee(p,h);break;case 37:q(p,h);break;case 38:te(p,h);break;case 39:ie(p,h);break;case 40:re(p,h);break;case 41:ne(p,h);break;default:Ja(p.state)}}}}for(var g=d.length-1;g>=0;g--){d.forEach((function(e){return se(e)}))}return c;function m(e){if(e==="#"){d.push(Al(u,28))}else if(e==="@"){d.push(Ml(u,30))}else if(e==="/"){d.push(Tl(u,11))}else if(e==="+"){d.push(Dl(u,37))}else if(e==="("){d.push(Dl(u,32))}else{if(Ka.test(e)){d.push(Dl(u,38));d.push(Il(u,13))}if(qc(e)){var t=e.toLowerCase()==="m"?15:22;d.push(Pl(u,t))}if(Pc(e)){d.push(El(u,0))}if(oc.test(e)){d.push(Tl(u,5))}}}function v(e,t){if(t===":"){e.state=2}else if(t==="-"){e.state=1}else if(Ac(t));else{$a(d,e)}}function S(e,t){if(t==="-");else if(t==="/"){$a(d,e);d.push(Tl(u,11))}else if(Ac(t)){e.state=0}else{$a(d,e)}}function b(e,t){if(t==="/"){e.state=3}else if(t==="."){$a(d,e)}else if(Mc(t)){e.state=5;if(Pc(t)){d.push(El(u,0))}}else{$a(d,e)}}function y(e,t){if(t==="/"){e.state=4}else if(Rc(t)){e.state=10;e.acceptStateReached=true}else{se(e)}}function C(e,t){if(t==="/"){e.state=10}else if(Mc(t)){e.state=5;e.acceptStateReached=true}else{$a(d,e)}}function w(e,t){if(t==="/"){e.state=12}else{$a(d,e)}}function _(e,t){if(Mc(t)){e.state=5}else{$a(d,e)}}function E(e,t){if(t==="."){e.state=7}else if(t==="-"){e.state=6}else if(t===":"){e.state=8}else if(Oc(t)){e.state=10}else if(Dc(t));else{se(e)}}function T(e,t){if(t==="-");else if(t==="."){se(e)}else if(Mc(t)){e.state=5}else{se(e)}}function I(e,t){if(t==="."){se(e)}else if(Mc(t)){e.state=5;e.acceptStateReached=true}else{se(e)}}function P(e,t){if(t==="."){e.state=14}else if(t===":"){e.state=8}else if(Ka.test(t));else if(Oc(t)){e.state=10}else if(oc.test(t)){$a(d,e)}else{se(e)}}function A(e,t){if(Ka.test(t)){e.octetsEncountered++;if(e.octetsEncountered===4){e.acceptStateReached=true}e.state=13}else{se(e)}}function M(e,t){if(Ka.test(t)){e.state=9}else{se(e)}}function D(e,t){if(Ka.test(t));else if(Oc(t)){e.state=10}else{se(e)}}function R(e,t){if(Rc(t));else{se(e)}}function O(e,t){if(t.toLowerCase()==="a"){e.state=16}else{j(e,t)}}function N(e,t){if(t.toLowerCase()==="i"){e.state=17}else{j(e,t)}}function x(e,t){if(t.toLowerCase()==="l"){e.state=18}else{j(e,t)}}function L(e,t){if(t.toLowerCase()==="t"){e.state=19}else{j(e,t)}}function k(e,t){if(t.toLowerCase()==="o"){e.state=20}else{j(e,t)}}function F(e,t){if(t.toLowerCase()===":"){e.state=21}else{j(e,t)}}function U(e,t){if(Kc(t)){e.state=22}else{$a(d,e)}}function j(e,t){if(t==="."){e.state=23}else if(t==="@"){e.state=24}else if(Kc(t)){e.state=22}else{$a(d,e)}}function W(e,t){if(t==="."){$a(d,e)}else if(t==="@"){$a(d,e)}else if(Kc(t)){e.state=22}else{$a(d,e)}}function B(e,t){if(Mc(t)){e.state=25}else{$a(d,e)}}function H(e,t){if(t==="."){e.state=27}else if(t==="-"){e.state=26}else if(Dc(t));else{se(e)}}function V(e,t){if(t==="-"||t==="."){se(e)}else if(Dc(t)){e.state=25}else{se(e)}}function Y(e,t){if(t==="."||t==="-"){se(e)}else if(Mc(t)){e.state=25;e.acceptStateReached=true}else{se(e)}}function G(e,t){if(Zc(t)){e.state=29;e.acceptStateReached=true}else{$a(d,e)}}function $(e,t){if(Zc(t));else{se(e)}}function z(e,t){if(sl(t)){e.state=31;e.acceptStateReached=true}else{$a(d,e)}}function J(e,t){if(sl(t));else if(oc.test(t)){$a(d,e)}else{se(e)}}function q(e,t){if(Ka.test(t)){e.state=38}else{$a(d,e);m(t)}}function K(e,t){if(Ka.test(t)){e.state=33}else{$a(d,e)}m(t)}function X(e,t){if(Ka.test(t)){e.state=34}else{$a(d,e)}}function Q(e,t){if(Ka.test(t)){e.state=35}else{$a(d,e)}}function Z(e,t){if(t===")"){e.state=36}else{$a(d,e)}}function ee(e,t){if(Ka.test(t)){e.state=38}else if(gl(t)){e.state=39}else{$a(d,e)}}function te(e,t){e.acceptStateReached=true;if(ml(t)){e.state=40}else if(t==="#"){e.state=41}else if(Ka.test(t));else if(t==="("){e.state=32}else if(gl(t)){e.state=39}else{se(e);if(Pc(t)){d.push(El(u,0))}}}function ie(e,t){if(Ka.test(t)){e.state=38}else if(t==="("){e.state=32}else{se(e);m(t)}}function re(e,t){if(ml(t));else if(t==="#"){e.state=41}else if(Ka.test(t)){e.state=38}else{se(e)}}function ne(e,t){if(ml(t)){e.state=40}else if(Ka.test(t)){$a(d,e)}else{se(e)}}function se(t){$a(d,t);if(!t.acceptStateReached){return}var l=t.startIdx;var h=e.slice(t.startIdx,u);h=_l(h);if(t.type==="url"){var f=e.charAt(t.startIdx-1);if(f==="@"){return}var p=t.matchType;if(p==="scheme"){var g=Cc.exec(h);if(g){l=l+g.index;h=h.slice(g.index)}if(!xc(h)){return}}else if(p==="tld"){if(!Lc(h)){return}}else if(p==="ipV4"){if(!Uc(h)){return}}else{Ja(p)}c.push(new Bc({tagBuilder:i,matchedText:h,offset:l,urlMatchType:p,url:h,protocolRelativeMatch:h.slice(0,2)==="//",stripPrefix:r,stripTrailingSlash:n,decodePercentEncoding:s}))}else if(t.type==="email"){if(Xc(h)){c.push(new Qc({tagBuilder:i,matchedText:h,offset:l,email:h.replace(zc,"")}))}}else if(t.type==="hashtag"){if(el(h)){c.push(new il({tagBuilder:i,matchedText:h,offset:l,serviceName:o,hashtag:h.slice(1)}))}}else if(t.type==="mention"){if(ol(h,a)){c.push(new cl({tagBuilder:i,matchedText:h,offset:l,serviceName:a,mention:h.slice(1)}))}}else if(t.type==="phone"){h=h.replace(/ +$/g,"");if(vl(h)){var m=h.replace(/[^0-9,;#]/g,"");c.push(new Sl({tagBuilder:i,matchedText:h,offset:l,number:m,plusSign:h.charAt(0)==="+"}))}}else{Ja(t)}}}var yl=/[\(\{\[]/;var Cl=/[\)\}\]]/;var wl={")":"(","}":"{","]":"["};function _l(e){var t={"(":0,"{":0,"[":0};for(var i=0;i<e.length;i++){var r=e.charAt(i);if(yl.test(r)){t[r]++}else if(Cl.test(r)){t[wl[r]]--}}var n=e.length-1;var s;while(n>=0){s=e.charAt(n);if(Cl.test(s)){var o=wl[s];if(t[o]<0){t[o]++;n--}else{break}}else if(_c.test(s)){n--}else{break}}return e.slice(0,n+1)}function El(e,t){return{type:"url",startIdx:e,state:t,acceptStateReached:false,matchType:"scheme"}}function Tl(e,t){return{type:"url",startIdx:e,state:t,acceptStateReached:false,matchType:"tld"}}function Il(e,t){return{type:"url",startIdx:e,state:t,acceptStateReached:false,matchType:"ipV4",octetsEncountered:1}}function Pl(e,t){return{type:"email",startIdx:e,state:t,acceptStateReached:false}}function Al(e,t){return{type:"hashtag",startIdx:e,state:t,acceptStateReached:false}}function Ml(e,t){return{type:"mention",startIdx:e,state:t,acceptStateReached:false}}function Dl(e,t){return{type:"phone",startIdx:e,state:t,acceptStateReached:false}}function Rl(e,t){var i=t.onOpenTag,r=t.onCloseTag,n=t.onText,s=t.onComment,o=t.onDoctype;var a=new Ol;var c=0,l=e.length,d=0,u=0,h=a;while(c<l){var f=e.charAt(c);switch(d){case 0:p(f);break;case 1:g(f);break;case 2:v(f);break;case 3:m(f);break;case 4:S(f);break;case 5:b(f);break;case 6:y(f);break;case 7:C(f);break;case 8:w(f);break;case 9:_(f);break;case 10:E(f);break;case 11:T(f);break;case 12:I(f);break;case 13:P();break;case 14:A(f);break;case 15:M(f);break;case 16:D(f);break;case 17:R(f);break;case 18:O(f);break;case 19:N(f);break;case 20:x(f);break;default:Ja(d)}c++}if(u<c){U()}function p(e){if(e==="<"){k()}}function g(e){if(e==="!"){d=13}else if(e==="/"){d=2;h=new Ol(pc(pc({},h),{isClosing:true}))}else if(e==="<"){k()}else if(qa.test(e)){d=3;h=new Ol(pc(pc({},h),{isOpening:true}))}else{d=0;h=a}}function m(e){if(Xa.test(e)){h=new Ol(pc(pc({},h),{name:j()}));d=4}else if(e==="<"){k()}else if(e==="/"){h=new Ol(pc(pc({},h),{name:j()}));d=12}else if(e===">"){h=new Ol(pc(pc({},h),{name:j()}));F()}else if(!qa.test(e)&&!Ka.test(e)&&e!==":"){L()}else;}function v(e){if(e===">"){L()}else if(qa.test(e)){d=3}else{L()}}function S(e){if(Xa.test(e));else if(e==="/"){d=12}else if(e===">"){F()}else if(e==="<"){k()}else if(e==="="||Qa.test(e)||Za.test(e)){L()}else{d=5}}function b(e){if(Xa.test(e)){d=6}else if(e==="/"){d=12}else if(e==="="){d=7}else if(e===">"){F()}else if(e==="<"){k()}else if(Qa.test(e)){L()}else;}function y(e){if(Xa.test(e));else if(e==="/"){d=12}else if(e==="="){d=7}else if(e===">"){F()}else if(e==="<"){k()}else if(Qa.test(e)){L()}else{d=5}}function C(e){if(Xa.test(e));else if(e==='"'){d=8}else if(e==="'"){d=9}else if(/[>=`]/.test(e)){L()}else if(e==="<"){k()}else{d=10}}function w(e){if(e==='"'){d=11}}function _(e){if(e==="'"){d=11}}function E(e){if(Xa.test(e)){d=4}else if(e===">"){F()}else if(e==="<"){k()}else;}function T(e){if(Xa.test(e)){d=4}else if(e==="/"){d=12}else if(e===">"){F()}else if(e==="<"){k()}else{d=4;W()}}function I(e){if(e===">"){h=new Ol(pc(pc({},h),{isClosing:true}));F()}else{d=4}}function P(t){if(e.substr(c,2)==="--"){c+=2;h=new Ol(pc(pc({},h),{type:"comment"}));d=14}else if(e.substr(c,7).toUpperCase()==="DOCTYPE"){c+=7;h=new Ol(pc(pc({},h),{type:"doctype"}));d=20}else{L()}}function A(e){if(e==="-"){d=15}else if(e===">"){L()}else{d=16}}function M(e){if(e==="-"){d=18}else if(e===">"){L()}else{d=16}}function D(e){if(e==="-"){d=17}}function R(e){if(e==="-"){d=18}else{d=16}}function O(e){if(e===">"){F()}else if(e==="!"){d=19}else if(e==="-");else{d=16}}function N(e){if(e==="-"){d=17}else if(e===">"){F()}else{d=16}}function x(e){if(e===">"){F()}else if(e==="<"){k()}else;}function L(){d=0;h=a}function k(){d=1;h=new Ol({idx:c})}function F(){var t=e.slice(u,h.idx);if(t){n(t,u)}if(h.type==="comment"){s(h.idx)}else if(h.type==="doctype"){o(h.idx)}else{if(h.isOpening){i(h.name,h.idx)}if(h.isClosing){r(h.name,h.idx)}}L();u=c+1}function U(){var t=e.slice(u,c);n(t,u);u=c+1}function j(){var t=h.idx+(h.isClosing?2:1);return e.slice(t,c).toLowerCase()}function W(){c--}}var Ol=function(){function e(e){if(e===void 0){e={}}this.idx=e.idx!==void 0?e.idx:-1;this.type=e.type||"tag";this.name=e.name||"";this.isOpening=!!e.isOpening;this.isClosing=!!e.isClosing}return e}();var Nl=function(){function e(t){if(t===void 0){t={}}this.version=e.version;this.urls={};this.email=true;this.phone=true;this.hashtag=false;this.mention=false;this.newWindow=true;this.stripPrefix={scheme:true,www:true};this.stripTrailingSlash=true;this.decodePercentEncoding=true;this.truncate={length:0,location:"end"};this.className="";this.replaceFn=null;this.context=void 0;this.sanitizeHtml=false;this.tagBuilder=null;this.urls=xl(t.urls);this.email=Va(t.email)?t.email:this.email;this.phone=Va(t.phone)?t.phone:this.phone;this.hashtag=t.hashtag||this.hashtag;this.mention=t.mention||this.mention;this.newWindow=Va(t.newWindow)?t.newWindow:this.newWindow;this.stripPrefix=Ll(t.stripPrefix);this.stripTrailingSlash=Va(t.stripTrailingSlash)?t.stripTrailingSlash:this.stripTrailingSlash;this.decodePercentEncoding=Va(t.decodePercentEncoding)?t.decodePercentEncoding:this.decodePercentEncoding;this.sanitizeHtml=t.sanitizeHtml||false;var i=this.mention;if(i!==false&&al.indexOf(i)===-1){throw new Error("invalid `mention` cfg '".concat(i,"' - see docs"))}var r=this.hashtag;if(r!==false&&tl.indexOf(r)===-1){throw new Error("invalid `hashtag` cfg '".concat(r,"' - see docs"))}this.truncate=kl(t.truncate);this.className=t.className||this.className;this.replaceFn=t.replaceFn||this.replaceFn;this.context=t.context||this}e.link=function(t,i){var r=new e(i);return r.link(t)};e.parse=function(t,i){var r=new e(i);return r.parse(t)};e.prototype.parse=function(e){var t=this;var i=["a","style","script"],r=0,n=[];Rl(e,{onOpenTag:function(e){if(i.indexOf(e)>=0){r++}},onText:function(e,i){if(r===0){var s=/(&nbsp;|&#160;|&lt;|&#60;|&gt;|&#62;|&quot;|&#34;|&#39;)/gi;var o=e.split(s);var a=i;o.forEach((function(e,i){if(i%2===0){var r=t.parseText(e,a);n.push.apply(n,r)}a+=e.length}))}},onCloseTag:function(e){if(i.indexOf(e)>=0){r=Math.max(r-1,0)}},onComment:function(e){},onDoctype:function(e){}});n=this.compactMatches(n);n=this.removeUnwantedMatches(n);return n};e.prototype.compactMatches=function(e){e.sort((function(e,t){return e.getOffset()-t.getOffset()}));var t=0;while(t<e.length-1){var i=e[t],r=i.getOffset(),n=i.getMatchedText().length,s=r+n;if(t+1<e.length){if(e[t+1].getOffset()===r){var o=e[t+1].getMatchedText().length>n?t:t+1;e.splice(o,1);continue}if(e[t+1].getOffset()<s){e.splice(t+1,1);continue}}t++}return e};e.prototype.removeUnwantedMatches=function(e){if(!this.hashtag)za(e,(function(e){return e.getType()==="hashtag"}));if(!this.email)za(e,(function(e){return e.getType()==="email"}));if(!this.phone)za(e,(function(e){return e.getType()==="phone"}));if(!this.mention)za(e,(function(e){return e.getType()==="mention"}));if(!this.urls.schemeMatches){za(e,(function(e){return e.getType()==="url"&&e.getUrlMatchType()==="scheme"}))}if(!this.urls.tldMatches){za(e,(function(e){return e.getType()==="url"&&e.getUrlMatchType()==="tld"}))}if(!this.urls.ipV4Matches){za(e,(function(e){return e.getType()==="url"&&e.getUrlMatchType()==="ipV4"}))}return e};e.prototype.parseText=function(e,t){if(t===void 0){t=0}t=t||0;var i=bl(e,{tagBuilder:this.getTagBuilder(),stripPrefix:this.stripPrefix,stripTrailingSlash:this.stripTrailingSlash,decodePercentEncoding:this.decodePercentEncoding,hashtagServiceName:this.hashtag,mentionServiceName:this.mention||"twitter"});for(var r=0,n=i.length;r<n;r++){i[r].setOffset(t+i[r].getOffset())}return i};e.prototype.link=function(e){if(!e){return""}if(this.sanitizeHtml){e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}var t=this.parse(e),i=[],r=0;for(var n=0,s=t.length;n<s;n++){var o=t[n];i.push(e.substring(r,o.getOffset()));i.push(this.createMatchReturnVal(o));r=o.getOffset()+o.getMatchedText().length}i.push(e.substring(r));return i.join("")};e.prototype.createMatchReturnVal=function(e){var t;if(this.replaceFn){t=this.replaceFn.call(this.context,e)}if(typeof t==="string"){return t}else if(t===false){return e.getMatchedText()}else if(t instanceof ac){return t.toAnchorString()}else{var i=e.buildTag();return i.toAnchorString()}};e.prototype.getTagBuilder=function(){var e=this.tagBuilder;if(!e){e=this.tagBuilder=new uc({newWindow:this.newWindow,truncate:this.truncate,className:this.className})}return e};e.version=Ba;return e}();function xl(e){if(e==null)e=true;if(Va(e)){return{schemeMatches:e,tldMatches:e,ipV4Matches:e}}else{return{schemeMatches:Va(e.schemeMatches)?e.schemeMatches:true,tldMatches:Va(e.tldMatches)?e.tldMatches:true,ipV4Matches:Va(e.ipV4Matches)?e.ipV4Matches:true}}}function Ll(e){if(e==null)e=true;if(Va(e)){return{scheme:e,www:e}}else{return{scheme:Va(e.scheme)?e.scheme:true,www:Va(e.www)?e.www:true}}}function kl(e){if(typeof e==="number"){return{length:e,location:"end"}}else{return Ya(e||{},{length:Number.POSITIVE_INFINITY,location:"end"})}}var Fl=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};function Ul(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e["default"]:e}const jl={bold:{delimiter:"*",tag:"strong"},italic:{delimiter:"/",tag:"em"},underline:{delimiter:"_",tag:"u"},strike:{delimiter:"~",tag:"del"},code:{delimiter:"`",tag:"code"},sup:{delimiter:"^",tag:"sup"},sub:{delimiter:"",tag:"sub"}};const Wl=e=>`<${e}>`;const Bl=e=>`</${e}>`;const Hl=(e,t)=>`${Wl(t)}${e}${Bl(t)}`;const Vl=(e,t)=>{let i=0;let r="";while(i<e.length&&e[i]!==t){r+=e[i];i++}if(i===e.length){return""}else{return r}};var Yl=(e,t=jl)=>{t=Object.assign({},jl,t);let i="";let r=0;const n=()=>{i+=e[r];r++};const s=(e,t)=>{i+=t+e;r+=e.length};const o=t=>{r++;if(e[r]===" "){i+=t.delimiter;n()}else{const n=e.substr(r);const o=Vl(n,t.delimiter);if(o.length===0){s(n,t.delimiter)}else{i+=Hl(o,t.tag);r+=o.length+1}}};while(r<e.length){const i=e[r];if(i===t.bold.delimiter){o(t.bold)}else if(i===t.italic.delimiter){o(t.italic)}else if(i===t.underline.delimiter){o(t.underline)}else if(i===t.strike.delimiter){o(t.strike)}else if(i===t.code.delimiter){o(t.code)}else if(i===t.sup.delimiter){o(t.sup)}else if(i===t.sub.delimiter){o(t.sub)}else{n()}}return i};const Gl=Ul(Yl);const $l=".sc-message--text[data-v-bba1b69e]{padding:5px 20px;border-radius:6px;font-weight:300;font-size:14px;line-height:1.4;position:relative;-webkit-font-smoothing:subpixel-antialiased}.sc-message--text .sc-message--text-content[data-v-bba1b69e]{white-space:pre-wrap}.sc-message--text:hover .sc-message--toolbox[data-v-bba1b69e]{left:-20px;opacity:1}.sc-message--text .sc-message--toolbox[data-v-bba1b69e]{transition:left .2s ease-out 0s;white-space:normal;opacity:0;position:absolute;left:0;width:25px;top:0}.sc-message--text .sc-message--toolbox button[data-v-bba1b69e]{background:none;border:none;padding:0;margin:0;outline:none;width:100%;text-align:center;cursor:pointer}.sc-message--text .sc-message--toolbox button[data-v-bba1b69e]:focus{outline:none}.sc-message--text .sc-message--toolbox[data-v-bba1b69e] svg{margin-left:5px}.sc-message--text code[data-v-bba1b69e]{font-family:Courier New,Courier,monospace!important}.sc-message--content.sent .sc-message--text[data-v-bba1b69e]{color:#fff;background-color:#4e8cff;max-width:calc(100% - 120px);word-wrap:break-word}.sc-message--content.received .sc-message--text[data-v-bba1b69e]{color:#263238;background-color:#f4f7f9;margin-right:40px}a.chatLink[data-v-bba1b69e]{color:inherit!important}\n";const zl={components:{IconBase:Oa,IconCross:Wa,IconEdit:ka},props:{message:{type:Object,required:true},messageColors:{type:Object,required:true}},computed:{messageText(){const e=this.message.data.text;return Nl.link(Gl(e),{className:"chatLink",truncate:{length:50,location:"smart"}})},me(){return this.message.author==="me"},isEditing(){return(ma.state.editMessage&&ma.state.editMessage.id)===this.message.id},...va([])},methods:{edit(){ma.setState("editMessage",this.message)},ifelse(e,t,i){return()=>{if(t&&e)t();else if(i)i()}},withConfirm(e,t){return()=>{if(confirm(e))t()}}}};const Jl=["message","messageText","messageColors","me"];const ql=["innerHTML"];function Kl(e,t,i,r,n,s){return Es(),Ms("div",{class:"sc-message--text",style:B(i.messageColors)},[Fs("div",{class:"sc-message--toolbox",style:B({background:i.messageColors.backgroundColor})},[Zr(e.$slots,"text-message-toolbox",{message:i.message,me:s.me},void 0,true)],4),Fs("div",{message:i.message,messageText:s.messageText,messageColors:i.messageColors,me:s.me},[Fs("p",{class:"sc-message--text-content",innerHTML:s.messageText},null,8,ql)],8,Jl)],4)}const Xl=ya(zl,[["render",Kl],["styles",[$l]],["__scopeId","data-v-bba1b69e"]]);const Ql=".sc-message--file[data-v-1c31d50a]{border-radius:6px;font-weight:300;font-size:14px;line-height:1.4;-webkit-font-smoothing:subpixel-antialiased}.sc-message--content.sent .sc-message--file[data-v-1c31d50a]{word-wrap:break-word}.sc-message--file-icon[data-v-1c31d50a]{text-align:center;margin:15px auto 0}.sc-image[data-v-1c31d50a]{max-width:100%;min-width:100%}.sc-message--file-text[data-v-1c31d50a]{padding:17px 20px;border-radius:6px;font-weight:300;font-size:14px;line-height:1.4;white-space:pre-wrap;-webkit-font-smoothing:subpixel-antialiased}.sc-message--file-name[data-v-1c31d50a]{color:#fff;padding-left:15px;padding-right:15px;padding-top:0;font-size:x-small;text-align:center}.sc-message--file-name a[data-v-1c31d50a]{text-decoration:none;color:#ece7e7}.sc-message--file-name a[data-v-1c31d50a]:hover{color:#fff}.sc-message--content.sent .sc-message--file-text[data-v-1c31d50a]{color:#fff;background-color:#4e8cff;word-wrap:break-word}.sc-message--content.received .sc-message--file[data-v-1c31d50a]{color:#263238;background-color:#f4f7f9;margin-right:40px}.sc-message--content.received .sc-message--file-name[data-v-1c31d50a]{color:#000}.sc-message--content.received .sc-message--file a[data-v-1c31d50a]{color:#2b2828b3}.sc-message--content.received .sc-message--file a[data-v-1c31d50a]:hover{color:#0c0c0c}\n";const Zl={props:{data:{type:Object,required:true},messageColors:{type:Object,required:true}}};const ed={class:"sc-message--file-icon"};const td=["src"];const id=["href"];function rd(e,t,i,r,n,s){return Es(),Ms("div",{class:"sc-message--file",style:B(i.messageColors)},[Fs("div",ed,[Fs("img",{src:i.data.file.url,class:"sc-image"},null,8,td)]),Fs("div",{class:"sc-message--file-name",style:B(i.messageColors)},[Fs("a",{href:i.data.file.url?i.data.file.url:"#",target:"_blank"},X(i.data.file.name||""),9,id)],4),Fs("div",{class:"sc-message--file-text",style:B(i.messageColors)},[Vs(X(i.data.text)+" ",1),i.data.meta?(Es(),Ms("p",{key:0,class:"sc-message--meta",style:B(i.messageColors)},X(i.data.meta),5)):Ys("",true)],4)],4)}const nd=ya(Zl,[["render",rd],["styles",[Ql]],["__scopeId","data-v-1c31d50a"]]);const sd=".sc-message--emoji[data-v-5f777212]{font-size:40px}\n";const od={props:{data:{type:Object,required:true}}};const ad={class:"sc-message--emoji"};function cd(e,t,i,r,n,s){return Es(),Ms("div",ad,X(i.data.emoji),1)}const ld=ya(od,[["render",cd],["styles",[sd]],["__scopeId","data-v-5f777212"]]);const dd=".sc-typing-indicator[data-v-86a47899]{text-align:center;padding:17px 20px;border-radius:6px}.sc-typing-indicator span[data-v-86a47899]{display:inline-block;background-color:#b6b5ba;width:10px;height:10px;border-radius:100%;margin-right:3px;animation:bob-86a47899 2s infinite}.sc-typing-indicator span[data-v-86a47899]:nth-child(1){animation-delay:-1s}.sc-typing-indicator span[data-v-86a47899]:nth-child(2){animation-delay:-.85s}.sc-typing-indicator span[data-v-86a47899]:nth-child(3){animation-delay:-.7s}@keyframes bob-86a47899{10%{transform:translateY(-10px);background-color:#9e9da2}50%{transform:translateY(0);background-color:#b6b5ba}}\n";const ud={props:{messageColors:{type:Object,required:true}}};const hd=e=>(nr("data-v-86a47899"),e=e(),sr(),e);const fd=hd((()=>Fs("span",null,null,-1)));const pd=hd((()=>Fs("span",null,null,-1)));const gd=hd((()=>Fs("span",null,null,-1)));const md=[fd,pd,gd];function vd(e,t,i,r,n,s){return Es(),Ms("div",{class:"sc-typing-indicator",style:B(i.messageColors)},md,4)}const Sd=ya(ud,[["render",vd],["styles",[dd]],["__scopeId","data-v-86a47899"]]);const bd=".sc-message--system[data-v-b8b8fd1f]{padding:8px 20px;border-radius:6px;font-weight:300;font-size:12px;line-height:1.2;white-space:pre-wrap;-webkit-font-smoothing:subpixel-antialiased;font-style:italic;opacity:.55}\n";const yd={props:{data:{type:Object,required:true},messageColors:{type:Object,required:true}}};function Cd(e,t,i,r,n,s){return Es(),Ms("div",{class:"sc-message--system",style:B(i.messageColors)},[Zr(e.$slots,"default",{message:i.data},(()=>[Vs(X(i.data.text),1)]),true)],4)}const wd=ya(yd,[["render",Cd],["styles",[bd]],["__scopeId","data-v-b8b8fd1f"]]);const _d="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2aWV3Qm94PSItNDc0OS40OCAtNTAyMCAzNS4wMzYgMzUuMDM2Ij48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO30uYntmaWxsOiM0ZThjZmY7fS5je2NsaXAtcGF0aDp1cmwoI2EpO30uZHtmaWxsOiNmZmY7fS5le2ZpbGw6I2VmZjRmOTt9PC9zdHlsZT48Y2xpcFBhdGggaWQ9ImEiPjxwYXRoIGNsYXNzPSJhIiBkPSJNMC0zOTkuNDc5SDE3LjU1NXYxNy41NTVIMFoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgMzk5LjQ3OSkiLz48L2NsaXBQYXRoPjwvZGVmcz48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNDg4NiAtNTA3NSkiPjxjaXJjbGUgY2xhc3M9ImIiIGN4PSIxNy41MTgiIGN5PSIxNy41MTgiIHI9IjE3LjUxOCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTM2LjUyIDU1KSIvPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE0NS4xMyA2NCkiPjxnIGNsYXNzPSJjIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIDApIj48cGF0aCBjbGFzcz0iZCIgZD0iTS0zODEuOTI0LTE5MC45NjJhOC43NzgsOC43NzgsMCwwLDAtOC43NzgtOC43NzgsOC43NzgsOC43NzgsMCwwLDAtOC43NzgsOC43NzgsOC43NDUsOC43NDUsMCwwLDAsMi4yNiw1Ljg3OXYxLjQ0MmMwLC44LjQ5MiwxLjQ1NywxLjEsMS40NTdoNS44M2EuODQzLjg0MywwLDAsMCwuMTgzLS4wMiw4Ljc3OCw4Ljc3OCwwLDAsMCw4LjE4NC04Ljc1NyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzk5LjQ3OSAxOTkuNzQpIi8+PC9nPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDAgMCkiPjxwYXRoIGNsYXNzPSJlIiBkPSJNLTY4Ljc2My0xOTQuMDc5YTkuMjkyLDkuMjkyLDAsMCwxLDYuMzgtOC44ODhjLS4yNTItLjAyMi0uNTA2LS4wMzMtLjc2My0uMDMzYTguNzc0LDguNzc0LDAsMCwwLTguNzc4LDguNzc4QTkuNTA4LDkuNTA4LDAsMCwwLTY5LjctMTg4LjNjLjAwNSwwLDAsLjAwOSwwLC4wMS0uMzExLjM1Mi0xLjkyNCwyLjg0OS4wMjEsMi44NDloMi4yNWMtMS4yMy0uMDIyLDEuMjYzLTIuMTA3LjI2OS0zLjQ5NGE4LjIyNSw4LjIyNSwwLDAsMS0xLjYtNS4xNDEiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDcxLjkyNCAyMDMpIi8+PC9nPjwvZz48L2c+PC9nPjwvc3ZnPg==";const Ed=".sc-message{width:300px;margin:auto;padding-bottom:10px;display:flex}.sc-message .sc-message--edited{opacity:.7;word-wrap:normal;font-size:xx-small;text-align:center}.sc-message--content{width:100%;display:flex}.sc-message--content.sent{justify-content:flex-end}.sc-message--content.system{justify-content:center}.sc-message--content.sent .sc-message--avatar{display:none}.sc-message--avatar{background-repeat:no-repeat;background-size:100%;background-position:center;min-width:30px;min-height:30px;border-radius:50%;align-self:center;margin-right:15px}@media (max-width: 450px){.sc-message{width:80%}}.sc-message--text{padding:5px 20px;border-radius:6px;font-weight:300;font-size:14px;line-height:1.4;position:relative;-webkit-font-smoothing:subpixel-antialiased}.sc-message--text .sc-message--text-body .sc-message--text-content{white-space:pre-wrap}.sc-message--text:hover .sc-message--toolbox{left:-20px;opacity:1}.sc-message--text.confirm-delete:hover .sc-message--toolbox{left:-90px}.sc-message--text.confirm-delete .sc-message--toolbox{width:auto}.sc-message--text .sc-message--toolbox{transition:left .2s ease-out 0s;white-space:normal;opacity:0;position:absolute;left:0;width:25px;top:0}.sc-message--text .sc-message--toolbox button{background:none;border:none;padding:0;margin:0;outline:none;width:100%;text-align:center;cursor:pointer}.sc-message--text .sc-message--toolbox button:focus{outline:none}.sc-message--content.sent .sc-message--text{color:#fff;background-color:#4e8cff;max-width:calc(100% - 120px);word-wrap:break-word}.sc-message--text code{font-family:Courier New,Courier,monospace!important}.sc-message--content.received .sc-message--text{color:#263238;background-color:#f4f7f9;margin-right:40px}.tooltip{display:block!important;z-index:10000}.tooltip .tooltip-inner{background:black;color:#fff;border-radius:16px;padding:5px 10px 4px}.tooltip .tooltip-arrow{width:0;height:0;border-style:solid;position:absolute;margin:5px;border-color:#000;z-index:1}.tooltip[x-placement^=top]{margin-bottom:5px}.tooltip[x-placement^=top] .tooltip-arrow{border-width:5px 5px 0 5px;border-left-color:transparent!important;border-right-color:transparent!important;border-bottom-color:transparent!important;bottom:-5px;left:calc(50% - 5px);margin-top:0;margin-bottom:0}.tooltip[x-placement^=bottom]{margin-top:5px}.tooltip[x-placement^=bottom] .tooltip-arrow{border-width:0 5px 5px 5px;border-left-color:transparent!important;border-right-color:transparent!important;border-top-color:transparent!important;top:-5px;left:calc(50% - 5px);margin-top:0;margin-bottom:0}.tooltip[x-placement^=right]{margin-left:5px}.tooltip[x-placement^=right] .tooltip-arrow{border-width:5px 5px 5px 0;border-left-color:transparent!important;border-top-color:transparent!important;border-bottom-color:transparent!important;left:-5px;top:calc(50% - 5px);margin-left:0;margin-right:0}.tooltip[x-placement^=left]{margin-right:5px}.tooltip[x-placement^=left] .tooltip-arrow{border-width:5px 0 5px 5px;border-top-color:transparent!important;border-right-color:transparent!important;border-bottom-color:transparent!important;right:-5px;top:calc(50% - 5px);margin-left:0;margin-right:0}.tooltip[aria-hidden=true]{visibility:hidden;opacity:0;transition:opacity .15s,visibility .15s}.tooltip[aria-hidden=false]{visibility:visible;opacity:1;transition:opacity .15s}.tooltip.info .tooltip-inner{background:rgba(0,68,153,.9);color:#fff;padding:24px;border-radius:5px;box-shadow:0 5px 30px #0000001a}.tooltip.info .tooltip-arrow{border-color:#004499e6}.tooltip.popover .popover-inner{background:#f9f9f9;color:#000;padding:24px;border-radius:5px;box-shadow:0 5px 30px #0000001a}.tooltip.popover .popover-arrow{border-color:#f9f9f9}\n";const Td={components:{TextMessage:Xl,FileMessage:nd,EmojiMessage:ld,TypingMessage:Sd,SystemMessage:wd},props:{message:{type:Object,required:true},colors:{type:Object,required:true},user:{type:Object,required:true}},computed:{authorName(){return this.user&&this.user.name},chatImageUrl(){return this.user&&this.user.imageUrl||_d},messageColors(){console.log(this.message);return this.message.author==="me"?this.sentColorsStyle:this.receivedColorsStyle},receivedColorsStyle(){return{color:this.colors.receivedMessage.text,backgroundColor:this.colors.receivedMessage.bg}},sentColorsStyle(){return{color:this.colors.sentMessage.text,backgroundColor:this.colors.sentMessage.bg}}}};const Id=["id"];const Pd=["title"];function Ad(e,t,i,r,n,s){const o=Jr("TextMessage");const a=Jr("EmojiMessage");const c=Jr("FileMessage");const l=Jr("TypingMessage");const d=Jr("SystemMessage");return Es(),Ms("div",{id:i.message.id,class:"sc-message"},[Fs("div",{class:z(["sc-message--content",{sent:i.message.author==="me",received:i.message.author!=="me"&&i.message.type!=="system",system:i.message.type==="system"}])},[Zr(e.$slots,"user-avatar",{message:i.message,user:i.user},(()=>[i.message.type!=="system"&&s.authorName&&s.authorName!=="me"?(Es(),Ms("div",{key:0,title:s.authorName,class:"sc-message--avatar",style:B({backgroundImage:`url(${s.chatImageUrl})`})},null,12,Pd)):Ys("",true)])),i.message.type==="text"&&i.message.data.text?(Es(),Ds(o,{key:0,message:i.message,"message-colors":s.messageColors},{default:or((t=>[Zr(e.$slots,"text-message-body",{message:t.message,messageText:t.messageText,messageColors:t.messageColors,me:t.me})])),"text-message-toolbox":or((t=>[Zr(e.$slots,"text-message-toolbox",{message:t.message,me:t.me})])),_:3},8,["message","message-colors"])):i.message.type==="emoji"?(Es(),Ds(a,{key:1,data:i.message.data},null,8,["data"])):i.message.type==="file"?(Es(),Ds(c,{key:2,data:i.message.data,"message-colors":s.messageColors},null,8,["data","message-colors"])):i.message.type==="typing"?(Es(),Ds(l,{key:3,"message-colors":s.messageColors},null,8,["message-colors"])):i.message.type==="system"?(Es(),Ds(d,{key:4,data:i.message.data,"message-colors":s.messageColors},{default:or((()=>[Zr(e.$slots,"system-message-body",{message:i.message.data})])),_:3},8,["data","message-colors"])):Ys("",true)],2)],8,Id)}const Md=ya(Td,[["render",Ad],["styles",[Ed]]]);const Dd=".sc-message-list[data-v-96cd0b87]{height:80%;overflow-y:auto;background-size:100%;padding:40px 0}\n";let Rd;const Od={components:{Message:Md},props:{messages:{type:Array,required:true},colors:{type:Object,required:true},alwaysScrollToBottom:{type:Boolean,required:true}},data(){return{initialScrollTop:null}},computed:{defaultChatIcon(){return _d}},mounted(){this.watchScrollList();this.$nextTick(this._scrollDown())},beforeUnmount(){Rd.unobserve(this.$refs.scrollList)},updated(){if(this.shouldScrollToBottom())this.$nextTick(this._scrollDown())},methods:{_scrollDown(){this.$refs.scrollList.scrollTop=this.$refs.scrollList.scrollHeight;!this.initialScrollTop?this.initialScrollTop=this.$refs.scrollList.scrollTop:""},handleScroll(e){if(e.target.scrollTop===0){this.$emit("scrollToTop")}},shouldScrollToBottom(){const e=this.$refs.scrollList.scrollTop;const t=e>this.$refs.scrollList.scrollHeight-600;return this.alwaysScrollToBottom||t},profile(e){return{imageUrl:"",name:""}},watchScrollList(){Rd=new ResizeObserver((()=>{const e=this.$refs.scrollList.scrollHeight-this.$refs.scrollList.scrollTop;if(this.initialScrollTop===this.$refs.scrollList.scrollTop||this.$refs.scrollList.scrollTop>this.initialScrollTop&&e>this.$refs.scrollList.offsetHeight){this._scrollDown()}}));Rd.observe(this.$refs.scrollList)}}};function Nd(e,t,i,r,n,s){const o=Jr("Message");return Es(),Ms("div",{ref:"scrollList",class:"sc-message-list",style:B({backgroundColor:i.colors.messageList.bg}),onScroll:t[0]||(t[0]=(...e)=>s.handleScroll&&s.handleScroll(...e))},[(Es(true),Ms(Ss,null,Qr(i.messages,((t,r)=>(Es(),Ds(o,{key:r,message:t,user:s.profile(t.author),colors:i.colors},{"user-avatar":or((t=>[Zr(e.$slots,"user-avatar",{user:t.user,message:t.message},void 0,true)])),"text-message-body":or((t=>[Zr(e.$slots,"text-message-body",{message:t.message,messageText:t.messageText,messageColors:t.messageColors,me:t.me},void 0,true)])),"system-message-body":or((t=>[Zr(e.$slots,"system-message-body",{message:t.message},void 0,true)])),"text-message-toolbox":or((t=>[Zr(e.$slots,"text-message-toolbox",{message:t.message,me:t.me},void 0,true)])),_:2},1032,["message","user","colors"])))),128))],36)}const xd=ya(Od,[["render",Nd],["styles",[Dd]],["__scopeId","data-v-96cd0b87"]]);var Ld={exports:{}};(function(e,t){(function(){var i=this;var r=i.EmojiConvertor;var n=function(){var e=this;e.img_set="apple";e.img_sets={apple:{path:"/emoji-data/img-apple-64/",sheet:"/emoji-data/sheet_apple_64.png",sheet_size:64,mask:1},google:{path:"/emoji-data/img-google-64/",sheet:"/emoji-data/sheet_google_64.png",sheet_size:64,mask:2},twitter:{path:"/emoji-data/img-twitter-64/",sheet:"/emoji-data/sheet_twitter_64.png",sheet_size:64,mask:4},facebook:{path:"/emoji-data/img-facebook-64/",sheet:"/emoji-data/sheet_facebook_64.png",sheet_size:64,mask:8},messenger:{path:"/emoji-data/img-messenger-64/",sheet:"/emoji-data/sheet_messenger_64.png",sheet_size:64,mask:16}};e.use_css_imgs=false;e.colons_mode=false;e.text_mode=false;e.include_title=false;e.include_text=false;e.allow_native=true;e.wrap_native=false;e.use_sheet=false;e.avoid_ms_emoji=true;e.allow_caps=false;e.img_suffix="";e.inits={};e.map={};e.init_env();return e};n.prototype.noConflict=function(){i.EmojiConvertor=r;return n};n.prototype.replace_emoticons=function(e){var t=this;var i=t.replace_emoticons_with_colons(e);return t.replace_colons(i)};n.prototype.replace_emoticons_with_colons=function(e){var t=this;t.init_emoticons();var i=0;var r=[];var n=e.replace(t.rx_emoticons,(function(n,s,o,a){var c=i;i=a+n.length;var l=o.indexOf("(")!==-1;var d=o.indexOf(")")!==-1;if((l||d)&&r.indexOf(o)==-1){r.push(o)}if(d&&!l){var u=e.substring(c,a);if(u.indexOf("(")!==-1&&u.indexOf(")")===-1)return n}if(n==="\n8)"){var h=e.substring(0,a);if(/\n?(6\)|7\))/.test(h))return n}var f=t.data[t.map.emoticons[o]][3][0];return f?s+":"+f+":":n}));if(r.length){var s=r.map(t.escape_rx);var o=new RegExp("(\\(.+)("+s.join("|")+")(.+\\))","g");n=n.replace(o,(function(e,i,r,n){var s=t.data[t.map.emoticons[r]][3][0];return s?i+":"+s+":"+n:e}))}return n};n.prototype.replace_colons=function(e){var t=this;t.init_colons();return e.replace(t.rx_colons,(function(e){var i=e.substr(1,e.length-2);if(t.allow_caps)i=i.toLowerCase();if(i.indexOf("::skin-tone-")>-1){var r=i.substr(-1,1);var n="skin-tone-"+r;var s=t.map.colons[n];i=i.substr(0,i.length-13);var o=t.map.colons[i];if(o){return t.replacement(o,i,":",{idx:s,actual:n,wrapper:":"})}else{return":"+i+":"+t.replacement(s,n,":")}}else{var o=t.map.colons[i];return o?t.replacement(o,i,":"):e}}))};n.prototype.replace_unified=function(e){var t=this;t.init_unified();return e.replace(t.rx_unified,(function(e,i,r){var n=t.map.unified[i];if(n){var s=null;if(r=="")s="1f3fb";if(r=="")s="1f3fc";if(r=="")s="1f3fd";if(r=="")s="1f3fe";if(r=="")s="1f3ff";if(s){return t.replacement(n,null,null,{idx:s,actual:r,wrapper:""})}return t.replacement(n)}n=t.map.unified_vars[i];if(n){return t.replacement(n[0],null,null,{idx:n[1],actual:"",wrapper:""})}return e}))};n.prototype.addAliases=function(e){var t=this;t.init_colons();for(var i in e){t.map.colons[i]=e[i]}};n.prototype.removeAliases=function(e){var t=this;for(var i=0;i<e.length;i++){var r=e[i];delete t.map.colons[r];e:{for(var n in t.data){for(var s=0;s<t.data[n][3].length;s++){if(r==t.data[n][3][s]){t.map.colons[r]=n;break e}}}}}};n.prototype.replacement=function(e,t,i,r,n){var s=this;var o="";var a=null;if(typeof r==="object"){o=s.replacement(r.idx,r.actual,r.wrapper,void 0,true);a=r.idx}i=i||"";if(s.colons_mode)return":"+s.data[e][3][0]+":"+o;var c=t?i+t+i:s.data[e][8]||i+s.data[e][3][0]+i;if(s.text_mode)return c+o;var l=s.find_image(e,a);s.init_env();if(s.replace_mode=="softbank"&&s.allow_native&&s.data[e][1])return s.format_native(s.data[e][1]+o,!n);if(s.replace_mode=="google"&&s.allow_native&&s.data[e][2])return s.format_native(s.data[e][2]+o,!n);if(l.is_var){o=""}if(s.replace_mode=="unified"&&s.allow_native)return s.format_native(l.unified+o,!n);var d=s.include_title?' title="'+(t||s.data[e][3][0])+'"':"";var u=s.include_text?i+(t||s.data[e][3][0])+i:"";if(s.data[e][7]){l.path=s.data[e][7];l.px=null;l.py=null;l.is_var=false}if(l.is_var&&s.include_text&&r&&r.actual&&r.wrapper){u+=r.wrapper+r.actual+r.wrapper}if(s.replace_mode=="css"){if(s.use_sheet&&l.px!=null&&l.py!=null){var h=100*l.px/(s.sheet_size-1);var f=100*l.py/(s.sheet_size-1);var p=100*s.sheet_size;var g="background: url("+l.sheet+");background-position:"+h+"% "+f+"%;background-size:"+p+"% "+p+"%";return'<span class="emoji-outer emoji-sizer"><span class="emoji-inner" style="'+g+'"'+d+' data-codepoints="'+l.full_idx+'">'+u+"</span></span>"+o}else if(s.use_css_imgs){return'<span class="emoji emoji-'+e+'"'+d+' data-codepoints="'+l.full_idx+'">'+u+"</span>"+o}else{return'<span class="emoji emoji-sizer" style="background-image:url('+l.path+')"'+d+' data-codepoints="'+l.full_idx+'">'+u+"</span>"+o}}return'<img src="'+l.path+'" class="emoji" data-codepoints="'+l.full_idx+'" '+d+"/>"+o};n.prototype.format_native=function(e,t){var i=this;if(i.wrap_native&&t){return'<span class="emoji-native">'+e+"</span>"}return e};n.prototype.find_image=function(e,t){var i=this;var r={path:"",sheet:"",sheet_size:0,px:i.data[e][4],py:i.data[e][5],full_idx:e,is_var:false,unified:i.data[e][0][0]};var n=i.data[e][6];if(t&&i.variations_data[e]&&i.variations_data[e][t]){var s=i.variations_data[e][t];r.px=s[1];r.py=s[2];r.full_idx=s[0];r.is_var=true;r.unified=s[4][0];n=s[3]}var o=[i.img_set,"apple","google","twitter","facebook","messenger"];for(var a=0;a<o.length;a++){if(n&i.img_sets[o[a]].mask){r.path=i.img_sets[o[a]].path+r.full_idx+".png"+i.img_suffix;r.sheet=i.img_sets[i.img_set].sheet;r.sheet_size=i.img_sets[i.img_set].sheet_size;return r}if(i.obsoletes_data[r.full_idx]){var c=i.obsoletes_data[r.full_idx];if(c[3]&i.img_sets[o[a]].mask){r.path=i.img_sets[o[a]].path+c[0]+".png"+i.img_suffix;r.sheet=i.img_sets[o[a]].sheet;r.sheet_size=i.img_sets[o[a]].sheet_size;r.px=c[1];r.py=c[2];return r}}}return r};n.prototype.init_emoticons=function(){var e=this;if(e.inits.emoticons)return;e.init_colons();e.inits.emoticons=1;var t=[];e.map.emoticons={};for(var i in e.emoticons_data){var r=i.replace(/\&/g,"&amp;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;");if(!e.map.colons[e.emoticons_data[i]])continue;e.map.emoticons[r]=e.map.colons[e.emoticons_data[i]];t.push(e.escape_rx(r))}e.rx_emoticons=new RegExp("(^|\\s)("+t.join("|")+")(?=$|[\\s|\\?\\.,!])","g")};n.prototype.init_colons=function(){var e=this;if(e.inits.colons)return;e.inits.colons=1;e.rx_colons=new RegExp(":[a-zA-Z0-9-_+]+:(:skin-tone-[2-6]:)?","g");e.map.colons={};for(var t in e.data){for(var i=0;i<e.data[t][3].length;i++){e.map.colons[e.data[t][3][i]]=t}}};n.prototype.init_unified=function(){var e=this;if(e.inits.unified)return;e.inits.unified=1;var t=[];e.map.unified={};e.map.unified_vars={};for(var i in e.data){for(var r=0;r<e.data[i][0].length;r++){t.push(e.data[i][0][r].replace("*","\\*"));e.map.unified[e.data[i][0][r]]=i}}for(var i in e.variations_data){if(e.variations_data[i]["1f3fb"]){if(e.variations_data[i]["1f3fb"][0]==i+"-1f3fb")continue}for(var n in e.variations_data[i]){for(var r=0;r<e.variations_data[i][n][4].length;r++){t.push(e.variations_data[i][n][4][r].replace("*","\\*"));e.map.unified_vars[e.variations_data[i][n][4][r]]=[i,n]}}}t=t.sort((function(e,t){return t.length-e.length}));e.rx_unified=new RegExp("("+t.join("|")+")(\ud83c[\udffb-\udfff])?","g")};n.prototype.init_env=function(){var e=this;if(e.inits.env)return;e.inits.env=1;e.replace_mode="img";var t=false;if(typeof navigator!=="undefined"){var i=navigator.userAgent;if(typeof window!=="undefined"&&window.getComputedStyle){try{var r=window.getComputedStyle(document.body);if(r["background-size"]||r["backgroundSize"]){t=true}}catch(n){if(i.match(/Firefox/i)){t=true}}}if(navigator.product.match(/ReactNative/i)){e.replace_mode="unified";return}if(i.match(/(iPhone|iPod|iPad|iPhone\s+Simulator)/i)){if(i.match(/OS\s+[12345]/i)){e.replace_mode="softbank";return}if(i.match(/OS\s+[6789]/i)){e.replace_mode="unified";return}}if(i.match(/Mac OS X (10[._ ](?:[789]|1)|11[._ ]\d)/i)){e.replace_mode="unified";return}if(!e.avoid_ms_emoji){if(i.match(/Windows NT 6.[1-9]/i)||i.match(/Windows NT 10.[0-9]/i)){if(!i.match(/Chrome/i)&&!i.match(/MSIE 8/i)){e.replace_mode="unified";return}}}}if(t){e.replace_mode="css";return}};n.prototype.escape_rx=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};n.prototype.sheet_size=60;n.prototype.data={"0023-fe0f-20e3":[["#","#"],"","",["hash"],0,0,7,0],"002a-fe0f-20e3":[["*","*"],"","",["keycap_star"],0,1,7,0],"0030-fe0f-20e3":[["0","0"],"","",["zero"],0,2,7,0],"0031-fe0f-20e3":[["1","1"],"","",["one"],0,3,7,0],"0032-fe0f-20e3":[["2","2"],"","",["two"],0,4,7,0],"0033-fe0f-20e3":[["3","3"],"","",["three"],0,5,7,0],"0034-fe0f-20e3":[["4","4"],"","",["four"],0,6,7,0],"0035-fe0f-20e3":[["5","5"],"","",["five"],0,7,7,0],"0036-fe0f-20e3":[["6","6"],"","",["six"],0,8,7,0],"0037-fe0f-20e3":[["7","7"],"","",["seven"],0,9,7,0],"0038-fe0f-20e3":[["8","8"],"","",["eight"],0,10,7,0],"0039-fe0f-20e3":[["9","9"],"","",["nine"],0,11,7,0],"00a9-fe0f":[["",""],"","",["copyright"],0,12,7,0],"00ae-fe0f":[["",""],"","",["registered"],0,13,7,0],"1f004":[[""],"","",["mahjong"],0,14,15,0],"1f0cf":[[""],"","",["black_joker"],0,15,15,0],"1f170-fe0f":[["",""],"","",["a"],0,16,15,0],"1f171-fe0f":[["",""],"","",["b"],0,17,15,0],"1f17e-fe0f":[["",""],"","",["o2"],0,18,15,0],"1f17f-fe0f":[["",""],"","",["parking"],0,19,15,0],"1f18e":[[""],"","",["ab"],0,20,15,0],"1f191":[[""],"","",["cl"],0,21,15,0],"1f192":[[""],"","",["cool"],0,22,15,0],"1f193":[[""],"","",["free"],0,23,15,0],"1f194":[[""],"","",["id"],0,24,15,0],"1f195":[[""],"","",["new"],0,25,15,0],"1f196":[[""],"","",["ng"],0,26,15,0],"1f197":[[""],"","",["ok"],0,27,15,0],"1f198":[[""],"","",["sos"],0,28,15,0],"1f199":[[""],"","",["up"],0,29,15,0],"1f19a":[[""],"","",["vs"],0,30,15,0],"1f1e6-1f1e8":[[""],"","",["flag-ac"],0,31,15,0],"1f1e6-1f1e9":[[""],"","",["flag-ad"],0,32,15,0],"1f1e6-1f1ea":[[""],"","",["flag-ae"],0,33,15,0],"1f1e6-1f1eb":[[""],"","",["flag-af"],0,34,15,0],"1f1e6-1f1ec":[[""],"","",["flag-ag"],0,35,15,0],"1f1e6-1f1ee":[[""],"","",["flag-ai"],0,36,15,0],"1f1e6-1f1f1":[[""],"","",["flag-al"],0,37,15,0],"1f1e6-1f1f2":[[""],"","",["flag-am"],0,38,15,0],"1f1e6-1f1f4":[[""],"","",["flag-ao"],0,39,15,0],"1f1e6-1f1f6":[[""],"","",["flag-aq"],0,40,15,0],"1f1e6-1f1f7":[[""],"","",["flag-ar"],0,41,15,0],"1f1e6-1f1f8":[[""],"","",["flag-as"],0,42,15,0],"1f1e6-1f1f9":[[""],"","",["flag-at"],0,43,15,0],"1f1e6-1f1fa":[[""],"","",["flag-au"],0,44,15,0],"1f1e6-1f1fc":[[""],"","",["flag-aw"],0,45,15,0],"1f1e6-1f1fd":[[""],"","",["flag-ax"],0,46,15,0],"1f1e6-1f1ff":[[""],"","",["flag-az"],0,47,15,0],"1f1e7-1f1e6":[[""],"","",["flag-ba"],0,48,15,0],"1f1e7-1f1e7":[[""],"","",["flag-bb"],0,49,15,0],"1f1e7-1f1e9":[[""],"","",["flag-bd"],0,50,15,0],"1f1e7-1f1ea":[[""],"","",["flag-be"],0,51,15,0],"1f1e7-1f1eb":[[""],"","",["flag-bf"],0,52,15,0],"1f1e7-1f1ec":[[""],"","",["flag-bg"],0,53,15,0],"1f1e7-1f1ed":[[""],"","",["flag-bh"],0,54,15,0],"1f1e7-1f1ee":[[""],"","",["flag-bi"],0,55,15,0],"1f1e7-1f1ef":[[""],"","",["flag-bj"],0,56,15,0],"1f1e7-1f1f1":[[""],"","",["flag-bl"],0,57,15,0],"1f1e7-1f1f2":[[""],"","",["flag-bm"],0,58,15,0],"1f1e7-1f1f3":[[""],"","",["flag-bn"],0,59,15,0],"1f1e7-1f1f4":[[""],"","",["flag-bo"],1,0,15,0],"1f1e7-1f1f6":[[""],"","",["flag-bq"],1,1,15,0],"1f1e7-1f1f7":[[""],"","",["flag-br"],1,2,15,0],"1f1e7-1f1f8":[[""],"","",["flag-bs"],1,3,15,0],"1f1e7-1f1f9":[[""],"","",["flag-bt"],1,4,15,0],"1f1e7-1f1fb":[[""],"","",["flag-bv"],1,5,15,0],"1f1e7-1f1fc":[[""],"","",["flag-bw"],1,6,15,0],"1f1e7-1f1fe":[[""],"","",["flag-by"],1,7,15,0],"1f1e7-1f1ff":[[""],"","",["flag-bz"],1,8,15,0],"1f1e8-1f1e6":[[""],"","",["flag-ca"],1,9,15,0],"1f1e8-1f1e8":[[""],"","",["flag-cc"],1,10,15,0],"1f1e8-1f1e9":[[""],"","",["flag-cd"],1,11,15,0],"1f1e8-1f1eb":[[""],"","",["flag-cf"],1,12,15,0],"1f1e8-1f1ec":[[""],"","",["flag-cg"],1,13,15,0],"1f1e8-1f1ed":[[""],"","",["flag-ch"],1,14,15,0],"1f1e8-1f1ee":[[""],"","",["flag-ci"],1,15,15,0],"1f1e8-1f1f0":[[""],"","",["flag-ck"],1,16,15,0],"1f1e8-1f1f1":[[""],"","",["flag-cl"],1,17,15,0],"1f1e8-1f1f2":[[""],"","",["flag-cm"],1,18,15,0],"1f1e8-1f1f3":[[""],"","",["cn","flag-cn"],1,19,15,0],"1f1e8-1f1f4":[[""],"","",["flag-co"],1,20,15,0],"1f1e8-1f1f5":[[""],"","",["flag-cp"],1,21,15,0],"1f1e8-1f1f7":[[""],"","",["flag-cr"],1,22,15,0],"1f1e8-1f1fa":[[""],"","",["flag-cu"],1,23,15,0],"1f1e8-1f1fb":[[""],"","",["flag-cv"],1,24,15,0],"1f1e8-1f1fc":[[""],"","",["flag-cw"],1,25,15,0],"1f1e8-1f1fd":[[""],"","",["flag-cx"],1,26,15,0],"1f1e8-1f1fe":[[""],"","",["flag-cy"],1,27,15,0],"1f1e8-1f1ff":[[""],"","",["flag-cz"],1,28,15,0],"1f1e9-1f1ea":[[""],"","",["de","flag-de"],1,29,15,0],"1f1e9-1f1ec":[[""],"","",["flag-dg"],1,30,15,0],"1f1e9-1f1ef":[[""],"","",["flag-dj"],1,31,15,0],"1f1e9-1f1f0":[[""],"","",["flag-dk"],1,32,15,0],"1f1e9-1f1f2":[[""],"","",["flag-dm"],1,33,15,0],"1f1e9-1f1f4":[[""],"","",["flag-do"],1,34,15,0],"1f1e9-1f1ff":[[""],"","",["flag-dz"],1,35,15,0],"1f1ea-1f1e6":[[""],"","",["flag-ea"],1,36,15,0],"1f1ea-1f1e8":[[""],"","",["flag-ec"],1,37,15,0],"1f1ea-1f1ea":[[""],"","",["flag-ee"],1,38,15,0],"1f1ea-1f1ec":[[""],"","",["flag-eg"],1,39,15,0],"1f1ea-1f1ed":[[""],"","",["flag-eh"],1,40,15,0],"1f1ea-1f1f7":[[""],"","",["flag-er"],1,41,15,0],"1f1ea-1f1f8":[[""],"","",["es","flag-es"],1,42,15,0],"1f1ea-1f1f9":[[""],"","",["flag-et"],1,43,15,0],"1f1ea-1f1fa":[[""],"","",["flag-eu"],1,44,15,0],"1f1eb-1f1ee":[[""],"","",["flag-fi"],1,45,15,0],"1f1eb-1f1ef":[[""],"","",["flag-fj"],1,46,15,0],"1f1eb-1f1f0":[[""],"","",["flag-fk"],1,47,15,0],"1f1eb-1f1f2":[[""],"","",["flag-fm"],1,48,15,0],"1f1eb-1f1f4":[[""],"","",["flag-fo"],1,49,15,0],"1f1eb-1f1f7":[[""],"","",["fr","flag-fr"],1,50,15,0],"1f1ec-1f1e6":[[""],"","",["flag-ga"],1,51,15,0],"1f1ec-1f1e7":[[""],"","",["gb","uk","flag-gb"],1,52,15,0],"1f1ec-1f1e9":[[""],"","",["flag-gd"],1,53,15,0],"1f1ec-1f1ea":[[""],"","",["flag-ge"],1,54,15,0],"1f1ec-1f1eb":[[""],"","",["flag-gf"],1,55,15,0],"1f1ec-1f1ec":[[""],"","",["flag-gg"],1,56,15,0],"1f1ec-1f1ed":[[""],"","",["flag-gh"],1,57,15,0],"1f1ec-1f1ee":[[""],"","",["flag-gi"],1,58,15,0],"1f1ec-1f1f1":[[""],"","",["flag-gl"],1,59,15,0],"1f1ec-1f1f2":[[""],"","",["flag-gm"],2,0,15,0],"1f1ec-1f1f3":[[""],"","",["flag-gn"],2,1,15,0],"1f1ec-1f1f5":[[""],"","",["flag-gp"],2,2,15,0],"1f1ec-1f1f6":[[""],"","",["flag-gq"],2,3,15,0],"1f1ec-1f1f7":[[""],"","",["flag-gr"],2,4,15,0],"1f1ec-1f1f8":[[""],"","",["flag-gs"],2,5,15,0],"1f1ec-1f1f9":[[""],"","",["flag-gt"],2,6,15,0],"1f1ec-1f1fa":[[""],"","",["flag-gu"],2,7,15,0],"1f1ec-1f1fc":[[""],"","",["flag-gw"],2,8,15,0],"1f1ec-1f1fe":[[""],"","",["flag-gy"],2,9,15,0],"1f1ed-1f1f0":[[""],"","",["flag-hk"],2,10,15,0],"1f1ed-1f1f2":[[""],"","",["flag-hm"],2,11,15,0],"1f1ed-1f1f3":[[""],"","",["flag-hn"],2,12,15,0],"1f1ed-1f1f7":[[""],"","",["flag-hr"],2,13,15,0],"1f1ed-1f1f9":[[""],"","",["flag-ht"],2,14,15,0],"1f1ed-1f1fa":[[""],"","",["flag-hu"],2,15,15,0],"1f1ee-1f1e8":[[""],"","",["flag-ic"],2,16,15,0],"1f1ee-1f1e9":[[""],"","",["flag-id"],2,17,15,0],"1f1ee-1f1ea":[[""],"","",["flag-ie"],2,18,15,0],"1f1ee-1f1f1":[[""],"","",["flag-il"],2,19,15,0],"1f1ee-1f1f2":[[""],"","",["flag-im"],2,20,15,0],"1f1ee-1f1f3":[[""],"","",["flag-in"],2,21,15,0],"1f1ee-1f1f4":[[""],"","",["flag-io"],2,22,15,0],"1f1ee-1f1f6":[[""],"","",["flag-iq"],2,23,15,0],"1f1ee-1f1f7":[[""],"","",["flag-ir"],2,24,15,0],"1f1ee-1f1f8":[[""],"","",["flag-is"],2,25,15,0],"1f1ee-1f1f9":[[""],"","",["it","flag-it"],2,26,15,0],"1f1ef-1f1ea":[[""],"","",["flag-je"],2,27,15,0],"1f1ef-1f1f2":[[""],"","",["flag-jm"],2,28,15,0],"1f1ef-1f1f4":[[""],"","",["flag-jo"],2,29,15,0],"1f1ef-1f1f5":[[""],"","",["jp","flag-jp"],2,30,15,0],"1f1f0-1f1ea":[[""],"","",["flag-ke"],2,31,15,0],"1f1f0-1f1ec":[[""],"","",["flag-kg"],2,32,15,0],"1f1f0-1f1ed":[[""],"","",["flag-kh"],2,33,15,0],"1f1f0-1f1ee":[[""],"","",["flag-ki"],2,34,15,0],"1f1f0-1f1f2":[[""],"","",["flag-km"],2,35,15,0],"1f1f0-1f1f3":[[""],"","",["flag-kn"],2,36,15,0],"1f1f0-1f1f5":[[""],"","",["flag-kp"],2,37,15,0],"1f1f0-1f1f7":[[""],"","",["kr","flag-kr"],2,38,15,0],"1f1f0-1f1fc":[[""],"","",["flag-kw"],2,39,15,0],"1f1f0-1f1fe":[[""],"","",["flag-ky"],2,40,15,0],"1f1f0-1f1ff":[[""],"","",["flag-kz"],2,41,15,0],"1f1f1-1f1e6":[[""],"","",["flag-la"],2,42,15,0],"1f1f1-1f1e7":[[""],"","",["flag-lb"],2,43,15,0],"1f1f1-1f1e8":[[""],"","",["flag-lc"],2,44,15,0],"1f1f1-1f1ee":[[""],"","",["flag-li"],2,45,15,0],"1f1f1-1f1f0":[[""],"","",["flag-lk"],2,46,15,0],"1f1f1-1f1f7":[[""],"","",["flag-lr"],2,47,15,0],"1f1f1-1f1f8":[[""],"","",["flag-ls"],2,48,15,0],"1f1f1-1f1f9":[[""],"","",["flag-lt"],2,49,15,0],"1f1f1-1f1fa":[[""],"","",["flag-lu"],2,50,15,0],"1f1f1-1f1fb":[[""],"","",["flag-lv"],2,51,15,0],"1f1f1-1f1fe":[[""],"","",["flag-ly"],2,52,15,0],"1f1f2-1f1e6":[[""],"","",["flag-ma"],2,53,15,0],"1f1f2-1f1e8":[[""],"","",["flag-mc"],2,54,15,0],"1f1f2-1f1e9":[[""],"","",["flag-md"],2,55,15,0],"1f1f2-1f1ea":[[""],"","",["flag-me"],2,56,15,0],"1f1f2-1f1eb":[[""],"","",["flag-mf"],2,57,15,0],"1f1f2-1f1ec":[[""],"","",["flag-mg"],2,58,15,0],"1f1f2-1f1ed":[[""],"","",["flag-mh"],2,59,15,0],"1f1f2-1f1f0":[[""],"","",["flag-mk"],3,0,15,0],"1f1f2-1f1f1":[[""],"","",["flag-ml"],3,1,15,0],"1f1f2-1f1f2":[[""],"","",["flag-mm"],3,2,15,0],"1f1f2-1f1f3":[[""],"","",["flag-mn"],3,3,15,0],"1f1f2-1f1f4":[[""],"","",["flag-mo"],3,4,15,0],"1f1f2-1f1f5":[[""],"","",["flag-mp"],3,5,15,0],"1f1f2-1f1f6":[[""],"","",["flag-mq"],3,6,15,0],"1f1f2-1f1f7":[[""],"","",["flag-mr"],3,7,15,0],"1f1f2-1f1f8":[[""],"","",["flag-ms"],3,8,15,0],"1f1f2-1f1f9":[[""],"","",["flag-mt"],3,9,15,0],"1f1f2-1f1fa":[[""],"","",["flag-mu"],3,10,15,0],"1f1f2-1f1fb":[[""],"","",["flag-mv"],3,11,15,0],"1f1f2-1f1fc":[[""],"","",["flag-mw"],3,12,15,0],"1f1f2-1f1fd":[[""],"","",["flag-mx"],3,13,15,0],"1f1f2-1f1fe":[[""],"","",["flag-my"],3,14,15,0],"1f1f2-1f1ff":[[""],"","",["flag-mz"],3,15,15,0],"1f1f3-1f1e6":[[""],"","",["flag-na"],3,16,15,0],"1f1f3-1f1e8":[[""],"","",["flag-nc"],3,17,15,0],"1f1f3-1f1ea":[[""],"","",["flag-ne"],3,18,15,0],"1f1f3-1f1eb":[[""],"","",["flag-nf"],3,19,15,0],"1f1f3-1f1ec":[[""],"","",["flag-ng"],3,20,15,0],"1f1f3-1f1ee":[[""],"","",["flag-ni"],3,21,15,0],"1f1f3-1f1f1":[[""],"","",["flag-nl"],3,22,15,0],"1f1f3-1f1f4":[[""],"","",["flag-no"],3,23,15,0],"1f1f3-1f1f5":[[""],"","",["flag-np"],3,24,15,0],"1f1f3-1f1f7":[[""],"","",["flag-nr"],3,25,15,0],"1f1f3-1f1fa":[[""],"","",["flag-nu"],3,26,15,0],"1f1f3-1f1ff":[[""],"","",["flag-nz"],3,27,15,0],"1f1f4-1f1f2":[[""],"","",["flag-om"],3,28,15,0],"1f1f5-1f1e6":[[""],"","",["flag-pa"],3,29,15,0],"1f1f5-1f1ea":[[""],"","",["flag-pe"],3,30,15,0],"1f1f5-1f1eb":[[""],"","",["flag-pf"],3,31,15,0],"1f1f5-1f1ec":[[""],"","",["flag-pg"],3,32,15,0],"1f1f5-1f1ed":[[""],"","",["flag-ph"],3,33,15,0],"1f1f5-1f1f0":[[""],"","",["flag-pk"],3,34,15,0],"1f1f5-1f1f1":[[""],"","",["flag-pl"],3,35,15,0],"1f1f5-1f1f2":[[""],"","",["flag-pm"],3,36,15,0],"1f1f5-1f1f3":[[""],"","",["flag-pn"],3,37,15,0],"1f1f5-1f1f7":[[""],"","",["flag-pr"],3,38,15,0],"1f1f5-1f1f8":[[""],"","",["flag-ps"],3,39,15,0],"1f1f5-1f1f9":[[""],"","",["flag-pt"],3,40,15,0],"1f1f5-1f1fc":[[""],"","",["flag-pw"],3,41,15,0],"1f1f5-1f1fe":[[""],"","",["flag-py"],3,42,15,0],"1f1f6-1f1e6":[[""],"","",["flag-qa"],3,43,15,0],"1f1f7-1f1ea":[[""],"","",["flag-re"],3,44,15,0],"1f1f7-1f1f4":[[""],"","",["flag-ro"],3,45,15,0],"1f1f7-1f1f8":[[""],"","",["flag-rs"],3,46,15,0],"1f1f7-1f1fa":[[""],"","",["ru","flag-ru"],3,47,15,0],"1f1f7-1f1fc":[[""],"","",["flag-rw"],3,48,15,0],"1f1f8-1f1e6":[[""],"","",["flag-sa"],3,49,15,0],"1f1f8-1f1e7":[[""],"","",["flag-sb"],3,50,15,0],"1f1f8-1f1e8":[[""],"","",["flag-sc"],3,51,15,0],"1f1f8-1f1e9":[[""],"","",["flag-sd"],3,52,15,0],"1f1f8-1f1ea":[[""],"","",["flag-se"],3,53,15,0],"1f1f8-1f1ec":[[""],"","",["flag-sg"],3,54,15,0],"1f1f8-1f1ed":[[""],"","",["flag-sh"],3,55,15,0],"1f1f8-1f1ee":[[""],"","",["flag-si"],3,56,15,0],"1f1f8-1f1ef":[[""],"","",["flag-sj"],3,57,15,0],"1f1f8-1f1f0":[[""],"","",["flag-sk"],3,58,15,0],"1f1f8-1f1f1":[[""],"","",["flag-sl"],3,59,15,0],"1f1f8-1f1f2":[[""],"","",["flag-sm"],4,0,15,0],"1f1f8-1f1f3":[[""],"","",["flag-sn"],4,1,15,0],"1f1f8-1f1f4":[[""],"","",["flag-so"],4,2,15,0],"1f1f8-1f1f7":[[""],"","",["flag-sr"],4,3,15,0],"1f1f8-1f1f8":[[""],"","",["flag-ss"],4,4,15,0],"1f1f8-1f1f9":[[""],"","",["flag-st"],4,5,15,0],"1f1f8-1f1fb":[[""],"","",["flag-sv"],4,6,15,0],"1f1f8-1f1fd":[[""],"","",["flag-sx"],4,7,15,0],"1f1f8-1f1fe":[[""],"","",["flag-sy"],4,8,15,0],"1f1f8-1f1ff":[[""],"","",["flag-sz"],4,9,15,0],"1f1f9-1f1e6":[[""],"","",["flag-ta"],4,10,15,0],"1f1f9-1f1e8":[[""],"","",["flag-tc"],4,11,15,0],"1f1f9-1f1e9":[[""],"","",["flag-td"],4,12,15,0],"1f1f9-1f1eb":[[""],"","",["flag-tf"],4,13,15,0],"1f1f9-1f1ec":[[""],"","",["flag-tg"],4,14,15,0],"1f1f9-1f1ed":[[""],"","",["flag-th"],4,15,15,0],"1f1f9-1f1ef":[[""],"","",["flag-tj"],4,16,15,0],"1f1f9-1f1f0":[[""],"","",["flag-tk"],4,17,15,0],"1f1f9-1f1f1":[[""],"","",["flag-tl"],4,18,15,0],"1f1f9-1f1f2":[[""],"","",["flag-tm"],4,19,15,0],"1f1f9-1f1f3":[[""],"","",["flag-tn"],4,20,15,0],"1f1f9-1f1f4":[[""],"","",["flag-to"],4,21,15,0],"1f1f9-1f1f7":[[""],"","",["flag-tr"],4,22,15,0],"1f1f9-1f1f9":[[""],"","",["flag-tt"],4,23,15,0],"1f1f9-1f1fb":[[""],"","",["flag-tv"],4,24,15,0],"1f1f9-1f1fc":[[""],"","",["flag-tw"],4,25,15,0],"1f1f9-1f1ff":[[""],"","",["flag-tz"],4,26,15,0],"1f1fa-1f1e6":[[""],"","",["flag-ua"],4,27,15,0],"1f1fa-1f1ec":[[""],"","",["flag-ug"],4,28,15,0],"1f1fa-1f1f2":[[""],"","",["flag-um"],4,29,15,0],"1f1fa-1f1f3":[[""],"","",["flag-un"],4,30,15,0],"1f1fa-1f1f8":[[""],"","",["us","flag-us"],4,31,15,0],"1f1fa-1f1fe":[[""],"","",["flag-uy"],4,32,15,0],"1f1fa-1f1ff":[[""],"","",["flag-uz"],4,33,15,0],"1f1fb-1f1e6":[[""],"","",["flag-va"],4,34,15,0],"1f1fb-1f1e8":[[""],"","",["flag-vc"],4,35,15,0],"1f1fb-1f1ea":[[""],"","",["flag-ve"],4,36,15,0],"1f1fb-1f1ec":[[""],"","",["flag-vg"],4,37,15,0],"1f1fb-1f1ee":[[""],"","",["flag-vi"],4,38,15,0],"1f1fb-1f1f3":[[""],"","",["flag-vn"],4,39,15,0],"1f1fb-1f1fa":[[""],"","",["flag-vu"],4,40,15,0],"1f1fc-1f1eb":[[""],"","",["flag-wf"],4,41,15,0],"1f1fc-1f1f8":[[""],"","",["flag-ws"],4,42,15,0],"1f1fd-1f1f0":[[""],"","",["flag-xk"],4,43,15,0],"1f1fe-1f1ea":[[""],"","",["flag-ye"],4,44,15,0],"1f1fe-1f1f9":[[""],"","",["flag-yt"],4,45,15,0],"1f1ff-1f1e6":[[""],"","",["flag-za"],4,46,15,0],"1f1ff-1f1f2":[[""],"","",["flag-zm"],4,47,15,0],"1f1ff-1f1fc":[[""],"","",["flag-zw"],4,48,15,0],"1f201":[[""],"","",["koko"],4,49,15,0],"1f202-fe0f":[["",""],"","",["sa"],4,50,15,0],"1f21a":[[""],"","",["u7121"],4,51,15,0],"1f22f":[[""],"","",["u6307"],4,52,15,0],"1f232":[[""],"","",["u7981"],4,53,15,0],"1f233":[[""],"","",["u7a7a"],4,54,15,0],"1f234":[[""],"","",["u5408"],4,55,15,0],"1f235":[[""],"","",["u6e80"],4,56,15,0],"1f236":[[""],"","",["u6709"],4,57,15,0],"1f237-fe0f":[["",""],"","",["u6708"],4,58,15,0],"1f238":[[""],"","",["u7533"],4,59,15,0],"1f239":[[""],"","",["u5272"],5,0,15,0],"1f23a":[[""],"","",["u55b6"],5,1,15,0],"1f250":[[""],"","",["ideograph_advantage"],5,2,15,0],"1f251":[[""],"","",["accept"],5,3,15,0],"1f300":[[""],"","",["cyclone"],5,4,15,0],"1f301":[[""],"","",["foggy"],5,5,15,0],"1f302":[[""],"","",["closed_umbrella"],5,6,15,0],"1f303":[[""],"","",["night_with_stars"],5,7,15,0],"1f304":[[""],"","",["sunrise_over_mountains"],5,8,15,0],"1f305":[[""],"","",["sunrise"],5,9,15,0],"1f306":[[""],"","",["city_sunset"],5,10,15,0],"1f307":[[""],"","",["city_sunrise"],5,11,15,0],"1f308":[[""],"","",["rainbow"],5,12,15,0],"1f309":[[""],"","",["bridge_at_night"],5,13,15,0],"1f30a":[[""],"","",["ocean"],5,14,15,0],"1f30b":[[""],"","",["volcano"],5,15,15,0],"1f30c":[[""],"","",["milky_way"],5,16,15,0],"1f30d":[[""],"","",["earth_africa"],5,17,15,0],"1f30e":[[""],"","",["earth_americas"],5,18,15,0],"1f30f":[[""],"","",["earth_asia"],5,19,15,0],"1f310":[[""],"","",["globe_with_meridians"],5,20,15,0],"1f311":[[""],"","",["new_moon"],5,21,15,0],"1f312":[[""],"","",["waxing_crescent_moon"],5,22,15,0],"1f313":[[""],"","",["first_quarter_moon"],5,23,15,0],"1f314":[[""],"","",["moon","waxing_gibbous_moon"],5,24,15,0],"1f315":[[""],"","",["full_moon"],5,25,15,0],"1f316":[[""],"","",["waning_gibbous_moon"],5,26,15,0],"1f317":[[""],"","",["last_quarter_moon"],5,27,15,0],"1f318":[[""],"","",["waning_crescent_moon"],5,28,15,0],"1f319":[[""],"","",["crescent_moon"],5,29,15,0],"1f31a":[[""],"","",["new_moon_with_face"],5,30,15,0],"1f31b":[[""],"","",["first_quarter_moon_with_face"],5,31,15,0],"1f31c":[[""],"","",["last_quarter_moon_with_face"],5,32,15,0],"1f31d":[[""],"","",["full_moon_with_face"],5,33,15,0],"1f31e":[[""],"","",["sun_with_face"],5,34,15,0],"1f31f":[[""],"","",["star2"],5,35,15,0],"1f320":[[""],"","",["stars"],5,36,15,0],"1f321-fe0f":[["",""],"","",["thermometer"],5,37,15,0],"1f324-fe0f":[["",""],"","",["mostly_sunny","sun_small_cloud"],5,38,15,0],"1f325-fe0f":[["",""],"","",["barely_sunny","sun_behind_cloud"],5,39,15,0],"1f326-fe0f":[["",""],"","",["partly_sunny_rain","sun_behind_rain_cloud"],5,40,15,0],"1f327-fe0f":[["",""],"","",["rain_cloud"],5,41,15,0],"1f328-fe0f":[["",""],"","",["snow_cloud"],5,42,15,0],"1f329-fe0f":[["",""],"","",["lightning","lightning_cloud"],5,43,15,0],"1f32a-fe0f":[["",""],"","",["tornado","tornado_cloud"],5,44,15,0],"1f32b-fe0f":[["",""],"","",["fog"],5,45,15,0],"1f32c-fe0f":[["",""],"","",["wind_blowing_face"],5,46,15,0],"1f32d":[[""],"","",["hotdog"],5,47,15,0],"1f32e":[[""],"","",["taco"],5,48,15,0],"1f32f":[[""],"","",["burrito"],5,49,15,0],"1f330":[[""],"","",["chestnut"],5,50,15,0],"1f331":[[""],"","",["seedling"],5,51,15,0],"1f332":[[""],"","",["evergreen_tree"],5,52,15,0],"1f333":[[""],"","",["deciduous_tree"],5,53,15,0],"1f334":[[""],"","",["palm_tree"],5,54,15,0],"1f335":[[""],"","",["cactus"],5,55,15,0],"1f336-fe0f":[["",""],"","",["hot_pepper"],5,56,15,0],"1f337":[[""],"","",["tulip"],5,57,15,0],"1f338":[[""],"","",["cherry_blossom"],5,58,15,0],"1f339":[[""],"","",["rose"],5,59,15,0],"1f33a":[[""],"","",["hibiscus"],6,0,15,0],"1f33b":[[""],"","",["sunflower"],6,1,15,0],"1f33c":[[""],"","",["blossom"],6,2,15,0],"1f33d":[[""],"","",["corn"],6,3,15,0],"1f33e":[[""],"","",["ear_of_rice"],6,4,15,0],"1f33f":[[""],"","",["herb"],6,5,15,0],"1f340":[[""],"","",["four_leaf_clover"],6,6,15,0],"1f341":[[""],"","",["maple_leaf"],6,7,15,0],"1f342":[[""],"","",["fallen_leaf"],6,8,15,0],"1f343":[[""],"","",["leaves"],6,9,15,0],"1f344":[[""],"","",["mushroom"],6,10,15,0],"1f345":[[""],"","",["tomato"],6,11,15,0],"1f346":[[""],"","",["eggplant"],6,12,15,0],"1f347":[[""],"","",["grapes"],6,13,15,0],"1f348":[[""],"","",["melon"],6,14,15,0],"1f349":[[""],"","",["watermelon"],6,15,15,0],"1f34a":[[""],"","",["tangerine"],6,16,15,0],"1f34b":[[""],"","",["lemon"],6,17,15,0],"1f34c":[[""],"","",["banana"],6,18,15,0],"1f34d":[[""],"","",["pineapple"],6,19,15,0],"1f34e":[[""],"","",["apple"],6,20,15,0],"1f34f":[[""],"","",["green_apple"],6,21,15,0],"1f350":[[""],"","",["pear"],6,22,15,0],"1f351":[[""],"","",["peach"],6,23,15,0],"1f352":[[""],"","",["cherries"],6,24,15,0],"1f353":[[""],"","",["strawberry"],6,25,15,0],"1f354":[[""],"","",["hamburger"],6,26,15,0],"1f355":[[""],"","",["pizza"],6,27,15,0],"1f356":[[""],"","",["meat_on_bone"],6,28,15,0],"1f357":[[""],"","",["poultry_leg"],6,29,15,0],"1f358":[[""],"","",["rice_cracker"],6,30,15,0],"1f359":[[""],"","",["rice_ball"],6,31,15,0],"1f35a":[[""],"","",["rice"],6,32,15,0],"1f35b":[[""],"","",["curry"],6,33,15,0],"1f35c":[[""],"","",["ramen"],6,34,15,0],"1f35d":[[""],"","",["spaghetti"],6,35,15,0],"1f35e":[[""],"","",["bread"],6,36,15,0],"1f35f":[[""],"","",["fries"],6,37,15,0],"1f360":[[""],"","",["sweet_potato"],6,38,15,0],"1f361":[[""],"","",["dango"],6,39,15,0],"1f362":[[""],"","",["oden"],6,40,15,0],"1f363":[[""],"","",["sushi"],6,41,15,0],"1f364":[[""],"","",["fried_shrimp"],6,42,15,0],"1f365":[[""],"","",["fish_cake"],6,43,15,0],"1f366":[[""],"","",["icecream"],6,44,15,0],"1f367":[[""],"","",["shaved_ice"],6,45,15,0],"1f368":[[""],"","",["ice_cream"],6,46,15,0],"1f369":[[""],"","",["doughnut"],6,47,15,0],"1f36a":[[""],"","",["cookie"],6,48,15,0],"1f36b":[[""],"","",["chocolate_bar"],6,49,15,0],"1f36c":[[""],"","",["candy"],6,50,15,0],"1f36d":[[""],"","",["lollipop"],6,51,15,0],"1f36e":[[""],"","",["custard"],6,52,15,0],"1f36f":[[""],"","",["honey_pot"],6,53,15,0],"1f370":[[""],"","",["cake"],6,54,15,0],"1f371":[[""],"","",["bento"],6,55,15,0],"1f372":[[""],"","",["stew"],6,56,15,0],"1f373":[[""],"","",["fried_egg","cooking"],6,57,15,0],"1f374":[[""],"","",["fork_and_knife"],6,58,15,0],"1f375":[[""],"","",["tea"],6,59,15,0],"1f376":[[""],"","",["sake"],7,0,15,0],"1f377":[[""],"","",["wine_glass"],7,1,15,0],"1f378":[[""],"","",["cocktail"],7,2,15,0],"1f379":[[""],"","",["tropical_drink"],7,3,15,0],"1f37a":[[""],"","",["beer"],7,4,15,0],"1f37b":[[""],"","",["beers"],7,5,15,0],"1f37c":[[""],"","",["baby_bottle"],7,6,15,0],"1f37d-fe0f":[["",""],"","",["knife_fork_plate"],7,7,15,0],"1f37e":[[""],"","",["champagne"],7,8,15,0],"1f37f":[[""],"","",["popcorn"],7,9,15,0],"1f380":[[""],"","",["ribbon"],7,10,15,0],"1f381":[[""],"","",["gift"],7,11,15,0],"1f382":[[""],"","",["birthday"],7,12,15,0],"1f383":[[""],"","",["jack_o_lantern"],7,13,15,0],"1f384":[[""],"","",["christmas_tree"],7,14,15,0],"1f385":[[""],"","",["santa"],7,15,15,0],"1f386":[[""],"","",["fireworks"],7,21,15,0],"1f387":[[""],"","",["sparkler"],7,22,15,0],"1f388":[[""],"","",["balloon"],7,23,15,0],"1f389":[[""],"","",["tada"],7,24,15,0],"1f38a":[[""],"","",["confetti_ball"],7,25,15,0],"1f38b":[[""],"","",["tanabata_tree"],7,26,15,0],"1f38c":[[""],"","",["crossed_flags"],7,27,15,0],"1f38d":[[""],"","",["bamboo"],7,28,15,0],"1f38e":[[""],"","",["dolls"],7,29,15,0],"1f38f":[[""],"","",["flags"],7,30,15,0],"1f390":[[""],"","",["wind_chime"],7,31,15,0],"1f391":[[""],"","",["rice_scene"],7,32,15,0],"1f392":[[""],"","",["school_satchel"],7,33,15,0],"1f393":[[""],"","",["mortar_board"],7,34,15,0],"1f396-fe0f":[["",""],"","",["medal"],7,35,15,0],"1f397-fe0f":[["",""],"","",["reminder_ribbon"],7,36,15,0],"1f399-fe0f":[["",""],"","",["studio_microphone"],7,37,15,0],"1f39a-fe0f":[["",""],"","",["level_slider"],7,38,15,0],"1f39b-fe0f":[["",""],"","",["control_knobs"],7,39,15,0],"1f39e-fe0f":[["",""],"","",["film_frames"],7,40,15,0],"1f39f-fe0f":[["",""],"","",["admission_tickets"],7,41,15,0],"1f3a0":[[""],"","",["carousel_horse"],7,42,15,0],"1f3a1":[[""],"","",["ferris_wheel"],7,43,15,0],"1f3a2":[[""],"","",["roller_coaster"],7,44,15,0],"1f3a3":[[""],"","",["fishing_pole_and_fish"],7,45,15,0],"1f3a4":[[""],"","",["microphone"],7,46,15,0],"1f3a5":[[""],"","",["movie_camera"],7,47,15,0],"1f3a6":[[""],"","",["cinema"],7,48,15,0],"1f3a7":[[""],"","",["headphones"],7,49,15,0],"1f3a8":[[""],"","",["art"],7,50,15,0],"1f3a9":[[""],"","",["tophat"],7,51,15,0],"1f3aa":[[""],"","",["circus_tent"],7,52,15,0],"1f3ab":[[""],"","",["ticket"],7,53,15,0],"1f3ac":[[""],"","",["clapper"],7,54,15,0],"1f3ad":[[""],"","",["performing_arts"],7,55,15,0],"1f3ae":[[""],"","",["video_game"],7,56,15,0],"1f3af":[[""],"","",["dart"],7,57,15,0],"1f3b0":[[""],"","",["slot_machine"],7,58,15,0],"1f3b1":[[""],"","",["8ball"],7,59,15,0],"1f3b2":[[""],"","",["game_die"],8,0,15,0],"1f3b3":[[""],"","",["bowling"],8,1,15,0],"1f3b4":[[""],"","",["flower_playing_cards"],8,2,15,0],"1f3b5":[[""],"","",["musical_note"],8,3,15,0],"1f3b6":[[""],"","",["notes"],8,4,15,0],"1f3b7":[[""],"","",["saxophone"],8,5,15,0],"1f3b8":[[""],"","",["guitar"],8,6,15,0],"1f3b9":[[""],"","",["musical_keyboard"],8,7,15,0],"1f3ba":[[""],"","",["trumpet"],8,8,15,0],"1f3bb":[[""],"","",["violin"],8,9,15,0],"1f3bc":[[""],"","",["musical_score"],8,10,15,0],"1f3bd":[[""],"","",["running_shirt_with_sash"],8,11,15,0],"1f3be":[[""],"","",["tennis"],8,12,15,0],"1f3bf":[[""],"","",["ski"],8,13,15,0],"1f3c0":[[""],"","",["basketball"],8,14,15,0],"1f3c1":[[""],"","",["checkered_flag"],8,15,15,0],"1f3c2":[[""],"","",["snowboarder"],8,16,15,0],"1f3c3-200d-2640-fe0f":[["",""],"","",["woman-running"],8,22,15,0],"1f3c3-200d-2642-fe0f":[["","",""],"","",["man-running","runner","running"],8,28,15,0],"1f3c4-200d-2640-fe0f":[["",""],"","",["woman-surfing"],8,40,15,0],"1f3c4-200d-2642-fe0f":[["","",""],"","",["man-surfing","surfer"],8,46,15,0],"1f3c5":[[""],"","",["sports_medal"],8,58,15,0],"1f3c6":[[""],"","",["trophy"],8,59,15,0],"1f3c7":[[""],"","",["horse_racing"],9,0,15,0],"1f3c8":[[""],"","",["football"],9,6,15,0],"1f3c9":[[""],"","",["rugby_football"],9,7,15,0],"1f3ca-200d-2640-fe0f":[["",""],"","",["woman-swimming"],9,8,15,0],"1f3ca-200d-2642-fe0f":[["","",""],"","",["man-swimming","swimmer"],9,14,15,0],"1f3cb-fe0f-200d-2640-fe0f":[[""],"","",["woman-lifting-weights"],9,26,7,0],"1f3cb-fe0f-200d-2642-fe0f":[["","",""],"","",["man-lifting-weights","weight_lifter"],9,32,7,0],"1f3cc-fe0f-200d-2640-fe0f":[[""],"","",["woman-golfing"],9,44,7,0],"1f3cc-fe0f-200d-2642-fe0f":[["","",""],"","",["man-golfing","golfer"],9,50,7,0],"1f3cd-fe0f":[["",""],"","",["racing_motorcycle"],10,2,15,0],"1f3ce-fe0f":[["",""],"","",["racing_car"],10,3,15,0],"1f3cf":[[""],"","",["cricket_bat_and_ball"],10,4,15,0],"1f3d0":[[""],"","",["volleyball"],10,5,15,0],"1f3d1":[[""],"","",["field_hockey_stick_and_ball"],10,6,15,0],"1f3d2":[[""],"","",["ice_hockey_stick_and_puck"],10,7,15,0],"1f3d3":[[""],"","",["table_tennis_paddle_and_ball"],10,8,15,0],"1f3d4-fe0f":[["",""],"","",["snow_capped_mountain"],10,9,15,0],"1f3d5-fe0f":[["",""],"","",["camping"],10,10,15,0],"1f3d6-fe0f":[["",""],"","",["beach_with_umbrella"],10,11,15,0],"1f3d7-fe0f":[["",""],"","",["building_construction"],10,12,15,0],"1f3d8-fe0f":[["",""],"","",["house_buildings"],10,13,15,0],"1f3d9-fe0f":[["",""],"","",["cityscape"],10,14,15,0],"1f3da-fe0f":[["",""],"","",["derelict_house_building"],10,15,15,0],"1f3db-fe0f":[["",""],"","",["classical_building"],10,16,15,0],"1f3dc-fe0f":[["",""],"","",["desert"],10,17,15,0],"1f3dd-fe0f":[["",""],"","",["desert_island"],10,18,15,0],"1f3de-fe0f":[["",""],"","",["national_park"],10,19,15,0],"1f3df-fe0f":[["",""],"","",["stadium"],10,20,15,0],"1f3e0":[[""],"","",["house"],10,21,15,0],"1f3e1":[[""],"","",["house_with_garden"],10,22,15,0],"1f3e2":[[""],"","",["office"],10,23,15,0],"1f3e3":[[""],"","",["post_office"],10,24,15,0],"1f3e4":[[""],"","",["european_post_office"],10,25,15,0],"1f3e5":[[""],"","",["hospital"],10,26,15,0],"1f3e6":[[""],"","",["bank"],10,27,15,0],"1f3e7":[[""],"","",["atm"],10,28,15,0],"1f3e8":[[""],"","",["hotel"],10,29,15,0],"1f3e9":[[""],"","",["love_hotel"],10,30,15,0],"1f3ea":[[""],"","",["convenience_store"],10,31,15,0],"1f3eb":[[""],"","",["school"],10,32,15,0],"1f3ec":[[""],"","",["department_store"],10,33,15,0],"1f3ed":[[""],"","",["factory"],10,34,15,0],"1f3ee":[[""],"","",["izakaya_lantern","lantern"],10,35,15,0],"1f3ef":[[""],"","",["japanese_castle"],10,36,15,0],"1f3f0":[[""],"","",["european_castle"],10,37,15,0],"1f3f3-fe0f-200d-1f308":[["",""],"","",["rainbow-flag"],10,38,15,0],"1f3f3-fe0f-200d-26a7-fe0f":[[""],"","",["transgender_flag"],10,39,7,0],"1f3f3-fe0f":[["",""],"","",["waving_white_flag"],10,40,15,0],"1f3f4-200d-2620-fe0f":[["",""],"","",["pirate_flag"],10,41,15,0],"1f3f4-e0067-e0062-e0065-e006e-e0067-e007f":[[""],"","",["flag-england"],10,42,15,0],"1f3f4-e0067-e0062-e0073-e0063-e0074-e007f":[[""],"","",["flag-scotland"],10,43,15,0],"1f3f4-e0067-e0062-e0077-e006c-e0073-e007f":[[""],"","",["flag-wales"],10,44,15,0],"1f3f4":[[""],"","",["waving_black_flag"],10,45,15,0],"1f3f5-fe0f":[["",""],"","",["rosette"],10,46,15,0],"1f3f7-fe0f":[["",""],"","",["label"],10,47,15,0],"1f3f8":[[""],"","",["badminton_racquet_and_shuttlecock"],10,48,15,0],"1f3f9":[[""],"","",["bow_and_arrow"],10,49,15,0],"1f3fa":[[""],"","",["amphora"],10,50,15,0],"1f3fb":[[""],"","",["skin-tone-2"],10,51,15,0],"1f3fc":[[""],"","",["skin-tone-3"],10,52,15,0],"1f3fd":[[""],"","",["skin-tone-4"],10,53,15,0],"1f3fe":[[""],"","",["skin-tone-5"],10,54,15,0],"1f3ff":[[""],"","",["skin-tone-6"],10,55,15,0],"1f400":[[""],"","",["rat"],10,56,15,0],"1f401":[[""],"","",["mouse2"],10,57,15,0],"1f402":[[""],"","",["ox"],10,58,15,0],"1f403":[[""],"","",["water_buffalo"],10,59,15,0],"1f404":[[""],"","",["cow2"],11,0,15,0],"1f405":[[""],"","",["tiger2"],11,1,15,0],"1f406":[[""],"","",["leopard"],11,2,15,0],"1f407":[[""],"","",["rabbit2"],11,3,15,0],"1f408-200d-2b1b":[[""],"","",["black_cat"],11,4,15,0],"1f408":[[""],"","",["cat2"],11,5,15,0],"1f409":[[""],"","",["dragon"],11,6,15,0],"1f40a":[[""],"","",["crocodile"],11,7,15,0],"1f40b":[[""],"","",["whale2"],11,8,15,0],"1f40c":[[""],"","",["snail"],11,9,15,0],"1f40d":[[""],"","",["snake"],11,10,15,0],"1f40e":[[""],"","",["racehorse"],11,11,15,0],"1f40f":[[""],"","",["ram"],11,12,15,0],"1f410":[[""],"","",["goat"],11,13,15,0],"1f411":[[""],"","",["sheep"],11,14,15,0],"1f412":[[""],"","",["monkey"],11,15,15,0],"1f413":[[""],"","",["rooster"],11,16,15,0],"1f414":[[""],"","",["chicken"],11,17,15,0],"1f415-200d-1f9ba":[[""],"","",["service_dog"],11,18,15,0],"1f415":[[""],"","",["dog2"],11,19,15,0],"1f416":[[""],"","",["pig2"],11,20,15,0],"1f417":[[""],"","",["boar"],11,21,15,0],"1f418":[[""],"","",["elephant"],11,22,15,0],"1f419":[[""],"","",["octopus"],11,23,15,0],"1f41a":[[""],"","",["shell"],11,24,15,0],"1f41b":[[""],"","",["bug"],11,25,15,0],"1f41c":[[""],"","",["ant"],11,26,15,0],"1f41d":[[""],"","",["bee","honeybee"],11,27,15,0],"1f41e":[[""],"","",["ladybug","lady_beetle"],11,28,15,0],"1f41f":[[""],"","",["fish"],11,29,15,0],"1f420":[[""],"","",["tropical_fish"],11,30,15,0],"1f421":[[""],"","",["blowfish"],11,31,15,0],"1f422":[[""],"","",["turtle"],11,32,15,0],"1f423":[[""],"","",["hatching_chick"],11,33,15,0],"1f424":[[""],"","",["baby_chick"],11,34,15,0],"1f425":[[""],"","",["hatched_chick"],11,35,15,0],"1f426":[[""],"","",["bird"],11,36,15,0],"1f427":[[""],"","",["penguin"],11,37,15,0],"1f428":[[""],"","",["koala"],11,38,15,0],"1f429":[[""],"","",["poodle"],11,39,15,0],"1f42a":[[""],"","",["dromedary_camel"],11,40,15,0],"1f42b":[[""],"","",["camel"],11,41,15,0],"1f42c":[[""],"","",["dolphin","flipper"],11,42,15,0],"1f42d":[[""],"","",["mouse"],11,43,15,0],"1f42e":[[""],"","",["cow"],11,44,15,0],"1f42f":[[""],"","",["tiger"],11,45,15,0],"1f430":[[""],"","",["rabbit"],11,46,15,0],"1f431":[[""],"","",["cat"],11,47,15,0],"1f432":[[""],"","",["dragon_face"],11,48,15,0],"1f433":[[""],"","",["whale"],11,49,15,0],"1f434":[[""],"","",["horse"],11,50,15,0],"1f435":[[""],"","",["monkey_face"],11,51,15,0],"1f436":[[""],"","",["dog"],11,52,15,0],"1f437":[[""],"","",["pig"],11,53,15,0],"1f438":[[""],"","",["frog"],11,54,15,0],"1f439":[[""],"","",["hamster"],11,55,15,0],"1f43a":[[""],"","",["wolf"],11,56,15,0],"1f43b-200d-2744-fe0f":[["",""],"","",["polar_bear"],11,57,15,0],"1f43b":[[""],"","",["bear"],11,58,15,0],"1f43c":[[""],"","",["panda_face"],11,59,15,0],"1f43d":[[""],"","",["pig_nose"],12,0,15,0],"1f43e":[[""],"","",["feet","paw_prints"],12,1,15,0],"1f43f-fe0f":[["",""],"","",["chipmunk"],12,2,15,0],"1f440":[[""],"","",["eyes"],12,3,15,0],"1f441-fe0f-200d-1f5e8-fe0f":[[""],"","",["eye-in-speech-bubble"],12,4,7,0],"1f441-fe0f":[["",""],"","",["eye"],12,5,15,0],"1f442":[[""],"","",["ear"],12,6,15,0],"1f443":[[""],"","",["nose"],12,12,15,0],"1f444":[[""],"","",["lips"],12,18,15,0],"1f445":[[""],"","",["tongue"],12,19,15,0],"1f446":[[""],"","",["point_up_2"],12,20,15,0],"1f447":[[""],"","",["point_down"],12,26,15,0],"1f448":[[""],"","",["point_left"],12,32,15,0],"1f449":[[""],"","",["point_right"],12,38,15,0],"1f44a":[[""],"","",["facepunch","punch"],12,44,15,0],"1f44b":[[""],"","",["wave"],12,50,15,0],"1f44c":[[""],"","",["ok_hand"],12,56,15,0],"1f44d":[[""],"","",["+1","thumbsup"],13,2,15,0],"1f44e":[[""],"","",["-1","thumbsdown"],13,8,15,0],"1f44f":[[""],"","",["clap"],13,14,15,0],"1f450":[[""],"","",["open_hands"],13,20,15,0],"1f451":[[""],"","",["crown"],13,26,15,0],"1f452":[[""],"","",["womans_hat"],13,27,15,0],"1f453":[[""],"","",["eyeglasses"],13,28,15,0],"1f454":[[""],"","",["necktie"],13,29,15,0],"1f455":[[""],"","",["shirt","tshirt"],13,30,15,0],"1f456":[[""],"","",["jeans"],13,31,15,0],"1f457":[[""],"","",["dress"],13,32,15,0],"1f458":[[""],"","",["kimono"],13,33,15,0],"1f459":[[""],"","",["bikini"],13,34,15,0],"1f45a":[[""],"","",["womans_clothes"],13,35,15,0],"1f45b":[[""],"","",["purse"],13,36,15,0],"1f45c":[[""],"","",["handbag"],13,37,15,0],"1f45d":[[""],"","",["pouch"],13,38,15,0],"1f45e":[[""],"","",["mans_shoe","shoe"],13,39,15,0],"1f45f":[[""],"","",["athletic_shoe"],13,40,15,0],"1f460":[[""],"","",["high_heel"],13,41,15,0],"1f461":[[""],"","",["sandal"],13,42,15,0],"1f462":[[""],"","",["boot"],13,43,15,0],"1f463":[[""],"","",["footprints"],13,44,15,0],"1f464":[[""],"","",["bust_in_silhouette"],13,45,15,0],"1f465":[[""],"","",["busts_in_silhouette"],13,46,15,0],"1f466":[[""],"","",["boy"],13,47,15,0],"1f467":[[""],"","",["girl"],13,53,15,0],"1f468-200d-1f33e":[[""],"","",["male-farmer"],13,59,15,0],"1f468-200d-1f373":[[""],"","",["male-cook"],14,5,15,0],"1f468-200d-1f37c":[[""],"","",["man_feeding_baby"],14,11,15,0],"1f468-200d-1f393":[[""],"","",["male-student"],14,17,15,0],"1f468-200d-1f3a4":[[""],"","",["male-singer"],14,23,15,0],"1f468-200d-1f3a8":[[""],"","",["male-artist"],14,29,15,0],"1f468-200d-1f3eb":[[""],"","",["male-teacher"],14,35,15,0],"1f468-200d-1f3ed":[[""],"","",["male-factory-worker"],14,41,15,0],"1f468-200d-1f466-200d-1f466":[[""],"","",["man-boy-boy"],14,47,15,0],"1f468-200d-1f466":[[""],"","",["man-boy"],14,48,15,0],"1f468-200d-1f467-200d-1f466":[[""],"","",["man-girl-boy"],14,49,15,0],"1f468-200d-1f467-200d-1f467":[[""],"","",["man-girl-girl"],14,50,15,0],"1f468-200d-1f467":[[""],"","",["man-girl"],14,51,15,0],"1f468-200d-1f468-200d-1f466":[[""],"","",["man-man-boy"],14,52,15,0],"1f468-200d-1f468-200d-1f466-200d-1f466":[[""],"","",["man-man-boy-boy"],14,53,15,0],"1f468-200d-1f468-200d-1f467":[[""],"","",["man-man-girl"],14,54,15,0],"1f468-200d-1f468-200d-1f467-200d-1f466":[[""],"","",["man-man-girl-boy"],14,55,15,0],"1f468-200d-1f468-200d-1f467-200d-1f467":[[""],"","",["man-man-girl-girl"],14,56,15,0],"1f468-200d-1f469-200d-1f466":[["",""],"","",["man-woman-boy","family"],14,57,15,0],"1f468-200d-1f469-200d-1f466-200d-1f466":[[""],"","",["man-woman-boy-boy"],14,58,15,0],"1f468-200d-1f469-200d-1f467":[[""],"","",["man-woman-girl"],14,59,15,0],"1f468-200d-1f469-200d-1f467-200d-1f466":[[""],"","",["man-woman-girl-boy"],15,0,15,0],"1f468-200d-1f469-200d-1f467-200d-1f467":[[""],"","",["man-woman-girl-girl"],15,1,15,0],"1f468-200d-1f4bb":[[""],"","",["male-technologist"],15,2,15,0],"1f468-200d-1f4bc":[[""],"","",["male-office-worker"],15,8,15,0],"1f468-200d-1f527":[[""],"","",["male-mechanic"],15,14,15,0],"1f468-200d-1f52c":[[""],"","",["male-scientist"],15,20,15,0],"1f468-200d-1f680":[[""],"","",["male-astronaut"],15,26,15,0],"1f468-200d-1f692":[[""],"","",["male-firefighter"],15,32,15,0],"1f468-200d-1f9af":[[""],"","",["man_with_probing_cane"],15,38,15,0],"1f468-200d-1f9b0":[[""],"","",["red_haired_man"],15,44,15,0],"1f468-200d-1f9b1":[[""],"","",["curly_haired_man"],15,50,15,0],"1f468-200d-1f9b2":[[""],"","",["bald_man"],15,56,15,0],"1f468-200d-1f9b3":[[""],"","",["white_haired_man"],16,2,15,0],"1f468-200d-1f9bc":[[""],"","",["man_in_motorized_wheelchair"],16,8,15,0],"1f468-200d-1f9bd":[[""],"","",["man_in_manual_wheelchair"],16,14,15,0],"1f468-200d-2695-fe0f":[["",""],"","",["male-doctor"],16,20,15,0],"1f468-200d-2696-fe0f":[["",""],"","",["male-judge"],16,26,15,0],"1f468-200d-2708-fe0f":[["",""],"","",["male-pilot"],16,32,15,0],"1f468-200d-2764-fe0f-200d-1f468":[["",""],"","",["man-heart-man"],16,38,15,0],"1f468-200d-2764-fe0f-200d-1f48b-200d-1f468":[["",""],"","",["man-kiss-man"],17,4,15,0],"1f468":[[""],"","",["man"],17,30,15,0],"1f469-200d-1f33e":[[""],"","",["female-farmer"],17,36,15,0],"1f469-200d-1f373":[[""],"","",["female-cook"],17,42,15,0],"1f469-200d-1f37c":[[""],"","",["woman_feeding_baby"],17,48,15,0],"1f469-200d-1f393":[[""],"","",["female-student"],17,54,15,0],"1f469-200d-1f3a4":[[""],"","",["female-singer"],18,0,15,0],"1f469-200d-1f3a8":[[""],"","",["female-artist"],18,6,15,0],"1f469-200d-1f3eb":[[""],"","",["female-teacher"],18,12,15,0],"1f469-200d-1f3ed":[[""],"","",["female-factory-worker"],18,18,15,0],"1f469-200d-1f466-200d-1f466":[[""],"","",["woman-boy-boy"],18,24,15,0],"1f469-200d-1f466":[[""],"","",["woman-boy"],18,25,15,0],"1f469-200d-1f467-200d-1f466":[[""],"","",["woman-girl-boy"],18,26,15,0],"1f469-200d-1f467-200d-1f467":[[""],"","",["woman-girl-girl"],18,27,15,0],"1f469-200d-1f467":[[""],"","",["woman-girl"],18,28,15,0],"1f469-200d-1f469-200d-1f466":[[""],"","",["woman-woman-boy"],18,29,15,0],"1f469-200d-1f469-200d-1f466-200d-1f466":[[""],"","",["woman-woman-boy-boy"],18,30,15,0],"1f469-200d-1f469-200d-1f467":[[""],"","",["woman-woman-girl"],18,31,15,0],"1f469-200d-1f469-200d-1f467-200d-1f466":[[""],"","",["woman-woman-girl-boy"],18,32,15,0],"1f469-200d-1f469-200d-1f467-200d-1f467":[[""],"","",["woman-woman-girl-girl"],18,33,15,0],"1f469-200d-1f4bb":[[""],"","",["female-technologist"],18,34,15,0],"1f469-200d-1f4bc":[[""],"","",["female-office-worker"],18,40,15,0],"1f469-200d-1f527":[[""],"","",["female-mechanic"],18,46,15,0],"1f469-200d-1f52c":[[""],"","",["female-scientist"],18,52,15,0],"1f469-200d-1f680":[[""],"","",["female-astronaut"],18,58,15,0],"1f469-200d-1f692":[[""],"","",["female-firefighter"],19,4,15,0],"1f469-200d-1f9af":[[""],"","",["woman_with_probing_cane"],19,10,15,0],"1f469-200d-1f9b0":[[""],"","",["red_haired_woman"],19,16,15,0],"1f469-200d-1f9b1":[[""],"","",["curly_haired_woman"],19,22,15,0],"1f469-200d-1f9b2":[[""],"","",["bald_woman"],19,28,15,0],"1f469-200d-1f9b3":[[""],"","",["white_haired_woman"],19,34,15,0],"1f469-200d-1f9bc":[[""],"","",["woman_in_motorized_wheelchair"],19,40,15,0],"1f469-200d-1f9bd":[[""],"","",["woman_in_manual_wheelchair"],19,46,15,0],"1f469-200d-2695-fe0f":[["",""],"","",["female-doctor"],19,52,15,0],"1f469-200d-2696-fe0f":[["",""],"","",["female-judge"],19,58,15,0],"1f469-200d-2708-fe0f":[["",""],"","",["female-pilot"],20,4,15,0],"1f469-200d-2764-fe0f-200d-1f468":[["",""],"","",["woman-heart-man"],20,10,15,0],"1f469-200d-2764-fe0f-200d-1f469":[["",""],"","",["woman-heart-woman"],20,36,15,0],"1f469-200d-2764-fe0f-200d-1f48b-200d-1f468":[["",""],"","",["woman-kiss-man"],21,2,15,0],"1f469-200d-2764-fe0f-200d-1f48b-200d-1f469":[["",""],"","",["woman-kiss-woman"],21,28,15,0],"1f469":[[""],"","",["woman"],21,54,15,0],"1f46b":[[""],"","",["man_and_woman_holding_hands","woman_and_man_holding_hands","couple"],22,1,15,0],"1f46c":[[""],"","",["two_men_holding_hands","men_holding_hands"],22,27,15,0],"1f46d":[[""],"","",["two_women_holding_hands","women_holding_hands"],22,53,15,0],"1f46e-200d-2640-fe0f":[["",""],"","",["female-police-officer"],23,19,15,0],"1f46e-200d-2642-fe0f":[["","",""],"","",["male-police-officer","cop"],23,25,15,0],"1f46f-200d-2640-fe0f":[["","",""],"","",["women-with-bunny-ears-partying","woman-with-bunny-ears-partying","dancers"],23,37,15,0],"1f46f-200d-2642-fe0f":[["",""],"","",["men-with-bunny-ears-partying","man-with-bunny-ears-partying"],23,38,15,0],"1f470-200d-2640-fe0f":[["",""],"","",["woman_with_veil"],23,40,15,0],"1f470-200d-2642-fe0f":[["",""],"","",["man_with_veil"],23,46,15,0],"1f470":[[""],"","",["bride_with_veil"],23,52,15,0],"1f471-200d-2640-fe0f":[["",""],"","",["blond-haired-woman"],23,58,15,0],"1f471-200d-2642-fe0f":[["","",""],"","",["blond-haired-man","person_with_blond_hair"],24,4,15,0],"1f472":[[""],"","",["man_with_gua_pi_mao"],24,16,15,0],"1f473-200d-2640-fe0f":[["",""],"","",["woman-wearing-turban"],24,22,15,0],"1f473-200d-2642-fe0f":[["","",""],"","",["man-wearing-turban","man_with_turban"],24,28,15,0],"1f474":[[""],"","",["older_man"],24,40,15,0],"1f475":[[""],"","",["older_woman"],24,46,15,0],"1f476":[[""],"","",["baby"],24,52,15,0],"1f477-200d-2640-fe0f":[["",""],"","",["female-construction-worker"],24,58,15,0],"1f477-200d-2642-fe0f":[["","",""],"","",["male-construction-worker","construction_worker"],25,4,15,0],"1f478":[[""],"","",["princess"],25,16,15,0],"1f479":[[""],"","",["japanese_ogre"],25,22,15,0],"1f47a":[[""],"","",["japanese_goblin"],25,23,15,0],"1f47b":[[""],"","",["ghost"],25,24,15,0],"1f47c":[[""],"","",["angel"],25,25,15,0],"1f47d":[[""],"","",["alien"],25,31,15,0],"1f47e":[[""],"","",["space_invader"],25,32,15,0],"1f47f":[[""],"","",["imp"],25,33,15,0],"1f480":[[""],"","",["skull"],25,34,15,0],"1f481-200d-2640-fe0f":[["","",""],"","",["woman-tipping-hand","information_desk_person"],25,35,15,0],"1f481-200d-2642-fe0f":[["",""],"","",["man-tipping-hand"],25,41,15,0],"1f482-200d-2640-fe0f":[["",""],"","",["female-guard"],25,53,15,0],"1f482-200d-2642-fe0f":[["","",""],"","",["male-guard","guardsman"],25,59,15,0],"1f483":[[""],"","",["dancer"],26,11,15,0],"1f484":[[""],"","",["lipstick"],26,17,15,0],"1f485":[[""],"","",["nail_care"],26,18,15,0],"1f486-200d-2640-fe0f":[["","",""],"","",["woman-getting-massage","massage"],26,24,15,0],"1f486-200d-2642-fe0f":[["",""],"","",["man-getting-massage"],26,30,15,0],"1f487-200d-2640-fe0f":[["","",""],"","",["woman-getting-haircut","haircut"],26,42,15,0],"1f487-200d-2642-fe0f":[["",""],"","",["man-getting-haircut"],26,48,15,0],"1f488":[[""],"","",["barber"],27,0,15,0],"1f489":[[""],"","",["syringe"],27,1,15,0],"1f48a":[[""],"","",["pill"],27,2,15,0],"1f48b":[[""],"","",["kiss"],27,3,15,0],"1f48c":[[""],"","",["love_letter"],27,4,15,0],"1f48d":[[""],"","",["ring"],27,5,15,0],"1f48e":[[""],"","",["gem"],27,6,15,0],"1f48f":[[""],"","",["couplekiss"],27,7,15,0],"1f490":[[""],"","",["bouquet"],27,33,15,0],"1f491":[[""],"","",["couple_with_heart"],27,34,15,0],"1f492":[[""],"","",["wedding"],28,0,15,0],"1f493":[[""],"","",["heartbeat"],28,1,15,0],"1f494":[[""],"","",["broken_heart"],28,2,15,0,"</3"],"1f495":[[""],"","",["two_hearts"],28,3,15,0],"1f496":[[""],"","",["sparkling_heart"],28,4,15,0],"1f497":[[""],"","",["heartpulse"],28,5,15,0],"1f498":[[""],"","",["cupid"],28,6,15,0],"1f499":[[""],"","",["blue_heart"],28,7,15,0,"<3"],"1f49a":[[""],"","",["green_heart"],28,8,15,0,"<3"],"1f49b":[[""],"","",["yellow_heart"],28,9,15,0,"<3"],"1f49c":[[""],"","",["purple_heart"],28,10,15,0,"<3"],"1f49d":[[""],"","",["gift_heart"],28,11,15,0],"1f49e":[[""],"","",["revolving_hearts"],28,12,15,0],"1f49f":[[""],"","",["heart_decoration"],28,13,15,0],"1f4a0":[[""],"","",["diamond_shape_with_a_dot_inside"],28,14,15,0],"1f4a1":[[""],"","",["bulb"],28,15,15,0],"1f4a2":[[""],"","",["anger"],28,16,15,0],"1f4a3":[[""],"","",["bomb"],28,17,15,0],"1f4a4":[[""],"","",["zzz"],28,18,15,0],"1f4a5":[[""],"","",["boom","collision"],28,19,15,0],"1f4a6":[[""],"","",["sweat_drops"],28,20,15,0],"1f4a7":[[""],"","",["droplet"],28,21,15,0],"1f4a8":[[""],"","",["dash"],28,22,15,0],"1f4a9":[[""],"","",["hankey","poop","shit"],28,23,15,0],"1f4aa":[[""],"","",["muscle"],28,24,15,0],"1f4ab":[[""],"","",["dizzy"],28,30,15,0],"1f4ac":[[""],"","",["speech_balloon"],28,31,15,0],"1f4ad":[[""],"","",["thought_balloon"],28,32,15,0],"1f4ae":[[""],"","",["white_flower"],28,33,15,0],"1f4af":[[""],"","",["100"],28,34,15,0],"1f4b0":[[""],"","",["moneybag"],28,35,15,0],"1f4b1":[[""],"","",["currency_exchange"],28,36,15,0],"1f4b2":[[""],"","",["heavy_dollar_sign"],28,37,15,0],"1f4b3":[[""],"","",["credit_card"],28,38,15,0],"1f4b4":[[""],"","",["yen"],28,39,15,0],"1f4b5":[[""],"","",["dollar"],28,40,15,0],"1f4b6":[[""],"","",["euro"],28,41,15,0],"1f4b7":[[""],"","",["pound"],28,42,15,0],"1f4b8":[[""],"","",["money_with_wings"],28,43,15,0],"1f4b9":[[""],"","",["chart"],28,44,15,0],"1f4ba":[[""],"","",["seat"],28,45,15,0],"1f4bb":[[""],"","",["computer"],28,46,15,0],"1f4bc":[[""],"","",["briefcase"],28,47,15,0],"1f4bd":[[""],"","",["minidisc"],28,48,15,0],"1f4be":[[""],"","",["floppy_disk"],28,49,15,0],"1f4bf":[[""],"","",["cd"],28,50,15,0],"1f4c0":[[""],"","",["dvd"],28,51,15,0],"1f4c1":[[""],"","",["file_folder"],28,52,15,0],"1f4c2":[[""],"","",["open_file_folder"],28,53,15,0],"1f4c3":[[""],"","",["page_with_curl"],28,54,15,0],"1f4c4":[[""],"","",["page_facing_up"],28,55,15,0],"1f4c5":[[""],"","",["date"],28,56,15,0],"1f4c6":[[""],"","",["calendar"],28,57,15,0],"1f4c7":[[""],"","",["card_index"],28,58,15,0],"1f4c8":[[""],"","",["chart_with_upwards_trend"],28,59,15,0],"1f4c9":[[""],"","",["chart_with_downwards_trend"],29,0,15,0],"1f4ca":[[""],"","",["bar_chart"],29,1,15,0],"1f4cb":[[""],"","",["clipboard"],29,2,15,0],"1f4cc":[[""],"","",["pushpin"],29,3,15,0],"1f4cd":[[""],"","",["round_pushpin"],29,4,15,0],"1f4ce":[[""],"","",["paperclip"],29,5,15,0],"1f4cf":[[""],"","",["straight_ruler"],29,6,15,0],"1f4d0":[[""],"","",["triangular_ruler"],29,7,15,0],"1f4d1":[[""],"","",["bookmark_tabs"],29,8,15,0],"1f4d2":[[""],"","",["ledger"],29,9,15,0],"1f4d3":[[""],"","",["notebook"],29,10,15,0],"1f4d4":[[""],"","",["notebook_with_decorative_cover"],29,11,15,0],"1f4d5":[[""],"","",["closed_book"],29,12,15,0],"1f4d6":[[""],"","",["book","open_book"],29,13,15,0],"1f4d7":[[""],"","",["green_book"],29,14,15,0],"1f4d8":[[""],"","",["blue_book"],29,15,15,0],"1f4d9":[[""],"","",["orange_book"],29,16,15,0],"1f4da":[[""],"","",["books"],29,17,15,0],"1f4db":[[""],"","",["name_badge"],29,18,15,0],"1f4dc":[[""],"","",["scroll"],29,19,15,0],"1f4dd":[[""],"","",["memo","pencil"],29,20,15,0],"1f4de":[[""],"","",["telephone_receiver"],29,21,15,0],"1f4df":[[""],"","",["pager"],29,22,15,0],"1f4e0":[[""],"","",["fax"],29,23,15,0],"1f4e1":[[""],"","",["satellite_antenna"],29,24,15,0],"1f4e2":[[""],"","",["loudspeaker"],29,25,15,0],"1f4e3":[[""],"","",["mega"],29,26,15,0],"1f4e4":[[""],"","",["outbox_tray"],29,27,15,0],"1f4e5":[[""],"","",["inbox_tray"],29,28,15,0],"1f4e6":[[""],"","",["package"],29,29,15,0],"1f4e7":[[""],"","",["e-mail"],29,30,15,0],"1f4e8":[[""],"","",["incoming_envelope"],29,31,15,0],"1f4e9":[[""],"","",["envelope_with_arrow"],29,32,15,0],"1f4ea":[[""],"","",["mailbox_closed"],29,33,15,0],"1f4eb":[[""],"","",["mailbox"],29,34,15,0],"1f4ec":[[""],"","",["mailbox_with_mail"],29,35,15,0],"1f4ed":[[""],"","",["mailbox_with_no_mail"],29,36,15,0],"1f4ee":[[""],"","",["postbox"],29,37,15,0],"1f4ef":[[""],"","",["postal_horn"],29,38,15,0],"1f4f0":[[""],"","",["newspaper"],29,39,15,0],"1f4f1":[[""],"","",["iphone"],29,40,15,0],"1f4f2":[[""],"","",["calling"],29,41,15,0],"1f4f3":[[""],"","",["vibration_mode"],29,42,15,0],"1f4f4":[[""],"","",["mobile_phone_off"],29,43,15,0],"1f4f5":[[""],"","",["no_mobile_phones"],29,44,15,0],"1f4f6":[[""],"","",["signal_strength"],29,45,15,0],"1f4f7":[[""],"","",["camera"],29,46,15,0],"1f4f8":[[""],"","",["camera_with_flash"],29,47,15,0],"1f4f9":[[""],"","",["video_camera"],29,48,15,0],"1f4fa":[[""],"","",["tv"],29,49,15,0],"1f4fb":[[""],"","",["radio"],29,50,15,0],"1f4fc":[[""],"","",["vhs"],29,51,15,0],"1f4fd-fe0f":[["",""],"","",["film_projector"],29,52,15,0],"1f4ff":[[""],"","",["prayer_beads"],29,53,15,0],"1f500":[[""],"","",["twisted_rightwards_arrows"],29,54,15,0],"1f501":[[""],"","",["repeat"],29,55,15,0],"1f502":[[""],"","",["repeat_one"],29,56,15,0],"1f503":[[""],"","",["arrows_clockwise"],29,57,15,0],"1f504":[[""],"","",["arrows_counterclockwise"],29,58,15,0],"1f505":[[""],"","",["low_brightness"],29,59,15,0],"1f506":[[""],"","",["high_brightness"],30,0,15,0],"1f507":[[""],"","",["mute"],30,1,15,0],"1f508":[[""],"","",["speaker"],30,2,15,0],"1f509":[[""],"","",["sound"],30,3,15,0],"1f50a":[[""],"","",["loud_sound"],30,4,15,0],"1f50b":[[""],"","",["battery"],30,5,15,0],"1f50c":[[""],"","",["electric_plug"],30,6,15,0],"1f50d":[[""],"","",["mag"],30,7,15,0],"1f50e":[[""],"","",["mag_right"],30,8,15,0],"1f50f":[[""],"","",["lock_with_ink_pen"],30,9,15,0],"1f510":[[""],"","",["closed_lock_with_key"],30,10,15,0],"1f511":[[""],"","",["key"],30,11,15,0],"1f512":[[""],"","",["lock"],30,12,15,0],"1f513":[[""],"","",["unlock"],30,13,15,0],"1f514":[[""],"","",["bell"],30,14,15,0],"1f515":[[""],"","",["no_bell"],30,15,15,0],"1f516":[[""],"","",["bookmark"],30,16,15,0],"1f517":[[""],"","",["link"],30,17,15,0],"1f518":[[""],"","",["radio_button"],30,18,15,0],"1f519":[[""],"","",["back"],30,19,15,0],"1f51a":[[""],"","",["end"],30,20,15,0],"1f51b":[[""],"","",["on"],30,21,15,0],"1f51c":[[""],"","",["soon"],30,22,15,0],"1f51d":[[""],"","",["top"],30,23,15,0],"1f51e":[[""],"","",["underage"],30,24,15,0],"1f51f":[[""],"","",["keycap_ten"],30,25,15,0],"1f520":[[""],"","",["capital_abcd"],30,26,15,0],"1f521":[[""],"","",["abcd"],30,27,15,0],"1f522":[[""],"","",["1234"],30,28,15,0],"1f523":[[""],"","",["symbols"],30,29,15,0],"1f524":[[""],"","",["abc"],30,30,15,0],"1f525":[[""],"","",["fire"],30,31,15,0],"1f526":[[""],"","",["flashlight"],30,32,15,0],"1f527":[[""],"","",["wrench"],30,33,15,0],"1f528":[[""],"","",["hammer"],30,34,15,0],"1f529":[[""],"","",["nut_and_bolt"],30,35,15,0],"1f52a":[[""],"","",["hocho","knife"],30,36,15,0],"1f52b":[[""],"","",["gun"],30,37,15,0],"1f52c":[[""],"","",["microscope"],30,38,15,0],"1f52d":[[""],"","",["telescope"],30,39,15,0],"1f52e":[[""],"","",["crystal_ball"],30,40,15,0],"1f52f":[[""],"","",["six_pointed_star"],30,41,15,0],"1f530":[[""],"","",["beginner"],30,42,15,0],"1f531":[[""],"","",["trident"],30,43,15,0],"1f532":[[""],"","",["black_square_button"],30,44,15,0],"1f533":[[""],"","",["white_square_button"],30,45,15,0],"1f534":[[""],"","",["red_circle"],30,46,15,0],"1f535":[[""],"","",["large_blue_circle"],30,47,15,0],"1f536":[[""],"","",["large_orange_diamond"],30,48,15,0],"1f537":[[""],"","",["large_blue_diamond"],30,49,15,0],"1f538":[[""],"","",["small_orange_diamond"],30,50,15,0],"1f539":[[""],"","",["small_blue_diamond"],30,51,15,0],"1f53a":[[""],"","",["small_red_triangle"],30,52,15,0],"1f53b":[[""],"","",["small_red_triangle_down"],30,53,15,0],"1f53c":[[""],"","",["arrow_up_small"],30,54,15,0],"1f53d":[[""],"","",["arrow_down_small"],30,55,15,0],"1f549-fe0f":[["",""],"","",["om_symbol"],30,56,15,0],"1f54a-fe0f":[["",""],"","",["dove_of_peace"],30,57,15,0],"1f54b":[[""],"","",["kaaba"],30,58,15,0],"1f54c":[[""],"","",["mosque"],30,59,15,0],"1f54d":[[""],"","",["synagogue"],31,0,15,0],"1f54e":[[""],"","",["menorah_with_nine_branches"],31,1,15,0],"1f550":[[""],"","",["clock1"],31,2,15,0],"1f551":[[""],"","",["clock2"],31,3,15,0],"1f552":[[""],"","",["clock3"],31,4,15,0],"1f553":[[""],"","",["clock4"],31,5,15,0],"1f554":[[""],"","",["clock5"],31,6,15,0],"1f555":[[""],"","",["clock6"],31,7,15,0],"1f556":[[""],"","",["clock7"],31,8,15,0],"1f557":[[""],"","",["clock8"],31,9,15,0],"1f558":[[""],"","",["clock9"],31,10,15,0],"1f559":[[""],"","",["clock10"],31,11,15,0],"1f55a":[[""],"","",["clock11"],31,12,15,0],"1f55b":[[""],"","",["clock12"],31,13,15,0],"1f55c":[[""],"","",["clock130"],31,14,15,0],"1f55d":[[""],"","",["clock230"],31,15,15,0],"1f55e":[[""],"","",["clock330"],31,16,15,0],"1f55f":[[""],"","",["clock430"],31,17,15,0],"1f560":[[""],"","",["clock530"],31,18,15,0],"1f561":[[""],"","",["clock630"],31,19,15,0],"1f562":[[""],"","",["clock730"],31,20,15,0],"1f563":[[""],"","",["clock830"],31,21,15,0],"1f564":[[""],"","",["clock930"],31,22,15,0],"1f565":[[""],"","",["clock1030"],31,23,15,0],"1f566":[[""],"","",["clock1130"],31,24,15,0],"1f567":[[""],"","",["clock1230"],31,25,15,0],"1f56f-fe0f":[["",""],"","",["candle"],31,26,15,0],"1f570-fe0f":[["",""],"","",["mantelpiece_clock"],31,27,15,0],"1f573-fe0f":[["",""],"","",["hole"],31,28,15,0],"1f574-fe0f":[["",""],"","",["man_in_business_suit_levitating"],31,29,15,0],"1f575-fe0f-200d-2640-fe0f":[[""],"","",["female-detective"],31,35,7,0],"1f575-fe0f-200d-2642-fe0f":[["","",""],"","",["male-detective","sleuth_or_spy"],31,41,7,0],"1f576-fe0f":[["",""],"","",["dark_sunglasses"],31,53,15,0],"1f577-fe0f":[["",""],"","",["spider"],31,54,15,0],"1f578-fe0f":[["",""],"","",["spider_web"],31,55,15,0],"1f579-fe0f":[["",""],"","",["joystick"],31,56,15,0],"1f57a":[[""],"","",["man_dancing"],31,57,15,0],"1f587-fe0f":[["",""],"","",["linked_paperclips"],32,3,15,0],"1f58a-fe0f":[["",""],"","",["lower_left_ballpoint_pen"],32,4,15,0],"1f58b-fe0f":[["",""],"","",["lower_left_fountain_pen"],32,5,15,0],"1f58c-fe0f":[["",""],"","",["lower_left_paintbrush"],32,6,15,0],"1f58d-fe0f":[["",""],"","",["lower_left_crayon"],32,7,15,0],"1f590-fe0f":[["",""],"","",["raised_hand_with_fingers_splayed"],32,8,15,0],"1f595":[[""],"","",["middle_finger","reversed_hand_with_middle_finger_extended"],32,14,15,0],"1f596":[[""],"","",["spock-hand"],32,20,15,0],"1f5a4":[[""],"","",["black_heart"],32,26,15,0],"1f5a5-fe0f":[["",""],"","",["desktop_computer"],32,27,15,0],"1f5a8-fe0f":[["",""],"","",["printer"],32,28,15,0],"1f5b1-fe0f":[["",""],"","",["three_button_mouse"],32,29,15,0],"1f5b2-fe0f":[["",""],"","",["trackball"],32,30,15,0],"1f5bc-fe0f":[["",""],"","",["frame_with_picture"],32,31,15,0],"1f5c2-fe0f":[["",""],"","",["card_index_dividers"],32,32,15,0],"1f5c3-fe0f":[["",""],"","",["card_file_box"],32,33,15,0],"1f5c4-fe0f":[["",""],"","",["file_cabinet"],32,34,15,0],"1f5d1-fe0f":[["",""],"","",["wastebasket"],32,35,15,0],"1f5d2-fe0f":[["",""],"","",["spiral_note_pad"],32,36,15,0],"1f5d3-fe0f":[["",""],"","",["spiral_calendar_pad"],32,37,15,0],"1f5dc-fe0f":[["",""],"","",["compression"],32,38,15,0],"1f5dd-fe0f":[["",""],"","",["old_key"],32,39,15,0],"1f5de-fe0f":[["",""],"","",["rolled_up_newspaper"],32,40,15,0],"1f5e1-fe0f":[["",""],"","",["dagger_knife"],32,41,15,0],"1f5e3-fe0f":[["",""],"","",["speaking_head_in_silhouette"],32,42,15,0],"1f5e8-fe0f":[["",""],"","",["left_speech_bubble"],32,43,15,0],"1f5ef-fe0f":[["",""],"","",["right_anger_bubble"],32,44,15,0],"1f5f3-fe0f":[["",""],"","",["ballot_box_with_ballot"],32,45,15,0],"1f5fa-fe0f":[["",""],"","",["world_map"],32,46,15,0],"1f5fb":[[""],"","",["mount_fuji"],32,47,15,0],"1f5fc":[[""],"","",["tokyo_tower"],32,48,15,0],"1f5fd":[[""],"","",["statue_of_liberty"],32,49,15,0],"1f5fe":[[""],"","",["japan"],32,50,15,0],"1f5ff":[[""],"","",["moyai"],32,51,15,0],"1f600":[[""],"","",["grinning"],32,52,15,0,":D"],"1f601":[[""],"","",["grin"],32,53,15,0],"1f602":[[""],"","",["joy"],32,54,15,0],"1f603":[[""],"","",["smiley"],32,55,15,0,":)"],"1f604":[[""],"","",["smile"],32,56,15,0,":)"],"1f605":[[""],"","",["sweat_smile"],32,57,15,0],"1f606":[[""],"","",["laughing","satisfied"],32,58,15,0],"1f607":[[""],"","",["innocent"],32,59,15,0],"1f608":[[""],"","",["smiling_imp"],33,0,15,0],"1f609":[[""],"","",["wink"],33,1,15,0,";)"],"1f60a":[[""],"","",["blush"],33,2,15,0,":)"],"1f60b":[[""],"","",["yum"],33,3,15,0],"1f60c":[[""],"","",["relieved"],33,4,15,0],"1f60d":[[""],"","",["heart_eyes"],33,5,15,0],"1f60e":[[""],"","",["sunglasses"],33,6,15,0],"1f60f":[[""],"","",["smirk"],33,7,15,0],"1f610":[[""],"","",["neutral_face"],33,8,15,0],"1f611":[[""],"","",["expressionless"],33,9,15,0],"1f612":[[""],"","",["unamused"],33,10,15,0,":("],"1f613":[[""],"","",["sweat"],33,11,15,0],"1f614":[[""],"","",["pensive"],33,12,15,0],"1f615":[[""],"","",["confused"],33,13,15,0],"1f616":[[""],"","",["confounded"],33,14,15,0],"1f617":[[""],"","",["kissing"],33,15,15,0],"1f618":[[""],"","",["kissing_heart"],33,16,15,0],"1f619":[[""],"","",["kissing_smiling_eyes"],33,17,15,0],"1f61a":[[""],"","",["kissing_closed_eyes"],33,18,15,0],"1f61b":[[""],"","",["stuck_out_tongue"],33,19,15,0,":p"],"1f61c":[[""],"","",["stuck_out_tongue_winking_eye"],33,20,15,0,";p"],"1f61d":[[""],"","",["stuck_out_tongue_closed_eyes"],33,21,15,0],"1f61e":[[""],"","",["disappointed"],33,22,15,0,":("],"1f61f":[[""],"","",["worried"],33,23,15,0],"1f620":[[""],"","",["angry"],33,24,15,0],"1f621":[[""],"","",["rage"],33,25,15,0],"1f622":[[""],"","",["cry"],33,26,15,0,":'("],"1f623":[[""],"","",["persevere"],33,27,15,0],"1f624":[[""],"","",["triumph"],33,28,15,0],"1f625":[[""],"","",["disappointed_relieved"],33,29,15,0],"1f626":[[""],"","",["frowning"],33,30,15,0],"1f627":[[""],"","",["anguished"],33,31,15,0],"1f628":[[""],"","",["fearful"],33,32,15,0],"1f629":[[""],"","",["weary"],33,33,15,0],"1f62a":[[""],"","",["sleepy"],33,34,15,0],"1f62b":[[""],"","",["tired_face"],33,35,15,0],"1f62c":[[""],"","",["grimacing"],33,36,15,0],"1f62d":[[""],"","",["sob"],33,37,15,0,":'("],"1f62e-200d-1f4a8":[[""],"","",["face_exhaling"],33,38,7,0],"1f62e":[[""],"","",["open_mouth"],33,39,15,0],"1f62f":[[""],"","",["hushed"],33,40,15,0],"1f630":[[""],"","",["cold_sweat"],33,41,15,0],"1f631":[[""],"","",["scream"],33,42,15,0],"1f632":[[""],"","",["astonished"],33,43,15,0],"1f633":[[""],"","",["flushed"],33,44,15,0],"1f634":[[""],"","",["sleeping"],33,45,15,0],"1f635-200d-1f4ab":[[""],"","",["face_with_spiral_eyes"],33,46,7,0],"1f635":[[""],"","",["dizzy_face"],33,47,15,0],"1f636-200d-1f32b-fe0f":[["",""],"","",["face_in_clouds"],33,48,7,0],"1f636":[[""],"","",["no_mouth"],33,49,15,0],"1f637":[[""],"","",["mask"],33,50,15,0],"1f638":[[""],"","",["smile_cat"],33,51,15,0],"1f639":[[""],"","",["joy_cat"],33,52,15,0],"1f63a":[[""],"","",["smiley_cat"],33,53,15,0],"1f63b":[[""],"","",["heart_eyes_cat"],33,54,15,0],"1f63c":[[""],"","",["smirk_cat"],33,55,15,0],"1f63d":[[""],"","",["kissing_cat"],33,56,15,0],"1f63e":[[""],"","",["pouting_cat"],33,57,15,0],"1f63f":[[""],"","",["crying_cat_face"],33,58,15,0],"1f640":[[""],"","",["scream_cat"],33,59,15,0],"1f641":[[""],"","",["slightly_frowning_face"],34,0,15,0],"1f642":[[""],"","",["slightly_smiling_face"],34,1,15,0],"1f643":[[""],"","",["upside_down_face"],34,2,15,0],"1f644":[[""],"","",["face_with_rolling_eyes"],34,3,15,0],"1f645-200d-2640-fe0f":[["","",""],"","",["woman-gesturing-no","no_good"],34,4,15,0],"1f645-200d-2642-fe0f":[["",""],"","",["man-gesturing-no"],34,10,15,0],"1f646-200d-2640-fe0f":[["","",""],"","",["woman-gesturing-ok","ok_woman"],34,22,15,0],"1f646-200d-2642-fe0f":[["",""],"","",["man-gesturing-ok"],34,28,15,0],"1f647-200d-2640-fe0f":[["",""],"","",["woman-bowing"],34,40,15,0],"1f647-200d-2642-fe0f":[["","",""],"","",["man-bowing","bow"],34,46,15,0],"1f648":[[""],"","",["see_no_evil"],34,58,15,0],"1f649":[[""],"","",["hear_no_evil"],34,59,15,0],"1f64a":[[""],"","",["speak_no_evil"],35,0,15,0],"1f64b-200d-2640-fe0f":[["","",""],"","",["woman-raising-hand","raising_hand"],35,1,15,0],"1f64b-200d-2642-fe0f":[["",""],"","",["man-raising-hand"],35,7,15,0],"1f64c":[[""],"","",["raised_hands"],35,19,15,0],"1f64d-200d-2640-fe0f":[["","",""],"","",["woman-frowning","person_frowning"],35,25,15,0],"1f64d-200d-2642-fe0f":[["",""],"","",["man-frowning"],35,31,15,0],"1f64e-200d-2640-fe0f":[["","",""],"","",["woman-pouting","person_with_pouting_face"],35,43,15,0],"1f64e-200d-2642-fe0f":[["",""],"","",["man-pouting"],35,49,15,0],"1f64f":[[""],"","",["pray"],36,1,15,0],"1f680":[[""],"","",["rocket"],36,7,15,0],"1f681":[[""],"","",["helicopter"],36,8,15,0],"1f682":[[""],"","",["steam_locomotive"],36,9,15,0],"1f683":[[""],"","",["railway_car"],36,10,15,0],"1f684":[[""],"","",["bullettrain_side"],36,11,15,0],"1f685":[[""],"","",["bullettrain_front"],36,12,15,0],"1f686":[[""],"","",["train2"],36,13,15,0],"1f687":[[""],"","",["metro"],36,14,15,0],"1f688":[[""],"","",["light_rail"],36,15,15,0],"1f689":[[""],"","",["station"],36,16,15,0],"1f68a":[[""],"","",["tram"],36,17,15,0],"1f68b":[[""],"","",["train"],36,18,15,0],"1f68c":[[""],"","",["bus"],36,19,15,0],"1f68d":[[""],"","",["oncoming_bus"],36,20,15,0],"1f68e":[[""],"","",["trolleybus"],36,21,15,0],"1f68f":[[""],"","",["busstop"],36,22,15,0],"1f690":[[""],"","",["minibus"],36,23,15,0],"1f691":[[""],"","",["ambulance"],36,24,15,0],"1f692":[[""],"","",["fire_engine"],36,25,15,0],"1f693":[[""],"","",["police_car"],36,26,15,0],"1f694":[[""],"","",["oncoming_police_car"],36,27,15,0],"1f695":[[""],"","",["taxi"],36,28,15,0],"1f696":[[""],"","",["oncoming_taxi"],36,29,15,0],"1f697":[[""],"","",["car","red_car"],36,30,15,0],"1f698":[[""],"","",["oncoming_automobile"],36,31,15,0],"1f699":[[""],"","",["blue_car"],36,32,15,0],"1f69a":[[""],"","",["truck"],36,33,15,0],"1f69b":[[""],"","",["articulated_lorry"],36,34,15,0],"1f69c":[[""],"","",["tractor"],36,35,15,0],"1f69d":[[""],"","",["monorail"],36,36,15,0],"1f69e":[[""],"","",["mountain_railway"],36,37,15,0],"1f69f":[[""],"","",["suspension_railway"],36,38,15,0],"1f6a0":[[""],"","",["mountain_cableway"],36,39,15,0],"1f6a1":[[""],"","",["aerial_tramway"],36,40,15,0],"1f6a2":[[""],"","",["ship"],36,41,15,0],"1f6a3-200d-2640-fe0f":[["",""],"","",["woman-rowing-boat"],36,42,15,0],"1f6a3-200d-2642-fe0f":[["","",""],"","",["man-rowing-boat","rowboat"],36,48,15,0],"1f6a4":[[""],"","",["speedboat"],37,0,15,0],"1f6a5":[[""],"","",["traffic_light"],37,1,15,0],"1f6a6":[[""],"","",["vertical_traffic_light"],37,2,15,0],"1f6a7":[[""],"","",["construction"],37,3,15,0],"1f6a8":[[""],"","",["rotating_light"],37,4,15,0],"1f6a9":[[""],"","",["triangular_flag_on_post"],37,5,15,0],"1f6aa":[[""],"","",["door"],37,6,15,0],"1f6ab":[[""],"","",["no_entry_sign"],37,7,15,0],"1f6ac":[[""],"","",["smoking"],37,8,15,0],"1f6ad":[[""],"","",["no_smoking"],37,9,15,0],"1f6ae":[[""],"","",["put_litter_in_its_place"],37,10,15,0],"1f6af":[[""],"","",["do_not_litter"],37,11,15,0],"1f6b0":[[""],"","",["potable_water"],37,12,15,0],"1f6b1":[[""],"","",["non-potable_water"],37,13,15,0],"1f6b2":[[""],"","",["bike"],37,14,15,0],"1f6b3":[[""],"","",["no_bicycles"],37,15,15,0],"1f6b4-200d-2640-fe0f":[["",""],"","",["woman-biking"],37,16,15,0],"1f6b4-200d-2642-fe0f":[["","",""],"","",["man-biking","bicyclist"],37,22,15,0],"1f6b5-200d-2640-fe0f":[["",""],"","",["woman-mountain-biking"],37,34,15,0],"1f6b5-200d-2642-fe0f":[["","",""],"","",["man-mountain-biking","mountain_bicyclist"],37,40,15,0],"1f6b6-200d-2640-fe0f":[["",""],"","",["woman-walking"],37,52,15,0],"1f6b6-200d-2642-fe0f":[["","",""],"","",["man-walking","walking"],37,58,15,0],"1f6b7":[[""],"","",["no_pedestrians"],38,10,15,0],"1f6b8":[[""],"","",["children_crossing"],38,11,15,0],"1f6b9":[[""],"","",["mens"],38,12,15,0],"1f6ba":[[""],"","",["womens"],38,13,15,0],"1f6bb":[[""],"","",["restroom"],38,14,15,0],"1f6bc":[[""],"","",["baby_symbol"],38,15,15,0],"1f6bd":[[""],"","",["toilet"],38,16,15,0],"1f6be":[[""],"","",["wc"],38,17,15,0],"1f6bf":[[""],"","",["shower"],38,18,15,0],"1f6c0":[[""],"","",["bath"],38,19,15,0],"1f6c1":[[""],"","",["bathtub"],38,25,15,0],"1f6c2":[[""],"","",["passport_control"],38,26,15,0],"1f6c3":[[""],"","",["customs"],38,27,15,0],"1f6c4":[[""],"","",["baggage_claim"],38,28,15,0],"1f6c5":[[""],"","",["left_luggage"],38,29,15,0],"1f6cb-fe0f":[["",""],"","",["couch_and_lamp"],38,30,15,0],"1f6cc":[[""],"","",["sleeping_accommodation"],38,31,15,0],"1f6cd-fe0f":[["",""],"","",["shopping_bags"],38,37,15,0],"1f6ce-fe0f":[["",""],"","",["bellhop_bell"],38,38,15,0],"1f6cf-fe0f":[["",""],"","",["bed"],38,39,15,0],"1f6d0":[[""],"","",["place_of_worship"],38,40,15,0],"1f6d1":[[""],"","",["octagonal_sign"],38,41,15,0],"1f6d2":[[""],"","",["shopping_trolley"],38,42,15,0],"1f6d5":[[""],"","",["hindu_temple"],38,43,15,0],"1f6d6":[[""],"","",["hut"],38,44,15,0],"1f6d7":[[""],"","",["elevator"],38,45,15,0],"1f6e0-fe0f":[["",""],"","",["hammer_and_wrench"],38,46,15,0],"1f6e1-fe0f":[["",""],"","",["shield"],38,47,15,0],"1f6e2-fe0f":[["",""],"","",["oil_drum"],38,48,15,0],"1f6e3-fe0f":[["",""],"","",["motorway"],38,49,15,0],"1f6e4-fe0f":[["",""],"","",["railway_track"],38,50,15,0],"1f6e5-fe0f":[["",""],"","",["motor_boat"],38,51,15,0],"1f6e9-fe0f":[["",""],"","",["small_airplane"],38,52,15,0],"1f6eb":[[""],"","",["airplane_departure"],38,53,15,0],"1f6ec":[[""],"","",["airplane_arriving"],38,54,15,0],"1f6f0-fe0f":[["",""],"","",["satellite"],38,55,15,0],"1f6f3-fe0f":[["",""],"","",["passenger_ship"],38,56,15,0],"1f6f4":[[""],"","",["scooter"],38,57,15,0],"1f6f5":[[""],"","",["motor_scooter"],38,58,15,0],"1f6f6":[[""],"","",["canoe"],38,59,15,0],"1f6f7":[[""],"","",["sled"],39,0,15,0],"1f6f8":[[""],"","",["flying_saucer"],39,1,15,0],"1f6f9":[[""],"","",["skateboard"],39,2,15,0],"1f6fa":[[""],"","",["auto_rickshaw"],39,3,15,0],"1f6fb":[[""],"","",["pickup_truck"],39,4,15,0],"1f6fc":[[""],"","",["roller_skate"],39,5,15,0],"1f7e0":[[""],"","",["large_orange_circle"],39,6,15,0],"1f7e1":[[""],"","",["large_yellow_circle"],39,7,15,0],"1f7e2":[[""],"","",["large_green_circle"],39,8,15,0],"1f7e3":[[""],"","",["large_purple_circle"],39,9,15,0],"1f7e4":[[""],"","",["large_brown_circle"],39,10,15,0],"1f7e5":[[""],"","",["large_red_square"],39,11,15,0],"1f7e6":[[""],"","",["large_blue_square"],39,12,15,0],"1f7e7":[[""],"","",["large_orange_square"],39,13,15,0],"1f7e8":[[""],"","",["large_yellow_square"],39,14,15,0],"1f7e9":[[""],"","",["large_green_square"],39,15,15,0],"1f7ea":[[""],"","",["large_purple_square"],39,16,15,0],"1f7eb":[[""],"","",["large_brown_square"],39,17,15,0],"1f90c":[[""],"","",["pinched_fingers"],39,18,15,0],"1f90d":[[""],"","",["white_heart"],39,24,15,0],"1f90e":[[""],"","",["brown_heart"],39,25,15,0],"1f90f":[[""],"","",["pinching_hand"],39,26,15,0],"1f910":[[""],"","",["zipper_mouth_face"],39,32,15,0],"1f911":[[""],"","",["money_mouth_face"],39,33,15,0],"1f912":[[""],"","",["face_with_thermometer"],39,34,15,0],"1f913":[[""],"","",["nerd_face"],39,35,15,0],"1f914":[[""],"","",["thinking_face"],39,36,15,0],"1f915":[[""],"","",["face_with_head_bandage"],39,37,15,0],"1f916":[[""],"","",["robot_face"],39,38,15,0],"1f917":[[""],"","",["hugging_face"],39,39,15,0],"1f918":[[""],"","",["the_horns","sign_of_the_horns"],39,40,15,0],"1f919":[[""],"","",["call_me_hand"],39,46,15,0],"1f91a":[[""],"","",["raised_back_of_hand"],39,52,15,0],"1f91b":[[""],"","",["left-facing_fist"],39,58,15,0],"1f91c":[[""],"","",["right-facing_fist"],40,4,15,0],"1f91d":[[""],"","",["handshake"],40,10,15,0],"1f91e":[[""],"","",["crossed_fingers","hand_with_index_and_middle_fingers_crossed"],40,11,15,0],"1f91f":[[""],"","",["i_love_you_hand_sign"],40,17,15,0],"1f920":[[""],"","",["face_with_cowboy_hat"],40,23,15,0],"1f921":[[""],"","",["clown_face"],40,24,15,0],"1f922":[[""],"","",["nauseated_face"],40,25,15,0],"1f923":[[""],"","",["rolling_on_the_floor_laughing"],40,26,15,0],"1f924":[[""],"","",["drooling_face"],40,27,15,0],"1f925":[[""],"","",["lying_face"],40,28,15,0],"1f926-200d-2640-fe0f":[["",""],"","",["woman-facepalming"],40,29,15,0],"1f926-200d-2642-fe0f":[["",""],"","",["man-facepalming"],40,35,15,0],"1f926":[[""],"","",["face_palm"],40,41,15,0],"1f927":[[""],"","",["sneezing_face"],40,47,15,0],"1f928":[[""],"","",["face_with_raised_eyebrow","face_with_one_eyebrow_raised"],40,48,15,0],"1f929":[[""],"","",["star-struck","grinning_face_with_star_eyes"],40,49,15,0],"1f92a":[[""],"","",["zany_face","grinning_face_with_one_large_and_one_small_eye"],40,50,15,0],"1f92b":[[""],"","",["shushing_face","face_with_finger_covering_closed_lips"],40,51,15,0],"1f92c":[[""],"","",["face_with_symbols_on_mouth","serious_face_with_symbols_covering_mouth"],40,52,15,0],"1f92d":[[""],"","",["face_with_hand_over_mouth","smiling_face_with_smiling_eyes_and_hand_covering_mouth"],40,53,15,0],"1f92e":[[""],"","",["face_vomiting","face_with_open_mouth_vomiting"],40,54,15,0],"1f92f":[[""],"","",["exploding_head","shocked_face_with_exploding_head"],40,55,15,0],"1f930":[[""],"","",["pregnant_woman"],40,56,15,0],"1f931":[[""],"","",["breast-feeding"],41,2,15,0],"1f932":[[""],"","",["palms_up_together"],41,8,15,0],"1f933":[[""],"","",["selfie"],41,14,15,0],"1f934":[[""],"","",["prince"],41,20,15,0],"1f935-200d-2640-fe0f":[["",""],"","",["woman_in_tuxedo"],41,26,15,0],"1f935-200d-2642-fe0f":[["",""],"","",["man_in_tuxedo"],41,32,15,0],"1f935":[[""],"","",["person_in_tuxedo"],41,38,15,0],"1f936":[[""],"","",["mrs_claus","mother_christmas"],41,44,15,0],"1f937-200d-2640-fe0f":[["",""],"","",["woman-shrugging"],41,50,15,0],"1f937-200d-2642-fe0f":[["",""],"","",["man-shrugging"],41,56,15,0],"1f937":[[""],"","",["shrug"],42,2,15,0],"1f938-200d-2640-fe0f":[["",""],"","",["woman-cartwheeling"],42,8,15,0],"1f938-200d-2642-fe0f":[["",""],"","",["man-cartwheeling"],42,14,15,0],"1f938":[[""],"","",["person_doing_cartwheel"],42,20,15,0],"1f939-200d-2640-fe0f":[["",""],"","",["woman-juggling"],42,26,15,0],"1f939-200d-2642-fe0f":[["",""],"","",["man-juggling"],42,32,15,0],"1f939":[[""],"","",["juggling"],42,38,15,0],"1f93a":[[""],"","",["fencer"],42,44,15,0],"1f93c-200d-2640-fe0f":[["",""],"","",["woman-wrestling"],42,45,15,0],"1f93c-200d-2642-fe0f":[["",""],"","",["man-wrestling"],42,46,15,0],"1f93c":[[""],"","",["wrestlers"],42,47,15,0],"1f93d-200d-2640-fe0f":[["",""],"","",["woman-playing-water-polo"],42,48,15,0],"1f93d-200d-2642-fe0f":[["",""],"","",["man-playing-water-polo"],42,54,15,0],"1f93d":[[""],"","",["water_polo"],43,0,15,0],"1f93e-200d-2640-fe0f":[["",""],"","",["woman-playing-handball"],43,6,15,0],"1f93e-200d-2642-fe0f":[["",""],"","",["man-playing-handball"],43,12,15,0],"1f93e":[[""],"","",["handball"],43,18,15,0],"1f93f":[[""],"","",["diving_mask"],43,24,15,0],"1f940":[[""],"","",["wilted_flower"],43,25,15,0],"1f941":[[""],"","",["drum_with_drumsticks"],43,26,15,0],"1f942":[[""],"","",["clinking_glasses"],43,27,15,0],"1f943":[[""],"","",["tumbler_glass"],43,28,15,0],"1f944":[[""],"","",["spoon"],43,29,15,0],"1f945":[[""],"","",["goal_net"],43,30,15,0],"1f947":[[""],"","",["first_place_medal"],43,31,15,0],"1f948":[[""],"","",["second_place_medal"],43,32,15,0],"1f949":[[""],"","",["third_place_medal"],43,33,15,0],"1f94a":[[""],"","",["boxing_glove"],43,34,15,0],"1f94b":[[""],"","",["martial_arts_uniform"],43,35,15,0],"1f94c":[[""],"","",["curling_stone"],43,36,15,0],"1f94d":[[""],"","",["lacrosse"],43,37,15,0],"1f94e":[[""],"","",["softball"],43,38,15,0],"1f94f":[[""],"","",["flying_disc"],43,39,15,0],"1f950":[[""],"","",["croissant"],43,40,15,0],"1f951":[[""],"","",["avocado"],43,41,15,0],"1f952":[[""],"","",["cucumber"],43,42,15,0],"1f953":[[""],"","",["bacon"],43,43,15,0],"1f954":[[""],"","",["potato"],43,44,15,0],"1f955":[[""],"","",["carrot"],43,45,15,0],"1f956":[[""],"","",["baguette_bread"],43,46,15,0],"1f957":[[""],"","",["green_salad"],43,47,15,0],"1f958":[[""],"","",["shallow_pan_of_food"],43,48,15,0],"1f959":[[""],"","",["stuffed_flatbread"],43,49,15,0],"1f95a":[[""],"","",["egg"],43,50,15,0],"1f95b":[[""],"","",["glass_of_milk"],43,51,15,0],"1f95c":[[""],"","",["peanuts"],43,52,15,0],"1f95d":[[""],"","",["kiwifruit"],43,53,15,0],"1f95e":[[""],"","",["pancakes"],43,54,15,0],"1f95f":[[""],"","",["dumpling"],43,55,15,0],"1f960":[[""],"","",["fortune_cookie"],43,56,15,0],"1f961":[[""],"","",["takeout_box"],43,57,15,0],"1f962":[[""],"","",["chopsticks"],43,58,15,0],"1f963":[[""],"","",["bowl_with_spoon"],43,59,15,0],"1f964":[[""],"","",["cup_with_straw"],44,0,15,0],"1f965":[[""],"","",["coconut"],44,1,15,0],"1f966":[[""],"","",["broccoli"],44,2,15,0],"1f967":[[""],"","",["pie"],44,3,15,0],"1f968":[[""],"","",["pretzel"],44,4,15,0],"1f969":[[""],"","",["cut_of_meat"],44,5,15,0],"1f96a":[[""],"","",["sandwich"],44,6,15,0],"1f96b":[[""],"","",["canned_food"],44,7,15,0],"1f96c":[[""],"","",["leafy_green"],44,8,15,0],"1f96d":[[""],"","",["mango"],44,9,15,0],"1f96e":[[""],"","",["moon_cake"],44,10,15,0],"1f96f":[[""],"","",["bagel"],44,11,15,0],"1f970":[[""],"","",["smiling_face_with_3_hearts"],44,12,15,0],"1f971":[[""],"","",["yawning_face"],44,13,15,0],"1f972":[[""],"","",["smiling_face_with_tear"],44,14,15,0],"1f973":[[""],"","",["partying_face"],44,15,15,0],"1f974":[[""],"","",["woozy_face"],44,16,15,0],"1f975":[[""],"","",["hot_face"],44,17,15,0],"1f976":[[""],"","",["cold_face"],44,18,15,0],"1f977":[[""],"","",["ninja"],44,19,15,0],"1f978":[[""],"","",["disguised_face"],44,25,15,0],"1f97a":[[""],"","",["pleading_face"],44,26,15,0],"1f97b":[[""],"","",["sari"],44,27,15,0],"1f97c":[[""],"","",["lab_coat"],44,28,15,0],"1f97d":[[""],"","",["goggles"],44,29,15,0],"1f97e":[[""],"","",["hiking_boot"],44,30,15,0],"1f97f":[[""],"","",["womans_flat_shoe"],44,31,15,0],"1f980":[[""],"","",["crab"],44,32,15,0],"1f981":[[""],"","",["lion_face"],44,33,15,0],"1f982":[[""],"","",["scorpion"],44,34,15,0],"1f983":[[""],"","",["turkey"],44,35,15,0],"1f984":[[""],"","",["unicorn_face"],44,36,15,0],"1f985":[[""],"","",["eagle"],44,37,15,0],"1f986":[[""],"","",["duck"],44,38,15,0],"1f987":[[""],"","",["bat"],44,39,15,0],"1f988":[[""],"","",["shark"],44,40,15,0],"1f989":[[""],"","",["owl"],44,41,15,0],"1f98a":[[""],"","",["fox_face"],44,42,15,0],"1f98b":[[""],"","",["butterfly"],44,43,15,0],"1f98c":[[""],"","",["deer"],44,44,15,0],"1f98d":[[""],"","",["gorilla"],44,45,15,0],"1f98e":[[""],"","",["lizard"],44,46,15,0],"1f98f":[[""],"","",["rhinoceros"],44,47,15,0],"1f990":[[""],"","",["shrimp"],44,48,15,0],"1f991":[[""],"","",["squid"],44,49,15,0],"1f992":[[""],"","",["giraffe_face"],44,50,15,0],"1f993":[[""],"","",["zebra_face"],44,51,15,0],"1f994":[[""],"","",["hedgehog"],44,52,15,0],"1f995":[[""],"","",["sauropod"],44,53,15,0],"1f996":[[""],"","",["t-rex"],44,54,15,0],"1f997":[[""],"","",["cricket"],44,55,15,0],"1f998":[[""],"","",["kangaroo"],44,56,15,0],"1f999":[[""],"","",["llama"],44,57,15,0],"1f99a":[[""],"","",["peacock"],44,58,15,0],"1f99b":[[""],"","",["hippopotamus"],44,59,15,0],"1f99c":[[""],"","",["parrot"],45,0,15,0],"1f99d":[[""],"","",["raccoon"],45,1,15,0],"1f99e":[[""],"","",["lobster"],45,2,15,0],"1f99f":[[""],"","",["mosquito"],45,3,15,0],"1f9a0":[[""],"","",["microbe"],45,4,15,0],"1f9a1":[[""],"","",["badger"],45,5,15,0],"1f9a2":[[""],"","",["swan"],45,6,15,0],"1f9a3":[[""],"","",["mammoth"],45,7,15,0],"1f9a4":[[""],"","",["dodo"],45,8,15,0],"1f9a5":[[""],"","",["sloth"],45,9,15,0],"1f9a6":[[""],"","",["otter"],45,10,15,0],"1f9a7":[[""],"","",["orangutan"],45,11,15,0],"1f9a8":[[""],"","",["skunk"],45,12,15,0],"1f9a9":[[""],"","",["flamingo"],45,13,15,0],"1f9aa":[[""],"","",["oyster"],45,14,15,0],"1f9ab":[[""],"","",["beaver"],45,15,15,0],"1f9ac":[[""],"","",["bison"],45,16,15,0],"1f9ad":[[""],"","",["seal"],45,17,15,0],"1f9ae":[[""],"","",["guide_dog"],45,18,15,0],"1f9af":[[""],"","",["probing_cane"],45,19,15,0],"1f9b4":[[""],"","",["bone"],45,20,15,0],"1f9b5":[[""],"","",["leg"],45,21,15,0],"1f9b6":[[""],"","",["foot"],45,27,15,0],"1f9b7":[[""],"","",["tooth"],45,33,15,0],"1f9b8-200d-2640-fe0f":[["",""],"","",["female_superhero"],45,34,15,0],"1f9b8-200d-2642-fe0f":[["",""],"","",["male_superhero"],45,40,15,0],"1f9b8":[[""],"","",["superhero"],45,46,15,0],"1f9b9-200d-2640-fe0f":[["",""],"","",["female_supervillain"],45,52,15,0],"1f9b9-200d-2642-fe0f":[["",""],"","",["male_supervillain"],45,58,15,0],"1f9b9":[[""],"","",["supervillain"],46,4,15,0],"1f9ba":[[""],"","",["safety_vest"],46,10,15,0],"1f9bb":[[""],"","",["ear_with_hearing_aid"],46,11,15,0],"1f9bc":[[""],"","",["motorized_wheelchair"],46,17,15,0],"1f9bd":[[""],"","",["manual_wheelchair"],46,18,15,0],"1f9be":[[""],"","",["mechanical_arm"],46,19,15,0],"1f9bf":[[""],"","",["mechanical_leg"],46,20,15,0],"1f9c0":[[""],"","",["cheese_wedge"],46,21,15,0],"1f9c1":[[""],"","",["cupcake"],46,22,15,0],"1f9c2":[[""],"","",["salt"],46,23,15,0],"1f9c3":[[""],"","",["beverage_box"],46,24,15,0],"1f9c4":[[""],"","",["garlic"],46,25,15,0],"1f9c5":[[""],"","",["onion"],46,26,15,0],"1f9c6":[[""],"","",["falafel"],46,27,15,0],"1f9c7":[[""],"","",["waffle"],46,28,15,0],"1f9c8":[[""],"","",["butter"],46,29,15,0],"1f9c9":[[""],"","",["mate_drink"],46,30,15,0],"1f9ca":[[""],"","",["ice_cube"],46,31,15,0],"1f9cb":[[""],"","",["bubble_tea"],46,32,15,0],"1f9cd-200d-2640-fe0f":[["",""],"","",["woman_standing"],46,33,15,0],"1f9cd-200d-2642-fe0f":[["",""],"","",["man_standing"],46,39,15,0],"1f9cd":[[""],"","",["standing_person"],46,45,15,0],"1f9ce-200d-2640-fe0f":[["",""],"","",["woman_kneeling"],46,51,15,0],"1f9ce-200d-2642-fe0f":[["",""],"","",["man_kneeling"],46,57,15,0],"1f9ce":[[""],"","",["kneeling_person"],47,3,15,0],"1f9cf-200d-2640-fe0f":[["",""],"","",["deaf_woman"],47,9,15,0],"1f9cf-200d-2642-fe0f":[["",""],"","",["deaf_man"],47,15,15,0],"1f9cf":[[""],"","",["deaf_person"],47,21,15,0],"1f9d0":[[""],"","",["face_with_monocle"],47,27,15,0],"1f9d1-200d-1f33e":[[""],"","",["farmer"],47,28,15,0],"1f9d1-200d-1f373":[[""],"","",["cook"],47,34,15,0],"1f9d1-200d-1f37c":[[""],"","",["person_feeding_baby"],47,40,15,0],"1f9d1-200d-1f384":[[""],"","",["mx_claus"],47,46,15,0],"1f9d1-200d-1f393":[[""],"","",["student"],47,52,15,0],"1f9d1-200d-1f3a4":[[""],"","",["singer"],47,58,15,0],"1f9d1-200d-1f3a8":[[""],"","",["artist"],48,4,15,0],"1f9d1-200d-1f3eb":[[""],"","",["teacher"],48,10,15,0],"1f9d1-200d-1f3ed":[[""],"","",["factory_worker"],48,16,15,0],"1f9d1-200d-1f4bb":[[""],"","",["technologist"],48,22,15,0],"1f9d1-200d-1f4bc":[[""],"","",["office_worker"],48,28,15,0],"1f9d1-200d-1f527":[[""],"","",["mechanic"],48,34,15,0],"1f9d1-200d-1f52c":[[""],"","",["scientist"],48,40,15,0],"1f9d1-200d-1f680":[[""],"","",["astronaut"],48,46,15,0],"1f9d1-200d-1f692":[[""],"","",["firefighter"],48,52,15,0],"1f9d1-200d-1f91d-200d-1f9d1":[[""],"","",["people_holding_hands"],48,58,15,0],"1f9d1-200d-1f9af":[[""],"","",["person_with_probing_cane"],49,24,15,0],"1f9d1-200d-1f9b0":[[""],"","",["red_haired_person"],49,30,15,0],"1f9d1-200d-1f9b1":[[""],"","",["curly_haired_person"],49,36,15,0],"1f9d1-200d-1f9b2":[[""],"","",["bald_person"],49,42,7,0],"1f9d1-200d-1f9b3":[[""],"","",["white_haired_person"],49,48,7,0],"1f9d1-200d-1f9bc":[[""],"","",["person_in_motorized_wheelchair"],49,54,15,0],"1f9d1-200d-1f9bd":[[""],"","",["person_in_manual_wheelchair"],50,0,15,0],"1f9d1-200d-2695-fe0f":[["",""],"","",["health_worker"],50,6,15,0],"1f9d1-200d-2696-fe0f":[["",""],"","",["judge"],50,12,15,0],"1f9d1-200d-2708-fe0f":[["",""],"","",["pilot"],50,18,15,0],"1f9d1":[[""],"","",["adult"],50,24,15,0],"1f9d2":[[""],"","",["child"],50,30,15,0],"1f9d3":[[""],"","",["older_adult"],50,36,15,0],"1f9d4-200d-2640-fe0f":[["",""],"","",["woman_with_beard"],50,42,7,0],"1f9d4-200d-2642-fe0f":[["",""],"","",["man_with_beard"],50,48,7,0],"1f9d4":[[""],"","",["bearded_person"],50,54,15,0],"1f9d5":[[""],"","",["person_with_headscarf"],51,0,15,0],"1f9d6-200d-2640-fe0f":[["",""],"","",["woman_in_steamy_room"],51,6,15,0],"1f9d6-200d-2642-fe0f":[["","",""],"","",["man_in_steamy_room","person_in_steamy_room"],51,12,15,0],"1f9d7-200d-2640-fe0f":[["","",""],"","",["woman_climbing","person_climbing"],51,24,15,0],"1f9d7-200d-2642-fe0f":[["",""],"","",["man_climbing"],51,30,15,0],"1f9d8-200d-2640-fe0f":[["","",""],"","",["woman_in_lotus_position","person_in_lotus_position"],51,42,15,0],"1f9d8-200d-2642-fe0f":[["",""],"","",["man_in_lotus_position"],51,48,15,0],"1f9d9-200d-2640-fe0f":[["","",""],"","",["female_mage","mage"],52,0,15,0],"1f9d9-200d-2642-fe0f":[["",""],"","",["male_mage"],52,6,15,0],"1f9da-200d-2640-fe0f":[["","",""],"","",["female_fairy","fairy"],52,18,15,0],"1f9da-200d-2642-fe0f":[["",""],"","",["male_fairy"],52,24,15,0],"1f9db-200d-2640-fe0f":[["","",""],"","",["female_vampire","vampire"],52,36,15,0],"1f9db-200d-2642-fe0f":[["",""],"","",["male_vampire"],52,42,15,0],"1f9dc-200d-2640-fe0f":[["",""],"","",["mermaid"],52,54,15,0],"1f9dc-200d-2642-fe0f":[["","",""],"","",["merman","merperson"],53,0,15,0],"1f9dd-200d-2640-fe0f":[["",""],"","",["female_elf"],53,12,15,0],"1f9dd-200d-2642-fe0f":[["","",""],"","",["male_elf","elf"],53,18,15,0],"1f9de-200d-2640-fe0f":[["",""],"","",["female_genie"],53,30,15,0],"1f9de-200d-2642-fe0f":[["","",""],"","",["male_genie","genie"],53,31,15,0],"1f9df-200d-2640-fe0f":[["",""],"","",["female_zombie"],53,33,15,0],"1f9df-200d-2642-fe0f":[["","",""],"","",["male_zombie","zombie"],53,34,15,0],"1f9e0":[[""],"","",["brain"],53,36,15,0],"1f9e1":[[""],"","",["orange_heart"],53,37,15,0],"1f9e2":[[""],"","",["billed_cap"],53,38,15,0],"1f9e3":[[""],"","",["scarf"],53,39,15,0],"1f9e4":[[""],"","",["gloves"],53,40,15,0],"1f9e5":[[""],"","",["coat"],53,41,15,0],"1f9e6":[[""],"","",["socks"],53,42,15,0],"1f9e7":[[""],"","",["red_envelope"],53,43,15,0],"1f9e8":[[""],"","",["firecracker"],53,44,15,0],"1f9e9":[[""],"","",["jigsaw"],53,45,15,0],"1f9ea":[[""],"","",["test_tube"],53,46,15,0],"1f9eb":[[""],"","",["petri_dish"],53,47,15,0],"1f9ec":[[""],"","",["dna"],53,48,15,0],"1f9ed":[[""],"","",["compass"],53,49,15,0],"1f9ee":[[""],"","",["abacus"],53,50,15,0],"1f9ef":[[""],"","",["fire_extinguisher"],53,51,15,0],"1f9f0":[[""],"","",["toolbox"],53,52,15,0],"1f9f1":[[""],"","",["bricks"],53,53,15,0],"1f9f2":[[""],"","",["magnet"],53,54,15,0],"1f9f3":[[""],"","",["luggage"],53,55,15,0],"1f9f4":[[""],"","",["lotion_bottle"],53,56,15,0],"1f9f5":[[""],"","",["thread"],53,57,15,0],"1f9f6":[[""],"","",["yarn"],53,58,15,0],"1f9f7":[[""],"","",["safety_pin"],53,59,15,0],"1f9f8":[[""],"","",["teddy_bear"],54,0,15,0],"1f9f9":[[""],"","",["broom"],54,1,15,0],"1f9fa":[[""],"","",["basket"],54,2,15,0],"1f9fb":[[""],"","",["roll_of_paper"],54,3,15,0],"1f9fc":[[""],"","",["soap"],54,4,15,0],"1f9fd":[[""],"","",["sponge"],54,5,15,0],"1f9fe":[[""],"","",["receipt"],54,6,15,0],"1f9ff":[[""],"","",["nazar_amulet"],54,7,15,0],"1fa70":[[""],"","",["ballet_shoes"],54,8,15,0],"1fa71":[[""],"","",["one-piece_swimsuit"],54,9,15,0],"1fa72":[[""],"","",["briefs"],54,10,15,0],"1fa73":[[""],"","",["shorts"],54,11,15,0],"1fa74":[[""],"","",["thong_sandal"],54,12,15,0],"1fa78":[[""],"","",["drop_of_blood"],54,13,15,0],"1fa79":[[""],"","",["adhesive_bandage"],54,14,15,0],"1fa7a":[[""],"","",["stethoscope"],54,15,15,0],"1fa80":[[""],"","",["yo-yo"],54,16,15,0],"1fa81":[[""],"","",["kite"],54,17,15,0],"1fa82":[[""],"","",["parachute"],54,18,15,0],"1fa83":[[""],"","",["boomerang"],54,19,15,0],"1fa84":[[""],"","",["magic_wand"],54,20,15,0],"1fa85":[[""],"","",["pinata"],54,21,15,0],"1fa86":[[""],"","",["nesting_dolls"],54,22,15,0],"1fa90":[[""],"","",["ringed_planet"],54,23,15,0],"1fa91":[[""],"","",["chair"],54,24,15,0],"1fa92":[[""],"","",["razor"],54,25,15,0],"1fa93":[[""],"","",["axe"],54,26,15,0],"1fa94":[[""],"","",["diya_lamp"],54,27,15,0],"1fa95":[[""],"","",["banjo"],54,28,15,0],"1fa96":[[""],"","",["military_helmet"],54,29,15,0],"1fa97":[[""],"","",["accordion"],54,30,15,0],"1fa98":[[""],"","",["long_drum"],54,31,15,0],"1fa99":[[""],"","",["coin"],54,32,15,0],"1fa9a":[[""],"","",["carpentry_saw"],54,33,15,0],"1fa9b":[[""],"","",["screwdriver"],54,34,15,0],"1fa9c":[[""],"","",["ladder"],54,35,15,0],"1fa9d":[[""],"","",["hook"],54,36,15,0],"1fa9e":[[""],"","",["mirror"],54,37,15,0],"1fa9f":[[""],"","",["window"],54,38,15,0],"1faa0":[[""],"","",["plunger"],54,39,15,0],"1faa1":[[""],"","",["sewing_needle"],54,40,15,0],"1faa2":[[""],"","",["knot"],54,41,15,0],"1faa3":[[""],"","",["bucket"],54,42,15,0],"1faa4":[[""],"","",["mouse_trap"],54,43,15,0],"1faa5":[[""],"","",["toothbrush"],54,44,15,0],"1faa6":[[""],"","",["headstone"],54,45,15,0],"1faa7":[[""],"","",["placard"],54,46,15,0],"1faa8":[[""],"","",["rock"],54,47,15,0],"1fab0":[[""],"","",["fly"],54,48,15,0],"1fab1":[[""],"","",["worm"],54,49,15,0],"1fab2":[[""],"","",["beetle"],54,50,15,0],"1fab3":[[""],"","",["cockroach"],54,51,15,0],"1fab4":[[""],"","",["potted_plant"],54,52,15,0],"1fab5":[[""],"","",["wood"],54,53,15,0],"1fab6":[[""],"","",["feather"],54,54,15,0],"1fac0":[[""],"","",["anatomical_heart"],54,55,15,0],"1fac1":[[""],"","",["lungs"],54,56,15,0],"1fac2":[[""],"","",["people_hugging"],54,57,15,0],"1fad0":[[""],"","",["blueberries"],54,58,15,0],"1fad1":[[""],"","",["bell_pepper"],54,59,15,0],"1fad2":[[""],"","",["olive"],55,0,15,0],"1fad3":[[""],"","",["flatbread"],55,1,15,0],"1fad4":[[""],"","",["tamale"],55,2,15,0],"1fad5":[[""],"","",["fondue"],55,3,15,0],"1fad6":[[""],"","",["teapot"],55,4,15,0],"203c-fe0f":[["",""],"","",["bangbang"],55,5,15,0],"2049-fe0f":[["",""],"","",["interrobang"],55,6,15,0],"2122-fe0f":[["",""],"","",["tm"],55,7,15,0],"2139-fe0f":[["",""],"","",["information_source"],55,8,15,0],"2194-fe0f":[["",""],"","",["left_right_arrow"],55,9,15,0],"2195-fe0f":[["",""],"","",["arrow_up_down"],55,10,15,0],"2196-fe0f":[["",""],"","",["arrow_upper_left"],55,11,15,0],"2197-fe0f":[["",""],"","",["arrow_upper_right"],55,12,15,0],"2198-fe0f":[["",""],"","",["arrow_lower_right"],55,13,15,0],"2199-fe0f":[["",""],"","",["arrow_lower_left"],55,14,15,0],"21a9-fe0f":[["",""],"","",["leftwards_arrow_with_hook"],55,15,15,0],"21aa-fe0f":[["",""],"","",["arrow_right_hook"],55,16,15,0],"231a":[[""],"","",["watch"],55,17,15,0],"231b":[[""],"","",["hourglass"],55,18,15,0],"2328-fe0f":[["",""],"","",["keyboard"],55,19,15,0],"23cf-fe0f":[["",""],"","",["eject"],55,20,15,0],"23e9":[[""],"","",["fast_forward"],55,21,15,0],"23ea":[[""],"","",["rewind"],55,22,15,0],"23eb":[[""],"","",["arrow_double_up"],55,23,15,0],"23ec":[[""],"","",["arrow_double_down"],55,24,15,0],"23ed-fe0f":[["",""],"","",["black_right_pointing_double_triangle_with_vertical_bar"],55,25,15,0],"23ee-fe0f":[["",""],"","",["black_left_pointing_double_triangle_with_vertical_bar"],55,26,15,0],"23ef-fe0f":[["",""],"","",["black_right_pointing_triangle_with_double_vertical_bar"],55,27,15,0],"23f0":[[""],"","",["alarm_clock"],55,28,15,0],"23f1-fe0f":[["",""],"","",["stopwatch"],55,29,15,0],"23f2-fe0f":[["",""],"","",["timer_clock"],55,30,15,0],"23f3":[[""],"","",["hourglass_flowing_sand"],55,31,15,0],"23f8-fe0f":[["",""],"","",["double_vertical_bar"],55,32,15,0],"23f9-fe0f":[["",""],"","",["black_square_for_stop"],55,33,15,0],"23fa-fe0f":[["",""],"","",["black_circle_for_record"],55,34,15,0],"24c2-fe0f":[["",""],"","",["m"],55,35,15,0],"25aa-fe0f":[["",""],"","",["black_small_square"],55,36,15,0],"25ab-fe0f":[["",""],"","",["white_small_square"],55,37,15,0],"25b6-fe0f":[["",""],"","",["arrow_forward"],55,38,15,0],"25c0-fe0f":[["",""],"","",["arrow_backward"],55,39,15,0],"25fb-fe0f":[["",""],"","",["white_medium_square"],55,40,15,0],"25fc-fe0f":[["",""],"","",["black_medium_square"],55,41,15,0],"25fd":[[""],"","",["white_medium_small_square"],55,42,15,0],"25fe":[[""],"","",["black_medium_small_square"],55,43,15,0],"2600-fe0f":[["",""],"","",["sunny"],55,44,15,0],"2601-fe0f":[["",""],"","",["cloud"],55,45,15,0],"2602-fe0f":[["",""],"","",["umbrella"],55,46,15,0],"2603-fe0f":[["",""],"","",["snowman"],55,47,15,0],"2604-fe0f":[["",""],"","",["comet"],55,48,15,0],"260e-fe0f":[["",""],"","",["phone","telephone"],55,49,15,0],"2611-fe0f":[["",""],"","",["ballot_box_with_check"],55,50,15,0],2614:[[""],"","",["umbrella_with_rain_drops"],55,51,15,0],2615:[[""],"","",["coffee"],55,52,15,0],"2618-fe0f":[["",""],"","",["shamrock"],55,53,15,0],"261d-fe0f":[["",""],"","",["point_up"],55,54,15,0],"2620-fe0f":[["",""],"","",["skull_and_crossbones"],56,0,15,0],"2622-fe0f":[["",""],"","",["radioactive_sign"],56,1,15,0],"2623-fe0f":[["",""],"","",["biohazard_sign"],56,2,15,0],"2626-fe0f":[["",""],"","",["orthodox_cross"],56,3,15,0],"262a-fe0f":[["",""],"","",["star_and_crescent"],56,4,15,0],"262e-fe0f":[["",""],"","",["peace_symbol"],56,5,15,0],"262f-fe0f":[["",""],"","",["yin_yang"],56,6,15,0],"2638-fe0f":[["",""],"","",["wheel_of_dharma"],56,7,15,0],"2639-fe0f":[["",""],"","",["white_frowning_face"],56,8,15,0],"263a-fe0f":[["",""],"","",["relaxed"],56,9,15,0],"2640-fe0f":[["",""],"","",["female_sign"],56,10,14,0],"2642-fe0f":[["",""],"","",["male_sign"],56,11,14,0],2648:[[""],"","",["aries"],56,12,15,0],2649:[[""],"","",["taurus"],56,13,15,0],"264a":[[""],"","",["gemini"],56,14,15,0],"264b":[[""],"","",["cancer"],56,15,15,0],"264c":[[""],"","",["leo"],56,16,15,0],"264d":[[""],"","",["virgo"],56,17,15,0],"264e":[[""],"","",["libra"],56,18,15,0],"264f":[[""],"","",["scorpius"],56,19,15,0],2650:[[""],"","",["sagittarius"],56,20,15,0],2651:[[""],"","",["capricorn"],56,21,15,0],2652:[[""],"","",["aquarius"],56,22,15,0],2653:[[""],"","",["pisces"],56,23,15,0],"265f-fe0f":[["",""],"","",["chess_pawn"],56,24,15,0],"2660-fe0f":[["",""],"","",["spades"],56,25,15,0],"2663-fe0f":[["",""],"","",["clubs"],56,26,15,0],"2665-fe0f":[["",""],"","",["hearts"],56,27,15,0],"2666-fe0f":[["",""],"","",["diamonds"],56,28,15,0],"2668-fe0f":[["",""],"","",["hotsprings"],56,29,15,0],"267b-fe0f":[["",""],"","",["recycle"],56,30,15,0],"267e-fe0f":[["",""],"","",["infinity"],56,31,15,0],"267f":[[""],"","",["wheelchair"],56,32,15,0],"2692-fe0f":[["",""],"","",["hammer_and_pick"],56,33,15,0],2693:[[""],"","",["anchor"],56,34,15,0],"2694-fe0f":[["",""],"","",["crossed_swords"],56,35,15,0],"2695-fe0f":[["",""],"","",["medical_symbol","staff_of_aesculapius"],56,36,14,0],"2696-fe0f":[["",""],"","",["scales"],56,37,15,0],"2697-fe0f":[["",""],"","",["alembic"],56,38,15,0],"2699-fe0f":[["",""],"","",["gear"],56,39,15,0],"269b-fe0f":[["",""],"","",["atom_symbol"],56,40,15,0],"269c-fe0f":[["",""],"","",["fleur_de_lis"],56,41,15,0],"26a0-fe0f":[["",""],"","",["warning"],56,42,15,0],"26a1":[[""],"","",["zap"],56,43,15,0],"26a7-fe0f":[["",""],"","",["transgender_symbol"],56,44,15,0],"26aa":[[""],"","",["white_circle"],56,45,15,0],"26ab":[[""],"","",["black_circle"],56,46,15,0],"26b0-fe0f":[["",""],"","",["coffin"],56,47,15,0],"26b1-fe0f":[["",""],"","",["funeral_urn"],56,48,15,0],"26bd":[[""],"","",["soccer"],56,49,15,0],"26be":[[""],"","",["baseball"],56,50,15,0],"26c4":[[""],"","",["snowman_without_snow"],56,51,15,0],"26c5":[[""],"","",["partly_sunny"],56,52,15,0],"26c8-fe0f":[["",""],"","",["thunder_cloud_and_rain"],56,53,15,0],"26ce":[[""],"","",["ophiuchus"],56,54,15,0],"26cf-fe0f":[["",""],"","",["pick"],56,55,15,0],"26d1-fe0f":[["",""],"","",["helmet_with_white_cross"],56,56,15,0],"26d3-fe0f":[["",""],"","",["chains"],56,57,15,0],"26d4":[[""],"","",["no_entry"],56,58,15,0],"26e9-fe0f":[["",""],"","",["shinto_shrine"],56,59,15,0],"26ea":[[""],"","",["church"],57,0,15,0],"26f0-fe0f":[["",""],"","",["mountain"],57,1,15,0],"26f1-fe0f":[["",""],"","",["umbrella_on_ground"],57,2,15,0],"26f2":[[""],"","",["fountain"],57,3,15,0],"26f3":[[""],"","",["golf"],57,4,15,0],"26f4-fe0f":[["",""],"","",["ferry"],57,5,15,0],"26f5":[[""],"","",["boat","sailboat"],57,6,15,0],"26f7-fe0f":[["",""],"","",["skier"],57,7,15,0],"26f8-fe0f":[["",""],"","",["ice_skate"],57,8,15,0],"26f9-fe0f-200d-2640-fe0f":[[""],"","",["woman-bouncing-ball"],57,9,7,0],"26f9-fe0f-200d-2642-fe0f":[["","",""],"","",["man-bouncing-ball","person_with_ball"],57,15,7,0],"26fa":[[""],"","",["tent"],57,27,15,0],"26fd":[[""],"","",["fuelpump"],57,28,15,0],"2702-fe0f":[["",""],"","",["scissors"],57,29,15,0],2705:[[""],"","",["white_check_mark"],57,30,15,0],"2708-fe0f":[["",""],"","",["airplane"],57,31,15,0],"2709-fe0f":[["",""],"","",["email","envelope"],57,32,15,0],"270a":[[""],"","",["fist"],57,33,15,0],"270b":[[""],"","",["hand","raised_hand"],57,39,15,0],"270c-fe0f":[["",""],"","",["v"],57,45,15,0],"270d-fe0f":[["",""],"","",["writing_hand"],57,51,15,0],"270f-fe0f":[["",""],"","",["pencil2"],57,57,15,0],"2712-fe0f":[["",""],"","",["black_nib"],57,58,15,0],"2714-fe0f":[["",""],"","",["heavy_check_mark"],57,59,15,0],"2716-fe0f":[["",""],"","",["heavy_multiplication_x"],58,0,15,0],"271d-fe0f":[["",""],"","",["latin_cross"],58,1,15,0],"2721-fe0f":[["",""],"","",["star_of_david"],58,2,15,0],2728:[[""],"","",["sparkles"],58,3,15,0],"2733-fe0f":[["",""],"","",["eight_spoked_asterisk"],58,4,15,0],"2734-fe0f":[["",""],"","",["eight_pointed_black_star"],58,5,15,0],"2744-fe0f":[["",""],"","",["snowflake"],58,6,15,0],"2747-fe0f":[["",""],"","",["sparkle"],58,7,15,0],"274c":[[""],"","",["x"],58,8,15,0],"274e":[[""],"","",["negative_squared_cross_mark"],58,9,15,0],2753:[[""],"","",["question"],58,10,15,0],2754:[[""],"","",["grey_question"],58,11,15,0],2755:[[""],"","",["grey_exclamation"],58,12,15,0],2757:[[""],"","",["exclamation","heavy_exclamation_mark"],58,13,15,0],"2763-fe0f":[["",""],"","",["heavy_heart_exclamation_mark_ornament"],58,14,15,0],"2764-fe0f-200d-1f525":[["",""],"","",["heart_on_fire"],58,15,7,0],"2764-fe0f-200d-1fa79":[["",""],"","",["mending_heart"],58,16,7,0],"2764-fe0f":[["",""],"","",["heart"],58,17,15,0,"<3"],2795:[[""],"","",["heavy_plus_sign"],58,18,15,0],2796:[[""],"","",["heavy_minus_sign"],58,19,15,0],2797:[[""],"","",["heavy_division_sign"],58,20,15,0],"27a1-fe0f":[["",""],"","",["arrow_right"],58,21,15,0],"27b0":[[""],"","",["curly_loop"],58,22,15,0],"27bf":[[""],"","",["loop"],58,23,15,0],"2934-fe0f":[["",""],"","",["arrow_heading_up"],58,24,15,0],"2935-fe0f":[["",""],"","",["arrow_heading_down"],58,25,15,0],"2b05-fe0f":[["",""],"","",["arrow_left"],58,26,15,0],"2b06-fe0f":[["",""],"","",["arrow_up"],58,27,15,0],"2b07-fe0f":[["",""],"","",["arrow_down"],58,28,15,0],"2b1b":[[""],"","",["black_large_square"],58,29,15,0],"2b1c":[[""],"","",["white_large_square"],58,30,15,0],"2b50":[[""],"","",["star"],58,31,15,0],"2b55":[[""],"","",["o"],58,32,15,0],"3030-fe0f":[["",""],"","",["wavy_dash"],58,33,15,0],"303d-fe0f":[["",""],"","",["part_alternation_mark"],58,34,15,0],"3297-fe0f":[["",""],"","",["congratulations"],58,35,15,0],"3299-fe0f":[["",""],"","",["secret"],58,36,15,0]};n.prototype.emoticons_data={":o)":"monkey_face","</3":"broken_heart","=)":"smiley","=-)":"smiley","C:":"smile","c:":"smile",":D":"smile",":-D":"smile",":>":"laughing",":->":"laughing",";)":"wink",";-)":"wink","8)":"sunglasses",":|":"neutral_face",":-|":"neutral_face",":\\":"confused",":-\\":"confused",":/":"confused",":-/":"confused",":*":"kissing_heart",":-*":"kissing_heart",":p":"stuck_out_tongue",":-p":"stuck_out_tongue",":P":"stuck_out_tongue",":-P":"stuck_out_tongue",":b":"stuck_out_tongue",":-b":"stuck_out_tongue",";p":"stuck_out_tongue_winking_eye",";-p":"stuck_out_tongue_winking_eye",";b":"stuck_out_tongue_winking_eye",";-b":"stuck_out_tongue_winking_eye",";P":"stuck_out_tongue_winking_eye",";-P":"stuck_out_tongue_winking_eye","):":"disappointed",":(":"disappointed",":-(":"disappointed",">:(":"angry",">:-(":"angry",":'(":"cry","D:":"anguished",":o":"open_mouth",":-o":"open_mouth",":O":"open_mouth",":-O":"open_mouth",":)":"slightly_smiling_face","(:":"slightly_smiling_face",":-)":"slightly_smiling_face","<3":"heart"};n.prototype.variations_data={"1f385":{"1f3fb":["1f385-1f3fb",7,16,15,[""]],"1f3fc":["1f385-1f3fc",7,17,15,[""]],"1f3fd":["1f385-1f3fd",7,18,15,[""]],"1f3fe":["1f385-1f3fe",7,19,15,[""]],"1f3ff":["1f385-1f3ff",7,20,15,[""]]},"1f3c2":{"1f3fb":["1f3c2-1f3fb",8,17,15,[""]],"1f3fc":["1f3c2-1f3fc",8,18,15,[""]],"1f3fd":["1f3c2-1f3fd",8,19,15,[""]],"1f3fe":["1f3c2-1f3fe",8,20,15,[""]],"1f3ff":["1f3c2-1f3ff",8,21,15,[""]]},"1f3c3-200d-2640-fe0f":{"1f3fb":["1f3c3-1f3fb-200d-2640-fe0f",8,23,15,[""]],"1f3fc":["1f3c3-1f3fc-200d-2640-fe0f",8,24,15,[""]],"1f3fd":["1f3c3-1f3fd-200d-2640-fe0f",8,25,15,[""]],"1f3fe":["1f3c3-1f3fe-200d-2640-fe0f",8,26,15,[""]],"1f3ff":["1f3c3-1f3ff-200d-2640-fe0f",8,27,15,[""]]},"1f3c3-200d-2642-fe0f":{"1f3fb":["1f3c3-1f3fb-200d-2642-fe0f",8,29,15,["",""]],"1f3fc":["1f3c3-1f3fc-200d-2642-fe0f",8,30,15,["",""]],"1f3fd":["1f3c3-1f3fd-200d-2642-fe0f",8,31,15,["",""]],"1f3fe":["1f3c3-1f3fe-200d-2642-fe0f",8,32,15,["",""]],"1f3ff":["1f3c3-1f3ff-200d-2642-fe0f",8,33,15,["",""]]},"1f3c4-200d-2640-fe0f":{"1f3fb":["1f3c4-1f3fb-200d-2640-fe0f",8,41,15,[""]],"1f3fc":["1f3c4-1f3fc-200d-2640-fe0f",8,42,15,[""]],"1f3fd":["1f3c4-1f3fd-200d-2640-fe0f",8,43,15,[""]],"1f3fe":["1f3c4-1f3fe-200d-2640-fe0f",8,44,15,[""]],"1f3ff":["1f3c4-1f3ff-200d-2640-fe0f",8,45,15,[""]]},"1f3c4-200d-2642-fe0f":{"1f3fb":["1f3c4-1f3fb-200d-2642-fe0f",8,47,15,["",""]],"1f3fc":["1f3c4-1f3fc-200d-2642-fe0f",8,48,15,["",""]],"1f3fd":["1f3c4-1f3fd-200d-2642-fe0f",8,49,15,["",""]],"1f3fe":["1f3c4-1f3fe-200d-2642-fe0f",8,50,15,["",""]],"1f3ff":["1f3c4-1f3ff-200d-2642-fe0f",8,51,15,["",""]]},"1f3c7":{"1f3fb":["1f3c7-1f3fb",9,1,15,[""]],"1f3fc":["1f3c7-1f3fc",9,2,15,[""]],"1f3fd":["1f3c7-1f3fd",9,3,15,[""]],"1f3fe":["1f3c7-1f3fe",9,4,15,[""]],"1f3ff":["1f3c7-1f3ff",9,5,15,[""]]},"1f3ca-200d-2640-fe0f":{"1f3fb":["1f3ca-1f3fb-200d-2640-fe0f",9,9,15,[""]],"1f3fc":["1f3ca-1f3fc-200d-2640-fe0f",9,10,15,[""]],"1f3fd":["1f3ca-1f3fd-200d-2640-fe0f",9,11,15,[""]],"1f3fe":["1f3ca-1f3fe-200d-2640-fe0f",9,12,15,[""]],"1f3ff":["1f3ca-1f3ff-200d-2640-fe0f",9,13,15,[""]]},"1f3ca-200d-2642-fe0f":{"1f3fb":["1f3ca-1f3fb-200d-2642-fe0f",9,15,15,["",""]],"1f3fc":["1f3ca-1f3fc-200d-2642-fe0f",9,16,15,["",""]],"1f3fd":["1f3ca-1f3fd-200d-2642-fe0f",9,17,15,["",""]],"1f3fe":["1f3ca-1f3fe-200d-2642-fe0f",9,18,15,["",""]],"1f3ff":["1f3ca-1f3ff-200d-2642-fe0f",9,19,15,["",""]]},"1f3cb-fe0f-200d-2640-fe0f":{"1f3fb":["1f3cb-1f3fb-200d-2640-fe0f",9,27,15,[""]],"1f3fc":["1f3cb-1f3fc-200d-2640-fe0f",9,28,15,[""]],"1f3fd":["1f3cb-1f3fd-200d-2640-fe0f",9,29,15,[""]],"1f3fe":["1f3cb-1f3fe-200d-2640-fe0f",9,30,15,[""]],"1f3ff":["1f3cb-1f3ff-200d-2640-fe0f",9,31,15,[""]]},"1f3cb-fe0f-200d-2642-fe0f":{"1f3fb":["1f3cb-1f3fb-200d-2642-fe0f",9,33,15,["",""]],"1f3fc":["1f3cb-1f3fc-200d-2642-fe0f",9,34,15,["",""]],"1f3fd":["1f3cb-1f3fd-200d-2642-fe0f",9,35,15,["",""]],"1f3fe":["1f3cb-1f3fe-200d-2642-fe0f",9,36,15,["",""]],"1f3ff":["1f3cb-1f3ff-200d-2642-fe0f",9,37,15,["",""]]},"1f3cc-fe0f-200d-2640-fe0f":{"1f3fb":["1f3cc-1f3fb-200d-2640-fe0f",9,45,15,[""]],"1f3fc":["1f3cc-1f3fc-200d-2640-fe0f",9,46,15,[""]],"1f3fd":["1f3cc-1f3fd-200d-2640-fe0f",9,47,15,[""]],"1f3fe":["1f3cc-1f3fe-200d-2640-fe0f",9,48,15,[""]],"1f3ff":["1f3cc-1f3ff-200d-2640-fe0f",9,49,15,[""]]},"1f3cc-fe0f-200d-2642-fe0f":{"1f3fb":["1f3cc-1f3fb-200d-2642-fe0f",9,51,15,["",""]],"1f3fc":["1f3cc-1f3fc-200d-2642-fe0f",9,52,15,["",""]],"1f3fd":["1f3cc-1f3fd-200d-2642-fe0f",9,53,15,["",""]],"1f3fe":["1f3cc-1f3fe-200d-2642-fe0f",9,54,15,["",""]],"1f3ff":["1f3cc-1f3ff-200d-2642-fe0f",9,55,15,["",""]]},"1f442":{"1f3fb":["1f442-1f3fb",12,7,15,[""]],"1f3fc":["1f442-1f3fc",12,8,15,[""]],"1f3fd":["1f442-1f3fd",12,9,15,[""]],"1f3fe":["1f442-1f3fe",12,10,15,[""]],"1f3ff":["1f442-1f3ff",12,11,15,[""]]},"1f443":{"1f3fb":["1f443-1f3fb",12,13,15,[""]],"1f3fc":["1f443-1f3fc",12,14,15,[""]],"1f3fd":["1f443-1f3fd",12,15,15,[""]],"1f3fe":["1f443-1f3fe",12,16,15,[""]],"1f3ff":["1f443-1f3ff",12,17,15,[""]]},"1f446":{"1f3fb":["1f446-1f3fb",12,21,15,[""]],"1f3fc":["1f446-1f3fc",12,22,15,[""]],"1f3fd":["1f446-1f3fd",12,23,15,[""]],"1f3fe":["1f446-1f3fe",12,24,15,[""]],"1f3ff":["1f446-1f3ff",12,25,15,[""]]},"1f447":{"1f3fb":["1f447-1f3fb",12,27,15,[""]],"1f3fc":["1f447-1f3fc",12,28,15,[""]],"1f3fd":["1f447-1f3fd",12,29,15,[""]],"1f3fe":["1f447-1f3fe",12,30,15,[""]],"1f3ff":["1f447-1f3ff",12,31,15,[""]]},"1f448":{"1f3fb":["1f448-1f3fb",12,33,15,[""]],"1f3fc":["1f448-1f3fc",12,34,15,[""]],"1f3fd":["1f448-1f3fd",12,35,15,[""]],"1f3fe":["1f448-1f3fe",12,36,15,[""]],"1f3ff":["1f448-1f3ff",12,37,15,[""]]},"1f449":{"1f3fb":["1f449-1f3fb",12,39,15,[""]],"1f3fc":["1f449-1f3fc",12,40,15,[""]],"1f3fd":["1f449-1f3fd",12,41,15,[""]],"1f3fe":["1f449-1f3fe",12,42,15,[""]],"1f3ff":["1f449-1f3ff",12,43,15,[""]]},"1f44a":{"1f3fb":["1f44a-1f3fb",12,45,15,[""]],"1f3fc":["1f44a-1f3fc",12,46,15,[""]],"1f3fd":["1f44a-1f3fd",12,47,15,[""]],"1f3fe":["1f44a-1f3fe",12,48,15,[""]],"1f3ff":["1f44a-1f3ff",12,49,15,[""]]},"1f44b":{"1f3fb":["1f44b-1f3fb",12,51,15,[""]],"1f3fc":["1f44b-1f3fc",12,52,15,[""]],"1f3fd":["1f44b-1f3fd",12,53,15,[""]],"1f3fe":["1f44b-1f3fe",12,54,15,[""]],"1f3ff":["1f44b-1f3ff",12,55,15,[""]]},"1f44c":{"1f3fb":["1f44c-1f3fb",12,57,15,[""]],"1f3fc":["1f44c-1f3fc",12,58,15,[""]],"1f3fd":["1f44c-1f3fd",12,59,15,[""]],"1f3fe":["1f44c-1f3fe",13,0,15,[""]],"1f3ff":["1f44c-1f3ff",13,1,15,[""]]},"1f44d":{"1f3fb":["1f44d-1f3fb",13,3,15,[""]],"1f3fc":["1f44d-1f3fc",13,4,15,[""]],"1f3fd":["1f44d-1f3fd",13,5,15,[""]],"1f3fe":["1f44d-1f3fe",13,6,15,[""]],"1f3ff":["1f44d-1f3ff",13,7,15,[""]]},"1f44e":{"1f3fb":["1f44e-1f3fb",13,9,15,[""]],"1f3fc":["1f44e-1f3fc",13,10,15,[""]],"1f3fd":["1f44e-1f3fd",13,11,15,[""]],"1f3fe":["1f44e-1f3fe",13,12,15,[""]],"1f3ff":["1f44e-1f3ff",13,13,15,[""]]},"1f44f":{"1f3fb":["1f44f-1f3fb",13,15,15,[""]],"1f3fc":["1f44f-1f3fc",13,16,15,[""]],"1f3fd":["1f44f-1f3fd",13,17,15,[""]],"1f3fe":["1f44f-1f3fe",13,18,15,[""]],"1f3ff":["1f44f-1f3ff",13,19,15,[""]]},"1f450":{"1f3fb":["1f450-1f3fb",13,21,15,[""]],"1f3fc":["1f450-1f3fc",13,22,15,[""]],"1f3fd":["1f450-1f3fd",13,23,15,[""]],"1f3fe":["1f450-1f3fe",13,24,15,[""]],"1f3ff":["1f450-1f3ff",13,25,15,[""]]},"1f466":{"1f3fb":["1f466-1f3fb",13,48,15,[""]],"1f3fc":["1f466-1f3fc",13,49,15,[""]],"1f3fd":["1f466-1f3fd",13,50,15,[""]],"1f3fe":["1f466-1f3fe",13,51,15,[""]],"1f3ff":["1f466-1f3ff",13,52,15,[""]]},"1f467":{"1f3fb":["1f467-1f3fb",13,54,15,[""]],"1f3fc":["1f467-1f3fc",13,55,15,[""]],"1f3fd":["1f467-1f3fd",13,56,15,[""]],"1f3fe":["1f467-1f3fe",13,57,15,[""]],"1f3ff":["1f467-1f3ff",13,58,15,[""]]},"1f468-200d-1f33e":{"1f3fb":["1f468-1f3fb-200d-1f33e",14,0,15,[""]],"1f3fc":["1f468-1f3fc-200d-1f33e",14,1,15,[""]],"1f3fd":["1f468-1f3fd-200d-1f33e",14,2,15,[""]],"1f3fe":["1f468-1f3fe-200d-1f33e",14,3,15,[""]],"1f3ff":["1f468-1f3ff-200d-1f33e",14,4,15,[""]]},"1f468-200d-1f373":{"1f3fb":["1f468-1f3fb-200d-1f373",14,6,15,[""]],"1f3fc":["1f468-1f3fc-200d-1f373",14,7,15,[""]],"1f3fd":["1f468-1f3fd-200d-1f373",14,8,15,[""]],"1f3fe":["1f468-1f3fe-200d-1f373",14,9,15,[""]],"1f3ff":["1f468-1f3ff-200d-1f373",14,10,15,[""]]},"1f468-200d-1f37c":{"1f3fb":["1f468-1f3fb-200d-1f37c",14,12,15,[""]],"1f3fc":["1f468-1f3fc-200d-1f37c",14,13,15,[""]],"1f3fd":["1f468-1f3fd-200d-1f37c",14,14,15,[""]],"1f3fe":["1f468-1f3fe-200d-1f37c",14,15,15,[""]],"1f3ff":["1f468-1f3ff-200d-1f37c",14,16,15,[""]]},"1f468-200d-1f393":{"1f3fb":["1f468-1f3fb-200d-1f393",14,18,15,[""]],"1f3fc":["1f468-1f3fc-200d-1f393",14,19,15,[""]],"1f3fd":["1f468-1f3fd-200d-1f393",14,20,15,[""]],"1f3fe":["1f468-1f3fe-200d-1f393",14,21,15,[""]],"1f3ff":["1f468-1f3ff-200d-1f393",14,22,15,[""]]},"1f468-200d-1f3a4":{"1f3fb":["1f468-1f3fb-200d-1f3a4",14,24,15,[""]],"1f3fc":["1f468-1f3fc-200d-1f3a4",14,25,15,[""]],"1f3fd":["1f468-1f3fd-200d-1f3a4",14,26,15,[""]],"1f3fe":["1f468-1f3fe-200d-1f3a4",14,27,15,[""]],"1f3ff":["1f468-1f3ff-200d-1f3a4",14,28,15,[""]]},"1f468-200d-1f3a8":{"1f3fb":["1f468-1f3fb-200d-1f3a8",14,30,15,[""]],"1f3fc":["1f468-1f3fc-200d-1f3a8",14,31,15,[""]],"1f3fd":["1f468-1f3fd-200d-1f3a8",14,32,15,[""]],"1f3fe":["1f468-1f3fe-200d-1f3a8",14,33,15,[""]],"1f3ff":["1f468-1f3ff-200d-1f3a8",14,34,15,[""]]},"1f468-200d-1f3eb":{"1f3fb":["1f468-1f3fb-200d-1f3eb",14,36,15,[""]],"1f3fc":["1f468-1f3fc-200d-1f3eb",14,37,15,[""]],"1f3fd":["1f468-1f3fd-200d-1f3eb",14,38,15,[""]],"1f3fe":["1f468-1f3fe-200d-1f3eb",14,39,15,[""]],"1f3ff":["1f468-1f3ff-200d-1f3eb",14,40,15,[""]]},"1f468-200d-1f3ed":{"1f3fb":["1f468-1f3fb-200d-1f3ed",14,42,15,[""]],"1f3fc":["1f468-1f3fc-200d-1f3ed",14,43,15,[""]],"1f3fd":["1f468-1f3fd-200d-1f3ed",14,44,15,[""]],"1f3fe":["1f468-1f3fe-200d-1f3ed",14,45,15,[""]],"1f3ff":["1f468-1f3ff-200d-1f3ed",14,46,15,[""]]},"1f468-200d-1f4bb":{"1f3fb":["1f468-1f3fb-200d-1f4bb",15,3,15,[""]],"1f3fc":["1f468-1f3fc-200d-1f4bb",15,4,15,[""]],"1f3fd":["1f468-1f3fd-200d-1f4bb",15,5,15,[""]],"1f3fe":["1f468-1f3fe-200d-1f4bb",15,6,15,[""]],"1f3ff":["1f468-1f3ff-200d-1f4bb",15,7,15,[""]]},"1f468-200d-1f4bc":{"1f3fb":["1f468-1f3fb-200d-1f4bc",15,9,15,[""]],"1f3fc":["1f468-1f3fc-200d-1f4bc",15,10,15,[""]],"1f3fd":["1f468-1f3fd-200d-1f4bc",15,11,15,[""]],"1f3fe":["1f468-1f3fe-200d-1f4bc",15,12,15,[""]],"1f3ff":["1f468-1f3ff-200d-1f4bc",15,13,15,[""]]},"1f468-200d-1f527":{"1f3fb":["1f468-1f3fb-200d-1f527",15,15,15,[""]],"1f3fc":["1f468-1f3fc-200d-1f527",15,16,15,[""]],"1f3fd":["1f468-1f3fd-200d-1f527",15,17,15,[""]],"1f3fe":["1f468-1f3fe-200d-1f527",15,18,15,[""]],"1f3ff":["1f468-1f3ff-200d-1f527",15,19,15,[""]]},"1f468-200d-1f52c":{"1f3fb":["1f468-1f3fb-200d-1f52c",15,21,15,[""]],"1f3fc":["1f468-1f3fc-200d-1f52c",15,22,15,[""]],"1f3fd":["1f468-1f3fd-200d-1f52c",15,23,15,[""]],"1f3fe":["1f468-1f3fe-200d-1f52c",15,24,15,[""]],"1f3ff":["1f468-1f3ff-200d-1f52c",15,25,15,[""]]},"1f468-200d-1f680":{"1f3fb":["1f468-1f3fb-200d-1f680",15,27,15,[""]],"1f3fc":["1f468-1f3fc-200d-1f680",15,28,15,[""]],"1f3fd":["1f468-1f3fd-200d-1f680",15,29,15,[""]],"1f3fe":["1f468-1f3fe-200d-1f680",15,30,15,[""]],"1f3ff":["1f468-1f3ff-200d-1f680",15,31,15,[""]]},"1f468-200d-1f692":{"1f3fb":["1f468-1f3fb-200d-1f692",15,33,15,[""]],"1f3fc":["1f468-1f3fc-200d-1f692",15,34,15,[""]],"1f3fd":["1f468-1f3fd-200d-1f692",15,35,15,[""]],"1f3fe":["1f468-1f3fe-200d-1f692",15,36,15,[""]],"1f3ff":["1f468-1f3ff-200d-1f692",15,37,15,[""]]},"1f468-200d-1f9af":{"1f3fb":["1f468-1f3fb-200d-1f9af",15,39,15,[""]],"1f3fc":["1f468-1f3fc-200d-1f9af",15,40,15,[""]],"1f3fd":["1f468-1f3fd-200d-1f9af",15,41,15,[""]],"1f3fe":["1f468-1f3fe-200d-1f9af",15,42,15,[""]],"1f3ff":["1f468-1f3ff-200d-1f9af",15,43,15,[""]]},"1f468-200d-1f9b0":{"1f3fb":["1f468-1f3fb-200d-1f9b0",15,45,15,[""]],"1f3fc":["1f468-1f3fc-200d-1f9b0",15,46,15,[""]],"1f3fd":["1f468-1f3fd-200d-1f9b0",15,47,15,[""]],"1f3fe":["1f468-1f3fe-200d-1f9b0",15,48,15,[""]],"1f3ff":["1f468-1f3ff-200d-1f9b0",15,49,15,[""]]},"1f468-200d-1f9b1":{"1f3fb":["1f468-1f3fb-200d-1f9b1",15,51,15,[""]],"1f3fc":["1f468-1f3fc-200d-1f9b1",15,52,15,[""]],"1f3fd":["1f468-1f3fd-200d-1f9b1",15,53,15,[""]],"1f3fe":["1f468-1f3fe-200d-1f9b1",15,54,15,[""]],"1f3ff":["1f468-1f3ff-200d-1f9b1",15,55,15,[""]]},"1f468-200d-1f9b2":{"1f3fb":["1f468-1f3fb-200d-1f9b2",15,57,15,[""]],"1f3fc":["1f468-1f3fc-200d-1f9b2",15,58,15,[""]],"1f3fd":["1f468-1f3fd-200d-1f9b2",15,59,15,[""]],"1f3fe":["1f468-1f3fe-200d-1f9b2",16,0,15,[""]],"1f3ff":["1f468-1f3ff-200d-1f9b2",16,1,15,[""]]},"1f468-200d-1f9b3":{"1f3fb":["1f468-1f3fb-200d-1f9b3",16,3,15,[""]],"1f3fc":["1f468-1f3fc-200d-1f9b3",16,4,15,[""]],"1f3fd":["1f468-1f3fd-200d-1f9b3",16,5,15,[""]],"1f3fe":["1f468-1f3fe-200d-1f9b3",16,6,15,[""]],"1f3ff":["1f468-1f3ff-200d-1f9b3",16,7,15,[""]]},"1f468-200d-1f9bc":{"1f3fb":["1f468-1f3fb-200d-1f9bc",16,9,15,[""]],"1f3fc":["1f468-1f3fc-200d-1f9bc",16,10,15,[""]],"1f3fd":["1f468-1f3fd-200d-1f9bc",16,11,15,[""]],"1f3fe":["1f468-1f3fe-200d-1f9bc",16,12,15,[""]],"1f3ff":["1f468-1f3ff-200d-1f9bc",16,13,15,[""]]},"1f468-200d-1f9bd":{"1f3fb":["1f468-1f3fb-200d-1f9bd",16,15,15,[""]],"1f3fc":["1f468-1f3fc-200d-1f9bd",16,16,15,[""]],"1f3fd":["1f468-1f3fd-200d-1f9bd",16,17,15,[""]],"1f3fe":["1f468-1f3fe-200d-1f9bd",16,18,15,[""]],"1f3ff":["1f468-1f3ff-200d-1f9bd",16,19,15,[""]]},"1f468-200d-2695-fe0f":{"1f3fb":["1f468-1f3fb-200d-2695-fe0f",16,21,15,[""]],"1f3fc":["1f468-1f3fc-200d-2695-fe0f",16,22,15,[""]],"1f3fd":["1f468-1f3fd-200d-2695-fe0f",16,23,15,[""]],"1f3fe":["1f468-1f3fe-200d-2695-fe0f",16,24,15,[""]],"1f3ff":["1f468-1f3ff-200d-2695-fe0f",16,25,15,[""]]},"1f468-200d-2696-fe0f":{"1f3fb":["1f468-1f3fb-200d-2696-fe0f",16,27,15,[""]],"1f3fc":["1f468-1f3fc-200d-2696-fe0f",16,28,15,[""]],"1f3fd":["1f468-1f3fd-200d-2696-fe0f",16,29,15,[""]],"1f3fe":["1f468-1f3fe-200d-2696-fe0f",16,30,15,[""]],"1f3ff":["1f468-1f3ff-200d-2696-fe0f",16,31,15,[""]]},"1f468-200d-2708-fe0f":{"1f3fb":["1f468-1f3fb-200d-2708-fe0f",16,33,15,[""]],"1f3fc":["1f468-1f3fc-200d-2708-fe0f",16,34,15,[""]],"1f3fd":["1f468-1f3fd-200d-2708-fe0f",16,35,15,[""]],"1f3fe":["1f468-1f3fe-200d-2708-fe0f",16,36,15,[""]],"1f3ff":["1f468-1f3ff-200d-2708-fe0f",16,37,15,[""]]},"1f468-200d-2764-fe0f-200d-1f468":{"1f3fb-1f3fb":["1f468-1f3fb-200d-2764-fe0f-200d-1f468-1f3fb",16,39,7,[""]],"1f3fb-1f3fc":["1f468-1f3fb-200d-2764-fe0f-200d-1f468-1f3fc",16,40,7,[""]],"1f3fb-1f3fd":["1f468-1f3fb-200d-2764-fe0f-200d-1f468-1f3fd",16,41,7,[""]],"1f3fb-1f3fe":["1f468-1f3fb-200d-2764-fe0f-200d-1f468-1f3fe",16,42,7,[""]],"1f3fb-1f3ff":["1f468-1f3fb-200d-2764-fe0f-200d-1f468-1f3ff",16,43,7,[""]],"1f3fc-1f3fb":["1f468-1f3fc-200d-2764-fe0f-200d-1f468-1f3fb",16,44,7,[""]],"1f3fc-1f3fc":["1f468-1f3fc-200d-2764-fe0f-200d-1f468-1f3fc",16,45,7,[""]],"1f3fc-1f3fd":["1f468-1f3fc-200d-2764-fe0f-200d-1f468-1f3fd",16,46,7,[""]],"1f3fc-1f3fe":["1f468-1f3fc-200d-2764-fe0f-200d-1f468-1f3fe",16,47,7,[""]],"1f3fc-1f3ff":["1f468-1f3fc-200d-2764-fe0f-200d-1f468-1f3ff",16,48,7,[""]],"1f3fd-1f3fb":["1f468-1f3fd-200d-2764-fe0f-200d-1f468-1f3fb",16,49,7,[""]],"1f3fd-1f3fc":["1f468-1f3fd-200d-2764-fe0f-200d-1f468-1f3fc",16,50,7,[""]],"1f3fd-1f3fd":["1f468-1f3fd-200d-2764-fe0f-200d-1f468-1f3fd",16,51,7,[""]],"1f3fd-1f3fe":["1f468-1f3fd-200d-2764-fe0f-200d-1f468-1f3fe",16,52,7,[""]],"1f3fd-1f3ff":["1f468-1f3fd-200d-2764-fe0f-200d-1f468-1f3ff",16,53,7,[""]],"1f3fe-1f3fb":["1f468-1f3fe-200d-2764-fe0f-200d-1f468-1f3fb",16,54,7,[""]],"1f3fe-1f3fc":["1f468-1f3fe-200d-2764-fe0f-200d-1f468-1f3fc",16,55,7,[""]],"1f3fe-1f3fd":["1f468-1f3fe-200d-2764-fe0f-200d-1f468-1f3fd",16,56,7,[""]],"1f3fe-1f3fe":["1f468-1f3fe-200d-2764-fe0f-200d-1f468-1f3fe",16,57,7,[""]],"1f3fe-1f3ff":["1f468-1f3fe-200d-2764-fe0f-200d-1f468-1f3ff",16,58,7,[""]],"1f3ff-1f3fb":["1f468-1f3ff-200d-2764-fe0f-200d-1f468-1f3fb",16,59,7,[""]],"1f3ff-1f3fc":["1f468-1f3ff-200d-2764-fe0f-200d-1f468-1f3fc",17,0,7,[""]],"1f3ff-1f3fd":["1f468-1f3ff-200d-2764-fe0f-200d-1f468-1f3fd",17,1,7,[""]],"1f3ff-1f3fe":["1f468-1f3ff-200d-2764-fe0f-200d-1f468-1f3fe",17,2,7,[""]],"1f3ff-1f3ff":["1f468-1f3ff-200d-2764-fe0f-200d-1f468-1f3ff",17,3,7,[""]]},"1f468-200d-2764-fe0f-200d-1f48b-200d-1f468":{"1f3fb-1f3fb":["1f468-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb",17,5,7,[""]],"1f3fb-1f3fc":["1f468-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc",17,6,7,[""]],"1f3fb-1f3fd":["1f468-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd",17,7,7,[""]],"1f3fb-1f3fe":["1f468-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe",17,8,7,[""]],"1f3fb-1f3ff":["1f468-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff",17,9,7,[""]],"1f3fc-1f3fb":["1f468-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb",17,10,7,[""]],"1f3fc-1f3fc":["1f468-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc",17,11,7,[""]],"1f3fc-1f3fd":["1f468-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd",17,12,7,[""]],"1f3fc-1f3fe":["1f468-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe",17,13,7,[""]],"1f3fc-1f3ff":["1f468-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff",17,14,7,[""]],"1f3fd-1f3fb":["1f468-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb",17,15,7,[""]],"1f3fd-1f3fc":["1f468-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc",17,16,7,[""]],"1f3fd-1f3fd":["1f468-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd",17,17,7,[""]],"1f3fd-1f3fe":["1f468-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe",17,18,7,[""]],"1f3fd-1f3ff":["1f468-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff",17,19,7,[""]],"1f3fe-1f3fb":["1f468-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb",17,20,7,[""]],"1f3fe-1f3fc":["1f468-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc",17,21,7,[""]],"1f3fe-1f3fd":["1f468-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd",17,22,7,[""]],"1f3fe-1f3fe":["1f468-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe",17,23,7,[""]],"1f3fe-1f3ff":["1f468-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff",17,24,7,[""]],"1f3ff-1f3fb":["1f468-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb",17,25,7,[""]],"1f3ff-1f3fc":["1f468-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc",17,26,7,[""]],"1f3ff-1f3fd":["1f468-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd",17,27,7,[""]],"1f3ff-1f3fe":["1f468-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe",17,28,7,[""]],"1f3ff-1f3ff":["1f468-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff",17,29,7,[""]]},"1f468":{"1f3fb":["1f468-1f3fb",17,31,15,[""]],"1f3fc":["1f468-1f3fc",17,32,15,[""]],"1f3fd":["1f468-1f3fd",17,33,15,[""]],"1f3fe":["1f468-1f3fe",17,34,15,[""]],"1f3ff":["1f468-1f3ff",17,35,15,[""]]},"1f469-200d-1f33e":{"1f3fb":["1f469-1f3fb-200d-1f33e",17,37,15,[""]],"1f3fc":["1f469-1f3fc-200d-1f33e",17,38,15,[""]],"1f3fd":["1f469-1f3fd-200d-1f33e",17,39,15,[""]],"1f3fe":["1f469-1f3fe-200d-1f33e",17,40,15,[""]],"1f3ff":["1f469-1f3ff-200d-1f33e",17,41,15,[""]]},"1f469-200d-1f373":{"1f3fb":["1f469-1f3fb-200d-1f373",17,43,15,[""]],"1f3fc":["1f469-1f3fc-200d-1f373",17,44,15,[""]],"1f3fd":["1f469-1f3fd-200d-1f373",17,45,15,[""]],"1f3fe":["1f469-1f3fe-200d-1f373",17,46,15,[""]],"1f3ff":["1f469-1f3ff-200d-1f373",17,47,15,[""]]},"1f469-200d-1f37c":{"1f3fb":["1f469-1f3fb-200d-1f37c",17,49,15,[""]],"1f3fc":["1f469-1f3fc-200d-1f37c",17,50,15,[""]],"1f3fd":["1f469-1f3fd-200d-1f37c",17,51,15,[""]],"1f3fe":["1f469-1f3fe-200d-1f37c",17,52,15,[""]],"1f3ff":["1f469-1f3ff-200d-1f37c",17,53,15,[""]]},"1f469-200d-1f393":{"1f3fb":["1f469-1f3fb-200d-1f393",17,55,15,[""]],"1f3fc":["1f469-1f3fc-200d-1f393",17,56,15,[""]],"1f3fd":["1f469-1f3fd-200d-1f393",17,57,15,[""]],"1f3fe":["1f469-1f3fe-200d-1f393",17,58,15,[""]],"1f3ff":["1f469-1f3ff-200d-1f393",17,59,15,[""]]},"1f469-200d-1f3a4":{"1f3fb":["1f469-1f3fb-200d-1f3a4",18,1,15,[""]],"1f3fc":["1f469-1f3fc-200d-1f3a4",18,2,15,[""]],"1f3fd":["1f469-1f3fd-200d-1f3a4",18,3,15,[""]],"1f3fe":["1f469-1f3fe-200d-1f3a4",18,4,15,[""]],"1f3ff":["1f469-1f3ff-200d-1f3a4",18,5,15,[""]]},"1f469-200d-1f3a8":{"1f3fb":["1f469-1f3fb-200d-1f3a8",18,7,15,[""]],"1f3fc":["1f469-1f3fc-200d-1f3a8",18,8,15,[""]],"1f3fd":["1f469-1f3fd-200d-1f3a8",18,9,15,[""]],"1f3fe":["1f469-1f3fe-200d-1f3a8",18,10,15,[""]],"1f3ff":["1f469-1f3ff-200d-1f3a8",18,11,15,[""]]},"1f469-200d-1f3eb":{"1f3fb":["1f469-1f3fb-200d-1f3eb",18,13,15,[""]],"1f3fc":["1f469-1f3fc-200d-1f3eb",18,14,15,[""]],"1f3fd":["1f469-1f3fd-200d-1f3eb",18,15,15,[""]],"1f3fe":["1f469-1f3fe-200d-1f3eb",18,16,15,[""]],"1f3ff":["1f469-1f3ff-200d-1f3eb",18,17,15,[""]]},"1f469-200d-1f3ed":{"1f3fb":["1f469-1f3fb-200d-1f3ed",18,19,15,[""]],"1f3fc":["1f469-1f3fc-200d-1f3ed",18,20,15,[""]],"1f3fd":["1f469-1f3fd-200d-1f3ed",18,21,15,[""]],"1f3fe":["1f469-1f3fe-200d-1f3ed",18,22,15,[""]],"1f3ff":["1f469-1f3ff-200d-1f3ed",18,23,15,[""]]},"1f469-200d-1f4bb":{"1f3fb":["1f469-1f3fb-200d-1f4bb",18,35,15,[""]],"1f3fc":["1f469-1f3fc-200d-1f4bb",18,36,15,[""]],"1f3fd":["1f469-1f3fd-200d-1f4bb",18,37,15,[""]],"1f3fe":["1f469-1f3fe-200d-1f4bb",18,38,15,[""]],"1f3ff":["1f469-1f3ff-200d-1f4bb",18,39,15,[""]]},"1f469-200d-1f4bc":{"1f3fb":["1f469-1f3fb-200d-1f4bc",18,41,15,[""]],"1f3fc":["1f469-1f3fc-200d-1f4bc",18,42,15,[""]],"1f3fd":["1f469-1f3fd-200d-1f4bc",18,43,15,[""]],"1f3fe":["1f469-1f3fe-200d-1f4bc",18,44,15,[""]],"1f3ff":["1f469-1f3ff-200d-1f4bc",18,45,15,[""]]},"1f469-200d-1f527":{"1f3fb":["1f469-1f3fb-200d-1f527",18,47,15,[""]],"1f3fc":["1f469-1f3fc-200d-1f527",18,48,15,[""]],"1f3fd":["1f469-1f3fd-200d-1f527",18,49,15,[""]],"1f3fe":["1f469-1f3fe-200d-1f527",18,50,15,[""]],"1f3ff":["1f469-1f3ff-200d-1f527",18,51,15,[""]]},"1f469-200d-1f52c":{"1f3fb":["1f469-1f3fb-200d-1f52c",18,53,15,[""]],"1f3fc":["1f469-1f3fc-200d-1f52c",18,54,15,[""]],"1f3fd":["1f469-1f3fd-200d-1f52c",18,55,15,[""]],"1f3fe":["1f469-1f3fe-200d-1f52c",18,56,15,[""]],"1f3ff":["1f469-1f3ff-200d-1f52c",18,57,15,[""]]},"1f469-200d-1f680":{"1f3fb":["1f469-1f3fb-200d-1f680",18,59,15,[""]],"1f3fc":["1f469-1f3fc-200d-1f680",19,0,15,[""]],"1f3fd":["1f469-1f3fd-200d-1f680",19,1,15,[""]],"1f3fe":["1f469-1f3fe-200d-1f680",19,2,15,[""]],"1f3ff":["1f469-1f3ff-200d-1f680",19,3,15,[""]]},"1f469-200d-1f692":{"1f3fb":["1f469-1f3fb-200d-1f692",19,5,15,[""]],"1f3fc":["1f469-1f3fc-200d-1f692",19,6,15,[""]],"1f3fd":["1f469-1f3fd-200d-1f692",19,7,15,[""]],"1f3fe":["1f469-1f3fe-200d-1f692",19,8,15,[""]],"1f3ff":["1f469-1f3ff-200d-1f692",19,9,15,[""]]},"1f469-200d-1f9af":{"1f3fb":["1f469-1f3fb-200d-1f9af",19,11,15,[""]],"1f3fc":["1f469-1f3fc-200d-1f9af",19,12,15,[""]],"1f3fd":["1f469-1f3fd-200d-1f9af",19,13,15,[""]],"1f3fe":["1f469-1f3fe-200d-1f9af",19,14,15,[""]],"1f3ff":["1f469-1f3ff-200d-1f9af",19,15,15,[""]]},"1f469-200d-1f9b0":{"1f3fb":["1f469-1f3fb-200d-1f9b0",19,17,15,[""]],"1f3fc":["1f469-1f3fc-200d-1f9b0",19,18,15,[""]],"1f3fd":["1f469-1f3fd-200d-1f9b0",19,19,15,[""]],"1f3fe":["1f469-1f3fe-200d-1f9b0",19,20,15,[""]],"1f3ff":["1f469-1f3ff-200d-1f9b0",19,21,15,[""]]},"1f469-200d-1f9b1":{"1f3fb":["1f469-1f3fb-200d-1f9b1",19,23,15,[""]],"1f3fc":["1f469-1f3fc-200d-1f9b1",19,24,15,[""]],"1f3fd":["1f469-1f3fd-200d-1f9b1",19,25,15,[""]],"1f3fe":["1f469-1f3fe-200d-1f9b1",19,26,15,[""]],"1f3ff":["1f469-1f3ff-200d-1f9b1",19,27,15,[""]]},"1f469-200d-1f9b2":{"1f3fb":["1f469-1f3fb-200d-1f9b2",19,29,15,[""]],"1f3fc":["1f469-1f3fc-200d-1f9b2",19,30,15,[""]],"1f3fd":["1f469-1f3fd-200d-1f9b2",19,31,15,[""]],"1f3fe":["1f469-1f3fe-200d-1f9b2",19,32,15,[""]],"1f3ff":["1f469-1f3ff-200d-1f9b2",19,33,15,[""]]},"1f469-200d-1f9b3":{"1f3fb":["1f469-1f3fb-200d-1f9b3",19,35,15,[""]],"1f3fc":["1f469-1f3fc-200d-1f9b3",19,36,15,[""]],"1f3fd":["1f469-1f3fd-200d-1f9b3",19,37,15,[""]],"1f3fe":["1f469-1f3fe-200d-1f9b3",19,38,15,[""]],"1f3ff":["1f469-1f3ff-200d-1f9b3",19,39,15,[""]]},"1f469-200d-1f9bc":{"1f3fb":["1f469-1f3fb-200d-1f9bc",19,41,15,[""]],"1f3fc":["1f469-1f3fc-200d-1f9bc",19,42,15,[""]],"1f3fd":["1f469-1f3fd-200d-1f9bc",19,43,15,[""]],"1f3fe":["1f469-1f3fe-200d-1f9bc",19,44,15,[""]],"1f3ff":["1f469-1f3ff-200d-1f9bc",19,45,15,[""]]},"1f469-200d-1f9bd":{"1f3fb":["1f469-1f3fb-200d-1f9bd",19,47,15,[""]],"1f3fc":["1f469-1f3fc-200d-1f9bd",19,48,15,[""]],"1f3fd":["1f469-1f3fd-200d-1f9bd",19,49,15,[""]],"1f3fe":["1f469-1f3fe-200d-1f9bd",19,50,15,[""]],"1f3ff":["1f469-1f3ff-200d-1f9bd",19,51,15,[""]]},"1f469-200d-2695-fe0f":{"1f3fb":["1f469-1f3fb-200d-2695-fe0f",19,53,15,[""]],"1f3fc":["1f469-1f3fc-200d-2695-fe0f",19,54,15,[""]],"1f3fd":["1f469-1f3fd-200d-2695-fe0f",19,55,15,[""]],"1f3fe":["1f469-1f3fe-200d-2695-fe0f",19,56,15,[""]],"1f3ff":["1f469-1f3ff-200d-2695-fe0f",19,57,15,[""]]},"1f469-200d-2696-fe0f":{"1f3fb":["1f469-1f3fb-200d-2696-fe0f",19,59,15,[""]],"1f3fc":["1f469-1f3fc-200d-2696-fe0f",20,0,15,[""]],"1f3fd":["1f469-1f3fd-200d-2696-fe0f",20,1,15,[""]],"1f3fe":["1f469-1f3fe-200d-2696-fe0f",20,2,15,[""]],"1f3ff":["1f469-1f3ff-200d-2696-fe0f",20,3,15,[""]]},"1f469-200d-2708-fe0f":{"1f3fb":["1f469-1f3fb-200d-2708-fe0f",20,5,15,[""]],"1f3fc":["1f469-1f3fc-200d-2708-fe0f",20,6,15,[""]],"1f3fd":["1f469-1f3fd-200d-2708-fe0f",20,7,15,[""]],"1f3fe":["1f469-1f3fe-200d-2708-fe0f",20,8,15,[""]],"1f3ff":["1f469-1f3ff-200d-2708-fe0f",20,9,15,[""]]},"1f469-200d-2764-fe0f-200d-1f468":{"1f3fb-1f3fb":["1f469-1f3fb-200d-2764-fe0f-200d-1f468-1f3fb",20,11,7,[""]],"1f3fb-1f3fc":["1f469-1f3fb-200d-2764-fe0f-200d-1f468-1f3fc",20,12,7,[""]],"1f3fb-1f3fd":["1f469-1f3fb-200d-2764-fe0f-200d-1f468-1f3fd",20,13,7,[""]],"1f3fb-1f3fe":["1f469-1f3fb-200d-2764-fe0f-200d-1f468-1f3fe",20,14,7,[""]],"1f3fb-1f3ff":["1f469-1f3fb-200d-2764-fe0f-200d-1f468-1f3ff",20,15,7,[""]],"1f3fc-1f3fb":["1f469-1f3fc-200d-2764-fe0f-200d-1f468-1f3fb",20,16,7,[""]],"1f3fc-1f3fc":["1f469-1f3fc-200d-2764-fe0f-200d-1f468-1f3fc",20,17,7,[""]],"1f3fc-1f3fd":["1f469-1f3fc-200d-2764-fe0f-200d-1f468-1f3fd",20,18,7,[""]],"1f3fc-1f3fe":["1f469-1f3fc-200d-2764-fe0f-200d-1f468-1f3fe",20,19,7,[""]],"1f3fc-1f3ff":["1f469-1f3fc-200d-2764-fe0f-200d-1f468-1f3ff",20,20,7,[""]],"1f3fd-1f3fb":["1f469-1f3fd-200d-2764-fe0f-200d-1f468-1f3fb",20,21,7,[""]],"1f3fd-1f3fc":["1f469-1f3fd-200d-2764-fe0f-200d-1f468-1f3fc",20,22,7,[""]],"1f3fd-1f3fd":["1f469-1f3fd-200d-2764-fe0f-200d-1f468-1f3fd",20,23,7,[""]],"1f3fd-1f3fe":["1f469-1f3fd-200d-2764-fe0f-200d-1f468-1f3fe",20,24,7,[""]],"1f3fd-1f3ff":["1f469-1f3fd-200d-2764-fe0f-200d-1f468-1f3ff",20,25,7,[""]],"1f3fe-1f3fb":["1f469-1f3fe-200d-2764-fe0f-200d-1f468-1f3fb",20,26,7,[""]],"1f3fe-1f3fc":["1f469-1f3fe-200d-2764-fe0f-200d-1f468-1f3fc",20,27,7,[""]],"1f3fe-1f3fd":["1f469-1f3fe-200d-2764-fe0f-200d-1f468-1f3fd",20,28,7,[""]],"1f3fe-1f3fe":["1f469-1f3fe-200d-2764-fe0f-200d-1f468-1f3fe",20,29,7,[""]],"1f3fe-1f3ff":["1f469-1f3fe-200d-2764-fe0f-200d-1f468-1f3ff",20,30,7,[""]],"1f3ff-1f3fb":["1f469-1f3ff-200d-2764-fe0f-200d-1f468-1f3fb",20,31,7,[""]],"1f3ff-1f3fc":["1f469-1f3ff-200d-2764-fe0f-200d-1f468-1f3fc",20,32,7,[""]],"1f3ff-1f3fd":["1f469-1f3ff-200d-2764-fe0f-200d-1f468-1f3fd",20,33,7,[""]],"1f3ff-1f3fe":["1f469-1f3ff-200d-2764-fe0f-200d-1f468-1f3fe",20,34,7,[""]],"1f3ff-1f3ff":["1f469-1f3ff-200d-2764-fe0f-200d-1f468-1f3ff",20,35,7,[""]]},"1f469-200d-2764-fe0f-200d-1f469":{"1f3fb-1f3fb":["1f469-1f3fb-200d-2764-fe0f-200d-1f469-1f3fb",20,37,7,[""]],"1f3fb-1f3fc":["1f469-1f3fb-200d-2764-fe0f-200d-1f469-1f3fc",20,38,7,[""]],"1f3fb-1f3fd":["1f469-1f3fb-200d-2764-fe0f-200d-1f469-1f3fd",20,39,7,[""]],"1f3fb-1f3fe":["1f469-1f3fb-200d-2764-fe0f-200d-1f469-1f3fe",20,40,7,[""]],"1f3fb-1f3ff":["1f469-1f3fb-200d-2764-fe0f-200d-1f469-1f3ff",20,41,7,[""]],"1f3fc-1f3fb":["1f469-1f3fc-200d-2764-fe0f-200d-1f469-1f3fb",20,42,7,[""]],"1f3fc-1f3fc":["1f469-1f3fc-200d-2764-fe0f-200d-1f469-1f3fc",20,43,7,[""]],"1f3fc-1f3fd":["1f469-1f3fc-200d-2764-fe0f-200d-1f469-1f3fd",20,44,7,[""]],"1f3fc-1f3fe":["1f469-1f3fc-200d-2764-fe0f-200d-1f469-1f3fe",20,45,7,[""]],"1f3fc-1f3ff":["1f469-1f3fc-200d-2764-fe0f-200d-1f469-1f3ff",20,46,7,[""]],"1f3fd-1f3fb":["1f469-1f3fd-200d-2764-fe0f-200d-1f469-1f3fb",20,47,7,[""]],"1f3fd-1f3fc":["1f469-1f3fd-200d-2764-fe0f-200d-1f469-1f3fc",20,48,7,[""]],"1f3fd-1f3fd":["1f469-1f3fd-200d-2764-fe0f-200d-1f469-1f3fd",20,49,7,[""]],"1f3fd-1f3fe":["1f469-1f3fd-200d-2764-fe0f-200d-1f469-1f3fe",20,50,7,[""]],"1f3fd-1f3ff":["1f469-1f3fd-200d-2764-fe0f-200d-1f469-1f3ff",20,51,7,[""]],"1f3fe-1f3fb":["1f469-1f3fe-200d-2764-fe0f-200d-1f469-1f3fb",20,52,7,[""]],"1f3fe-1f3fc":["1f469-1f3fe-200d-2764-fe0f-200d-1f469-1f3fc",20,53,7,[""]],"1f3fe-1f3fd":["1f469-1f3fe-200d-2764-fe0f-200d-1f469-1f3fd",20,54,7,[""]],"1f3fe-1f3fe":["1f469-1f3fe-200d-2764-fe0f-200d-1f469-1f3fe",20,55,7,[""]],"1f3fe-1f3ff":["1f469-1f3fe-200d-2764-fe0f-200d-1f469-1f3ff",20,56,7,[""]],"1f3ff-1f3fb":["1f469-1f3ff-200d-2764-fe0f-200d-1f469-1f3fb",20,57,7,[""]],"1f3ff-1f3fc":["1f469-1f3ff-200d-2764-fe0f-200d-1f469-1f3fc",20,58,7,[""]],"1f3ff-1f3fd":["1f469-1f3ff-200d-2764-fe0f-200d-1f469-1f3fd",20,59,7,[""]],"1f3ff-1f3fe":["1f469-1f3ff-200d-2764-fe0f-200d-1f469-1f3fe",21,0,7,[""]],"1f3ff-1f3ff":["1f469-1f3ff-200d-2764-fe0f-200d-1f469-1f3ff",21,1,7,[""]]},"1f469-200d-2764-fe0f-200d-1f48b-200d-1f468":{"1f3fb-1f3fb":["1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb",21,3,7,[""]],"1f3fb-1f3fc":["1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc",21,4,7,[""]],"1f3fb-1f3fd":["1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd",21,5,7,[""]],"1f3fb-1f3fe":["1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe",21,6,7,[""]],"1f3fb-1f3ff":["1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff",21,7,7,[""]],"1f3fc-1f3fb":["1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb",21,8,7,[""]],"1f3fc-1f3fc":["1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc",21,9,7,[""]],"1f3fc-1f3fd":["1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd",21,10,7,[""]],"1f3fc-1f3fe":["1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe",21,11,7,[""]],"1f3fc-1f3ff":["1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff",21,12,7,[""]],"1f3fd-1f3fb":["1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb",21,13,7,[""]],"1f3fd-1f3fc":["1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc",21,14,7,[""]],"1f3fd-1f3fd":["1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd",21,15,7,[""]],"1f3fd-1f3fe":["1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe",21,16,7,[""]],"1f3fd-1f3ff":["1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff",21,17,7,[""]],"1f3fe-1f3fb":["1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb",21,18,7,[""]],"1f3fe-1f3fc":["1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc",21,19,7,[""]],"1f3fe-1f3fd":["1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd",21,20,7,[""]],"1f3fe-1f3fe":["1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe",21,21,7,[""]],"1f3fe-1f3ff":["1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff",21,22,7,[""]],"1f3ff-1f3fb":["1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fb",21,23,7,[""]],"1f3ff-1f3fc":["1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fc",21,24,7,[""]],"1f3ff-1f3fd":["1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fd",21,25,7,[""]],"1f3ff-1f3fe":["1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3fe",21,26,7,[""]],"1f3ff-1f3ff":["1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f468-1f3ff",21,27,7,[""]]},"1f469-200d-2764-fe0f-200d-1f48b-200d-1f469":{"1f3fb-1f3fb":["1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fb",21,29,7,[""]],"1f3fb-1f3fc":["1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fc",21,30,7,[""]],"1f3fb-1f3fd":["1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fd",21,31,7,[""]],"1f3fb-1f3fe":["1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fe",21,32,7,[""]],"1f3fb-1f3ff":["1f469-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3ff",21,33,7,[""]],"1f3fc-1f3fb":["1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fb",21,34,7,[""]],"1f3fc-1f3fc":["1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fc",21,35,7,[""]],"1f3fc-1f3fd":["1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fd",21,36,7,[""]],"1f3fc-1f3fe":["1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fe",21,37,7,[""]],"1f3fc-1f3ff":["1f469-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3ff",21,38,7,[""]],"1f3fd-1f3fb":["1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fb",21,39,7,[""]],"1f3fd-1f3fc":["1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fc",21,40,7,[""]],"1f3fd-1f3fd":["1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fd",21,41,7,[""]],"1f3fd-1f3fe":["1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fe",21,42,7,[""]],"1f3fd-1f3ff":["1f469-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3ff",21,43,7,[""]],"1f3fe-1f3fb":["1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fb",21,44,7,[""]],"1f3fe-1f3fc":["1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fc",21,45,7,[""]],"1f3fe-1f3fd":["1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fd",21,46,7,[""]],"1f3fe-1f3fe":["1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fe",21,47,7,[""]],"1f3fe-1f3ff":["1f469-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3ff",21,48,7,[""]],"1f3ff-1f3fb":["1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fb",21,49,7,[""]],"1f3ff-1f3fc":["1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fc",21,50,7,[""]],"1f3ff-1f3fd":["1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fd",21,51,7,[""]],"1f3ff-1f3fe":["1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3fe",21,52,7,[""]],"1f3ff-1f3ff":["1f469-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f469-1f3ff",21,53,7,[""]]},"1f469":{"1f3fb":["1f469-1f3fb",21,55,15,[""]],"1f3fc":["1f469-1f3fc",21,56,15,[""]],"1f3fd":["1f469-1f3fd",21,57,15,[""]],"1f3fe":["1f469-1f3fe",21,58,15,[""]],"1f3ff":["1f469-1f3ff",21,59,15,[""]]},"1f46b":{"1f3fb":["1f46b-1f3fb",22,2,15,[""]],"1f3fc":["1f46b-1f3fc",22,3,15,[""]],"1f3fd":["1f46b-1f3fd",22,4,15,[""]],"1f3fe":["1f46b-1f3fe",22,5,15,[""]],"1f3ff":["1f46b-1f3ff",22,6,15,[""]],"1f3fb-1f3fc":["1f469-1f3fb-200d-1f91d-200d-1f468-1f3fc",22,7,15,[""]],"1f3fb-1f3fd":["1f469-1f3fb-200d-1f91d-200d-1f468-1f3fd",22,8,15,[""]],"1f3fb-1f3fe":["1f469-1f3fb-200d-1f91d-200d-1f468-1f3fe",22,9,15,[""]],"1f3fb-1f3ff":["1f469-1f3fb-200d-1f91d-200d-1f468-1f3ff",22,10,15,[""]],"1f3fc-1f3fb":["1f469-1f3fc-200d-1f91d-200d-1f468-1f3fb",22,11,15,[""]],"1f3fc-1f3fd":["1f469-1f3fc-200d-1f91d-200d-1f468-1f3fd",22,12,15,[""]],"1f3fc-1f3fe":["1f469-1f3fc-200d-1f91d-200d-1f468-1f3fe",22,13,15,[""]],"1f3fc-1f3ff":["1f469-1f3fc-200d-1f91d-200d-1f468-1f3ff",22,14,15,[""]],"1f3fd-1f3fb":["1f469-1f3fd-200d-1f91d-200d-1f468-1f3fb",22,15,15,[""]],"1f3fd-1f3fc":["1f469-1f3fd-200d-1f91d-200d-1f468-1f3fc",22,16,15,[""]],"1f3fd-1f3fe":["1f469-1f3fd-200d-1f91d-200d-1f468-1f3fe",22,17,15,[""]],"1f3fd-1f3ff":["1f469-1f3fd-200d-1f91d-200d-1f468-1f3ff",22,18,15,[""]],"1f3fe-1f3fb":["1f469-1f3fe-200d-1f91d-200d-1f468-1f3fb",22,19,15,[""]],"1f3fe-1f3fc":["1f469-1f3fe-200d-1f91d-200d-1f468-1f3fc",22,20,15,[""]],"1f3fe-1f3fd":["1f469-1f3fe-200d-1f91d-200d-1f468-1f3fd",22,21,15,[""]],"1f3fe-1f3ff":["1f469-1f3fe-200d-1f91d-200d-1f468-1f3ff",22,22,15,[""]],"1f3ff-1f3fb":["1f469-1f3ff-200d-1f91d-200d-1f468-1f3fb",22,23,15,[""]],"1f3ff-1f3fc":["1f469-1f3ff-200d-1f91d-200d-1f468-1f3fc",22,24,15,[""]],"1f3ff-1f3fd":["1f469-1f3ff-200d-1f91d-200d-1f468-1f3fd",22,25,15,[""]],"1f3ff-1f3fe":["1f469-1f3ff-200d-1f91d-200d-1f468-1f3fe",22,26,15,[""]]},"1f46c":{"1f3fb":["1f46c-1f3fb",22,28,15,[""]],"1f3fc":["1f46c-1f3fc",22,29,15,[""]],"1f3fd":["1f46c-1f3fd",22,30,15,[""]],"1f3fe":["1f46c-1f3fe",22,31,15,[""]],"1f3ff":["1f46c-1f3ff",22,32,15,[""]],"1f3fb-1f3fc":["1f468-1f3fb-200d-1f91d-200d-1f468-1f3fc",22,33,7,[""]],"1f3fb-1f3fd":["1f468-1f3fb-200d-1f91d-200d-1f468-1f3fd",22,34,7,[""]],"1f3fb-1f3fe":["1f468-1f3fb-200d-1f91d-200d-1f468-1f3fe",22,35,7,[""]],"1f3fb-1f3ff":["1f468-1f3fb-200d-1f91d-200d-1f468-1f3ff",22,36,7,[""]],"1f3fc-1f3fb":["1f468-1f3fc-200d-1f91d-200d-1f468-1f3fb",22,37,15,[""]],"1f3fc-1f3fd":["1f468-1f3fc-200d-1f91d-200d-1f468-1f3fd",22,38,7,[""]],"1f3fc-1f3fe":["1f468-1f3fc-200d-1f91d-200d-1f468-1f3fe",22,39,7,[""]],"1f3fc-1f3ff":["1f468-1f3fc-200d-1f91d-200d-1f468-1f3ff",22,40,7,[""]],"1f3fd-1f3fb":["1f468-1f3fd-200d-1f91d-200d-1f468-1f3fb",22,41,15,[""]],"1f3fd-1f3fc":["1f468-1f3fd-200d-1f91d-200d-1f468-1f3fc",22,42,15,[""]],"1f3fd-1f3fe":["1f468-1f3fd-200d-1f91d-200d-1f468-1f3fe",22,43,7,[""]],"1f3fd-1f3ff":["1f468-1f3fd-200d-1f91d-200d-1f468-1f3ff",22,44,7,[""]],"1f3fe-1f3fb":["1f468-1f3fe-200d-1f91d-200d-1f468-1f3fb",22,45,15,[""]],"1f3fe-1f3fc":["1f468-1f3fe-200d-1f91d-200d-1f468-1f3fc",22,46,15,[""]],"1f3fe-1f3fd":["1f468-1f3fe-200d-1f91d-200d-1f468-1f3fd",22,47,15,[""]],"1f3fe-1f3ff":["1f468-1f3fe-200d-1f91d-200d-1f468-1f3ff",22,48,7,[""]],"1f3ff-1f3fb":["1f468-1f3ff-200d-1f91d-200d-1f468-1f3fb",22,49,15,[""]],"1f3ff-1f3fc":["1f468-1f3ff-200d-1f91d-200d-1f468-1f3fc",22,50,15,[""]],"1f3ff-1f3fd":["1f468-1f3ff-200d-1f91d-200d-1f468-1f3fd",22,51,15,[""]],"1f3ff-1f3fe":["1f468-1f3ff-200d-1f91d-200d-1f468-1f3fe",22,52,15,[""]]},"1f46d":{"1f3fb":["1f46d-1f3fb",22,54,15,[""]],"1f3fc":["1f46d-1f3fc",22,55,15,[""]],"1f3fd":["1f46d-1f3fd",22,56,15,[""]],"1f3fe":["1f46d-1f3fe",22,57,15,[""]],"1f3ff":["1f46d-1f3ff",22,58,15,[""]],"1f3fb-1f3fc":["1f469-1f3fb-200d-1f91d-200d-1f469-1f3fc",22,59,7,[""]],"1f3fb-1f3fd":["1f469-1f3fb-200d-1f91d-200d-1f469-1f3fd",23,0,7,[""]],"1f3fb-1f3fe":["1f469-1f3fb-200d-1f91d-200d-1f469-1f3fe",23,1,7,[""]],"1f3fb-1f3ff":["1f469-1f3fb-200d-1f91d-200d-1f469-1f3ff",23,2,7,[""]],"1f3fc-1f3fb":["1f469-1f3fc-200d-1f91d-200d-1f469-1f3fb",23,3,15,[""]],"1f3fc-1f3fd":["1f469-1f3fc-200d-1f91d-200d-1f469-1f3fd",23,4,7,[""]],"1f3fc-1f3fe":["1f469-1f3fc-200d-1f91d-200d-1f469-1f3fe",23,5,7,[""]],"1f3fc-1f3ff":["1f469-1f3fc-200d-1f91d-200d-1f469-1f3ff",23,6,7,[""]],"1f3fd-1f3fb":["1f469-1f3fd-200d-1f91d-200d-1f469-1f3fb",23,7,15,[""]],"1f3fd-1f3fc":["1f469-1f3fd-200d-1f91d-200d-1f469-1f3fc",23,8,15,[""]],"1f3fd-1f3fe":["1f469-1f3fd-200d-1f91d-200d-1f469-1f3fe",23,9,7,[""]],"1f3fd-1f3ff":["1f469-1f3fd-200d-1f91d-200d-1f469-1f3ff",23,10,7,[""]],"1f3fe-1f3fb":["1f469-1f3fe-200d-1f91d-200d-1f469-1f3fb",23,11,15,[""]],"1f3fe-1f3fc":["1f469-1f3fe-200d-1f91d-200d-1f469-1f3fc",23,12,15,[""]],"1f3fe-1f3fd":["1f469-1f3fe-200d-1f91d-200d-1f469-1f3fd",23,13,15,[""]],"1f3fe-1f3ff":["1f469-1f3fe-200d-1f91d-200d-1f469-1f3ff",23,14,7,[""]],"1f3ff-1f3fb":["1f469-1f3ff-200d-1f91d-200d-1f469-1f3fb",23,15,15,[""]],"1f3ff-1f3fc":["1f469-1f3ff-200d-1f91d-200d-1f469-1f3fc",23,16,15,[""]],"1f3ff-1f3fd":["1f469-1f3ff-200d-1f91d-200d-1f469-1f3fd",23,17,15,[""]],"1f3ff-1f3fe":["1f469-1f3ff-200d-1f91d-200d-1f469-1f3fe",23,18,15,[""]]},"1f46e-200d-2640-fe0f":{"1f3fb":["1f46e-1f3fb-200d-2640-fe0f",23,20,15,[""]],"1f3fc":["1f46e-1f3fc-200d-2640-fe0f",23,21,15,[""]],"1f3fd":["1f46e-1f3fd-200d-2640-fe0f",23,22,15,[""]],"1f3fe":["1f46e-1f3fe-200d-2640-fe0f",23,23,15,[""]],"1f3ff":["1f46e-1f3ff-200d-2640-fe0f",23,24,15,[""]]},"1f46e-200d-2642-fe0f":{"1f3fb":["1f46e-1f3fb-200d-2642-fe0f",23,26,15,["",""]],"1f3fc":["1f46e-1f3fc-200d-2642-fe0f",23,27,15,["",""]],"1f3fd":["1f46e-1f3fd-200d-2642-fe0f",23,28,15,["",""]],"1f3fe":["1f46e-1f3fe-200d-2642-fe0f",23,29,15,["",""]],"1f3ff":["1f46e-1f3ff-200d-2642-fe0f",23,30,15,["",""]]},"1f470-200d-2640-fe0f":{"1f3fb":["1f470-1f3fb-200d-2640-fe0f",23,41,15,[""]],"1f3fc":["1f470-1f3fc-200d-2640-fe0f",23,42,15,[""]],"1f3fd":["1f470-1f3fd-200d-2640-fe0f",23,43,15,[""]],"1f3fe":["1f470-1f3fe-200d-2640-fe0f",23,44,15,[""]],"1f3ff":["1f470-1f3ff-200d-2640-fe0f",23,45,15,[""]]},"1f470-200d-2642-fe0f":{"1f3fb":["1f470-1f3fb-200d-2642-fe0f",23,47,15,[""]],"1f3fc":["1f470-1f3fc-200d-2642-fe0f",23,48,15,[""]],"1f3fd":["1f470-1f3fd-200d-2642-fe0f",23,49,15,[""]],"1f3fe":["1f470-1f3fe-200d-2642-fe0f",23,50,15,[""]],"1f3ff":["1f470-1f3ff-200d-2642-fe0f",23,51,15,[""]]},"1f470":{"1f3fb":["1f470-1f3fb",23,53,15,[""]],"1f3fc":["1f470-1f3fc",23,54,15,[""]],"1f3fd":["1f470-1f3fd",23,55,15,[""]],"1f3fe":["1f470-1f3fe",23,56,15,[""]],"1f3ff":["1f470-1f3ff",23,57,15,[""]]},"1f471-200d-2640-fe0f":{"1f3fb":["1f471-1f3fb-200d-2640-fe0f",23,59,15,[""]],"1f3fc":["1f471-1f3fc-200d-2640-fe0f",24,0,15,[""]],"1f3fd":["1f471-1f3fd-200d-2640-fe0f",24,1,15,[""]],"1f3fe":["1f471-1f3fe-200d-2640-fe0f",24,2,15,[""]],"1f3ff":["1f471-1f3ff-200d-2640-fe0f",24,3,15,[""]]},"1f471-200d-2642-fe0f":{"1f3fb":["1f471-1f3fb-200d-2642-fe0f",24,5,15,["",""]],"1f3fc":["1f471-1f3fc-200d-2642-fe0f",24,6,15,["",""]],"1f3fd":["1f471-1f3fd-200d-2642-fe0f",24,7,15,["",""]],"1f3fe":["1f471-1f3fe-200d-2642-fe0f",24,8,15,["",""]],"1f3ff":["1f471-1f3ff-200d-2642-fe0f",24,9,15,["",""]]},"1f472":{"1f3fb":["1f472-1f3fb",24,17,15,[""]],"1f3fc":["1f472-1f3fc",24,18,15,[""]],"1f3fd":["1f472-1f3fd",24,19,15,[""]],"1f3fe":["1f472-1f3fe",24,20,15,[""]],"1f3ff":["1f472-1f3ff",24,21,15,[""]]},"1f473-200d-2640-fe0f":{"1f3fb":["1f473-1f3fb-200d-2640-fe0f",24,23,15,[""]],"1f3fc":["1f473-1f3fc-200d-2640-fe0f",24,24,15,[""]],"1f3fd":["1f473-1f3fd-200d-2640-fe0f",24,25,15,[""]],"1f3fe":["1f473-1f3fe-200d-2640-fe0f",24,26,15,[""]],"1f3ff":["1f473-1f3ff-200d-2640-fe0f",24,27,15,[""]]},"1f473-200d-2642-fe0f":{"1f3fb":["1f473-1f3fb-200d-2642-fe0f",24,29,15,["",""]],"1f3fc":["1f473-1f3fc-200d-2642-fe0f",24,30,15,["",""]],"1f3fd":["1f473-1f3fd-200d-2642-fe0f",24,31,15,["",""]],"1f3fe":["1f473-1f3fe-200d-2642-fe0f",24,32,15,["",""]],"1f3ff":["1f473-1f3ff-200d-2642-fe0f",24,33,15,["",""]]},"1f474":{"1f3fb":["1f474-1f3fb",24,41,15,[""]],"1f3fc":["1f474-1f3fc",24,42,15,[""]],"1f3fd":["1f474-1f3fd",24,43,15,[""]],"1f3fe":["1f474-1f3fe",24,44,15,[""]],"1f3ff":["1f474-1f3ff",24,45,15,[""]]},"1f475":{"1f3fb":["1f475-1f3fb",24,47,15,[""]],"1f3fc":["1f475-1f3fc",24,48,15,[""]],"1f3fd":["1f475-1f3fd",24,49,15,[""]],"1f3fe":["1f475-1f3fe",24,50,15,[""]],"1f3ff":["1f475-1f3ff",24,51,15,[""]]},"1f476":{"1f3fb":["1f476-1f3fb",24,53,15,[""]],"1f3fc":["1f476-1f3fc",24,54,15,[""]],"1f3fd":["1f476-1f3fd",24,55,15,[""]],"1f3fe":["1f476-1f3fe",24,56,15,[""]],"1f3ff":["1f476-1f3ff",24,57,15,[""]]},"1f477-200d-2640-fe0f":{"1f3fb":["1f477-1f3fb-200d-2640-fe0f",24,59,15,[""]],"1f3fc":["1f477-1f3fc-200d-2640-fe0f",25,0,15,[""]],"1f3fd":["1f477-1f3fd-200d-2640-fe0f",25,1,15,[""]],"1f3fe":["1f477-1f3fe-200d-2640-fe0f",25,2,15,[""]],"1f3ff":["1f477-1f3ff-200d-2640-fe0f",25,3,15,[""]]},"1f477-200d-2642-fe0f":{"1f3fb":["1f477-1f3fb-200d-2642-fe0f",25,5,15,["",""]],"1f3fc":["1f477-1f3fc-200d-2642-fe0f",25,6,15,["",""]],"1f3fd":["1f477-1f3fd-200d-2642-fe0f",25,7,15,["",""]],"1f3fe":["1f477-1f3fe-200d-2642-fe0f",25,8,15,["",""]],"1f3ff":["1f477-1f3ff-200d-2642-fe0f",25,9,15,["",""]]},"1f478":{"1f3fb":["1f478-1f3fb",25,17,15,[""]],"1f3fc":["1f478-1f3fc",25,18,15,[""]],"1f3fd":["1f478-1f3fd",25,19,15,[""]],"1f3fe":["1f478-1f3fe",25,20,15,[""]],"1f3ff":["1f478-1f3ff",25,21,15,[""]]},"1f47c":{"1f3fb":["1f47c-1f3fb",25,26,15,[""]],"1f3fc":["1f47c-1f3fc",25,27,15,[""]],"1f3fd":["1f47c-1f3fd",25,28,15,[""]],"1f3fe":["1f47c-1f3fe",25,29,15,[""]],"1f3ff":["1f47c-1f3ff",25,30,15,[""]]},"1f481-200d-2640-fe0f":{"1f3fb":["1f481-1f3fb-200d-2640-fe0f",25,36,15,["",""]],"1f3fc":["1f481-1f3fc-200d-2640-fe0f",25,37,15,["",""]],"1f3fd":["1f481-1f3fd-200d-2640-fe0f",25,38,15,["",""]],"1f3fe":["1f481-1f3fe-200d-2640-fe0f",25,39,15,["",""]],"1f3ff":["1f481-1f3ff-200d-2640-fe0f",25,40,15,["",""]]},"1f481-200d-2642-fe0f":{"1f3fb":["1f481-1f3fb-200d-2642-fe0f",25,42,15,[""]],"1f3fc":["1f481-1f3fc-200d-2642-fe0f",25,43,15,[""]],"1f3fd":["1f481-1f3fd-200d-2642-fe0f",25,44,15,[""]],"1f3fe":["1f481-1f3fe-200d-2642-fe0f",25,45,15,[""]],"1f3ff":["1f481-1f3ff-200d-2642-fe0f",25,46,15,[""]]},"1f482-200d-2640-fe0f":{"1f3fb":["1f482-1f3fb-200d-2640-fe0f",25,54,15,[""]],"1f3fc":["1f482-1f3fc-200d-2640-fe0f",25,55,15,[""]],"1f3fd":["1f482-1f3fd-200d-2640-fe0f",25,56,15,[""]],"1f3fe":["1f482-1f3fe-200d-2640-fe0f",25,57,15,[""]],"1f3ff":["1f482-1f3ff-200d-2640-fe0f",25,58,15,[""]]},"1f482-200d-2642-fe0f":{"1f3fb":["1f482-1f3fb-200d-2642-fe0f",26,0,15,["",""]],"1f3fc":["1f482-1f3fc-200d-2642-fe0f",26,1,15,["",""]],"1f3fd":["1f482-1f3fd-200d-2642-fe0f",26,2,15,["",""]],"1f3fe":["1f482-1f3fe-200d-2642-fe0f",26,3,15,["",""]],"1f3ff":["1f482-1f3ff-200d-2642-fe0f",26,4,15,["",""]]},"1f483":{"1f3fb":["1f483-1f3fb",26,12,15,[""]],"1f3fc":["1f483-1f3fc",26,13,15,[""]],"1f3fd":["1f483-1f3fd",26,14,15,[""]],"1f3fe":["1f483-1f3fe",26,15,15,[""]],"1f3ff":["1f483-1f3ff",26,16,15,[""]]},"1f485":{"1f3fb":["1f485-1f3fb",26,19,15,[""]],"1f3fc":["1f485-1f3fc",26,20,15,[""]],"1f3fd":["1f485-1f3fd",26,21,15,[""]],"1f3fe":["1f485-1f3fe",26,22,15,[""]],"1f3ff":["1f485-1f3ff",26,23,15,[""]]},"1f486-200d-2640-fe0f":{"1f3fb":["1f486-1f3fb-200d-2640-fe0f",26,25,15,["",""]],"1f3fc":["1f486-1f3fc-200d-2640-fe0f",26,26,15,["",""]],"1f3fd":["1f486-1f3fd-200d-2640-fe0f",26,27,15,["",""]],"1f3fe":["1f486-1f3fe-200d-2640-fe0f",26,28,15,["",""]],"1f3ff":["1f486-1f3ff-200d-2640-fe0f",26,29,15,["",""]]},"1f486-200d-2642-fe0f":{"1f3fb":["1f486-1f3fb-200d-2642-fe0f",26,31,15,[""]],"1f3fc":["1f486-1f3fc-200d-2642-fe0f",26,32,15,[""]],"1f3fd":["1f486-1f3fd-200d-2642-fe0f",26,33,15,[""]],"1f3fe":["1f486-1f3fe-200d-2642-fe0f",26,34,15,[""]],"1f3ff":["1f486-1f3ff-200d-2642-fe0f",26,35,15,[""]]},"1f487-200d-2640-fe0f":{"1f3fb":["1f487-1f3fb-200d-2640-fe0f",26,43,15,["",""]],"1f3fc":["1f487-1f3fc-200d-2640-fe0f",26,44,15,["",""]],"1f3fd":["1f487-1f3fd-200d-2640-fe0f",26,45,15,["",""]],"1f3fe":["1f487-1f3fe-200d-2640-fe0f",26,46,15,["",""]],"1f3ff":["1f487-1f3ff-200d-2640-fe0f",26,47,15,["",""]]},"1f487-200d-2642-fe0f":{"1f3fb":["1f487-1f3fb-200d-2642-fe0f",26,49,15,[""]],"1f3fc":["1f487-1f3fc-200d-2642-fe0f",26,50,15,[""]],"1f3fd":["1f487-1f3fd-200d-2642-fe0f",26,51,15,[""]],"1f3fe":["1f487-1f3fe-200d-2642-fe0f",26,52,15,[""]],"1f3ff":["1f487-1f3ff-200d-2642-fe0f",26,53,15,[""]]},"1f48f":{"1f3fb":["1f48f-1f3fb",27,8,15,[""]],"1f3fc":["1f48f-1f3fc",27,9,15,[""]],"1f3fd":["1f48f-1f3fd",27,10,15,[""]],"1f3fe":["1f48f-1f3fe",27,11,15,[""]],"1f3ff":["1f48f-1f3ff",27,12,15,[""]],"1f3fb-1f3fc":["1f9d1-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fc",27,13,7,[""]],"1f3fb-1f3fd":["1f9d1-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fd",27,14,7,[""]],"1f3fb-1f3fe":["1f9d1-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fe",27,15,7,[""]],"1f3fb-1f3ff":["1f9d1-1f3fb-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3ff",27,16,7,[""]],"1f3fc-1f3fb":["1f9d1-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fb",27,17,7,[""]],"1f3fc-1f3fd":["1f9d1-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fd",27,18,7,[""]],"1f3fc-1f3fe":["1f9d1-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fe",27,19,7,[""]],"1f3fc-1f3ff":["1f9d1-1f3fc-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3ff",27,20,7,[""]],"1f3fd-1f3fb":["1f9d1-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fb",27,21,7,[""]],"1f3fd-1f3fc":["1f9d1-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fc",27,22,7,[""]],"1f3fd-1f3fe":["1f9d1-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fe",27,23,7,[""]],"1f3fd-1f3ff":["1f9d1-1f3fd-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3ff",27,24,7,[""]],"1f3fe-1f3fb":["1f9d1-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fb",27,25,7,[""]],"1f3fe-1f3fc":["1f9d1-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fc",27,26,7,[""]],"1f3fe-1f3fd":["1f9d1-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fd",27,27,7,[""]],"1f3fe-1f3ff":["1f9d1-1f3fe-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3ff",27,28,7,[""]],"1f3ff-1f3fb":["1f9d1-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fb",27,29,7,[""]],"1f3ff-1f3fc":["1f9d1-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fc",27,30,7,[""]],"1f3ff-1f3fd":["1f9d1-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fd",27,31,7,[""]],"1f3ff-1f3fe":["1f9d1-1f3ff-200d-2764-fe0f-200d-1f48b-200d-1f9d1-1f3fe",27,32,7,[""]]},"1f491":{"1f3fb":["1f491-1f3fb",27,35,15,[""]],"1f3fc":["1f491-1f3fc",27,36,15,[""]],"1f3fd":["1f491-1f3fd",27,37,15,[""]],"1f3fe":["1f491-1f3fe",27,38,15,[""]],"1f3ff":["1f491-1f3ff",27,39,15,[""]],"1f3fb-1f3fc":["1f9d1-1f3fb-200d-2764-fe0f-200d-1f9d1-1f3fc",27,40,7,[""]],"1f3fb-1f3fd":["1f9d1-1f3fb-200d-2764-fe0f-200d-1f9d1-1f3fd",27,41,7,[""]],"1f3fb-1f3fe":["1f9d1-1f3fb-200d-2764-fe0f-200d-1f9d1-1f3fe",27,42,7,[""]],"1f3fb-1f3ff":["1f9d1-1f3fb-200d-2764-fe0f-200d-1f9d1-1f3ff",27,43,7,[""]],"1f3fc-1f3fb":["1f9d1-1f3fc-200d-2764-fe0f-200d-1f9d1-1f3fb",27,44,7,[""]],"1f3fc-1f3fd":["1f9d1-1f3fc-200d-2764-fe0f-200d-1f9d1-1f3fd",27,45,7,[""]],"1f3fc-1f3fe":["1f9d1-1f3fc-200d-2764-fe0f-200d-1f9d1-1f3fe",27,46,7,[""]],"1f3fc-1f3ff":["1f9d1-1f3fc-200d-2764-fe0f-200d-1f9d1-1f3ff",27,47,7,[""]],"1f3fd-1f3fb":["1f9d1-1f3fd-200d-2764-fe0f-200d-1f9d1-1f3fb",27,48,7,[""]],"1f3fd-1f3fc":["1f9d1-1f3fd-200d-2764-fe0f-200d-1f9d1-1f3fc",27,49,7,[""]],"1f3fd-1f3fe":["1f9d1-1f3fd-200d-2764-fe0f-200d-1f9d1-1f3fe",27,50,7,[""]],"1f3fd-1f3ff":["1f9d1-1f3fd-200d-2764-fe0f-200d-1f9d1-1f3ff",27,51,7,[""]],"1f3fe-1f3fb":["1f9d1-1f3fe-200d-2764-fe0f-200d-1f9d1-1f3fb",27,52,7,[""]],"1f3fe-1f3fc":["1f9d1-1f3fe-200d-2764-fe0f-200d-1f9d1-1f3fc",27,53,7,[""]],"1f3fe-1f3fd":["1f9d1-1f3fe-200d-2764-fe0f-200d-1f9d1-1f3fd",27,54,7,[""]],"1f3fe-1f3ff":["1f9d1-1f3fe-200d-2764-fe0f-200d-1f9d1-1f3ff",27,55,7,[""]],"1f3ff-1f3fb":["1f9d1-1f3ff-200d-2764-fe0f-200d-1f9d1-1f3fb",27,56,7,[""]],"1f3ff-1f3fc":["1f9d1-1f3ff-200d-2764-fe0f-200d-1f9d1-1f3fc",27,57,7,[""]],"1f3ff-1f3fd":["1f9d1-1f3ff-200d-2764-fe0f-200d-1f9d1-1f3fd",27,58,7,[""]],"1f3ff-1f3fe":["1f9d1-1f3ff-200d-2764-fe0f-200d-1f9d1-1f3fe",27,59,7,[""]]},"1f4aa":{"1f3fb":["1f4aa-1f3fb",28,25,15,[""]],"1f3fc":["1f4aa-1f3fc",28,26,15,[""]],"1f3fd":["1f4aa-1f3fd",28,27,15,[""]],"1f3fe":["1f4aa-1f3fe",28,28,15,[""]],"1f3ff":["1f4aa-1f3ff",28,29,15,[""]]},"1f574-fe0f":{"1f3fb":["1f574-1f3fb",31,30,15,[""]],"1f3fc":["1f574-1f3fc",31,31,15,[""]],"1f3fd":["1f574-1f3fd",31,32,15,[""]],"1f3fe":["1f574-1f3fe",31,33,15,[""]],"1f3ff":["1f574-1f3ff",31,34,15,[""]]},"1f575-fe0f-200d-2640-fe0f":{"1f3fb":["1f575-1f3fb-200d-2640-fe0f",31,36,15,[""]],"1f3fc":["1f575-1f3fc-200d-2640-fe0f",31,37,15,[""]],"1f3fd":["1f575-1f3fd-200d-2640-fe0f",31,38,15,[""]],"1f3fe":["1f575-1f3fe-200d-2640-fe0f",31,39,15,[""]],"1f3ff":["1f575-1f3ff-200d-2640-fe0f",31,40,15,[""]]},"1f575-fe0f-200d-2642-fe0f":{"1f3fb":["1f575-1f3fb-200d-2642-fe0f",31,42,15,["",""]],"1f3fc":["1f575-1f3fc-200d-2642-fe0f",31,43,15,["",""]],"1f3fd":["1f575-1f3fd-200d-2642-fe0f",31,44,15,["",""]],"1f3fe":["1f575-1f3fe-200d-2642-fe0f",31,45,15,["",""]],"1f3ff":["1f575-1f3ff-200d-2642-fe0f",31,46,15,["",""]]},"1f57a":{"1f3fb":["1f57a-1f3fb",31,58,15,[""]],"1f3fc":["1f57a-1f3fc",31,59,15,[""]],"1f3fd":["1f57a-1f3fd",32,0,15,[""]],"1f3fe":["1f57a-1f3fe",32,1,15,[""]],"1f3ff":["1f57a-1f3ff",32,2,15,[""]]},"1f590-fe0f":{"1f3fb":["1f590-1f3fb",32,9,15,[""]],"1f3fc":["1f590-1f3fc",32,10,15,[""]],"1f3fd":["1f590-1f3fd",32,11,15,[""]],"1f3fe":["1f590-1f3fe",32,12,15,[""]],"1f3ff":["1f590-1f3ff",32,13,15,[""]]},"1f595":{"1f3fb":["1f595-1f3fb",32,15,15,[""]],"1f3fc":["1f595-1f3fc",32,16,15,[""]],"1f3fd":["1f595-1f3fd",32,17,15,[""]],"1f3fe":["1f595-1f3fe",32,18,15,[""]],"1f3ff":["1f595-1f3ff",32,19,15,[""]]},"1f596":{"1f3fb":["1f596-1f3fb",32,21,15,[""]],"1f3fc":["1f596-1f3fc",32,22,15,[""]],"1f3fd":["1f596-1f3fd",32,23,15,[""]],"1f3fe":["1f596-1f3fe",32,24,15,[""]],"1f3ff":["1f596-1f3ff",32,25,15,[""]]},"1f645-200d-2640-fe0f":{"1f3fb":["1f645-1f3fb-200d-2640-fe0f",34,5,15,["",""]],"1f3fc":["1f645-1f3fc-200d-2640-fe0f",34,6,15,["",""]],"1f3fd":["1f645-1f3fd-200d-2640-fe0f",34,7,15,["",""]],"1f3fe":["1f645-1f3fe-200d-2640-fe0f",34,8,15,["",""]],"1f3ff":["1f645-1f3ff-200d-2640-fe0f",34,9,15,["",""]]},"1f645-200d-2642-fe0f":{"1f3fb":["1f645-1f3fb-200d-2642-fe0f",34,11,15,[""]],"1f3fc":["1f645-1f3fc-200d-2642-fe0f",34,12,15,[""]],"1f3fd":["1f645-1f3fd-200d-2642-fe0f",34,13,15,[""]],"1f3fe":["1f645-1f3fe-200d-2642-fe0f",34,14,15,[""]],"1f3ff":["1f645-1f3ff-200d-2642-fe0f",34,15,15,[""]]},"1f646-200d-2640-fe0f":{"1f3fb":["1f646-1f3fb-200d-2640-fe0f",34,23,15,["",""]],"1f3fc":["1f646-1f3fc-200d-2640-fe0f",34,24,15,["",""]],"1f3fd":["1f646-1f3fd-200d-2640-fe0f",34,25,15,["",""]],"1f3fe":["1f646-1f3fe-200d-2640-fe0f",34,26,15,["",""]],"1f3ff":["1f646-1f3ff-200d-2640-fe0f",34,27,15,["",""]]},"1f646-200d-2642-fe0f":{"1f3fb":["1f646-1f3fb-200d-2642-fe0f",34,29,15,[""]],"1f3fc":["1f646-1f3fc-200d-2642-fe0f",34,30,15,[""]],"1f3fd":["1f646-1f3fd-200d-2642-fe0f",34,31,15,[""]],"1f3fe":["1f646-1f3fe-200d-2642-fe0f",34,32,15,[""]],"1f3ff":["1f646-1f3ff-200d-2642-fe0f",34,33,15,[""]]},"1f647-200d-2640-fe0f":{"1f3fb":["1f647-1f3fb-200d-2640-fe0f",34,41,15,[""]],"1f3fc":["1f647-1f3fc-200d-2640-fe0f",34,42,15,[""]],"1f3fd":["1f647-1f3fd-200d-2640-fe0f",34,43,15,[""]],"1f3fe":["1f647-1f3fe-200d-2640-fe0f",34,44,15,[""]],"1f3ff":["1f647-1f3ff-200d-2640-fe0f",34,45,15,[""]]},"1f647-200d-2642-fe0f":{"1f3fb":["1f647-1f3fb-200d-2642-fe0f",34,47,15,["",""]],"1f3fc":["1f647-1f3fc-200d-2642-fe0f",34,48,15,["",""]],"1f3fd":["1f647-1f3fd-200d-2642-fe0f",34,49,15,["",""]],"1f3fe":["1f647-1f3fe-200d-2642-fe0f",34,50,15,["",""]],"1f3ff":["1f647-1f3ff-200d-2642-fe0f",34,51,15,["",""]]},"1f64b-200d-2640-fe0f":{"1f3fb":["1f64b-1f3fb-200d-2640-fe0f",35,2,15,["",""]],"1f3fc":["1f64b-1f3fc-200d-2640-fe0f",35,3,15,["",""]],"1f3fd":["1f64b-1f3fd-200d-2640-fe0f",35,4,15,["",""]],"1f3fe":["1f64b-1f3fe-200d-2640-fe0f",35,5,15,["",""]],"1f3ff":["1f64b-1f3ff-200d-2640-fe0f",35,6,15,["",""]]},"1f64b-200d-2642-fe0f":{"1f3fb":["1f64b-1f3fb-200d-2642-fe0f",35,8,15,[""]],"1f3fc":["1f64b-1f3fc-200d-2642-fe0f",35,9,15,[""]],"1f3fd":["1f64b-1f3fd-200d-2642-fe0f",35,10,15,[""]],"1f3fe":["1f64b-1f3fe-200d-2642-fe0f",35,11,15,[""]],"1f3ff":["1f64b-1f3ff-200d-2642-fe0f",35,12,15,[""]]},"1f64c":{"1f3fb":["1f64c-1f3fb",35,20,15,[""]],"1f3fc":["1f64c-1f3fc",35,21,15,[""]],"1f3fd":["1f64c-1f3fd",35,22,15,[""]],"1f3fe":["1f64c-1f3fe",35,23,15,[""]],"1f3ff":["1f64c-1f3ff",35,24,15,[""]]},"1f64d-200d-2640-fe0f":{"1f3fb":["1f64d-1f3fb-200d-2640-fe0f",35,26,15,["",""]],"1f3fc":["1f64d-1f3fc-200d-2640-fe0f",35,27,15,["",""]],"1f3fd":["1f64d-1f3fd-200d-2640-fe0f",35,28,15,["",""]],"1f3fe":["1f64d-1f3fe-200d-2640-fe0f",35,29,15,["",""]],"1f3ff":["1f64d-1f3ff-200d-2640-fe0f",35,30,15,["",""]]},"1f64d-200d-2642-fe0f":{"1f3fb":["1f64d-1f3fb-200d-2642-fe0f",35,32,15,[""]],"1f3fc":["1f64d-1f3fc-200d-2642-fe0f",35,33,15,[""]],"1f3fd":["1f64d-1f3fd-200d-2642-fe0f",35,34,15,[""]],"1f3fe":["1f64d-1f3fe-200d-2642-fe0f",35,35,15,[""]],"1f3ff":["1f64d-1f3ff-200d-2642-fe0f",35,36,15,[""]]},"1f64e-200d-2640-fe0f":{"1f3fb":["1f64e-1f3fb-200d-2640-fe0f",35,44,15,["",""]],"1f3fc":["1f64e-1f3fc-200d-2640-fe0f",35,45,15,["",""]],"1f3fd":["1f64e-1f3fd-200d-2640-fe0f",35,46,15,["",""]],"1f3fe":["1f64e-1f3fe-200d-2640-fe0f",35,47,15,["",""]],"1f3ff":["1f64e-1f3ff-200d-2640-fe0f",35,48,15,["",""]]},"1f64e-200d-2642-fe0f":{"1f3fb":["1f64e-1f3fb-200d-2642-fe0f",35,50,15,[""]],"1f3fc":["1f64e-1f3fc-200d-2642-fe0f",35,51,15,[""]],"1f3fd":["1f64e-1f3fd-200d-2642-fe0f",35,52,15,[""]],"1f3fe":["1f64e-1f3fe-200d-2642-fe0f",35,53,15,[""]],"1f3ff":["1f64e-1f3ff-200d-2642-fe0f",35,54,15,[""]]},"1f64f":{"1f3fb":["1f64f-1f3fb",36,2,15,[""]],"1f3fc":["1f64f-1f3fc",36,3,15,[""]],"1f3fd":["1f64f-1f3fd",36,4,15,[""]],"1f3fe":["1f64f-1f3fe",36,5,15,[""]],"1f3ff":["1f64f-1f3ff",36,6,15,[""]]},"1f6a3-200d-2640-fe0f":{"1f3fb":["1f6a3-1f3fb-200d-2640-fe0f",36,43,15,[""]],"1f3fc":["1f6a3-1f3fc-200d-2640-fe0f",36,44,15,[""]],"1f3fd":["1f6a3-1f3fd-200d-2640-fe0f",36,45,15,[""]],"1f3fe":["1f6a3-1f3fe-200d-2640-fe0f",36,46,15,[""]],"1f3ff":["1f6a3-1f3ff-200d-2640-fe0f",36,47,15,[""]]},"1f6a3-200d-2642-fe0f":{"1f3fb":["1f6a3-1f3fb-200d-2642-fe0f",36,49,15,["",""]],"1f3fc":["1f6a3-1f3fc-200d-2642-fe0f",36,50,15,["",""]],"1f3fd":["1f6a3-1f3fd-200d-2642-fe0f",36,51,15,["",""]],"1f3fe":["1f6a3-1f3fe-200d-2642-fe0f",36,52,15,["",""]],"1f3ff":["1f6a3-1f3ff-200d-2642-fe0f",36,53,15,["",""]]},"1f6b4-200d-2640-fe0f":{"1f3fb":["1f6b4-1f3fb-200d-2640-fe0f",37,17,15,[""]],"1f3fc":["1f6b4-1f3fc-200d-2640-fe0f",37,18,15,[""]],"1f3fd":["1f6b4-1f3fd-200d-2640-fe0f",37,19,15,[""]],"1f3fe":["1f6b4-1f3fe-200d-2640-fe0f",37,20,15,[""]],"1f3ff":["1f6b4-1f3ff-200d-2640-fe0f",37,21,15,[""]]},"1f6b4-200d-2642-fe0f":{"1f3fb":["1f6b4-1f3fb-200d-2642-fe0f",37,23,15,["",""]],"1f3fc":["1f6b4-1f3fc-200d-2642-fe0f",37,24,15,["",""]],"1f3fd":["1f6b4-1f3fd-200d-2642-fe0f",37,25,15,["",""]],"1f3fe":["1f6b4-1f3fe-200d-2642-fe0f",37,26,15,["",""]],"1f3ff":["1f6b4-1f3ff-200d-2642-fe0f",37,27,15,["",""]]},"1f6b5-200d-2640-fe0f":{"1f3fb":["1f6b5-1f3fb-200d-2640-fe0f",37,35,15,[""]],"1f3fc":["1f6b5-1f3fc-200d-2640-fe0f",37,36,15,[""]],"1f3fd":["1f6b5-1f3fd-200d-2640-fe0f",37,37,15,[""]],"1f3fe":["1f6b5-1f3fe-200d-2640-fe0f",37,38,15,[""]],"1f3ff":["1f6b5-1f3ff-200d-2640-fe0f",37,39,15,[""]]},"1f6b5-200d-2642-fe0f":{"1f3fb":["1f6b5-1f3fb-200d-2642-fe0f",37,41,15,["",""]],"1f3fc":["1f6b5-1f3fc-200d-2642-fe0f",37,42,15,["",""]],"1f3fd":["1f6b5-1f3fd-200d-2642-fe0f",37,43,15,["",""]],"1f3fe":["1f6b5-1f3fe-200d-2642-fe0f",37,44,15,["",""]],"1f3ff":["1f6b5-1f3ff-200d-2642-fe0f",37,45,15,["",""]]},"1f6b6-200d-2640-fe0f":{"1f3fb":["1f6b6-1f3fb-200d-2640-fe0f",37,53,15,[""]],"1f3fc":["1f6b6-1f3fc-200d-2640-fe0f",37,54,15,[""]],"1f3fd":["1f6b6-1f3fd-200d-2640-fe0f",37,55,15,[""]],"1f3fe":["1f6b6-1f3fe-200d-2640-fe0f",37,56,15,[""]],"1f3ff":["1f6b6-1f3ff-200d-2640-fe0f",37,57,15,[""]]},"1f6b6-200d-2642-fe0f":{"1f3fb":["1f6b6-1f3fb-200d-2642-fe0f",37,59,15,["",""]],"1f3fc":["1f6b6-1f3fc-200d-2642-fe0f",38,0,15,["",""]],"1f3fd":["1f6b6-1f3fd-200d-2642-fe0f",38,1,15,["",""]],"1f3fe":["1f6b6-1f3fe-200d-2642-fe0f",38,2,15,["",""]],"1f3ff":["1f6b6-1f3ff-200d-2642-fe0f",38,3,15,["",""]]},"1f6c0":{"1f3fb":["1f6c0-1f3fb",38,20,15,[""]],"1f3fc":["1f6c0-1f3fc",38,21,15,[""]],"1f3fd":["1f6c0-1f3fd",38,22,15,[""]],"1f3fe":["1f6c0-1f3fe",38,23,15,[""]],"1f3ff":["1f6c0-1f3ff",38,24,15,[""]]},"1f6cc":{"1f3fb":["1f6cc-1f3fb",38,32,15,[""]],"1f3fc":["1f6cc-1f3fc",38,33,15,[""]],"1f3fd":["1f6cc-1f3fd",38,34,15,[""]],"1f3fe":["1f6cc-1f3fe",38,35,15,[""]],"1f3ff":["1f6cc-1f3ff",38,36,15,[""]]},"1f90c":{"1f3fb":["1f90c-1f3fb",39,19,15,[""]],"1f3fc":["1f90c-1f3fc",39,20,15,[""]],"1f3fd":["1f90c-1f3fd",39,21,15,[""]],"1f3fe":["1f90c-1f3fe",39,22,15,[""]],"1f3ff":["1f90c-1f3ff",39,23,15,[""]]},"1f90f":{"1f3fb":["1f90f-1f3fb",39,27,15,[""]],"1f3fc":["1f90f-1f3fc",39,28,15,[""]],"1f3fd":["1f90f-1f3fd",39,29,15,[""]],"1f3fe":["1f90f-1f3fe",39,30,15,[""]],"1f3ff":["1f90f-1f3ff",39,31,15,[""]]},"1f918":{"1f3fb":["1f918-1f3fb",39,41,15,[""]],"1f3fc":["1f918-1f3fc",39,42,15,[""]],"1f3fd":["1f918-1f3fd",39,43,15,[""]],"1f3fe":["1f918-1f3fe",39,44,15,[""]],"1f3ff":["1f918-1f3ff",39,45,15,[""]]},"1f919":{"1f3fb":["1f919-1f3fb",39,47,15,[""]],"1f3fc":["1f919-1f3fc",39,48,15,[""]],"1f3fd":["1f919-1f3fd",39,49,15,[""]],"1f3fe":["1f919-1f3fe",39,50,15,[""]],"1f3ff":["1f919-1f3ff",39,51,15,[""]]},"1f91a":{"1f3fb":["1f91a-1f3fb",39,53,15,[""]],"1f3fc":["1f91a-1f3fc",39,54,15,[""]],"1f3fd":["1f91a-1f3fd",39,55,15,[""]],"1f3fe":["1f91a-1f3fe",39,56,15,[""]],"1f3ff":["1f91a-1f3ff",39,57,15,[""]]},"1f91b":{"1f3fb":["1f91b-1f3fb",39,59,15,[""]],"1f3fc":["1f91b-1f3fc",40,0,15,[""]],"1f3fd":["1f91b-1f3fd",40,1,15,[""]],"1f3fe":["1f91b-1f3fe",40,2,15,[""]],"1f3ff":["1f91b-1f3ff",40,3,15,[""]]},"1f91c":{"1f3fb":["1f91c-1f3fb",40,5,15,[""]],"1f3fc":["1f91c-1f3fc",40,6,15,[""]],"1f3fd":["1f91c-1f3fd",40,7,15,[""]],"1f3fe":["1f91c-1f3fe",40,8,15,[""]],"1f3ff":["1f91c-1f3ff",40,9,15,[""]]},"1f91e":{"1f3fb":["1f91e-1f3fb",40,12,15,[""]],"1f3fc":["1f91e-1f3fc",40,13,15,[""]],"1f3fd":["1f91e-1f3fd",40,14,15,[""]],"1f3fe":["1f91e-1f3fe",40,15,15,[""]],"1f3ff":["1f91e-1f3ff",40,16,15,[""]]},"1f91f":{"1f3fb":["1f91f-1f3fb",40,18,15,[""]],"1f3fc":["1f91f-1f3fc",40,19,15,[""]],"1f3fd":["1f91f-1f3fd",40,20,15,[""]],"1f3fe":["1f91f-1f3fe",40,21,15,[""]],"1f3ff":["1f91f-1f3ff",40,22,15,[""]]},"1f926-200d-2640-fe0f":{"1f3fb":["1f926-1f3fb-200d-2640-fe0f",40,30,15,[""]],"1f3fc":["1f926-1f3fc-200d-2640-fe0f",40,31,15,[""]],"1f3fd":["1f926-1f3fd-200d-2640-fe0f",40,32,15,[""]],"1f3fe":["1f926-1f3fe-200d-2640-fe0f",40,33,15,[""]],"1f3ff":["1f926-1f3ff-200d-2640-fe0f",40,34,15,[""]]},"1f926-200d-2642-fe0f":{"1f3fb":["1f926-1f3fb-200d-2642-fe0f",40,36,15,[""]],"1f3fc":["1f926-1f3fc-200d-2642-fe0f",40,37,15,[""]],"1f3fd":["1f926-1f3fd-200d-2642-fe0f",40,38,15,[""]],"1f3fe":["1f926-1f3fe-200d-2642-fe0f",40,39,15,[""]],"1f3ff":["1f926-1f3ff-200d-2642-fe0f",40,40,15,[""]]},"1f926":{"1f3fb":["1f926-1f3fb",40,42,15,[""]],"1f3fc":["1f926-1f3fc",40,43,15,[""]],"1f3fd":["1f926-1f3fd",40,44,15,[""]],"1f3fe":["1f926-1f3fe",40,45,15,[""]],"1f3ff":["1f926-1f3ff",40,46,15,[""]]},"1f930":{"1f3fb":["1f930-1f3fb",40,57,15,[""]],"1f3fc":["1f930-1f3fc",40,58,15,[""]],"1f3fd":["1f930-1f3fd",40,59,15,[""]],"1f3fe":["1f930-1f3fe",41,0,15,[""]],"1f3ff":["1f930-1f3ff",41,1,15,[""]]},"1f931":{"1f3fb":["1f931-1f3fb",41,3,15,[""]],"1f3fc":["1f931-1f3fc",41,4,15,[""]],"1f3fd":["1f931-1f3fd",41,5,15,[""]],"1f3fe":["1f931-1f3fe",41,6,15,[""]],"1f3ff":["1f931-1f3ff",41,7,15,[""]]},"1f932":{"1f3fb":["1f932-1f3fb",41,9,15,[""]],"1f3fc":["1f932-1f3fc",41,10,15,[""]],"1f3fd":["1f932-1f3fd",41,11,15,[""]],"1f3fe":["1f932-1f3fe",41,12,15,[""]],"1f3ff":["1f932-1f3ff",41,13,15,[""]]},"1f933":{"1f3fb":["1f933-1f3fb",41,15,15,[""]],"1f3fc":["1f933-1f3fc",41,16,15,[""]],"1f3fd":["1f933-1f3fd",41,17,15,[""]],"1f3fe":["1f933-1f3fe",41,18,15,[""]],"1f3ff":["1f933-1f3ff",41,19,15,[""]]},"1f934":{"1f3fb":["1f934-1f3fb",41,21,15,[""]],"1f3fc":["1f934-1f3fc",41,22,15,[""]],"1f3fd":["1f934-1f3fd",41,23,15,[""]],"1f3fe":["1f934-1f3fe",41,24,15,[""]],"1f3ff":["1f934-1f3ff",41,25,15,[""]]},"1f935-200d-2640-fe0f":{"1f3fb":["1f935-1f3fb-200d-2640-fe0f",41,27,15,[""]],"1f3fc":["1f935-1f3fc-200d-2640-fe0f",41,28,15,[""]],"1f3fd":["1f935-1f3fd-200d-2640-fe0f",41,29,15,[""]],"1f3fe":["1f935-1f3fe-200d-2640-fe0f",41,30,15,[""]],"1f3ff":["1f935-1f3ff-200d-2640-fe0f",41,31,15,[""]]},"1f935-200d-2642-fe0f":{"1f3fb":["1f935-1f3fb-200d-2642-fe0f",41,33,15,[""]],"1f3fc":["1f935-1f3fc-200d-2642-fe0f",41,34,15,[""]],"1f3fd":["1f935-1f3fd-200d-2642-fe0f",41,35,15,[""]],"1f3fe":["1f935-1f3fe-200d-2642-fe0f",41,36,15,[""]],"1f3ff":["1f935-1f3ff-200d-2642-fe0f",41,37,15,[""]]},"1f935":{"1f3fb":["1f935-1f3fb",41,39,15,[""]],"1f3fc":["1f935-1f3fc",41,40,15,[""]],"1f3fd":["1f935-1f3fd",41,41,15,[""]],"1f3fe":["1f935-1f3fe",41,42,15,[""]],"1f3ff":["1f935-1f3ff",41,43,15,[""]]},"1f936":{"1f3fb":["1f936-1f3fb",41,45,15,[""]],"1f3fc":["1f936-1f3fc",41,46,15,[""]],"1f3fd":["1f936-1f3fd",41,47,15,[""]],"1f3fe":["1f936-1f3fe",41,48,15,[""]],"1f3ff":["1f936-1f3ff",41,49,15,[""]]},"1f937-200d-2640-fe0f":{"1f3fb":["1f937-1f3fb-200d-2640-fe0f",41,51,15,[""]],"1f3fc":["1f937-1f3fc-200d-2640-fe0f",41,52,15,[""]],"1f3fd":["1f937-1f3fd-200d-2640-fe0f",41,53,15,[""]],"1f3fe":["1f937-1f3fe-200d-2640-fe0f",41,54,15,[""]],"1f3ff":["1f937-1f3ff-200d-2640-fe0f",41,55,15,[""]]},"1f937-200d-2642-fe0f":{"1f3fb":["1f937-1f3fb-200d-2642-fe0f",41,57,15,[""]],"1f3fc":["1f937-1f3fc-200d-2642-fe0f",41,58,15,[""]],"1f3fd":["1f937-1f3fd-200d-2642-fe0f",41,59,15,[""]],"1f3fe":["1f937-1f3fe-200d-2642-fe0f",42,0,15,[""]],"1f3ff":["1f937-1f3ff-200d-2642-fe0f",42,1,15,[""]]},"1f937":{"1f3fb":["1f937-1f3fb",42,3,15,[""]],"1f3fc":["1f937-1f3fc",42,4,15,[""]],"1f3fd":["1f937-1f3fd",42,5,15,[""]],"1f3fe":["1f937-1f3fe",42,6,15,[""]],"1f3ff":["1f937-1f3ff",42,7,15,[""]]},"1f938-200d-2640-fe0f":{"1f3fb":["1f938-1f3fb-200d-2640-fe0f",42,9,15,[""]],"1f3fc":["1f938-1f3fc-200d-2640-fe0f",42,10,15,[""]],"1f3fd":["1f938-1f3fd-200d-2640-fe0f",42,11,15,[""]],"1f3fe":["1f938-1f3fe-200d-2640-fe0f",42,12,15,[""]],"1f3ff":["1f938-1f3ff-200d-2640-fe0f",42,13,15,[""]]},"1f938-200d-2642-fe0f":{"1f3fb":["1f938-1f3fb-200d-2642-fe0f",42,15,15,[""]],"1f3fc":["1f938-1f3fc-200d-2642-fe0f",42,16,15,[""]],"1f3fd":["1f938-1f3fd-200d-2642-fe0f",42,17,15,[""]],"1f3fe":["1f938-1f3fe-200d-2642-fe0f",42,18,15,[""]],"1f3ff":["1f938-1f3ff-200d-2642-fe0f",42,19,15,[""]]},"1f938":{"1f3fb":["1f938-1f3fb",42,21,15,[""]],"1f3fc":["1f938-1f3fc",42,22,15,[""]],"1f3fd":["1f938-1f3fd",42,23,15,[""]],"1f3fe":["1f938-1f3fe",42,24,15,[""]],"1f3ff":["1f938-1f3ff",42,25,15,[""]]},"1f939-200d-2640-fe0f":{"1f3fb":["1f939-1f3fb-200d-2640-fe0f",42,27,15,[""]],"1f3fc":["1f939-1f3fc-200d-2640-fe0f",42,28,15,[""]],"1f3fd":["1f939-1f3fd-200d-2640-fe0f",42,29,15,[""]],"1f3fe":["1f939-1f3fe-200d-2640-fe0f",42,30,15,[""]],"1f3ff":["1f939-1f3ff-200d-2640-fe0f",42,31,15,[""]]},"1f939-200d-2642-fe0f":{"1f3fb":["1f939-1f3fb-200d-2642-fe0f",42,33,15,[""]],"1f3fc":["1f939-1f3fc-200d-2642-fe0f",42,34,15,[""]],"1f3fd":["1f939-1f3fd-200d-2642-fe0f",42,35,15,[""]],"1f3fe":["1f939-1f3fe-200d-2642-fe0f",42,36,15,[""]],"1f3ff":["1f939-1f3ff-200d-2642-fe0f",42,37,15,[""]]},"1f939":{"1f3fb":["1f939-1f3fb",42,39,15,[""]],"1f3fc":["1f939-1f3fc",42,40,15,[""]],"1f3fd":["1f939-1f3fd",42,41,15,[""]],"1f3fe":["1f939-1f3fe",42,42,15,[""]],"1f3ff":["1f939-1f3ff",42,43,15,[""]]},"1f93d-200d-2640-fe0f":{"1f3fb":["1f93d-1f3fb-200d-2640-fe0f",42,49,15,[""]],"1f3fc":["1f93d-1f3fc-200d-2640-fe0f",42,50,15,[""]],"1f3fd":["1f93d-1f3fd-200d-2640-fe0f",42,51,15,[""]],"1f3fe":["1f93d-1f3fe-200d-2640-fe0f",42,52,15,[""]],"1f3ff":["1f93d-1f3ff-200d-2640-fe0f",42,53,15,[""]]},"1f93d-200d-2642-fe0f":{"1f3fb":["1f93d-1f3fb-200d-2642-fe0f",42,55,15,[""]],"1f3fc":["1f93d-1f3fc-200d-2642-fe0f",42,56,15,[""]],"1f3fd":["1f93d-1f3fd-200d-2642-fe0f",42,57,15,[""]],"1f3fe":["1f93d-1f3fe-200d-2642-fe0f",42,58,15,[""]],"1f3ff":["1f93d-1f3ff-200d-2642-fe0f",42,59,15,[""]]},"1f93d":{"1f3fb":["1f93d-1f3fb",43,1,15,[""]],"1f3fc":["1f93d-1f3fc",43,2,15,[""]],"1f3fd":["1f93d-1f3fd",43,3,15,[""]],"1f3fe":["1f93d-1f3fe",43,4,15,[""]],"1f3ff":["1f93d-1f3ff",43,5,15,[""]]},"1f93e-200d-2640-fe0f":{"1f3fb":["1f93e-1f3fb-200d-2640-fe0f",43,7,15,[""]],"1f3fc":["1f93e-1f3fc-200d-2640-fe0f",43,8,15,[""]],"1f3fd":["1f93e-1f3fd-200d-2640-fe0f",43,9,15,[""]],"1f3fe":["1f93e-1f3fe-200d-2640-fe0f",43,10,15,[""]],"1f3ff":["1f93e-1f3ff-200d-2640-fe0f",43,11,15,[""]]},"1f93e-200d-2642-fe0f":{"1f3fb":["1f93e-1f3fb-200d-2642-fe0f",43,13,15,[""]],"1f3fc":["1f93e-1f3fc-200d-2642-fe0f",43,14,15,[""]],"1f3fd":["1f93e-1f3fd-200d-2642-fe0f",43,15,15,[""]],"1f3fe":["1f93e-1f3fe-200d-2642-fe0f",43,16,15,[""]],"1f3ff":["1f93e-1f3ff-200d-2642-fe0f",43,17,15,[""]]},"1f93e":{"1f3fb":["1f93e-1f3fb",43,19,15,[""]],"1f3fc":["1f93e-1f3fc",43,20,15,[""]],"1f3fd":["1f93e-1f3fd",43,21,15,[""]],"1f3fe":["1f93e-1f3fe",43,22,15,[""]],"1f3ff":["1f93e-1f3ff",43,23,15,[""]]},"1f977":{"1f3fb":["1f977-1f3fb",44,20,15,[""]],"1f3fc":["1f977-1f3fc",44,21,15,[""]],"1f3fd":["1f977-1f3fd",44,22,15,[""]],"1f3fe":["1f977-1f3fe",44,23,15,[""]],"1f3ff":["1f977-1f3ff",44,24,15,[""]]},"1f9b5":{"1f3fb":["1f9b5-1f3fb",45,22,15,[""]],"1f3fc":["1f9b5-1f3fc",45,23,15,[""]],"1f3fd":["1f9b5-1f3fd",45,24,15,[""]],"1f3fe":["1f9b5-1f3fe",45,25,15,[""]],"1f3ff":["1f9b5-1f3ff",45,26,15,[""]]},"1f9b6":{"1f3fb":["1f9b6-1f3fb",45,28,15,[""]],"1f3fc":["1f9b6-1f3fc",45,29,15,[""]],"1f3fd":["1f9b6-1f3fd",45,30,15,[""]],"1f3fe":["1f9b6-1f3fe",45,31,15,[""]],"1f3ff":["1f9b6-1f3ff",45,32,15,[""]]},"1f9b8-200d-2640-fe0f":{"1f3fb":["1f9b8-1f3fb-200d-2640-fe0f",45,35,15,[""]],"1f3fc":["1f9b8-1f3fc-200d-2640-fe0f",45,36,15,[""]],"1f3fd":["1f9b8-1f3fd-200d-2640-fe0f",45,37,15,[""]],"1f3fe":["1f9b8-1f3fe-200d-2640-fe0f",45,38,15,[""]],"1f3ff":["1f9b8-1f3ff-200d-2640-fe0f",45,39,15,[""]]},"1f9b8-200d-2642-fe0f":{"1f3fb":["1f9b8-1f3fb-200d-2642-fe0f",45,41,15,[""]],"1f3fc":["1f9b8-1f3fc-200d-2642-fe0f",45,42,15,[""]],"1f3fd":["1f9b8-1f3fd-200d-2642-fe0f",45,43,15,[""]],"1f3fe":["1f9b8-1f3fe-200d-2642-fe0f",45,44,15,[""]],"1f3ff":["1f9b8-1f3ff-200d-2642-fe0f",45,45,15,[""]]},"1f9b8":{"1f3fb":["1f9b8-1f3fb",45,47,15,[""]],"1f3fc":["1f9b8-1f3fc",45,48,15,[""]],"1f3fd":["1f9b8-1f3fd",45,49,15,[""]],"1f3fe":["1f9b8-1f3fe",45,50,15,[""]],"1f3ff":["1f9b8-1f3ff",45,51,15,[""]]},"1f9b9-200d-2640-fe0f":{"1f3fb":["1f9b9-1f3fb-200d-2640-fe0f",45,53,15,[""]],"1f3fc":["1f9b9-1f3fc-200d-2640-fe0f",45,54,15,[""]],"1f3fd":["1f9b9-1f3fd-200d-2640-fe0f",45,55,15,[""]],"1f3fe":["1f9b9-1f3fe-200d-2640-fe0f",45,56,15,[""]],"1f3ff":["1f9b9-1f3ff-200d-2640-fe0f",45,57,15,[""]]},"1f9b9-200d-2642-fe0f":{"1f3fb":["1f9b9-1f3fb-200d-2642-fe0f",45,59,15,[""]],"1f3fc":["1f9b9-1f3fc-200d-2642-fe0f",46,0,15,[""]],"1f3fd":["1f9b9-1f3fd-200d-2642-fe0f",46,1,15,[""]],"1f3fe":["1f9b9-1f3fe-200d-2642-fe0f",46,2,15,[""]],"1f3ff":["1f9b9-1f3ff-200d-2642-fe0f",46,3,15,[""]]},"1f9b9":{"1f3fb":["1f9b9-1f3fb",46,5,15,[""]],"1f3fc":["1f9b9-1f3fc",46,6,15,[""]],"1f3fd":["1f9b9-1f3fd",46,7,15,[""]],"1f3fe":["1f9b9-1f3fe",46,8,15,[""]],"1f3ff":["1f9b9-1f3ff",46,9,15,[""]]},"1f9bb":{"1f3fb":["1f9bb-1f3fb",46,12,15,[""]],"1f3fc":["1f9bb-1f3fc",46,13,15,[""]],"1f3fd":["1f9bb-1f3fd",46,14,15,[""]],"1f3fe":["1f9bb-1f3fe",46,15,15,[""]],"1f3ff":["1f9bb-1f3ff",46,16,15,[""]]},"1f9cd-200d-2640-fe0f":{"1f3fb":["1f9cd-1f3fb-200d-2640-fe0f",46,34,15,[""]],"1f3fc":["1f9cd-1f3fc-200d-2640-fe0f",46,35,15,[""]],"1f3fd":["1f9cd-1f3fd-200d-2640-fe0f",46,36,15,[""]],"1f3fe":["1f9cd-1f3fe-200d-2640-fe0f",46,37,15,[""]],"1f3ff":["1f9cd-1f3ff-200d-2640-fe0f",46,38,15,[""]]},"1f9cd-200d-2642-fe0f":{"1f3fb":["1f9cd-1f3fb-200d-2642-fe0f",46,40,15,[""]],"1f3fc":["1f9cd-1f3fc-200d-2642-fe0f",46,41,15,[""]],"1f3fd":["1f9cd-1f3fd-200d-2642-fe0f",46,42,15,[""]],"1f3fe":["1f9cd-1f3fe-200d-2642-fe0f",46,43,15,[""]],"1f3ff":["1f9cd-1f3ff-200d-2642-fe0f",46,44,15,[""]]},"1f9cd":{"1f3fb":["1f9cd-1f3fb",46,46,15,[""]],"1f3fc":["1f9cd-1f3fc",46,47,15,[""]],"1f3fd":["1f9cd-1f3fd",46,48,15,[""]],"1f3fe":["1f9cd-1f3fe",46,49,15,[""]],"1f3ff":["1f9cd-1f3ff",46,50,15,[""]]},"1f9ce-200d-2640-fe0f":{"1f3fb":["1f9ce-1f3fb-200d-2640-fe0f",46,52,15,[""]],"1f3fc":["1f9ce-1f3fc-200d-2640-fe0f",46,53,15,[""]],"1f3fd":["1f9ce-1f3fd-200d-2640-fe0f",46,54,15,[""]],"1f3fe":["1f9ce-1f3fe-200d-2640-fe0f",46,55,15,[""]],"1f3ff":["1f9ce-1f3ff-200d-2640-fe0f",46,56,15,[""]]},"1f9ce-200d-2642-fe0f":{"1f3fb":["1f9ce-1f3fb-200d-2642-fe0f",46,58,15,[""]],"1f3fc":["1f9ce-1f3fc-200d-2642-fe0f",46,59,15,[""]],"1f3fd":["1f9ce-1f3fd-200d-2642-fe0f",47,0,15,[""]],"1f3fe":["1f9ce-1f3fe-200d-2642-fe0f",47,1,15,[""]],"1f3ff":["1f9ce-1f3ff-200d-2642-fe0f",47,2,15,[""]]},"1f9ce":{"1f3fb":["1f9ce-1f3fb",47,4,15,[""]],"1f3fc":["1f9ce-1f3fc",47,5,15,[""]],"1f3fd":["1f9ce-1f3fd",47,6,15,[""]],"1f3fe":["1f9ce-1f3fe",47,7,15,[""]],"1f3ff":["1f9ce-1f3ff",47,8,15,[""]]},"1f9cf-200d-2640-fe0f":{"1f3fb":["1f9cf-1f3fb-200d-2640-fe0f",47,10,15,[""]],"1f3fc":["1f9cf-1f3fc-200d-2640-fe0f",47,11,15,[""]],"1f3fd":["1f9cf-1f3fd-200d-2640-fe0f",47,12,15,[""]],"1f3fe":["1f9cf-1f3fe-200d-2640-fe0f",47,13,15,[""]],"1f3ff":["1f9cf-1f3ff-200d-2640-fe0f",47,14,15,[""]]},"1f9cf-200d-2642-fe0f":{"1f3fb":["1f9cf-1f3fb-200d-2642-fe0f",47,16,15,[""]],"1f3fc":["1f9cf-1f3fc-200d-2642-fe0f",47,17,15,[""]],"1f3fd":["1f9cf-1f3fd-200d-2642-fe0f",47,18,15,[""]],"1f3fe":["1f9cf-1f3fe-200d-2642-fe0f",47,19,15,[""]],"1f3ff":["1f9cf-1f3ff-200d-2642-fe0f",47,20,15,[""]]},"1f9cf":{"1f3fb":["1f9cf-1f3fb",47,22,15,[""]],"1f3fc":["1f9cf-1f3fc",47,23,15,[""]],"1f3fd":["1f9cf-1f3fd",47,24,15,[""]],"1f3fe":["1f9cf-1f3fe",47,25,15,[""]],"1f3ff":["1f9cf-1f3ff",47,26,15,[""]]},"1f9d1-200d-1f33e":{"1f3fb":["1f9d1-1f3fb-200d-1f33e",47,29,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-1f33e",47,30,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-1f33e",47,31,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-1f33e",47,32,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-1f33e",47,33,15,[""]]},"1f9d1-200d-1f373":{"1f3fb":["1f9d1-1f3fb-200d-1f373",47,35,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-1f373",47,36,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-1f373",47,37,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-1f373",47,38,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-1f373",47,39,15,[""]]},"1f9d1-200d-1f37c":{"1f3fb":["1f9d1-1f3fb-200d-1f37c",47,41,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-1f37c",47,42,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-1f37c",47,43,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-1f37c",47,44,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-1f37c",47,45,15,[""]]},"1f9d1-200d-1f384":{"1f3fb":["1f9d1-1f3fb-200d-1f384",47,47,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-1f384",47,48,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-1f384",47,49,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-1f384",47,50,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-1f384",47,51,15,[""]]},"1f9d1-200d-1f393":{"1f3fb":["1f9d1-1f3fb-200d-1f393",47,53,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-1f393",47,54,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-1f393",47,55,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-1f393",47,56,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-1f393",47,57,15,[""]]},"1f9d1-200d-1f3a4":{"1f3fb":["1f9d1-1f3fb-200d-1f3a4",47,59,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-1f3a4",48,0,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-1f3a4",48,1,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-1f3a4",48,2,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-1f3a4",48,3,15,[""]]},"1f9d1-200d-1f3a8":{"1f3fb":["1f9d1-1f3fb-200d-1f3a8",48,5,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-1f3a8",48,6,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-1f3a8",48,7,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-1f3a8",48,8,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-1f3a8",48,9,15,[""]]},"1f9d1-200d-1f3eb":{"1f3fb":["1f9d1-1f3fb-200d-1f3eb",48,11,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-1f3eb",48,12,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-1f3eb",48,13,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-1f3eb",48,14,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-1f3eb",48,15,15,[""]]},"1f9d1-200d-1f3ed":{"1f3fb":["1f9d1-1f3fb-200d-1f3ed",48,17,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-1f3ed",48,18,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-1f3ed",48,19,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-1f3ed",48,20,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-1f3ed",48,21,15,[""]]},"1f9d1-200d-1f4bb":{"1f3fb":["1f9d1-1f3fb-200d-1f4bb",48,23,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-1f4bb",48,24,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-1f4bb",48,25,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-1f4bb",48,26,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-1f4bb",48,27,15,[""]]},"1f9d1-200d-1f4bc":{"1f3fb":["1f9d1-1f3fb-200d-1f4bc",48,29,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-1f4bc",48,30,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-1f4bc",48,31,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-1f4bc",48,32,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-1f4bc",48,33,15,[""]]},"1f9d1-200d-1f527":{"1f3fb":["1f9d1-1f3fb-200d-1f527",48,35,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-1f527",48,36,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-1f527",48,37,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-1f527",48,38,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-1f527",48,39,15,[""]]},"1f9d1-200d-1f52c":{"1f3fb":["1f9d1-1f3fb-200d-1f52c",48,41,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-1f52c",48,42,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-1f52c",48,43,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-1f52c",48,44,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-1f52c",48,45,15,[""]]},"1f9d1-200d-1f680":{"1f3fb":["1f9d1-1f3fb-200d-1f680",48,47,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-1f680",48,48,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-1f680",48,49,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-1f680",48,50,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-1f680",48,51,15,[""]]},"1f9d1-200d-1f692":{"1f3fb":["1f9d1-1f3fb-200d-1f692",48,53,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-1f692",48,54,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-1f692",48,55,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-1f692",48,56,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-1f692",48,57,15,[""]]},"1f9d1-200d-1f91d-200d-1f9d1":{"1f3fb-1f3fb":["1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fb",48,59,15,[""]],"1f3fb-1f3fc":["1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fc",49,0,7,[""]],"1f3fb-1f3fd":["1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fd",49,1,7,[""]],"1f3fb-1f3fe":["1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fe",49,2,7,[""]],"1f3fb-1f3ff":["1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3ff",49,3,7,[""]],"1f3fc-1f3fb":["1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fb",49,4,15,[""]],"1f3fc-1f3fc":["1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fc",49,5,15,[""]],"1f3fc-1f3fd":["1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fd",49,6,7,[""]],"1f3fc-1f3fe":["1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fe",49,7,7,[""]],"1f3fc-1f3ff":["1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3ff",49,8,7,[""]],"1f3fd-1f3fb":["1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fb",49,9,15,[""]],"1f3fd-1f3fc":["1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fc",49,10,15,[""]],"1f3fd-1f3fd":["1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fd",49,11,15,[""]],"1f3fd-1f3fe":["1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fe",49,12,7,[""]],"1f3fd-1f3ff":["1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3ff",49,13,7,[""]],"1f3fe-1f3fb":["1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fb",49,14,15,[""]],"1f3fe-1f3fc":["1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fc",49,15,15,[""]],"1f3fe-1f3fd":["1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fd",49,16,15,[""]],"1f3fe-1f3fe":["1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fe",49,17,15,[""]],"1f3fe-1f3ff":["1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3ff",49,18,7,[""]],"1f3ff-1f3fb":["1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fb",49,19,15,[""]],"1f3ff-1f3fc":["1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fc",49,20,15,[""]],"1f3ff-1f3fd":["1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fd",49,21,15,[""]],"1f3ff-1f3fe":["1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fe",49,22,15,[""]],"1f3ff-1f3ff":["1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3ff",49,23,15,[""]]},"1f9d1-200d-1f9af":{"1f3fb":["1f9d1-1f3fb-200d-1f9af",49,25,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-1f9af",49,26,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-1f9af",49,27,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-1f9af",49,28,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-1f9af",49,29,15,[""]]},"1f9d1-200d-1f9b0":{"1f3fb":["1f9d1-1f3fb-200d-1f9b0",49,31,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-1f9b0",49,32,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-1f9b0",49,33,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-1f9b0",49,34,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-1f9b0",49,35,15,[""]]},"1f9d1-200d-1f9b1":{"1f3fb":["1f9d1-1f3fb-200d-1f9b1",49,37,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-1f9b1",49,38,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-1f9b1",49,39,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-1f9b1",49,40,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-1f9b1",49,41,15,[""]]},"1f9d1-200d-1f9b2":{"1f3fb":["1f9d1-1f3fb-200d-1f9b2",49,43,7,[""]],"1f3fc":["1f9d1-1f3fc-200d-1f9b2",49,44,7,[""]],"1f3fd":["1f9d1-1f3fd-200d-1f9b2",49,45,7,[""]],"1f3fe":["1f9d1-1f3fe-200d-1f9b2",49,46,7,[""]],"1f3ff":["1f9d1-1f3ff-200d-1f9b2",49,47,7,[""]]},"1f9d1-200d-1f9b3":{"1f3fb":["1f9d1-1f3fb-200d-1f9b3",49,49,7,[""]],"1f3fc":["1f9d1-1f3fc-200d-1f9b3",49,50,7,[""]],"1f3fd":["1f9d1-1f3fd-200d-1f9b3",49,51,7,[""]],"1f3fe":["1f9d1-1f3fe-200d-1f9b3",49,52,7,[""]],"1f3ff":["1f9d1-1f3ff-200d-1f9b3",49,53,7,[""]]},"1f9d1-200d-1f9bc":{"1f3fb":["1f9d1-1f3fb-200d-1f9bc",49,55,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-1f9bc",49,56,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-1f9bc",49,57,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-1f9bc",49,58,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-1f9bc",49,59,15,[""]]},"1f9d1-200d-1f9bd":{"1f3fb":["1f9d1-1f3fb-200d-1f9bd",50,1,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-1f9bd",50,2,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-1f9bd",50,3,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-1f9bd",50,4,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-1f9bd",50,5,15,[""]]},"1f9d1-200d-2695-fe0f":{"1f3fb":["1f9d1-1f3fb-200d-2695-fe0f",50,7,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-2695-fe0f",50,8,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-2695-fe0f",50,9,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-2695-fe0f",50,10,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-2695-fe0f",50,11,15,[""]]},"1f9d1-200d-2696-fe0f":{"1f3fb":["1f9d1-1f3fb-200d-2696-fe0f",50,13,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-2696-fe0f",50,14,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-2696-fe0f",50,15,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-2696-fe0f",50,16,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-2696-fe0f",50,17,15,[""]]},"1f9d1-200d-2708-fe0f":{"1f3fb":["1f9d1-1f3fb-200d-2708-fe0f",50,19,15,[""]],"1f3fc":["1f9d1-1f3fc-200d-2708-fe0f",50,20,15,[""]],"1f3fd":["1f9d1-1f3fd-200d-2708-fe0f",50,21,15,[""]],"1f3fe":["1f9d1-1f3fe-200d-2708-fe0f",50,22,15,[""]],"1f3ff":["1f9d1-1f3ff-200d-2708-fe0f",50,23,15,[""]]},"1f9d1":{"1f3fb":["1f9d1-1f3fb",50,25,15,[""]],"1f3fc":["1f9d1-1f3fc",50,26,15,[""]],"1f3fd":["1f9d1-1f3fd",50,27,15,[""]],"1f3fe":["1f9d1-1f3fe",50,28,15,[""]],"1f3ff":["1f9d1-1f3ff",50,29,15,[""]]},"1f9d2":{"1f3fb":["1f9d2-1f3fb",50,31,15,[""]],"1f3fc":["1f9d2-1f3fc",50,32,15,[""]],"1f3fd":["1f9d2-1f3fd",50,33,15,[""]],"1f3fe":["1f9d2-1f3fe",50,34,15,[""]],"1f3ff":["1f9d2-1f3ff",50,35,15,[""]]},"1f9d3":{"1f3fb":["1f9d3-1f3fb",50,37,15,[""]],"1f3fc":["1f9d3-1f3fc",50,38,15,[""]],"1f3fd":["1f9d3-1f3fd",50,39,15,[""]],"1f3fe":["1f9d3-1f3fe",50,40,15,[""]],"1f3ff":["1f9d3-1f3ff",50,41,15,[""]]},"1f9d4-200d-2640-fe0f":{"1f3fb":["1f9d4-1f3fb-200d-2640-fe0f",50,43,7,[""]],"1f3fc":["1f9d4-1f3fc-200d-2640-fe0f",50,44,7,[""]],"1f3fd":["1f9d4-1f3fd-200d-2640-fe0f",50,45,7,[""]],"1f3fe":["1f9d4-1f3fe-200d-2640-fe0f",50,46,7,[""]],"1f3ff":["1f9d4-1f3ff-200d-2640-fe0f",50,47,7,[""]]},"1f9d4-200d-2642-fe0f":{"1f3fb":["1f9d4-1f3fb-200d-2642-fe0f",50,49,7,[""]],"1f3fc":["1f9d4-1f3fc-200d-2642-fe0f",50,50,7,[""]],"1f3fd":["1f9d4-1f3fd-200d-2642-fe0f",50,51,7,[""]],"1f3fe":["1f9d4-1f3fe-200d-2642-fe0f",50,52,7,[""]],"1f3ff":["1f9d4-1f3ff-200d-2642-fe0f",50,53,7,[""]]},"1f9d4":{"1f3fb":["1f9d4-1f3fb",50,55,15,[""]],"1f3fc":["1f9d4-1f3fc",50,56,15,[""]],"1f3fd":["1f9d4-1f3fd",50,57,15,[""]],"1f3fe":["1f9d4-1f3fe",50,58,15,[""]],"1f3ff":["1f9d4-1f3ff",50,59,15,[""]]},"1f9d5":{"1f3fb":["1f9d5-1f3fb",51,1,15,[""]],"1f3fc":["1f9d5-1f3fc",51,2,15,[""]],"1f3fd":["1f9d5-1f3fd",51,3,15,[""]],"1f3fe":["1f9d5-1f3fe",51,4,15,[""]],"1f3ff":["1f9d5-1f3ff",51,5,15,[""]]},"1f9d6-200d-2640-fe0f":{"1f3fb":["1f9d6-1f3fb-200d-2640-fe0f",51,7,15,[""]],"1f3fc":["1f9d6-1f3fc-200d-2640-fe0f",51,8,15,[""]],"1f3fd":["1f9d6-1f3fd-200d-2640-fe0f",51,9,15,[""]],"1f3fe":["1f9d6-1f3fe-200d-2640-fe0f",51,10,15,[""]],"1f3ff":["1f9d6-1f3ff-200d-2640-fe0f",51,11,15,[""]]},"1f9d6-200d-2642-fe0f":{"1f3fb":["1f9d6-1f3fb-200d-2642-fe0f",51,13,15,["",""]],"1f3fc":["1f9d6-1f3fc-200d-2642-fe0f",51,14,15,["",""]],"1f3fd":["1f9d6-1f3fd-200d-2642-fe0f",51,15,15,["",""]],"1f3fe":["1f9d6-1f3fe-200d-2642-fe0f",51,16,15,["",""]],"1f3ff":["1f9d6-1f3ff-200d-2642-fe0f",51,17,15,["",""]]},"1f9d7-200d-2640-fe0f":{"1f3fb":["1f9d7-1f3fb-200d-2640-fe0f",51,25,15,["",""]],"1f3fc":["1f9d7-1f3fc-200d-2640-fe0f",51,26,15,["",""]],"1f3fd":["1f9d7-1f3fd-200d-2640-fe0f",51,27,15,["",""]],"1f3fe":["1f9d7-1f3fe-200d-2640-fe0f",51,28,15,["",""]],"1f3ff":["1f9d7-1f3ff-200d-2640-fe0f",51,29,15,["",""]]},"1f9d7-200d-2642-fe0f":{"1f3fb":["1f9d7-1f3fb-200d-2642-fe0f",51,31,15,[""]],"1f3fc":["1f9d7-1f3fc-200d-2642-fe0f",51,32,15,[""]],"1f3fd":["1f9d7-1f3fd-200d-2642-fe0f",51,33,15,[""]],"1f3fe":["1f9d7-1f3fe-200d-2642-fe0f",51,34,15,[""]],"1f3ff":["1f9d7-1f3ff-200d-2642-fe0f",51,35,15,[""]]},"1f9d8-200d-2640-fe0f":{"1f3fb":["1f9d8-1f3fb-200d-2640-fe0f",51,43,15,["",""]],"1f3fc":["1f9d8-1f3fc-200d-2640-fe0f",51,44,15,["",""]],"1f3fd":["1f9d8-1f3fd-200d-2640-fe0f",51,45,15,["",""]],"1f3fe":["1f9d8-1f3fe-200d-2640-fe0f",51,46,15,["",""]],"1f3ff":["1f9d8-1f3ff-200d-2640-fe0f",51,47,15,["",""]]},"1f9d8-200d-2642-fe0f":{"1f3fb":["1f9d8-1f3fb-200d-2642-fe0f",51,49,15,[""]],"1f3fc":["1f9d8-1f3fc-200d-2642-fe0f",51,50,15,[""]],"1f3fd":["1f9d8-1f3fd-200d-2642-fe0f",51,51,15,[""]],"1f3fe":["1f9d8-1f3fe-200d-2642-fe0f",51,52,15,[""]],"1f3ff":["1f9d8-1f3ff-200d-2642-fe0f",51,53,15,[""]]},"1f9d9-200d-2640-fe0f":{"1f3fb":["1f9d9-1f3fb-200d-2640-fe0f",52,1,15,["",""]],"1f3fc":["1f9d9-1f3fc-200d-2640-fe0f",52,2,15,["",""]],"1f3fd":["1f9d9-1f3fd-200d-2640-fe0f",52,3,15,["",""]],"1f3fe":["1f9d9-1f3fe-200d-2640-fe0f",52,4,15,["",""]],"1f3ff":["1f9d9-1f3ff-200d-2640-fe0f",52,5,15,["",""]]},"1f9d9-200d-2642-fe0f":{"1f3fb":["1f9d9-1f3fb-200d-2642-fe0f",52,7,15,[""]],"1f3fc":["1f9d9-1f3fc-200d-2642-fe0f",52,8,15,[""]],"1f3fd":["1f9d9-1f3fd-200d-2642-fe0f",52,9,15,[""]],"1f3fe":["1f9d9-1f3fe-200d-2642-fe0f",52,10,15,[""]],"1f3ff":["1f9d9-1f3ff-200d-2642-fe0f",52,11,15,[""]]},"1f9da-200d-2640-fe0f":{"1f3fb":["1f9da-1f3fb-200d-2640-fe0f",52,19,15,["",""]],"1f3fc":["1f9da-1f3fc-200d-2640-fe0f",52,20,15,["",""]],"1f3fd":["1f9da-1f3fd-200d-2640-fe0f",52,21,15,["",""]],"1f3fe":["1f9da-1f3fe-200d-2640-fe0f",52,22,15,["",""]],"1f3ff":["1f9da-1f3ff-200d-2640-fe0f",52,23,15,["",""]]},"1f9da-200d-2642-fe0f":{"1f3fb":["1f9da-1f3fb-200d-2642-fe0f",52,25,15,[""]],"1f3fc":["1f9da-1f3fc-200d-2642-fe0f",52,26,15,[""]],"1f3fd":["1f9da-1f3fd-200d-2642-fe0f",52,27,15,[""]],"1f3fe":["1f9da-1f3fe-200d-2642-fe0f",52,28,15,[""]],"1f3ff":["1f9da-1f3ff-200d-2642-fe0f",52,29,15,[""]]},"1f9db-200d-2640-fe0f":{"1f3fb":["1f9db-1f3fb-200d-2640-fe0f",52,37,15,["",""]],"1f3fc":["1f9db-1f3fc-200d-2640-fe0f",52,38,15,["",""]],"1f3fd":["1f9db-1f3fd-200d-2640-fe0f",52,39,15,["",""]],"1f3fe":["1f9db-1f3fe-200d-2640-fe0f",52,40,15,["",""]],"1f3ff":["1f9db-1f3ff-200d-2640-fe0f",52,41,15,["",""]]},"1f9db-200d-2642-fe0f":{"1f3fb":["1f9db-1f3fb-200d-2642-fe0f",52,43,15,[""]],"1f3fc":["1f9db-1f3fc-200d-2642-fe0f",52,44,15,[""]],"1f3fd":["1f9db-1f3fd-200d-2642-fe0f",52,45,15,[""]],"1f3fe":["1f9db-1f3fe-200d-2642-fe0f",52,46,15,[""]],"1f3ff":["1f9db-1f3ff-200d-2642-fe0f",52,47,15,[""]]},"1f9dc-200d-2640-fe0f":{"1f3fb":["1f9dc-1f3fb-200d-2640-fe0f",52,55,15,[""]],"1f3fc":["1f9dc-1f3fc-200d-2640-fe0f",52,56,15,[""]],"1f3fd":["1f9dc-1f3fd-200d-2640-fe0f",52,57,15,[""]],"1f3fe":["1f9dc-1f3fe-200d-2640-fe0f",52,58,15,[""]],"1f3ff":["1f9dc-1f3ff-200d-2640-fe0f",52,59,15,[""]]},"1f9dc-200d-2642-fe0f":{"1f3fb":["1f9dc-1f3fb-200d-2642-fe0f",53,1,15,["",""]],"1f3fc":["1f9dc-1f3fc-200d-2642-fe0f",53,2,15,["",""]],"1f3fd":["1f9dc-1f3fd-200d-2642-fe0f",53,3,15,["",""]],"1f3fe":["1f9dc-1f3fe-200d-2642-fe0f",53,4,15,["",""]],"1f3ff":["1f9dc-1f3ff-200d-2642-fe0f",53,5,15,["",""]]},"1f9dd-200d-2640-fe0f":{"1f3fb":["1f9dd-1f3fb-200d-2640-fe0f",53,13,15,[""]],"1f3fc":["1f9dd-1f3fc-200d-2640-fe0f",53,14,15,[""]],"1f3fd":["1f9dd-1f3fd-200d-2640-fe0f",53,15,15,[""]],"1f3fe":["1f9dd-1f3fe-200d-2640-fe0f",53,16,15,[""]],"1f3ff":["1f9dd-1f3ff-200d-2640-fe0f",53,17,15,[""]]},"1f9dd-200d-2642-fe0f":{"1f3fb":["1f9dd-1f3fb-200d-2642-fe0f",53,19,15,["",""]],"1f3fc":["1f9dd-1f3fc-200d-2642-fe0f",53,20,15,["",""]],"1f3fd":["1f9dd-1f3fd-200d-2642-fe0f",53,21,15,["",""]],"1f3fe":["1f9dd-1f3fe-200d-2642-fe0f",53,22,15,["",""]],"1f3ff":["1f9dd-1f3ff-200d-2642-fe0f",53,23,15,["",""]]},"261d-fe0f":{"1f3fb":["261d-1f3fb",55,55,15,[""]],"1f3fc":["261d-1f3fc",55,56,15,[""]],"1f3fd":["261d-1f3fd",55,57,15,[""]],"1f3fe":["261d-1f3fe",55,58,15,[""]],"1f3ff":["261d-1f3ff",55,59,15,[""]]},"26f9-fe0f-200d-2640-fe0f":{"1f3fb":["26f9-1f3fb-200d-2640-fe0f",57,10,15,[""]],"1f3fc":["26f9-1f3fc-200d-2640-fe0f",57,11,15,[""]],"1f3fd":["26f9-1f3fd-200d-2640-fe0f",57,12,15,[""]],"1f3fe":["26f9-1f3fe-200d-2640-fe0f",57,13,15,[""]],"1f3ff":["26f9-1f3ff-200d-2640-fe0f",57,14,15,[""]]},"26f9-fe0f-200d-2642-fe0f":{"1f3fb":["26f9-1f3fb-200d-2642-fe0f",57,16,15,["",""]],"1f3fc":["26f9-1f3fc-200d-2642-fe0f",57,17,15,["",""]],"1f3fd":["26f9-1f3fd-200d-2642-fe0f",57,18,15,["",""]],"1f3fe":["26f9-1f3fe-200d-2642-fe0f",57,19,15,["",""]],"1f3ff":["26f9-1f3ff-200d-2642-fe0f",57,20,15,["",""]]},"270a":{"1f3fb":["270a-1f3fb",57,34,15,[""]],"1f3fc":["270a-1f3fc",57,35,15,[""]],"1f3fd":["270a-1f3fd",57,36,15,[""]],"1f3fe":["270a-1f3fe",57,37,15,[""]],"1f3ff":["270a-1f3ff",57,38,15,[""]]},"270b":{"1f3fb":["270b-1f3fb",57,40,15,[""]],"1f3fc":["270b-1f3fc",57,41,15,[""]],"1f3fd":["270b-1f3fd",57,42,15,[""]],"1f3fe":["270b-1f3fe",57,43,15,[""]],"1f3ff":["270b-1f3ff",57,44,15,[""]]},"270c-fe0f":{"1f3fb":["270c-1f3fb",57,46,15,[""]],"1f3fc":["270c-1f3fc",57,47,15,[""]],"1f3fd":["270c-1f3fd",57,48,15,[""]],"1f3fe":["270c-1f3fe",57,49,15,[""]],"1f3ff":["270c-1f3ff",57,50,15,[""]]},"270d-fe0f":{"1f3fb":["270d-1f3fb",57,52,15,[""]],"1f3fc":["270d-1f3fc",57,53,15,[""]],"1f3fd":["270d-1f3fd",57,54,15,[""]],"1f3fe":["270d-1f3fe",57,55,15,[""]],"1f3ff":["270d-1f3ff",57,56,15,[""]]}};n.prototype.obsoletes_data={"1f3c3-200d-2642-fe0f":["1f3c3",8,34,15],"1f3c3-1f3fb-200d-2642-fe0f":["1f3c3-1f3fb",8,35,15],"1f3c3-1f3fc-200d-2642-fe0f":["1f3c3-1f3fc",8,36,15],"1f3c3-1f3fd-200d-2642-fe0f":["1f3c3-1f3fd",8,37,15],"1f3c3-1f3fe-200d-2642-fe0f":["1f3c3-1f3fe",8,38,15],"1f3c3-1f3ff-200d-2642-fe0f":["1f3c3-1f3ff",8,39,15],"1f3c4-200d-2642-fe0f":["1f3c4",8,52,15],"1f3c4-1f3fb-200d-2642-fe0f":["1f3c4-1f3fb",8,53,15],"1f3c4-1f3fc-200d-2642-fe0f":["1f3c4-1f3fc",8,54,15],"1f3c4-1f3fd-200d-2642-fe0f":["1f3c4-1f3fd",8,55,15],"1f3c4-1f3fe-200d-2642-fe0f":["1f3c4-1f3fe",8,56,15],"1f3c4-1f3ff-200d-2642-fe0f":["1f3c4-1f3ff",8,57,15],"1f3ca-200d-2642-fe0f":["1f3ca",9,20,15],"1f3ca-1f3fb-200d-2642-fe0f":["1f3ca-1f3fb",9,21,15],"1f3ca-1f3fc-200d-2642-fe0f":["1f3ca-1f3fc",9,22,15],"1f3ca-1f3fd-200d-2642-fe0f":["1f3ca-1f3fd",9,23,15],"1f3ca-1f3fe-200d-2642-fe0f":["1f3ca-1f3fe",9,24,15],"1f3ca-1f3ff-200d-2642-fe0f":["1f3ca-1f3ff",9,25,15],"1f3cb-fe0f-200d-2642-fe0f":["1f3cb-fe0f",9,38,15],"1f3cb-1f3fb-200d-2642-fe0f":["1f3cb-1f3fb",9,39,15],"1f3cb-1f3fc-200d-2642-fe0f":["1f3cb-1f3fc",9,40,15],"1f3cb-1f3fd-200d-2642-fe0f":["1f3cb-1f3fd",9,41,15],"1f3cb-1f3fe-200d-2642-fe0f":["1f3cb-1f3fe",9,42,15],"1f3cb-1f3ff-200d-2642-fe0f":["1f3cb-1f3ff",9,43,15],"1f3cc-fe0f-200d-2642-fe0f":["1f3cc-fe0f",9,56,15],"1f3cc-1f3fb-200d-2642-fe0f":["1f3cc-1f3fb",9,57,15],"1f3cc-1f3fc-200d-2642-fe0f":["1f3cc-1f3fc",9,58,15],"1f3cc-1f3fd-200d-2642-fe0f":["1f3cc-1f3fd",9,59,15],"1f3cc-1f3fe-200d-2642-fe0f":["1f3cc-1f3fe",10,0,15],"1f3cc-1f3ff-200d-2642-fe0f":["1f3cc-1f3ff",10,1,15],"1f468-200d-1f469-200d-1f466":["1f46a",22,0,15],"1f46e-200d-2642-fe0f":["1f46e",23,31,15],"1f46e-1f3fb-200d-2642-fe0f":["1f46e-1f3fb",23,32,15],"1f46e-1f3fc-200d-2642-fe0f":["1f46e-1f3fc",23,33,15],"1f46e-1f3fd-200d-2642-fe0f":["1f46e-1f3fd",23,34,15],"1f46e-1f3fe-200d-2642-fe0f":["1f46e-1f3fe",23,35,15],"1f46e-1f3ff-200d-2642-fe0f":["1f46e-1f3ff",23,36,15],"1f46f-200d-2640-fe0f":["1f46f",23,39,15],"1f471-200d-2642-fe0f":["1f471",24,10,15],"1f471-1f3fb-200d-2642-fe0f":["1f471-1f3fb",24,11,15],"1f471-1f3fc-200d-2642-fe0f":["1f471-1f3fc",24,12,15],"1f471-1f3fd-200d-2642-fe0f":["1f471-1f3fd",24,13,15],"1f471-1f3fe-200d-2642-fe0f":["1f471-1f3fe",24,14,15],"1f471-1f3ff-200d-2642-fe0f":["1f471-1f3ff",24,15,15],"1f473-200d-2642-fe0f":["1f473",24,34,15],"1f473-1f3fb-200d-2642-fe0f":["1f473-1f3fb",24,35,15],"1f473-1f3fc-200d-2642-fe0f":["1f473-1f3fc",24,36,15],"1f473-1f3fd-200d-2642-fe0f":["1f473-1f3fd",24,37,15],"1f473-1f3fe-200d-2642-fe0f":["1f473-1f3fe",24,38,15],"1f473-1f3ff-200d-2642-fe0f":["1f473-1f3ff",24,39,15],"1f477-200d-2642-fe0f":["1f477",25,10,15],"1f477-1f3fb-200d-2642-fe0f":["1f477-1f3fb",25,11,15],"1f477-1f3fc-200d-2642-fe0f":["1f477-1f3fc",25,12,15],"1f477-1f3fd-200d-2642-fe0f":["1f477-1f3fd",25,13,15],"1f477-1f3fe-200d-2642-fe0f":["1f477-1f3fe",25,14,15],"1f477-1f3ff-200d-2642-fe0f":["1f477-1f3ff",25,15,15],"1f481-200d-2640-fe0f":["1f481",25,47,15],"1f481-1f3fb-200d-2640-fe0f":["1f481-1f3fb",25,48,15],"1f481-1f3fc-200d-2640-fe0f":["1f481-1f3fc",25,49,15],"1f481-1f3fd-200d-2640-fe0f":["1f481-1f3fd",25,50,15],"1f481-1f3fe-200d-2640-fe0f":["1f481-1f3fe",25,51,15],"1f481-1f3ff-200d-2640-fe0f":["1f481-1f3ff",25,52,15],"1f482-200d-2642-fe0f":["1f482",26,5,15],"1f482-1f3fb-200d-2642-fe0f":["1f482-1f3fb",26,6,15],"1f482-1f3fc-200d-2642-fe0f":["1f482-1f3fc",26,7,15],"1f482-1f3fd-200d-2642-fe0f":["1f482-1f3fd",26,8,15],"1f482-1f3fe-200d-2642-fe0f":["1f482-1f3fe",26,9,15],"1f482-1f3ff-200d-2642-fe0f":["1f482-1f3ff",26,10,15],"1f486-200d-2640-fe0f":["1f486",26,36,15],"1f486-1f3fb-200d-2640-fe0f":["1f486-1f3fb",26,37,15],"1f486-1f3fc-200d-2640-fe0f":["1f486-1f3fc",26,38,15],"1f486-1f3fd-200d-2640-fe0f":["1f486-1f3fd",26,39,15],"1f486-1f3fe-200d-2640-fe0f":["1f486-1f3fe",26,40,15],"1f486-1f3ff-200d-2640-fe0f":["1f486-1f3ff",26,41,15],"1f487-200d-2640-fe0f":["1f487",26,54,15],"1f487-1f3fb-200d-2640-fe0f":["1f487-1f3fb",26,55,15],"1f487-1f3fc-200d-2640-fe0f":["1f487-1f3fc",26,56,15],"1f487-1f3fd-200d-2640-fe0f":["1f487-1f3fd",26,57,15],"1f487-1f3fe-200d-2640-fe0f":["1f487-1f3fe",26,58,15],"1f487-1f3ff-200d-2640-fe0f":["1f487-1f3ff",26,59,15],"1f575-fe0f-200d-2642-fe0f":["1f575-fe0f",31,47,15],"1f575-1f3fb-200d-2642-fe0f":["1f575-1f3fb",31,48,15],"1f575-1f3fc-200d-2642-fe0f":["1f575-1f3fc",31,49,15],"1f575-1f3fd-200d-2642-fe0f":["1f575-1f3fd",31,50,15],"1f575-1f3fe-200d-2642-fe0f":["1f575-1f3fe",31,51,15],"1f575-1f3ff-200d-2642-fe0f":["1f575-1f3ff",31,52,15],"1f645-200d-2640-fe0f":["1f645",34,16,15],"1f645-1f3fb-200d-2640-fe0f":["1f645-1f3fb",34,17,15],"1f645-1f3fc-200d-2640-fe0f":["1f645-1f3fc",34,18,15],"1f645-1f3fd-200d-2640-fe0f":["1f645-1f3fd",34,19,15],"1f645-1f3fe-200d-2640-fe0f":["1f645-1f3fe",34,20,15],"1f645-1f3ff-200d-2640-fe0f":["1f645-1f3ff",34,21,15],"1f646-200d-2640-fe0f":["1f646",34,34,15],"1f646-1f3fb-200d-2640-fe0f":["1f646-1f3fb",34,35,15],"1f646-1f3fc-200d-2640-fe0f":["1f646-1f3fc",34,36,15],"1f646-1f3fd-200d-2640-fe0f":["1f646-1f3fd",34,37,15],"1f646-1f3fe-200d-2640-fe0f":["1f646-1f3fe",34,38,15],"1f646-1f3ff-200d-2640-fe0f":["1f646-1f3ff",34,39,15],"1f647-200d-2642-fe0f":["1f647",34,52,15],"1f647-1f3fb-200d-2642-fe0f":["1f647-1f3fb",34,53,15],"1f647-1f3fc-200d-2642-fe0f":["1f647-1f3fc",34,54,15],"1f647-1f3fd-200d-2642-fe0f":["1f647-1f3fd",34,55,15],"1f647-1f3fe-200d-2642-fe0f":["1f647-1f3fe",34,56,15],"1f647-1f3ff-200d-2642-fe0f":["1f647-1f3ff",34,57,15],"1f64b-200d-2640-fe0f":["1f64b",35,13,15],"1f64b-1f3fb-200d-2640-fe0f":["1f64b-1f3fb",35,14,15],"1f64b-1f3fc-200d-2640-fe0f":["1f64b-1f3fc",35,15,15],"1f64b-1f3fd-200d-2640-fe0f":["1f64b-1f3fd",35,16,15],"1f64b-1f3fe-200d-2640-fe0f":["1f64b-1f3fe",35,17,15],"1f64b-1f3ff-200d-2640-fe0f":["1f64b-1f3ff",35,18,15],"1f64d-200d-2640-fe0f":["1f64d",35,37,15],"1f64d-1f3fb-200d-2640-fe0f":["1f64d-1f3fb",35,38,15],"1f64d-1f3fc-200d-2640-fe0f":["1f64d-1f3fc",35,39,15],"1f64d-1f3fd-200d-2640-fe0f":["1f64d-1f3fd",35,40,15],"1f64d-1f3fe-200d-2640-fe0f":["1f64d-1f3fe",35,41,15],"1f64d-1f3ff-200d-2640-fe0f":["1f64d-1f3ff",35,42,15],"1f64e-200d-2640-fe0f":["1f64e",35,55,15],"1f64e-1f3fb-200d-2640-fe0f":["1f64e-1f3fb",35,56,15],"1f64e-1f3fc-200d-2640-fe0f":["1f64e-1f3fc",35,57,15],"1f64e-1f3fd-200d-2640-fe0f":["1f64e-1f3fd",35,58,15],"1f64e-1f3fe-200d-2640-fe0f":["1f64e-1f3fe",35,59,15],"1f64e-1f3ff-200d-2640-fe0f":["1f64e-1f3ff",36,0,15],"1f6a3-200d-2642-fe0f":["1f6a3",36,54,15],"1f6a3-1f3fb-200d-2642-fe0f":["1f6a3-1f3fb",36,55,15],"1f6a3-1f3fc-200d-2642-fe0f":["1f6a3-1f3fc",36,56,15],"1f6a3-1f3fd-200d-2642-fe0f":["1f6a3-1f3fd",36,57,15],"1f6a3-1f3fe-200d-2642-fe0f":["1f6a3-1f3fe",36,58,15],"1f6a3-1f3ff-200d-2642-fe0f":["1f6a3-1f3ff",36,59,15],"1f6b4-200d-2642-fe0f":["1f6b4",37,28,15],"1f6b4-1f3fb-200d-2642-fe0f":["1f6b4-1f3fb",37,29,15],"1f6b4-1f3fc-200d-2642-fe0f":["1f6b4-1f3fc",37,30,15],"1f6b4-1f3fd-200d-2642-fe0f":["1f6b4-1f3fd",37,31,15],"1f6b4-1f3fe-200d-2642-fe0f":["1f6b4-1f3fe",37,32,15],"1f6b4-1f3ff-200d-2642-fe0f":["1f6b4-1f3ff",37,33,15],"1f6b5-200d-2642-fe0f":["1f6b5",37,46,15],"1f6b5-1f3fb-200d-2642-fe0f":["1f6b5-1f3fb",37,47,15],"1f6b5-1f3fc-200d-2642-fe0f":["1f6b5-1f3fc",37,48,15],"1f6b5-1f3fd-200d-2642-fe0f":["1f6b5-1f3fd",37,49,15],"1f6b5-1f3fe-200d-2642-fe0f":["1f6b5-1f3fe",37,50,15],"1f6b5-1f3ff-200d-2642-fe0f":["1f6b5-1f3ff",37,51,15],"1f6b6-200d-2642-fe0f":["1f6b6",38,4,15],"1f6b6-1f3fb-200d-2642-fe0f":["1f6b6-1f3fb",38,5,15],"1f6b6-1f3fc-200d-2642-fe0f":["1f6b6-1f3fc",38,6,15],"1f6b6-1f3fd-200d-2642-fe0f":["1f6b6-1f3fd",38,7,15],"1f6b6-1f3fe-200d-2642-fe0f":["1f6b6-1f3fe",38,8,15],"1f6b6-1f3ff-200d-2642-fe0f":["1f6b6-1f3ff",38,9,15],"1f9d6-200d-2642-fe0f":["1f9d6",51,18,15],"1f9d6-1f3fb-200d-2642-fe0f":["1f9d6-1f3fb",51,19,15],"1f9d6-1f3fc-200d-2642-fe0f":["1f9d6-1f3fc",51,20,15],"1f9d6-1f3fd-200d-2642-fe0f":["1f9d6-1f3fd",51,21,15],"1f9d6-1f3fe-200d-2642-fe0f":["1f9d6-1f3fe",51,22,15],"1f9d6-1f3ff-200d-2642-fe0f":["1f9d6-1f3ff",51,23,15],"1f9d7-200d-2640-fe0f":["1f9d7",51,36,15],"1f9d7-1f3fb-200d-2640-fe0f":["1f9d7-1f3fb",51,37,15],"1f9d7-1f3fc-200d-2640-fe0f":["1f9d7-1f3fc",51,38,15],"1f9d7-1f3fd-200d-2640-fe0f":["1f9d7-1f3fd",51,39,15],"1f9d7-1f3fe-200d-2640-fe0f":["1f9d7-1f3fe",51,40,15],"1f9d7-1f3ff-200d-2640-fe0f":["1f9d7-1f3ff",51,41,15],"1f9d8-200d-2640-fe0f":["1f9d8",51,54,15],"1f9d8-1f3fb-200d-2640-fe0f":["1f9d8-1f3fb",51,55,15],"1f9d8-1f3fc-200d-2640-fe0f":["1f9d8-1f3fc",51,56,15],"1f9d8-1f3fd-200d-2640-fe0f":["1f9d8-1f3fd",51,57,15],"1f9d8-1f3fe-200d-2640-fe0f":["1f9d8-1f3fe",51,58,15],"1f9d8-1f3ff-200d-2640-fe0f":["1f9d8-1f3ff",51,59,15],"1f9d9-200d-2640-fe0f":["1f9d9",52,12,15],"1f9d9-1f3fb-200d-2640-fe0f":["1f9d9-1f3fb",52,13,15],"1f9d9-1f3fc-200d-2640-fe0f":["1f9d9-1f3fc",52,14,15],"1f9d9-1f3fd-200d-2640-fe0f":["1f9d9-1f3fd",52,15,15],"1f9d9-1f3fe-200d-2640-fe0f":["1f9d9-1f3fe",52,16,15],"1f9d9-1f3ff-200d-2640-fe0f":["1f9d9-1f3ff",52,17,15],"1f9da-200d-2640-fe0f":["1f9da",52,30,15],"1f9da-1f3fb-200d-2640-fe0f":["1f9da-1f3fb",52,31,15],"1f9da-1f3fc-200d-2640-fe0f":["1f9da-1f3fc",52,32,15],"1f9da-1f3fd-200d-2640-fe0f":["1f9da-1f3fd",52,33,15],"1f9da-1f3fe-200d-2640-fe0f":["1f9da-1f3fe",52,34,15],"1f9da-1f3ff-200d-2640-fe0f":["1f9da-1f3ff",52,35,15],"1f9db-200d-2640-fe0f":["1f9db",52,48,15],"1f9db-1f3fb-200d-2640-fe0f":["1f9db-1f3fb",52,49,15],"1f9db-1f3fc-200d-2640-fe0f":["1f9db-1f3fc",52,50,15],"1f9db-1f3fd-200d-2640-fe0f":["1f9db-1f3fd",52,51,15],"1f9db-1f3fe-200d-2640-fe0f":["1f9db-1f3fe",52,52,15],"1f9db-1f3ff-200d-2640-fe0f":["1f9db-1f3ff",52,53,15],"1f9dc-200d-2642-fe0f":["1f9dc",53,6,15],"1f9dc-1f3fb-200d-2642-fe0f":["1f9dc-1f3fb",53,7,15],"1f9dc-1f3fc-200d-2642-fe0f":["1f9dc-1f3fc",53,8,15],"1f9dc-1f3fd-200d-2642-fe0f":["1f9dc-1f3fd",53,9,15],"1f9dc-1f3fe-200d-2642-fe0f":["1f9dc-1f3fe",53,10,15],"1f9dc-1f3ff-200d-2642-fe0f":["1f9dc-1f3ff",53,11,15],"1f9dd-200d-2642-fe0f":["1f9dd",53,24,15],"1f9dd-1f3fb-200d-2642-fe0f":["1f9dd-1f3fb",53,25,15],"1f9dd-1f3fc-200d-2642-fe0f":["1f9dd-1f3fc",53,26,15],"1f9dd-1f3fd-200d-2642-fe0f":["1f9dd-1f3fd",53,27,15],"1f9dd-1f3fe-200d-2642-fe0f":["1f9dd-1f3fe",53,28,15],"1f9dd-1f3ff-200d-2642-fe0f":["1f9dd-1f3ff",53,29,15],"1f9de-200d-2642-fe0f":["1f9de",53,32,15],"1f9df-200d-2642-fe0f":["1f9df",53,35,15],"26f9-fe0f-200d-2642-fe0f":["26f9-fe0f",57,21,15],"26f9-1f3fb-200d-2642-fe0f":["26f9-1f3fb",57,22,15],"26f9-1f3fc-200d-2642-fe0f":["26f9-1f3fc",57,23,15],"26f9-1f3fd-200d-2642-fe0f":["26f9-1f3fd",57,24,15],"26f9-1f3fe-200d-2642-fe0f":["26f9-1f3fe",57,25,15],"26f9-1f3ff-200d-2642-fe0f":["26f9-1f3ff",57,26,15]};{if(e.exports){t=e.exports=n}t.EmojiConvertor=n}}).call(function(){return this||(typeof window!=="undefined"?window:Fl)}())})(Ld,Ld.exports);var kd=Ld.exports;const Fd=Ul(kd);const Ud=[{name:"People",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},{name:"Nature",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},{name:"Objects",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},{name:"Places",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},{name:"Symbols",emojis:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]}];const jd='.sc-emoji-picker[data-v-16d149a6]{position:absolute;bottom:50px;right:0;width:330px;max-height:215px;box-shadow:0 7px 40px 2px #9495964d;background:white;border-radius:10px;outline:none}.sc-emoji-picker[data-v-16d149a6]:after{content:"";width:14px;height:14px;background:white;position:absolute;bottom:-6px;right:55px;transform:rotate(45deg);border-radius:2px}.sc-emoji-picker--content[data-v-16d149a6]{padding:10px;overflow:auto;width:100%;max-height:195px;margin-top:7px;box-sizing:border-box}.sc-emoji-picker--category[data-v-16d149a6]{display:flex;flex-direction:row;flex-wrap:wrap}.sc-emoji-picker--category-title[data-v-16d149a6]{min-width:100%;color:#b8c3ca;font-weight:200;font-size:13px;margin:5px;letter-spacing:1px}.sc-emoji-picker--emoji[data-v-16d149a6]{margin:5px;width:30px;line-height:30px;text-align:center;cursor:pointer;vertical-align:middle;font-size:28px;transition:transform 60ms ease-out}.sc-emoji-picker--emoji[data-v-16d149a6]:hover{transform:scale(1.4)}\n';const Wd={props:{onBlur:{type:Function,required:true},onEmojiPicked:{type:Function,required:true}},data(){return{emojiData:Ud,emojiConvertor:new Fd}},mounted(){const e=this.$refs.domNode;e.style.opacity=0;window.requestAnimationFrame((()=>{e.style.transition="opacity 350ms";e.style.opacity=1}));this.$refs.domNode.focus();this.emojiConvertor.init_env()},methods:{emojiClicked(e){this.onEmojiPicked(e);this.$refs.domNode.blur()}}};const Bd={class:"sc-emoji-picker--content"};const Hd={class:"sc-emoji-picker--category-title"};const Vd=["onClick"];function Yd(e,t,i,r,n,s){return Es(),Ms("div",{ref:"domNode",tabIndex:"0",class:"sc-emoji-picker",onBlur:t[0]||(t[0]=(...e)=>i.onBlur&&i.onBlur(...e))},[Fs("div",Bd,[(Es(true),Ms(Ss,null,Qr(n.emojiData,(e=>(Es(),Ms("div",{key:e.name,class:"sc-emoji-picker--category"},[Fs("div",Hd,X(e.name),1),(Es(true),Ms(Ss,null,Qr(e.emojis,(e=>(Es(),Ms("span",{key:e,class:"sc-emoji-picker--emoji",onClick:t=>s.emojiClicked(e)},X(e),9,Vd)))),128))])))),128))])],544)}const Gd=ya(Wd,[["render",Yd],["styles",[jd]],["__scopeId","data-v-16d149a6"]]);const $d=".sc-user-input--emoji-icon-wrapper[data-v-abd694bf]{background:none;border:none;padding:0;margin:0;outline:none}.sc-user-input--emoji-icon-wrapper[data-v-abd694bf]:focus{outline:none}.sc-user-input--emoji-icon[data-v-abd694bf]{height:18px;cursor:pointer;align-self:center}.sc-user-input--emoji-icon-wrapper:focus .sc-user-input--emoji-icon path[data-v-abd694bf],.sc-user-input--emoji-icon-wrapper:focus .sc-user-input--emoji-icon circle[data-v-abd694bf],.sc-user-input--emoji-icon.active path[data-v-abd694bf],.sc-user-input--emoji-icon.active circle[data-v-abd694bf],.sc-user-input--emoji-icon:hover path[data-v-abd694bf],.sc-user-input--emoji-icon:hover circle[data-v-abd694bf]{filter:contrast(15%)}\n";const zd={components:{EmojiPicker:Gd},props:{onEmojiPicked:{type:Function,required:true},color:{type:String,required:true}},data(){return{isActive:false}},methods:{_openPicker(e){this.isActive=!this.isActive},_handlePickerBlur(){this.isActive=false}}};const Jd={class:"sc-user-input--picker-wrapper"};function qd(e,t,i,r,n,s){const o=Jr("EmojiPicker");return Es(),Ms("div",Jd,[n.isActive?(Es(),Ds(o,{key:0,"on-emoji-picked":i.onEmojiPicked,"on-blur":s._handlePickerBlur},null,8,["on-emoji-picked","on-blur"])):Ys("",true),Fs("button",{class:"sc-user-input--emoji-icon-wrapper",onClick:t[0]||(t[0]=da(((...e)=>s._openPicker&&s._openPicker(...e)),["prevent"]))},[(Es(),Ms("svg",{id:"Layer_2",class:z(["sc-user-input--emoji-icon",{active:n.isActive}]),version:"1.1",xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"37.393px",height:"37.393px",viewBox:"0 0 37.393 37.393",enableBackground:"new 0 0 37.393 37.393"},[Fs("g",null,[Fs("path",{style:B({fill:i.color}),d:"M18.696,37.393C8.387,37.393,0,29.006,0,18.696C0,8.387,8.387,0,18.696,0c10.31,0,18.696,8.387,18.696,18.696\n              C37.393,29.006,29.006,37.393,18.696,37.393z M18.696,2C9.49,2,2,9.49,2,18.696c0,9.206,7.49,16.696,16.696,16.696\n              c9.206,0,16.696-7.49,16.696-16.696C35.393,9.49,27.902,2,18.696,2z"},null,4)]),Fs("g",null,[Fs("circle",{cx:"12.379",cy:"14.359",r:"1.938",style:B({fill:i.color})},null,4)]),Fs("g",null,[Fs("circle",{cx:"24.371",cy:"14.414",r:"1.992",style:B({fill:i.color})},null,4)]),Fs("g",null,[Fs("path",{style:B({fill:i.color}),d:"M18.035,27.453c-5.748,0-8.342-4.18-8.449-4.357c-0.286-0.473-0.135-1.087,0.338-1.373\n              c0.471-0.286,1.084-0.136,1.372,0.335c0.094,0.151,2.161,3.396,6.74,3.396c4.713,0,7.518-3.462,7.545-3.497\n              c0.343-0.432,0.973-0.504,1.405-0.161c0.433,0.344,0.505,0.973,0.161,1.405C27.009,23.374,23.703,27.453,18.035,27.453z"},null,4)])],2))])])}const Kd=ya(zd,[["render",qd],["styles",[$d]],["__scopeId","data-v-abd694bf"]]);const Xd="#file-input[data-v-2d80dd5f]{cursor:pointer}.sc-user-input--file-icon-wrapper[data-v-2d80dd5f]{background:none;border:none;padding:0;margin:0;outline:none;cursor:pointer}.sc-user-input--file-icon[data-v-2d80dd5f]{height:20px;width:20px;align-self:center;outline:none}.sc-user-input--file-icon:hover path[data-v-2d80dd5f]{filter:contrast(15%)}\n";const Qd={props:{onChange:{type:Function,required:true},color:{type:String,required:true}},methods:{_handleClick(e){e.target.value=null},_handleChange(e){this.onChange(e.target.files[0])}}};const Zd={style:{position:"relative"}};const eu={class:"sc-user-input--file-icon-wrapper",type:"button"};const tu={version:"1.1",xmlns:"http://www.w3.org/2000/svg",class:"sc-user-input--file-icon",x:"0px",y:"0px",width:"24px",height:"24px",viewBox:"0 0 37.393 37.393",enableBackground:"new 0 0 37.393 37.393"};function iu(e,t,i,r,n,s){return Es(),Ms("div",Zd,[Fs("button",eu,[(Es(),Ms("svg",tu,[Fs("path",{style:B({fill:i.color}),d:"M20.807 10.22l-2.030-2.029-10.15 10.148c-1.682 1.681-1.682 4.408 0 6.089s4.408 1.681 6.090 0l12.18-12.178c2.804-2.802 2.804-7.346 0-10.148-2.802-2.803-7.347-2.803-10.149 0l-12.788 12.787c-0.009 0.009-0.019 0.018-0.027 0.026-3.909 3.909-3.909 10.245 0 14.153 3.908 3.908 10.246 3.908 14.156 0 0.009-0.009 0.016-0.018 0.026-0.027l0.001 0.001 8.729-8.728-2.031-2.029-8.729 8.727c-0.009 0.008-0.018 0.018-0.026 0.026-2.784 2.783-7.312 2.783-10.096 0-2.783-2.783-2.783-7.31 0-10.093 0.010-0.009 0.019-0.018 0.028-0.026l-0.001-0.002 12.79-12.786c1.678-1.679 4.411-1.679 6.090 0s1.678 4.411 0 6.089l-12.18 12.178c-0.56 0.56-1.47 0.56-2.030 0-0.559-0.559-0.559-1.47 0-2.029l10.15-10.149z"},null,4)])),Fs("input",{id:"file-input",type:"file",onChange:t[0]||(t[0]=(...e)=>s._handleChange&&s._handleChange(...e)),onClick:t[1]||(t[1]=(...e)=>s._handleClick&&s._handleClick(...e))},null,32)])])}const ru=ya(Qd,[["render",iu],["styles",[Xd]],["__scopeId","data-v-2d80dd5f"]]);const nu=".sc-user-input--button-icon-wrapper[data-v-cc2029c1]{background:none;border:none;padding:0;margin:0;outline:none;cursor:pointer}\n";const su={components:{IconBase:Oa},props:{color:{type:String,required:true},tooltip:{type:String,default:""}}};const ou={class:"sc-user-input--button-icon-wrapper"};function au(e,t,i,r,n,s){const o=Jr("IconBase");return Es(),Ms("button",ou,[Us(o,{color:i.color,width:"20",height:"20","icon-name":i.tooltip},{default:or((()=>[Zr(e.$slots,"default",{},void 0,true)])),_:3},8,["color","icon-name"])])}const cu=ya(su,[["render",au],["styles",[nu]],["__scopeId","data-v-cc2029c1"]]);const lu=".sc-suggestions-row{text-align:center;background:inherit}.sc-suggestions-element{margin:3px;padding:5px 10px;border:1px solid;border-radius:15px;font-size:14px;background:inherit;cursor:pointer}\n";const du={props:{suggestions:{type:Array,default:()=>[]},colors:{type:Object,required:true}},data(){return{}}};const uu=["onClick"];function hu(e,t,i,r,n,s){return Es(),Ms("div",{class:"sc-suggestions-row",style:B({background:i.colors.messageList.bg})},[(Es(true),Ms(Ss,null,Qr(i.suggestions,((t,r)=>(Es(),Ms("button",{key:r,class:"sc-suggestions-element",style:B({borderColor:i.colors.sentMessage.bg,color:i.colors.sentMessage.bg}),onClick:i=>e.$emit("sendSuggestion",t)},X(t),13,uu)))),128))],4)}const fu=ya(du,[["render",hu],["styles",[lu]]]);const pu="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTguMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgNTYgNTYiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDU2IDU2OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxnIGlkPSJzdmdfMSI+CiAgIDxwYXRoIGlkPSJzdmdfMiIgZmlsbD0iI0U5RTlFMCIgZD0ibTM2Ljk4NSwwbC0yOS4wMjIsMGMtMC44MDgsMCAtMS40NjMsMC42NTUgLTEuNDYzLDEuOTI2bDAsNTMuMDc0YzAsMC4zNDUgMC42NTUsMSAxLjQ2MywxbDQwLjA3NCwwYzAuODA4LDAgMS40NjMsLTAuNjU1IDEuNDYzLC0xbDAsLTQyLjAyMmMwLC0wLjY5NiAtMC4wOTMsLTAuOTIgLTAuMjU3LC0xLjA4NWwtMTEuNjM2LC0xMS42MzZjLTAuMTY1LC0wLjE2NCAtMC4zODksLTAuMjU3IC0wLjYyMiwtMC4yNTd6Ii8+CiAgIDxwb2x5Z29uIGlkPSJzdmdfMyIgZmlsbD0iI0Q5RDdDQSIgcG9pbnRzPSIzNy41LDAuMTUxIDM3LjUsMTIgNDkuMzQ5LDEyICAiLz4KICAgPHBhdGggaWQ9InN2Z180IiBmaWxsPSIjOTVBNUE1IiBkPSJtNDguMDM3LDU2bC00MC4wNzQsMGMtMC44MDgsMCAtMS40NjMsLTAuNjU1IC0xLjQ2MywtMS40NjNsMCwtMTUuNTM3bDQzLDBsMCwxNS41MzdjMCwwLjgwOCAtMC42NTUsMS40NjMgLTEuNDYzLDEuNDYzeiIvPgogICA8cGF0aCBpZD0ic3ZnXzkiIGZpbGw9IiNDOEJEQjgiIGQ9Im0xOC41LDEzbC02LDBjLTAuNTUzLDAgLTEsLTAuNDQ4IC0xLC0xczAuNDQ3LC0xIDEsLTFsNiwwYzAuNTUzLDAgMSwwLjQ0OCAxLDFzLTAuNDQ3LDEgLTEsMXoiLz4KICAgPHBhdGggaWQ9InN2Z18xMCIgZmlsbD0iI0M4QkRCOCIgZD0ibTIxLjUsMThsLTksMGMtMC41NTMsMCAtMSwtMC40NDggLTEsLTFzMC40NDcsLTEgMSwtMWw5LDBjMC41NTMsMCAxLDAuNDQ4IDEsMXMtMC40NDcsMSAtMSwxeiIvPgogICA8cGF0aCBpZD0ic3ZnXzExIiBmaWxsPSIjQzhCREI4IiBkPSJtMjUuNSwxOGMtMC4yNiwwIC0wLjUyMSwtMC4xMSAtMC43MSwtMC4yOWMtMC4xODEsLTAuMTkgLTAuMjksLTAuNDQgLTAuMjksLTAuNzFzMC4xMDksLTAuNTIgMC4zLC0wLjcxYzAuMzYsLTAuMzcgMS4wNCwtMC4zNyAxLjQxLDBjMC4xOCwwLjE5IDAuMjksMC40NSAwLjI5LDAuNzFjMCwwLjI2IC0wLjExLDAuNTIgLTAuMjksMC43MWMtMC4xOSwwLjE4IC0wLjQ1LDAuMjkgLTAuNzEsMC4yOXoiLz4KICAgPHBhdGggaWQ9InN2Z18xMiIgZmlsbD0iI0M4QkRCOCIgZD0ibTM3LjUsMThsLTgsMGMtMC41NTMsMCAtMSwtMC40NDggLTEsLTFzMC40NDcsLTEgMSwtMWw4LDBjMC41NTMsMCAxLDAuNDQ4IDEsMXMtMC40NDcsMSAtMSwxeiIvPgogICA8cGF0aCBpZD0ic3ZnXzEzIiBmaWxsPSIjQzhCREI4IiBkPSJtMTIuNSwzM2MtMC4yNiwwIC0wLjUyMSwtMC4xMSAtMC43MSwtMC4yOWMtMC4xODEsLTAuMTkgLTAuMjksLTAuNDUgLTAuMjksLTAuNzFjMCwtMC4yNiAwLjEwOSwtMC41MiAwLjI5LC0wLjcxYzAuMzcsLTAuMzcgMS4wNSwtMC4zNyAxLjQyLDAuMDFjMC4xOCwwLjE4IDAuMjksMC40NCAwLjI5LDAuN2MwLDAuMjYgLTAuMTEsMC41MiAtMC4yOSwwLjcxYy0wLjE5LDAuMTggLTAuNDUsMC4yOSAtMC43MSwwLjI5eiIvPgogICA8cGF0aCBpZD0ic3ZnXzE0IiBmaWxsPSIjQzhCREI4IiBkPSJtMjQuNSwzM2wtOCwwYy0wLjU1MywwIC0xLC0wLjQ0OCAtMSwtMXMwLjQ0NywtMSAxLC0xbDgsMGMwLjU1MywwIDEsMC40NDggMSwxcy0wLjQ0NywxIC0xLDF6Ii8+CiAgIDxwYXRoIGlkPSJzdmdfMTUiIGZpbGw9IiNDOEJEQjgiIGQ9Im00My41LDE4bC0yLDBjLTAuNTUzLDAgLTEsLTAuNDQ4IC0xLC0xczAuNDQ3LC0xIDEsLTFsMiwwYzAuNTUzLDAgMSwwLjQ0OCAxLDFzLTAuNDQ3LDEgLTEsMXoiLz4KICAgPHBhdGggaWQ9InN2Z18xNiIgZmlsbD0iI0M4QkRCOCIgZD0ibTM0LjUsMjNsLTIyLDBjLTAuNTUzLDAgLTEsLTAuNDQ4IC0xLC0xczAuNDQ3LC0xIDEsLTFsMjIsMGMwLjU1MywwIDEsMC40NDggMSwxcy0wLjQ0NywxIC0xLDF6Ii8+CiAgIDxwYXRoIGlkPSJzdmdfMTciIGZpbGw9IiNDOEJEQjgiIGQ9Im00My41LDIzbC02LDBjLTAuNTUzLDAgLTEsLTAuNDQ4IC0xLC0xczAuNDQ3LC0xIDEsLTFsNiwwYzAuNTUzLDAgMSwwLjQ0OCAxLDFzLTAuNDQ3LDEgLTEsMXoiLz4KICAgPHBhdGggaWQ9InN2Z18xOCIgZmlsbD0iI0M4QkRCOCIgZD0ibTE2LjUsMjhsLTQsMGMtMC41NTMsMCAtMSwtMC40NDggLTEsLTFzMC40NDcsLTEgMSwtMWw0LDBjMC41NTMsMCAxLDAuNDQ4IDEsMXMtMC40NDcsMSAtMSwxeiIvPgogICA8cGF0aCBpZD0ic3ZnXzE5IiBmaWxsPSIjQzhCREI4IiBkPSJtMzAuNSwyOGwtMTAsMGMtMC41NTMsMCAtMSwtMC40NDggLTEsLTFzMC40NDcsLTEgMSwtMWwxMCwwYzAuNTUzLDAgMSwwLjQ0OCAxLDFzLTAuNDQ3LDEgLTEsMXoiLz4KICAgPHBhdGggaWQ9InN2Z18yMCIgZmlsbD0iI0M4QkRCOCIgZD0ibTQzLjUsMjhsLTksMGMtMC41NTMsMCAtMSwtMC40NDggLTEsLTFzMC40NDcsLTEgMSwtMWw5LDBjMC41NTMsMCAxLDAuNDQ4IDEsMXMtMC40NDcsMSAtMSwxeiIvPgogIDwvZz4KICA8ZyBpZD0ic3ZnXzIxIi8+CiAgPGcgaWQ9InN2Z18yMiIvPgogIDxnIGlkPSJzdmdfMjMiLz4KICA8ZyBpZD0ic3ZnXzI0Ii8+CiAgPGcgaWQ9InN2Z18yNSIvPgogIDxnIGlkPSJzdmdfMjYiLz4KICA8ZyBpZD0ic3ZnXzI3Ii8+CiAgPGcgaWQ9InN2Z18yOCIvPgogIDxnIGlkPSJzdmdfMjkiLz4KICA8ZyBpZD0ic3ZnXzMwIi8+CiAgPGcgaWQ9InN2Z18zMSIvPgogIDxnIGlkPSJzdmdfMzIiLz4KICA8ZyBpZD0ic3ZnXzMzIi8+CiAgPGcgaWQ9InN2Z18zNCIvPgogIDxnIGlkPSJzdmdfMzUiLz4KPC9zdmc+";const gu="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgNDcuOTcxIDQ3Ljk3MSIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNDcuOTcxIDQ3Ljk3MTsiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8Zz4KCTxwYXRoIGQ9Ik0yOC4yMjgsMjMuOTg2TDQ3LjA5Miw1LjEyMmMxLjE3Mi0xLjE3MSwxLjE3Mi0zLjA3MSwwLTQuMjQyYy0xLjE3Mi0xLjE3Mi0zLjA3LTEuMTcyLTQuMjQyLDBMMjMuOTg2LDE5Ljc0NEw1LjEyMSwwLjg4CgkJYy0xLjE3Mi0xLjE3Mi0zLjA3LTEuMTcyLTQuMjQyLDBjLTEuMTcyLDEuMTcxLTEuMTcyLDMuMDcxLDAsNC4yNDJsMTguODY1LDE4Ljg2NEwwLjg3OSw0Mi44NWMtMS4xNzIsMS4xNzEtMS4xNzIsMy4wNzEsMCw0LjI0MgoJCUMxLjQ2NSw0Ny42NzcsMi4yMzMsNDcuOTcsMyw0Ny45N3MxLjUzNS0wLjI5MywyLjEyMS0wLjg3OWwxOC44NjUtMTguODY0TDQyLjg1LDQ3LjA5MWMwLjU4NiwwLjU4NiwxLjM1NCwwLjg3OSwyLjEyMSwwLjg3OQoJCXMxLjUzNS0wLjI5MywyLjEyMS0wLjg3OWMxLjE3Mi0xLjE3MSwxLjE3Mi0zLjA3MSwwLTQuMjQyTDI4LjIyOCwyMy45ODZ6Ii8+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+";const mu={};const vu={d:"M7.629,14.566c0.125,0.125,0.291,0.188,0.456,0.188c0.164,0,0.329-0.062,0.456-0.188l8.219-8.221c0.252-0.252,0.252-0.659,0-0.911c-0.252-0.252-0.659-0.252-0.911,0l-7.764,7.763L4.152,9.267c-0.252-0.251-0.66-0.251-0.911,0c-0.252,0.252-0.252,0.66,0,0.911L7.629,14.566z"};function Su(e,t){return Es(),Ms("path",vu)}const bu=ya(mu,[["render",Su]]);const yu={};const Cu={d:"M17.218,2.268L2.477,8.388C2.13,8.535,2.164,9.05,2.542,9.134L9.33,10.67l1.535,6.787c0.083,0.377,0.602,0.415,0.745,0.065l6.123-14.74C17.866,2.46,17.539,2.134,17.218,2.268 M3.92,8.641l11.772-4.89L9.535,9.909L3.92,8.641z M11.358,16.078l-1.268-5.613l6.157-6.157L11.358,16.078z"};function wu(e,t){return Es(),Ms("path",Cu)}const _u=ya(yu,[["render",wu]]);const Eu=".sc-user-input{min-height:55px;margin:0;position:relative;bottom:0;display:flex;background-color:#f4f7f9;border-bottom-left-radius:10px;border-bottom-right-radius:10px;transition:background-color .2s ease,box-shadow .2s ease}.sc-user-input--text{width:300px;resize:none;border:none;outline:none;border-bottom-left-radius:10px;box-sizing:border-box;padding:18px;font-size:15px;font-weight:400;line-height:1.33;white-space:pre-wrap;word-wrap:break-word;color:#565867;-webkit-font-smoothing:antialiased;max-height:200px;overflow:scroll;bottom:0;overflow-x:hidden;overflow-y:auto}.sc-user-input--text:empty:before{content:attr(placeholder);display:block;filter:contrast(15%);outline:none;cursor:text}.sc-user-input--buttons{width:100px;position:absolute;right:30px;height:100%;display:flex;justify-content:flex-end}.sc-user-input--button:first-of-type{width:40px}.sc-user-input--button{width:30px;height:55px;margin-left:2px;margin-right:2px;display:flex;flex-direction:column;justify-content:center}.sc-user-input.active{box-shadow:none;background-color:#fff;box-shadow:0 -5px 20px #96a5be33}.sc-user-input--button label{position:relative;height:24px;padding-left:3px;cursor:pointer}.sc-user-input--button label:hover path{fill:#565867}.sc-user-input--button input{position:absolute;left:0;top:0;width:100%;z-index:99999;height:100%;opacity:0;cursor:pointer;overflow:hidden}.file-container{background-color:#f4f7f9;border-top-left-radius:10px;padding:5px 20px;color:#565867}.delete-file-message{font-style:normal;float:right;cursor:pointer;color:#c8cad0}.delete-file-message:hover{color:#5d5e6d}.icon-file-message{margin-right:5px}\n";const Tu={components:{EmojiIcon:Kd,FileIcons:ru,UserInputButton:cu,Suggestions:fu,IconCross:Wa,IconOk:bu,IconSend:_u},props:{icons:{type:Object,default:function(){return{file:{img:pu,name:"default"},closeSvg:{img:gu,name:"default"}}}},showEmoji:{type:Boolean,default:()=>true},showEmojiInText:{type:Boolean,default:()=>true},suggestions:{type:Array,default:()=>[]},showFile:{type:Boolean,default:()=>false},onSubmit:{type:Function,required:true},placeholder:{type:String,default:"Write something..."},colors:{type:Object,required:true}},data(){return{file:null,inputActive:false,prevSelectionRange:null}},computed:{editMessageId(){return this.isEditing&&ma.state.editMessage.id},isEditing(){return ma.state.editMessage&&ma.state.editMessage.id}},watch:{editMessageId(e){if(ma.state.editMessage!=null&&ma.state.editMessage!=void 0){this.$refs.userInput.focus();this.$refs.userInput.textContent=ma.state.editMessage.data.text}else{this.$refs.userInput.textContent=""}}},mounted(){document.addEventListener("selectionchange",(()=>{const e=document.getSelection();if(!e||!e.anchorNode||e.anchorNode!=this.$refs.userInput&&e.anchorNode.parentNode!=this.$refs.userInput){return}if(e.rangeCount){this.prevSelectionRange=e.getRangeAt(0).cloneRange()}else{this.prevSelectionRange=null}}))},methods:{cancelFile(){this.file=null},setInputActive(e){this.inputActive=e},handleKey(e){if(e.keyCode===13&&!e.shiftKey){if(!this.isEditing){this._submitText(e)}else{this._editText(e)}this._editFinish();e.preventDefault()}else if(e.keyCode===27){this._editFinish();e.preventDefault()}},handleInput(e){this.$emit("onType",e.target.textContent)},focusUserInput(){this.$nextTick((()=>{this.$refs.userInput.focus()}))},_submitSuggestion(e){this.onSubmit({author:"me",type:"text",data:{text:e}})},_checkSubmitSuccess(e){if(Promise!==void 0){Promise.resolve(e).then(function(e){if(e===void 0||e){this.file=null;this.$refs.userInput.innerHTML=""}}.bind(this))}else{this.file=null;this.$refs.userInput.innerHTML=""}},_submitText(e){const t=this.$refs.userInput.textContent;const i=this.file;if(i){this._submitTextWhenFile(e,t,i)}else{if(t&&t.length>0){this._checkSubmitSuccess(this.onSubmit({author:"me",type:"text",data:{text:t}}))}}},_submitTextWhenFile(e,t,i){if(t&&t.length>0){this._checkSubmitSuccess(this.onSubmit({author:"me",type:"file",data:{text:t,file:i}}))}else{this._checkSubmitSuccess(this.onSubmit({author:"me",type:"file",data:{file:i}}))}},_editText(e){const t=this.$refs.userInput.textContent;if(t&&t.length){this.$emit("edit",{author:"me",type:"text",id:ma.state.editMessage.id,data:{text:t}});this._editFinish()}},_handleEmojiPicked(e){if(this.showEmojiInText){this._addToTextEmoji(e)}else{this._submitEmoji(e)}},_submitEmoji(e){this._checkSubmitSuccess(this.onSubmit({author:"me",type:"emoji",data:{emoji:e}}))},_addToTextEmoji(e){let t=this.prevSelectionRange;if(!t){if(!this.$refs.userInput.firstChild){this.$refs.userInput.append(document.createTextNode(""))}t=document.createRange();t.setStart(this.$refs.userInput.firstChild,this.$refs.userInput.textContent.length);t.collapse(true)}let i=window.getSelection();i.removeAllRanges();i.addRange(t);let r=document.createTextNode(e);t.deleteContents();t.insertNode(r);t.collapse(false);this.$refs.userInput.focus()},_handleFileSubmit(e){this.file=e},_editFinish(){ma.setState("editMessage",null)}}};const Iu={class:"icon-file-message"};const Pu=["src","alt"];const Au=["src","alt"];const Mu=["placeholder"];const Du={class:"sc-user-input--buttons"};const Ru=Fs("div",{class:"sc-user-input--button"},null,-1);const Ou={key:0,class:"sc-user-input--button"};const Nu={key:1,class:"sc-user-input--button"};const xu={key:2,class:"sc-user-input--button"};const Lu={class:"sc-user-input--button"};function ku(e,t,i,r,n,s){const o=Jr("Suggestions");const a=Jr("EmojiIcon");const c=Jr("FileIcons");const l=Jr("IconCross");const d=Jr("UserInputButton");const u=Jr("IconOk");const h=Jr("IconSend");return Es(),Ms("div",null,[Us(o,{suggestions:i.suggestions,colors:i.colors,onSendSuggestion:s._submitSuggestion},null,8,["suggestions","colors","onSendSuggestion"]),n.file?(Es(),Ms("div",{key:0,class:"file-container",style:B({backgroundColor:i.colors.userInput.text,color:i.colors.userInput.bg})},[Fs("span",Iu,[Fs("img",{src:i.icons.file.img,alt:i.icons.file.name,height:"15"},null,8,Pu)]),Vs(" "+X(n.file.name)+" ",1),Fs("span",{class:"delete-file-message",onClick:t[0]||(t[0]=e=>s.cancelFile())},[Fs("img",{src:i.icons.closeSvg.img,alt:i.icons.closeSvg.name,height:"10",title:"Remove the file"},null,8,Au)])],4)):Ys("",true),i.suggestions==null||i.suggestions.length==0?(Es(),Ms("form",{key:1,class:z(["sc-user-input",{active:n.inputActive}]),style:B({background:i.colors.userInput.bg})},[Fs("div",{ref:"userInput",role:"button",tabIndex:"0",contentEditable:"true",placeholder:i.placeholder,class:"sc-user-input--text",style:B({color:i.colors.userInput.text}),onFocus:t[1]||(t[1]=e=>s.setInputActive(true)),onBlur:t[2]||(t[2]=e=>s.setInputActive(false)),onKeydown:t[3]||(t[3]=(...e)=>s.handleKey&&s.handleKey(...e)),onInput:t[4]||(t[4]=(...e)=>s.handleInput&&s.handleInput(...e)),"on:focusUserInput":t[5]||(t[5]=e=>s.focusUserInput())},null,44,Mu),Fs("div",Du,[Ru,i.showEmoji&&!s.isEditing?(Es(),Ms("div",Ou,[Us(a,{"on-emoji-picked":s._handleEmojiPicked,color:i.colors.userInput.text},null,8,["on-emoji-picked","color"])])):Ys("",true),i.showFile&&!s.isEditing?(Es(),Ms("div",Nu,[Us(c,{"on-change":s._handleFileSubmit,color:i.colors.userInput.text},null,8,["on-change","color"])])):Ys("",true),s.isEditing?(Es(),Ms("div",xu,[Us(d,{color:i.colors.userInput.text,tooltip:"cancel",onClick:da(s._editFinish,["prevent"])},{default:or((()=>[Us(l)])),_:1},8,["color","onClick"])])):Ys("",true),Fs("div",Lu,[s.isEditing?(Es(),Ds(d,{key:0,color:i.colors.userInput.text,tooltip:"Edit",onClick:da(s._editText,["prevent"])},{default:or((()=>[Us(u)])),_:1},8,["color","onClick"])):(Es(),Ds(d,{key:1,color:i.colors.userInput.text,tooltip:"Send",onClick:da(s._submitText,["prevent"])},{default:or((()=>[Us(h)])),_:1},8,["color","onClick"]))])])],6)):Ys("",true)])}const Fu=ya(Tu,[["render",ku],["styles",[Eu]]]);const Uu=".sc-chat-window[data-v-523bff23]{width:370px;height:calc(100% - 120px);max-height:590px;position:fixed;right:25px;bottom:100px;box-sizing:border-box;box-shadow:0 7px 40px 2px #9495961a;background:white;display:flex;flex-direction:column;justify-content:space-between;border-radius:10px;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;animation:fadeIn-523bff23;animation-duration:.3s;animation-timing-function:ease-in-out}.sc-chat-window.closed[data-v-523bff23]{opacity:0;display:none;bottom:90px}@keyframes fadeIn-523bff23{0%{display:none;opacity:0}to{display:flex;opacity:1}}.sc-message--me[data-v-523bff23]{text-align:right}.sc-message--them[data-v-523bff23]{text-align:left}@media (max-width: 450px){.sc-chat-window[data-v-523bff23]{width:100%;height:100%;max-height:100%;right:0;bottom:0;border-radius:0}.sc-chat-window[data-v-523bff23]{transition:.1s ease-in-out}.sc-chat-window.closed[data-v-523bff23]{bottom:0}}.sc-header[data-v-523bff23]{min-height:75px;border-top-left-radius:9px;border-top-right-radius:9px;padding:10px;box-shadow:0 1px 4px #0003;position:relative;box-sizing:border-box;display:flex}.sc-header--img[data-v-523bff23]{border-radius:50%;align-self:center;padding:10px}.sc-header--title[data-v-523bff23]{align-self:center;padding:10px;flex:1;-webkit-user-select:none;user-select:none;font-size:20px}.sc-header--title.enabled[data-v-523bff23]{cursor:pointer;border-radius:5px}.sc-header--title.enabled[data-v-523bff23]:hover{box-shadow:0 2px 5px #0000011a}.sc-header--close-button[data-v-523bff23]{width:40px;align-self:center;height:40px;margin-right:10px;box-sizing:border-box;cursor:pointer;border-radius:5px;margin-left:auto}.sc-header--close-button[data-v-523bff23]:hover{box-shadow:0 2px 5px #0000011a}.sc-header--close-button img[data-v-523bff23]{width:100%;height:100%;padding:13px;box-sizing:border-box}@media (max-width: 450px){.sc-header[data-v-523bff23]{border-radius:0}}\n";const ju={components:{Header:Ta,MessageList:xd,UserInput:Fu},props:{showEmoji:{type:Boolean,default:false},showEmojiInText:{type:Boolean,default:false},showFile:{type:Boolean,default:false},showHeader:{type:Boolean,default:true},onUserInputSubmit:{type:Function,required:true},onUserInitiateCall:{type:Function,required:true},onUserReleaseCall:{type:Function,required:true},isCallAuthorized:{type:Boolean,required:true},isCallEstablished:{type:Boolean,required:true},messageList:{type:Array,default:()=>[]},isOpen:{type:Boolean,default:()=>false},placeholder:{type:String,required:true},colors:{type:Object,required:true},alwaysScrollToBottom:{type:Boolean,required:true}},data(){return{}},computed:{messages(){let e=this.messageList;return e}},methods:{getSuggestions(){return this.messages.length>0?this.messages[this.messages.length-1].suggestions:[]}}};function Wu(e,t,i,r,n,s){const o=Jr("Header");const a=Jr("MessageList");const c=Jr("UserInput");return Es(),Ms("div",{class:z(["sc-chat-window",{opened:i.isOpen,closed:!i.isOpen}])},[i.showHeader?(Es(),Ds(o,{key:0,"on-user-initiate-call":i.onUserInitiateCall,"on-user-release-call":i.onUserReleaseCall,isCallAuthorized:i.isCallAuthorized,"is-call-established":i.isCallEstablished,colors:i.colors,onClose:t[0]||(t[0]=t=>e.$emit("close"))},{default:or((()=>[Zr(e.$slots,"header",{},void 0,true)])),_:3},8,["on-user-initiate-call","on-user-release-call","isCallAuthorized","is-call-established","colors"])):Ys("",true),Us(a,{messages:s.messages,colors:i.colors,"always-scroll-to-bottom":i.alwaysScrollToBottom,onScrollToTop:t[1]||(t[1]=t=>e.$emit("scrollToTop"))},{"user-avatar":or((t=>[Zr(e.$slots,"user-avatar",{user:t.user,message:t.message},void 0,true)])),"text-message-body":or((t=>[Zr(e.$slots,"text-message-body",{message:t.message,messageText:t.messageText,messageColors:t.messageColors,me:t.me},void 0,true)])),"system-message-body":or((t=>[Zr(e.$slots,"system-message-body",{message:t.message},void 0,true)])),"text-message-toolbox":or((t=>[Zr(e.$slots,"text-message-toolbox",{message:t.message,me:t.me},void 0,true)])),_:3},8,["messages","colors","always-scroll-to-bottom"]),Us(c,{"on-submit":i.onUserInputSubmit,suggestions:s.getSuggestions(),"show-file":i.showFile,placeholder:i.placeholder,colors:i.colors,onOnType:t[2]||(t[2]=t=>e.$emit("onType",e.event)),onEdit:t[3]||(t[3]=t=>e.$emit("edit",e.event))},null,8,["on-submit","suggestions","show-file","placeholder","colors"])],2)}const Bu=ya(ju,[["render",Wu],["styles",[Uu]],["__scopeId","data-v-523bff23"]]);const Hu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAMAAAANIilAAAAAAXNSR0IB2cksfwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAKVQTFRFAAAA////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////uP3jVQAAADd0Uk5TAE9lCAXd9XA4y/9zDQJG7HYB8Hc3yHoPQ8fuezMSoYPrEcEugj0tqb6G+Lw5ifHcKk3SIAx/MjRpS8YAAADsSURBVHic7dDJDoIwEIDhQURwQNGiIBVkUQH3BfX9H00MEvHW9qj9L3RIvkxTAJlMJvu1lI7aHtWOwm67Wk9vz3pP67Jro4+m1QyWiX2D3cJgqNmjt7ZGtjYccGAYK8R26qNjE2XMY6smU3Q9AM/F6YSTVrtnPp173pz6M969Lx1Q6rqUBgK2KvAR/UCIAoQLxEUoiCMSxyQSokmE6XKZYpQI2BVJ1wDrlKz4dXXn7PXN+G8e5lhk9TErMOd6tXCz3e2bYb/bbnj04Xg6f6bz6Xhgtxe8lu25vOKFGd/uj+8fj/uNfbVMJpP9QU/STxAzeUFqVwAAAABJRU5ErkJggg==";const Vu="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiPjxyZWN0IGlkPSJiYWNrZ3JvdW5kcmVjdCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgeD0iMCIgeT0iMCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJub25lIi8+PGRlZnM+PHN0eWxlPi5he2ZpbGw6bm9uZTt9LmJ7ZmlsbDojNGU4Y2ZmO30uY3tjbGlwLXBhdGg6dXJsKCNhKTt9LmR7ZmlsbDojZmZmO30uZXtmaWxsOiNlZmY0Zjk7fTwvc3R5bGU+PGNsaXBQYXRoIGlkPSJhIj48cGF0aCBjbGFzcz0iYSIgZD0iTSAwIDAgSCAxNy41NTUgdiAxNy41NTUgSCAwIFoiIGlkPSJzdmdfMSIgdHJhbnNmb3JtPSIiLz48L2NsaXBQYXRoPjwvZGVmcz48ZyBjbGFzcz0iY3VycmVudExheWVyIiBzdHlsZT0iIj48dGl0bGU+TGF5ZXIgMTwvdGl0bGU+PGcgaWQ9InN2Z18yIiBjbGFzcz0ic2VsZWN0ZWQiIHRyYW5zZm9ybT0iIj48ZyBpZD0ic3ZnXzMiIHRyYW5zZm9ybT0iIj48ZyBjbGFzcz0iYyIgaWQ9InN2Z180IiB0cmFuc2Zvcm09IiI+PGcgaWQ9InN2Z181IiB0cmFuc2Zvcm09IiI+PHBhdGggY2xhc3M9ImQiIGQ9Ik0gMTcuNTU2IDguNzc4NDIgYSA4Ljc3OCA4Ljc3OCAwIDAgMCAtOC43NzggLTguNzc4IGEgOC43NzggOC43NzggMCAwIDAgLTguNzc4IDguNzc4IGEgOC43NDUgOC43NDUgMCAwIDAgMi4yNiA1Ljg3OSB2IDEuNDQyIGMgMCAwLjggMC40OTIgMS40NTcgMS4xIDEuNDU3IGggNS44MyBhIDAuODQzIDAuODQzIDAgMCAwIDAuMTgzIC0wLjAyIGEgOC43NzggOC43NzggMCAwIDAgOC4xODQgLTguNzU3IiBpZD0ic3ZnXzYiIHRyYW5zZm9ybT0iIi8+PC9nPjxnIGlkPSJzdmdfNyIgdHJhbnNmb3JtPSIiPjxwYXRoIGNsYXNzPSJlIiBkPSJNIDMuMTYxNDggOC45MjEgYSA5LjI5MiA5LjI5MiAwIDAgMSA2LjM4IC04Ljg4OCBjIC0wLjI1MiAtMC4wMjIgLTAuNTA2IC0wLjAzMyAtMC43NjMgLTAuMDMzIGEgOC43NzQgOC43NzQgMCAwIDAgLTguNzc4IDguNzc4IEEgOS41MDggOS41MDggMCAwIDAgMi4yMjQ0NyAxNC43MDAzIGMgMC4wMDUgMCAwIDAuMDA5IDAgMC4wMSBjIC0wLjMxMSAwLjM1MiAtMS45MjQgMi44NDkgMC4wMjEgMi44NDkgaCAyLjI1IGMgLTEuMjMgLTAuMDIyIDEuMjYzIC0yLjEwNyAwLjI2OSAtMy40OTQgYSA4LjIyNSA4LjIyNSAwIDAgMSAtMS42IC01LjE0MSIgaWQ9InN2Z184IiB0cmFuc2Zvcm09IiIvPjwvZz48L2c+PC9nPjwvZz48L2c+PC9zdmc+";const Yu=Object.create(null);Yu["open"]="0";Yu["close"]="1";Yu["ping"]="2";Yu["pong"]="3";Yu["message"]="4";Yu["upgrade"]="5";Yu["noop"]="6";const Gu=Object.create(null);Object.keys(Yu).forEach((e=>{Gu[Yu[e]]=e}));const $u={type:"error",data:"parser error"};const zu=typeof Blob==="function"||typeof Blob!=="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]";const Ju=typeof ArrayBuffer==="function";const qu=e=>typeof ArrayBuffer.isView==="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer;const Ku=({type:e,data:t},i,r)=>{if(zu&&t instanceof Blob){if(i){return r(t)}else{return Xu(t,r)}}else if(Ju&&(t instanceof ArrayBuffer||qu(t))){if(i){return r(t)}else{return Xu(new Blob([t]),r)}}return r(Yu[e]+(t||""))};const Xu=(e,t)=>{const i=new FileReader;i.onload=function(){const e=i.result.split(",")[1];t("b"+(e||""))};return i.readAsDataURL(e)};function Qu(e){if(e instanceof Uint8Array){return e}else if(e instanceof ArrayBuffer){return new Uint8Array(e)}else{return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}}let Zu;function eh(e,t){if(zu&&e.data instanceof Blob){return e.data.arrayBuffer().then(Qu).then(t)}else if(Ju&&(e.data instanceof ArrayBuffer||qu(e.data))){return t(Qu(e.data))}Ku(e,false,(e=>{if(!Zu){Zu=new TextEncoder}t(Zu.encode(e))}))}const th="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";const ih=typeof Uint8Array==="undefined"?[]:new Uint8Array(256);for(let $=0;$<th.length;$++){ih[th.charCodeAt($)]=$}const rh=e=>{let t=e.length*.75,i=e.length,r,n=0,s,o,a,c;if(e[e.length-1]==="="){t--;if(e[e.length-2]==="="){t--}}const l=new ArrayBuffer(t),d=new Uint8Array(l);for(r=0;r<i;r+=4){s=ih[e.charCodeAt(r)];o=ih[e.charCodeAt(r+1)];a=ih[e.charCodeAt(r+2)];c=ih[e.charCodeAt(r+3)];d[n++]=s<<2|o>>4;d[n++]=(o&15)<<4|a>>2;d[n++]=(a&3)<<6|c&63}return l};const nh=typeof ArrayBuffer==="function";const sh=(e,t)=>{if(typeof e!=="string"){return{type:"message",data:ah(e,t)}}const i=e.charAt(0);if(i==="b"){return{type:"message",data:oh(e.substring(1),t)}}const r=Gu[i];if(!r){return $u}return e.length>1?{type:Gu[i],data:e.substring(1)}:{type:Gu[i]}};const oh=(e,t)=>{if(nh){const i=rh(e);return ah(i,t)}else{return{base64:true,data:e}}};const ah=(e,t)=>{switch(t){case"blob":if(e instanceof Blob){return e}else{return new Blob([e])}case"arraybuffer":default:if(e instanceof ArrayBuffer){return e}else{return e.buffer}}};const ch=String.fromCharCode(30);const lh=(e,t)=>{const i=e.length;const r=new Array(i);let n=0;e.forEach(((e,s)=>{Ku(e,false,(e=>{r[s]=e;if(++n===i){t(r.join(ch))}}))}))};const dh=(e,t)=>{const i=e.split(ch);const r=[];for(let n=0;n<i.length;n++){const e=sh(i[n],t);r.push(e);if(e.type==="error"){break}}return r};function uh(){return new TransformStream({transform(e,t){eh(e,(i=>{const r=i.length;let n;if(r<126){n=new Uint8Array(1);new DataView(n.buffer).setUint8(0,r)}else if(r<65536){n=new Uint8Array(3);const e=new DataView(n.buffer);e.setUint8(0,126);e.setUint16(1,r)}else{n=new Uint8Array(9);const e=new DataView(n.buffer);e.setUint8(0,127);e.setBigUint64(1,BigInt(r))}if(e.data&&typeof e.data!=="string"){n[0]|=128}t.enqueue(n);t.enqueue(i)}))}})}let hh;function fh(e){return e.reduce(((e,t)=>e+t.length),0)}function ph(e,t){if(e[0].length===t){return e.shift()}const i=new Uint8Array(t);let r=0;for(let n=0;n<t;n++){i[n]=e[0][r++];if(r===e[0].length){e.shift();r=0}}if(e.length&&r<e[0].length){e[0]=e[0].slice(r)}return i}function gh(e,t){if(!hh){hh=new TextDecoder}const i=[];let r=0;let n=-1;let s=false;return new TransformStream({transform(o,a){i.push(o);while(true){if(r===0){if(fh(i)<1){break}const e=ph(i,1);s=(e[0]&128)===128;n=e[0]&127;if(n<126){r=3}else if(n===126){r=1}else{r=2}}else if(r===1){if(fh(i)<2){break}const e=ph(i,2);n=new DataView(e.buffer,e.byteOffset,e.length).getUint16(0);r=3}else if(r===2){if(fh(i)<8){break}const e=ph(i,8);const t=new DataView(e.buffer,e.byteOffset,e.length);const s=t.getUint32(0);if(s>Math.pow(2,53-32)-1){a.enqueue($u);break}n=s*Math.pow(2,32)+t.getUint32(4);r=3}else{if(fh(i)<n){break}const e=ph(i,n);a.enqueue(sh(s?e:hh.decode(e),t));r=0}if(n===0||n>e){a.enqueue($u);break}}}})}const mh=4;function vh(e){if(e)return Sh(e)}function Sh(e){for(var t in vh.prototype){e[t]=vh.prototype[t]}return e}vh.prototype.on=vh.prototype.addEventListener=function(e,t){this._callbacks=this._callbacks||{};(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t);return this};vh.prototype.once=function(e,t){function i(){this.off(e,i);t.apply(this,arguments)}i.fn=t;this.on(e,i);return this};vh.prototype.off=vh.prototype.removeListener=vh.prototype.removeAllListeners=vh.prototype.removeEventListener=function(e,t){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var i=this._callbacks["$"+e];if(!i)return this;if(1==arguments.length){delete this._callbacks["$"+e];return this}var r;for(var n=0;n<i.length;n++){r=i[n];if(r===t||r.fn===t){i.splice(n,1);break}}if(i.length===0){delete this._callbacks["$"+e]}return this};vh.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=new Array(arguments.length-1),i=this._callbacks["$"+e];for(var r=1;r<arguments.length;r++){t[r-1]=arguments[r]}if(i){i=i.slice(0);for(var r=0,n=i.length;r<n;++r){i[r].apply(this,t)}}return this};vh.prototype.emitReserved=vh.prototype.emit;vh.prototype.listeners=function(e){this._callbacks=this._callbacks||{};return this._callbacks["$"+e]||[]};vh.prototype.hasListeners=function(e){return!!this.listeners(e).length};const bh=(()=>{if(typeof self!=="undefined"){return self}else if(typeof window!=="undefined"){return window}else{return Function("return this")()}})();function yh(e,...t){return t.reduce(((t,i)=>{if(e.hasOwnProperty(i)){t[i]=e[i]}return t}),{})}const Ch=bh.setTimeout;const wh=bh.clearTimeout;function _h(e,t){if(t.useNativeTimers){e.setTimeoutFn=Ch.bind(bh);e.clearTimeoutFn=wh.bind(bh)}else{e.setTimeoutFn=bh.setTimeout.bind(bh);e.clearTimeoutFn=bh.clearTimeout.bind(bh)}}const Eh=1.33;function Th(e){if(typeof e==="string"){return Ih(e)}return Math.ceil((e.byteLength||e.size)*Eh)}function Ih(e){let t=0,i=0;for(let r=0,n=e.length;r<n;r++){t=e.charCodeAt(r);if(t<128){i+=1}else if(t<2048){i+=2}else if(t<55296||t>=57344){i+=3}else{r++;i+=4}}return i}function Ph(e){let t="";for(let i in e){if(e.hasOwnProperty(i)){if(t.length)t+="&";t+=encodeURIComponent(i)+"="+encodeURIComponent(e[i])}}return t}function Ah(e){let t={};let i=e.split("&");for(let r=0,n=i.length;r<n;r++){let e=i[r].split("=");t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return t}class Mh extends Error{constructor(e,t,i){super(e);this.description=t;this.context=i;this.type="TransportError"}}class Dh extends vh{constructor(e){super();this.writable=false;_h(this,e);this.opts=e;this.query=e.query;this.socket=e.socket}onError(e,t,i){super.emitReserved("error",new Mh(e,t,i));return this}open(){this.readyState="opening";this.doOpen();return this}close(){if(this.readyState==="opening"||this.readyState==="open"){this.doClose();this.onClose()}return this}send(e){if(this.readyState==="open"){this.write(e)}}onOpen(){this.readyState="open";this.writable=true;super.emitReserved("open")}onData(e){const t=sh(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed";super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){if(this.opts.port&&(this.opts.secure&&Number(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)){return":"+this.opts.port}else{return""}}_query(e){const t=Ph(e);return t.length?"?"+t:""}}const Rh="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Oh=64,Nh={};let xh=0,Lh=0,kh;function Fh(e){let t="";do{t=Rh[e%Oh]+t;e=Math.floor(e/Oh)}while(e>0);return t}function Uh(){const e=Fh(+new Date);if(e!==kh)return xh=0,kh=e;return e+"."+Fh(xh++)}for(;Lh<Oh;Lh++)Nh[Rh[Lh]]=Lh;let jh=false;try{jh=typeof XMLHttpRequest!=="undefined"&&"withCredentials"in new XMLHttpRequest}catch(dp){}const Wh=jh;function Bh(e){const t=e.xdomain;try{if("undefined"!==typeof XMLHttpRequest&&(!t||Wh)){return new XMLHttpRequest}}catch(i){}if(!t){try{return new(bh[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(i){}}}function Hh(){}function Vh(){}const Yh=function(){const e=new Bh({xdomain:false});return null!=e.responseType}();class Gh extends Dh{constructor(e){super(e);this.polling=false;if(typeof location!=="undefined"){const t="https:"===location.protocol;let i=location.port;if(!i){i=t?"443":"80"}this.xd=typeof location!=="undefined"&&e.hostname!==location.hostname||i!==e.port}const t=e&&e.forceBase64;this.supportsBinary=Yh&&!t;if(this.opts.withCredentials){this.cookieJar=Hh()}}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused";e()};if(this.polling||!this.writable){let e=0;if(this.polling){e++;this.once("pollComplete",(function(){--e||t()}))}if(!this.writable){e++;this.once("drain",(function(){--e||t()}))}}else{t()}}poll(){this.polling=true;this.doPoll();this.emitReserved("poll")}onData(e){const t=e=>{if("opening"===this.readyState&&e.type==="open"){this.onOpen()}if("close"===e.type){this.onClose({description:"transport closed by the server"});return false}this.onPacket(e)};dh(e,this.socket.binaryType).forEach(t);if("closed"!==this.readyState){this.polling=false;this.emitReserved("pollComplete");if("open"===this.readyState){this.poll()}}}doClose(){const e=()=>{this.write([{type:"close"}])};if("open"===this.readyState){e()}else{this.once("open",e)}}write(e){this.writable=false;lh(e,(e=>{this.doWrite(e,(()=>{this.writable=true;this.emitReserved("drain")}))}))}uri(){const e=this.opts.secure?"https":"http";const t=this.query||{};if(false!==this.opts.timestampRequests){t[this.opts.timestampParam]=Uh()}if(!this.supportsBinary&&!t.sid){t.b64=1}return this.createUri(e,t)}request(e={}){Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts);return new $h(this.uri(),e)}doWrite(e,t){const i=this.request({method:"POST",data:e});i.on("success",t);i.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this));e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)}));this.pollXhr=e}}let $h=class e extends vh{constructor(e,t){super();_h(this,t);this.opts=t;this.method=t.method||"GET";this.uri=e;this.data=void 0!==t.data?t.data:null;this.create()}create(){var t;const i=yh(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");i.xdomain=!!this.opts.xd;const r=this.xhr=new Bh(i);try{r.open(this.method,this.uri,true);try{if(this.opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(true);for(let e in this.opts.extraHeaders){if(this.opts.extraHeaders.hasOwnProperty(e)){r.setRequestHeader(e,this.opts.extraHeaders[e])}}}}catch(n){}if("POST"===this.method){try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(n){}}try{r.setRequestHeader("Accept","*/*")}catch(n){}(t=this.opts.cookieJar)===null||t===void 0?void 0:t.addCookies(r);if("withCredentials"in r){r.withCredentials=this.opts.withCredentials}if(this.opts.requestTimeout){r.timeout=this.opts.requestTimeout}r.onreadystatechange=()=>{var e;if(r.readyState===3){(e=this.opts.cookieJar)===null||e===void 0?void 0:e.parseCookies(r)}if(4!==r.readyState)return;if(200===r.status||1223===r.status){this.onLoad()}else{this.setTimeoutFn((()=>{this.onError(typeof r.status==="number"?r.status:0)}),0)}};r.send(this.data)}catch(n){this.setTimeoutFn((()=>{this.onError(n)}),0);return}if(typeof document!=="undefined"){this.index=e.requestsCount++;e.requests[this.index]=this}}onError(e){this.emitReserved("error",e,this.xhr);this.cleanup(true)}cleanup(t){if("undefined"===typeof this.xhr||null===this.xhr){return}this.xhr.onreadystatechange=Vh;if(t){try{this.xhr.abort()}catch(i){}}if(typeof document!=="undefined"){delete e.requests[this.index]}this.xhr=null}onLoad(){const e=this.xhr.responseText;if(e!==null){this.emitReserved("data",e);this.emitReserved("success");this.cleanup()}}abort(){this.cleanup()}};$h.requestsCount=0;$h.requests={};if(typeof document!=="undefined"){if(typeof attachEvent==="function"){attachEvent("onunload",zh)}else if(typeof addEventListener==="function"){const e="onpagehide"in bh?"pagehide":"unload";addEventListener(e,zh,false)}}function zh(){for(let e in $h.requests){if($h.requests.hasOwnProperty(e)){$h.requests[e].abort()}}}const Jh=(()=>{const e=typeof Promise==="function"&&typeof Promise.resolve==="function";if(e){return e=>Promise.resolve().then(e)}else{return(e,t)=>t(e,0)}})();const qh=bh.WebSocket||bh.MozWebSocket;const Kh=true;const Xh="arraybuffer";const Qh=typeof navigator!=="undefined"&&typeof navigator.product==="string"&&navigator.product.toLowerCase()==="reactnative";class Zh extends Dh{constructor(e){super(e);this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check()){return}const e=this.uri();const t=this.opts.protocols;const i=Qh?{}:yh(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");if(this.opts.extraHeaders){i.headers=this.opts.extraHeaders}try{this.ws=Kh&&!Qh?t?new qh(e,t):new qh(e):new qh(e,t,i)}catch(dp){return this.emitReserved("error",dp)}this.ws.binaryType=this.socket.binaryType;this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{if(this.opts.autoUnref){this.ws._socket.unref()}this.onOpen()};this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e});this.ws.onmessage=e=>this.onData(e.data);this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=false;for(let t=0;t<e.length;t++){const i=e[t];const r=t===e.length-1;Ku(i,this.supportsBinary,(e=>{const t={};try{if(Kh){this.ws.send(e)}}catch(i){}if(r){Jh((()=>{this.writable=true;this.emitReserved("drain")}),this.setTimeoutFn)}}))}}doClose(){if(typeof this.ws!=="undefined"){this.ws.close();this.ws=null}}uri(){const e=this.opts.secure?"wss":"ws";const t=this.query||{};if(this.opts.timestampRequests){t[this.opts.timestampParam]=Uh()}if(!this.supportsBinary){t.b64=1}return this.createUri(e,t)}check(){return!!qh}}class ef extends Dh{get name(){return"webtransport"}doOpen(){if(typeof WebTransport!=="function"){return}this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]);this.transport.closed.then((()=>{this.onClose()})).catch((e=>{this.onError("webtransport error",e)}));this.transport.ready.then((()=>{this.transport.createBidirectionalStream().then((e=>{const t=gh(Number.MAX_SAFE_INTEGER,this.socket.binaryType);const i=e.readable.pipeThrough(t).getReader();const r=uh();r.readable.pipeTo(e.writable);this.writer=r.writable.getWriter();const n=()=>{i.read().then((({done:e,value:t})=>{if(e){return}this.onPacket(t);n()})).catch((e=>{}))};n();const s={type:"open"};if(this.query.sid){s.data=`{"sid":"${this.query.sid}"}`}this.writer.write(s).then((()=>this.onOpen()))}))}))}write(e){this.writable=false;for(let t=0;t<e.length;t++){const i=e[t];const r=t===e.length-1;this.writer.write(i).then((()=>{if(r){Jh((()=>{this.writable=true;this.emitReserved("drain")}),this.setTimeoutFn)}}))}}doClose(){var e;(e=this.transport)===null||e===void 0?void 0:e.close()}}const tf={websocket:Zh,webtransport:ef,polling:Gh};const rf=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;const nf=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function sf(e){const t=e,i=e.indexOf("["),r=e.indexOf("]");if(i!=-1&&r!=-1){e=e.substring(0,i)+e.substring(i,r).replace(/:/g,";")+e.substring(r,e.length)}let n=rf.exec(e||""),s={},o=14;while(o--){s[nf[o]]=n[o]||""}if(i!=-1&&r!=-1){s.source=t;s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":");s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":");s.ipv6uri=true}s.pathNames=of(s,s["path"]);s.queryKey=af(s,s["query"]);return s}function of(e,t){const i=/\/{2,9}/g,r=t.replace(i,"/").split("/");if(t.slice(0,1)=="/"||t.length===0){r.splice(0,1)}if(t.slice(-1)=="/"){r.splice(r.length-1,1)}return r}function af(e,t){const i={};t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,r){if(t){i[t]=r}}));return i}let cf=class e extends vh{constructor(e,t={}){super();this.binaryType=Xh;this.writeBuffer=[];if(e&&"object"===typeof e){t=e;e=null}if(e){e=sf(e);t.hostname=e.host;t.secure=e.protocol==="https"||e.protocol==="wss";t.port=e.port;if(e.query)t.query=e.query}else if(t.host){t.hostname=sf(t.host).host}_h(this,t);this.secure=null!=t.secure?t.secure:typeof location!=="undefined"&&"https:"===location.protocol;if(t.hostname&&!t.port){t.port=this.secure?"443":"80"}this.hostname=t.hostname||(typeof location!=="undefined"?location.hostname:"localhost");this.port=t.port||(typeof location!=="undefined"&&location.port?location.port:this.secure?"443":"80");this.transports=t.transports||["polling","websocket","webtransport"];this.writeBuffer=[];this.prevBufferLen=0;this.opts=Object.assign({path:"/engine.io",agent:false,withCredentials:false,upgrade:true,timestampParam:"t",rememberUpgrade:false,addTrailingSlash:true,rejectUnauthorized:true,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:false},t);this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":"");if(typeof this.opts.query==="string"){this.opts.query=Ah(this.opts.query)}this.id=null;this.upgrades=null;this.pingInterval=null;this.pingTimeout=null;this.pingTimeoutTimer=null;if(typeof addEventListener==="function"){if(this.opts.closeOnBeforeunload){this.beforeunloadEventListener=()=>{if(this.transport){this.transport.removeAllListeners();this.transport.close()}};addEventListener("beforeunload",this.beforeunloadEventListener,false)}if(this.hostname!=="localhost"){this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})};addEventListener("offline",this.offlineEventListener,false)}}this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=mh;t.transport=e;if(this.id)t.sid=this.id;const i=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new tf[e](i)}open(){let t;if(this.opts.rememberUpgrade&&e.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1){t="websocket"}else if(0===this.transports.length){this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);return}else{t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(i){this.transports.shift();this.open();return}t.open();this.setTransport(t)}setTransport(e){if(this.transport){this.transport.removeAllListeners()}this.transport=e;e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(t){let i=this.createTransport(t);let r=false;e.priorWebsocketSuccess=false;const n=()=>{if(r)return;i.send([{type:"ping",data:"probe"}]);i.once("packet",(t=>{if(r)return;if("pong"===t.type&&"probe"===t.data){this.upgrading=true;this.emitReserved("upgrading",i);if(!i)return;e.priorWebsocketSuccess="websocket"===i.name;this.transport.pause((()=>{if(r)return;if("closed"===this.readyState)return;d();this.setTransport(i);i.send([{type:"upgrade"}]);this.emitReserved("upgrade",i);i=null;this.upgrading=false;this.flush()}))}else{const e=new Error("probe error");e.transport=i.name;this.emitReserved("upgradeError",e)}}))};function s(){if(r)return;r=true;d();i.close();i=null}const o=e=>{const t=new Error("probe error: "+e);t.transport=i.name;s();this.emitReserved("upgradeError",t)};function a(){o("transport closed")}function c(){o("socket closed")}function l(e){if(i&&e.name!==i.name){s()}}const d=()=>{i.removeListener("open",n);i.removeListener("error",o);i.removeListener("close",a);this.off("close",c);this.off("upgrading",l)};i.once("open",n);i.once("error",o);i.once("close",a);this.once("close",c);this.once("upgrading",l);if(this.upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"){this.setTimeoutFn((()=>{if(!r){i.open()}}),200)}else{i.open()}}onOpen(){this.readyState="open";e.priorWebsocketSuccess="websocket"===this.transport.name;this.emitReserved("open");this.flush();if("open"===this.readyState&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++){this.probe(this.upgrades[e])}}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){this.emitReserved("packet",e);this.emitReserved("heartbeat");this.resetPingTimeout();switch(e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong");this.emitReserved("ping");this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data;this.onError(t);break;case"message":this.emitReserved("data",e.data);this.emitReserved("message",e.data);break}}}onHandshake(e){this.emitReserved("handshake",e);this.id=e.sid;this.transport.query.sid=e.sid;this.upgrades=this.filterUpgrades(e.upgrades);this.pingInterval=e.pingInterval;this.pingTimeout=e.pingTimeout;this.maxPayload=e.maxPayload;this.onOpen();if("closed"===this.readyState)return;this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer);this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout);if(this.opts.autoUnref){this.pingTimeoutTimer.unref()}}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(0===this.writeBuffer.length){this.emitReserved("drain")}else{this.flush()}}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e);this.prevBufferLen=e.length;this.emitReserved("flush")}}getWritablePackets(){const e=this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1;if(!e){return this.writeBuffer}let t=1;for(let i=0;i<this.writeBuffer.length;i++){const e=this.writeBuffer[i].data;if(e){t+=Th(e)}if(i>0&&t>this.maxPayload){return this.writeBuffer.slice(0,i)}t+=2}return this.writeBuffer}write(e,t,i){this.sendPacket("message",e,t,i);return this}send(e,t,i){this.sendPacket("message",e,t,i);return this}sendPacket(e,t,i,r){if("function"===typeof t){r=t;t=void 0}if("function"===typeof i){r=i;i=null}if("closing"===this.readyState||"closed"===this.readyState){return}i=i||{};i.compress=false!==i.compress;const n={type:e,data:t,options:i};this.emitReserved("packetCreate",n);this.writeBuffer.push(n);if(r)this.once("flush",r);this.flush()}close(){const e=()=>{this.onClose("forced close");this.transport.close()};const t=()=>{this.off("upgrade",t);this.off("upgradeError",t);e()};const i=()=>{this.once("upgrade",t);this.once("upgradeError",t)};if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";if(this.writeBuffer.length){this.once("drain",(()=>{if(this.upgrading){i()}else{e()}}))}else if(this.upgrading){i()}else{e()}}return this}onError(t){e.priorWebsocketSuccess=false;this.emitReserved("error",t);this.onClose("transport error",t)}onClose(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){this.clearTimeoutFn(this.pingTimeoutTimer);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();if(typeof removeEventListener==="function"){removeEventListener("beforeunload",this.beforeunloadEventListener,false);removeEventListener("offline",this.offlineEventListener,false)}this.readyState="closed";this.id=null;this.emitReserved("close",e,t);this.writeBuffer=[];this.prevBufferLen=0}}filterUpgrades(e){const t=[];let i=0;const r=e.length;for(;i<r;i++){if(~this.transports.indexOf(e[i]))t.push(e[i])}return t}};cf.protocol=mh;function lf(e,t="",i){let r=e;i=i||typeof location!=="undefined"&&location;if(null==e)e=i.protocol+"//"+i.host;if(typeof e==="string"){if("/"===e.charAt(0)){if("/"===e.charAt(1)){e=i.protocol+e}else{e=i.host+e}}if(!/^(https?|wss?):\/\//.test(e)){if("undefined"!==typeof i){e=i.protocol+"//"+e}else{e="https://"+e}}r=sf(e)}if(!r.port){if(/^(http|ws)$/.test(r.protocol)){r.port="80"}else if(/^(http|ws)s$/.test(r.protocol)){r.port="443"}}r.path=r.path||"/";const n=r.host.indexOf(":")!==-1;const s=n?"["+r.host+"]":r.host;r.id=r.protocol+"://"+s+":"+r.port+t;r.href=r.protocol+"://"+s+(i&&i.port===r.port?"":":"+r.port);return r}const df=typeof ArrayBuffer==="function";const uf=e=>typeof ArrayBuffer.isView==="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer;const hf=Object.prototype.toString;const ff=typeof Blob==="function"||typeof Blob!=="undefined"&&hf.call(Blob)==="[object BlobConstructor]";const pf=typeof File==="function"||typeof File!=="undefined"&&hf.call(File)==="[object FileConstructor]";function gf(e){return df&&(e instanceof ArrayBuffer||uf(e))||ff&&e instanceof Blob||pf&&e instanceof File}function mf(e,t){if(!e||typeof e!=="object"){return false}if(Array.isArray(e)){for(let t=0,i=e.length;t<i;t++){if(mf(e[t])){return true}}return false}if(gf(e)){return true}if(e.toJSON&&typeof e.toJSON==="function"&&arguments.length===1){return mf(e.toJSON(),true)}for(const i in e){if(Object.prototype.hasOwnProperty.call(e,i)&&mf(e[i])){return true}}return false}function vf(e){const t=[];const i=e.data;const r=e;r.data=Sf(i,t);r.attachments=t.length;return{packet:r,buffers:t}}function Sf(e,t){if(!e)return e;if(gf(e)){const i={_placeholder:true,num:t.length};t.push(e);return i}else if(Array.isArray(e)){const i=new Array(e.length);for(let r=0;r<e.length;r++){i[r]=Sf(e[r],t)}return i}else if(typeof e==="object"&&!(e instanceof Date)){const i={};for(const r in e){if(Object.prototype.hasOwnProperty.call(e,r)){i[r]=Sf(e[r],t)}}return i}return e}function bf(e,t){e.data=yf(e.data,t);delete e.attachments;return e}function yf(e,t){if(!e)return e;if(e&&e._placeholder===true){const i=typeof e.num==="number"&&e.num>=0&&e.num<t.length;if(i){return t[e.num]}else{throw new Error("illegal attachments")}}else if(Array.isArray(e)){for(let i=0;i<e.length;i++){e[i]=yf(e[i],t)}}else if(typeof e==="object"){for(const i in e){if(Object.prototype.hasOwnProperty.call(e,i)){e[i]=yf(e[i],t)}}}return e}const Cf=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];const wf=5;var _f;(function(e){e[e["CONNECT"]=0]="CONNECT";e[e["DISCONNECT"]=1]="DISCONNECT";e[e["EVENT"]=2]="EVENT";e[e["ACK"]=3]="ACK";e[e["CONNECT_ERROR"]=4]="CONNECT_ERROR";e[e["BINARY_EVENT"]=5]="BINARY_EVENT";e[e["BINARY_ACK"]=6]="BINARY_ACK"})(_f||(_f={}));class Ef{constructor(e){this.replacer=e}encode(e){if(e.type===_f.EVENT||e.type===_f.ACK){if(mf(e)){return this.encodeAsBinary({type:e.type===_f.EVENT?_f.BINARY_EVENT:_f.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}}return[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;if(e.type===_f.BINARY_EVENT||e.type===_f.BINARY_ACK){t+=e.attachments+"-"}if(e.nsp&&"/"!==e.nsp){t+=e.nsp+","}if(null!=e.id){t+=e.id}if(null!=e.data){t+=JSON.stringify(e.data,this.replacer)}return t}encodeAsBinary(e){const t=vf(e);const i=this.encodeAsString(t.packet);const r=t.buffers;r.unshift(i);return r}}function Tf(e){return Object.prototype.toString.call(e)==="[object Object]"}class If extends vh{constructor(e){super();this.reviver=e}add(e){let t;if(typeof e==="string"){if(this.reconstructor){throw new Error("got plaintext data when reconstructing a packet")}t=this.decodeString(e);const i=t.type===_f.BINARY_EVENT;if(i||t.type===_f.BINARY_ACK){t.type=i?_f.EVENT:_f.ACK;this.reconstructor=new Pf(t);if(t.attachments===0){super.emitReserved("decoded",t)}}else{super.emitReserved("decoded",t)}}else if(gf(e)||e.base64){if(!this.reconstructor){throw new Error("got binary data when not reconstructing a packet")}else{t=this.reconstructor.takeBinaryData(e);if(t){this.reconstructor=null;super.emitReserved("decoded",t)}}}else{throw new Error("Unknown type: "+e)}}decodeString(e){let t=0;const i={type:Number(e.charAt(0))};if(_f[i.type]===void 0){throw new Error("unknown packet type "+i.type)}if(i.type===_f.BINARY_EVENT||i.type===_f.BINARY_ACK){const r=t+1;while(e.charAt(++t)!=="-"&&t!=e.length){}const n=e.substring(r,t);if(n!=Number(n)||e.charAt(t)!=="-"){throw new Error("Illegal attachments")}i.attachments=Number(n)}if("/"===e.charAt(t+1)){const r=t+1;while(++t){const i=e.charAt(t);if(","===i)break;if(t===e.length)break}i.nsp=e.substring(r,t)}else{i.nsp="/"}const r=e.charAt(t+1);if(""!==r&&Number(r)==r){const r=t+1;while(++t){const i=e.charAt(t);if(null==i||Number(i)!=i){--t;break}if(t===e.length)break}i.id=Number(e.substring(r,t+1))}if(e.charAt(++t)){const r=this.tryParse(e.substr(t));if(If.isPayloadValid(i.type,r)){i.data=r}else{throw new Error("invalid payload")}}return i}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return false}}static isPayloadValid(e,t){switch(e){case _f.CONNECT:return Tf(t);case _f.DISCONNECT:return t===void 0;case _f.CONNECT_ERROR:return typeof t==="string"||Tf(t);case _f.EVENT:case _f.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]==="number"||typeof t[0]==="string"&&Cf.indexOf(t[0])===-1);case _f.ACK:case _f.BINARY_ACK:return Array.isArray(t)}}destroy(){if(this.reconstructor){this.reconstructor.finishedReconstruction();this.reconstructor=null}}}class Pf{constructor(e){this.packet=e;this.buffers=[];this.reconPack=e}takeBinaryData(e){this.buffers.push(e);if(this.buffers.length===this.reconPack.attachments){const e=bf(this.reconPack,this.buffers);this.finishedReconstruction();return e}return null}finishedReconstruction(){this.reconPack=null;this.buffers=[]}}const Af=Object.freeze(Object.defineProperty({__proto__:null,Decoder:If,Encoder:Ef,get PacketType(){return _f},protocol:wf},Symbol.toStringTag,{value:"Module"}));function Mf(e,t,i){e.on(t,i);return function r(){e.off(t,i)}}const Df=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Rf extends vh{constructor(e,t,i){super();this.connected=false;this.recovered=false;this.receiveBuffer=[];this.sendBuffer=[];this._queue=[];this._queueSeq=0;this.ids=0;this.acks={};this.flags={};this.io=e;this.nsp=t;if(i&&i.auth){this.auth=i.auth}this._opts=Object.assign({},i);if(this.io._autoConnect)this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Mf(e,"open",this.onopen.bind(this)),Mf(e,"packet",this.onpacket.bind(this)),Mf(e,"error",this.onerror.bind(this)),Mf(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){if(this.connected)return this;this.subEvents();if(!this.io["_reconnecting"])this.io.open();if("open"===this.io._readyState)this.onopen();return this}open(){return this.connect()}send(...e){e.unshift("message");this.emit.apply(this,e);return this}emit(e,...t){if(Df.hasOwnProperty(e)){throw new Error('"'+e.toString()+'" is a reserved event name')}t.unshift(e);if(this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile){this._addToQueue(t);return this}const i={type:_f.EVENT,data:t};i.options={};i.options.compress=this.flags.compress!==false;if("function"===typeof t[t.length-1]){const e=this.ids++;const r=t.pop();this._registerAckCallback(e,r);i.id=e}const r=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;const n=this.flags.volatile&&(!r||!this.connected);if(n);else if(this.connected){this.notifyOutgoingListeners(i);this.packet(i)}else{this.sendBuffer.push(i)}this.flags={};return this}_registerAckCallback(e,t){var i;const r=(i=this.flags.timeout)!==null&&i!==void 0?i:this._opts.ackTimeout;if(r===void 0){this.acks[e]=t;return}const n=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++){if(this.sendBuffer[t].id===e){this.sendBuffer.splice(t,1)}}t.call(this,new Error("operation has timed out"))}),r);this.acks[e]=(...e)=>{this.io.clearTimeoutFn(n);t.apply(this,[null,...e])}}emitWithAck(e,...t){const i=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise(((r,n)=>{t.push(((e,t)=>{if(i){return e?n(e):r(t)}else{return r(e)}}));this.emit(e,...t)}))}_addToQueue(e){let t;if(typeof e[e.length-1]==="function"){t=e.pop()}const i={id:this._queueSeq++,tryCount:0,pending:false,args:e,flags:Object.assign({fromQueue:true},this.flags)};e.push(((e,...r)=>{if(i!==this._queue[0]){return}const n=e!==null;if(n){if(i.tryCount>this._opts.retries){this._queue.shift();if(t){t(e)}}}else{this._queue.shift();if(t){t(null,...r)}}i.pending=false;return this._drainQueue()}));this._queue.push(i);this._drainQueue()}_drainQueue(e=false){if(!this.connected||this._queue.length===0){return}const t=this._queue[0];if(t.pending&&!e){return}t.pending=true;t.tryCount++;this.flags=t.flags;this.emit.apply(this,t.args)}packet(e){e.nsp=this.nsp;this.io._packet(e)}onopen(){if(typeof this.auth=="function"){this.auth((e=>{this._sendConnectPacket(e)}))}else{this._sendConnectPacket(this.auth)}}_sendConnectPacket(e){this.packet({type:_f.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){if(!this.connected){this.emitReserved("connect_error",e)}}onclose(e,t){this.connected=false;delete this.id;this.emitReserved("disconnect",e,t)}onpacket(e){const t=e.nsp===this.nsp;if(!t)return;switch(e.type){case _f.CONNECT:if(e.data&&e.data.sid){this.onconnect(e.data.sid,e.data.pid)}else{this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"))}break;case _f.EVENT:case _f.BINARY_EVENT:this.onevent(e);break;case _f.ACK:case _f.BINARY_ACK:this.onack(e);break;case _f.DISCONNECT:this.ondisconnect();break;case _f.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data;this.emitReserved("connect_error",t);break}}onevent(e){const t=e.data||[];if(null!=e.id){t.push(this.ack(e.id))}if(this.connected){this.emitEvent(t)}else{this.receiveBuffer.push(Object.freeze(t))}}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const i of t){i.apply(this,e)}}super.emit.apply(this,e);if(this._pid&&e.length&&typeof e[e.length-1]==="string"){this._lastOffset=e[e.length-1]}}ack(e){const t=this;let i=false;return function(...r){if(i)return;i=true;t.packet({type:_f.ACK,id:e,data:r})}}onack(e){const t=this.acks[e.id];if("function"===typeof t){t.apply(this,e.data);delete this.acks[e.id]}}onconnect(e,t){this.id=e;this.recovered=t&&this._pid===t;this._pid=t;this.connected=true;this.emitBuffered();this.emitReserved("connect");this._drainQueue(true)}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e)));this.receiveBuffer=[];this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e);this.packet(e)}));this.sendBuffer=[]}ondisconnect(){this.destroy();this.onclose("io server disconnect")}destroy(){if(this.subs){this.subs.forEach((e=>e()));this.subs=void 0}this.io["_destroy"](this)}disconnect(){if(this.connected){this.packet({type:_f.DISCONNECT})}this.destroy();if(this.connected){this.onclose("io client disconnect")}return this}close(){return this.disconnect()}compress(e){this.flags.compress=e;return this}get volatile(){this.flags.volatile=true;return this}timeout(e){this.flags.timeout=e;return this}onAny(e){this._anyListeners=this._anyListeners||[];this._anyListeners.push(e);return this}prependAny(e){this._anyListeners=this._anyListeners||[];this._anyListeners.unshift(e);return this}offAny(e){if(!this._anyListeners){return this}if(e){const t=this._anyListeners;for(let i=0;i<t.length;i++){if(e===t[i]){t.splice(i,1);return this}}}else{this._anyListeners=[]}return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){this._anyOutgoingListeners=this._anyOutgoingListeners||[];this._anyOutgoingListeners.push(e);return this}prependAnyOutgoing(e){this._anyOutgoingListeners=this._anyOutgoingListeners||[];this._anyOutgoingListeners.unshift(e);return this}offAnyOutgoing(e){if(!this._anyOutgoingListeners){return this}if(e){const t=this._anyOutgoingListeners;for(let i=0;i<t.length;i++){if(e===t[i]){t.splice(i,1);return this}}}else{this._anyOutgoingListeners=[]}return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const i of t){i.apply(this,e.data)}}}}function Of(e){e=e||{};this.ms=e.min||100;this.max=e.max||1e4;this.factor=e.factor||2;this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0;this.attempts=0}Of.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random();var i=Math.floor(t*this.jitter*e);e=(Math.floor(t*10)&1)==0?e-i:e+i}return Math.min(e,this.max)|0};Of.prototype.reset=function(){this.attempts=0};Of.prototype.setMin=function(e){this.ms=e};Of.prototype.setMax=function(e){this.max=e};Of.prototype.setJitter=function(e){this.jitter=e};class Nf extends vh{constructor(e,t){var i;super();this.nsps={};this.subs=[];if(e&&"object"===typeof e){t=e;e=void 0}t=t||{};t.path=t.path||"/socket.io";this.opts=t;_h(this,t);this.reconnection(t.reconnection!==false);this.reconnectionAttempts(t.reconnectionAttempts||Infinity);this.reconnectionDelay(t.reconnectionDelay||1e3);this.reconnectionDelayMax(t.reconnectionDelayMax||5e3);this.randomizationFactor((i=t.randomizationFactor)!==null&&i!==void 0?i:.5);this.backoff=new Of({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==t.timeout?2e4:t.timeout);this._readyState="closed";this.uri=e;const r=t.parser||Af;this.encoder=new r.Encoder;this.decoder=new r.Decoder;this._autoConnect=t.autoConnect!==false;if(this._autoConnect)this.open()}reconnection(e){if(!arguments.length)return this._reconnection;this._reconnection=!!e;return this}reconnectionAttempts(e){if(e===void 0)return this._reconnectionAttempts;this._reconnectionAttempts=e;return this}reconnectionDelay(e){var t;if(e===void 0)return this._reconnectionDelay;this._reconnectionDelay=e;(t=this.backoff)===null||t===void 0?void 0:t.setMin(e);return this}randomizationFactor(e){var t;if(e===void 0)return this._randomizationFactor;this._randomizationFactor=e;(t=this.backoff)===null||t===void 0?void 0:t.setJitter(e);return this}reconnectionDelayMax(e){var t;if(e===void 0)return this._reconnectionDelayMax;this._reconnectionDelayMax=e;(t=this.backoff)===null||t===void 0?void 0:t.setMax(e);return this}timeout(e){if(!arguments.length)return this._timeout;this._timeout=e;return this}maybeReconnectOnOpen(){if(!this._reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new cf(this.uri,this.opts);const t=this.engine;const i=this;this._readyState="opening";this.skipReconnect=false;const r=Mf(t,"open",(function(){i.onopen();e&&e()}));const n=t=>{this.cleanup();this._readyState="closed";this.emitReserved("error",t);if(e){e(t)}else{this.maybeReconnectOnOpen()}};const s=Mf(t,"error",n);if(false!==this._timeout){const e=this._timeout;const i=this.setTimeoutFn((()=>{r();n(new Error("timeout"));t.close()}),e);if(this.opts.autoUnref){i.unref()}this.subs.push((()=>{this.clearTimeoutFn(i)}))}this.subs.push(r);this.subs.push(s);return this}connect(e){return this.open(e)}onopen(){this.cleanup();this._readyState="open";this.emitReserved("open");const e=this.engine;this.subs.push(Mf(e,"ping",this.onping.bind(this)),Mf(e,"data",this.ondata.bind(this)),Mf(e,"error",this.onerror.bind(this)),Mf(e,"close",this.onclose.bind(this)),Mf(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Jh((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let i=this.nsps[e];if(!i){i=new Rf(this,e,t);this.nsps[e]=i}else if(this._autoConnect&&!i.active){i.connect()}return i}_destroy(e){const t=Object.keys(this.nsps);for(const i of t){const e=this.nsps[i];if(e.active){return}}this._close()}_packet(e){const t=this.encoder.encode(e);for(let i=0;i<t.length;i++){this.engine.write(t[i],e.options)}}cleanup(){this.subs.forEach((e=>e()));this.subs.length=0;this.decoder.destroy()}_close(){this.skipReconnect=true;this._reconnecting=false;this.onclose("forced close");if(this.engine)this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup();this.backoff.reset();this._readyState="closed";this.emitReserved("close",e,t);if(this._reconnection&&!this.skipReconnect){this.reconnect()}}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts){this.backoff.reset();this.emitReserved("reconnect_failed");this._reconnecting=false}else{const t=this.backoff.duration();this._reconnecting=true;const i=this.setTimeoutFn((()=>{if(e.skipReconnect)return;this.emitReserved("reconnect_attempt",e.backoff.attempts);if(e.skipReconnect)return;e.open((t=>{if(t){e._reconnecting=false;e.reconnect();this.emitReserved("reconnect_error",t)}else{e.onreconnect()}}))}),t);if(this.opts.autoUnref){i.unref()}this.subs.push((()=>{this.clearTimeoutFn(i)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=false;this.backoff.reset();this.emitReserved("reconnect",e)}}const xf={};function Lf(e,t){if(typeof e==="object"){t=e;e=void 0}t=t||{};const i=lf(e,t.path||"/socket.io");const r=i.source;const n=i.id;const s=i.path;const o=xf[n]&&s in xf[n]["nsps"];const a=t.forceNew||t["force new connection"]||false===t.multiplex||o;let c;if(a){c=new Nf(r,t)}else{if(!xf[n]){xf[n]=new Nf(r,t)}c=xf[n]}if(i.query&&!t.query){t.query=i.queryKey}return c.socket(i.path,t)}Object.assign(Lf,{Manager:Nf,Socket:Rf,io:Lf,connect:Lf});var kf=(e=>{e["MESSAGE"]="MESSAGE";e["GUEST_USER_CREDENTIALS"]="GUEST_USER_CREDENTIALS";return e})(kf||{});var Ff=(e=>{e["TEXT"]="TEXT";e["CHOICES"]="CHOICES";e["ACQUIRE_TEXT"]="ACQUIRE_TEXT";e["ACQUIRE_NUMBER"]="ACQUIRE_NUMBER";e["ACQUIRE_PHONE_NUMBER"]="ACQUIRE_PHONE_NUMBER";e["ACQUIRE_EMAIL"]="ACQUIRE_EMAIL";e["SYSTEM"]="SYSTEM";return e})(Ff||{});var Uf=function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:false,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=true,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:true,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:true})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:true,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=498)}([function(e,t,i){i.d(t,"a",(function(){return n}));
/*! *****************************************************************************
      Copyright (c) Microsoft Corporation.
    
      Permission to use, copy, modify, and/or distribute this software for any
      purpose with or without fee is hereby granted.
    
      THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
      REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
      AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
      INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
      LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
      OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
      PERFORMANCE OF THIS SOFTWARE.
      ***************************************************************************** */var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function n(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}},function(e,t,i){(function(e){e.exports=function(){var t,r;function n(){return t.apply(null,arguments)}function s(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function o(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function a(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function c(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;var t;for(t in e)if(a(e,t))return false;return true}function l(e){return void 0===e}function d(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function u(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function h(e,t){var i,r=[],n=e.length;for(i=0;i<n;++i)r.push(t(e[i],i));return r}function f(e,t){for(var i in t)a(t,i)&&(e[i]=t[i]);return a(t,"toString")&&(e.toString=t.toString),a(t,"valueOf")&&(e.valueOf=t.valueOf),e}function p(e,t,i,r){return Tt(e,t,i,r,true).utc()}function g(e){return null==e._pf&&(e._pf={empty:false,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:false,invalidEra:null,invalidMonth:null,invalidFormat:false,userInvalidated:false,iso:false,parsedDateParts:[],era:null,meridiem:null,rfc2822:false,weekdayMismatch:false}),e._pf}function m(e){if(null==e._isValid){var t=g(e),i=r.call(t.parsedDateParts,(function(e){return null!=e})),n=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidEra&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&i);if(e._strict&&(n=n&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour),null!=Object.isFrozen&&Object.isFrozen(e))return n;e._isValid=n}return e._isValid}function v(e){var t=p(NaN);return null!=e?f(g(t),e):g(t).userInvalidated=true,t}r=Array.prototype.some?Array.prototype.some:function(e){var t,i=Object(this),r=i.length>>>0;for(t=0;t<r;t++)if(t in i&&e.call(this,i[t],t,i))return true;return false};var S=n.momentProperties=[],b=false;function y(e,t){var i,r,n,s=S.length;if(l(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),l(t._i)||(e._i=t._i),l(t._f)||(e._f=t._f),l(t._l)||(e._l=t._l),l(t._strict)||(e._strict=t._strict),l(t._tzm)||(e._tzm=t._tzm),l(t._isUTC)||(e._isUTC=t._isUTC),l(t._offset)||(e._offset=t._offset),l(t._pf)||(e._pf=g(t)),l(t._locale)||(e._locale=t._locale),s>0)for(i=0;i<s;i++)l(n=t[r=S[i]])||(e[r]=n);return e}function C(e){y(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),false===b&&(b=true,n.updateOffset(this),b=false)}function w(e){return e instanceof C||null!=e&&null!=e._isAMomentObject}function _(e){false===n.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function E(e,t){var i=true;return f((function(){if(null!=n.deprecationHandler&&n.deprecationHandler(null,e),i){var r,s,o,c=[],l=arguments.length;for(s=0;s<l;s++){if(r="","object"==typeof arguments[s]){for(o in r+="\n["+s+"] ",arguments[0])a(arguments[0],o)&&(r+=o+": "+arguments[0][o]+", ");r=r.slice(0,-2)}else r=arguments[s];c.push(r)}_(e+"\nArguments: "+Array.prototype.slice.call(c).join("")+"\n"+(new Error).stack),i=false}return t.apply(this,arguments)}),t)}var T,I={};function P(e,t){null!=n.deprecationHandler&&n.deprecationHandler(e,t),I[e]||(_(t),I[e]=true)}function A(e){return"undefined"!=typeof Function&&e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function M(e,t){var i,r=f({},e);for(i in t)a(t,i)&&(o(e[i])&&o(t[i])?(r[i]={},f(r[i],e[i]),f(r[i],t[i])):null!=t[i]?r[i]=t[i]:delete r[i]);for(i in e)a(e,i)&&!a(t,i)&&o(e[i])&&(r[i]=f({},r[i]));return r}function D(e){null!=e&&this.set(e)}function R(e,t,i){var r=""+Math.abs(e),n=t-r.length;return(e>=0?i?"+":"":"-")+Math.pow(10,Math.max(0,n)).toString().substr(1)+r}n.suppressDeprecationWarnings=false,n.deprecationHandler=null,T=Object.keys?Object.keys:function(e){var t,i=[];for(t in e)a(e,t)&&i.push(t);return i};var O=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,N=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,x={},L={};function k(e,t,i,r){var n=r;"string"==typeof r&&(n=function(){return this[r]()}),e&&(L[e]=n),t&&(L[t[0]]=function(){return R(n.apply(this,arguments),t[1],t[2])}),i&&(L[i]=function(){return this.localeData().ordinal(n.apply(this,arguments),e)})}function F(e,t){return e.isValid()?(t=U(t,e.localeData()),x[t]=x[t]||function(e){var t,i,r,n=e.match(O);for(t=0,i=n.length;t<i;t++)L[n[t]]?n[t]=L[n[t]]:n[t]=(r=n[t]).match(/\[[\s\S]/)?r.replace(/^\[|\]$/g,""):r.replace(/\\/g,"");return function(t){var r,s="";for(r=0;r<i;r++)s+=A(n[r])?n[r].call(t,e):n[r];return s}}(t),x[t](e)):e.localeData().invalidDate()}function U(e,t){var i=5;function r(e){return t.longDateFormat(e)||e}for(N.lastIndex=0;i>=0&&N.test(e);)e=e.replace(N,r),N.lastIndex=0,i-=1;return e}var j={};function W(e,t){var i=e.toLowerCase();j[i]=j[i+"s"]=j[t]=e}function B(e){return"string"==typeof e?j[e]||j[e.toLowerCase()]:void 0}function H(e){var t,i,r={};for(i in e)a(e,i)&&(t=B(i))&&(r[t]=e[i]);return r}var V={};function Y(e,t){V[e]=t}function G(e){return e%4==0&&e%100!=0||e%400==0}function $(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function z(e){var t=+e,i=0;return 0!==t&&isFinite(t)&&(i=$(t)),i}function J(e,t){return function(i){return null!=i?(K(this,e,i),n.updateOffset(this,t),this):q(this,e)}}function q(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function K(e,t,i){e.isValid()&&!isNaN(i)&&("FullYear"===t&&G(e.year())&&1===e.month()&&29===e.date()?(i=z(i),e._d["set"+(e._isUTC?"UTC":"")+t](i,e.month(),we(i,e.month()))):e._d["set"+(e._isUTC?"UTC":"")+t](i))}var X,Q=/\d/,Z=/\d\d/,ee=/\d{3}/,te=/\d{4}/,ie=/[+-]?\d{6}/,re=/\d\d?/,ne=/\d\d\d\d?/,se=/\d\d\d\d\d\d?/,oe=/\d{1,3}/,ae=/\d{1,4}/,ce=/[+-]?\d{1,6}/,le=/\d+/,de=/[+-]?\d+/,ue=/Z|[+-]\d\d:?\d\d/gi,he=/Z|[+-]\d\d(?::?\d\d)?/gi,fe=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i;function pe(e,t,i){X[e]=A(t)?t:function(e,r){return e&&i?i:t}}function ge(e,t){return a(X,e)?X[e](t._strict,t._locale):new RegExp(me(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,(function(e,t,i,r,n){return t||i||r||n}))))}function me(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}X={};var ve,Se={};function be(e,t){var i,r,n=t;for("string"==typeof e&&(e=[e]),d(t)&&(n=function(e,i){i[t]=z(e)}),r=e.length,i=0;i<r;i++)Se[e[i]]=n}function ye(e,t){be(e,(function(e,i,r,n){r._w=r._w||{},t(e,r._w,r,n)}))}function Ce(e,t,i){null!=t&&a(Se,e)&&Se[e](t,i._a,i,e)}function we(e,t){if(isNaN(e)||isNaN(t))return NaN;var i,r=(t%(i=12)+i)%i;return e+=(t-r)/12,1===r?G(e)?29:28:31-r%7%2}ve=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1},k("M",["MM",2],"Mo",(function(){return this.month()+1})),k("MMM",0,0,(function(e){return this.localeData().monthsShort(this,e)})),k("MMMM",0,0,(function(e){return this.localeData().months(this,e)})),W("month","M"),Y("month",8),pe("M",re),pe("MM",re,Z),pe("MMM",(function(e,t){return t.monthsShortRegex(e)})),pe("MMMM",(function(e,t){return t.monthsRegex(e)})),be(["M","MM"],(function(e,t){t[1]=z(e)-1})),be(["MMM","MMMM"],(function(e,t,i,r){var n=i._locale.monthsParse(e,r,i._strict);null!=n?t[1]=n:g(i).invalidMonth=e}));var _e="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),Ee="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),Te=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Ie=fe,Pe=fe;function Ae(e,t,i){var r,n,s,o=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],r=0;r<12;++r)s=p([2e3,r]),this._shortMonthsParse[r]=this.monthsShort(s,"").toLocaleLowerCase(),this._longMonthsParse[r]=this.months(s,"").toLocaleLowerCase();return i?"MMM"===t?-1!==(n=ve.call(this._shortMonthsParse,o))?n:null:-1!==(n=ve.call(this._longMonthsParse,o))?n:null:"MMM"===t?-1!==(n=ve.call(this._shortMonthsParse,o))||-1!==(n=ve.call(this._longMonthsParse,o))?n:null:-1!==(n=ve.call(this._longMonthsParse,o))||-1!==(n=ve.call(this._shortMonthsParse,o))?n:null}function Me(e,t){var i;if(!e.isValid())return e;if("string"==typeof t){if(/^\d+$/.test(t))t=z(t);else if(!d(t=e.localeData().monthsParse(t)))return e}return i=Math.min(e.date(),we(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,i),e}function De(e){return null!=e?(Me(this,e),n.updateOffset(this,true),this):q(this,"Month")}function Re(){function e(e,t){return t.length-e.length}var t,i,r=[],n=[],s=[];for(t=0;t<12;t++)i=p([2e3,t]),r.push(this.monthsShort(i,"")),n.push(this.months(i,"")),s.push(this.months(i,"")),s.push(this.monthsShort(i,""));for(r.sort(e),n.sort(e),s.sort(e),t=0;t<12;t++)r[t]=me(r[t]),n[t]=me(n[t]);for(t=0;t<24;t++)s[t]=me(s[t]);this._monthsRegex=new RegExp("^("+s.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+n.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+r.join("|")+")","i")}function Oe(e){return G(e)?366:365}k("Y",0,0,(function(){var e=this.year();return e<=9999?R(e,4):"+"+e})),k(0,["YY",2],0,(function(){return this.year()%100})),k(0,["YYYY",4],0,"year"),k(0,["YYYYY",5],0,"year"),k(0,["YYYYYY",6,true],0,"year"),W("year","y"),Y("year",1),pe("Y",de),pe("YY",re,Z),pe("YYYY",ae,te),pe("YYYYY",ce,ie),pe("YYYYYY",ce,ie),be(["YYYYY","YYYYYY"],0),be("YYYY",(function(e,t){t[0]=2===e.length?n.parseTwoDigitYear(e):z(e)})),be("YY",(function(e,t){t[0]=n.parseTwoDigitYear(e)})),be("Y",(function(e,t){t[0]=parseInt(e,10)})),n.parseTwoDigitYear=function(e){return z(e)+(z(e)>68?1900:2e3)};var Ne=J("FullYear",true);function xe(e,t,i,r,n,s,o){var a;return e<100&&e>=0?(a=new Date(e+400,t,i,r,n,s,o),isFinite(a.getFullYear())&&a.setFullYear(e)):a=new Date(e,t,i,r,n,s,o),a}function Le(e){var t,i;return e<100&&e>=0?((i=Array.prototype.slice.call(arguments))[0]=e+400,t=new Date(Date.UTC.apply(null,i)),isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e)):t=new Date(Date.UTC.apply(null,arguments)),t}function ke(e,t,i){var r=7+t-i;return-(7+Le(e,0,r).getUTCDay()-t)%7+r-1}function Fe(e,t,i,r,n){var s,o,a=1+7*(t-1)+(7+i-r)%7+ke(e,r,n);return a<=0?o=Oe(s=e-1)+a:a>Oe(e)?(s=e+1,o=a-Oe(e)):(s=e,o=a),{year:s,dayOfYear:o}}function Ue(e,t,i){var r,n,s=ke(e.year(),t,i),o=Math.floor((e.dayOfYear()-s-1)/7)+1;return o<1?r=o+je(n=e.year()-1,t,i):o>je(e.year(),t,i)?(r=o-je(e.year(),t,i),n=e.year()+1):(n=e.year(),r=o),{week:r,year:n}}function je(e,t,i){var r=ke(e,t,i),n=ke(e+1,t,i);return(Oe(e)-r+n)/7}function We(e,t){return e.slice(t,7).concat(e.slice(0,t))}k("w",["ww",2],"wo","week"),k("W",["WW",2],"Wo","isoWeek"),W("week","w"),W("isoWeek","W"),Y("week",5),Y("isoWeek",5),pe("w",re),pe("ww",re,Z),pe("W",re),pe("WW",re,Z),ye(["w","ww","W","WW"],(function(e,t,i,r){t[r.substr(0,1)]=z(e)})),k("d",0,"do","day"),k("dd",0,0,(function(e){return this.localeData().weekdaysMin(this,e)})),k("ddd",0,0,(function(e){return this.localeData().weekdaysShort(this,e)})),k("dddd",0,0,(function(e){return this.localeData().weekdays(this,e)})),k("e",0,0,"weekday"),k("E",0,0,"isoWeekday"),W("day","d"),W("weekday","e"),W("isoWeekday","E"),Y("day",11),Y("weekday",11),Y("isoWeekday",11),pe("d",re),pe("e",re),pe("E",re),pe("dd",(function(e,t){return t.weekdaysMinRegex(e)})),pe("ddd",(function(e,t){return t.weekdaysShortRegex(e)})),pe("dddd",(function(e,t){return t.weekdaysRegex(e)})),ye(["dd","ddd","dddd"],(function(e,t,i,r){var n=i._locale.weekdaysParse(e,r,i._strict);null!=n?t.d=n:g(i).invalidWeekday=e})),ye(["d","e","E"],(function(e,t,i,r){t[r]=z(e)}));var Be="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),He="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Ve="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),Ye=fe,Ge=fe,$e=fe;function ze(e,t,i){var r,n,s,o=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],r=0;r<7;++r)s=p([2e3,1]).day(r),this._minWeekdaysParse[r]=this.weekdaysMin(s,"").toLocaleLowerCase(),this._shortWeekdaysParse[r]=this.weekdaysShort(s,"").toLocaleLowerCase(),this._weekdaysParse[r]=this.weekdays(s,"").toLocaleLowerCase();return i?"dddd"===t?-1!==(n=ve.call(this._weekdaysParse,o))?n:null:"ddd"===t?-1!==(n=ve.call(this._shortWeekdaysParse,o))?n:null:-1!==(n=ve.call(this._minWeekdaysParse,o))?n:null:"dddd"===t?-1!==(n=ve.call(this._weekdaysParse,o))||-1!==(n=ve.call(this._shortWeekdaysParse,o))||-1!==(n=ve.call(this._minWeekdaysParse,o))?n:null:"ddd"===t?-1!==(n=ve.call(this._shortWeekdaysParse,o))||-1!==(n=ve.call(this._weekdaysParse,o))||-1!==(n=ve.call(this._minWeekdaysParse,o))?n:null:-1!==(n=ve.call(this._minWeekdaysParse,o))||-1!==(n=ve.call(this._weekdaysParse,o))||-1!==(n=ve.call(this._shortWeekdaysParse,o))?n:null}function Je(){function e(e,t){return t.length-e.length}var t,i,r,n,s,o=[],a=[],c=[],l=[];for(t=0;t<7;t++)i=p([2e3,1]).day(t),r=me(this.weekdaysMin(i,"")),n=me(this.weekdaysShort(i,"")),s=me(this.weekdays(i,"")),o.push(r),a.push(n),c.push(s),l.push(r),l.push(n),l.push(s);o.sort(e),a.sort(e),c.sort(e),l.sort(e),this._weekdaysRegex=new RegExp("^("+l.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+c.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+a.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+o.join("|")+")","i")}function qe(){return this.hours()%12||12}function Ke(e,t){k(e,0,0,(function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)}))}function Xe(e,t){return t._meridiemParse}k("H",["HH",2],0,"hour"),k("h",["hh",2],0,qe),k("k",["kk",2],0,(function(){return this.hours()||24})),k("hmm",0,0,(function(){return""+qe.apply(this)+R(this.minutes(),2)})),k("hmmss",0,0,(function(){return""+qe.apply(this)+R(this.minutes(),2)+R(this.seconds(),2)})),k("Hmm",0,0,(function(){return""+this.hours()+R(this.minutes(),2)})),k("Hmmss",0,0,(function(){return""+this.hours()+R(this.minutes(),2)+R(this.seconds(),2)})),Ke("a",true),Ke("A",false),W("hour","h"),Y("hour",13),pe("a",Xe),pe("A",Xe),pe("H",re),pe("h",re),pe("k",re),pe("HH",re,Z),pe("hh",re,Z),pe("kk",re,Z),pe("hmm",ne),pe("hmmss",se),pe("Hmm",ne),pe("Hmmss",se),be(["H","HH"],3),be(["k","kk"],(function(e,t,i){var r=z(e);t[3]=24===r?0:r})),be(["a","A"],(function(e,t,i){i._isPm=i._locale.isPM(e),i._meridiem=e})),be(["h","hh"],(function(e,t,i){t[3]=z(e),g(i).bigHour=true})),be("hmm",(function(e,t,i){var r=e.length-2;t[3]=z(e.substr(0,r)),t[4]=z(e.substr(r)),g(i).bigHour=true})),be("hmmss",(function(e,t,i){var r=e.length-4,n=e.length-2;t[3]=z(e.substr(0,r)),t[4]=z(e.substr(r,2)),t[5]=z(e.substr(n)),g(i).bigHour=true})),be("Hmm",(function(e,t,i){var r=e.length-2;t[3]=z(e.substr(0,r)),t[4]=z(e.substr(r))})),be("Hmmss",(function(e,t,i){var r=e.length-4,n=e.length-2;t[3]=z(e.substr(0,r)),t[4]=z(e.substr(r,2)),t[5]=z(e.substr(n))}));var Qe,Ze=J("Hours",true),et={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:_e,monthsShort:Ee,week:{dow:0,doy:6},weekdays:Be,weekdaysMin:Ve,weekdaysShort:He,meridiemParse:/[ap]\.?m?\.?/i},tt={},it={};function rt(e,t){var i,r=Math.min(e.length,t.length);for(i=0;i<r;i+=1)if(e[i]!==t[i])return i;return r}function nt(e){return e?e.toLowerCase().replace("_","-"):e}function st(t){var r=null;if(void 0===tt[t]&&void 0!==e&&e&&e.exports&&function(e){return null!=e.match("^[^/\\\\]*$")}(t))try{r=Qe._abbr,i(425)("./"+t),ot(r)}catch(n){tt[t]=null}return tt[t]}function ot(e,t){var i;return e&&((i=l(t)?ct(e):at(e,t))?Qe=i:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),Qe._abbr}function at(e,t){if(null!==t){var i,r=et;if(t.abbr=e,null!=tt[e])P("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),r=tt[e]._config;else if(null!=t.parentLocale)if(null!=tt[t.parentLocale])r=tt[t.parentLocale]._config;else{if(null==(i=st(t.parentLocale)))return it[t.parentLocale]||(it[t.parentLocale]=[]),it[t.parentLocale].push({name:e,config:t}),null;r=i._config}return tt[e]=new D(M(r,t)),it[e]&&it[e].forEach((function(e){at(e.name,e.config)})),ot(e),tt[e]}return delete tt[e],null}function ct(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return Qe;if(!s(e)){if(t=st(e))return t;e=[e]}return function(e){for(var t,i,r,n,s=0;s<e.length;){for(t=(n=nt(e[s]).split("-")).length,i=(i=nt(e[s+1]))?i.split("-"):null;t>0;){if(r=st(n.slice(0,t).join("-")))return r;if(i&&i.length>=t&&rt(n,i)>=t-1)break;t--}s++}return Qe}(e)}function lt(e){var t,i=e._a;return i&&-2===g(e).overflow&&(t=i[1]<0||i[1]>11?1:i[2]<1||i[2]>we(i[0],i[1])?2:i[3]<0||i[3]>24||24===i[3]&&(0!==i[4]||0!==i[5]||0!==i[6])?3:i[4]<0||i[4]>59?4:i[5]<0||i[5]>59?5:i[6]<0||i[6]>999?6:-1,g(e)._overflowDayOfYear&&(t<0||t>2)&&(t=2),g(e)._overflowWeeks&&-1===t&&(t=7),g(e)._overflowWeekday&&-1===t&&(t=8),g(e).overflow=t),e}var dt=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,ut=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,ht=/Z|[+-]\d\d(?::?\d\d)?/,ft=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,false],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,false],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,false],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,false],["YYYY",/\d{4}/,false]],pt=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],gt=/^\/?Date\((-?\d+)/i,mt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,vt={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function St(e){var t,i,r,n,s,o,a=e._i,c=dt.exec(a)||ut.exec(a),l=ft.length,d=pt.length;if(c){for(g(e).iso=true,t=0,i=l;t<i;t++)if(ft[t][1].exec(c[1])){n=ft[t][0],r=false!==ft[t][2];break}if(null==n)return void(e._isValid=false);if(c[3]){for(t=0,i=d;t<i;t++)if(pt[t][1].exec(c[3])){s=(c[2]||" ")+pt[t][0];break}if(null==s)return void(e._isValid=false)}if(!r&&null!=s)return void(e._isValid=false);if(c[4]){if(!ht.exec(c[4]))return void(e._isValid=false);o="Z"}e._f=n+(s||"")+(o||""),_t(e)}else e._isValid=false}function bt(e){var t=parseInt(e,10);return t<=49?2e3+t:t<=999?1900+t:t}function yt(e){var t,i,r,n,s,o,a,c,l=mt.exec(e._i.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,""));if(l){if(i=l[4],r=l[3],n=l[2],s=l[5],o=l[6],a=l[7],c=[bt(i),Ee.indexOf(r),parseInt(n,10),parseInt(s,10),parseInt(o,10)],a&&c.push(parseInt(a,10)),t=c,!function(e,t,i){return!e||He.indexOf(e)===new Date(t[0],t[1],t[2]).getDay()||(g(i).weekdayMismatch=true,i._isValid=false,false)}(l[1],t,e))return;e._a=t,e._tzm=function(e,t,i){if(e)return vt[e];if(t)return 0;var r=parseInt(i,10),n=r%100;return(r-n)/100*60+n}(l[8],l[9],l[10]),e._d=Le.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),g(e).rfc2822=true}else e._isValid=false}function Ct(e,t,i){return null!=e?e:null!=t?t:i}function wt(e){var t,i,r,s,o,a=[];if(!e._d){for(r=function(e){var t=new Date(n.now());return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}(e),e._w&&null==e._a[2]&&null==e._a[1]&&function(e){var t,i,r,n,s,o,a,c,l;null!=(t=e._w).GG||null!=t.W||null!=t.E?(s=1,o=4,i=Ct(t.GG,e._a[0],Ue(It(),1,4).year),r=Ct(t.W,1),((n=Ct(t.E,1))<1||n>7)&&(c=true)):(s=e._locale._week.dow,o=e._locale._week.doy,l=Ue(It(),s,o),i=Ct(t.gg,e._a[0],l.year),r=Ct(t.w,l.week),null!=t.d?((n=t.d)<0||n>6)&&(c=true):null!=t.e?(n=t.e+s,(t.e<0||t.e>6)&&(c=true)):n=s),r<1||r>je(i,s,o)?g(e)._overflowWeeks=true:null!=c?g(e)._overflowWeekday=true:(a=Fe(i,r,n,s,o),e._a[0]=a.year,e._dayOfYear=a.dayOfYear)}(e),null!=e._dayOfYear&&(o=Ct(e._a[0],r[0]),(e._dayOfYear>Oe(o)||0===e._dayOfYear)&&(g(e)._overflowDayOfYear=true),i=Le(o,0,e._dayOfYear),e._a[1]=i.getUTCMonth(),e._a[2]=i.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=a[t]=r[t];for(;t<7;t++)e._a[t]=a[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[3]&&0===e._a[4]&&0===e._a[5]&&0===e._a[6]&&(e._nextDay=true,e._a[3]=0),e._d=(e._useUTC?Le:xe).apply(null,a),s=e._useUTC?e._d.getUTCDay():e._d.getDay(),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[3]=24),e._w&&void 0!==e._w.d&&e._w.d!==s&&(g(e).weekdayMismatch=true)}}function _t(e){if(e._f!==n.ISO_8601)if(e._f!==n.RFC_2822){e._a=[],g(e).empty=true;var t,i,r,s,o,a,c,l=""+e._i,d=l.length,u=0;for(c=(r=U(e._f,e._locale).match(O)||[]).length,t=0;t<c;t++)s=r[t],(i=(l.match(ge(s,e))||[])[0])&&((o=l.substr(0,l.indexOf(i))).length>0&&g(e).unusedInput.push(o),l=l.slice(l.indexOf(i)+i.length),u+=i.length),L[s]?(i?g(e).empty=false:g(e).unusedTokens.push(s),Ce(s,i,e)):e._strict&&!i&&g(e).unusedTokens.push(s);g(e).charsLeftOver=d-u,l.length>0&&g(e).unusedInput.push(l),e._a[3]<=12&&true===g(e).bigHour&&e._a[3]>0&&(g(e).bigHour=void 0),g(e).parsedDateParts=e._a.slice(0),g(e).meridiem=e._meridiem,e._a[3]=function(e,t,i){var r;return null==i?t:null!=e.meridiemHour?e.meridiemHour(t,i):null!=e.isPM?((r=e.isPM(i))&&t<12&&(t+=12),r||12!==t||(t=0),t):t}(e._locale,e._a[3],e._meridiem),null!==(a=g(e).era)&&(e._a[0]=e._locale.erasConvertYear(a,e._a[0])),wt(e),lt(e)}else yt(e);else St(e)}function Et(e){var t=e._i,i=e._f;return e._locale=e._locale||ct(e._l),null===t||void 0===i&&""===t?v({nullInput:true}):("string"==typeof t&&(e._i=t=e._locale.preparse(t)),w(t)?new C(lt(t)):(u(t)?e._d=t:s(i)?function(e){var t,i,r,n,s,o,a=false,c=e._f.length;if(0===c)return g(e).invalidFormat=true,void(e._d=new Date(NaN));for(n=0;n<c;n++)s=0,o=false,t=y({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[n],_t(t),m(t)&&(o=true),s+=g(t).charsLeftOver,s+=10*g(t).unusedTokens.length,g(t).score=s,a?s<r&&(r=s,i=t):(null==r||s<r||o)&&(r=s,i=t,o&&(a=true));f(e,i||t)}(e):i?_t(e):function(e){var t=e._i;l(t)?e._d=new Date(n.now()):u(t)?e._d=new Date(t.valueOf()):"string"==typeof t?function(e){var t=gt.exec(e._i);null===t?(St(e),false===e._isValid&&(delete e._isValid,yt(e),false===e._isValid&&(delete e._isValid,e._strict?e._isValid=false:n.createFromInputFallback(e)))):e._d=new Date(+t[1])}(e):s(t)?(e._a=h(t.slice(0),(function(e){return parseInt(e,10)})),wt(e)):o(t)?function(e){if(!e._d){var t=H(e._i),i=void 0===t.day?t.date:t.day;e._a=h([t.year,t.month,i,t.hour,t.minute,t.second,t.millisecond],(function(e){return e&&parseInt(e,10)})),wt(e)}}(e):d(t)?e._d=new Date(t):n.createFromInputFallback(e)}(e),m(e)||(e._d=null),e))}function Tt(e,t,i,r,n){var a={};return true!==t&&false!==t||(r=t,t=void 0),true!==i&&false!==i||(r=i,i=void 0),(o(e)&&c(e)||s(e)&&0===e.length)&&(e=void 0),a._isAMomentObject=true,a._useUTC=a._isUTC=n,a._l=i,a._i=e,a._f=t,a._strict=r,function(e){var t=new C(lt(Et(e)));return t._nextDay&&(t.add(1,"d"),t._nextDay=void 0),t}(a)}function It(e,t,i,r){return Tt(e,t,i,r,false)}n.createFromInputFallback=E("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",(function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))})),n.ISO_8601=function(){},n.RFC_2822=function(){};var Pt=E("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",(function(){var e=It.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:v()})),At=E("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",(function(){var e=It.apply(null,arguments);return this.isValid()&&e.isValid()?e>this?this:e:v()}));function Mt(e,t){var i,r;if(1===t.length&&s(t[0])&&(t=t[0]),!t.length)return It();for(i=t[0],r=1;r<t.length;++r)t[r].isValid()&&!t[r][e](i)||(i=t[r]);return i}var Dt=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Rt(e){var t=H(e),i=t.year||0,r=t.quarter||0,n=t.month||0,s=t.week||t.isoWeek||0,o=t.day||0,c=t.hour||0,l=t.minute||0,d=t.second||0,u=t.millisecond||0;this._isValid=function(e){var t,i,r=false,n=Dt.length;for(t in e)if(a(e,t)&&(-1===ve.call(Dt,t)||null!=e[t]&&isNaN(e[t])))return false;for(i=0;i<n;++i)if(e[Dt[i]]){if(r)return false;parseFloat(e[Dt[i]])!==z(e[Dt[i]])&&(r=true)}return true}(t),this._milliseconds=+u+1e3*d+6e4*l+1e3*c*60*60,this._days=+o+7*s,this._months=+n+3*r+12*i,this._data={},this._locale=ct(),this._bubble()}function Ot(e){return e instanceof Rt}function Nt(e){return e<0?-1*Math.round(-1*e):Math.round(e)}function xt(e,t){k(e,0,0,(function(){var e=this.utcOffset(),i="+";return e<0&&(e=-e,i="-"),i+R(~~(e/60),2)+t+R(~~e%60,2)}))}xt("Z",":"),xt("ZZ",""),pe("Z",he),pe("ZZ",he),be(["Z","ZZ"],(function(e,t,i){i._useUTC=true,i._tzm=kt(he,e)}));var Lt=/([\+\-]|\d\d)/gi;function kt(e,t){var i,r,n=(t||"").match(e);return null===n?null:0===(r=60*(i=((n[n.length-1]||[])+"").match(Lt)||["-",0,0])[1]+z(i[2]))?0:"+"===i[0]?r:-r}function Ft(e,t){var i,r;return t._isUTC?(i=t.clone(),r=(w(e)||u(e)?e.valueOf():It(e).valueOf())-i.valueOf(),i._d.setTime(i._d.valueOf()+r),n.updateOffset(i,false),i):It(e).local()}function Ut(e){return-Math.round(e._d.getTimezoneOffset())}function jt(){return!!this.isValid()&&this._isUTC&&0===this._offset}n.updateOffset=function(){};var Wt=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,Bt=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function Ht(e,t){var i,r,n,s,o,c,l=e,u=null;return Ot(e)?l={ms:e._milliseconds,d:e._days,M:e._months}:d(e)||!isNaN(+e)?(l={},t?l[t]=+e:l.milliseconds=+e):(u=Wt.exec(e))?(i="-"===u[1]?-1:1,l={y:0,d:z(u[2])*i,h:z(u[3])*i,m:z(u[4])*i,s:z(u[5])*i,ms:z(Nt(1e3*u[6]))*i}):(u=Bt.exec(e))?(i="-"===u[1]?-1:1,l={y:Vt(u[2],i),M:Vt(u[3],i),w:Vt(u[4],i),d:Vt(u[5],i),h:Vt(u[6],i),m:Vt(u[7],i),s:Vt(u[8],i)}):null==l?l={}:"object"==typeof l&&("from"in l||"to"in l)&&(s=It(l.from),o=It(l.to),n=s.isValid()&&o.isValid()?(o=Ft(o,s),s.isBefore(o)?c=Yt(s,o):((c=Yt(o,s)).milliseconds=-c.milliseconds,c.months=-c.months),c):{milliseconds:0,months:0},(l={}).ms=n.milliseconds,l.M=n.months),r=new Rt(l),Ot(e)&&a(e,"_locale")&&(r._locale=e._locale),Ot(e)&&a(e,"_isValid")&&(r._isValid=e._isValid),r}function Vt(e,t){var i=e&&parseFloat(e.replace(",","."));return(isNaN(i)?0:i)*t}function Yt(e,t){var i={};return i.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(i.months,"M").isAfter(t)&&--i.months,i.milliseconds=+t-+e.clone().add(i.months,"M"),i}function Gt(e,t){return function(i,r){var n;return null===r||isNaN(+r)||(P(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),n=i,i=r,r=n),$t(this,Ht(i,r),e),this}}function $t(e,t,i,r){var s=t._milliseconds,o=Nt(t._days),a=Nt(t._months);e.isValid()&&(r=null==r||r,a&&Me(e,q(e,"Month")+a*i),o&&K(e,"Date",q(e,"Date")+o*i),s&&e._d.setTime(e._d.valueOf()+s*i),r&&n.updateOffset(e,o||a))}Ht.fn=Rt.prototype,Ht.invalid=function(){return Ht(NaN)};var zt=Gt(1,"add"),Jt=Gt(-1,"subtract");function qt(e){return"string"==typeof e||e instanceof String}function Kt(e){return w(e)||u(e)||qt(e)||d(e)||function(e){var t=s(e),i=false;return t&&(i=0===e.filter((function(t){return!d(t)&&qt(e)})).length),t&&i}(e)||function(e){var t,i,r=o(e)&&!c(e),n=false,s=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],l=s.length;for(t=0;t<l;t+=1)i=s[t],n=n||a(e,i);return r&&n}(e)||null==e}function Xt(e){var t,i=o(e)&&!c(e),r=false,n=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"];for(t=0;t<n.length;t+=1)r=r||a(e,n[t]);return i&&r}function Qt(e,t){if(e.date()<t.date())return-Qt(t,e);var i=12*(t.year()-e.year())+(t.month()-e.month()),r=e.clone().add(i,"months");return-(i+(t-r<0?(t-r)/(r-e.clone().add(i-1,"months")):(t-r)/(e.clone().add(i+1,"months")-r)))||0}function Zt(e){var t;return void 0===e?this._locale._abbr:(null!=(t=ct(e))&&(this._locale=t),this)}n.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",n.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var ei=E("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",(function(e){return void 0===e?this.localeData():this.locale(e)}));function ti(){return this._locale}function ii(e,t){return(e%t+t)%t}function ri(e,t,i){return e<100&&e>=0?new Date(e+400,t,i)-126227808e5:new Date(e,t,i).valueOf()}function ni(e,t,i){return e<100&&e>=0?Date.UTC(e+400,t,i)-126227808e5:Date.UTC(e,t,i)}function si(e,t){return t.erasAbbrRegex(e)}function oi(){var e,t,i=[],r=[],n=[],s=[],o=this.eras();for(e=0,t=o.length;e<t;++e)r.push(me(o[e].name)),i.push(me(o[e].abbr)),n.push(me(o[e].narrow)),s.push(me(o[e].name)),s.push(me(o[e].abbr)),s.push(me(o[e].narrow));this._erasRegex=new RegExp("^("+s.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+r.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+i.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+n.join("|")+")","i")}function ai(e,t){k(0,[e,e.length],0,t)}function ci(e,t,i,r,n){var s;return null==e?Ue(this,r,n).year:(t>(s=je(e,r,n))&&(t=s),li.call(this,e,t,i,r,n))}function li(e,t,i,r,n){var s=Fe(e,t,i,r,n),o=Le(s.year,0,s.dayOfYear);return this.year(o.getUTCFullYear()),this.month(o.getUTCMonth()),this.date(o.getUTCDate()),this}k("N",0,0,"eraAbbr"),k("NN",0,0,"eraAbbr"),k("NNN",0,0,"eraAbbr"),k("NNNN",0,0,"eraName"),k("NNNNN",0,0,"eraNarrow"),k("y",["y",1],"yo","eraYear"),k("y",["yy",2],0,"eraYear"),k("y",["yyy",3],0,"eraYear"),k("y",["yyyy",4],0,"eraYear"),pe("N",si),pe("NN",si),pe("NNN",si),pe("NNNN",(function(e,t){return t.erasNameRegex(e)})),pe("NNNNN",(function(e,t){return t.erasNarrowRegex(e)})),be(["N","NN","NNN","NNNN","NNNNN"],(function(e,t,i,r){var n=i._locale.erasParse(e,r,i._strict);n?g(i).era=n:g(i).invalidEra=e})),pe("y",le),pe("yy",le),pe("yyy",le),pe("yyyy",le),pe("yo",(function(e,t){return t._eraYearOrdinalRegex||le})),be(["y","yy","yyy","yyyy"],0),be(["yo"],(function(e,t,i,r){var n;i._locale._eraYearOrdinalRegex&&(n=e.match(i._locale._eraYearOrdinalRegex)),i._locale.eraYearOrdinalParse?t[0]=i._locale.eraYearOrdinalParse(e,n):t[0]=parseInt(e,10)})),k(0,["gg",2],0,(function(){return this.weekYear()%100})),k(0,["GG",2],0,(function(){return this.isoWeekYear()%100})),ai("gggg","weekYear"),ai("ggggg","weekYear"),ai("GGGG","isoWeekYear"),ai("GGGGG","isoWeekYear"),W("weekYear","gg"),W("isoWeekYear","GG"),Y("weekYear",1),Y("isoWeekYear",1),pe("G",de),pe("g",de),pe("GG",re,Z),pe("gg",re,Z),pe("GGGG",ae,te),pe("gggg",ae,te),pe("GGGGG",ce,ie),pe("ggggg",ce,ie),ye(["gggg","ggggg","GGGG","GGGGG"],(function(e,t,i,r){t[r.substr(0,2)]=z(e)})),ye(["gg","GG"],(function(e,t,i,r){t[r]=n.parseTwoDigitYear(e)})),k("Q",0,"Qo","quarter"),W("quarter","Q"),Y("quarter",7),pe("Q",Q),be("Q",(function(e,t){t[1]=3*(z(e)-1)})),k("D",["DD",2],"Do","date"),W("date","D"),Y("date",9),pe("D",re),pe("DD",re,Z),pe("Do",(function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient})),be(["D","DD"],2),be("Do",(function(e,t){t[2]=z(e.match(re)[0])}));var di=J("Date",true);k("DDD",["DDDD",3],"DDDo","dayOfYear"),W("dayOfYear","DDD"),Y("dayOfYear",4),pe("DDD",oe),pe("DDDD",ee),be(["DDD","DDDD"],(function(e,t,i){i._dayOfYear=z(e)})),k("m",["mm",2],0,"minute"),W("minute","m"),Y("minute",14),pe("m",re),pe("mm",re,Z),be(["m","mm"],4);var ui=J("Minutes",false);k("s",["ss",2],0,"second"),W("second","s"),Y("second",15),pe("s",re),pe("ss",re,Z),be(["s","ss"],5);var hi,fi,pi=J("Seconds",false);for(k("S",0,0,(function(){return~~(this.millisecond()/100)})),k(0,["SS",2],0,(function(){return~~(this.millisecond()/10)})),k(0,["SSS",3],0,"millisecond"),k(0,["SSSS",4],0,(function(){return 10*this.millisecond()})),k(0,["SSSSS",5],0,(function(){return 100*this.millisecond()})),k(0,["SSSSSS",6],0,(function(){return 1e3*this.millisecond()})),k(0,["SSSSSSS",7],0,(function(){return 1e4*this.millisecond()})),k(0,["SSSSSSSS",8],0,(function(){return 1e5*this.millisecond()})),k(0,["SSSSSSSSS",9],0,(function(){return 1e6*this.millisecond()})),W("millisecond","ms"),Y("millisecond",16),pe("S",oe,Q),pe("SS",oe,Z),pe("SSS",oe,ee),hi="SSSS";hi.length<=9;hi+="S")pe(hi,le);function gi(e,t){t[6]=z(1e3*("0."+e))}for(hi="S";hi.length<=9;hi+="S")be(hi,gi);fi=J("Milliseconds",false),k("z",0,0,"zoneAbbr"),k("zz",0,0,"zoneName");var mi=C.prototype;function vi(e){return e}mi.add=zt,mi.calendar=function(e,t){1===arguments.length&&(arguments[0]?Kt(arguments[0])?(e=arguments[0],t=void 0):Xt(arguments[0])&&(t=arguments[0],e=void 0):(e=void 0,t=void 0));var i=e||It(),r=Ft(i,this).startOf("day"),s=n.calendarFormat(this,r)||"sameElse",o=t&&(A(t[s])?t[s].call(this,i):t[s]);return this.format(o||this.localeData().calendar(s,this,It(i)))},mi.clone=function(){return new C(this)},mi.diff=function(e,t,i){var r,n,s;if(!this.isValid())return NaN;if(!(r=Ft(e,this)).isValid())return NaN;switch(n=6e4*(r.utcOffset()-this.utcOffset()),t=B(t)){case"year":s=Qt(this,r)/12;break;case"month":s=Qt(this,r);break;case"quarter":s=Qt(this,r)/3;break;case"second":s=(this-r)/1e3;break;case"minute":s=(this-r)/6e4;break;case"hour":s=(this-r)/36e5;break;case"day":s=(this-r-n)/864e5;break;case"week":s=(this-r-n)/6048e5;break;default:s=this-r}return i?s:$(s)},mi.endOf=function(e){var t,i;if(void 0===(e=B(e))||"millisecond"===e||!this.isValid())return this;switch(i=this._isUTC?ni:ri,e){case"year":t=i(this.year()+1,0,1)-1;break;case"quarter":t=i(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":t=i(this.year(),this.month()+1,1)-1;break;case"week":t=i(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":t=i(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":t=i(this.year(),this.month(),this.date()+1)-1;break;case"hour":t=this._d.valueOf(),t+=36e5-ii(t+(this._isUTC?0:6e4*this.utcOffset()),36e5)-1;break;case"minute":t=this._d.valueOf(),t+=6e4-ii(t,6e4)-1;break;case"second":t=this._d.valueOf(),t+=1e3-ii(t,1e3)-1}return this._d.setTime(t),n.updateOffset(this,true),this},mi.format=function(e){e||(e=this.isUtc()?n.defaultFormatUtc:n.defaultFormat);var t=F(this,e);return this.localeData().postformat(t)},mi.from=function(e,t){return this.isValid()&&(w(e)&&e.isValid()||It(e).isValid())?Ht({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},mi.fromNow=function(e){return this.from(It(),e)},mi.to=function(e,t){return this.isValid()&&(w(e)&&e.isValid()||It(e).isValid())?Ht({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},mi.toNow=function(e){return this.to(It(),e)},mi.get=function(e){return A(this[e=B(e)])?this[e]():this},mi.invalidAt=function(){return g(this).overflow},mi.isAfter=function(e,t){var i=w(e)?e:It(e);return!(!this.isValid()||!i.isValid())&&("millisecond"===(t=B(t)||"millisecond")?this.valueOf()>i.valueOf():i.valueOf()<this.clone().startOf(t).valueOf())},mi.isBefore=function(e,t){var i=w(e)?e:It(e);return!(!this.isValid()||!i.isValid())&&("millisecond"===(t=B(t)||"millisecond")?this.valueOf()<i.valueOf():this.clone().endOf(t).valueOf()<i.valueOf())},mi.isBetween=function(e,t,i,r){var n=w(e)?e:It(e),s=w(t)?t:It(t);return!!(this.isValid()&&n.isValid()&&s.isValid())&&(("("===(r=r||"()")[0]?this.isAfter(n,i):!this.isBefore(n,i))&&(")"===r[1]?this.isBefore(s,i):!this.isAfter(s,i)))},mi.isSame=function(e,t){var i,r=w(e)?e:It(e);return!(!this.isValid()||!r.isValid())&&("millisecond"===(t=B(t)||"millisecond")?this.valueOf()===r.valueOf():(i=r.valueOf(),this.clone().startOf(t).valueOf()<=i&&i<=this.clone().endOf(t).valueOf()))},mi.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},mi.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)},mi.isValid=function(){return m(this)},mi.lang=ei,mi.locale=Zt,mi.localeData=ti,mi.max=At,mi.min=Pt,mi.parsingFlags=function(){return f({},g(this))},mi.set=function(e,t){if("object"==typeof e){var i,r=function(e){var t,i=[];for(t in e)a(e,t)&&i.push({unit:t,priority:V[t]});return i.sort((function(e,t){return e.priority-t.priority})),i}(e=H(e)),n=r.length;for(i=0;i<n;i++)this[r[i].unit](e[r[i].unit])}else if(A(this[e=B(e)]))return this[e](t);return this},mi.startOf=function(e){var t,i;if(void 0===(e=B(e))||"millisecond"===e||!this.isValid())return this;switch(i=this._isUTC?ni:ri,e){case"year":t=i(this.year(),0,1);break;case"quarter":t=i(this.year(),this.month()-this.month()%3,1);break;case"month":t=i(this.year(),this.month(),1);break;case"week":t=i(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":t=i(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":t=i(this.year(),this.month(),this.date());break;case"hour":t=this._d.valueOf(),t-=ii(t+(this._isUTC?0:6e4*this.utcOffset()),36e5);break;case"minute":t=this._d.valueOf(),t-=ii(t,6e4);break;case"second":t=this._d.valueOf(),t-=ii(t,1e3)}return this._d.setTime(t),n.updateOffset(this,true),this},mi.subtract=Jt,mi.toArray=function(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},mi.toObject=function(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},mi.toDate=function(){return new Date(this.valueOf())},mi.toISOString=function(e){if(!this.isValid())return null;var t=true!==e,i=t?this.clone().utc():this;return i.year()<0||i.year()>9999?F(i,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):A(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",F(i,"Z")):F(i,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},mi.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e,t,i,r="moment",n="";return this.isLocal()||(r=0===this.utcOffset()?"moment.utc":"moment.parseZone",n="Z"),e="["+r+'("]',t=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",i=n+'[")]',this.format(e+t+"-MM-DD[T]HH:mm:ss.SSS"+i)},"undefined"!=typeof Symbol&&null!=Symbol.for&&(mi[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),mi.toJSON=function(){return this.isValid()?this.toISOString():null},mi.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},mi.unix=function(){return Math.floor(this.valueOf()/1e3)},mi.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},mi.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},mi.eraName=function(){var e,t,i,r=this.localeData().eras();for(e=0,t=r.length;e<t;++e){if(i=this.clone().startOf("day").valueOf(),r[e].since<=i&&i<=r[e].until)return r[e].name;if(r[e].until<=i&&i<=r[e].since)return r[e].name}return""},mi.eraNarrow=function(){var e,t,i,r=this.localeData().eras();for(e=0,t=r.length;e<t;++e){if(i=this.clone().startOf("day").valueOf(),r[e].since<=i&&i<=r[e].until)return r[e].narrow;if(r[e].until<=i&&i<=r[e].since)return r[e].narrow}return""},mi.eraAbbr=function(){var e,t,i,r=this.localeData().eras();for(e=0,t=r.length;e<t;++e){if(i=this.clone().startOf("day").valueOf(),r[e].since<=i&&i<=r[e].until)return r[e].abbr;if(r[e].until<=i&&i<=r[e].since)return r[e].abbr}return""},mi.eraYear=function(){var e,t,i,r,s=this.localeData().eras();for(e=0,t=s.length;e<t;++e)if(i=s[e].since<=s[e].until?1:-1,r=this.clone().startOf("day").valueOf(),s[e].since<=r&&r<=s[e].until||s[e].until<=r&&r<=s[e].since)return(this.year()-n(s[e].since).year())*i+s[e].offset;return this.year()},mi.year=Ne,mi.isLeapYear=function(){return G(this.year())},mi.weekYear=function(e){return ci.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},mi.isoWeekYear=function(e){return ci.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)},mi.quarter=mi.quarters=function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},mi.month=De,mi.daysInMonth=function(){return we(this.year(),this.month())},mi.week=mi.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},mi.isoWeek=mi.isoWeeks=function(e){var t=Ue(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},mi.weeksInYear=function(){var e=this.localeData()._week;return je(this.year(),e.dow,e.doy)},mi.weeksInWeekYear=function(){var e=this.localeData()._week;return je(this.weekYear(),e.dow,e.doy)},mi.isoWeeksInYear=function(){return je(this.year(),1,4)},mi.isoWeeksInISOWeekYear=function(){return je(this.isoWeekYear(),1,4)},mi.date=di,mi.day=mi.days=function(e){if(!this.isValid())return null!=e?this:NaN;var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=function(e,t){return"string"!=typeof e?e:isNaN(e)?"number"==typeof(e=t.weekdaysParse(e))?e:null:parseInt(e,10)}(e,this.localeData()),this.add(e-t,"d")):t},mi.weekday=function(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},mi.isoWeekday=function(e){if(!this.isValid())return null!=e?this:NaN;if(null!=e){var t=function(e,t){return"string"==typeof e?t.weekdaysParse(e)%7||7:isNaN(e)?null:e}(e,this.localeData());return this.day(this.day()%7?t:t-7)}return this.day()||7},mi.dayOfYear=function(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},mi.hour=mi.hours=Ze,mi.minute=mi.minutes=ui,mi.second=mi.seconds=pi,mi.millisecond=mi.milliseconds=fi,mi.utcOffset=function(e,t,i){var r,s=this._offset||0;if(!this.isValid())return null!=e?this:NaN;if(null!=e){if("string"==typeof e){if(null===(e=kt(he,e)))return this}else Math.abs(e)<16&&!i&&(e*=60);return!this._isUTC&&t&&(r=Ut(this)),this._offset=e,this._isUTC=true,null!=r&&this.add(r,"m"),s!==e&&(!t||this._changeInProgress?$t(this,Ht(e-s,"m"),1,false):this._changeInProgress||(this._changeInProgress=true,n.updateOffset(this,true),this._changeInProgress=null)),this}return this._isUTC?s:Ut(this)},mi.utc=function(e){return this.utcOffset(0,e)},mi.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=false,e&&this.subtract(Ut(this),"m")),this},mi.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,false,true);else if("string"==typeof this._i){var e=kt(ue,this._i);null!=e?this.utcOffset(e):this.utcOffset(0,true)}return this},mi.hasAlignedHourOffset=function(e){return!!this.isValid()&&(e=e?It(e).utcOffset():0,(this.utcOffset()-e)%60==0)},mi.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},mi.isLocal=function(){return!!this.isValid()&&!this._isUTC},mi.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},mi.isUtc=jt,mi.isUTC=jt,mi.zoneAbbr=function(){return this._isUTC?"UTC":""},mi.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},mi.dates=E("dates accessor is deprecated. Use date instead.",di),mi.months=E("months accessor is deprecated. Use month instead",De),mi.years=E("years accessor is deprecated. Use year instead",Ne),mi.zone=E("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",(function(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()})),mi.isDSTShifted=E("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",(function(){if(!l(this._isDSTShifted))return this._isDSTShifted;var e,t={};return y(t,this),(t=Et(t))._a?(e=t._isUTC?p(t._a):It(t._a),this._isDSTShifted=this.isValid()&&function(e,t,i){var r,n=Math.min(e.length,t.length),s=Math.abs(e.length-t.length),o=0;for(r=0;r<n;r++)(i&&e[r]!==t[r]||!i&&z(e[r])!==z(t[r]))&&o++;return o+s}(t._a,e.toArray())>0):this._isDSTShifted=false,this._isDSTShifted}));var Si=D.prototype;function bi(e,t,i,r){var n=ct(),s=p().set(r,t);return n[i](s,e)}function yi(e,t,i){if(d(e)&&(t=e,e=void 0),e=e||"",null!=t)return bi(e,t,i,"month");var r,n=[];for(r=0;r<12;r++)n[r]=bi(e,r,i,"month");return n}function Ci(e,t,i,r){"boolean"==typeof e?(d(t)&&(i=t,t=void 0),t=t||""):(i=t=e,e=false,d(t)&&(i=t,t=void 0),t=t||"");var n,s=ct(),o=e?s._week.dow:0,a=[];if(null!=i)return bi(t,(i+o)%7,r,"day");for(n=0;n<7;n++)a[n]=bi(t,(n+o)%7,r,"day");return a}Si.calendar=function(e,t,i){var r=this._calendar[e]||this._calendar.sameElse;return A(r)?r.call(t,i):r},Si.longDateFormat=function(e){var t=this._longDateFormat[e],i=this._longDateFormat[e.toUpperCase()];return t||!i?t:(this._longDateFormat[e]=i.match(O).map((function(e){return"MMMM"===e||"MM"===e||"DD"===e||"dddd"===e?e.slice(1):e})).join(""),this._longDateFormat[e])},Si.invalidDate=function(){return this._invalidDate},Si.ordinal=function(e){return this._ordinal.replace("%d",e)},Si.preparse=vi,Si.postformat=vi,Si.relativeTime=function(e,t,i,r){var n=this._relativeTime[i];return A(n)?n(e,t,i,r):n.replace(/%d/i,e)},Si.pastFuture=function(e,t){var i=this._relativeTime[e>0?"future":"past"];return A(i)?i(t):i.replace(/%s/i,t)},Si.set=function(e){var t,i;for(i in e)a(e,i)&&(A(t=e[i])?this[i]=t:this["_"+i]=t);this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},Si.eras=function(e,t){var i,r,s,o=this._eras||ct("en")._eras;for(i=0,r=o.length;i<r;++i){switch(typeof o[i].since){case"string":s=n(o[i].since).startOf("day"),o[i].since=s.valueOf()}switch(typeof o[i].until){case"undefined":o[i].until=1/0;break;case"string":s=n(o[i].until).startOf("day").valueOf(),o[i].until=s.valueOf()}}return o},Si.erasParse=function(e,t,i){var r,n,s,o,a,c=this.eras();for(e=e.toUpperCase(),r=0,n=c.length;r<n;++r)if(s=c[r].name.toUpperCase(),o=c[r].abbr.toUpperCase(),a=c[r].narrow.toUpperCase(),i)switch(t){case"N":case"NN":case"NNN":if(o===e)return c[r];break;case"NNNN":if(s===e)return c[r];break;case"NNNNN":if(a===e)return c[r]}else if([s,o,a].indexOf(e)>=0)return c[r]},Si.erasConvertYear=function(e,t){var i=e.since<=e.until?1:-1;return void 0===t?n(e.since).year():n(e.since).year()+(t-e.offset)*i},Si.erasAbbrRegex=function(e){return a(this,"_erasAbbrRegex")||oi.call(this),e?this._erasAbbrRegex:this._erasRegex},Si.erasNameRegex=function(e){return a(this,"_erasNameRegex")||oi.call(this),e?this._erasNameRegex:this._erasRegex},Si.erasNarrowRegex=function(e){return a(this,"_erasNarrowRegex")||oi.call(this),e?this._erasNarrowRegex:this._erasRegex},Si.months=function(e,t){return e?s(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||Te).test(t)?"format":"standalone"][e.month()]:s(this._months)?this._months:this._months.standalone},Si.monthsShort=function(e,t){return e?s(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[Te.test(t)?"format":"standalone"][e.month()]:s(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},Si.monthsParse=function(e,t,i){var r,n,s;if(this._monthsParseExact)return Ae.call(this,e,t,i);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),r=0;r<12;r++){if(n=p([2e3,r]),i&&!this._longMonthsParse[r]&&(this._longMonthsParse[r]=new RegExp("^"+this.months(n,"").replace(".","")+"$","i"),this._shortMonthsParse[r]=new RegExp("^"+this.monthsShort(n,"").replace(".","")+"$","i")),i||this._monthsParse[r]||(s="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[r]=new RegExp(s.replace(".",""),"i")),i&&"MMMM"===t&&this._longMonthsParse[r].test(e))return r;if(i&&"MMM"===t&&this._shortMonthsParse[r].test(e))return r;if(!i&&this._monthsParse[r].test(e))return r}},Si.monthsRegex=function(e){return this._monthsParseExact?(a(this,"_monthsRegex")||Re.call(this),e?this._monthsStrictRegex:this._monthsRegex):(a(this,"_monthsRegex")||(this._monthsRegex=Pe),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},Si.monthsShortRegex=function(e){return this._monthsParseExact?(a(this,"_monthsRegex")||Re.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(a(this,"_monthsShortRegex")||(this._monthsShortRegex=Ie),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},Si.week=function(e){return Ue(e,this._week.dow,this._week.doy).week},Si.firstDayOfYear=function(){return this._week.doy},Si.firstDayOfWeek=function(){return this._week.dow},Si.weekdays=function(e,t){var i=s(this._weekdays)?this._weekdays:this._weekdays[e&&true!==e&&this._weekdays.isFormat.test(t)?"format":"standalone"];return true===e?We(i,this._week.dow):e?i[e.day()]:i},Si.weekdaysMin=function(e){return true===e?We(this._weekdaysMin,this._week.dow):e?this._weekdaysMin[e.day()]:this._weekdaysMin},Si.weekdaysShort=function(e){return true===e?We(this._weekdaysShort,this._week.dow):e?this._weekdaysShort[e.day()]:this._weekdaysShort},Si.weekdaysParse=function(e,t,i){var r,n,s;if(this._weekdaysParseExact)return ze.call(this,e,t,i);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),r=0;r<7;r++){if(n=p([2e3,1]).day(r),i&&!this._fullWeekdaysParse[r]&&(this._fullWeekdaysParse[r]=new RegExp("^"+this.weekdays(n,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[r]=new RegExp("^"+this.weekdaysShort(n,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[r]=new RegExp("^"+this.weekdaysMin(n,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[r]||(s="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[r]=new RegExp(s.replace(".",""),"i")),i&&"dddd"===t&&this._fullWeekdaysParse[r].test(e))return r;if(i&&"ddd"===t&&this._shortWeekdaysParse[r].test(e))return r;if(i&&"dd"===t&&this._minWeekdaysParse[r].test(e))return r;if(!i&&this._weekdaysParse[r].test(e))return r}},Si.weekdaysRegex=function(e){return this._weekdaysParseExact?(a(this,"_weekdaysRegex")||Je.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(a(this,"_weekdaysRegex")||(this._weekdaysRegex=Ye),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},Si.weekdaysShortRegex=function(e){return this._weekdaysParseExact?(a(this,"_weekdaysRegex")||Je.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(a(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=Ge),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},Si.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(a(this,"_weekdaysRegex")||Je.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(a(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=$e),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},Si.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)},Si.meridiem=function(e,t,i){return e>11?i?"pm":"PM":i?"am":"AM"},ot("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1===z(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),n.lang=E("moment.lang is deprecated. Use moment.locale instead.",ot),n.langData=E("moment.langData is deprecated. Use moment.localeData instead.",ct);var wi=Math.abs;function _i(e,t,i,r){var n=Ht(t,i);return e._milliseconds+=r*n._milliseconds,e._days+=r*n._days,e._months+=r*n._months,e._bubble()}function Ei(e){return e<0?Math.floor(e):Math.ceil(e)}function Ti(e){return 4800*e/146097}function Ii(e){return 146097*e/4800}function Pi(e){return function(){return this.as(e)}}var Ai=Pi("ms"),Mi=Pi("s"),Di=Pi("m"),Ri=Pi("h"),Oi=Pi("d"),Ni=Pi("w"),xi=Pi("M"),Li=Pi("Q"),ki=Pi("y");function Fi(e){return function(){return this.isValid()?this._data[e]:NaN}}var Ui=Fi("milliseconds"),ji=Fi("seconds"),Wi=Fi("minutes"),Bi=Fi("hours"),Hi=Fi("days"),Vi=Fi("months"),Yi=Fi("years"),Gi=Math.round,$i={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function zi(e,t,i,r,n){return n.relativeTime(t||1,!!i,e,r)}var Ji=Math.abs;function qi(e){return(e>0)-(e<0)||+e}function Ki(){if(!this.isValid())return this.localeData().invalidDate();var e,t,i,r,n,s,o,a,c=Ji(this._milliseconds)/1e3,l=Ji(this._days),d=Ji(this._months),u=this.asSeconds();return u?(e=$(c/60),t=$(e/60),c%=60,e%=60,i=$(d/12),d%=12,r=c?c.toFixed(3).replace(/\.?0+$/,""):"",n=u<0?"-":"",s=qi(this._months)!==qi(u)?"-":"",o=qi(this._days)!==qi(u)?"-":"",a=qi(this._milliseconds)!==qi(u)?"-":"",n+"P"+(i?s+i+"Y":"")+(d?s+d+"M":"")+(l?o+l+"D":"")+(t||e||c?"T":"")+(t?a+t+"H":"")+(e?a+e+"M":"")+(c?a+r+"S":"")):"P0D"}var Xi=Rt.prototype;return Xi.isValid=function(){return this._isValid},Xi.abs=function(){var e=this._data;return this._milliseconds=wi(this._milliseconds),this._days=wi(this._days),this._months=wi(this._months),e.milliseconds=wi(e.milliseconds),e.seconds=wi(e.seconds),e.minutes=wi(e.minutes),e.hours=wi(e.hours),e.months=wi(e.months),e.years=wi(e.years),this},Xi.add=function(e,t){return _i(this,e,t,1)},Xi.subtract=function(e,t){return _i(this,e,t,-1)},Xi.as=function(e){if(!this.isValid())return NaN;var t,i,r=this._milliseconds;if("month"===(e=B(e))||"quarter"===e||"year"===e)switch(t=this._days+r/864e5,i=this._months+Ti(t),e){case"month":return i;case"quarter":return i/3;case"year":return i/12}else switch(t=this._days+Math.round(Ii(this._months)),e){case"week":return t/7+r/6048e5;case"day":return t+r/864e5;case"hour":return 24*t+r/36e5;case"minute":return 1440*t+r/6e4;case"second":return 86400*t+r/1e3;case"millisecond":return Math.floor(864e5*t)+r;default:throw new Error("Unknown unit "+e)}},Xi.asMilliseconds=Ai,Xi.asSeconds=Mi,Xi.asMinutes=Di,Xi.asHours=Ri,Xi.asDays=Oi,Xi.asWeeks=Ni,Xi.asMonths=xi,Xi.asQuarters=Li,Xi.asYears=ki,Xi.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*z(this._months/12):NaN},Xi._bubble=function(){var e,t,i,r,n,s=this._milliseconds,o=this._days,a=this._months,c=this._data;return s>=0&&o>=0&&a>=0||s<=0&&o<=0&&a<=0||(s+=864e5*Ei(Ii(a)+o),o=0,a=0),c.milliseconds=s%1e3,e=$(s/1e3),c.seconds=e%60,t=$(e/60),c.minutes=t%60,i=$(t/60),c.hours=i%24,o+=$(i/24),n=$(Ti(o)),a+=n,o-=Ei(Ii(n)),r=$(a/12),a%=12,c.days=o,c.months=a,c.years=r,this},Xi.clone=function(){return Ht(this)},Xi.get=function(e){return e=B(e),this.isValid()?this[e+"s"]():NaN},Xi.milliseconds=Ui,Xi.seconds=ji,Xi.minutes=Wi,Xi.hours=Bi,Xi.days=Hi,Xi.weeks=function(){return $(this.days()/7)},Xi.months=Vi,Xi.years=Yi,Xi.humanize=function(e,t){if(!this.isValid())return this.localeData().invalidDate();var i,r,n=false,s=$i;return"object"==typeof e&&(t=e,e=false),"boolean"==typeof e&&(n=e),"object"==typeof t&&(s=Object.assign({},$i,t),null!=t.s&&null==t.ss&&(s.ss=t.s-1)),i=this.localeData(),r=function(e,t,i,r){var n=Ht(e).abs(),s=Gi(n.as("s")),o=Gi(n.as("m")),a=Gi(n.as("h")),c=Gi(n.as("d")),l=Gi(n.as("M")),d=Gi(n.as("w")),u=Gi(n.as("y")),h=s<=i.ss&&["s",s]||s<i.s&&["ss",s]||o<=1&&["m"]||o<i.m&&["mm",o]||a<=1&&["h"]||a<i.h&&["hh",a]||c<=1&&["d"]||c<i.d&&["dd",c];return null!=i.w&&(h=h||d<=1&&["w"]||d<i.w&&["ww",d]),(h=h||l<=1&&["M"]||l<i.M&&["MM",l]||u<=1&&["y"]||["yy",u])[2]=t,h[3]=+e>0,h[4]=r,zi.apply(null,h)}(this,!n,s,i),n&&(r=i.pastFuture(+this,r)),i.postformat(r)},Xi.toISOString=Ki,Xi.toString=Ki,Xi.toJSON=Ki,Xi.locale=Zt,Xi.localeData=ti,Xi.toIsoString=E("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Ki),Xi.lang=ei,k("X",0,0,"unix"),k("x",0,0,"valueOf"),pe("x",de),pe("X",/[+-]?\d+(\.\d{1,3})?/),be("X",(function(e,t,i){i._d=new Date(1e3*parseFloat(e))})),be("x",(function(e,t,i){i._d=new Date(z(e))})),//! moment.js
n.version="2.29.3",t=It,n.fn=mi,n.min=function(){var e=[].slice.call(arguments,0);return Mt("isBefore",e)},n.max=function(){var e=[].slice.call(arguments,0);return Mt("isAfter",e)},n.now=function(){return Date.now?Date.now():+new Date},n.utc=p,n.unix=function(e){return It(1e3*e)},n.months=function(e,t){return yi(e,t,"months")},n.isDate=u,n.locale=ot,n.invalid=v,n.duration=Ht,n.isMoment=w,n.weekdays=function(e,t,i){return Ci(e,t,i,"weekdays")},n.parseZone=function(){return It.apply(null,arguments).parseZone()},n.localeData=ct,n.isDuration=Ot,n.monthsShort=function(e,t){return yi(e,t,"monthsShort")},n.weekdaysMin=function(e,t,i){return Ci(e,t,i,"weekdaysMin")},n.defineLocale=at,n.updateLocale=function(e,t){if(null!=t){var i,r,n=et;null!=tt[e]&&null!=tt[e].parentLocale?tt[e].set(M(tt[e]._config,t)):(null!=(r=st(e))&&(n=r._config),t=M(n,t),null==r&&(t.abbr=e),(i=new D(t)).parentLocale=tt[e],tt[e]=i),ot(e)}else null!=tt[e]&&(null!=tt[e].parentLocale?(tt[e]=tt[e].parentLocale,e===ot()&&ot(e)):null!=tt[e]&&delete tt[e]);return tt[e]},n.locales=function(){return T(tt)},n.weekdaysShort=function(e,t,i){return Ci(e,t,i,"weekdaysShort")},n.normalizeUnits=B,n.relativeTimeRounding=function(e){return void 0===e?Gi:"function"==typeof e&&(Gi=e,true)},n.relativeTimeThreshold=function(e,t){return void 0!==$i[e]&&(void 0===t?$i[e]:($i[e]=t,"s"===e&&($i.ss=t-1),true))},n.calendarFormat=function(e,t){var i=e.diff(t,"days",true);return i<-6?"sameElse":i<-1?"lastWeek":i<0?"lastDay":i<1?"sameDay":i<2?"nextDay":i<7?"nextWeek":"sameElse"},n.prototype=mi,n.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},n}()}).call(this,i(424)(e))},function(e,t,i){i.d(t,"a",(function(){return d}));var r=i(0),n=i(45),s=i(92),o=i(10),a=i(74),c=i(26),l=i(60),d=function(e){function t(i,r,n){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=false,o.syncErrorThrowable=false,o.isStopped=false,arguments.length){case 0:o.destination=s.a;break;case 1:if(!i){o.destination=s.a;break}if("object"==typeof i){i instanceof t?(o.syncErrorThrowable=i.syncErrorThrowable,o.destination=i,i.add(o)):(o.syncErrorThrowable=true,o.destination=new u(o,i));break}default:o.syncErrorThrowable=true,o.destination=new u(o,i,r,n)}return o}return r.a(t,e),t.prototype[a.a]=function(){return this},t.create=function(e,i,r){var n=new t(e,i,r);return n.syncErrorThrowable=false,n},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=true,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=true,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=true,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=false,this.isStopped=false,this._parentOrParents=e,this},t}(o.a),u=function(e){function t(t,i,r,o){var a,c=e.call(this)||this;c._parentSubscriber=t;var l=c;return Object(n.a)(i)?a=i:i&&(a=i.next,r=i.error,o=i.complete,i!==s.a&&(l=Object.create(i),Object(n.a)(l.unsubscribe)&&c.add(l.unsubscribe.bind(l)),l.unsubscribe=c.unsubscribe.bind(c))),c._context=l,c._next=a,c._error=r,c._complete=o,c}return r.a(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;c.a.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,i=c.a.useDeprecatedSynchronousErrorHandling;if(this._error)i&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)i?(t.syncErrorValue=e,t.syncErrorThrown=true):Object(l.a)(e),this.unsubscribe();else{if(this.unsubscribe(),i)throw e;Object(l.a)(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var i=function(){return e._complete.call(e._context)};c.a.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,i),this.unsubscribe()):(this.__tryOrUnsub(i),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(dp){if(this.unsubscribe(),c.a.useDeprecatedSynchronousErrorHandling)throw dp;Object(l.a)(dp)}},t.prototype.__tryOrSetError=function(e,t,i){if(!c.a.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,i)}catch(dp){return c.a.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=dp,e.syncErrorThrown=true,true):(Object(l.a)(dp),true)}return false},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(d)},function(e,t,i){i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return l}));var r=i(0),n=i(2),s=i(5),o=i(59),a=function(e){function t(t){var i=e.call(this)||this;return i.parent=t,i}return r.a(t,e),t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(n.a),c=(n.a,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.a(t,e),t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(n.a));n.a;function l(e,t){if(!t.closed)return e instanceof s.a?e.subscribe(t):Object(o.a)(e)(t)}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(19);class n{constructor(){this.colors={trace:"color:blue",debug:"color:gray",info:"color:teal",infoBlue:"color:white; background: blue",infoRed:"color:white; background: red",infoOrange:"color:black; background: orange",log:"color:teal",warn:"color:red",error:"color:red",webrtc:"color:green"},this.logsBuffer=[],this.enableConsoleLog=false,this.desktopMode=false,this.externalLogger=null,this.settingsService=r.SettingsService.getInstance();window.LoggerService=this,this.computeConsoleStatus(),this.settingsService.subscribeUpdateEvent("SETTINGS_UPDATED",(()=>{this.computeConsoleStatus()}));const e=navigator.userAgent.toLowerCase();this.desktopMode=e.indexOf("qtwebengine")>-1||e.indexOf("electron/")>-1}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.loggerService||(e.rainbow.loggerService=new n),e.rainbow.loggerService}computeConsoleStatus(){"true"===this.settingsService.getSetting("forceConsoleLog")?this.enableConsoleLog=true:this.enableConsoleLog=window.config&&window.config.consoleLog||false}configure(e){this.externalLogger=e}error(e){this.externalLogger?this.externalLogger.error(e):this.logger("error",e)}warn(e){this.externalLogger?this.externalLogger.info(e):this.logger("warn",e)}info(e){this.externalLogger?this.externalLogger.info(e):this.logger("info",e)}infoBlue(e){this.externalLogger?this.externalLogger.info(e):this.logger("infoBlue",e)}infoOrange(e){this.externalLogger?this.externalLogger.info(e):this.logger("infoOrange",e)}infoRed(e){this.externalLogger?this.externalLogger.info(e):this.logger("infoRed",e)}log(e){this.externalLogger?this.externalLogger.debug(e):this.logger("log",e)}debug(e){this.externalLogger?this.externalLogger.debug(e):this.logger("debug",e)}webrtc(e){this.externalLogger?this.externalLogger.webrtc(e):this.logger("info",e)}sdk(e){this.externalLogger?this.externalLogger.webrtc(e):this.logger("info","[SDK] -- "+e)}getLogs(){return this.logsBuffer}logger(e,t){let i=e;switch(e){case"infoRed":case"infoOrange":case"infoBlue":i="info"}const r=console;if(this.desktopMode)r[i](`${i.toUpperCase()} ${t}`);else{const n=6e4*(new Date).getTimezoneOffset(),s=`${new Date(Date.now()-n).toISOString().slice(0,-1)} ${i.toUpperCase()} ${t}`;this.enableConsoleLog&&r[i]("%c "+s,this.colors[e]),6e3===this.logsBuffer.length&&this.logsBuffer.shift(),this.logsBuffer.push(s+"\n")}}}t.LoggerService=n},function(e,t,i){var r=i(89),n=i(2),s=i(74),o=i(92);var a=i(40),c=i(72),l=i(26);i.d(t,"a",(function(){return d}));var d=function(){function e(e){this._isScalar=false,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var i=new e;return i.source=this,i.operator=t,i},e.prototype.subscribe=function(e,t,i){var r=this.operator,a=function(e,t,i){if(e){if(e instanceof n.a)return e;if(e[s.a])return e[s.a]()}return e||t||i?new n.a(e,t,i):new n.a(o.a)}(e,t,i);if(r?a.add(r.call(a,this.source)):a.add(this.source||l.a.useDeprecatedSynchronousErrorHandling&&!a.syncErrorThrowable?this._subscribe(a):this._trySubscribe(a)),l.a.useDeprecatedSynchronousErrorHandling&&a.syncErrorThrowable&&(a.syncErrorThrowable=false,a.syncErrorThrown))throw a.syncErrorValue;return a},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(dp){l.a.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=true,e.syncErrorValue=dp),Object(r.a)(e)?e.error(dp):console.warn(dp)}},e.prototype.forEach=function(e,t){var i=this;return new(t=u(t))((function(t,r){var n;n=i.subscribe((function(t){try{e(t)}catch(dp){r(dp),n&&n.unsubscribe()}}),r,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[a.a]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:Object(c.b)(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=u(e))((function(e,i){var r;t.subscribe((function(e){return r=e}),(function(e){return i(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function u(e){if(e||(e=l.a.Promise||Promise),!e)throw new Error("no Promise impl found");return e}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(11),n=i(17),s=i(4),o=i(13),a=i(19),c=i(8),l=i(46),d=i(151),u=i(9),h=i(65),f=i(105),p=i(106),g=i(7),m=i(18),v=i(137),S=i(138),b=i(71),y=i(103),C=i(136);class w{constructor(){this.userContact=null,this.contacts={},this.dbContacts={},this.jtelContacts={},this.currentLanguage=null,this.eventService=r.EventService.getInstance(),this.settingsService=a.SettingsService.getInstance(),this.mainService=n.MainService.getInstance(),this.logger=s.LoggerService.getInstance(),this.errorHelperService=o.ErrorHelperService.getInstance(),this.authService=c.AuthService.getInstance(),this.i18nService=l.I18nService.getInstance(),this.companyService=d.CompanyService.getInstance(),this.xmppService=u.XmppService.getInstance(),this.rxSubject=new g.Subject,this.subscriptions=[],this._displayOrder=null,this.contactLastActivityInterval=null,this.calendarPresenceEventHandlerCleaner=null,this.xmppConnectionSubscription=null,this.presentationModeEventHandlerCleaner=null,this.msTeamsPresenceEventHandlerCleaner=null,this.subscriptionPromiseQueue=f.PromiseQueue.create(),this.getContactPromises=[],this.contactConfigRef=null,this.lastUpdatePresentationMode=null,this.presentationModeTimeout=null,this.presentationModeActive=false,this.awayStateActive=false,this.busyState={status:null,message:null},this.manualState=false,this.dndStateActivated=false}getDisplayOrder(){return this._displayOrder}setDisplayOrder(e){this._displayOrder=e,Object.keys(this.contacts).forEach((t=>{const i=this.contacts[t];i.displayOrder=e,i.computeDisplayName()}))}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.contactService||(e.rainbow.contactService=new w),e.rainbow.contactService}async start(e=null){this.logger.info("[contactService] === STARTING ==="),this.currentLanguage=this.settingsService.getSetting("lang"),this.setDisplayOrder(this.settingsService.getSetting("displayOrder")),this.settingsService.subscribeUpdateEvent("SETTINGS_UPDATED",(()=>{this.currentLanguage=this.settingsService.getSetting("lang"),this.setDisplayOrder(this.settingsService.getSetting("displayOrder")),this.updateContactsLastActivityMessage()})),this.subscriptions.push(this.xmppService.subscribeToContactEvents((e=>{switch(e.name){case"ON_CONTACT_PRESENCE_EVENT":this.contactPresenceChangedHandler(e.data);break;case"ON_CONTACT_UPDATE_EVENT":this.onContactChangeEvent(e.data.from,e.data.type);break;case"ON_ROSTER_CHANGED_EVENT":this.subscriptionPromiseQueue.add((()=>this.rosterChangedHandlerPromise(e.data)))}}))),this.xmppService.contactServiceReady=true,this.calendarPresenceEventHandlerCleaner&&this.calendarPresenceEventHandlerCleaner(),this.calendarPresenceEventHandlerCleaner=this.eventService.subscribe("ON_CONTACT_CALENDAR_STATUS_CHANGE",((e,t)=>{this.updateContactCalendarPresenceInfo(t)})),this.presentationModeEventHandlerCleaner&&this.presentationModeEventHandlerCleaner(),this.presentationModeEventHandlerCleaner=this.eventService.subscribe("ON_PRESENTATION_MODE_CHANGED_EVENT",((e,t)=>{this.onPresentationModeChangedEvent(t)})),this.msTeamsPresenceEventHandlerCleaner&&this.msTeamsPresenceEventHandlerCleaner(),this.msTeamsPresenceEventHandlerCleaner=this.eventService.subscribe("ON_CONTACT_MSTEAMS_STATUS_CHANGE",((e,t,i,r)=>{const n=this.getContactByJid(t);this.onMSTeamsPresenceUpdateForContact(n,i,r)})),this.logger.info("[contactService] Create userContact ("+this.xmppService.jid+")"),this.userContact=this.createContact(),this.userContact.ask=null,this.userContact.subscription=null,this.userContact.id=this.xmppService.jid,this.userContact.jid=this.xmppService.jid,this.userContact.fullJid=this.xmppService.fullJid,this.userContact.language=this.currentLanguage,this.userContact.updateFromUserData(this.authService.loggedInUser),this.userContact.getAvatar(),this.updateContactRichStatus(this.userContact),this.dbContacts[this.userContact.dbId]=this.userContact,this.contacts[this.userContact.id]=this.userContact,this.jtelContacts[this.userContact.jidtel]=this.userContact;const t={};this.authService.loggedInUser.language||(t.language=this.settingsService.getAppliLanguageCodeForServer()),await this.getUserSettings();let i=false;void 0===this.userContact.customData.pushToTalkEnabled&&(i=true,this.userContact.customData.pushToTalkEnabled=false);void 0===this.userContact.customData.pushToTalkKey&&(i=true,this.userContact.customData.pushToTalkKey="Shift");void 0===this.userContact.customData.pushToTalkDelay&&(i=true,this.userContact.customData.pushToTalkDelay=0);void 0===this.userContact.customData.enablePushToTalkTone&&(i=true,this.userContact.customData.enablePushToTalkTone=false);const r=Boolean(this.userContact.customData.openPopoutOnAnswerCall);if(this.settingsService.setSetting("openPopoutOnAnswerCall",String(r)),navigator.userAgent&&navigator.userAgent.indexOf("Firefox")>-1&&this.settingsService.setSetting("openPopoutOnAnswerCall",String(false)),i&&(t.customData=this.userContact.customData),Intl&&Intl.DateTimeFormat&&Intl.DateTimeFormat().resolvedOptions){const e=Intl.DateTimeFormat().resolvedOptions().timeZone;e&&e!==this.userContact.timezone&&(this.logger.info("[contactService] update user timezone from : "+this.userContact.timezone+" to : "+e),t.timezone=e)}this.userContact.modifyProfileEnabled&&Object.keys(t).length>0&&this.updateUserContact(t),this.userContact.company=await this.companyService.getCompanyById(this.userContact.company.id),this.userContact.companyFeatures=await this.companyService.getCompanyFeatures(this.userContact.company),this.userContact.alertNotificationEnabledForMyCompany=this.userContact.companyFeatures.alertNotifAllowed,this.attachHandlers(),e&&e.skipNetwork||(await this.getNetwork(),await this.updateNetworkWithRosterInfo()),this.subscriptions.push(this.mainService.appActive.subscribe((e=>(this.logger.info("[contactService] AppActive changed : "+e),!e&&this.userContact&&"online"===this.userContact.status&&(this.awayStateActive=true),e&&this.awayStateActive&&(this.awayStateActive=false),this.mainService.appActiveAutoAway&&"offline"!==this.userContact.status&&this.updatePresence(true),true)))),this.getMissedPresenceMessages(),this.xmppConnectionSubscription&&this.xmppConnectionSubscription.unsubscribe(),this.xmppConnectionSubscription=this.xmppService.subscribeToConnectionEvents((e=>{this.onConnectionStateChangeEvent(e)})),this.contactLastActivityInterval=setInterval((()=>{this.updateContactsLastActivityMessage()}),6e4),this.logger.info("[contactService] === STARTED ===")}attachHandlers(){this.logger.info("[contactService] AttachHandlers"),this.contactConfigRef&&(this.xmppService.deleteHandler(this.contactConfigRef),this.contactConfigRef=null),this.contactConfigRef=this.xmppService.addHandler((e=>(this.onUserManagementEvent(e),true)),null,"message","management")}async stop(){this.logger.info("[contactService] == STOPPING =="),this.userContact=null,this.contacts={},this.dbContacts={},this.jtelContacts={},this.presentationModeActive=false,this.awayStateActive=false,this.busyState={status:null,message:null},this.manualState=false,this.dndStateActivated=false,this.contactLastActivityInterval&&(clearInterval(this.contactLastActivityInterval),this.contactLastActivityInterval=null),this.subscriptions&&this.subscriptions.forEach((e=>{e.unsubscribe()})),this.xmppConnectionSubscription&&this.xmppConnectionSubscription.unsubscribe(),this.calendarPresenceEventHandlerCleaner&&(this.calendarPresenceEventHandlerCleaner(),this.calendarPresenceEventHandlerCleaner=null),this.presentationModeEventHandlerCleaner&&(this.presentationModeEventHandlerCleaner(),this.presentationModeEventHandlerCleaner=null),this.msTeamsPresenceEventHandlerCleaner&&(this.msTeamsPresenceEventHandlerCleaner(),this.msTeamsPresenceEventHandlerCleaner=null),this.logger.info("[contactService] == STOPPED ==")}subscribe(e){return this.rxSubject.subscribe(e)}sendEvent(e,t=null){this.rxSubject.next(m.RBEvent.create(e,t))}sendUpdateEvent(e){e.rxSubject.next({name:"update",data:e});const t=this.isUserContact(e)?"ON_USER_CONTACT_UPDATED_EVENT":"ON_CONTACT_UPDATED_EVENT";this.eventService.publish(t,e)}onConnectionStateChangeEvent(e){"ON_XMPP_DISCONNECTED"===e.name&&this.userContact&&(this.userContact.resources={},Object.keys(this.contacts).forEach((e=>{const t=this.contacts[e];t.isBot||(t.resources={},"unknown"!==t.status&&"none"!==t.subscription&&(t.status="offline",t.imStatusStamp=[]))})),this.presentationModeActive=false,this.awayStateActive=false)}async resendInitialPresenceOnReconnect(){this.eventService.publish("RESET_PRESENCE_AFTER_RECONNECT")}createContact(e=null,t=null,i=null,r=null,n=null){const s=new p.Contact(e,null,r);return s.login=n,s.avatarServerURL=config.webservices.protocol+"://"+config.webservices.currentServer,s.firstname=t,s.lastname=i,s.displayOrder=this.getDisplayOrder(),s.computeDisplayName(),s}createBotContact(e,t,i,r,n,s){let o=this.contacts[e];return o||(o=new p.Contact(e),s&&(o.botDetails="emilyDetails")),o.displayOrder=this.getDisplayOrder(),o.lastname=t,o.isBot=true,o.status="online",o.imStatus="online",o.subscription="both",o.computeDisplayName(),o.avatar=window.rainbowSDK?null:{src:r},o.dbId=i,o.isBotSharing=!!n&&n.some((function(e){return"SHARING"===e})),this.contacts[o.id]=this.dbContacts[i]=o,o}isMediaPillarJid(e){return e&&0===e.indexOf("mp_")}isUserContactJid(e){return!(!this.userContact||!e||0===e.length)&&e.startsWith(this.userContact.jid)}isUserContact(e){return!(!e||!e.jid)&&this.isUserContactJid(e.jid)}searchContacts(e){return this.getContacts().filter((t=>(t.roster||t.isBot)&&!t.isTerminated&&this.contactMatcher(t,e)))}contactMatcher(e,t){const i=e.firstname+" "+e.lastname,r=t.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(/[ ]+/),n=i.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(/[ ]+/);return r.every((e=>n.some(((t,i)=>!(!t.length||0!==t.indexOf(e))&&(n[i]="",true)))))}getContacts(){return Object.keys(this.contacts).map((e=>this.contacts[e]))}getContact(e,t=null){const i=e||t;return this.isUserContactJid(i)?this.userContact:this.contacts[i]}getContactByJid(e){return this.getContact(e)}getContactById(e){return this.dbContacts[e]}getContactByJidTel(e){return this.jtelContacts[e]}getContactByEmail(e){const t=Object.keys(this.contacts).find((t=>this.contacts[t].containsEmail(e)));return t?this.contacts[t]:null}getContactByPhoneNumber(e){const t=Object.keys(this.contacts).find((t=>this.contacts[t].containsPhoneNumber(e)));return t?this.contacts[t]:null}getDirectoryContactByPhoneNumber(e){const t=Object.keys(this.contacts).find((t=>this.contacts[t].containsDirectoryPhoneNumber(e)));return t?this.contacts[t]:null}async getContactByDbIdInner(e){try{const t=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${e}?format=full`,i=await fetch(t,{method:"GET",headers:this.authService.getRequestHeader()});if(!i.ok)throw i;const r=(await i.json()).data,n=this.contacts[r.jid_im]?this.contacts[r.jid_im]:this.dbContacts[e],s=n||this.createBasicContact(r.jid_im,null,false);return s.updateFromUserData(r),s.getAvatar(),this.contacts[s.id]=s,this.dbContacts[s.dbId]=s,this.jtelContacts[s.jidtel]=s,this.logger.info("[contactService] GetContactByDBId ("+e+") -- "+r.jid_im+" -- success"),s}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getContactByDBId");throw this.logger.error(e.message),e.error}}async getContactByDBId(e,t=false){const i=this.dbContacts[e];return!t&&i?i:(this.getContactPromises[e]||(this.getContactPromises[e]=new Promise(((t,i)=>{this.getContactByDbIdInner(e).then((i=>{t(i),delete this.getContactPromises[e]})).catch((t=>{i(t),delete this.getContactPromises[e]}))}))),this.getContactPromises[e])}async getContactsByEmails(e){try{this.logger.info("[contactService] getContactsByEmails with ["+e.join()+"]");const t=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/loginemails",i=e.map((e=>e.toLowerCase())),r=await fetch(t,{method:"POST",headers:this.authService.getPostHeader(),body:JSON.stringify({loginEmail:i})});if(!r.ok)throw r;const n=await r.json(),s={},o=n.data.map((e=>{let t=this.dbContacts[e.id];return t||(t=this.createContact(),this.contacts[t.id]=t,this.dbContacts[t.dbId]=t,this.jtelContacts[t.jidtel]=t),t.updateFromUserData(e),t.getAvatar(),s[t.loginEmail]=t,i.splice(i.indexOf(t.loginEmail.toLowerCase()),1),t}));return{contacts:s,contactsArray:o,emails:i}}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getContactsByEmails");throw this.logger.error(e.message),e.error}}async getContactsByJids(e){try{this.logger.info(`[contactService] getContactsByJids with [${e.length>10?e.length:e.join()}]`);const t=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/jids?limit=1000",i=await fetch(t,{method:"POST",headers:this.authService.getPostHeader(),body:JSON.stringify({jid_im:e})});if(!i.ok)throw i;(await i.json()).data.forEach((e=>{let t=this.getContact(e.jid_im);t||(t=this.createContact()),t.updateFromUserData(e),t.isAnonymousGuest()||(this.contacts[t.id]=t,this.dbContacts[t.dbId]=t,this.jtelContacts[t.jidtel]=t,t.getAvatar(),t.temp=false)}))}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getContactsByJids");throw this.logger.error(e.message),e.error}}createBasicContact(e,t=null,i=true){this.logger.debug(`[contactService] CreateContact ${e} ${h.default(t)}`);const r=this.createContact();if(!e)return r.id=t,r.initials="?",r.displayName=t||(this.i18nService.isInitialized?this.i18nService.translate("accountDeleted"):"Unknown contact"),r.lastname=t||(this.i18nService.isInitialized?this.i18nService.translate("accountDeleted"):"Unknown contact"),r.firstname="",r.phoneProCan=t||"",r.phonePro=r.phoneProCan,r.temp=true,this.authService.fromSDK?r.avatar={src:""}:r.avatar={src:"/assets/skins/rainbow/images/conversations/unknownUser.jpeg"},r.nameUpdatePrio=p.Contact.NameUpdatePrio.NO_UPDATE_PRIO,r;let n=e;return n||(n=t,r.phoneProCan=t),n||(n="anonymous"),r.jid=e,r.id=n,r.ask="none",r.subscription="none",this.updateContactRichStatus(r),false!==i&&(this.contacts[r.id]=r),r}createEmptyContact(e){const t=this.createBasicContact(e);return t.initials="?",t.displayName=this.i18nService.isInitialized?this.i18nService.translate("accountDeleted"):"Unknown contact",t.lastname=this.i18nService.isInitialized?this.i18nService.translate("accountDeleted"):"Unknown contact",t.firstname="",t.temp=true,t.avatar={src:"/assets/skins/rainbow/images/conversations/unknownUser.jpeg"},t}createDirectoryContact(e,t=true){this.logger.debug(`[contactService] createDirectoryContact ${e} `);const i=this.createContact();return i.id=e,i.jid=e,i.dbId=e,i.ask="none",i.subscription="none",this.updateContactRichStatus(i),true===t&&(this.contacts[i.id]=i),i}getOrCreateContact(e,t=null){if(!e&&!t)return Promise.reject(new Error("No jid or no phoneNumber"));const i=this.getContact(e,t);if(i)return Promise.resolve(i);if(e&&-1===e.indexOf("@"))return Promise.reject(new Error("Invalid jid "+e));const r=e||t;return e?(this.getContactPromises[r]||(this.getContactPromises[r]=new Promise(((i,n)=>{const s=this.createBasicContact(e,t,false);this.updateContactFromServer(s).then((()=>{this.contacts[s.id]=s,this.dbContacts[s.dbId]=s,this.jtelContacts[s.jidtel]=s,delete this.getContactPromises[r],i(s)})).catch((e=>{this.logger.error("[contactService] getOrCreateContact -- failure -- "+e.message),delete this.getContactPromises[r],n(e)}))}))),this.getContactPromises[r]):Promise.resolve(this.createBasicContact(null,t))}createContactFromData(e){if(!e)return null;const t=this.getContact(e.jid_im);if(t)return!t.personalRoutines&&e.personalRoutines&&(t.personalRoutines=e.personalRoutines.map((e=>v.PersonalRoutine.createRoutineFromData(e)))),!t.forwards&&e.forwards&&(t.forwards=e.forwards.map((e=>S.TelephonyForward.createForwardFromUserData(e)))),t;const i=this.createBasicContact(e.jid_im,void 0,false);return i.updateFromUserData(e),this.updateContactRichStatus(i,this.isUserContactJid(i.jid)),i.getAvatar(),this.sendUpdateEvent(i),this.contacts[i.id]=i,this.dbContacts[i.dbId]=i,this.jtelContacts[i.jidtel]=i,i}async updateContactFromServer(e,t=false){try{const i=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/jids/${e.jid}`,r=await fetch(i,{headers:this.authService.getRequestHeader()});if(!r.ok)throw r;const n=await r.json();e.updateFromUserData(n.data),this.updateContactRichStatus(e,this.isUserContactJid(e.jid)),t||e.getAvatar(),this.sendUpdateEvent(e)}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"updateContactFromServer");throw this.logger.error(e.message),e.error}}async getContactInfoByEmail(e){try{const t=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/loginemails?format=full",i=await fetch(t,{method:"POST",headers:this.authService.getRequestHeader(),body:JSON.stringify({loginEmail:[e]})});if(!i.ok)throw i;return(await i.json()).data}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getContactInfoByEmail");throw this.logger.error(e.message),e.error}}onContactChangeEvent(e,t){this.logger.info("[contactService] onContactChangeEvent event: "+event+" || status: "+e+" || type: "+t),setTimeout((async()=>{const i=this.getContact(e);i&&(await this.updateContactFromServer(i,true),"avatar"===t&&i.getAvatar(256,true),this.sendUpdateEvent(i))}),500)}async onUserManagementEvent(e){try{const t=C.default(e);if("update"===t.find("usersettings").attr("action")){this.logger.info("[contactService] onUserManagementEvent - usersettings updated");const e=t.find("setting");if(e.length){const t=e.attr("name");if(["ringingOnDnd","protectionAgainstMailTypeOffline","activeAlarm","activeNotif","autoAnswerByDeviceType","autoAnswer","applyMsTeamsPresence"].includes(t)){const i=e.attr("value");this.settingsService.setSetting(t,i)}else await this.sendPresenceFromConfiguration();return this.eventService.publish("ON_MY_CONTACT_SETTINGS_CHANGE"),true}}return"update"!==t.find("userpassword").attr("action")||(this.logger.info("[contactService] onUserManagementEvent - userPassword updated"),this.xmppService.changePasswordInfo||(this.xmppService.changePasswordInfo={fromThirdParty:true}),true)}catch(t){return true}}async sendPresenceFromConfiguration(e=false){this.logger.info("(with auth info)");try{const t=await this.getUserSettings();this.settingsService.setSetting("presence",t.presence);let i="",r=t.presence;if("invisible"===r?r="xa":"away"===r&&(r="xa",i="away"),this.logger.info("[contactService] sendPresenceFromConfiguration -> getUserSettings are "+r+" || message : "+i),this.userContact&&this.userContact.resources&&this.userContact.resources[this.userContact.fullJid]){const n=this.userContact.resources[this.userContact.fullJid];if(n&&(n.show!==r||"dnd"===n.show&&""!==n.status||"xa"===n.show&&n.status!==i)){if(!this.busyState||"dnd"!==this.busyState.status||this.manualState){this.logger.info("[contactService] sendPresenceFromConfiguration should update my status from "+n.show+" to "+r+" ("+i+")");const t={im:this.userContact.instantMessagesEnabled,alert:this.userContact.alertNotificationEnabledForMyCompany,companyid:this.userContact.company?this.userContact.company.id:""};this.dndStateActivated="dnd"===r,this.setUserContactStatus(r,i,e,t)}}else this.settingsService.setSetting("ringingOnDnd",t.ringingOnDnd),this.eventService.publish("ON_RELOAD_CAPABILITIES_FOR_MY_CONYTACT")}else{const t={im:this.userContact.instantMessagesEnabled,alert:this.userContact.alertNotificationEnabledForMyCompany,companyid:this.userContact.company?this.userContact.company.id:""};this.logger.info("[contactService] sendPresenceFromConfiguration set initial presence "),this.dndStateActivated="dnd"===r,this.setUserContactStatus(r,i,e,t)}}catch(t){this.logger.info("[contactService] sendPresenceFromConfiguration failure, send online"),this.setUserContactStatus("online",null,e)}}changeMyPresence(e){if(this.logger.info("[contactService] changeMyPresence "+e+" "+this.userContact.message),"dnd"===e&&"presentation"===this.userContact.message||"busy"===e)return;let t="";"online"===e&&(t="mode=auto"),"away"===e&&(e="xa",t="away"),"busy"!==this.userContact.status||"phone"!==this.userContact.message&&"audioPhone"!==this.userContact.message||"xa"!==e&&"away"!==e&&"dnd"!==e||this.eventService.publish("GLOBAL_NOTIFY_MESSAGE_EVENT","presenceActivatedConfirmation",true),this.setUserContactStatus(e,t),"online"===e&&setTimeout((()=>{this.manualState=false,this.dndStateActivated=false,this.updatePresence()}),1e3);let i="online";"xa"===e&&"away"===t?i="away":"dnd"===e?i="dnd":"xa"===e&&(i="invisible"),this.setUserSettings({presence:i}),this.userContact.calendarState&&this.userContact.calendarState.applyCalendarPresence&&"busy"===this.userContact.calendarState.message&&this.eventService.publish("EXIT_CALENDAR_PRESENCE_STATE")}async updateUserContact(e){let t=null;if(!this.userContact||this.userContact.modifyProfileEnabled)try{this.logger.info("[contactService] updateUserContact");const i=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.authService.userId}`,r=this.authService.getPostHeader(),n=await fetch(i,{method:"PUT",headers:r,body:JSON.stringify(e)});if(!n.ok)throw n;t=(await n.json()).data,this.userContact.updateFromUserData(t),this.authService.loggedInUser=t,this.logger.info("[contactService] updateUserContact successfully")}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"updateUserContact");throw this.logger.error(e.message),e.error}else this.logger.warn("[contactService] updateUserContact is not allowed for this contact")}reconnect(){this.updateUserContactFullJid()}updateUserContactFullJid(){this.userContact.fullJid=this.xmppService.fullJid,this.attachHandlers()}async completeContactPhoneNumbers(e){if(e.isBot)throw new Error("No phone numbers for bot contacts");if(e.phoneNumbersInitialized)return e;if(e.dbId)try{return await this.getContactByDBId(e.dbId,true)}catch(t){throw new Error(t.message)}return e}updateUserPassword(e,t,i=false){return new Promise(((r,n)=>{const s=this.userContact.loginEmail;this.xmppService.changePasswordInfo={resolve:i?r:null,login:s,newPassword:t};const o=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.authService.userId}/change-password`,a=this.authService.getPostHeader();fetch(o,{method:"PUT",headers:a,body:JSON.stringify({oldPassword:e,newPassword:t})}).then((e=>{if(!e.ok)throw e;i||r()})).catch((async e=>{this.xmppService.changePasswordInfo=null;const t=await this.errorHelperService.getErrorInfo(e,"updateUserPassword");this.logger.error(t.message),n(t.error)}))}))}async getNetwork(){try{const e=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/networks?limit=2000&format=full",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=await i.json();this.logger.info(`[contactService] GetNetwork success -- find ${r.data.length} contact(s)`),r.data.forEach((e=>{const t=this.createContact();t.updateFromUserData(e),this.contacts[t.id]=t,this.dbContacts[t.dbId]=t,this.jtelContacts[t.jidtel]=t,this.updateContactRichStatus(t),t.getAvatar(),this.sendUpdateEvent(t)}))}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getNetwork");throw this.logger.error(t.message),t.error}}async updateNetworkWithRosterInfo(){try{const e=await this.xmppService.sendIQ($iq({type:"get"}).c("query",{xmlns:"jabber:iq:roster"})),t=C.default(e);this.logger.info("[contactService] Get rosters info successfully"),t.find("item").forEach((e=>{const t=this.xmppService.getBareJidFromJid(e.attr("jid"));if(t&&t.length&&!this.isTelJid(t)){const i=this.contacts[t];if(i){const r=e.attr("ask"),n=e.attr("subscription");i.ask=r||"none",i.subscription=n||"none",i.roster=true,this.updateContactRichStatus(i),this.logger.info("[contactService] Update contact from roster ("+i.ask+", "+i.subscription+") "+t)}}}))}catch(e){throw this.logger.error("[contactService] Get rosters failure : "+e.message),new Error(e.message)}}async getUserSettings(){try{const e=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.userContact.dbId}/settings`,t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=await i.json(),n=r.data.presence&&this.userContact.changePresenceEnabled?r.data.presence:"online",s=r.data.activeAlarm||"relax1",o=r.data.activeNotif||"notif1",a=r.data.ringingOnDnd,c=r.data.promptForCalendarPresence,l=r.data.protectionAgainstMailTypeOffline,d=Boolean(r.data.applyCalendarPresence),u=Boolean(r.data.applyMsTeamsPresence),h=r.data.autoAnswer||false,f=r.data.autoAnswerByDeviceType||"desktop";this.logger.info("[contactService] GetUserSettings success");const p={presence:n,activeAlarm:s,activeNotif:o,ringingOnDnd:a,promptForCalendarPresence:c,protectionAgainstMailTypeOffline:l,applyCalendarPresence:d,autoAnswer:h,autoAnswerByDeviceType:f,applyMsTeamsPresence:u};return this.manageCalendarPresencePrompt(p),this.settingsService.setSetting("activeAlarm",p.activeAlarm),this.settingsService.setSetting("activeNotif",p.activeNotif),this.settingsService.setSetting("ringingOnDnd",p.ringingOnDnd),this.settingsService.setSetting("protectionAgainstMailTypeOffline",p.protectionAgainstMailTypeOffline),this.settingsService.setSetting("applyCalendarPresence",String(p.applyCalendarPresence)),this.settingsService.setSetting("applyMsTeamsPresence",String(p.applyMsTeamsPresence)),this.settingsService.setSetting("autoAnswer",p.autoAnswer),this.settingsService.setSetting("presence",p.presence),this.settingsService.setSetting("autoAnswerByDeviceType",String(p.autoAnswerByDeviceType)),this.logger.info("[contactService] Get alarm & notif data ("+p.activeAlarm+" / "+p.activeNotif+")"),this.logger.info("[contactService] Get mail setting data ("+p.protectionAgainstMailTypeOffline+")"),p}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getUserSettings");return this.logger.error(t.message),{presence:"online",activeAlarm:"relax1",activeNotif:"notif1",ringingOnDnd:false,promptForCalendarPresence:false,autoAnswer:false,autoAnswerByDeviceType:"desktop"}}}async setUserSettings(e){try{const t=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.userContact.dbId}/settings`,i=this.authService.getPostHeader(),r=await fetch(t,{method:"PUT",headers:i,body:JSON.stringify(e)});if(!r.ok)throw r;this.logger.info(`[contactService] SetUserSettings ${JSON.stringify(e)} -- success`)}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"setUserSettings");throw this.logger.error(e.message),e.error.errorDetailsCode&&403153===e.error.errorDetailsCode&&(this.setUserContactStatus("online","mode=auto"),this.mainService.showGlobalPopupMessage({popupTitle:"presence",popupBody:"changePresenceDisabled",okLabel:"ok"})),e.error}}getUserSettingFromSettingsService(e){return this.settingsService.getSetting(e)}manageCalendarPresencePrompt(e){if(void 0!==e.promptForCalendarPresence)this.settingsService.setSetting("disableCalendarPresence",e.promptForCalendarPresence?"false":"true"),this.logger.info("[contactService] promptForCalendarPresence -- "+e.promptForCalendarPresence);else{const e="true"!==this.settingsService.getSetting("disableCalendarPresence");this.logger.info("[contactService] MIGRATION NECESSARY -- promptForCalendarPresence : "+e),this.setUserSettings({promptForCalendarPresence:e})}}onMSTeamsPresenceUpdateForContact(e,t,i){this.logger.debug(`[contactService] onMSTeamsPresenceUpdateForContact -- ${e.jid} -- ${t} -- ${i}`),e.msTeamsPresence=t,"dnd"===t&&"teams"===i&&(e.msTeamsPresence="busy"),this.updateContactRichStatus(e,this.isUserContactJid(e.jid)),this.isUserContact(e)&&this.sendUpdateEvent(e)}updateContactCalendarPresenceInfo(e){const t=e.calendarState;let i=null,r=null;t.iconId=null;let n=null;if(t.autoReplyOn)t.iconId="calendar--busy",r="<div style='text-align:left'>"+y.default(t.autoReplyInfos.message).replace(/\n/g,"<br/>")+"</div>",i={meetingDate:t.autoReplyInfos.until,message:r},n=t.autoReplyInfos.until?t.autoReplyInfos.untilDate?"calendarAutoReply-date":"calendarAutoReply":"calendarAutoReplySimple";else{if("busy"===t.message)t.iconId="calendar--ok",n=t.untilDate?"calendar-busy-date":"calendar-busy";else if("out_of_office"===t.message)t.iconId="calendar--busy",n=t.untilDate?"calendar-outofoffice-date":"calendar-outofoffice";else if("online"===t.status){const e=t.mdate&&t.mdate.isSame(moment(),"d");t.tooltip=e?this.i18nService.translate("calendar-free",{meetingDate:t.until}):this.i18nService.translate("calendar-noappointment")}i={meetingDate:t.until}}n&&(t.tooltip=this.i18nService.translate(n,{meetingDate:i.meetingDate}),i.message&&(i.message=i.message.replace(/<script>/g,""),i.message=i.message.replace(/(?:<br?\/?>\s*){2,}/g,"<br/>"),t.tooltip=t.tooltip+" "+i.message)),this.updateContactRichStatus(e,this.isUserContactJid(e.jid)),this.isUserContact(e)&&this.sendUpdateEvent(e)}isTelJid(e){return 0===e.indexOf("tel_")}getResourceFromJid(e){return this.xmppService.getResourceFromJid(e)}getImJid(e){const t=this.xmppService.getBareJidFromJid(e);if(this.isTelJid(t)){const i=this.jtelContacts[t];return i?i.jid:(this.logger.warn("[contactService] -- getIMJid("+e+") -- failure -- no associated contact"),null)}return t}async rosterChangedHandlerPromise(e){try{if(this.isTelJid(e.jid))return void this.logger.debug("[contactService] Contact changed ("+e.jid+") ignored");const t=await this.getOrCreateContact(e.jid);"remove"===e.subscription?(t.ask="none",t.subscription="none",t.roster=false):(t.ask=e.ask,t.subscription=e.subscription,t.roster=true,"both"===e.subscription&&this.updatePresence(true)),this.updateContactRichStatus(t),this.sendUpdateEvent(t),this.sendEvent("ON_CONTACT_ROSTER_UPDATE_EVENT"),this.logger.info("[contactService] rosterChangedHandler - contact "+e.jid+" changed ("+e.ask+", "+e.subscription+") success")}catch(t){this.logger.error("[contactService] rosterChangedHandler - contact "+e.jid+" failure - "+t.message)}}async contactPresenceChangedHandler(e){const t=this.getResourceFromJid(e.jid);if("calendar"===t)return;if("presence"===t)return;const i=this.getImJid(e.jid);if(!i)return;if(i.startsWith("room"))return;const r=await this.getOrCreateContact(i),n=this.isUserContact(r);this.isTelJid(e.jid)?(this.logger.info("[contactService] Update telephony presence ("+i+") source: "+t),this.logger.info("[contactService] Update telephony presence ("+i+") msg: "+e.message+" / status: "+e.status),this.updateContactTelephonyStatus(r,e,n)):(this.logger.info("[contactService] Update im presence contact ("+i+") status: "+e.status+" "+e.stamp),this.isUserContact(r)&&"mode=auto"===e.message&&"online"!==r.status&&r.resources.hasOwnProperty(e.jid)&&e.jid!==r.fullJid&&"EVT_SERVICE_INITIATED"!==r.telStatus&&"EVT_ESTABLISHED"!==r.telStatus&&(r.resources[r.fullJid]&&"online"===r.resources[r.fullJid].show?this.logger.info("[contactService] Current ressource is already online, ignore message!"):(this.manualState&&(this.logger.info("[contactService] User is in manual state, leave it"),this.setUserContactStatus("online","mode=auto")),this.busyState&&"dnd"===this.busyState.status&&"busy"!==this.userContact.status&&(this.logger.info("[contactService] User is in call, re-update presence state"),setTimeout((()=>{this.updatePresence(true)}),500)))),this.updateContactIMStatus(r,e,this.isUserContact(r)),this.updateLastActivity(r)),this.sendUpdateEvent(r)}getMissedPresenceMessages(){this.logger.info("[contactService] GetMissedPresenceMessages");try{const e=this.xmppService.getPresenceWaitingList();if(e.length){for(this.logger.info("[contactService] GetMissedPresenceMessages length "+e.length);e.length>0;){const t=e.pop();this.contactPresenceChangedHandler(t)}this.xmppService.resetPresenceWaitingList()}}catch(e){this.logger.error("[contactService] GetMissedPresenceMessages error "+e)}}computeStatusList(){let e=[];return this.userContact&&this.userContact.status&&(this.logger.info("[contactService] computeStatusList "+this.userContact.status+" "+this.userContact.message),e=this.userContact.changePresenceEnabled?"offline"===this.userContact.status?["online"]:"busy"===this.userContact.status?["online","away","xa","dnd"]:"dnd"===this.userContact.status&&"presentation"===this.userContact.message?["dnd"]:["online","away","xa","dnd"]:[]),e}resetBusyState(){this.logger.info("[contactService] resetBusyState"),this.setBusyState(null,null,true),this.sendPresenceFromConfiguration()}setBusyState(e,t,i=false){this.logger.info("[contactService] setBusyState -- "+e+" -- "+t),this.busyState={status:e,message:t},i||this.updatePresence()}updateContactRichStatus(e,t=false){if("EVT_SERVICE_INITIATED"===e.telStatus||"EVT_ESTABLISHED"===e.telStatus)e.status="busy",e.message="audioPhone";else{if("subscribe"===e.ask)e.status="wait";else if("none"===e.subscription||"from"===e.subscription)e.status="unknown";else{const i=this.calculateContactStatusFromResources(e,t);"xa"===i.presence&&(""!==i.message||t?"away"===i.message&&(i.presence="away",i.message=""):i.presence="offline"),e.status=i.presence,e.message=i.message,this.logger.info(`[contactService] updateContactRichStatus ${t?"MY ":"USER"} PRESENCE : ${i.presence} || message : ${i.message}`),e.rxSubject.next({name:"update",data:e})}this.updateContactStatusMessage(e)}t&&this.eventService.publish("ON_UPDATE_MYCONTACT_EVENT",e),this.eventService.publish("ON_UPDATE_CONTACT_RICH_STATUS_EVENT",e)}calculateContactStatusFromResources(e,t){let i=false,r=false,n=false,s=false,o=false,a=false,c=false,l="",d=false,u=false,h=false,f=false,p=false,g=e.fullJid,m="offline",v="";return e.calendarState.applyCalendarPresence&&"busy"===e.calendarState.message&&(o=true),e.msTeamsPresence&&(f="busy"===e.msTeamsPresence,p="dnd"===e.msTeamsPresence),Object.keys(e.resources).forEach((o=>{const f=e.resources[o];"phone"!==f.type?(t||g||(g=o),"xa"===f.show&&""===f.status?r=true:"dnd"===f.show&&""===f.status?n=true:"xa"===f.show&&"away"===f.status?s=true:"dnd"===f.show&&"presentation"===f.status?a=true:"dnd"===f.show&&f.status?(c=true,l=f.status):""!==f.show&&"online"!==f.show||""!==f.status&&"mode=auto"!==f.status?"away"===f.show&&""===f.status&&(h=true):-1!==o.indexOf("mobile_")?u=true:d=true):i="EVT_SERVICE_INITIATED"===f.status||"EVT_ESTABLISHED"===f.status})),i?(m="busy",v="phone"):r?(m="xa",v="",t&&(this.dndStateActivated=false)):n?(m="dnd",v="",t&&(this.dndStateActivated=true)):s?(m="away",v="",t&&(this.dndStateActivated=false)):o?(m="dnd",v="appointment",t&&(this.dndStateActivated=true)):f||p?(m="dnd",v="Teams",t&&(this.dndStateActivated=true)):a?(m="dnd",v="presentation",t&&(this.dndStateActivated=true)):c?(m="busy",v=l,t&&(this.dndStateActivated=false)):d?(m="online",v="",t&&(this.dndStateActivated=false)):u?(m="online-mobile",v="",t&&(this.dndStateActivated=false)):h&&(m="away",v="",t&&(this.dndStateActivated=false)),t||e.fullJid||(e.fullJid=g),{presence:m,message:v}}updatePresence(e=false){this.logger.info("[contactService] updatePresence"),this.manualState?(this.logger.info("[contactService] updatePresence manualState"),"away"===this.userContact.status&&this.busyState&&"dnd"===this.busyState.status&&(this.setUserContactStatus("online","mode=auto"),this.setUserSettings({presence:"online"}),setTimeout((()=>{this.updatePresence()}),1e3))):!this.presentationModeActive||this.busyState&&this.busyState.status?this.busyState&&"dnd"===this.busyState.status?(this.logger.info("[contactService] updatePresence dnd "+this.busyState.message),this.xmppService.sendPresence("dnd",this.busyState.message)):this.awayStateActive?(this.logger.info("[contactService] updatePresence away"),this.xmppService.sendPresence("away","")):this.userContact&&"online"!==this.userContact.status?(this.logger.info("[contactService] updatePresence online"),this.setUserContactStatus("online")):e&&this.userContact&&"online"===this.userContact.status&&(this.logger.info("[contactService] updatePresence forced online"),this.setUserContactStatus("online")):(this.logger.info("[contactService] updatePresence dnd presentation"),this.xmppService.sendPresence("dnd","presentation"))}setUserContactStatus(e,t=null,i=false,r){try{this.logger.info("[contactService] Set userContact status : "+e+(t?"("+t+")":"")),this.xmppService.started&&("online"===e?(this.manualState=false,this.dndStateActivated=false,this.xmppService.sendPresence(null,t,i,r)):(this.manualState=true,this.dndStateActivated=false,"away"===e?this.xmppService.sendPresence("away",t,i,r):"dnd"===e?(this.dndStateActivated=true,this.xmppService.sendPresence("dnd",t,i,r)):"xa"===e&&this.xmppService.sendPresence("xa",t,i,r)))}catch(n){this.logger.error("[contactService] Set userContact status error : "+n)}}updateContactTelephonyStatus(e,t,i){const r=e.telStatus;if("pcg2"===this.getResourceFromJid(t.jid))switch(t.status){case"offline":e.telStatus="";break;case"online":e.telStatus="EVT_CONNECTION_CLEARED";break;case"dnd":e.telStatus="EVT_ESTABLISHED";break;default:e.telStatus=""}else e.telStatus=t.message;this.updateContactRichStatus(e,i),i&&r!==e.telStatus&&this.eventService.publish("ON_UPDATE_MYTELEPHONY_STATUS_EVENT")}updateContactIMStatus(e,t,i){if(e.imStatusStamp[t.jid]&&e.imStatusStamp[t.jid]>t.stamp)return void this.logger.info("[contactService] Ignore obsolete presence message for contact "+e.jid);if(!this.getResourceFromJid(t.jid))return void this.logger.info("[contactService] Ignore no ressource presence message for contact "+e.jid);this.logger.info("[contactService] updateIMStatus "+JSON.stringify(t)),e.imStatusStamp[t.jid]=t.stamp,t.status&&(e.imStatus=t.status);const r=t.message?t.message:"";if("offline"===e.imStatus?(e.fullJid===t.jid&&(e.fullJid=null),delete e.resources[t.jid],delete e.imStatusStamp[t.jid],0===e.resources.length&&(e.message="")):(e.resources[t.jid]?(e.resources[t.jid].show=e.imStatus,e.resources[t.jid].status=r,e.resources[t.jid].stamp=t.stamp):e.resources[t.jid]={show:e.imStatus,status:r,initStamp:t.stamp,stamp:t.stamp},this.logger.info("[Contact] updateIMStatus user resources after update "+JSON.stringify(e.resources)),this.xmppService.isMobileResource(t.jid)||i||(e.fullJid=t.jid),!i&&config.webrtcWithMobiles&&(e.fullJid=t.jid)),this.updateContactRichStatus(e,i),i&&this.xmppService.isMobileResource(t.jid)&&("offline"!==t.status&&null===e.mobileResource&&(e.mobileResource=t.jid,this.logger.info("[Contact] updateIMStatus: post event ON_MOBILE_TELEPHONY_STATUS_CHANGED_EVENT"),this.eventService.publish("ON_MOBILE_TELEPHONY_STATUS_CHANGED_EVENT","started")),"offline"===t.status)){let t=null;for(const i in e.resources)if(e.resources.hasOwnProperty(i)&&this.xmppService.isMobileResource(i)){t=i;break}e.mobileResource=t,null===e.mobileResource&&this.eventService.publish("ON_MOBILE_TELEPHONY_STATUS_CHANGED_EVENT","stopped")}}async getContactLastActivityMessage(e){try{if(e.lastActivityMessage)return;this.xmppService.connection.lastactivity.query(e.jid,{onResponse:t=>{const i=1e3*Number.parseInt(C.default(t).find("query").attr("seconds"),10),r=(new Date).getTime(),n=new Date(r-i);this.updateContactLastActivityDate(e,n)}})}catch(t){throw new Error("[contactService] getInitialContactLastActivityMessage -- Failure -- "+t.message)}}updateContactsLastActivityMessage(){this.contacts&&Object.keys(this.contacts).forEach((e=>{this.updateContactStatusMessage(this.contacts[e])}))}updateLastActivity(e){let t=null;"offline"!==e.status&&"away"!==e.status||Object.keys(e.imStatusStamp).forEach((i=>{const r=e.imStatusStamp[i];(!t||t<r)&&(t=r)})),this.updateContactLastActivityDate(e,t)}updateContactLastActivityDate(e,t){e.lastActivityDate=t,this.updateContactStatusMessage(e)}updateContactStatusMessage(e){if(e.lastActivityDate){const t=moment(e.lastActivityDate);"de"===this.userContact.language?(e.lastActivityMessage=t.fromNow(true).replace("Tage","Tagen"),e.lastActivityMessage=e.lastActivityMessage.replace("eine Stunde","einer Stunde")):e.lastActivityMessage=t.fromNow(true)}else e.lastActivityMessage="";if("unknown"===e.status?e.statusMessage=this.i18nService.translate("unknown"):"offline"===e.status&&""===e.lastActivityMessage?e.statusMessage=this.i18nService.translate("offlineFilter"):"away"===e.status&&""===e.lastActivityMessage?e.statusMessage=this.i18nService.translate("shortAway"):e.statusMessage=this.i18nService.translate(e.status,{offlineDate:e.lastActivityMessage}),e.message){let t=this.i18nService.translate(e.message);"de"!==this.userContact.language&&"Teams"!==t&&(t=t.toLowerCase()),"("!==t.charAt(0)&&(t="("+t+")"),e.statusMessage+=" "+t}}async deleteUserAccount(){try{this.logger.info("[contactService] deleteUserAccount");const e=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.userContact.dbId}`,t=await fetch(e,{method:"DELETE",headers:this.authService.getRequestHeader()});if(!t.ok)throw t;await t.json()}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"deleteUserAccount");throw this.logger.error(t.message),t.error}}async removeContact(e){try{if(!e||!e.dbId)throw new Error("[contactService] removeContact : wrongContact");const t=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/networks/${e.dbId}`,i=await fetch(t,{method:"DELETE",headers:this.authService.getRequestHeader()});if(!i.ok)throw i;await i.json(),this.logger.info(`[contactService] removeContact ${e.dbId} -- SUCCESS`)}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"removeContact");throw this.logger.error(e.message),e.error}}async pushAvatarImage(e){const t=this.userContact.avatar;try{this.logger.info("[contactService] Push avatar image");const t=await b.resizeImage(e,512,512),i=b.getBinaryData(t),r=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.userContact.dbId}/avatar`,n=this.authService.getPostHeader("image/"+i.type),s=await fetch(r,{method:"POST",headers:n,body:i.data});if(!s.ok)throw s;await s.json()}catch(i){this.userContact.avatar=t;const e=await this.errorHelperService.getErrorInfo(i,"pushAvatarImage");throw this.logger.error(e.message),e.error}}async notifyImByEmail(e){let t=null;try{const i=config.restServerUrl+"/api/rainbow/enduser/v1.0/notifications/emails/offline",r=this.authService.getRequestHeader(),n=await fetch(i,{method:"POST",headers:r,body:JSON.stringify({userId:e.dbId})});if(!n.ok)throw n;t=await n.json();let s="";t.data&&t.data.email&&(s=t.data.email.substr(0,3)+"***"+t.data.email.substr(-3)),this.logger.info("[contactService] notifyImByEmail "+s+" - success")}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"notifyImByEmail");throw this.logger.error(e.message),e.error}}myMobileAvailable(){return this.userContact?this.userContact.mobileResource:null}sendSubscribeInvitation(e){return this.logger.info("[contactService] Send subscribe invitation to "+e),this.xmppService.send($pres({to:e,type:"subscribe"}))}shouldShowNotification(){let e=true;return("dnd"===this.userContact.status||"busy"===this.userContact.status&&this.dndStateActivated||"busy"===this.busyState.status&&"sharing"===this.busyState.message)&&(e=false),e}isSingleComputerClient(){const e=Object.keys(this.userContact.resources).filter((e=>-1!==e.indexOf("web_")||-1!==e.indexOf("desk_")));return this.logger.info("[contactService] isSingleComputerClient clients number : "+e.length),e.length<=1}onPresentationModeChangedEvent(e){"active"===e?this.presentationModeActive=true:"disable"===e&&(this.presentationModeActive=false),null===this.lastUpdatePresentationMode&&(this.logger.debug(`[contactService] onPresentationModeChangedEvent '${e}' request presence update`),this.lastUpdatePresentationMode=this.presentationModeActive,this.updatePresence()),this.startUpdatePresentationModeRefreshTimer()}startUpdatePresentationModeRefreshTimer(){this.logger.debug("[contactService] startUpdatePresentationModeRefreshTimer"),null!==this.presentationModeTimeout&&(clearTimeout(this.presentationModeTimeout),this.presentationModeTimeout=null),this.presentationModeTimeout=setTimeout((()=>{this.logger.debug("[contactService] startUpdatePresentationModeRefreshTimer interval reach"),this.lastUpdatePresentationMode!==this.presentationModeActive?(this.logger.debug("[contactService] startUpdatePresentationModeRefreshTimer interval - request presence update"),this.lastUpdatePresentationMode=this.presentationModeActive,this.updatePresence(),this.startUpdatePresentationModeRefreshTimer()):(this.logger.debug("[contactService] startUpdatePresentationModeRefreshTimer interval - no presence update needed"),this.lastUpdatePresentationMode=null)}),1e3)}}t.ContactService=w},function(e,t,i){i.r(t);var r=i(5),n=i(111),s=i(102),o=i(40),a=i(12),c=i(99),l=i(82),d=i(52),u=i(73),h=i(15),f=i(98),p=i(0),g=i(53),m=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.scheduler=t,r.work=i,r}return p.a(t,e),t.prototype.requestAsyncId=function(t,i,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,i,r):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame((function(){return t.flush(null)}))))},t.prototype.recycleAsyncId=function(t,i,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,i,r);0===t.actions.length&&(cancelAnimationFrame(i),t.scheduled=void 0)},t}(g.a),v=i(51),S=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return p.a(t,e),t.prototype.flush=function(e){this.active=true,this.scheduled=void 0;var t,i=this.actions,r=-1,n=i.length;e=e||i.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<n&&(e=i.shift()));if(this.active=false,t){for(;++r<n&&(e=i.shift());)e.unsubscribe();throw t}},t}(v.a))(m),b=S,y=function(e){function t(t,i){void 0===t&&(t=C),void 0===i&&(i=Number.POSITIVE_INFINITY);var r=e.call(this,t,(function(){return r.frame}))||this;return r.maxFrames=i,r.frame=0,r.index=-1,r}return p.a(t,e),t.prototype.flush=function(){for(var e,t,i=this.actions,r=this.maxFrames;(t=i[0])&&t.delay<=r&&(i.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=i.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10,t}(v.a),C=function(e){function t(t,i,r){void 0===r&&(r=t.index+=1);var n=e.call(this,t,i)||this;return n.scheduler=t,n.work=i,n.index=r,n.active=true,n.index=t.index=r,n}return p.a(t,e),t.prototype.schedule=function(i,r){if(void 0===r&&(r=0),!this.id)return e.prototype.schedule.call(this,i,r);this.active=false;var n=new t(this.scheduler,this.work);return this.add(n),n.schedule(i,r)},t.prototype.requestAsyncId=function(e,i,r){void 0===r&&(r=0),this.delay=e.frame+r;var n=e.actions;return n.push(this),n.sort(t.sortActions),true},t.prototype.recycleAsyncId=function(e,t,i){},t.prototype._execute=function(t,i){if(true===this.active)return e.prototype._execute.call(this,t,i)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(g.a),w=i(100),_=i(10),E=i(2),T=i(33),I=i(72),P=i(36),A=i(29);function M(e){return!!e&&(e instanceof r.a||"function"==typeof e.lift&&"function"==typeof e.subscribe)}var D=i(44),R=i(48),O=i(41),N=i(75),x=i(113),L=i(20),k=i(89),F=i(16),U=i(21);function j(e,t,i){if(t){if(!Object(U.a)(t))return function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return j(e,i).apply(void 0,r).pipe(Object(L.a)((function(e){return Object(F.a)(e)?t.apply(void 0,e):t(e)})))};i=t}return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var s,o=this,a={context:o,subject:s,callbackFunc:e,scheduler:i};return new r.a((function(r){if(i){var n={args:t,subscriber:r,params:a};return i.schedule(W,0,n)}if(!s){s=new d.a;try{e.apply(o,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];s.next(e.length<=1?e[0]:e),s.complete()}]))}catch(dp){Object(k.a)(s)?s.error(dp):console.warn(dp)}}return s.subscribe(r)}))}}function W(e){var t=this,i=e.args,r=e.subscriber,n=e.params,s=n.callbackFunc,o=n.context,a=n.scheduler,c=n.subject;if(!c){c=n.subject=new d.a;try{s.apply(o,i.concat([function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var r=e.length<=1?e[0]:e;t.add(a.schedule(B,0,{value:r,subject:c}))}]))}catch(dp){c.error(dp)}}this.add(c.subscribe(r))}function B(e){var t=e.value,i=e.subject;i.next(t),i.complete()}function H(e,t,i){if(t){if(!Object(U.a)(t))return function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return H(e,i).apply(void 0,r).pipe(Object(L.a)((function(e){return Object(F.a)(e)?t.apply(void 0,e):t(e)})))};i=t}return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var s={subject:void 0,args:t,callbackFunc:e,scheduler:i,context:this};return new r.a((function(r){var n=s.context,o=s.subject;if(i)return i.schedule(V,0,{params:s,subscriber:r,context:n});if(!o){o=s.subject=new d.a;try{e.apply(n,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=e.shift();i?o.error(i):(o.next(e.length<=1?e[0]:e),o.complete())}]))}catch(dp){Object(k.a)(o)?o.error(dp):console.warn(dp)}}return o.subscribe(r)}))}}function V(e){var t=this,i=e.params,r=e.subscriber,n=e.context,s=i.callbackFunc,o=i.args,a=i.scheduler,c=i.subject;if(!c){c=i.subject=new d.a;try{s.apply(n,o.concat([function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var r=e.shift();if(r)t.add(a.schedule(G,0,{err:r,subject:c}));else{var n=e.length<=1?e[0]:e;t.add(a.schedule(Y,0,{value:n,subject:c}))}}]))}catch(dp){this.add(a.schedule(G,0,{err:dp,subject:c}))}}this.add(c.subscribe(r))}function Y(e){var t=e.value,i=e.subject;i.next(t),i.complete()}function G(e){var t=e.err;e.subject.error(t)}var $=i(84),z=i(58),J=i(86),q=i(22),K=i(88),X=i(23);function Q(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var i=e[0];if(Object(F.a)(i))return Z(i,null);if(Object(K.a)(i)&&Object.getPrototypeOf(i)===Object.prototype){var r=Object.keys(i);return Z(r.map((function(e){return i[e]})),r)}}if("function"==typeof e[e.length-1]){var n=e.pop();return Z(e=1===e.length&&Object(F.a)(e[0])?e[0]:e,null).pipe(Object(L.a)((function(e){return n.apply(void 0,e)})))}return Z(e,null)}function Z(e,t){return new r.a((function(i){var r=e.length;if(0!==r)for(var n=new Array(r),s=0,o=0,a=function(a){var c=Object(X.a)(e[a]),l=false;i.add(c.subscribe({next:function(e){l||(l=true,o++),n[a]=e},error:function(e){return i.error(e)},complete:function(){++s!==r&&l||(o===r&&i.next(t?t.reduce((function(e,t,i){return e[t]=n[i],e}),{}):n),i.complete())}}))},c=0;c<r;c++)a(c);else i.complete()}))}var ee=i(45);function te(e,t,i,n){return Object(ee.a)(i)&&(n=i,i=void 0),n?te(e,t,i).pipe(Object(L.a)((function(e){return Object(F.a)(e)?n.apply(void 0,e):n(e)}))):new r.a((function(r){!function e(t,i,r,n,s){var o;if(function(e){return e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}(t)){var a=t;t.addEventListener(i,r,s),o=function(){return a.removeEventListener(i,r,s)}}else if(function(e){return e&&"function"==typeof e.on&&"function"==typeof e.off}(t)){var c=t;t.on(i,r),o=function(){return c.off(i,r)}}else if(function(e){return e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}(t)){var l=t;t.addListener(i,r),o=function(){return l.removeListener(i,r)}}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(var d=0,u=t.length;d<u;d++)e(t[d],i,r,n,s)}n.add(o)}(e,t,(function(e){arguments.length>1?r.next(Array.prototype.slice.call(arguments)):r.next(e)}),r,i)}))}function ie(e,t,i){return i?ie(e,t).pipe(Object(L.a)((function(e){return Object(F.a)(e)?i.apply(void 0,e):i(e)}))):new r.a((function(i){var r,n=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i.next(1===e.length?e[0]:e)};try{r=e(n)}catch(dp){return void i.error(dp)}if(Object(ee.a)(t))return function(){return t(n,r)}}))}function re(e,t,i,n,s){var o,a;if(1==arguments.length){var c=e;a=c.initialState,t=c.condition,i=c.iterate,o=c.resultSelector||A.a,s=c.scheduler}else void 0===n||Object(U.a)(n)?(a=e,o=A.a,s=n):(a=e,o=n);return new r.a((function(e){var r=a;if(s)return s.schedule(ne,0,{subscriber:e,iterate:i,condition:t,resultSelector:o,state:r});for(;;){if(t){var n=void 0;try{n=t(r)}catch(dp){return void e.error(dp)}if(!n){e.complete();break}}var c=void 0;try{c=o(r)}catch(dp){return void e.error(dp)}if(e.next(c),e.closed)break;try{r=i(r)}catch(dp){return void e.error(dp)}}}))}function ne(e){var t=e.subscriber,i=e.condition;if(!t.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(dp){return void t.error(dp)}else e.needIterate=true;if(i){var r=void 0;try{r=i(e.state)}catch(dp){return void t.error(dp)}if(!r)return void t.complete();if(t.closed)return}var n;try{n=e.resultSelector(e.state)}catch(dp){return void t.error(dp)}if(!t.closed&&(t.next(n),!t.closed))return this.schedule(e)}}function se(e,t,i){return void 0===t&&(t=q.a),void 0===i&&(i=q.a),Object(J.a)((function(){return e()?t:i}))}var oe=i(54);function ae(e,t){return void 0===e&&(e=0),void 0===t&&(t=h.a),(!Object(oe.a)(e)||e<0)&&(e=0),t&&"function"==typeof t.schedule||(t=h.a),new r.a((function(i){return i.add(t.schedule(ce,e,{subscriber:i,counter:0,period:e})),i}))}function ce(e){var t=e.subscriber,i=e.counter,r=e.period;t.next(i),this.schedule({subscriber:t,counter:i+1,period:r},r)}var le=i(115),de=new r.a(P.a);function ue(){return de}var he=i(64);function fe(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===e.length)return q.a;var i=e[0],n=e.slice(1);return 1===e.length&&Object(F.a)(i)?fe.apply(void 0,i):new r.a((function(e){var t=function(){return e.add(fe.apply(void 0,n).subscribe(e))};return Object(X.a)(i).subscribe({next:function(t){e.next(t)},error:t,complete:t})}))}function pe(e,t){return t?new r.a((function(i){var r=Object.keys(e),n=new _.a;return n.add(t.schedule(ge,0,{keys:r,index:0,subscriber:i,subscription:n,obj:e})),n})):new r.a((function(t){for(var i=Object.keys(e),r=0;r<i.length&&!t.closed;r++){var n=i[r];e.hasOwnProperty(n)&&t.next([n,e[n]])}t.complete()}))}function ge(e){var t=e.keys,i=e.index,r=e.subscriber,n=e.subscription,s=e.obj;if(!r.closed)if(i<t.length){var o=t[i];r.next([o,s[o]]),n.add(this.schedule({keys:t,index:i+1,subscriber:r,subscription:n,obj:s}))}else r.complete()}var me=i(127),ve=i(59),Se=i(32);function be(e,t,i){return[Object(Se.a)(t,i)(new r.a(Object(ve.a)(e))),Object(Se.a)(Object(me.a)(t,i))(new r.a(Object(ve.a)(e)))]}var ye=i(116);function Ce(e,t,i){return void 0===e&&(e=0),new r.a((function(r){void 0===t&&(t=e,e=0);var n=0,s=e;if(i)return i.schedule(we,0,{index:n,count:t,start:e,subscriber:r});for(;;){if(n++>=t){r.complete();break}if(r.next(s++),r.closed)break}}))}function we(e){var t=e.start,i=e.index,r=e.count,n=e.subscriber;i>=r?n.complete():(n.next(t),n.closed||(e.index=i+1,e.start=t+1,this.schedule(e)))}var _e=i(83),Ee=i(117);function Te(e,t){return new r.a((function(i){var r,n;try{r=e()}catch(dp){return void i.error(dp)}try{n=t(r)}catch(dp){return void i.error(dp)}var s=(n?Object(X.a)(n):q.a).subscribe(i);return function(){s.unsubscribe(),r&&r.unsubscribe()}}))}var Ie=i(87),Pe=i(122),Ae=i(26);i.d(t,"Observable",(function(){return r.a})),i.d(t,"ConnectableObservable",(function(){return n.a})),i.d(t,"GroupedObservable",(function(){return s.a})),i.d(t,"observable",(function(){return o.a})),i.d(t,"Subject",(function(){return a.a})),i.d(t,"BehaviorSubject",(function(){return c.a})),i.d(t,"ReplaySubject",(function(){return l.a})),i.d(t,"AsyncSubject",(function(){return d.a})),i.d(t,"asap",(function(){return u.a})),i.d(t,"asapScheduler",(function(){return u.b})),i.d(t,"async",(function(){return h.a})),i.d(t,"asyncScheduler",(function(){return h.b})),i.d(t,"queue",(function(){return f.a})),i.d(t,"queueScheduler",(function(){return f.b})),i.d(t,"animationFrame",(function(){return b})),i.d(t,"animationFrameScheduler",(function(){return S})),i.d(t,"VirtualTimeScheduler",(function(){return y})),i.d(t,"VirtualAction",(function(){return C})),i.d(t,"Scheduler",(function(){return w.a})),i.d(t,"Subscription",(function(){return _.a})),i.d(t,"Subscriber",(function(){return E.a})),i.d(t,"Notification",(function(){return T.a})),i.d(t,"NotificationKind",(function(){return T.b})),i.d(t,"pipe",(function(){return I.a})),i.d(t,"noop",(function(){return P.a})),i.d(t,"identity",(function(){return A.a})),i.d(t,"isObservable",(function(){return M})),i.d(t,"ArgumentOutOfRangeError",(function(){return D.a})),i.d(t,"EmptyError",(function(){return R.a})),i.d(t,"ObjectUnsubscribedError",(function(){return O.a})),i.d(t,"UnsubscriptionError",(function(){return N.a})),i.d(t,"TimeoutError",(function(){return x.a})),i.d(t,"bindCallback",(function(){return j})),i.d(t,"bindNodeCallback",(function(){return H})),i.d(t,"combineLatest",(function(){return $.b})),i.d(t,"concat",(function(){return z.a})),i.d(t,"defer",(function(){return J.a})),i.d(t,"empty",(function(){return q.b})),i.d(t,"forkJoin",(function(){return Q})),i.d(t,"from",(function(){return X.a})),i.d(t,"fromEvent",(function(){return te})),i.d(t,"fromEventPattern",(function(){return ie})),i.d(t,"generate",(function(){return re})),i.d(t,"iif",(function(){return se})),i.d(t,"interval",(function(){return ae})),i.d(t,"merge",(function(){return le.a})),i.d(t,"never",(function(){return ue})),i.d(t,"of",(function(){return he.a})),i.d(t,"onErrorResumeNext",(function(){return fe})),i.d(t,"pairs",(function(){return pe})),i.d(t,"partition",(function(){return be})),i.d(t,"race",(function(){return ye.a})),i.d(t,"range",(function(){return Ce})),i.d(t,"throwError",(function(){return _e.a})),i.d(t,"timer",(function(){return Ee.a})),i.d(t,"using",(function(){return Te})),i.d(t,"zip",(function(){return Ie.b})),i.d(t,"scheduled",(function(){return Pe.a})),i.d(t,"EMPTY",(function(){return q.a})),i.d(t,"NEVER",(function(){return de})),i.d(t,"config",(function(){return Ae.a}))},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(4),n=i(17),s=i(19),o=i(159),a=i(160),c=i(375),l=i(376),d=i(7),u=i(18);window.moduleIds=[],window.moduleIds.push("$$APP_PWD_PART1$$"),window.moduleIds.push("$$APP_PWD_PART2$$"),window.moduleIds.push("$$APP_PWD_PART3$$"),window.moduleIds.push("$$APP_PWD_PART4$$");class h{constructor(){this.SSO_LOGIN_POPUP_WINDOW_NAME="Single Sign-On Login",this.token=null,this.appToken=null,this.login=null,this.userId=null,this.jidIm=null,this.jidTel=null,this.jidPwd=null,this.xmppDomain=null,this.companyId=null,this.firstUseNewVersion=false,this.initialized=false,this.isGuest=false,this.authType="RAINBOW",this.fromSDK=false,this.authSettings=null,this.browserFingerprint=null,this.visibilityHandlerSubscription=null,this.renewTokenInterval=null,this.renewAppTokenInterval=null,this.sdkHostForced=null,this.win=window,this.globalSSOSettings=null,this.rxSubject=new d.Subject,this.logger=r.LoggerService.getInstance(),this.mainService=n.MainService.getInstance(),this.settingsService=s.SettingsService.getInstance();const e=localStorage.getItem("version"),t=this.getMajorVersion(e),i=this.getMajorVersion(this.win.version);config.appModuleKey||(config.appModuleKey=this.win.moduleIds?this.win.moduleIds.join(""):"default"),t!==i&&(this.firstUseNewVersion=true),localStorage.setItem("version",this.win.version),this.getServerApiUrls()}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.authService||(e.rainbow.authService=new h),e.rainbow.authService}subscribe(e){return this.rxSubject.subscribe(e)}emitEvent(e){this.rxSubject.next(u.RBEvent.create(e))}async logon(e,t,i=true,r=null){try{if(-1===e.indexOf("@"))throw this.createError(`Wrong login format '${e}'`,"errorUnauthorized",401500,void 0,true);let n=config.restServerUrl+"/api/rainbow/authentication/v1.0/login";r&&("RAINBOW"===r.type?n=r.loginUrl:r.safetyUrl&&(n=r.safetyUrl,this.authType=r.type));const s={};s.Authorization="Basic "+window.btoa(unescape(encodeURIComponent(e+":"+t))),s.Accept="application/json",this.setInformationHeaders(s);let o=null;config.rainbowApiClientKey&&(o=config.rainbowApiClientKey+":"+c.SHA256(config.appModuleKey+t)),this.fromSDK&&this.appToken&&this.appToken.appID&&(o=this.appToken.appID+":"+c.SHA256(this.appToken.appSecret+t)),o&&(s["x-rainbow-app-auth"]="Basic "+window.btoa(unescape(encodeURIComponent(o))));const a=await l.default(n,{method:"GET",headers:s,credentials:"include"});if(!a.ok)throw a;const d=await a.json();this.token=d.token,this.extractUserInfo(d.loggedInUser),i?(this.logger.info("[AuthService] Store authentication info in local storage"),localStorage.setItem("login",this.login),localStorage.setItem("id",this.userId),localStorage.setItem("token",this.token),localStorage.setItem("authType",this.authType)):this.removeCredentials(),localStorage.setItem("firstUse","false"),this.logger.info(`[AuthService] Authenticate with ${e} -- SUCCESS`),this.registerEventsHandler(),this.startTokenSurvey()}catch(n){let t=`authenticate for login ${e} -- FAILURE -- `;if(n.localError)throw this.logger.error(`[AuthService] ${t} ${n}`),n;let i="errorUltimateUnknownError",r=null,s=null;if(0===n.status||-1===n.status)t+="No server response",i="errorNoServerResponse";else{const e=await n.json();401===n.status?(this.removeCredentials(),t+=e.errorDetails,r=e.errorDetailsCode,401500===e.errorDetailsCode?i="errorUnauthorized":401501===e.errorDetailsCode&&(i="errorLoginForbidden",e.errorDetailsData&&(s={delay:e.errorDetailsData.forbiddenDelay}))):500===n.status&&(t+=e.errorDetails,i="errorInternalServerError")}throw this.logger.error("[AuthService] "+t),this.createError(t,i,r,s)}}async logonWithToken(e=null){try{if(this.logger.info("[authService] logonWithToken -- "+e),e||(e=localStorage.getItem("token")),!e)throw new Error("No token");const t=a.default(e);this.token=e,this.login=t.user.loginEmail,this.userId=t.user.id,this.authType="RAINBOW",t.saml&&(this.authType="SAML"),t.oidc&&(this.authType="OIDC"),localStorage.setItem("token",this.token),localStorage.setItem("login",this.login),localStorage.setItem("id",this.userId),localStorage.setItem("authType",this.authType),await new Promise((e=>setTimeout(e,2e3))),await this.getUserData(),await this.startTokenSurvey(),this.authSettings=await this.getUserAuthenticationSettings(this.login),this.registerEventsHandler()}catch(t){const e=t?t.message:"Unknown error";throw"No token"===e?this.logger.debug("[AuthService] AuthenticateWithToken -- No available token"):this.logger.error("[AuthService] AuthenticateWithToken -- FAILURE -- "+e),new Error(e)}}async sdkLogOn(e,t,i,r,n){return this.sdkHostForced=i,this.appToken=r,this.fromSDK=true,this.getServerApiUrls(),n?this.logonWithToken(n):this.logon(e,t,false)}async sdkSetRenewedToken(e=null){try{return this.logger.debug("[AuthService] sdkSetRenewedToken with "+e),this.token=e,await new Promise((e=>setTimeout(e,2e3))),localStorage.setItem("token",this.token),this.startUserTokenSurvey(),void this.logger.debug("[AuthService] sdkSetRenewedToken -- reStartTokenSurvey -- SUCCESS")}catch(t){const e=t&&t.message?t:new Error("Unknown error");throw this.logger.error("[AuthService] StartTokenSurvey -- FAILURE -- "+e.message),e}}logout(){return this.removeCredentials(),this.authSettings&&this.authSettings.logoutUrl&&"RAINBOW"!==this.authType?(this.logger.info("[authService] Logout -- "+this.authType),this.authSettings.setParameter("token",(()=>this.token)),this.authSettings.logoutUrl):(this.logger.info("[AuthService] Logout -- SUCCESS"),null)}async getGlobalSSOConfiguration(){try{const e=config.restServerUrl+"/api/rainbow/authentication/v1.0/login",t=config.restServerUrl+"/api/rainbow/authentication/v1.0/global-sso",i={};this.setInformationHeaders(i);const r=await l.default(t,{method:"GET",headers:i});if(!r.ok)throw r;this.logger.info("[AuthService] getGlobalSSOConfiguration -- SUCCESS");let n=await r.json(),s=null;if(n=n.data,n&&n.length&&n.forEach((e=>{this.logger.info("[AuthService] getGlobalSSOConfiguration -- type: "+e.type),"ASIP_SANTE"===e.type&&(s=e)})),s){const t=o.AuthSettings.createFromData([s]);t.setParameter("x-rainbow-app-auth",(e=>this.getRainbowAppAuth(config.rainbowApiClientKey,config.appModuleKey,e))),!window||-1===window.location.href.indexOf("localhost")&&-1===window.location.href.indexOf("openrainbow.red")||t.setParameter("safetyUrl",(()=>e)),this.globalSSOSettings=t}return this.globalSSOSettings}catch(e){let t="getGlobalSSOConfiguration failure : ",i="errorUltimateUnknownError";if(0===e.status||-1===e.status)t+="No server response",i="errorNoServerResponse";else{const r=await e.json();400===e.status||404===e.status?(t+=r.errorDetails,i="errorUnauthorized"):500===e.status&&(t+=r.errorDetails,i="errorInternalServerError")}this.logger.info("[authService] "+t);const r=new Error(t);throw r.details=i,r}}async getUserAuthenticationSettings(e=null,t=false){try{const i=config.restServerUrl+"/api/rainbow/authentication/v1.0/login";if(config.disableSSO&&(t=true),t)return o.AuthSettings.createFromData([{type:"RAINBOW",loginUrl:i}]);const r=`${config.restServerUrl}/api/rainbow/authentication/v1.0/urls?uid=${encodeURIComponent(e)}`,n={};this.setInformationHeaders(n);const s=await l.default(r,{method:"GET",headers:n});if(!s.ok)throw s;const a=await s.json(),c=o.AuthSettings.createFromData(a.data);return c.setParameter("uid",(()=>e)),c.setParameter("x-rainbow-app-auth",(e=>this.getRainbowAppAuth(config.rainbowApiClientKey,config.appModuleKey,e))),!window||-1===window.location.href.indexOf("localhost")&&-1===window.location.href.indexOf("openrainbow.red")||c.setParameter("safetyUrl",(()=>i)),c}catch(i){let t='authenticate for login "'+e+'" failure : ',r="errorUltimateUnknownError";if(0===i.status||-1===i.status)t+="No server response",r="errorNoServerResponse";else{const e=await i.json();400===i.status||404===i.status?(t+=e.errorDetails,r="errorUnauthorized"):500===i.status&&(t+=e.errorDetails,r="errorInternalServerError")}this.logger.info("[authService] "+t);const n=new Error(t);throw n.details=r,n}}removeCredentials(){this.authType="RAINBOW",localStorage.removeItem("id"),localStorage.removeItem("token"),localStorage.removeItem("authType"),localStorage.removeItem("token"),this.isGuest&&(localStorage.removeItem("login"),this.isGuest=false),this.resetUserEnvironment(),this.logger.debug("[AuthService] removeCredentials -- SUCCESS")}resetUserEnvironment(){config.defaultEnvironment&&(config.xmpp.currentServer=config.defaultEnvironment,config.xmpp.server=config.defaultEnvironment,config.webservices.currentServer=config.defaultEnvironment,config.webservices.server=config.defaultEnvironment)}getRequestHeader(e){return{Authorization:"Bearer "+this.token,Accept:e||"application/json"}}getRequestHeaderWithRange(e){const t=this.getRequestHeader();return t.Range=e,t}getPostHeader(e=null,t=null){const i=this.getRequestHeader(t);return i["Content-Type"]=e||"application/json",i}getPostHeaderWithRange(e,t){const i=this.getPostHeader(t);return i["Content-Range"]=e,i}setInformationHeaders(e){e["x-rainbow-client"]=this.getInformationHeadersApp(),e["x-rainbow-client-version"]=this.getInformationHeadersAppVersion()}getInformationHeadersApp(){return"web_sdk"}getInformationHeadersAppVersion(){const e=window;return e.sdkversion?e.sdkversion:"9.9.99"}async startTokenSurvey(){try{await this.startAppTokenSurvey(),await this.startUserTokenSurvey(),this.logger.debug("[AuthService] StartTokenSurvey -- SUCCESS")}catch(e){const t=e&&e.message?e:new Error("Unknown error");throw this.logger.error("[AuthService] StartTokenSurvey -- FAILURE -- "+t.message),t}}stopTokenSurvey(){this.renewTokenInterval&&clearTimeout(this.renewTokenInterval),this.renewAppTokenInterval&&clearTimeout(this.renewAppTokenInterval),this.logger.debug("[AuthService] StopTokenSurvey -- SUCCESS")}getRainbowAppAuth(e,t,i=null){return window.btoa(unescape(encodeURIComponent((e||"")+":"+c.SHA256((t||"")+(i||"")))))}registerEventsHandler(){this.visibilityHandlerSubscription&&this.visibilityHandlerSubscription.unsubscribe(),this.visibilityHandlerSubscription=this.mainService.appVisible.subscribe((e=>{e&&this.startTokenSurvey()}))}getMajorVersion(e){if(!e)return null;const t=/\d+\.\d+/g.exec(e);return t&&t.length>0?t[0]:null}getServerApiUrls(){const e=localStorage.getItem("server");e&&"null"!==e&&"undefined"!==e?(this.logger.debug("[AuthService] getServerApiUrls -- Find server data from local storage -- "+e),config.xmpp.currentServer=config.webservices.currentServer=e,"openrainbow.net"===e&&(config.appModuleKey=config.dotNetAppModuleKey,config.rainbowApiClientKey=config.dotNetRainbowApiClientKey,config.multiEnvServer="openrainbow.net"),"openrainbow.com"===e&&(config.appModuleKey=config.dotComAppModuleKey,config.rainbowApiClientKey=config.dotComRainbowApiClientKey,config.multiEnvServer="openrainbow.com"),"openrainbow.red"===e&&(config.appModuleKey=config.dotComAppModuleKey,config.rainbowApiClientKey=config.dotComRainbowApiClientKey,config.multiEnvServer="openrainbow.com"),config.defaultEnvironment||(config.defaultEnvironment=config.xmpp.currentServer)):this.sdkHostForced?(config.xmpp.currentServer=config.webservices.currentServer=this.sdkHostForced,this.logger.debug("[AuthService] getServerApiUrls -- Use forced sdk server -- "+this.sdkHostForced)):config.xmpp&&(config.xmpp.currentServer=config.xmpp.server,config.webservices.currentServer=config.webservices.server,this.logger.debug("[AuthService] getServerApiUrls -- Use default config server -- "+config.xmpp.server)),config.webservices&&(config.restServerUrl=`${config.webservices.protocol}://${config.webservices.currentServer}:${config.webservices.port}`)}async startAppTokenSurvey(){if(!this.appToken||"string"!=typeof this.appToken||!this.appToken.length)return void this.logger.info("[AuthService] startAppTokenSurvey -- No application token.");const e=a.default(this.appToken),t=1e3*e.exp,i=new Date(t),r=t-(new Date).valueOf();if(this.renewAppTokenInterval&&clearTimeout(this.renewAppTokenInterval),this.logger.info("[AuthService] startAppTokenSurvey -- Extract application token info (countRenewed: "+e.countRenewed+", maxTokenRenew: "+e.maxTokenRenew+")"),r<0)return this.logger.info("[AuthService] startAppTokenSurvey -- Application token has already expired, re-new it immediately"),void(await this.renewAppToken());if(r<3e4)return this.logger.info("[AuthService] startAppTokenSurvey -- Application token will expire in less 5 minutes, re-new it immediately"),void(await this.renewAppToken());const n=r-24e3;this.logger.info("[authService] startAppTokenSurvey -- Start application token survey (expirationDate: "+i+" tokenExpirationDuration: "+r+"ms usedExpirationDuration: "+n+"ms)"),this.renewAppTokenInterval=setTimeout((()=>{this.renewAppToken()}),n)}async renewAppToken(){try{const e=config.restServerUrl+"/api/rainbow/applications/v1.0/authentication/renew",t=await l.default(e,{method:"GET",headers:this.getRequestHeader()});if(!t.ok)throw t;const i=await t.json();this.logger.info("[AuthService] renewAppToken -- Renew application token success"),this.appToken=i.token,localStorage.setItem("appToken",this.appToken),this.emitEvent("ON_APP_TOKEN_RENEW"),this.startAppTokenSurvey()}catch(e){this.renewAppTokenInterval&&clearTimeout(this.renewAppTokenInterval);const t=await e.json(),i="Renew application token failure -- "+(t&&t.errorDetails?t.errorDetails:"no details"),r=new Error(i);throw r.details="APP_TOKEN_EXPIRED",this.logger.error("[AuthService] renewAppToken -- FAILURE --"+i),this.emitEvent("ON_APP_TOKEN_EXPIRE"),r}}async startUserTokenSurvey(){if(!this.token||"string"!=typeof this.token||!this.token.length)return void this.logger.info("[AuthService] No token.");const e=a.default(this.token),t=1e3*e.exp,i=(t-1e3*e.iat)/2,r=new Date(t),n=t-(new Date).valueOf();if(this.renewTokenInterval&&clearTimeout(this.renewTokenInterval),this.logger.info("[AuthService] startUserTokenSurvey -- Extract auth token info (countRenewed: "+e.countRenewed+", maxTokenRenew: "+e.maxTokenRenew+", tokenExpirationDuration: "+n+")"),n<0){this.logger.info("[AuthService] startUserTokenSurvey --  Auth token has already expired send ON_AUTH_TOKEN_EXPIRE event"),this.token=null,this.emitEvent("ON_AUTH_TOKEN_EXPIRE");const e=new Error("Token expired");throw e.details="AUTH_TOKEN_EXPIRED",e}if(n<i)return this.logger.info("[AuthService] startUserTokenSurvey -- Auth token will expire in less "+i/1e3+" seconds"),this.emitEvent("ON_AUTH_TOKEN_WILL_EXPIRE"),this.logger.info("[AuthService] startUserTokenSurvey send ON_AUTH_TOKEN_WILL_EXPIRE event"),void(void 0===e.oauth&&(this.logger.info("[AuthService] startUserTokenSurvey -- try to re-new it immediately"),await this.renewAuthToken()));const s=n-i;this.logger.info("[AuthService] startUserTokenSurvey -- Start auth token survey (expirationDate: "+r+" tokenExpirationDuration: "+n+"ms usedExpirationDuration: "+s+"ms)"),this.renewTokenInterval=setTimeout((()=>{void 0===e.oauth?this.renewAuthToken():this.startTokenSurvey()}),s)}async renewAuthToken(e=false){try{const t=config.restServerUrl+"/api/rainbow/authentication/v1.0/renew",i=await l.default(t,{method:"GET",headers:this.getRequestHeader()});if(!i.ok)throw i;const r=await i.json();this.logger.info("[AuthService] renewAuthToken -- Renew authentication token success"),this.token=r.token,localStorage.setItem("token",this.token),this.emitEvent("ON_AUTH_TOKEN_RENEW"),e&&true!==e||this.startTokenSurvey()}catch(t){this.renewTokenInterval&&clearTimeout(this.renewTokenInterval);let e="";if(t.json){const i=await t.json();e=i&&i.errorDetails?i.errorDetails:"no details";const r="Renew authentication token failure -- "+e,n=new Error(r);throw n.details="AUTH_TOKEN_EXPIRED",this.logger.error("[AuthService] renewAuthToken -- FAILURE -- "+r),this.emitEvent("ON_AUTH_TOKEN_EXPIRE"),n}{const e="Renew authentication token failure -- "+t.message;this.logger.error("[AuthService] renewAuthToken -- FAILURE -- "+e)}}}async getUserData(){try{const e=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.userId}`,t=await l.default(e,{method:"GET",headers:this.getRequestHeader()});if(!t.ok)throw t;const i=await t.json();this.extractUserInfo(i.data)}catch(e){if(this.removeCredentials(),e instanceof Response)throw new Error("Wrong token -- "+e.statusText);throw new Error("Wrong token -- "+e.message)}}async getUserEnvironments(e){try{if(!config.multiEnvServer)return[{environmentApiUrl:"https://"+config.xmpp.currentServer}];config.defaultEnvironment||(config.defaultEnvironment=config.xmpp.server);const t=config.webservices.protocol+"://"+config.multiEnvServer+":"+config.webservices.port+"/api/rainbow/multienvironments/v1.0/environments?loginEmail="+encodeURIComponent(e),i=await l.default(t,{method:"GET"});if(!i.ok)throw i;return(await i.json()).data}catch(t){let i='getUserEnvironments for login "'+e+'" failure : ';if(0===t.status||-1===t.status)i+="No server response";else if(500===t.status){i+=(await t.json()).errorDetails}return this.logger.info("[authService] "+i),this.logger.info("[authService] getUserEnvironment -- continue with default environment"),null}}async getCompanySAMLConfiguration(e){try{const t=`${config.restServerUrl}/api/rainbow/authentication/v1.0/saml/${e}/metadata.xml`,i=await l.default(t,{method:"GET",headers:this.getRequestHeader()});if(!i.ok)throw i;return this.logger.debug("[AuthService] getCompanySAMLConfiguration -- SUCCESS"),await i.text()}catch(t){throw this.logger.error("[AuthService] getCompanySAMLConfiguration -- FAILURE -- "+JSON.stringify(t)),new Error("getCompanySAMLConfiguration failure")}}async getFingerPrint(){if(!this.browserFingerprint){const e=["audio","availableScreenResolution","canvas","colorDepth","cookies","cpuClass","deviceDpi","doNotTrack","indexedDb","installedFonts","language","localStorage","pixelRatio","platform","plugins","processorCores","screenResolution","sessionStorage","timezoneOffset","touchSupport","userAgent","webGl"];this.browserFingerprint=await imprint.test(e)}return this.browserFingerprint}handleUserLanguage(){const e=this.loggedInUser.language;e&&this.settingsService.setAppliLangageCodeFromServer(e)}createError(e,t=null,i=null,r=null,n=false){const s=new Error(e);return s.details=t,s.detailsCode=i,s.detailsData=r,s.localError=n,s}extractUserInfo(e){this.loggedInUser=e,this.login=this.loggedInUser.loginEmail,this.userId=this.loggedInUser.id,this.jidIm=this.loggedInUser.jid_im,this.jidPwd=this.loggedInUser.jid_password,this.jidTel=this.loggedInUser.jid_tel,this.initialized=this.loggedInUser.isInitialized,this.isGuest=this.loggedInUser.guestMode,this.companyId=this.loggedInUser.companyId,this.xmppDomain=this.jidIm.split("@")[1],this.handleUserLanguage()}}t.AuthService=h},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7),n=i(18),s=i(4),o=i(19),a=i(8),c=i(161),l=i(17),d=i(65),u=i(136);class h{constructor(){this.logger=s.LoggerService.getInstance(),this.authService=a.AuthService.getInstance(),this.settingsService=o.SettingsService.getInstance(),this.mainService=l.MainService.getInstance(),this.rxConnectionSubject=new r.Subject,this.rxContactSubject=new r.Subject,this.showBodyMessage=false,this.presenceWaitingList=[],this.xmppServerURL=null,this.stropheStatus=null,this.presenceStatus="offline",this.pingTimeout=null,this.connecting=false,this.disconnectInfo=null,this.connectionWatcherTimout=null,this.isInitialPresenceSent=false,this.historyHandler=null,this.bulkHistoryHandler=null,this.searchTextHandler=null,this.reconnectInProgress=false,this.reconnectionDelay=250,this.reconnectTimeout=null,this.connectivityEventSubscription=null,this.lastPingDate=null,this.started=false,this.connection=null,this.jid=null,this.fullJid=null,this.changePasswordInfo=null,this.contactServiceReady=false,this.connected=false,this.reconnectionMode=false}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.xmppService||(e.rainbow.xmppService=new h),e.rainbow.xmppService}onHandleConnectivity(e){e?(this.logger.info("[xmppService] onHandleConnectivityEvent -- retrieve connectivity"),this.autoReconnect(true)):(this.logger.info("[xmppService] onHandleConnectivityEvent -- lost connectivity"),this.stropheStatus===Strophe.Status.CONNECTED&&(this.interruptAutoReconnect(),this.disconnect("NO_NETWORK")))}async start(){try{if(this.connectivityEventSubscription=this.mainService.appConnectivity.subscribe((e=>{this.onHandleConnectivity(e)})),!this.authService.jidIm||!this.authService.jidPwd)throw new Error("No valid XMPP credentials");this.xmppServerURL=`${config.xmpp.protocol}://${config.xmpp.currentServer}:${config.xmpp.port}/websocket`,this.showBodyMessage=this.settingsService.getBooleanSetting("showBodyMessage"),this.pingTimeout=config.xmpp.pingInterval?2*parseInt(config.xmpp.pingInterval,10):12e4,await this.connect(),this.publishConnectionEvent("ON_XMPP_CONNECTED",{reason:"LOGIN"})}catch(e){throw this.logger.error("[xmppService] start -- FAILURE -- "+e.message),e}}async stop(){this.reconnectionMode=false;try{await this.disconnect("LOGOUT")}catch(e){}this.started=false,this.connected=false,this.stropheStatus=null,this.presenceStatus="offline",this.fullJid=null,this.lastPingDate=null,this.reconnectInProgress=false,this.connectivityEventSubscription&&(this.connectivityEventSubscription.unsubscribe(),this.connectivityEventSubscription=null)}resetAllObjects(){this.reconnectionMode=false,this.started=false,this.connected=false,this.stropheStatus=null,this.presenceStatus="offline",this.fullJid=null,this.lastPingDate=null,this.connectivityEventSubscription&&(this.connectivityEventSubscription.unsubscribe(),this.connectivityEventSubscription=null)}async connect(){try{if(this.stropheStatus===Strophe.Status.CONNECTING||this.stropheStatus===Strophe.Status.CONNECTED||this.stropheStatus===Strophe.Status.AUTHENTICATING){const e=new Error("XMPP service already connected or connecting");throw e.details=this.stropheStatus===Strophe.Status.CONNECTING?"XMPP_IN_CONNECTING_STATE":"XMPP_ALREADY_CONNECTED",e}const e=this.authService.getInformationHeadersApp(),t=this.authService.getInformationHeadersAppVersion(),i=this.authService.xmppDomain;if(null===e||null===t||null===i)throw new Error("XMPP service -- Missing connection data");let r=null;this.connection&&this.connection.jingle&&this.connection.jingle.rxSubject&&(r=this.connection.jingle.rxSubject),this.connection=new Strophe.Connection(`${this.xmppServerURL}?x-rainbow-client=${e}&x-rainbow-client-version=${t}&x-rainbow-xmpp-dom=${i}`),this.connection.rawInput=e=>{this.handleRawXmppMessage(e,"Recv: ")},this.connection.rawOutput=e=>{this.handleRawXmppMessage(e,"Sent: ")},r&&this.connection&&this.connection.jingle&&(this.connection.jingle.rxSubject=r),this.jid=this.authService.jidIm,this.fullJid||(this.fullJid=this.generateRandomFullJid(this.jid)),await this.stropheConnect(),this.connected=true,this.connection.ping.addPingHandler((e=>(this.logger.info(`[xmppService] onKeepAlivePingEvent (${new Date})`),this.connected&&(this.connection.ping.pong(e),this.lastPingDate=new Date),true))),this.addHandler((e=>this.onRosterChangedMessageReceived(e)),"jabber:iq:roster","iq","set"),this.addHandler((e=>this.onMamMessageReceived(e)),Strophe.NS.MAM,"message",null),this.addHandler((e=>this.onMamMessageReceived(e)),Strophe.NS.MAM,"iq",null),this.addHandler((e=>this.onMamBulkMessageReceived(e)),"urn:xmpp:mam:1:bulk","message",null),this.addHandler((e=>this.onMamBulkMessageReceived(e)),"urn:xmpp:mam:1:bulk","iq",null),this.addHandler((e=>this.onSearchTextMessageReceived(e)),"urn:xmpp:mam:tmp","message",null),this.addHandler((e=>this.onPresenceMessageReceived(e)),null,"presence"),this.connection.jingle&&this.connection.jingle.attachHandlers(),this.presenceWaitingList=[];const n=$iq({type:"set"});n.c("enable",{xmlns:"urn:xmpp:carbons:2"}),this.sendIQ(n),this.started=true}catch(e){throw this.logger.error("[xmppService] connect -- FAILURE -- "+e.message),e}}waitForGuestXmppReconnection(){return this.logger.info("[xmppService] waitForGuestXmppReconnection -- waiting"),new Promise((e=>{const t=setTimeout((async()=>{t&&clearTimeout(t),i&&i.unsubscribe(),this.logger.info("[xmppService] waitForGuestXmppReconnection -- security timeout"),await this.stop(),e()}),15e3),i=this.subscribeToConnectionEvents((async()=>{t&&clearTimeout(t),i&&i.unsubscribe(),this.logger.info("[xmppService] waitForGuestXmppReconnection -- reconnection done"),await this.stop(),e()}));this.reconnectionMode=true,this.start()}))}disconnect(e){return new Promise((t=>{this.connected?this.stropheStatus===Strophe.Status.CONNECTED?(this.logger.info("[xmppService] disconnect -- "+e),this.disconnectInfo={reason:e,resolve:t},this.connection.disconnect(e)):(this.logger.warn("[xmppService] disconnect - service is started and not started = flags are not correct"),t(-1)):(this.logger.info("[xmppService] disconnect - service is not started"),t(0))}))}stropheConnect(){return new Promise(((e,t)=>{this.connecting=true,this.connection.connect(this.fullJid,this.authService.jidPwd,((i,r=null)=>{switch(this.stropheStatus=i,i){case Strophe.Status.CONNECTING:this.logger.info("[xmppService] connecting -- "+this.fullJid),this.publishConnectionEvent("ON_XMPP_CONNECTING");break;case Strophe.Status.AUTHFAIL:this.logger.error(`[xmppService] onAuthenticationFailureEvent -- ${r} -- ${this.fullJid}`),this.connecting=false,t(new Error("Authentication failure -- "+r));break;case Strophe.Status.CONNFAIL:if(!this.connecting)break;this.logger.error("[xmppService] onConnectionFailureEvent -- ConnectionFail -- "+this.fullJid),this.connecting=false,t(new Error("Connection failure -- "+r));break;case Strophe.Status.CONNECTED:this.logger.info("[xmppService] onConnectedEvent -- "+this.fullJid),this.connecting=false,this.reconnectInProgress=false,e(null);break;case Strophe.Status.DISCONNECTED:if(this.connecting){this.logger.error("[xmppService] onConnectionFailureEvent -- Disconnected -- "+this.fullJid),t(new Error("Connection failure -- "+r));break}this.reconnectInProgress||this.onDisconnectEvent(r);break;case Strophe.Status.ERROR:this.connected&&(this.logger.error(`[xmppService] WebSocketError -- ${this.fullJid} -- ${r}`),"resource-constraint"===r&&(this.interruptAutoReconnect(true),this.reconnectInProgress=true,this.authService.logout(),this.publishConnectionEvent("ON_XMPP_DISCONNECTED",{reason:"RESOURCE_CONSTRAINTS"})))}}))}))}connectionWatcher(){try{if(this.logger.error("[xmppService] connection watcher : so bad, no message since "+this.pingTimeout/1e3+" seconds (no ping)"),this.connection){const e=this.stropheStatus===Strophe.Status.CONNECTED?"Have lost connectivity":"Stuck in reconnecting state";this.logger.info("[xmppService] connection watcher -- "+e),this.stropheStatus=null,this.connection.disconnect("No ping")}}catch(e){this.logger.error("connectionWatcher error "+e)}}generateRandomFullJid(e){const t=navigator.platform.toUpperCase().indexOf("MAC")>=0?"osx":"win";let i="desk_"+t;return this.mainService.isDesktopApp()||(i=this.authService.fromSDK?"web_sdk":"web_"+t),`${e}/${i}_${version}_${c.default(8)}`}handleRawXmppMessage(e,t){if(this.connectionWatcherTimout&&clearTimeout(this.connectionWatcherTimout),this.connectionWatcherTimout=setTimeout((()=>{this.connectionWatcher()}),this.pingTimeout),!(e.indexOf("<PHOTO>")>-1)){let i=t;if(e.indexOf("urn:xmpp:mam:1:bulk")>-1)"true"===this.settingsService.getSetting("devMode")&&"true"===this.settingsService.getSetting("showBodyMessage")?i+=e:i+="Hidden content -- bulk";else if(e.indexOf("xmlns='jabber:x:bubble:conference'")>-1&&(e.indexOf("name='invitation'")>-1||e.indexOf("name='conferenceAdd'")>-1||e.indexOf("name='conferenceRemove'")>-1))i+="Hidden content -- xmlns='jabber:x:bubble:conference -- ",e.indexOf("name='invitation'")>-1&&(i+=" invitation"),e.indexOf("name='conferenceAdd'")>-1&&(i+=" conferenceAdd"),e.indexOf("name='conferenceRemove'")>-1&&(i+=" conferenceRemove");else if(e.indexOf("urn:xmpp:jingle")>-1)"true"===this.settingsService.getSetting("devMode")&&"true"===this.settingsService.getSetting("showBodyMessage")?i+=e:e.indexOf("displayname")>-1||e.indexOf("number")>-1?i+="Hidden content -- jingle":i+=e;else if(e.indexOf("urn:xmpp:janus:1")>-1&&(e.indexOf("displayName")>-1||e.indexOf("displayname")>-1||e.indexOf("number")>-1))i+="Hidden content";else if(e.indexOf("<message")>-1&&(e.indexOf("<body")>-1||e.indexOf("<content>")>-1||e.indexOf("<thumbnail")>-1))i+=this.messageBodyDiscretion(e);else{let t=e;if("http://jabber.org/protocol/ibb"===u.default(e).find("data").attr("xmlns")&&(i+="Encoded file in base 64"),!this.showBodyMessage){if(-1!==e.indexOf("<identity")){const i=e.indexOf("firstName="),r=e.indexOf("'",i);if(-1!==i&&-1!==r){const i=e.indexOf("'",r+1);r+1!==i&&(t=e.substr(0,r+2)+"***"+e.substr(i))}const n=t.indexOf("lastName="),s=t.indexOf("'",n);if(-1!==n&&-1!==s){const e=t.indexOf("'",s+1);s+1!==e&&(t=t.substr(0,s+2)+"***"+t.substr(e))}}if(-1!==t.indexOf("<caller_info")||-1!==t.indexOf("<callee_info")){const e=t.indexOf("number="),i=t.indexOf("'",e);if(-1!==e&&-1!==i){const e=t.indexOf("'",i+1);if(i+1!==e){const r=t.substr(i+1,e-i-1);t=t.substr(0,i+1)+d.default(r)+t.substr(e)}}}if(-1!==t.indexOf("<caller>")){const e=t.indexOf("<caller>"),i=t.indexOf("</caller>",e),r=t.substring(e+8,i);-1===r.indexOf("@")&&-1===r.indexOf("janus")&&(t=t.substr(0,e+8)+d.default(r)+t.substr(i))}if(-1!==t.indexOf("<callee>")){const e=t.indexOf("<callee>"),i=t.indexOf("</callee>",e),r=t.substring(e+8,i);-1===r.indexOf("@")&&-1===r.indexOf("janus")&&(t=t.substr(0,e+8)+d.default(r)+t.substr(i))}if(-1!==t.indexOf("<event")){const e=t.indexOf("<message>"),i=t.indexOf("</message>",e);t=t.substr(0,e+9)+"***"+t.substr(i)}const i=t.indexOf("endpointTel='");if(-1!==i){const e=t.indexOf("'",i+13),r=t.substring(i+13,e);t=t.substr(0,i+13)+d.default(r)+t.substr(e)}const r=t.indexOf("destination='");if(-1!==r){const e=t.indexOf("'",r+13),i=t.substring(r+13,e);t=t.substr(0,r+13)+d.default(i)+t.substr(e)}if(-1!==t.indexOf("<name>")){const e=t.indexOf("<name>"),i=t.indexOf("</name>",e);t=t.substr(0,e+6)+"***"+t.substr(i)}}i+=t}this.logger.debug(i)}}messageBodyDiscretion(e){return this.showBodyMessage?e:(e=this.messageTagDiscretion("content",e),e=this.messageTagDiscretion("body",e),e=this.messageTagDiscretion("subject",e),e=this.messageTagDiscretion("filename",e))}messageTagDiscretion(e,t){const i=t.indexOf("<"+e);if(-1!==i){const r=t.indexOf(">",i),n=t.indexOf("/>",i);if(-1!==r&&r!==n+1)return t.substr(0,r+2)+"***"+t.substr(t.indexOf("</"+e+">")-1)}return t}async onDisconnectEvent(e){if(this.connectionWatcherTimout&&clearTimeout(this.connectionWatcherTimout),this.authService.stopTokenSurvey(),this.isInitialPresenceSent=false,this.started){if(this.disconnectInfo)return this.logger.info(`[xmppService] onDisconnectEvent -- Expected disconnection -- ${this.disconnectInfo.reason} -- ${this.fullJid}`),this.connected=false,this.publishConnectionEvent("ON_XMPP_DISCONNECTED",{reason:this.disconnectInfo.reason}),this.disconnectInfo.resolve(),void(this.disconnectInfo=null);if(this.changePasswordInfo)if(this.connected=false,this.changePasswordInfo.fromThirdParty)this.logger.error("[xmppService] onDisconnectEvent -- Expected disconnection -- change password from third party -- "+this.fullJid),this.publishConnectionEvent("ON_XMPP_DISCONNECTED",{reason:"3RD_PARTY_CHANGE_PWD"});else{this.logger.error("[xmppService] onDisconnectEvent -- Expected disconnection -- change password -- "+this.fullJid);try{await this.authService.logon(this.changePasswordInfo.login,this.changePasswordInfo.newPassword,true)}catch(t){this.publishConnectionEvent("ON_XMPP_DISCONNECTED",{reason:"CHANGE_PWD_ERROR"})}this.changePasswordInfo.resolve&&this.changePasswordInfo.resolve(),this.changePasswordInfo=null,this.publishConnectionEvent("ON_XMPP_DISCONNECTED",{reason:"CHANGE_PWD"}),this.autoReconnect()}else this.logger.error(`[xmppService] onDisconnectEvent -- Unexpected disconnection -- ${e} -- ${this.fullJid}`),this.connected=false,this.publishConnectionEvent("ON_XMPP_DISCONNECTED",{reason:"UNKNOWN"}),this.autoReconnect()}else this.logger.info("[xmppService] onDisconnectEvent -- service not started -- ignored")}interruptAutoReconnect(e=false){(this.reconnectInProgress||e)&&(this.logger.info("[xmppService] interrupt auto-reconnection"),this.reconnectionDelay=250,this.reconnectInProgress=false,this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.connectionWatcherTimout&&(this.logger.info("[xmppService] Clear connection watcher timeout"),clearTimeout(this.connectionWatcherTimout)))}async autoReconnect(e=false){try{this.interruptAutoReconnect(e),this.logger.info("[xmppService] autoReconnect"),this.reconnectInProgress=true,await this.authService.startTokenSurvey(),await this.connect(),this.reconnectionDelay=250,this.reconnectInProgress=false,this.logger.info("[xmppService] autoReconnect -- SUCCESS"),this.publishConnectionEvent("ON_XMPP_CONNECTED",{reason:"RECONNECTION",lastActivityDate:this.lastPingDate})}catch(t){let e=t;switch(t&&t.details||(e=new Error,e.details="UNKNOWN"),e.details){case"AUTH_TOKEN_EXPIRED":this.logger.error("[xmppService] Impossible to renew token, redirect to login page"),this.interruptAutoReconnect(),this.authService.logout(),this.reconnectInProgress=false;break;case"XMPP_ALREADY_CONNECTED":this.logger.error("[xmppService] In auto-reconnect, but already connected -- ignore"),this.reconnectInProgress=false;break;case"XMPP_IN_CONNECTING_STATE":this.logger.error("[xmppService] xmpp is still connecting -- wait");break;default:this.reconnectInProgress&&(this.reconnectionDelay=2*this.reconnectionDelay,this.reconnectionDelay>15e3&&(this.reconnectionDelay=15e3),this.logger.info("[xmppService] Auto-reconnection failure (next try in "+this.reconnectionDelay+"ms)"),this.reconnectTimeout=setTimeout((()=>{this.autoReconnect()}),this.reconnectionDelay)),this.reconnectInProgress=false}}}subscribeToContactEvents(e){return this.rxContactSubject.subscribe(e)}subscribeToConnectionEvents(e){return this.rxConnectionSubject.subscribe(e)}publishContactEvent(e,t){this.rxContactSubject.next(n.RBEvent.create(e,t))}publishConnectionEvent(e,t=null){this.reconnectionMode&&("ON_XMPP_CONNECTED"!==e||"RECONNECTION"!==t.reason&&"LOGIN"!==t.reason)||("ON_XMPP_CONNECTED"===e?this.mainService.appConnected.next(true):"ON_XMPP_DISCONNECTED"===e&&("3RD_PARTY_CHANGE_PWD"===t.reason||"CHANGE_PWD_ERROR"===t.reason||"RESOURCE_CONSTRAINTS"===t.reason?this.mainService.appConnected.next(true):this.mainService.appConnected.next(false)),this.rxConnectionSubject.next(n.RBEvent.create(e,t)))}onRosterChangedMessageReceived(e){try{return u.default(e).find("item").forEach((e=>{const t=this.getBareJidFromJid(e.attr("jid")),i=!!e.find("group").first()&&"favorites"===e.find("group").first().text(),r=e.attr("subscription"),n=e.attr("ask");this.publishContactEvent("ON_ROSTER_CHANGED_EVENT",{jid:t,subscription:r||"none",favorite:i,ask:n||"none"})})),true}catch(t){return true}}sendPresence(e,t,i=false,r){if(this.connection&&this.connection.send&&this.stropheStatus===Strophe.Status.CONNECTED)try{this.logger.info("Send presence "+e+" - "+t+" ("+this.jid+")");const n=$pres();n.c("priority").t("5"),n.up(),e&&"online"!==e&&n.c("show").t(e),!t||e&&"online"!==e?t&&n.up().c("status").t(t):n.c("status").t(t),true===i&&(r||(r={im:true,alert:false,companyid:""}),e&&"online"!==e&&n.up(),n.c("application",{xmlns:"jabber:iq:application"}),n.c("appid").t(config.rainbowApiClientKey).up(),n.c("xrbversion").t(version).up(),n.c("xrbclient").t(this.authService.getInformationHeadersApp()).up(),n.c("companyid").t(r.companyid).up(),n.c("userid").t(this.authService.userId).up().up(),n.c("parameters",{xmlns:"jabber:iq:configuration"}),n.c("user_options",{alert:r.alert,im:r.im})),this.connection.send(n)}catch(n){return void this.logger.error("this.connection.send error : "+n)}else this.logger.error('[xmppService] Try to send "presence IQ" but no xmpp connection')}resetPresence(e){this.logger.info(`Reset presence to ${this.presenceStatus} (${this.jid})`),this.sendPresence(e.show,e.status)}onPresenceMessageReceived(e){try{const t=u.default(e),i=t.attr("from"),r=this.getBareJidFromJid(i),n=t.find("x").attr("xmlns"),s=t.attr("type");if(n&&0===n.indexOf(Strophe.NS.MUC))return true;if(t.find("actor").length>0&&"jabber:iq:configuration"===t.find("actor").attr("xmlns")&&(t.find("avatar").length>0?this.publishContactEvent("ON_CONTACT_UPDATE_EVENT",{from:r,type:"avatar"}):t.find("data").length>0&&this.publishContactEvent("ON_CONTACT_UPDATE_EVENT",{from:r,type:"data"}),t.find("x").length&&"vcard-temp:x:update"===t.find("x").attr("xmlns")&&!t.find("delay").length))return true;if("error"===s)this.logger.error("Receive error presence message");else if("subscribe"===s)this.logger.info("Receive subscribe from ("+r+")");else{let e="offline",r="";if("unavailable"!==s){const i=t.find("show").text();r=t.find("status").text(),e=i&&"chat"!==i?"dnd"===i?"dnd":"xa"===i?"xa":"away":"online"}const n=Boolean(t.find("applyCalendarPresence").length),o=t.find("delay").attr("stamp"),a=o?new Date(o):new Date;let c=t.find("until").text();c=c?new Date(c):null;const l={jid:i,status:e,message:r,stamp:a,until:c,applyCalendarPresence:n};this.isConnectedJid(i)&&!this.isInitialPresenceSent&&(this.isInitialPresenceSent=true,this.publishConnectionEvent("ON_XMPP_CONNECTED",{reason:"PRESENCE"})),this.contactServiceReady?this.publishContactEvent("ON_CONTACT_PRESENCE_EVENT",l):(this.logger.info("[xmppService] Receive presence message but contact service is not ready yet"),this.presenceWaitingList.push(l))}return true}catch(t){return true}}getPresenceWaitingList(){return this.presenceWaitingList}resetPresenceWaitingList(){this.presenceWaitingList=[]}addHistoryHandler(e){this.historyHandler=e}addBulkHistoryHandler(e){this.bulkHistoryHandler=e}addSearchTextHandler(e){this.searchTextHandler=e}onMamBulkMessageReceived(e){try{this.bulkHistoryHandler(e)}catch(t){return true}return true}onMamMessageReceived(e){try{const t=u.default(e);let i=t.find("result").attr("queryid");return i||(i=t.attr("id")),i&&(-1!==i.indexOf("tel_")||-1!==i.indexOf("cache_"))&&this.historyHandler&&this.historyHandler(e),true}catch(t){return true}}onSearchTextMessageReceived(e){try{const t=u.default(e);let i=t.find("result").attr("queryid");return i||(i=t.attr("id")),this.searchTextHandler&&this.searchTextHandler(i,e),true}catch(t){return true}}getBareJidFromJid(e){return Strophe.getBareJidFromJid(e)}getResourceFromJid(e){return Strophe.getResourceFromJid(e)}isMobileResource(e){return-1!==e.indexOf("mobile_")}addHandler(e,t,i=null,r=null){return this.connection.addHandler(e,t,i,r)}deleteHandler(e){this.connection&&this.connection.deleteHandler(e)}isConnectedJid(e){return!(!e||0===e.length)&&e.startsWith(this.jid)}send(e){return new Promise((t=>{try{if(!this.connection&&this.stropheStatus!==Strophe.Status.CONNECTED)throw this.logger.error('[xmppService] Try to send "stanza" but no xmpp connection'),new Error("No XMPP connection");this.connection.send(e)}catch(i){this.logger.error("[xmppService] this.connection.send error : "+i)}t()}))}sendIQ(e,t=null){return new Promise(((i,r)=>{try{if(!this.connection&&this.stropheStatus!==Strophe.Status.CONNECTED)throw this.logger.error('[xmppService] Try to send "iq" but no xmpp connection'),new Error("No XMPP connection");this.connection.sendIQ(e,(e=>{i(e)}),(e=>{r(new Error(e?e.innerHTML:"XMPP request timeout"))}),t&&t>h.REQUEST_TIMEOUT?t:h.REQUEST_TIMEOUT)}catch(n){this.logger.error("[xmppService] this.connection.sendIQ error : "+n),r(new Error("this.connection.sendIQ error"))}}))}}h.REQUEST_TIMEOUT=1e4,t.XmppService=h},function(e,t,i){i.d(t,"a",(function(){return a}));var r=i(16),n=i(88),s=i(45),o=i(75),a=function(){function e(e){this.closed=false,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=true,this._unsubscribe=e)}var t;return e.prototype.unsubscribe=function(){var t;if(!this.closed){var i=this._parentOrParents,a=this._ctorUnsubscribe,l=this._unsubscribe,d=this._subscriptions;if(this.closed=true,this._parentOrParents=null,this._subscriptions=null,i instanceof e)i.remove(this);else if(null!==i)for(var u=0;u<i.length;++u){i[u].remove(this)}if(Object(s.a)(l)){a&&(this._unsubscribe=void 0);try{l.call(this)}catch(p){t=p instanceof o.a?c(p.errors):[p]}}if(Object(r.a)(d)){u=-1;for(var h=d.length;++u<h;){var f=d[u];if(Object(n.a)(f))try{f.unsubscribe()}catch(p){t=t||[],p instanceof o.a?t=t.concat(c(p.errors)):t.push(p)}}}if(t)throw new o.a(t)}},e.prototype.add=function(t){var i=t;if(!t)return e.EMPTY;switch(typeof t){case"function":i=new e(t);case"object":if(i===this||i.closed||"function"!=typeof i.unsubscribe)return i;if(this.closed)return i.unsubscribe(),i;if(!(i instanceof e)){var r=i;(i=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var n=i._parentOrParents;if(null===n)i._parentOrParents=this;else if(n instanceof e){if(n===this)return i;i._parentOrParents=[n,this]}else{if(-1!==n.indexOf(this))return i;n.push(this)}var s=this._subscriptions;return null===s?this._subscriptions=[i]:s.push(i),i},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var i=t.indexOf(e);-1!==i&&t.splice(i,1)}},e.EMPTY=((t=new e).closed=true,t),e}();function c(e){return e.reduce((function(e,t){return e.concat(t instanceof o.a?t.errors:t)}),[])}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{constructor(){this.$rootScope=null}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.eventService||(e.rainbow.eventService=new r),e.rainbow.eventService}configure(e=null){this.$rootScope=e}subscribe(e,t){return this.$rootScope?this.$rootScope.$on(e,t):()=>{}}unsubscribe(e){e()}publish(e,...t){this.$rootScope&&this.$rootScope.$broadcast(e,...t)}publishWithApply(e,...t){this.$rootScope&&this.$rootScope.$apply((()=>{this.$rootScope.$broadcast(e,...t)}))}setVariable(e,t){this.$rootScope[e]=t}getVariable(e){return this.$rootScope[e]}}t.EventService=r},function(e,t,i){i.d(t,"b",(function(){return d})),i.d(t,"a",(function(){return u}));var r=i(0),n=i(5),s=i(2),o=i(10),a=i(41),c=i(123),l=i(74),d=function(e){function t(t){var i=e.call(this,t)||this;return i.destination=t,i}return r.a(t,e),t}(s.a),u=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=false,t.isStopped=false,t.hasError=false,t.thrownError=null,t}return r.a(t,e),t.prototype[l.a]=function(){return new d(this)},t.prototype.lift=function(e){var t=new h(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new a.a;if(!this.isStopped)for(var t=this.observers,i=t.length,r=t.slice(),n=0;n<i;n++)r[n].next(e)},t.prototype.error=function(e){if(this.closed)throw new a.a;this.hasError=true,this.thrownError=e,this.isStopped=true;for(var t=this.observers,i=t.length,r=t.slice(),n=0;n<i;n++)r[n].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new a.a;this.isStopped=true;for(var e=this.observers,t=e.length,i=e.slice(),r=0;r<t;r++)i[r].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=true,this.closed=true,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new a.a;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new a.a;return this.hasError?(e.error(this.thrownError),o.a.EMPTY):this.isStopped?(e.complete(),o.a.EMPTY):(this.observers.push(e),new c.a(this,e))},t.prototype.asObservable=function(){var e=new n.a;return e.source=this,e},t.create=function(e,t){return new h(e,t)},t}(n.a),h=function(e){function t(t,i){var r=e.call(this)||this;return r.destination=t,r.source=i,r}return r.a(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):o.a.EMPTY},t}(u)},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(46);class n{constructor(){this.message="",this.error=null}}t.ErrorHelperInfo=n;class s{constructor(){this.i18n=r.I18nService.getInstance()}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.errorHelperService||(e.rainbow.errorHelperService=new s),e.rainbow.errorHelperService}async getErrorInfo(e,t=null,i=null){const r=new n;if(e instanceof Error&&(r.message=e.message,"Failed to fetch"===e.message&&(e.translatedMessage=this.i18n.translate("IceConfigurationFailed")),r.error=e),e instanceof Response){const n=await e.json(),s=n&&n.errorDetailsCode?n.errorDetailsCode:e.status,o=this.getStatusText(n,e),a=this.getErrorText(n),c=this.getFeature(n),l=e.url?e.url.match(/api\/rainbow\/(\w+)\//)[1]:void 0,d=e.headers&&e.headers.get("x-rainbow-request-id")?` (x-rainbow-request-id:${e.headers.get("x-rainbow-request-id")})`:"";t&&(r.message=t+" -- "),r.message+=`${o} -- ${a}`,c&&(r.message+="-- "+c),d&&(r.message+=d),r.error=new Error(r.message),r.error.status=e.status,r.error.statusText=o,r.error.fieldErrors=this.getBadRequestFieldErrors(n,e),r.error.errorDetails=a,r.error.errorDetailsCode=s,r.error.errorDetailsLabel=this.getErrorCodeLabel(s,l),r.error.translatedMessage=this.getTranslatedErrorMessage(r.error,i,l),r.error.portal=l,r.error.feature=c,n&&n.errorDetailsData&&(r.error.errorDetailsData=n.errorDetailsData),r.error.fullResponseData=n}return r}getTranslatedErrorMessage(e,t,i){let r="";return e.errorDetailsCode&&(r=this.getLocalizedError(e.errorDetailsCode,t,i)),r}getLocalizedError(e,t,i){let r="";const n=this.getErrorCodeLabel(e,i);if(n){const e=this.i18n.translate(n,t);e!==n&&(r=e)}return r}getErrorText(e){if(!e)return"Unknow error - Something goes really wrong";let t="";return e.errorDetails?e.errorDetails instanceof Array?e.errorDetails.forEach((e=>{t+=e.msg})):e.errorDetails.msg?t+=JSON.stringify(e.errorDetails.msg):e.errorDetails.details?t+=e.errorDetails.details:t+="string"==typeof e.errorDetails?e.errorDetails:JSON.stringify(e.errorDetails):e.errorMsg&&(t+=e.errorMsg),t}getFeature(e){return e&&e.errorDetails&&!(e.errorDetails instanceof Array)&&e.errorDetails.feature?e.errorDetails.feature:null}getStatusText(e,t){switch(e){case-1:return"Service unavailable";case 400:return"Bad request";case 401:return"Authorization failure";case 403:return"Access is forbidden";case 404:return"Resource not found";case 413:return"Request Entity Too Large";case 415:return"Unsupported Media Type";case 429:return"Too many requests";case 500:return"Internal server error";default:return t.statusText?t.statusText:"Unknown error"}}getBadRequestFieldErrors(e,t){const i={},r=e?e.errorDetails:null,n=e?e.errorDetailsCode:null,o=e?e.errorDetailsData:null;return 400===t.status?(r&&(r instanceof Array?r.forEach((e=>{i[e.param]||(i[e.param]={ok:false,message:e.msg,value:e.value})})):r.param&&(i[r.param]||(i[r.param]={ok:false,message:r.msg,value:r.value}))),400511===n&&(i.office365Tenant={ok:false,message:s.ERROR_CODE_LABELS[400511]}),400601===n&&(i.outgoingPrefix={ok:false,message:s.ERROR_CODE_LABELS[400601]},i.numberingPrefix={ok:false,message:s.ERROR_CODE_LABELS[400601]})):409===t.status&&409e3===n&&o&&(o.loginEmail&&(i.loginEmail={ok:false,label:"userAlreadyExist"}),o.authenticationExternalUid&&(i.authenticationExternalUid={ok:false,label:"userIdAlreadyUsed"})),i}getErrorCodeLabel(e,t){return t&&s.PORTAL_ERROR_CODE_LABELS[t]&&s.PORTAL_ERROR_CODE_LABELS[t][e]?s.PORTAL_ERROR_CODE_LABELS[t][e]:s.ERROR_CODE_LABELS[e]}}s.ERROR_CODE_LABELS={"-1":"unknownError",0:"errorNoServerResponse",400:"Bad request",4e5:"Bad request",400210:"invalidPhoneNumber",400400:"errorWrongPassword",400500:"invalidFile",400504:"companyNameAlreadyExist",400505:"BPCompanyWithoutPaymentConfigurationData",400506:"NoActiveSubscriptionToOffer",400509:"errorDecreaseSubscriptionForbidden",400511:"ActiveDirectoryDomainAlreadyUsed",400552:"BPCompanyAndECCompanyMustNotBeSame",400601:"outboundAndInternalPrefixesCantBeIdentical",400973:"noCreateUserPermission",400975:"userAlreadyExistsInOtherCompany",400983:"userAlreadyExistsInOtherCompany",400990:"noUserFound",400993:"noUserFound",401:"Authorization failure",401102:"Authorization failure",401202:"errorInvalidToken",401500:"errorUnauthorized",401501:"errorLoginForbidden",401510:"errorUnauthorized",401520:"errorUserNotActive",401521:"errorUserNotActive",403:"Forbidden",403e3:"accessDeniedNotRequiredRole",403001:"accessDeniedNotOwner",403034:"cantDeselectDefaultWebRTCGateway",403035:"cantDeleteDefaultWebRTCGateway",403060:"confLockMsg",403072:"errorIsoMd5Mismatch",403153:"notAllowedToAccessMeeting",403154:"notAllowedToAccessMeeting",403191:"dialInAlreadyEnabled",403192:"dialInAlreadyDisabled",403200:"notAllowedToChangeRole",403203:"notAllowedToChangeRole",403204:"notAllowedToMoveExistingUserToThisCompany",403205:"notAllowedToManageUser",403301:"notAllowedToManageCompany",403303:"notAllowedOperation",403304:"notAllowedToAddAnotherAdmin",403311:"errorRemoveSyncOngoingSubscriptionForbidden",403315:"errorRemoveSubscriptionForbidden",403316:"errorRemoveAdminAllocatedSubscriptionForbidden",403317:"errorRemoveClientAllocatedSubscriptionForbidden",403400:"notAllowedDeleteAppOwner",403500:"notAllowedBlacklistedEmail",403501:"notAllowedBlacklistedEmail",403502:"notAllowedToInviteExternalContacts",403503:"NotAllowedSelfRegistrationEmail",403504:"notAllowedLoggedInUserEmail",403507:"notAllowedSupportEmail",403513:"companyNotABpCompany",403516:"companyNotABpCompany",403517:"companySeenAsTerminated",403518:"companyBpTypeIncompatible",403519:"companyAlreadyLinkedToBp",403520:"companyNotVadBp",403525:"isolatedUser",403526:"isolatedUser",403531:"resetPasswordBlocked",403532:"resetPasswordForbidden",403608:"errorAssignSubscriptionSyncOngoing",403609:"errorAssignSubscriptionSyncOngoing",403610:"maxSubscriptionAllocationReached",403611:"notAllowedToCreateAnEquipment",403615:"maximumNumberConferenceParticipantsReach",403616:"subscriptionCompanyAdminEssentialAlreadyExists",403617:"roleCompanyAdminEssentialAlreadyExists",403620:"maximumNumberReached",403621:"MaximumNumberConvUsersReach",403624:"notAllowedRemoveService",403625:"errorAllocatedSubscriptionRemoveForbidden",403626:"restrictedConvAccess",403630:"uploadErrorMaxQuotaReached",403655:"userAlreadyCompanyMember",403660:"userNotInDefaultCompany",403670:"errorOperationForbiddenOnGuest",403683:"errorOtherOperationInProgress",403700:"errorDeleteSiteWithSystems",403701:"errorDeleteOrganisationLinkedCompany",403702:"errorDeleteCompanyWithSubscriptions",403703:"errorDeleteCompanyWithSites",403704:"errorDeleteCompanyWithUsers",403705:"errorDeleteCompanyStillTerminated",403706:"errorRemoveBusinessPartnerRole",403719:"externalTrunkChangeForbidden",403721:"numberingPlanCantBeUpdated",403722:"outgoingPrefixChangeForbidden",403723:"cannotRemoveCompanyPublicNumber",403724:"notAllowedDeleteCloudPbxWithPublicNumbers",403725:"notAllowedDeleteCloudPbxWithUsedExtensions",403762:"forbiddenOperationGroupLinkedToAutomatedAttendantMenu",403770:"forbiddenOperationUserBelongsToGroup",403780:"forbiddenOperationUserAlreadyManager",403784:"forbiddenOperationGroupStillAssocToWelcome",403785:"forbiddenOperationUserStillAssocToWelcome",403786:"forbiddenOperationUserBelongsToGroup",403792:"errorDialInLicenseAssignment",403910:"errorOtherOperationInProgress",403911:"errorOtherOperationInProgress",404:"resourceNotFound",404e3:"resourceNotFound",404001:"resourceNotFoundUpdateImpossible",404002:"resourceNotFoundDeleteImpossible",404116:"archivedOrDeletedConversation",404300:"noValidOfferReferenceInACTISFile",404301:"offerNotFound",409e3:"errorConflict",409005:"inviteUsersError",409011:"noMessagesToExport",409251:"DDIAlreadyAssociatedToCompany",409552:"internalNumberAlreadyUsed",409555:"publicNumberAlreadyExists",409557:"notAllowedDeleteUserAssociatedToCloudPbx",409600:"userAlreadyExist",409601:"invitationReSentConflict",409602:"userAlreadyNetworkMember",409603:"invitationReSentConflict",409605:"joinCompanyConflict",409620:"offerAlreadySubscribed",409623:"conferenceOfferAlreadySubscribed",409625:"errorUpdateSyncOngoingSubscriptionForbidden",409800:"companyNotIrBp",409801:"companyNotLinkedToBp",409802:"actisCompanyAdminMismatch",409803:"actisCompanyNameMismatch",413e3:"uploadErrorTooLarge",429:"tooManyRequests",487063:"ccdLogonCommandRejected",487064:"ccdLogonCommandRejectedWrongIdOrPassword",487065:"ccdLogonCommandRejectedWrongOrUnknownGroupId",500:"errorInternalServerError",5e5:"errorInternalServerError",500600:"genericPCGInternalServerError",500660:"ccdFeatureFailed",500661:"ccdFeatureFailedUnknownDevice",500662:"ccdFeatureFailedWrongUserType",500663:"ccdFeatureFailedProacdIdCannotBeEmpty",500664:"ccdFeatureFailedAgentDeviceTypeNotAuthorized",500665:"ccdFeatureFailedNoProacdDeviceAvailable",500666:"ccdFeatureFailedPBXRejectCCDCommand",1001:"extensionNotLinkedToEquipment",1002:"extensionHasNoIdentifier",1003:"extensionDoesNotExist",1004:"extensionLookupFailure",1005:"extensionConflict",1006:"nonUniqueEquipmentForExtension",1007:"userAlreadyAssociatedToExtension",1008:"extensionAssociatedToAnotherUser",1009:"failedToAttachExtension",1010:"userHasNoExtension",1011:"userHasTooManyExtensions",1012:"failedToDetachExtension",2001:"companyHasNoCloudPbx",2002:"extensionNumberNotCompatibleWithCloudPBXNumberingPlan",2003:"extensionNumberAlreadyAssignedToAnotherUser",2004:"userAlreadyAssignedToAnotherEquipment",2005:"failedToAssociateExtensionNumber",2006:"failedToUpdateExtensionNumber",2007:"noSipDeviceWithMacAddress",2008:"sipDeviceWithMacAddressBelongsToAnotherCompany",2009:"sipDeviceWithMacAddressAttachedToAnotherUser",2010:"anotherSipDeviceWithMacAddressAttachedToUser",2011:"cannotManageSipDeviceForUserWithoutExtensionNumber",2012:"failedToAttachSipDeviceToUser",2013:"cannotManagePublicNumberForUserWithoutExtensionNumber",2014:"publicNumberDoesNotExist",2015:"publicNumberAlreadyAssociatedToAnotherUser",2016:"anotherPublicNumberIsAttachedToUser",2017:"failedToAttachPublicNumberToUser",2018:"failedToDetachExtensionNumberNotProvided",2019:"userAttachedToAnotherExtensionNumber",2020:"cannotDetachPublicNumberFromUserWithoutExtensionNumber",2021:"failedToDetachPublicNumberFromUser",2022:"failedToDetachSipDeviceFromUser"},s.PORTAL_ERROR_CODE_LABELS={subscription:{403614:"forbiddenDurationChangeBecausePriceChanges"},massprovisioning:{4e5:"invalidValue",400501:"invalidFile",400502:"invalidColumnName",400504:"invalidFile",400505:"invalidValueInActionColumn",400506:"invalidValueInActionColumn",400508:"noDataToImport",400600:"deviceTypeCannotBeUpdated",400601:"duplicateDeviceIds",400602:"duplicateMacAdresses",400603:"invalidDeviceTypes",400604:"missingDeviceTypeInLines",400605:"invalidEquipment",400972:"noCreateUserPermission",400973:"noCreateUserPermission",400980:"noUpdateUserPermission",400981:"noUpdateUserPermission",400990:"noDeleteUserPermission",400991:"noDeleteUserPermission",400994:"noUserFound",403610:"errorMaxSubscriptionReached",403622:"userDoesNotHaveVoiceLicense",404600:"deviceDoesNotExist",404601:"noCloudPbxInCompany"},rvcpprovisioning:{403622:"noVoiceLicenceAllocatedToUser",403684:"overflowConfigurationChangesStillInProgress",403694:"forbiddenOperationEquipmentHasGroups",403695:"publicNumberAlreadyDefault",403699:"forbiddenOperationEquipmentHasWelcomeService",403728:"forbiddenOperationEquipmentHasDevices",403739:"forbiddenOperationWelcomeServiceUsed",403744:"forbiddenOperationUserAlreadyAssocToWelcome",403745:"forbiddenOperationGroupAlreadyAssocToWelcome",403752:"forbiddenOperationMoreThanThreeConsecutiveMenus",403754:"forbiddenOperationMenuLinkedToAnotherMenu",403761:"forbiddenOperationUserLinkedToAutomatedAttendantMenu",403765:"forbiddenOperationMenuAlreadyLinkedToAnotherMenu",403767:"forbiddenOperationSubMenuLinkedToItsParent",409253:"forbiddenOperationCantAssignDeviceToAttendantUser",409556:"companyHasAlreadyACloudPbx",409560:"macAddressAlreadyUsed",409561:"deviceStillUsedByUser",409562:"deviceAlreadyUsed",409563:"deviceAlreadyUsedByAnotherSystem",409565:"forbiddenOperationCallForkingToPublicNumberUsedByCloudPbx",413e3:"fileTooLarge",415e3:"audioFileTypeNotSupported"},authentication:{401102:"Authorization failure",401103:"Authorization failure",401500:"Authorization failure",401520:"Forbidden",401521:"Forbidden",401522:"Forbidden",401523:"Forbidden",401530:"Authorization failure",401600:"Authorization failure",401700:"Authorization failure",403e3:"Authorization failure",5e5:"errorInternalServerError",503e3:"resourceNotFound"},webinar:{403135:"WebinarInvalidRegistrationId",409019:"webinarEmptyConversation"},vnauseradmin:{400006:"addressNotRecognizedByEmergencyService",400007:"E911ServiceUnavailable",400014:"yourAccountPublicNumberInvalid",400034:"yourAccountPublicNumberDoesNotExist",400059:"invalidAddress",400063:"invalidStateCode",400065:"invalidTelephoneNumberFormat",400201:"invalidBlankName",400202:"invalidBlankStreetName",400203:"invalidBlankStreetNumber",400204:"invalidBlankCity",400205:"invalidBlankState",400206:"invalidBlankZipCode",400207:"youMustHavePublicNumber",400208:"onlyNumericValuesAllowed",400209:"youMustHavePublicNumber",403153:"notAllowedToModifyAddress",405103:"invalidZipCode",409e3:"errorLocationAddressConflict"}},t.ErrorHelperService=s},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(8),n=i(9),s=i(4),o=i(7),a=i(18),c=i(163),l=i(6),d=i(19);class u{constructor(){this.FeaturesEnum={COMPANY_ADMIN_COUNT:"COMPANY_ADMIN_COUNT",COMPANY_LOGO_MODIFICATION:"COMPANY_LOGO_MODIFICATION",COMPANY_DOMAIN_NAME_MODIFICATION:"COMPANY_DOMAIN_NAME_MODIFICATION",COMPANY_DETAILS_MODIFICATION:"COMPANY_DETAILS_MODIFICATION",COMPANY_SINGLE_SIGN_ON_SAML:"COMPANY_SINGLE_SIGN_ON_SAML",COMPANY_SINGLE_SIGN_ON_OIDC:"COMPANY_SINGLE_SIGN_ON_OIDC",WEBRTC_FOR_MOBILE:"WEBRTC_FOR_MOBILE",BUBBLE_PARTICIPANT_COUNT:"BUBBLE_PARTICIPANT_COUNT",TELEPHONY_BASIC_CALL:"TELEPHONY_BASIC_CALL",TELEPHONY_SECOND_CALL:"TELEPHONY_SECOND_CALL",TELEPHONY_TRANSFER_CALL:"TELEPHONY_TRANSFER_CALL",TELEPHONY_CONFERENCE_CALL:"TELEPHONY_CONFERENCE_CALL",TELEPHONY_DEFLECT_CALL:"TELEPHONY_DEFLECT_CALL",TELEPHONY_PHONE_BOOK:"TELEPHONY_PHONE_BOOK",TELEPHONY_VOICE_MAIL:"TELEPHONY_VOICE_MAIL",TELEPHONY_CALL_FORWARD:"TELEPHONY_CALL_FORWARD",TELEPHONY_NOMADIC:"TELEPHONY_NOMADIC",CONFERENCE_PARTICIPANT_COUNT:"CONFERENCE_PARTICIPANT_COUNT",WEBRTC_CONFERENCE_ALLOWED:"WEBRTC_CONFERENCE_ALLOWED",WEBRTC_CONFERENCE_PARTICIPANT_COUNT:"WEBRTC_CONFERENCE_PARTICIPANT_COUNT",WEBRTC_PARTICIPANT_ALLOWED:"WEBRTC_PARTICIPANT_ALLOWED",CONFERENCE_ALLOWED:"CONFERENCE_ALLOWED",CONFERENCE_DIAL_OUT:"CONFERENCE_DIAL_OUT",CONFERENCE_RECORDING:"CONFERENCE_RECORDING",MSO365_CALENDAR_PRESENCE:"MSO365_CALENDAR_PRESENCE",MSO365_DIRECTORY_PROVISIONING:"MSO365_DIRECTORY_PROVISIONING",MSO365_DIRECTORY_SEARCH:"MSO365_DIRECTORY_SEARCH",MSO365_CONTACT_SEARCH:"MSO365_CONTACT_SEARCH",MS_OUTLOOK_PLUGIN:"MS_OUTLOOK_PLUGIN",MS_SKYPE_PLUGIN:"MS_SKYPE_PLUGIN",FILE_SHARING_QUOTA_GB:"FILE_SHARING_QUOTA_GB",GOOGLE_CALENDAR_PRESENCE:"GOOGLE_CALENDAR_PRESENCE",WEBRTC_P2P_RECORDING:"WEBRTC_P2P_RECORDING",BUBBLE_PROMOTE_MEMBER:"BUBBLE_PROMOTE_MEMBER",BUBBLE_GUESTS_ALLOWED:"BUBBLE_GUESTS_ALLOWED",BUBBLE_ACTIVE_SPEAKER:"BUBBLE_ACTIVE_SPEAKER",TELEPHONY_WEBRTC_GATEWAY:"TELEPHONY_WEBRTC_GATEWAY",TELEPHONY_WEBRTC_PSTN_CALLING:"TELEPHONY_WEBRTC_PSTN_CALLING",ANALYTICS_DASHBOARD_EC:"ANALYTICS_DASHBOARD_EC",ANALYTICS_DASHBOARD_BP:"ANALYTICS_DASHBOARD_BP",TELEPHONY_CALL_SUBJECT:"CALL_SUBJECT",CHANNEL_CREATE:"CHANNEL_CREATE",CHANNEL_CREATE_ADMIN_ROLE_BYPASS:"CHANNEL_CREATE_ADMIN_ROLE_BYPASS",CHANNEL_ACTIVATED:"CHANNEL_ACTIVATED",MANAGE_ANDROID_TV:"MANAGE_ANDROID_TV",USE_ANDROID_TV:"USE_ANDROID_TV",LDAP_DIRECTORY_SYNC:"LDAP_DIRECTORY_SYNC",LDAP_CONTACT_SYNC:"LDAP_CONTACT_SYNC",MASSPRO_USER_PROVISIONING_CSV:"MASSPRO_USER_PROVISIONING_CSV",SEARCH_BY_TAGS:"SEARCH_BY_TAGS",TELEPHONY_3DPARTY_ASSOC:"TELEPHONY_3DPARTY_ASSOC",WEBCLIENT_UI_2_0:"WEBCLIENT_UI_2_0",WEBRTC_UNIFIED_PLAN:"WEBRTC_UNIFIED_PLAN",WEBRTC_CONFERENCE_SIMULCAST:"WEBRTC_CONFERENCE_SIMULCAST",USE_CLOUD_PBX:"USE_CLOUD_PBX",USE_OXO_MANAGED_PBX:"USE_OXO_MANAGED_PBX",SOFTPHONE_MODE_ONLY:"SOFTPHONE_MODE_ONLY",GIVE_REQUEST_REMOTE_CONTROL:"GIVE_REQUEST_REMOTE_CONTROL",BUBBLE_MAX_LOAD_STARTUP:"BUBBLE_MAX_LOAD_STARTUP",BUBBLE_COUNT:"BUBBLE_COUNT",BUBBLE_MEETING_SCHEDULER:"BUBBLE_MEETING_SCHEDULER",BUBBLE_TALKING_TIME:"BUBBLE_TALKING_TIME",APP_PERMISSIONS:"APP_PERMISSIONS",FREE_UI_CUSTOMIZATION:"FREE_UI_CUSTOMIZATION",PREMIUM_UI_CUSTOMIZATION:"PREMIUM_UI_CUSTOMIZATION",TELEPHONY_MAKE_CALL_CTI_APP:"TELEPHONY_MAKE_CALL_CTI_APP",CLOUD_PBX_WELCOME:"CLOUD_PBX_WELCOME",BUBBLE_TAG_COUNT:"BUBBLE_TAG_COUNT",TELEPHONY_CCD_AGENT:"TELEPHONY_CCD_AGENT",ALERT_NOTIFICATIONS_ALLOWED:"ALERT_NOTIFICATIONS_ALLOWED",BUBBLE_FOLDER_COUNT:"BUBBLE_FOLDER_COUNT",BUBBLE_POP_OUT_VIDEO_SHARING:"BUBBLE_POP_OUT_VIDEO_SHARING",ACCESSIBILITY_KEYBOARD_SHORTCUTS:"ACCESSIBILITY_KEYBOARD_SHORTCUTS",WEBRTC_ADD_PARTICIPANT:"WEBRTC_ADD_PARTICIPANT",WEBINAR_ACCESS:"WEBINAR_ACCESS",WEBINAR_MAX_ORGANIZERS:"WEBINAR_MAX_ORGANIZERS",WEBINAR_MAX_PARTICIPANTS:"WEBINAR_MAX_PARTICIPANTS",BLURRING_UI_2_0:"BLURRING_UI_2_0",CONFERENCE_UI_3_0:"CONFERENCE_UI_3_0",TELEPHONY_MAX_KEYS:"TELEPHONY_MAX_KEYS",TELEPHONY_MAX_SPEED_DIALING_KEYS:"TELEPHONY_MAX_SPEED_DIALING_KEYS",TELEPHONY_MAX_FEATURE_CODE_KEYS:"TELEPHONY_MAX_FEATURE_CODE_KEYS",TELEPHONY_MAX_SUPERVISION_KEYS:"TELEPHONY_MAX_SUPERVISION_KEYS",CONNECTIVITY_ALL_USER:"CONNECTIVITY_ALL_USER",WEBRTC_BLIND_TRANSFER_CALL:"WEBRTC_BLIND_TRANSFER_CALL",TELEPHONY_ADD_PARTICIPANT:"TELEPHONY_ADD_PARTICIPANT",TELEPHONY_BASIC_ATTENDANT_CONSOLE:"TELEPHONY_BASIC_ATTENDANT_CONSOLE",MIX_WEBRTC_PSTN_CALLS:"MIX_WEBRTC_PSTN_CALLS",CLOUD_PBX_PERSONAL_ROUTINES:"CLOUD_PBX_PERSONAL_ROUTINES",TELEPHONY_MULTI_WEBRTC_GATEWAY:"TELEPHONY_MULTI_WEBRTC_GATEWAY",WEBRTC_GRID49:"WEBRTC_GRID49",WEBRTC_CONFERENCE_V2_MODEL:"WEBRTC_CONFERENCE_V2_MODEL",TELEPHONY_OXO_MULTICALL:"TELEPHONY_OXO_MULTICALL",WEBRTC_MODULATE_VIDEO_QUALITY:"WEBRTC_MODULATE_VIDEO_QUALITY",ADMIN_ALARMS:"ADMIN_ALARMS",FLEXIBLE_PANEL:"FLEXIBLE_PANEL",BUBBLE_PSTN_DIALIN:"BUBBLE_PSTN_DIALIN",CONFERENCE_RECORDING_MAX_TIMER:"CONFERENCE_RECORDING_MAX_TIMER",PERSONAL_DIRECTORY:"PERSONAL_DIRECTORY",MSO365_TEAMS_PRESENCE:"MSO365_TEAMS_PRESENCE",ELEARNING_TRAINING:"ELEARNING_TRAINING",REPORT_A_PROBLEM:"REPORT_A_PROBLEM",WEBRTC_MANAGE_TWO_CALLS:"WEBRTC_MANAGE_TWO_CALLS",SUPERVISION_GROUP_SUPERVISOR_ALLOWED:"SUPERVISION_GROUP_SUPERVISOR_ALLOWED",TELEPHONY_CALL_POPOUT:"TELEPHONY_CALL_POPOUT",TELEPHONY_OXE_EMERGENCY:"TELEPHONY_OXE_EMERGENCY",MESSAGE_BOOKMARK:"MESSAGE_BOOKMARK",CLOUD_PBX_CALL_QUEUE_MAX_USERS:"CLOUD_PBX_CALL_QUEUE_MAX_USERS",CLOUD_PBX_MANAGER_ASSISTANT:"CLOUD_PBX_MANAGER_ASSISTANT"},this.rxSubject=new o.Subject,this.started=false,this.features={},this.profiles=[],this.mainOffers=[],this.thirdPartyApps=null,this.profileEventHandler=null,this.timer=null,this.contactService=l.ContactService.getInstance(),this.logger=s.LoggerService.getInstance(),this.authService=r.AuthService.getInstance(),this.xmppService=n.XmppService.getInstance(),this.settingsService=d.SettingsService.getInstance()}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.profileService||(e.rainbow.profileService=new u),e.rainbow.profileService}async start(){try{this.logger.info(""),this.logger.info("[profileService] === STARTING ==="),this.attachHandlers(),await this.getServerProfile(),this.started=true,this.logger.info("[profileService] === STARTED ==="),this.rxSubject.next(a.RBEvent.create("ON_PROFILE_FEATURES_UPDATED"))}catch(e){throw this.logger.info("[profileService] === STARTING FAILURE === "+e.message),e}}async stop(){this.logger.info("[profileService] === STOPPING ==="),this.detachHandlers(),this.started=false,this.logger.info("[profileService] === STOPPED ===")}reconnect(){this.restart()}restart(){this.logger.info("[profileService] === RESTART ==="),this.attachHandlers(),this.onUserUpdateNeeded()}subscribe(e){return this.rxSubject.subscribe(e)}attachHandlers(){this.detachHandlers(),this.logger.info("[profileService] attachHandlers"),this.profileEventHandler=this.xmppService.addHandler((e=>this.onManagementMessageReceived(e)),null,"message","management")}detachHandlers(){this.logger.info("[profileService] detachHandlers"),this.profileEventHandler&&(this.xmppService.deleteHandler(this.profileEventHandler),this.profileEventHandler=null)}onManagementMessageReceived(e){try{const t=$(e).find("userprofile");if(t.length)switch(this.logger.info("[profileService] onManagementMessageReceived  -- on userprofile management message received"),t.attr("action")){case"create":case"update":case"delete":this.onUserUpdateNeeded();break;default:this.logger.info("[profileService] onManagementMessageReceived  -- unknown action")}return true}catch(t){return this.logger.error("[profileService] onManagementMessageReceived ERROR "+t),true}}onUserUpdateNeeded(){this.timer||(this.timer=setTimeout((async()=>{try{await this.contactService.updateContactFromServer(this.contactService.userContact,true),await this.getServerProfile(),this.rxSubject.next(a.RBEvent.create("ON_PROFILE_FEATURES_UPDATED")),this.timer=null}catch(e){this.timer=null,this.logger.info("[profileService] === onUserUpdateNeeded FAILURE === "+e.message)}}),3e3))}getServerProfile(){return Promise.all([this.getServerProfiles(),this.getServerProfilesFeatures()])}async getServerProfiles(){try{const e=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.contactService.userContact.dbId}/profiles`,t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=await i.json();this.profiles=[],this.mainOffers=[],r.data.forEach((e=>{this.logger.debug("[profileService] getServerProfiles === response === "+e),this.profiles.push(e);const t=c.Offer.createFromProfileData(e);(t.isExclusive||t.isDefault)&&this.mainOffers.push(t)})),this.mainOffers.sort(c.Offer.offerComparator)}catch(e){let t="getServerProfiles failure: no server response";throw e&&(t="getServerProfiles failure: "+JSON.stringify(e)),this.logger.error("[profileService] "+t),new Error(t)}}async getServerProfilesFeatures(){try{const e=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.contactService.userContact.dbId}/profiles/features`,t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=await i.json();this.features={},r.data.forEach((e=>{this.logger.debug("[profileService] getServerProfilesFeatures === response === "+JSON.stringify(e)),e.hasOwnProperty("featureUniqueRef")&&(this.features[e.featureUniqueRef]=e)}))}catch(e){let t="getServerProfilesFeatures failure: no server response";throw e&&(t="getServerProfilesFeatures failure: "+JSON.stringify(e)),this.logger.error("[profileService] "+t),new Error(t)}}isFeatureEnabled(e,t=null){if(t||(t=this.features),"TELEPHONY_OXE_EMERGENCY"===e){if("RQRAINB-7280"===this.settingsService.getSetting("sipWiseMode"))return true}return!(!config.urgencyNotifReceptionForced||"ALERT_NOTIFICATIONS_ALLOWED"!==e)||(this.started&&t.hasOwnProperty(e)&&t[e].hasOwnProperty("featureType")&&"boolean"===t[e].featureType&&t[e].hasOwnProperty("isEnabled")?t[e].isEnabled:(this.logger.info("[profileService] isFeatureEnabled("+e+"): service not started or feature not enabled"),false))}getFeatureLimitMax(e,t=null){if(t||(t=this.features),this.started&&t.hasOwnProperty(e)&&t[e].hasOwnProperty("featureType")&&"number"===t[e].featureType&&t[e].hasOwnProperty("limitMax")){const i=t[e].limitMax;return this.logger.debug("[profileService] getFeatureLimitMax("+e+"): "+i),i}return this.logger.info("[profileService] getFeatureLimitMax("+e+"): service not started or feature not enabled"),0}getFeatureLimitMin(e,t=null){if(t||(t=this.features),this.started&&t.hasOwnProperty(e)&&t[e].hasOwnProperty("featureType")&&"number"===t[e].featureType&&t[e].hasOwnProperty("limitMin")){const i=t[e].limitMin;return this.logger.debug("[profileService] getFeatureLimitMin("+e+"): "+i),i}return this.logger.info("[profileService] getFeatureLimitMin("+e+"): service not started or feature not enabled"),0}getMyProfileOffer(){return this.mainOffers.length>0?this.mainOffers.slice(-1)[0]:null}getMyProfileName(){const e=this.getMyProfileOffer();return e?e.name:null}getMyProfiles(){let e=[];return this.started?e=this.profiles:this.logger.warn("[profileService] getMyProfiles(): service not started"),e}getMyProfileFeatures(){const e={};return this.started?Object.keys(this.features).forEach((t=>{const i=this.features[t],r={};Object.keys(i).filter((e=>"featureUniqueRef"===e||"featureType"===e||"limitMin"===e||"limitMax"===e||"isEnabled"===e)).forEach((e=>{r[e]=i[e]})),e[t]=r})):this.logger.warn("[profileService] getMyProfileFeatures(): service not started"),e}async getThirdPartyApps(e=false){try{if(null!==this.thirdPartyApps&&!e)return this.logger.info("[profileService] getThirdPartyApps -- from cache"),this.thirdPartyApps;const t=config.restServerUrl+"/api/rainbow/authentication/v1.0/oauth/tokens?format=medium",i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;const n=await r.json();return this.logger.info("[profileService] getThirdPartyApps from server -- success"),this.thirdPartyApps=n&&n.data?n.data:[],this.thirdPartyApps}catch(t){let e="getThirdPartyApps from server failed -- no answer from server";throw t&&(e="getThirdPartyApps from server failed -- "+JSON.stringify(t)),this.logger.error("[profileService] "+e),new Error(e)}}async revokeThirdPartyAccess(e){try{if(!e)throw this.logger.warn("[profileService] revokeThirdPartyAccess missing token"),new Error("No tokenId");this.logger.info("[profileService] revokeThirdPartyAccess with token -- "+e);const t=`${config.restServerUrl}/api/rainbow/authentication/v1.0/oauth/tokens/${e}`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"DELETE",headers:i});if(!r.ok)throw r;const n=await r.json();return this.logger.info("[profileService] revokeThirdPartyAccess -- success"),this.thirdPartyApps||(this.thirdPartyApps=n&&n.data?n.data:[]),this.thirdPartyApps.forEach(((t,i)=>{t.id===e&&this.thirdPartyApps.splice(i,1)})),this.thirdPartyApps}catch(t){let e="revokeThirdPartyAccess from server failed -- no answer from server";throw t&&(e="revokeThirdPartyAccess from server failed -- "+JSON.stringify(t)),this.logger.error("[profileService] "+e),new Error(e)}}getProfilesByName(e){return this.profiles.filter((t=>-1!==t.profileName.toLowerCase().indexOf(e)))}async setUserData(e){try{const t=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.contactService.userContact.dbId}`,i=this.authService.getPostHeader(),r=JSON.stringify(e),n=await fetch(t,{method:"PUT",headers:i,body:r});if(!n.ok)throw n;const s=await n.json();return this.logger.info(`[profileService] setUserData ${r} -- success`),s}catch(t){let e="setUserData failure: no server response";throw t&&(e="setUserData failure: "+JSON.stringify(t)),this.logger.error("[profileService] "+e),new Error(e)}}}t.ProfileService=u},function(e,t,i){i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return s}));var r=i(53),n=new(i(51).a)(r.a),s=n},function(e,t,i){i.d(t,"a",(function(){return r}));var r=function(){return Array.isArray||function(e){return e&&"number"==typeof e.length}}()},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(374),n=i(42),s=i(42),o=i(7),a=i(4);class c{constructor(){this.appVisible=new o.BehaviorSubject(true),this.appActive=new o.BehaviorSubject(true),this.appActiveAutoAway=true,this.appActiveDelay=180,this.appActiveTimeout=null,this.appActiveListener=null,this.appConnected=new o.BehaviorSubject(false),this.appConnectivity=new o.BehaviorSubject(false),this.appConnectivityValue=false,this.appConnectivityTimeout=null,this.globalPopupMessageSubject=null,this.logger=a.LoggerService.getInstance();const e=window;e.moduleIds||(e.moduleIds=[]),e.config||(e.config={xmpp:{protocol:"wss",currentServer:null,port:"443",pingInterval:"60000"},webservices:{protocol:"https",currentServer:null,port:"443"}}),window.addEventListener("blur",(()=>{this.logger.debug("[MainService] Application visibility change : false"),this.appVisible.next(false)})),window.addEventListener("focus",(()=>{this.logger.debug("[MainService] Application visibility change : true"),this.appVisible.next(true)})),this.appActiveListener=()=>{this.appActive.value||this.appActive.next(true),this.appActiveTimeout&&(clearTimeout(this.appActiveTimeout),this.appActiveTimeout=null),window.document.removeEventListener("mousemove",this.appActiveListener),window.document.removeEventListener("keypress",this.appActiveListener),setTimeout((()=>{this.startTimer()}),2e3)},this.appConnectivityValue=navigator.onLine,window.addEventListener("offline",(()=>{this.logger.debug("[MainService] Connectivity change : down"),this.appConnectivityTimeout&&(clearInterval(this.appConnectivityTimeout),this.appConnectivityTimeout=null),this.appConnectivityValue&&(this.appConnectivityValue=false,this.appConnectivityTimeout=setTimeout((()=>{this.appConnectivity.next(false)}),2500))})),window.addEventListener("online",(()=>{this.logger.debug("[MainService] Connectivity change : up"),this.appConnectivityTimeout&&(clearInterval(this.appConnectivityTimeout),this.appConnectivityTimeout=null),this.appConnectivityValue||(this.appConnectivityValue=true,this.appConnectivityTimeout=setTimeout((()=>{this.appConnectivity.next(true)}),1e3))})),e.BroadcastChannel&&(this.broadcastChannelSubject=new o.Subject,this.broadcastChannel=new BroadcastChannel("rainbowBroadcastChannel"),this.broadcastChannel.onmessage=e=>{this.broadcastChannelSubject.next(e)},this.globalPopupMessageSubject=new o.Subject);const{fetch:t}=window;window.fetch=async(...e)=>{const[i,r]=e;let n=false;if(config&&config.webservices){n=-1!==i.toString().split("?")[0].indexOf(config.webservices.currentServer)}r&&r.headers&&n&&(r.headers["x-rainbow-correlation-id"]=(this.isDesktopApp()?"desk_":"web_")+crypto.randomUUID());try{const e=await t(i,r);if(r){r.method||(r.method="GET");const t=i.toString().split("?");t[1]&&(t[0]+="?URI_HIDDEN_PARAMS");const n=e.headers&&e.headers.get("x-rainbow-request-id")?` (x-rainbow-request-id:${e.headers.get("x-rainbow-request-id")})`:"",s=e.headers&&e.headers.get("x-rainbow-correlation-id")?` (x-rainbow-correlation-id:${e.headers.get("x-rainbow-correlation-id")})`:"";this.logger.debug(`[HTTP] [${r.method}] [${e.status}] ${t[0]} ${n} ${s}`)}return e}catch(s){if(r){r.method||(r.method="GET");const e=i.toString().split("?");e[1]&&(e[0]+="?URI_HIDDEN_PARAMS");const t=r.headers&&r.headers["x-rainbow-correlation-id"]?` (x-rainbow-correlation-id:${r.headers["x-rainbow-correlation-id"]})`:"";this.logger.warn(`[HTTP] [${r.method}] ${e[0]} ${t} -- ${s}`)}else this.logger.debug("[HTTP] "+s);throw s}}}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.mainService||(e.rainbow.mainService=new c),e.rainbow.mainService}static MD5(e){return r.MD5(n.Latin1.parse(e)).toString(s.Hex)}configure(e=null,t=null){if(t)return this.appActiveAutoAway=t.autoAway,this.appActiveDelay=t.autoAwayDelay,void this.startTimer();this.logger.info("[MainService] STARTED"),e&&e.isDesktopApp()?(e.idle.setDetectionInterval(this.appActiveDelay),e.idle.onStateChanged.addListener((e=>{this.appActive.next("active"===e)}))):this.startTimer()}startTimer(){this.appActiveTimeout&&(clearTimeout(this.appActiveTimeout),this.appActiveTimeout=null),this.appActiveTimeout=setTimeout((()=>{this.appActive.next(false)}),1e3*this.appActiveDelay),window.document.addEventListener("mousemove",this.appActiveListener),window.document.addEventListener("keypress",this.appActiveListener)}isDesktopApp(){const e=navigator.userAgent.toLowerCase();return e.indexOf("qtwebengine")>-1||e.indexOf("electron/")>-1}broadcastChannelSubscribe(e){return this.broadcastChannelSubject.subscribe(e)}postBroadcastChannelMessage(e){this.broadcastChannel.postMessage(e)}showGlobalPopupMessage(e){this.globalPopupMessageSubject.next({show:true,data:e})}hideGlobalPopupMessage(){this.globalPopupMessageSubject.next({show:false})}inject(e){return window.rainbow[e]}}t.MainService=c},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{constructor(e,t){this.name=null,this.data=null,this.name=e,this.data=t}static create(e,t=null){return new r(e,t)}}t.RBEvent=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7),n=i(18);class s{constructor(){this.automaticHookOff=false,this.automaticHookOffTime=0,this.timers=[],this.languageCodes=[],this.defaultLanguage={label:"English",settingCode:"en",code:"en",isoCode:"en",codeMoment:"en",unicode:"1f1ec-1f1e7"},this.languages=[this.defaultLanguage,{label:"Franais",settingCode:"fr",code:"fr",isoCode:"fr",codeMoment:"fr",unicode:"1f1eb-1f1f7"},{label:"Catal",settingCode:"ca",code:"ca",isoCode:"ca",codeMoment:"ca",unicode:"1f1ea-1f1f8"},{label:"Czech",settingCode:"cs",code:"cs",isoCode:"cs",codeMoment:"cs",unicode:"1F1E8-1F1FF"},{label:"Deutsch",settingCode:"de",code:"de",isoCode:"de",codeMoment:"de",unicode:"1f1e9-1f1ea"},{label:"Espaol",settingCode:"es-es",code:"es-es",isoCode:"es-ES",codeMoment:"es",unicode:"1f1ea-1f1f8"},{label:"Suomi",settingCode:"fi",code:"fi",isoCode:"fi",codeMoment:"fi",unicode:"1f1eb-1f1ee"},{label:"Italiano",settingCode:"it",code:"it",isoCode:"it",codeMoment:"it",unicode:"1f1ee-1f1f9"},{label:"",settingCode:"he",code:"he",isoCode:"he",codeMoment:"he",unicode:"1f1ee-1f1f1"},{label:"",settingCode:"ja",code:"ja",isoCode:"ja",codeMoment:"ja",unicode:"1f1ef-1f1f5"},{label:"",settingCode:"ko",code:"ko",isoCode:"ko",codeMoment:"ko",unicode:"1f1f0-1f1f7"},{label:"Nederlands",settingCode:"nl",code:"nl",isoCode:"nl",codeMoment:"nl",unicode:"1F1F3-1F1F1"},{label:"Nynorsk",settingCode:"no",code:"no",isoCode:"no",codeMoment:"nn",unicode:"1F1F3-1F1F4"},{label:"Portugus do Brasil",settingCode:"pt-br",code:"pt-BR",isoCode:"pt-BR",codeMoment:"pt-br",unicode:"1F1E7-1F1F7"},{label:"Portugus",settingCode:"pt-pt",code:"pt-PT",isoCode:"pt-PT",codeMoment:"pt",unicode:"1F1F5-1F1F9"},{label:"Polski",settingCode:"pl",code:"pl",isoCode:"pl",codeMoment:"pl",unicode:"1F1F5-1F1F1"},{label:"P",settingCode:"ru",code:"ru",isoCode:"ru",codeMoment:"ru",unicode:"1F1F7 1F1FA"},{label:"Svenskt",settingCode:"sv-se",code:"sv-SE",isoCode:"sv-SE",codeMoment:"sv",unicode:"1F1F8-1F1EA"},{label:"Trke",settingCode:"tr",code:"tr",isoCode:"tr",codeMoment:"tr",unicode:"1f1f9-1f1f7"},{label:"",settingCode:"zh-cn",code:"zh-cn",isoCode:"zh-CN",codeMoment:"zh-cn",unicode:"1f1e8-1f1f3"},{label:"",settingCode:"zh-tw",code:"zh-TW",isoCode:"zh-TW",codeMoment:"zh-tw",unicode:"1F1F9-1F1FC"},{label:"",settingCode:"ar",code:"ar",isoCode:"ar",codeMoment:"ar",unicode:"0600-06FF"}],this.settings={init:true,lang:"en",imSound:"true",imNotif:"true",displayOrder:"FL",nbMaxConversations:"100",microphone:"default",headsetMicrophone:null,speakerphoneMicrophone:null,customMicrophone:null,headsetDeviceName:null,speakerphoneDeviceName:null,speaker:"default",headsetSpeaker:null,speakerphoneSpeaker:null,customSpeaker:null,ringingSpeaker:"default",ringingSpeakerName:"",camera:"default",cameraUsed:"",audioProfile:"handfree",currentDevice:null,iceConfig:null,sdk:false,userWiewOrderType:"lastname",userWiewFilterType:"all",autoStartAnimatedGif:"false",fixedLayout:"false",theme:"default",translationMsg:"false",newUI:"false",autoAcceptRoomInvite:"false",server:null,activeAlarm:"relax1",activeNotif:"stairs",ringingOnDnd:false,devMode:"false",hasSecondRinger:"false",validationMode:"false",disableCalendarPresence:"false",deviceList:"[]",displayFilesType:"filesListCell--as-grid",displayRoomsAsGrid:"true",conversationsDensity:"default",collapsedButton:"false",displayCollapsedConversations:"false",handFreeInputDeviceName:null,handFreeOutputDeviceName:null,customSpeakerName:null,customMicrophoneName:null,showBodyMessage:"false",bubblesFilterType:"all",bubblesOrderType:"lastActivityDate",webinarsFilterType:"all",webinarsOrderType:"lastActivityDate",displayWebinarsAsGrid:"false",protectionAgainstMailTypeOffline:false,channelMarkdown:"false",enableKeyboardLog:"false",searchFilterValue:"NoFiltering",enableSingleSignOnWebAuthPopup:"false",enableSingleSignOnConfig:"false",extension:"false",enableDSCP:false,filterIce:false,dtx:false,debugWebRTC:false,sipWiseMode:"false",fontSize:"62.5%",lastInactiveBubbleShownDate:null,meetingsOrderType:"lastActivityDate",meetingsFilterType:"all",filesOrderBy:"date",filesFilterBy:"all",enterKeyAction:"enterSend",activeTalker:false,forceConsoleLog:false,sfuJoinBundle:false,geoip:"",applyCalendarPresence:false,informationImSound:"ding",importantImSound:"important",emergencyImSound:"emergency",showNewAnalytics:false,analyticsValidationMode:false,sfuCustomMuteMode:false,ccdPhoneTypeSelected:"computer",ccdProACDNumber:"",ccdOtherPhoneNumber:"",ccdGroupNumber:"",webrtcStats:"false",enableDebugMode:"false",enableAioUrlMode:"false",enableDebugConnectionMode:"false",analyticsGUIConfig:null,sfuDisableVideos:false,sfuRecording:"false",virtualBackgroundFlag:"false",virtualBackgroundType:"none",virtualBackgroundMirror:"true",testConfigEnabled:false,imgVirtualBackground:"",autoAnswer:false,autoAnswerByDeviceType:"",enablePBXDisplayForAllCases:"false",grid49:"false",callLogsViewMode:"condensed",subLevelV3:"false",enableIceRestartOnHold:"false",enableIceRestartOnUnhold:"false",disableWaitingCallTone:"false",subtitles:"false",webConfServiceV2:"false",isAutomaticHookOff:"false",automaticHookOffTime:"0",joinWithoutAudio:"false",pmode:"false",toneOnSecondaryRingerOnly:"false",applyMsTeamsPresence:false,autoPopoutMode:false,openPopoutOnAnswerCall:false,openPopoutOnMinimize:false,allowToCreateManagerAssistant:"true",unreadStyle:"red-line"},this.updateSubject=new r.Subject}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.settingsService||(e.rainbow.settingsService=new s),e.rainbow.settingsService}configure(e){this.languageCodes=this.languages.map((e=>e.settingCode));const t=this.getLocalStorageSettings();if(t.init)e&&(t.lang=this.getMappedLanguage(e),this.setAppliLanguageCode(t.lang)),Object.keys(t).forEach((e=>{null!==t[e]&&(this.settings[e]=t[e])}));else{const t=navigator,i=t.languages?t.languages[0]:t.language||t.userLanguage,r=e||i;this.settings.lang=this.getMappedLanguage(r),this.setAppliLanguageCode(this.settings.lang),Object.keys(this.settings).forEach((e=>{localStorage.setItem(e,this.settings[e])}))}this.sendUpdateEvent(n.RBEvent.create("SETTINGS_UPDATED"))}setSetting(e,t){this.settings[e]=t,localStorage.setItem(e,t)}getSetting(e){return this.settings[e]}getBooleanSetting(e){return"true"===this.settings[e]}setSettingTemporarly(e,t,i=3e5){const r=this.settings[e];this.settings[e]=t,this.timers.push(setTimeout((()=>{this.settings[e]=r}),i))}sendUpdateEvent(e){this.updateSubject.next(e)}subscribeUpdateEvent(e,t){return this.updateSubject.subscribe((i=>{i.name===e&&t(i.data)}))}getLocalStorageSettings(){const e={};return Object.keys(this.settings).forEach((t=>{e[t]=localStorage.getItem(t)})),e.nbMaxConversations?parseInt(e.nbMaxConversations,10)<50&&this.setSetting("nbMaxConversations","50"):e.nbMaxConversations=this.settings.nbMaxConversations,"default"===e.headsetMicrophone&&(e.headsetMicrophone=null),"default"===e.headsetSpeaker&&(e.headsetSpeaker=null),"default"===e.speakerphoneMicrophone&&(e.speakerphoneMicrophone=null),"default"===e.speakerphoneSpeaker&&(e.speakerphoneSpeaker=null),"default"===e.customMicrophone&&(e.customMicrophone=null),"default"===e.customSpeaker&&(e.customSpeaker=null),"true"===e.webConfServiceV2&&(config.confV2Model=true),e}getRedirectVoIP(){return"false"===this.getSetting("ringingOnDnd").toString()}setRedirectVoIP(e){this.settings.ringingOnDnd=!e,localStorage.setItem("ringingOnDnd",(!e).toString())}isAutomaticHookOff(){return"true"===this.getSetting("isAutomaticHookOff").toString()}setAutomaticHookOff(e){this.setSetting("isAutomaticHookOff",e.toString())}getAutomaticHookOffTime(){return parseInt(this.getSetting("automaticHookOffTime").toString(),10)}setAutomaticHookOffTime(e){this.setSetting("automaticHookOffTime",e.toString())}setIceConfig(e){this.settings.iceConfig=e}getAvailableLanguages(){return this.languages}getAppliLanguage(){const e=this.languages.filter((e=>e.settingCode===this.settings.lang))[0];return e||this.defaultLanguage}getAppliLanguageCodeForServer(){const e=this.settings.lang.split("-");return 1===e.length?this.settings.lang:e[0]+"-"+e[1].toUpperCase()}setAppliLangageCodeFromServer(e){const t=e.split("-");let i=t[0];i&&(i=i.toLowerCase()),2===t.length&&(i+="-"+t[1].toLowerCase()),i=this.getMappedLanguage(i),i=this.languageCodes.indexOf(i)>=0?i:"en",this.setAppliLanguageCode(i)}setAppliLanguageCode(e,t=false){t?this.setSetting("lang",e):this.settings.lang=e,this.sendUpdateEvent(n.RBEvent.create("LANGUAGE_UPDATED",e))}getBestLanguageForIsoCode(e){const t=this.getLanguageByIsoCode(e);if(t)return t;if(-1!==e.indexOf("-")){const t=e.split("-")[0];return this.getLanguageByIsoCode(t)}return this.getLanguageByIsoCode("en")}getSimpleLanguageCode(e){if(!e)return"en";const t=e.toLowerCase();if(-1!==t.indexOf("-")){return t.split("-")[0]}return t}getLanguageByIsoCode(e){return this.languages.find((t=>t.isoCode===e))}getMappedLanguage(e){if(!e)return"en";const t=e.toLowerCase();switch(t.split("-")[0]){case"ar":return"ar";case"ca":return"ca";case"cs":return"cs";case"en":return"en";case"fr":return"fr";case"de":return"de";case"es":return"es-es";case"fi":return"fi";case"it":return"it";case"he":return"he";case"ja":return"ja";case"ko":return"ko";case"nl":return"nl";case"no":return"no";case"pt":return"pt-br"===t?"pt-br":"pt-pt";case"pl":return"pl";case"ru":return"ru";case"sv":return"sv-se";case"tr":return"tr";case"zh":return["zh-cn","zh-tw"].indexOf(t)>=0?t:"zh-cn";default:return"en"}}isHybridTelephonySettingsCustomEnabled(){return false}async getHybridTelephonyCustomizationManifest(){return{version:"1",extensionPoints:{onIncomingPbxCallActions:[{name:"",command:{url:"",params:""}}],onIncomingPbxCallButtonActions:[{name:"",command:{url:"",params:""}}]}}}async setHybridTelephonyCustomizationManifest(e){console.error(e)}}t.SettingsService=s},function(e,t,i){i.d(t,"a",(function(){return s}));var r=i(0),n=i(2);function s(e,t){return function(i){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return i.lift(new o(e,t))}}var o=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.project,this.thisArg))},e}(),a=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.project=i,n.count=0,n.thisArg=r||n,n}return r.a(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(dp){return void this.destination.error(dp)}this.destination.next(t)},t}(n.a)},function(e,t,i){function r(e){return e&&"function"==typeof e.schedule}i.d(t,"a",(function(){return r}))},function(e,t,i){i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return s}));var r=i(5),n=new r.a((function(e){return e.complete()}));function s(e){return e?function(e){return new r.a((function(t){return e.schedule((function(){return t.complete()}))}))}(e):n}},function(e,t,i){i.d(t,"a",(function(){return o}));var r=i(5),n=i(59),s=i(122);function o(e,t){return t?Object(s.a)(e,t):e instanceof r.a?e:new r.a(Object(n.a)(e))}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7);class n{constructor(e){this.logo=null,this.nameForLogs="",this.banner=null,this.office365ScopesGranted=[],this.visibility="public",n.attributes.forEach((t=>{void 0!==e[t.name]?this[t.name]=e[t.name]:void 0!==t.defaultValue&&(this[t.name]=t.defaultValue)})),this.state=e.state?e.state:"USA"===e.country?"AL":"CAN"===e.country?"AB":null,this.name&&(this.filterName=this.name.toLowerCase()),this.rxSubject=new r.Subject}static create(e,t){return new n({id:e,name:t})}static createFromData(e){const t=new n(e);return t.selectedThemeCustomers||(t.selectedThemeCustomers={}),t.selectedTheme||(t.selectedTheme={}),t}static prune(e,t){const i=Object.assign({},e);return delete i.dataLocation,delete i.businessSpecific,i.selectedTheme&&i.selectedTheme.hasOwnProperty("isFromBp")&&delete i.selectedTheme.isFromBp,i.selectedThemeCustomers&&i.selectedThemeCustomers.hasOwnProperty("isFromBp")&&delete i.selectedThemeCustomers.isFromBp,delete i.giphyEnabled,i.isBP?"VAD"!==i.bpType&&"DR"!==i.bpType&&delete i.bpBusinessType:(delete i.bpType,delete i.bpBusinessModel,delete i.bpApplicantNumber,delete i.bpCRDid,delete i.bpHasRightToSell,delete i.bpHasRightToConnect,delete i.bpIsContractAccepted),""===i.economicActivityClassification&&delete i.economicActivityClassification,i.allowDeviceFirmwareSelection||delete i.selectedDeviceFirmware,t&&(t.isSuperadmin()||t.isBPAdminFinance())||(delete i.bpType,delete i.adminHasRightToUpdateSubscriptions,delete i.adminAllowedUpdateSubscriptionsOps),t&&t.isSuperadmin()||(delete i.superadminComment,delete i.allowDeviceFirmwareSelection),t&&(t.isSuperadmin()||null!==i.supportEmail&&""!==i.supportEmail)||delete i.supportEmail,t&&(t.isSuperadmin()||null!==i.privateDC&&""!==i.privateDC)||delete i.privateDC,i}updateFromData(e){n.attributes.forEach((t=>{void 0!==e[t.name]&&(this[t.name]=e[t.name])}))}getNameForLogs(){return!this.nameForLogs&&this.name&&(this.nameForLogs=this.name.charAt(0)+this.name.replace(/[^\s](?=.{1,}$)/g,"*").substr(1)),this.nameForLogs}isActive(){return"active"===this.status}isInitializing(){return"initializing"===this.status}isInvited(){return"invited"===this.status}isFreemium(){return"freemium"===this.offerType}isPremium(){return"premium"===this.offerType}isVAD(){return this.isBP&&"VAD"===this.bpType}isIR(){return this.isBP&&"IR"===this.bpType}isDR(){return this.isBP&&"DR"===this.bpType}isEC(){return!this.isBP}onChange(e){return this.rxSubject.subscribe(e)}sendChangeEvent(e,t=null){this.rxSubject.next({type:e,value:t})}getSelectedWhiteThemeId(){return this.selectedTheme?this.selectedTheme.light:null}setSelectedWhiteThemeId(e){this.selectedTheme||(this.selectedTheme={}),this.selectedTheme.light=e}getSelectedDarkThemeId(){return this.selectedTheme?this.selectedTheme.dark:null}setSelectedDarkThemeId(e){this.selectedTheme||(this.selectedTheme={}),this.selectedTheme.dark=e}setSelectedTheme(e){e.isWhiteType()?this.setSelectedWhiteThemeId(e.id):this.setSelectedDarkThemeId(e.id)}getSelectedCustomerWhiteThemeId(){return this.selectedThemeCustomers?this.selectedThemeCustomers.light:null}setSelectedCustomerWhiteThemeId(e){this.selectedThemeCustomers||(this.selectedThemeCustomers={}),this.selectedThemeCustomers.light=e}getSelectedCustomerDarkThemeId(){return this.selectedThemeCustomers?this.selectedThemeCustomers.dark:null}setSelectedCustomerDarkThemeId(e){this.selectedThemeCustomers||(this.selectedThemeCustomers={}),this.selectedThemeCustomers.dark=e}setSelectedThemeCustomers(e){e.isWhiteType()?this.setSelectedCustomerWhiteThemeId(e.id):this.setSelectedCustomerDarkThemeId(e.id)}}n.StatusValues=["initializing","active","alerting","hold","terminated"],n.VisibilityValuesWithOrganization=["public","private","organization","closed","isolated"],n.VisibilityValues=["public","private","closed","isolated"],n.SizeValues=["self-employed","1-10 employees","11-50 employees","51-200 employees","201-500 employees","501-1000 employees","1001-5000 employees","5001-10,000 employees","10,001+ employees"],n.OfferTypes=["freemium","premium"],n.BPTypes=["VAD","DR","IR"],n.BPTypeLabels={IR:"Indirect Reseller",VAD:"Value Added Distributor",DR:"Direct Reseller"},n.BPBusinessModels=["resell"],n.BPBusinessModelLabels={resell:"Resell",referral:"Referral"},n.adminAllowedUpdateSubscriptionsOperations=["all","increase_only"],n.BPBusinessTypes={DEFAULT:"default",VOICE_BY_ALE:"voice_by_ale",VOICE_BY_PARTNER:"voice_by_partner",CONFERENCE:"conference"},n.EconomicActivityClassificationTypes={NONE:"notDefined-f",A:"agriculture",B:"mining",C:"manufacturing",D:"electricity",E:"water supply",F:"construction",G:"wholesale",H:"transportation",I:"accommodation",J:"information and communication",K:"financial",L:"real estate activities",M:"professional",N:"administrative",O:"public administration",P:"education",Q:"human health",R:"arts",S:"other service activities",T:"activities of households as employer",U:"activities of extraterritorial organisations and bodies"},n.PrivateDCValues=["HDS"],n.attributes=[{name:"id",defaultValue:void 0},{name:"name",defaultValue:""},{name:"creationDate",defaultValue:void 0},{name:"companyContactId",defaultValue:void 0},{name:"adminEmail",defaultValue:""},{name:"supportEmail",defaultValue:void 0},{name:"status",defaultValue:"active"},{name:"economicActivityClassification",defaultValue:"NONE"},{name:"website",defaultValue:void 0},{name:"description",defaultValue:void 0},{name:"visibility",defaultValue:"private"},{name:"visibleBy",defaultValue:[]},{name:"organisationId",defaultValue:""},{name:"userSelfRegisterEnabled",defaultValue:false},{name:"userSelfRegisterAllowedDomains",defaultValue:[]},{name:"offerType",defaultValue:"freemium"},{name:"street",defaultValue:void 0},{name:"city",defaultValue:void 0},{name:"postalCode",defaultValue:void 0},{name:"country",defaultValue:void 0},{name:"state",defaultValue:null},{name:"timezone",defaultValue:void 0},{name:"size",defaultValue:void 0},{name:"slogan",defaultValue:void 0},{name:"isBP",defaultValue:false},{name:"bpType",defaultValue:void 0},{name:"bpBusinessModel",defaultValue:void 0},{name:"bpApplicantNumber",defaultValue:void 0},{name:"bpCRDid",defaultValue:void 0},{name:"bpHasRightToSell",defaultValue:void 0},{name:"bpId",defaultValue:void 0},{name:"bpHasRightToConnect",defaultValue:void 0},{name:"adminHasRightToUpdateSubscriptions",defaultValue:false},{name:"adminAllowedUpdateSubscriptionsOps",defaultValue:"all"},{name:"externalReference",defaultValue:void 0},{name:"externalReference2",defaultValue:void 0},{name:"lastAvatarUpdateDate",defaultValue:null},{name:"lastBannerUpdateDate",defaultValue:null},{name:"avatarShape",defaultValue:"circle"},{name:"catalogId",defaultValue:void 0},{name:"office365Tenant",defaultValue:void 0},{name:"office365ScopesGranted",defaultValue:void 0},{name:"isCentrex",defaultValue:void 0},{name:"tenantCallNumber",defaultValue:void 0},{name:"tenantName",defaultValue:void 0},{name:"numberUsers",defaultValue:void 0},{name:"dataLocation",defaultValue:void 0},{name:"privateDC",defaultValue:void 0},{name:"businessSpecific",defaultValue:void 0},{name:"superadminComment",defaultValue:void 0},{name:"bpBusinessType",defaultValue:[]},{name:"voIPSettings",defaultValue:void 0},{name:"ddiReadOnly",defaultValue:void 0},{name:"allowUsersSelectTheme",defaultValue:true},{name:"allowUsersSelectPublicTheme",defaultValue:true},{name:"selectedTheme",defaultValue:void 0},{name:"selectedThemeCustomers",defaultValue:void 0},{name:"tryNewUiCustomisation",defaultValue:void 0},{name:"softphoneOnlyCustomisation",defaultValue:void 0},{name:"fileSharingCustomisation",defaultValue:"enabled"},{name:"userTitleNameCustomisation",defaultValue:void 0},{name:"useRoomCustomisation",defaultValue:"enabled"},{name:"phoneMeetingCustomisation",defaultValue:"enabled"},{name:"useChannelCustomisation",defaultValue:"enabled"},{name:"useScreenSharingCustomisation",defaultValue:"enabled"},{name:"useWebRTCVideoCustomisation",defaultValue:"enabled"},{name:"useWebRTCAudioCustomisation",defaultValue:"enabled"},{name:"useSpeakingTimeStatistics",defaultValue:"enabled"},{name:"instantMessagesCustomisation",defaultValue:"enabled"},{name:"readReceiptsCustomisation",defaultValue:"enabled"},{name:"userProfileCustomisation",defaultValue:"enabled"},{name:"fileStorageCustomisation",defaultValue:"enabled"},{name:"overridePresenceCustomisation",defaultValue:"enabled"},{name:"changeSettingsCustomisation",defaultValue:"enabled"},{name:"changeTelephonyCustomisation",defaultValue:"enabled"},{name:"recordingConversationCustomisation",defaultValue:"enabled"},{name:"useGifCustomisation",defaultValue:"enabled"},{name:"useDialOutCustomisation",defaultValue:"enabled"},{name:"selectedAppCustomisationTemplate",defaultValue:void 0},{name:"mobilePermanentConnectionMode",defaultValue:void 0},{name:"alertNotificationSending",defaultValue:"disabled"},{name:"alertNotificationReception",defaultValue:"disabled"},{name:"cloudPbxRecordingInboundOnly",defaultValue:void 0},{name:"defaultLicenseGroup",defaultValue:void 0},{name:"allowDeviceFirmwareSelection",defaultValue:false},{name:"selectedDeviceFirmware",defaultValue:"released"},{name:"supportUrlFAQ",defaultValue:void 0},{name:"allowPhoneNumbersVisibility",defaultValue:void 0},{name:"disableCCareAdminAccess",defaultValue:void 0},{name:"disableCCareAdminAccessCustomers",defaultValue:void 0},{name:"disableCCareAdminAccessResellers",defaultValue:void 0},{name:"eLearningCustomisation",defaultValue:"enabled"},{name:"eLearningGamificationCustomisation",defaultValue:"enabled"}],t.Company=n},function(e,t,i){var r=i(0),n=function(e){function t(t,i,r){var n=e.call(this)||this;return n.parent=t,n.outerValue=i,n.outerIndex=r,n.index=0,n}return r.a(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(i(2).a),s=i(59),o=i(5);function a(e,t,i,r,a){if(void 0===a&&(a=new n(e,i,r)),!a.closed)return t instanceof o.a?t.subscribe(a):Object(s.a)(t)(a)}i.d(t,"a",(function(){return a}))},function(e,t,i){i.d(t,"a",(function(){return n}));var r=false,n={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e&&(new Error).stack;r=e},get useDeprecatedSynchronousErrorHandling(){return r}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=new class{dispatchEvent(e,t=null){document.dispatchEvent(new CustomEvent(e,{detail:t}))}};t.eventsService=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7);class n{constructor(e,t,i,n){this.isVm=false,this.remoteMedia=0,this.localMedia=0,this.isEscalated=false,this.isError=false,this.startDate=new Date,this.isInitiator=false,this.participants=null,this.isConference=false,this.isRecorded=false,this.subject=void 0,this.currentCalled={contactPhoneNumber:"",contact:null,participantsPhoneNumbers:[],participants:[]},this.fullJid="",this.mediaPillarCall=null,this.isSecondary=false,this.isSecondSharingCall=false,this.relevant=true,this.relevantEquipmentId="unknown",this.deviceId=null,this.isOwner=void 0,this.isMPAudioOwner=void 0,this.pbxConnectionDown=void 0,this.isMuted=false,this.duration=0,this.durationTimer=null,this.unifiedPlanActivated=true,this.globalCallId=null,this.correlatorData=null,this.correlatorDataHex=null,this.activeControl=false,this.hasRemoteControlling=false,this.networkQuality=0,this.sipWiseData=null,this.sipWiseEndPointDeviceList=null,this.PBXDisplay=null,this.noIncomingPopup=false,this.errorMessage=null,this.lastCause=null,this.onHold=false,this.putOnHold=false,this.autoOffHookResource=void 0,this.mixtWebTelSingleStepTrans=false,this.localStreams=[],this.pinnedMedia="",this.dimLocalSharingScreen=true,this.statsInterval=null,this.originalStream=null,this.autoClear=null,this.autoAnswer=false,this.distantType="",this.addVideoAfterUnhold=false,this.callLayoutSizeValues={},this.isInExternalWindow=false,this.rxSubject=new r.Subject,this.direction=null,this.remoteNumber=null,this.callerNumber=null,this.calledNumber=null,this.calledDisplayName=null,this.calledLastName=null,this.calledFirstName=null,this.calledJID=null,this.calledRole=null,this.status=e,this.type=i,this.id=t,this.conversationId=null,this.connectionId=null,this.isVm=null,this.contact=n,this.remoteMedia=0,this.localMedia=0,this.isEscalated=false,this.startDate=new Date,this.isInitiator=false,this.participants=null,this.isConference=false,this.avatars=n&&n.avatar?[this.contact.avatar.src]:[],this.subject=void 0,this.currentCalled={contactPhoneNumber:"",contact:null,participantsPhoneNumbers:[],participants:[]},this.fullJid="",this.mediaPillarCall=null,this.isSecondary=false,this.isSecondSharingCall=false,this.relevant=false,this.relevantEquipmentId="unknown",this.deviceId=null,this.isOwner=void 0,this.isMPAudioOwner=void 0,this.pbxConnectionDown=void 0,this.isMuted=false,this.duration=0,this.statusInfo=null,this.globalCallId=void 0,this.correlatorData=void 0,this.correlatorDataHex=void 0,this.activeControl=false,this.hasRemoteControlling=false,this.networkQuality=0,this.sipWiseData={initCause:"",called:{phoneNumber:"",displayName:""},assocPhoneCallId:null},this.sipWiseEndPointDeviceList=[],this.PBXDisplay=void 0,this.noIncomingPopup=false,this.onHold=false,this.putOnHold=false,this.localStreams=[],this.direction=void 0,this.remoteNumber=void 0,this.callerNumber=void 0,this.calledNumber=void 0,this.calledDisplayName=void 0,this.calledLastName=void 0,this.calledFirstName=void 0,this.calledJID=void 0,this.calledRole=void 0,this.pinnedMedia="",this.dimLocalSharingScreen=true,this.statsInterval=null,this.originalStream=null,this.autoClear=null,this.autoAnswer=false,this.distantType="",this.addVideoAfterUnhold=false,this.mixtWebTelSingleStepTrans=false}static create(e,t,i,r){return new n(e,t,i,r)}setCallId(e){this.id=e}getGlobalCallId(){return this.globalCallId}setGlobalCallId(e){this.globalCallId=e}setConversationId(e){this.conversationId=e}setStatus(e){this.status=e,this.manageDurationTimer()}setCalledDisplayName(e){this.calledDisplayName=e}getCalledDisplayName(){return this.calledDisplayName}setCalledRole(e){this.calledRole=e}manageDurationTimer(){this.status===n.Status.ACTIVE?this.startDuration():this.status===n.Status.UNKNOWN&&this.stopDuration()}setCorrelatorData(e){this.correlatorData=e}setCorrelatorDataHex(e){this.correlatorDataHex=e}setType(e){this.type=e}setIsVm(e){this.isVm=e}getIsVm(){return this.isVm}setContact(e){this.contact=e,this.avatars=[this.contact.avatar.src]}getCurrentCalled(){return this.currentCalled}setSubject(e){this.subject=e}setCurrentCalledContactNumber(e){this.currentCalled.contactPhoneNumber=e}setRelevantEquipmentId(e){this.relevantEquipmentId=e}setParticipants(e){this.participants=e,this.avatars=[],this.participants.forEach((e=>{this.avatars.push(e.avatar.src)}))}setConnectionId(e){this.connectionId=e,this.id=n.getIdFromConnectionId(e)}isInConversationWithMobile(){return!!this.fullJid&&(-1!==this.fullJid.indexOf("mobile_android")||-1!==this.fullJid.indexOf("mobile_ios"))}isInConversationWithDesktopApp(){return!!this.fullJid&&-1!==this.fullJid.indexOf("desk_")}setCurrentCalled(e){e?this.contact&&this.contact.id?(this.currentCalled.contactPhoneNumber=e.contactPhoneNumber&&""!==e.contactPhoneNumber?e.contactPhoneNumber:"",this.currentCalled.contact=e.contact?e.contact:null,this.currentCalled.participantsPhoneNumbers=null,this.currentCalled.participants=null):(this.currentCalled.contactPhoneNumber="",this.currentCalled.contact=null,this.currentCalled.participantsPhoneNumbers=e.participantsPhoneNumbers&&e.participantsPhoneNumbers.length>0?e.participantsPhoneNumbers:null,this.currentCalled.participants=e.participants&&e.participants.length>0?e.participants:null):(this.currentCalled.contactPhoneNumber="",this.currentCalled.contact=null,this.currentCalled.participantsPhoneNumbers=null,this.currentCalled.participants=null)}static getIdFromConnectionId(e){return e}static getCallIdFromConnectionId(e){return e?e.split("#")[0]:null}static getDeviceIdFromConnectionId(e){const t=e?e.split("#")[1]:null;return t||null}isWebRtcMediaPillar(){return this.fullJid&&0===this.fullJid.indexOf("mp_")}isMediaPillarCall(){return null!==this.mediaPillarCall||this.isWebRtcMediaPillar()}getMediaPillarCall(){return this.mediaPillarCall}setMediaPillarCall(e){this.mediaPillarCall=e||null}setDeviceIdSipWise(e){this.deviceId=e||null}getDeviceIdSipWise(){return this.deviceId}setConnectionIdSipWise(e){this.connectionId=e}getConnectionIdSipWise(){return this.connectionId}resetSipWiseData(){this.sipWiseData={initCause:"",called:{phoneNumber:"",displayName:""}}}setInitCauseSipWiseData(e){this.sipWiseData.initCause=e,this.lastCause=e}getInitCauseSipWiseData(){return this.sipWiseData.initCause}setTypeSipWiseData(e){this.sipWiseData.type=e}getTypeSipWiseData(){return this.sipWiseData.type}setCalledSipWiseData(e){this.sipWiseData.called=e}getCalledSipWiseData(){return this.sipWiseData.called}isHuntingGroupCallSipWise(){return"distributed"===this.sipWiseData.initCause}getHuntingGroupCalledInfo(){return this.isHuntingGroupCallSipWise()?this.getCalledSipWiseData():null}isHuntingGroupCallQueueSipWise(){return"ccq"===this.sipWiseData.type}setAssocPhoneCallId(e){this.sipWiseData.assocPhoneCallId=e}getAssocPhoneCallId(){return this.sipWiseData.assocPhoneCallId}setEndPointDeviceListSipWise(e){this.sipWiseEndPointDeviceList=e}getEndPointDeviceListSipWise(){return this.sipWiseEndPointDeviceList}setAutoOffHookResource(e){this.autoOffHookResource=e}getAutoOffHookResource(){return this.autoOffHookResource}setMixtWebTelSingleStepTrans(e){this.mixtWebTelSingleStepTrans=e}getMixtWebTelSingleStepTrans(){return this.mixtWebTelSingleStepTrans}setDirection(e){this.direction=e}getDirection(){return this.direction}getDeviceIdFromConnectionIdFromCall(){return this.deviceId?this.deviceId:this.connectionId?this.connectionId.split("#")[1]:null}startDuration(){this.durationTimer||(this.durationTimer=r.interval(1e3).subscribe((()=>{this.duration++})))}stopDuration(){this.durationTimer&&(this.durationTimer.unsubscribe(),this.durationTimer=null,this.duration=0)}getStatusForDisplay(){return this.status&&this.status.value?n.StatusDisplay[this.status.value]:""}toString(){return"(type:"+(this.type?this.type.value:this.type)+", id:"+this.id+", status:"+(this.status?this.status.value:this.status)+(this.isConference?" conference":"")+")"}isInCallWithMediaPillar(){return this.fullJid&&-1!==this.fullJid.indexOf("mp_")}subscribe(e){return this.rxSubject.subscribe(e)}publish(e,t=null){this.rxSubject.next({name:e,value:t})}}n.Status={UNKNOWN:{key:0,value:"Unknown"},DIALING:{key:1,value:"dialing"},QUEUED_INCOMMING:{key:2,value:"queuedIncomming"},QUEUED_OUTGOING:{key:10,value:"queuedOutGoing"},RINGING_INCOMMING:{key:3,value:"incommingCall"},RINGING_OUTGOING:{key:4,value:"ringingOutgoing"},ACTIVE:{key:5,value:"active"},HOLD:{key:6,value:"held"},PUT_ON_HOLD:{key:7,value:"putOnHold"},RELEASING:{key:8,value:"releasing"},ANSWERING:{key:9,value:"answering"},CONNECTING:{key:12,value:"connecting"},ERROR:{key:11,value:"error"}},n.Type={WEBRTC:{key:1,value:"Video"},PHONE:{key:2,value:"Phone"}},n.Media={AUDIO:1,VIDEO:2,PHONE:4,SHARING:8},n.StatusDisplay={Unknown:"",dialing:"dialing",queuedIncomming:"incoming",queuedOutGoing:"ringingOutgoing",incommingCall:"incoming",ringingOutgoing:"ringingOutgoing",active:"inCall",held:"held",putOnHold:"putOnHold",releasing:"releasing",answering:"answering",connecting:"connecting",error:"failed"},t.Call=n},function(e,t,i){function r(e){return e}i.d(t,"a",(function(){return r}))},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(142),n=i(7),s=i(18),o=i(71),a=i(7),c=i(19),l=i(8),d=i(17),u=i(9),h=i(14),f=i(6),p=i(37),g=i(4),m=i(46),v=i(161),S=i(11),b=i(13);class y{constructor(){this.ROOM_UPDATE_EVENT="ROOM_UPDATE_EVENT",this.ROOM_USER_UPDATE_EVENT="ROOM_USER_UPDATE_EVENT",this.ROOM_AVATAR_UPDATE_EVENT="ROOM_AVATAR_UPDATE_EVENT",this.ROOM_HISTORY_UPDATE_EVENT="ROOM_HISTORY_UPDATE_EVENT",this.ROOM_ADMIN_MESSAGE_EVENT="ROOM_ADMIN_MESSAGE_EVENT",this.ROOM_INVITATION="ROOM_INVITATION",this.ROOM_ADD_CONF_ENDPOINT_EVENT="ROOM_ADD_CONF_ENDPOINT_EVENT",this.ROOM_REMOVE_CONF_ENDPOINT_EVENT="ROOM_REMOVE_CONF_ENDPOINT_EVENT",this.ROOM_ADD_USERS_EVENT="ROOM_ADD_USERS_EVENT",this.ROOM_DELETE_USERS_EVENT="ROOM_DELETE_USERS_EVENT",this.ROOM_CONFERENCE_DELEGATE_EVENT="ROOM_CONFERENCE_DELEGATE_EVENT",this.RoomUserStatus={INVITED:"invited",ACCEPTED:"accepted",UNSUBSCRIBED:"unsubscribed",REJECTED:"rejected",DELETED:"deleted"},this.openInviteIdByRoomIdSubject=new n.Subject,this.rxSubject=new n.Subject,this.roomTags=[],this.rooms={},this.started=false,this.context="global",this.portalURL=null,this.listeners=[],this.xmppConnectionSubscription=null,this.roomPresenceWaitingList=[],this.userContact=null,this.invitationCounter=0,this.meetingInvitationCounter=0,this.roomsByJids={},this.roomsInProgress={},this.updateLater={},this.maxRoomsUsers=0,this.maxRoomsStartupLoad=0,this.personalAudioRoomId="",this.currentPersonalAudioRoomId="",this.openInviteIdByRoomId={},this.getRoomByJidPromises={},this.roomPresenceRef=null,this.roomMessageRef=null,this.roomInfoMessageRef=null,this.roomMessageConfigRef=null,this.roomHistoryInfoRef=null,this.roomNotificationRef=null,this.roomErrorMessageRef=null,this.roomServiceConfig=null,this.settingsService=c.SettingsService.getInstance(),this.contactService=f.ContactService.getInstance(),this.profileService=h.ProfileService.getInstance(),this.authService=l.AuthService.getInstance(),this.eventService=S.EventService.getInstance(),this.logger=g.LoggerService.getInstance(),this.xmppService=u.XmppService.getInstance(),this.fileStorageService=p.FileStorageService.getInstance(),this.errorHelperService=b.ErrorHelperService.getInstance(),this.i18n=m.I18nService.getInstance(),this.mainService=d.MainService.getInstance()}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.roomService||(e.rainbow.roomService=new y),e.rainbow.roomService}async start(e=null){try{this.roomServiceConfig=e,this.userContact=this.contactService.userContact,this.started=true,this.portalURL=config.restServerUrl+"/api/rainbow/enduser/v1.0/",this.invitationCounter=0,this.meetingInvitationCounter=0,this.rooms={},this.roomsByJids={},this.roomsInProgress={},this.updateLater={},this.maxRoomsUsers=this.profileService.getFeatureLimitMax(this.profileService.FeaturesEnum.BUBBLE_PARTICIPANT_COUNT),this.maxRoomsStartupLoad=this.profileService.getFeatureLimitMax(this.profileService.FeaturesEnum.BUBBLE_MAX_LOAD_STARTUP),this.personalAudioRoomId="",this.currentPersonalAudioRoomId="",this.openInviteIdByRoomId={},this.getRoomByJidPromises={},this.roomTags=[],this.logger.info(""),this.logger.info("[roomService] === STARTING ==="),this.attachHandlers(),this.context=this.userContact&&this.userContact.roomsEnabled?"global":"webinar","global"===this.context&&await this.getServerRooms(),await this.getServerRooms(true),this.computeInvitationCounter(),"global"===this.context&&(this.roomServiceConfig&&this.roomServiceConfig.ignoreOpenInviteData||this.retrieveOpenInviteData(),this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_ALLOWED)&&(this.retrievePersonalAudioRoom(),this.retrieveCurrentPersonalAudioRoom())),this.logger.info("[roomService] === STARTED ===")}catch(t){this.logger.error("[roomService] === STARTING FAILURE === "+t.message),this.computeInvitationCounter(),this.reconnect()}}async stop(){this.logger.info(""),this.logger.info("[roomService] === STOPPING ==="),this.listeners.forEach((e=>{e()})),this.rooms={},this.roomsByJids={},this.roomPresenceWaitingList=[],this.started=false,this.logger.info("[roomService] === STOPPED ===")}attachHandlers(){this.logger.info("[roomService] attachHandlers"),this.roomPresenceRef&&(this.xmppService.connection.deleteHandler(this.roomPresenceRef),this.roomPresenceRef=null),this.roomPresenceRef=this.xmppService.connection.addHandler((e=>this.onRoomPresence(e)),"http://jabber.org/protocol/muc#user","presence"),this.roomMessageRef&&(this.xmppService.connection.deleteHandler(this.roomMessageRef),this.roomMessageRef=null),this.roomMessageRef=this.xmppService.connection.addHandler((e=>this.onRoomMessage(e)),"jabber:x:conference","message"),this.roomInfoMessageRef&&(this.xmppService.connection.deleteHandler(this.roomInfoMessageRef),this.roomInfoMessageRef=null),this.roomInfoMessageRef=this.xmppService.connection.addHandler((e=>this.onRoomInfoMessage(e)),null,"message","groupchat"),this.roomMessageConfigRef&&(this.xmppService.connection.deleteHandler(this.roomMessageConfigRef),this.roomMessageConfigRef=null),this.roomMessageConfigRef=this.xmppService.connection.addHandler((e=>this.onRoomMessageConfig(e)),null,"message","management"),this.roomHistoryInfoRef&&(this.xmppService.connection.deleteHandler(this.roomHistoryInfoRef),this.roomHistoryInfoRef=null),this.roomHistoryInfoRef=this.xmppService.connection.addHandler((e=>this.onRoomHistoryInfoMessage(e)),"jabber:iq:notification","message"),this.roomNotificationRef&&(this.xmppService.connection.deleteHandler(this.roomNotificationRef),this.roomNotificationRef=null),this.roomNotificationRef=this.xmppService.connection.addHandler((e=>this.onRoomNotificationMessage(e)),"jabber:x:bubble:conference","message"),this.roomErrorMessageRef&&(this.xmppService.connection.deleteHandler(this.roomErrorMessageRef),this.roomErrorMessageRef=null),this.roomErrorMessageRef=this.xmppService.connection.addHandler((e=>this.onRoomErrorMessage(e)),null,"message","error"),this.listeners.forEach((e=>{e()})),this.xmppConnectionSubscription&&this.xmppConnectionSubscription.unsubscribe(),this.xmppConnectionSubscription=this.xmppService.subscribeToConnectionEvents((e=>{this.onConnectionStateChange(e)}))}async reconnect(e=0){if(!this.userContact||this.userContact.roomsEnabled)try{this.logger.info("[roomService] reconnect"),e++,this.attachHandlers(),Object.keys(this.rooms).forEach((e=>{const t=this.rooms[e];t&&(t.initPresenceAck=false,t.initPresInterval&&(this.logger.info("[roomService] onConnectionStateChange cancel initPresence retryer for room: "+t.jid+" "+t.getNameForLogs()),t.initPresInterval.unsubscribe(),t.initPresInterval=null),t.initPresPromise&&(this.logger.info("[roomService] onConnectionStateChange remove initPresPromise for room: "+t.jid+" "+t.getNameForLogs()),t.initPresPromise=null,t.initPresPromiseResolve=null))})),this.roomPresenceWaitingList=[],await this.getServerRooms(),await this.getServerRooms(true),this.computeInvitationCounter(),this.retrieveOpenInviteData(),this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_ALLOWED)&&(this.retrievePersonalAudioRoom(),this.retrieveCurrentPersonalAudioRoom()),this.logger.info("[roomService] reconnect success")}catch(t){this.logger.error("[roomService] reconnect failure -- "+t.message),1===e&&this.reconnect(e)}else this.logger.info("[roomService] === Reconnect skipped - roomsEnabled : false")}onConnectionStateChange(e){this.logger.info("[roomService] onConnectionStateChange status:"+e.name),"ON_XMPP_DISCONNECTED"===e.name&&this.rooms&&(Object.keys(this.rooms).forEach((e=>{const t=this.rooms[e];t&&(t.initPresenceAck=false,t.initPresInterval&&(this.logger.info("[roomService] onConnectionStateChange cancel initPresence retryer for room: "+t.jid+" "+t.getNameForLogs()),t.initPresInterval.unsubscribe(),t.initPresInterval=null),t.initPresPromise&&(this.logger.info("[roomService] onConnectionStateChange remove initPresPromise for room: "+t.jid+" "+t.getNameForLogs()),t.initPresPromise=null,t.initPresPromiseResolve=null))})),this.roomPresenceWaitingList=[])}subscribe(e){return this.rxSubject.subscribe(e)}sendEvent(e,t){this.rxSubject.next({type:e,value:t})}getRooms(){const e=[];return Object.keys(this.rooms).forEach((t=>{e.push(this.rooms[t])})),e}searchRooms(e){const t=e.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(/[ -]+/);return this.getRooms().filter((e=>{if(!this.contactService.userContact.phoneMeetingsEnabled&&e.isMeetingRoom())return false;if("accepted"!==e.status||e.isWebinarRoom())return false;e.filterName=e.name.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"");const i=e.filterName.split(/[ -]+/);return t.every((e=>i.some(((t,r)=>!(!t.length||-1===t.indexOf(e))&&(i[r]="",true)))))}))}getRoomInvitations(){return this.getRooms().filter((e=>"invited"===e.status&&"Rainbow_OutlookCreation_InternalUseOnly"!==e.desc&&!e.isMeetingRoom()&&!e.isWebinarRoom()))}getMeetingInvitations(){return this.getRooms().filter((e=>!e.isWebinarRoom()&&("invited"===e.status&&"Rainbow_OutlookCreation_InternalUseOnly"!==e.desc&&e.isMeetingRoom()&&!e.isWebinarRoom())))}getWebinarInvitations(){return this.getRooms().filter((e=>"invited"===e.status&&e.isWebinarRoom()&&null!==e.webinarId))}getMyRooms(){return this.getRooms().filter((e=>e.owner))}getRoomById(e){return this.rooms[e]}getRoomByJid(e){return this.roomsByJids[e]}getRoomsByContainerId(e){return this.getRooms().filter((t=>t.containerId===e))}computeInvitationCounter(){this.invitationCounter=0,this.meetingInvitationCounter=0,Object.keys(this.rooms).forEach((e=>{const t=this.rooms[e];"invited"===t.status&&(t.isMeetingRoom()?this.meetingInvitationCounter+=1:this.invitationCounter+=1)})),this.logger.info("[roomService] invitationCounter for rooms updated - value is "+this.invitationCounter),this.logger.info("[roomService] meetingInvitationCounter updated - value is "+this.meetingInvitationCounter)}getOrderedRooms(e){const t=this.getRooms();switch(e){case"lastActivityDate":return t.sort(((e,t)=>t.getLastActivityDate().getTime()-e.getLastActivityDate().getTime()));case"creationDate":return t.sort(((e,t)=>t.getCreationDate().getTime()-e.getCreationDate().getTime()));default:return t.sort(((e,t)=>e.name.localeCompare(t.name)))}}getMyOrderedRooms(e){const t=this.getMyRooms();switch(e){case"lastActivityDate":return t.sort(((e,t)=>t.getLastActivityDate().getTime()-e.getLastActivityDate().getTime()));case"creationDate":return t.sort(((e,t)=>t.getCreationDate().getTime()-e.getCreationDate().getTime()));default:return t.sort(((e,t)=>e.name.localeCompare(t.name)))}}async updateRoomFromServer(e){this.logger.info(`updateRoomFromServer(${e.dbId})`);try{let t=`${this.portalURL}rooms/${e.dbId}?format=full&unsubscribed=true`;"webinar"===this.context&&(t+="&context=webinar");const i=await fetch(t,{headers:this.authService.getRequestHeader()}),r=(await i.json()).data;await this.getAllRoomsParticipants([r]),this.updateRoomData(e,r),this.eventService.publish(this.ROOM_UPDATE_EVENT,e)}catch(t){this.logger.error("updateRoomFromServer -- FAILURE -- "+t.message)}}updateRoomData(e,t){if(e.name=t.name,e.desc=t.topic,e.conference=t.conference,e.users=[],t.users.forEach((t=>{const i=this.contactService.getContactById(t.userId);i&&(e.users.push({contact:i,status:t.status,date:new Date(t.additionDate),privilege:t.privilege}),this.contactService.isUserContact(i)&&(e.status=t.status))})),this.refreshMemberAndOrganizerLists(e),e.isModerator=e.status!==this.RoomUserStatus.UNSUBSCRIBED&&e.isUserModerator(this.contactService.userContact),t.lastAvatarUpdateDate&&t.lastAvatarUpdateDate!==e.lastAvatarUpdate){e.lastAvatarUpdate=t.lastAvatarUpdateDate;const i=d.MainService.MD5(e.lastAvatarUpdate);e.avatar=`${config.restServerUrl}/api/room-avatar/${e.dbId}?size=512&update=${i}`}e.updateAvatarInfo(),e.guestEmails=t.guestEmails,e.guestPhoneNumbers=t.conference&&t.conference.guestPhoneNumbers?t.conference.guestPhoneNumbers:[],e.confEndpoints=t.confEndpoints}async getServerRoom(e){try{this.logger.info(`[roomService] getServerRoom(${e})`);let t=`${this.portalURL}rooms/${e}?format=full&unsubscribed=true`;"webinar"===this.context&&(t+="&context=webinar");const i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;const n=(await r.json()).data;this.logger.info(`[roomService] getServerRoom(${e}) -- SUCCESS`);const s=await this.getAllRoomsParticipants([n]);return this.createRoomFromData(s[0])}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getServerRoom");throw this.logger.error("[roomService] "+e.message),e.error}}getServerRoomByJid(e){return this.logger.info(`[roomService] getServerRoomByJid(${e})`),this.getRoomByJidPromises[e]||(this.getRoomByJidPromises[e]=(async()=>{try{let t=`${this.portalURL}rooms/jids/${e}?format=full`;"webinar"===this.context&&(t+="&context=webinar");const i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;const n=(await r.json()).data;this.logger.info(`[roomService] getServerRoomByJid(${e}) -- SUCCESS`);const s=await this.getAllRoomsParticipants([n]);return delete this.getRoomByJidPromises[e],this.createRoomFromData(s[0])}catch(t){const i=await this.errorHelperService.getErrorInfo(t,"getServerRoomByJid");throw this.logger.error("[roomService] "+i.message),delete this.getRoomByJidPromises[e],i.error}})()),this.getRoomByJidPromises[e]}async getServerRooms(e=false){const t=async(i,r,n)=>{try{let s=`${this.portalURL}rooms?format=full&userId=${this.userContact.dbId}&sortField=lastActivityDate&status=invited&status=accepted&status=unsubscribed&offset=${i}&limit=${r}`;e&&(s+="&webinar=true&context=webinar");const o=this.authService.getRequestHeader(),a=await fetch(s,{method:"GET",headers:o});if(!a.ok)throw a;const c=await a.json();return n=n.concat(c.data),this.logger.info(`[roomService] getServerRooms retrieved ${c.data.length} rooms, total ${n.length}, existing ${c.total}`),n.length===c.total?(this.logger.info("[roomService] getServerRooms no need to loop again. All rooms retrieved..."),n):(i+=r,this.logger.info("[roomService] getServerRooms need another loop to get more rooms... "),await t(i,r,n))}catch(s){throw(await this.errorHelperService.getErrorInfo(s,"getSetOfRooms")).error}};try{const e=this.maxRoomsStartupLoad?this.maxRoomsStartupLoad:1e3,r=await t(0,e,[]);this.logger.info(`[roomService] getServerRooms successfully: find ${r.length} room(s)`);try{(await this.getAllRoomsParticipants(r)).forEach((e=>{this.createRoomFromData(e,true)}))}catch(i){this.logger.info("[roomService] getServerRooms issue while retrieving all participant"),r.forEach((e=>{this.createRoomFromData(e,true)}))}this.sendInitialPresenceForAllRooms()}catch(i){const e="getServerRooms failure: "+(i.data?i.data.errorDetails:i.message);throw this.logger.error("[roomService] "+e),new Error(e)}}async getRoomParticipants(e){try{const t=100,i=e.id,r=e.activeUsersCounter;let n=e.users.concat();if(r>t){n=[];const s=r/t+1;let o=0;const a=[];for(let e=1;e<s;e++)a.push(this.getRoomParticipantPage(i,o,t)),o+=t;(await Promise.all(a)).forEach((e=>{n=n.concat(e.data)})),e.users=n}return n}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getSetOfUsers");throw this.logger.error("[roomService] "+e.message),e.error}}async getRoomParticipantPage(e,t,i){try{const r=`${this.portalURL}rooms/${e}/users?format=full&offset=${t}&limit=${i}`,n=this.authService.getRequestHeader(),s=await fetch(r,{method:"GET",headers:n});if(!s.ok)throw s;return await s.json()}catch(r){const e=await this.errorHelperService.getErrorInfo(r,"getRoomParticipantPage");throw this.logger.error("[roomService] "+e.message),e.error}}async getAllRoomsParticipants(e){try{const t=performance.now(),i=(await Promise.all(e.map((e=>this.getRoomParticipants(e))))).reduce(((e,t)=>(t.forEach((t=>{e[t.jid_im]||(e[t.jid_im]=true)})),e)),{}),r=Object.keys(i).filter((e=>{const t=this.contactService.getContactByJid(e);return!t||t.temp}));if(r&&r.length)if(r.length>1e3){const e=[];for(;r.length>0;)e.push(r.splice(0,1e3));await Promise.all(e.map((e=>this.contactService.getContactsByJids(e))))}else await this.contactService.getContactsByJids(r);await Promise.all(e.map((e=>this.contactService.getContactByDBId(e.creator))));const n=performance.now();return this.logger.info(`[roomService] getAllRoomsParticipants - get "${r.length} participants in ${Math.round(n-t)} ms`),e}catch(t){throw this.logger.error("[roomService] "+t.message),t}}createRoomFromData(e,t=false){const i=r.Room.create(e.id,e.jid,e.name,e.topic,e.creationDate,e.confEndpoints,e.history,e.customData,e.conference,e.avatar,e.isActive,e.lastActivityDate,e.autoRegister,e.autoAcceptInvitation,e.tags,e.containerId,e.containerName,e.isOwnedByGroup,e.isAlertNotificationEnabled),n=this.contactService.dbContacts[e.creator];n?e.isOwnedByGroup?(this.logger.warn("[roomService] createRoomFromData -- Room created for hunting group -- "+e.name+" -- make me the owner"),i.ownerContact=this.contactService.userContact,i.owner=false):(i.ownerContact=n,i.owner=n.jid===this.contactService.userContact.jid):this.logger.warn("[roomService] createRoomFromData -- failure -- Impossible to find owner of room "+e.name+" --- ignored"),e.users.forEach((e=>{const t=this.contactService.getContactById(e.userId);t&&(i.users.push({contact:t,status:e.status,date:new Date(e.additionDate),privilege:e.privilege,invitingUserId:e.invitingUserId}),this.contactService.isUserContact(t)&&(i.status=e.status))})),i.guestEmails=e.guestEmails,i.guestPhoneNumbers=e.conference&&e.conference.guestPhoneNumbers?e.conference.guestPhoneNumbers:[],this.refreshMemberAndOrganizerLists(i);const o=i.getUserByJid(this.contactService.userContact.jid);i.isModerator=o&&o.status!==this.RoomUserStatus.UNSUBSCRIBED&&i.isUserModerator(this.contactService.userContact);let a="";return this.rooms[i.dbId]&&(this.rooms[i.dbId].initPresPromise&&(i.initPresPromise=this.rooms[i.dbId].initPresPromise,i.initPresInterval=this.rooms[i.dbId].initPresInterval,i.initPresPromiseResolve=this.rooms[i.dbId].initPresPromiseResolve),i.rxSubject=this.rooms[i.dbId].rxSubject,i.initPresenceAck=this.rooms[i.dbId].initPresenceAck,this.rooms[i.dbId].getCurrentConferenceSession()&&!i.getCurrentConferenceSession()?a="stopEvent":!this.rooms[i.dbId].getCurrentConferenceSession()&&i.getCurrentConferenceSession()&&(a="startEvent")),i.updateAvatarInfo(),e.lastAvatarUpdateDate&&(i.avatar=config.restServerUrl+"/api/room-avatar/"+e.id+"?size=512&update="+d.MainService.MD5(e.lastAvatarUpdateDate)),i.isWebinarRoom()&&(i.webinarId=i.conference.webinar.id),this.rooms[i.dbId]=i,this.roomsByJids[i.jid]=i,this.eventService.publish(this.ROOM_UPDATE_EVENT,i),this.sendEvent(this.ROOM_UPDATE_EVENT,i),"accepted"!==i.status||!i.isActive||i.initPresenceAck||t||this.sendInitialRoomPresenceSync(i),a&&("stopEvent"===a?i.rxSubject.next(s.RBEvent.create("ROOM_CONFERENCE_STOP_EVENT")):i.rxSubject.next(s.RBEvent.create("ROOM_CONFERENCE_START_EVENT"))),i}refreshMemberAndOrganizerLists(e){e.organizers=[],e.members=[],e.users.forEach((t=>{(t.status===this.RoomUserStatus.ACCEPTED||t.status===this.RoomUserStatus.INVITED||e.ownerContact&&t.contact.jid===e.ownerContact.jid)&&(t.privilege===r.Room.Privilege.MODERATOR?e.organizers.push(t):e.members.push(t))}))}equalContactsArrayByDbId(e,t){if(e===t)return true;if(null===e||null===t)return false;if(e.length!==t.length)return false;for(let i=0;i<e.length;++i)if(e[i].dbId!==t[i].dbId)return false;return true}async getOrCreateRoomWithContacts(e,t){try{let i=null;const r=[].concat([this.contactService.userContact],e).sort(this.sortObjectByProperty("dbId"));if(this.getMyRooms().some((e=>!(!e||e.status!==this.RoomUserStatus.ACCEPTED||!this.equalContactsArrayByDbId(e.users.map((e=>e.contact)).sort(this.sortObjectByProperty("dbId")),r))&&(i=e,this.logger.debug("[roomService] getOrCreateRoomWithContacts - Found Room "+e.getNameForLogs()),true))),i)return t.length&&await this.addRoomUsers(i,null,t),i;const n=await this.retrieveRoomConsumption();if(n>this.profileService.getFeatureLimitMax(this.profileService.FeaturesEnum.BUBBLE_COUNT))return this.mainService.showGlobalPopupMessage({popupTitle:"createBubble",popupBody:"maxCollabSpaceReached",okLabel:"ok"}),null;const s=this.contactService.userContact.initials+" "+this.i18n.translate("new")+" "+this.i18n.translate("bubble")+" ",o=this.getMyRooms().filter((e=>e&&0===e.name.indexOf(s)));let a=null,c=1;for(;!a;){const e=s+c.toString();o.sort(this.sortObjectByProperty("name")).some((t=>t&&t.name===e))||(a=e),c++}return await this.createRoomWithContacts(a,"",e,t)}catch(i){throw this.logger.error("[roomService] getOrCreateRoomWithContacts failure"),i}}async createRoomWithContacts(e,t,i,r){try{const n=await this.createRoom(e,t,true,null,true,null,true);return await this.addRoomUsers(n,i,r),n}catch(n){const e=n&&n.message?"createRoomWithContacts failure: "+n.message:"createRoomWithContacts failure";throw this.logger.error("[roomService] "+e),n&&n.errorDetailsLabel?n:new Error(e)}}async setAvatarRoom(e,t,i=512,r=512){if(!t)return e;try{const n=await o.resizeImage(t,i,r),s=o.getBinaryData(n);let a=`${this.portalURL}rooms/${e.id}/avatar`;"webinar"===this.context&&(a+="?context=webinar");const c=this.authService.getPostHeader("image/"+s.type),l=await fetch(a,{method:"POST",headers:c,body:s.data});if(!l.ok)throw l;return await l.json(),this.logger.info("[roomService] setAvatarRoom -- SUCCESS"),e.avatar=`${config.restServerUrl}/api/room-avatar/${e.id}?size=512&rand=${v.default()}`,e}catch(n){const e=await this.errorHelperService.getErrorInfo(n,"setAvatarRoom");throw this.logger.error("[roomService] "+e.message),e.error}}async deleteAvatarRoom(e){let t=`${this.portalURL}rooms/${e}/avatar`;"webinar"===this.context&&(t+="?context=webinar");const i=this.authService.getRequestHeader(),r=await fetch(t,{method:"DELETE",headers:i});if(!r.ok)throw r;this.logger.info("[roomService] avatar room sucessfully deleted")}async pushContactInRoom(e,t){try{const i=await this.contactService.getContactByDBId(e.userId);t.users.push({contact:i,status:e.status,date:new Date(e.additionDate),privilege:e.privilege}),this.contactService.isUserContact(i)&&(t.status=e.status),this.logger.info("[roomService] pushContactInRoom success")}catch(i){this.logger.info("[roomService] pushContactInRoom failure : "+i.message)}}async addRoomUser(e,t,i=null,n=null,s=false){try{if(e.users.some((e=>(e.status===this.RoomUserStatus.INVITED||e.status===this.RoomUserStatus.ACCEPTED||e.status===this.RoomUserStatus.REJECTED)&&e.contact.dbId===t.dbId)))return this.logger.debug(`[roomService] user: ${t.dbId} already invited or accepted, will not be added`),e;if(e.users.filter((e=>e.status!==this.RoomUserStatus.DELETED)).length>=this.maxRoomsUsers){const e=new Error("addRoomUser failure - Not Allowed : Participants max limit has been reached: "+this.maxRoomsUsers);throw e.status=e.errorDetailsCode="403",e.errorDetailsLabel="MaximumNumberRoomUsersReach",e.errorDetailsCode="403620",this.logger.error("[roomService] "+e.message),e}const o="boolean"==typeof s&&s?this.RoomUserStatus.ACCEPTED:this.RoomUserStatus.INVITED,a=i||"JustForFun",c=n||r.Room.Privilege.USER,l=`${this.portalURL}rooms/${e.dbId}/users`,d=this.authService.getPostHeader(),u=JSON.stringify({userId:t.dbId,privilege:c,reason:a,status:o}),h=await fetch(l,{method:"POST",headers:d,body:u});if(!h.ok)throw h;this.logger.info(`[roomService] addRoomUser ${t.nameForLogs} to room ${e.dbId} (${e.getNameForLogs()}) success`);const f=(await h.json()).data,p=e.getUserByJid(f.jid_im);return p?(p.status=f.status,p.date=new Date,p.privilege=f.privilege):e.users.push({contact:t,status:o,date:new Date,privilege:c}),this.refreshMemberAndOrganizerLists(e),this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e),e}catch(o){const e=await this.errorHelperService.getErrorInfo(o,"addRoomUser");throw this.logger.error("[roomService] "+e.message),e.error}}async addRoomUsers(e,t,i=null){try{const r=[];t.forEach((t=>{e.users.some((i=>{if(i.contact.dbId===t.dbId){switch(i.status){case this.RoomUserStatus.REJECTED:case this.RoomUserStatus.UNSUBSCRIBED:r.push(this.ownerReinviteRejectedUser(e,t));break;case this.RoomUserStatus.DELETED:r.push(this.ownerReinviteDeletedUser(e,t))}return true}return false}))||r.push(this.addRoomUser(e,t))})),await Promise.all(r),this.logger.info("[roomService] addRoomUsers success"),this.eventService.publish(this.ROOM_ADD_USERS_EVENT,e),await this.inviteGuestEmailToJoinRoom(e,i)}catch(r){const e="addRoomUsers failure: "+r.message;throw this.logger.error("[roomService] "+e),r}}async deleteRoomUsers(e,t){try{const i=[];return t.forEach((t=>{e.users.some((e=>e.contact.dbId===t.dbId))&&i.push(this.ownerDeletesUserFromRoom(e,t))})),await Promise.all(i),this.logger.info("[roomService] deleteRoomUsers success"),this.eventService.publish(this.ROOM_DELETE_USERS_EVENT,e),e}catch(i){const e="deleteRoomUsers failure: "+i.message;throw this.logger.error("[roomService] "+e),new Error(e)}}async addRoomAndroidTVs(e,t){try{const i=[];return t.forEach((t=>{null!==t&&i.push(this.addRoomAndroidTV(e,t))})),await Promise.all(i),this.logger.info("[roomService] addRoomAndroidTVs success"),this.eventService.publish(this.ROOM_ADD_USERS_EVENT,e),e}catch(i){const e="addRoomAndroidTVs failure: "+i.message;throw this.logger.error("[roomService] "+e),new Error(e)}}async addRoomAndroidTV(e,t){try{const i="androidtv",r="moderator",n="accepted",s=`${this.portalURL}rooms/${e.dbId}/users`,o=this.authService.getPostHeader(),a=JSON.stringify({userId:t.dbId,privilege:r,reason:i,status:n}),c=await fetch(s,{method:"POST",headers:o,body:a});if(!c.ok)throw c;this.logger.info(`[roomService] addRoomAndroidTV ${t.nameForLog} to room ${e.dbId} (${e.getNameForLogs()}) success`);const l=(await c.json()).data,d=e.getUserByJid(l.jid_im);return d?(d.status=l.status,d.date=new Date,d.privilege=l.privilege):e.users.push({contact:t,status:n,date:new Date,privilege:r}),this.refreshMemberAndOrganizerLists(e),this.eventService.publish(this.ROOM_UPDATE_EVENT,e),e}catch(i){if(i.data&&i.data.errorDetails){const r=`addRoomAndroidTV ${t.nameForLog} to room ${e.dbId} (${e.getNameForLogs()}) failure: ${i.data.errorDetails}`;throw this.logger.error("[roomService] "+r),new Error(r)}const r=await this.errorHelperService.getErrorInfo(i,"addRoomAndroidTV");throw this.logger.error("[roomService] "+r.message),r.error}}sendInitialPresenceForAllRooms(){Object.keys(this.rooms).forEach((e=>{const t=this.rooms[e];t&&!t.initPresPromise&&!t.initPresenceAck&&"accepted"===t.status&&t.isActive&&this.roomPresenceWaitingList.push(t)})),this.sendInitialPresenceForRoomsByParts(15)}allSettled(e){const t=e.map((e=>Promise.resolve(e).then((e=>({status:"fulfilled",value:e})),(e=>({status:"rejected",reason:e})))));return Promise.all(t)}sendInitialPresenceForRoomsByParts(e=10,t=false){if(!this.roomPresenceWaitingList||!this.roomPresenceWaitingList.length)return;this.logger.info("[roomService] sendInitialPresenceForRoomsByParts");const i=this.roomPresenceWaitingList.length,r=[],n=t?3e4:7500;for(let s=0;s<e;s++)this.roomPresenceWaitingList[s]&&r.push(this.sendInitialRoomPresenceSync(this.roomPresenceWaitingList[s],n));r.length&&this.allSettled(r).then((()=>{this.logger.info("[roomService] sendInitialPresenceForRoomsByParts -- done for group -- presences remaining "+this.roomPresenceWaitingList.length);const e=i===this.roomPresenceWaitingList.length;this.sendInitialPresenceForRoomsByParts(15,e)}))}sendInitialRoomPresence(e,t=0){const i=t?" -- attempt "+t:"";this.logger.info("[roomService] sendInitialRoomPresence "+i+" -- "+e.getNameForLogs()+" -- "+e.dbId);const r=$pres({to:e.jid+"/"+this.xmppService.fullJid});r.c("x",{xmlns:"http://jabber.org/protocol/muc"}).c("history",{maxchars:"0"}),this.xmppService.send(r)}sendInitialRoomPresenceSync(e,t=7500){return e.initPresPromise?e.initPresPromise:e.initPresenceAck?(this.logger.info(`[roomService] sendInitialRoomPresenceSync -- ${e.getNameForLogs()} -- ${e.dbId} -- room already activated`),this.roomPresenceWaitingList&&this.roomPresenceWaitingList.length&&this.roomPresenceWaitingList.forEach(((t,i)=>{t.dbId===e.dbId&&this.roomPresenceWaitingList.splice(i,1)})),Promise.resolve()):(e.initPresPromise=new Promise(((i,r)=>{e.initPresPromiseResolve=i,this.sendInitialRoomPresence(e,0);let n=0;e.initPresInterval=a.interval(t).subscribe((()=>{n<3?(n+=1,this.sendInitialRoomPresence(e,n)):(this.logger.error("[roomService] sendInitialRoomPresenceSync : no response after "+n+" retries => clean presence promise and interval for "+e.getNameForLogs()+" -- "+e.jid),r("[roomService] sendInitialRoomPresenceSync : no response"),e.initPresPromise=null,e.initPresInterval&&(e.initPresInterval.unsubscribe(),e.initPresInterval=null),e=this.rooms[e.dbId],this.eventService.publish(this.ROOM_UPDATE_EVENT,e))}))})),e.initPresPromise)}sendUnavailableRoomPresence(e){const t=$pres({to:e.jid+"/"+this.contactService.userContact.jid,type:"unavailable"});t.c("x",{xmlns:"http://jabber.org/protocol/muc"}),this.xmppService.send(t)}sendAvailableRoomPresence(e){const t=$pres({to:e.jid+"/"+this.contactService.userContact.jid,type:"available"});t.c("x",{xmlns:"http://jabber.org/protocol/muc"}),this.xmppService.send(t)}async createRoom(e,t,i,n,s=true,o=null,a=null,c=false,l=false,d=false,u=true){const h=e.charAt(0)+"***"+e.slice(-1);try{this.logger.info('[roomService] createRoom "'+h+'"'),(void 0===s||s&&"boolean"!=typeof s)&&(s=true);const p={name:e,topic:t,history:i?"all":"none",disableNotifications:s,mediaType:null,createConversation:a=a||"true",autoAcceptInvitation:Boolean(c),muteUponEntry:l,disableTimeStats:false,playEntryTone:u};o&&(p.mediaType=o),d&&(p.disableTimeStats=d);const g=this.portalURL+"rooms/",m=this.authService.getPostHeader(),v=JSON.stringify(p),S=await fetch(g,{method:"POST",headers:m,body:v});if(!S.ok)throw S;const b=(await S.json()).data;try{await this.setAvatarRoom(b,n)}catch(f){this.logger.error("[roomService] createRoom: setAvatarRoom ERROR")}if(this.rooms[b.id])return this.logger.info('[roomService] createRoom -- room "'+h+'" already exists'),this.rooms[b.id];const y=r.Room.create(b.id,b.jid,b.name,b.topic,b.creationDate,b.confEndpoints,b.history,b.customData,b.conference,b.avatar,b.isActive,b.lastActivityDate,b.autoRegister,b.autoAcceptInvitation,b.tags,b.containerId,b.containerName,b.isOwnedByGroup,b.isAlertNotificationEnabled);return y.ownerContact=this.contactService.userContact,y.owner=true,y.isModerator=true,y.status="accepted",b.users.forEach((e=>{const t=this.contactService.getContactById(e.userId);t&&(y.users.push({contact:t,status:e.status,date:new Date(e.additionDate),privilege:e.privilege}),this.contactService.isUserContact(t)&&(y.status=e.status))})),this.refreshMemberAndOrganizerLists(y),this.rooms[y.dbId]=y,this.roomsByJids[y.jid]=y,this.logger.info('[roomService] createRoom "'+h+'" -- success'),await this.sendInitialRoomPresenceSync(y),this.rooms[y.dbId]}catch(f){const e=await this.errorHelperService.getErrorInfo(f,"getServerInvitation");throw this.logger.error("[invitationService] "+e.message),e.error}}async updateRoomUser(e,t,i=null,r=null){try{const n={status:void 0,privilege:void 0};i&&(n.status=i),r&&(n.privilege=r);const s=`${this.portalURL}rooms/${e.dbId}/users/${t.dbId}`,o=this.authService.getPostHeader(),a=JSON.stringify(n),c=await fetch(s,{method:"PUT",headers:o,body:a});if(!c.ok)throw c;this.logger.info(`[roomService] updateRoomUser ${t.nameForLogs} to room ${e.dbId} (${e.getNameForLogs()}) success`);const l=(await c.json()).data;return e.users.forEach((e=>{e.contact.jid===l.jid_im&&(e.privilege=l.privilege,e.status=l.status)})),this.refreshMemberAndOrganizerLists(e),this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e),e}catch(n){if(n.data&&n.data.errorDetails){const i="updateRoomUser "+t.nameForLogs+" to room "+e.dbId+"("+e.getNameForLogs()+") failure: "+n.data.errorDetails;throw this.logger.error("[roomService] "+i),new Error(i)}const i=await this.errorHelperService.getErrorInfo(n,"updateRoomUser");throw this.logger.error("[roomService] "+i.message),i.error}}async ownerArchiveRoom(e){this.logger.info("[roomService] ownerArchiveRoom");try{const t=`${this.portalURL}rooms/${e.dbId}/archive`,i=this.authService.getPostHeader(),r=JSON.stringify({}),n=await fetch(t,{method:"PUT",headers:i,body:r});if(!n.ok)throw n;const s=(await n.json()).data.users;e.users.forEach((e=>{const t=s.find((t=>e.contact.jid===t.jid_im));t&&(e.privilege=t.privilege,e.status=t.status)})),this.refreshMemberAndOrganizerLists(e),this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e),this.logger.info("[roomService] unsubscribe all users successfully"),this.logger.info("[roomService] ownerArchiveRoom successfully")}catch(t){this.logger.error("[roomService] ownerArchiveRoom failure "+t.message)}}unsubscribeUserFromRoom(e,t){return this.updateRoomUser(e,t,this.RoomUserStatus.UNSUBSCRIBED)}async ownerDeletesUserFromRoom(e,t){try{this.logger.info("[roomService] ownerDeletesUserFromRoom");const i=`${this.portalURL}rooms/${e.dbId}/users/${t.dbId}`,r=this.authService.getRequestHeader(),n=await fetch(i,{method:"DELETE",headers:r});if(!n.ok)throw n;this.logger.info(`[roomService] ownerDeletesUserFromRoom ${t.dbId} from room ${e.dbId} (${e.getNameForLogs()}) success`);return e.getUserByJid(t.jid).status="deleted",this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e),e}catch(i){if(i.data&&i.data.errorDetails){const r="ownerDeletesUserFromRoom "+t.dbId+" from room "+e.dbId+"("+e.getNameForLogs()+") failure: "+i.data.errorDetails;throw this.logger.error("[roomService] "+r),new Error(r)}const r=await this.errorHelperService.getErrorInfo(i,"ownerDeletesUserFromRoom");throw this.logger.error("[roomService] "+r.message),r.error}}async ownerReinviteRejectedUser(e,t,i=null,r=null,n=false){try{return await this.ownerDeletesUserFromRoom(e,t),await this.addRoomUser(e,t,i,r,n),this.logger.info("[roomService] ownerReinviteRejectedUser "+t.dbId+" from room "+e.dbId+"("+e.getNameForLogs()+") success"),e}catch(s){const e="ownerReinviteRejectedUser failure: "+s.message;throw this.logger.error("[roomService] "+e),new Error(e)}}async ownerReinviteDeletedUser(e,t,i=null,r=null,n=false){try{return await this.addRoomUser(e,t,i,r,n),this.logger.info("[roomService] ownerReinviteDeletedUser "+t.dbId+" from room "+e.dbId+"("+e.getNameForLogs()+") success"),e}catch(s){const e="ownerReinviteDeletedUser failure: "+s.message;throw this.logger.error("[roomService] "+e),new Error(e)}}getInvitingUser(e){const t=this.contactService.userContact.dbId;let i=null;e.users.forEach((e=>{e.contact.dbId===t&&(i=e.invitingUserId)}));return i?this.contactService.getContactById(i):e.ownerContact}async ownerDeleteRoom(e){const t=e.dbId;try{if(!t)return this.logger.error("[roomService] ownerDeleteRoom failure because the roomId is empty ..."),null;const i=`${this.portalURL}rooms/${t}`,r=this.authService.getRequestHeader(),n=await fetch(i,{method:"DELETE",headers:r});if(!n.ok)throw n;return this.logger.info("[roomService] ownerDeleteRoom "+e.dbId+"("+e.getNameForLogs()+") success"),delete this.rooms[e.dbId],this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e),e.rxSubject.next(void 0),e}catch(i){let r="ownerDeleteRoom ("+t+") failure: unknown error occurred";if(i&&i.data&&(r="ownerDeleteRoom ("+t+") failure: "+i.data.errorDetails),i&&404===i.status)this.logger.info("[roomService] ownerDeleteRoom "+e.dbId+"("+e.getNameForLogs()+") not found, deleting it from local storage"),delete this.rooms[e.dbId],this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e);else{if(409111===(await i.json()).errorDetailsCode)return this.logger.info("[roomService] ownerDeleteRoom -- failed -- we should activate and delete it again -- "+e.dbId+"("+e.getNameForLogs()+")"),this.activateAndDeleteBubble(e)}throw this.logger.error("[roomService] "+r),new Error(r)}}async activateAndDeleteBubble(e){this.sendInitialRoomPresenceSync(e),setTimeout((async()=>{const t=e.dbId;try{if(!t)return void this.logger.error("[roomService] ownerDeleteRoom failure because the roomId is empty ...");const i=`${this.portalURL}rooms/${t}`,r=this.authService.getRequestHeader(),n=await fetch(i,{method:"DELETE",headers:r});if(!n.ok)throw n;this.logger.info("[roomService] ownerDeleteRoom "+e.dbId+"("+e.getNameForLogs()+") success"),delete this.rooms[e.dbId],this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e),e.rxSubject.next(void 0)}catch(i){const t=(await i.json()).errorDetailsCode;this.logger.error("[roomService] ownerDeleteRoom "+e.dbId+"("+e.getNameForLogs()+") -- delete failure -- "+t)}}),2e3)}async ownerUpdateRoom(e){try{this.logger.info("[roomService] ownerUpdateRoom");const t=`${this.portalURL}rooms/${e.dbId}`,i=this.authService.getPostHeader(),n=JSON.stringify({name:e.name,topic:e.desc,visibility:e.type?"public":"private"}),s=await fetch(t,{method:"PUT",headers:i,body:n});if(!s.ok)throw s;const o=(await s.json()).data;return this.rooms[o.id].desc=o.topic,this.rooms[o.id].type="private"===o.visibility?r.Room.Type.PRIVATE:r.Room.Type.PUBLIC,this.logger.info("[roomService] ownerUpdateRoom successfully ("+o.id+", "+o.jid+")"),this.rooms[o.id]}catch(t){const e="ownerUpdateRoom failure: "+t.data.errorDetails;throw this.logger.error("[roomService] "+e),new Error(e)}}async checkPromoteOwner(e,t){try{const i=`${this.portalURL}rooms/${e.dbId}/owners/${t.dbId}/check`,r=this.authService.getPostHeader(),n=await fetch(i,{method:"GET",headers:r});if(!n.ok)throw n;this.logger.info("[roomService] checkPromoteOwner "+t.nameForLogs+" to room "+e.dbId+"("+e.getNameForLogs()+") success")}catch(i){const e=await i.json();this.logger.error("[roomService] Error checkPromoteOwner");const r=e.errorDetailsCode;let n=null,s=null,o=null;const a={name:"RainbowError",message:""};throw 409002===r&&e.errorDetailsData&&(Array.isArray(e.errorDetailsData)?(e.errorDetailsData.forEach((e=>{"BUBBLE_PARTICIPANT_COUNT"===e.feature?n=this.i18n.translate("promoteToOwnerFailureParticipantCountReached",{name:t.displayName,maxValue:e.maxValue}):"WEBRTC_CONFERENCE_ALLOWED"===e.feature?o=this.i18n.translate("promoteToOwnerFailureWebRtcConferenceAllowed",{name:t.displayName}):"BUBBLE_PROMOTE_MEMBER"===e.feature&&(s=this.i18n.translate("promoteToOwnerFailureBubblePromoteMember",{name:t.displayName}))})),n?(a.message=n,a.details={promotePossible:false}):o?(a.message=this.i18n.translate("promoteOrganizerToOwnerMsg",{name:t.displayName}),a.details={promotePossible:true,secondMessage:o}):s&&(a.message=this.i18n.translate("promoteOrganizerToOwnerMsg",{name:t.displayName}),a.details={promotePossible:true,secondMessage:s})):(a.message=this.i18n.translate("promoteToOwnerFailureNotInRoom",{name:t.displayName}),a.details={promotePossible:false})),a}}getCheckPromoteErrorMsg(e,t){let i="";return e&&e.errorDetailsData&&e.errorDetailsData.length>0&&e.errorDetailsData.every((e=>"BUBBLE_PARTICIPANT_COUNT"===e.feature&&(i=this.i18n.translate("promoteToOwnerFailureParticipantCountReached",{name:t.displayName}),true))),i}async changeRoomOwner(e,t){try{if(this.logger.info("[roomService] changeRoomOwner"),!e||!t){const e="changeRoomOwner error: - missing room or new owner";throw this.logger.error("[roomService] "+e),new Error(e)}const i=e.confEndpoints&&e.confEndpoints.length?e.confEndpoints[0].confEndpointId:"";await this.deleteRoomConferenceEndPoint(e,i);const r=`${this.portalURL}rooms/${e.dbId}`,n=this.authService.getPostHeader(),s=JSON.stringify({owner:t.dbId}),o=await fetch(r,{method:"PUT",headers:n,body:s});if(!o.ok)throw o;return e.ownerContact=t,e.owner=t.jid===this.contactService.userContact.jid,this.logger.info("[roomService] changeRoomOwner successfully ("+e.dbId+")"),this.rooms[e.dbId]}catch(i){if(i.data&&i.data.errorDetails){const e="changeRoomOwner failure: "+i.data.errorDetails;throw this.logger.error("[roomService] "+e),new Error(e)}const e=await this.errorHelperService.getErrorInfo(i,"changeRoomOwner");throw this.logger.error("[roomService] "+e.message),e.error}}async ownerUpdateRoomCustomData(e){try{this.logger.info("[roomService] ownerUpdateRoomCustomData");const t=`${this.portalURL}rooms/${e.dbId}/custom-data`,i=this.authService.getPostHeader(),r=JSON.stringify({customData:e.customData}),n=await fetch(t,{method:"PUT",headers:i,body:r});if(!n.ok)throw n;const s=(await n.json()).data;return this.logger.info("[roomService] ownerUpdateRoomCustomData successfully got ("+JSON.stringify(s,null,4)+")"),s.customData||{}}catch(t){if(t.data&&t.data.errorDetails){const e="ownerUpdateRoomCustomData failure: "+t.data.errorDetails;throw this.logger.error("[roomService] "+e),new Error(e)}const e=await this.errorHelperService.getErrorInfo(t,"ownerUpdateRoomCustomData");throw this.logger.error("[roomService] "+e.message),e.error}}async ownerUpdateRoomNameAndDescription(e){try{this.logger.info("[roomService] ownerUpdateRoomNameAndDescription");const t=`${this.portalURL}rooms/${e.dbId}`,i=this.authService.getPostHeader(),n=JSON.stringify({name:e.name,topic:e.desc,visibility:e.type?"public":"private"}),s=await fetch(t,{method:"PUT",headers:i,body:n});if(!s.ok)throw s;const o=(await s.json()).data;return this.rooms[o.id].desc=o.topic,this.rooms[o.id].type="private"===o.visibility?r.Room.Type.PRIVATE:r.Room.Type.PUBLIC,(o.conference||o.confEndpoints)&&(this.rooms[o.id].conference=o.conference?o.conference:null,this.rooms[o.id].confEndpoints=o.confEndpoints?o.confEndpoints:[]),this.logger.info("[roomService] ownerUpdateRoomNameAndDescription successfully ("+o.id+", "+o.jid+")"),this.rooms[o.id]}catch(t){if(t.data&&t.data.errorDetails){const e="ownerUpdateRoomNameAndDescription failure: "+t.data.errorDetails;this.logger.error("[roomService] "+e)}const e=await this.errorHelperService.getErrorInfo(t,"ownerUpdateRoomNameAndDescription");throw this.logger.error("[roomService] "+e.message),e.error}}async ownerUpdateAutoRegister(e){try{this.logger.info("[roomService] ownerUpdateAutoRegister");const t=`${this.portalURL}rooms/${e.dbId}`,i=this.authService.getPostHeader(),n=JSON.stringify({autoRegister:e.getAutoRegister()}),s=await fetch(t,{method:"PUT",headers:i,body:n});if(!s.ok)throw s;const o=(await s.json()).data;return this.rooms[o.id].setAutoRegister(o.autoRegister),this.rooms[o.id].desc=o.topic,this.rooms[o.id].type="private"===o.visibility?r.Room.Type.PRIVATE:r.Room.Type.PUBLIC,(o.conference||o.confEndpoints)&&(this.rooms[o.id].conference=o.conference?o.conference:null,this.rooms[o.id].confEndpoints=o.confEndpoints?o.confEndpoints:[]),this.logger.info("[roomService] ownerUpdateAutoRegister successfully ("+o.id+", "+o.jid+")"),this.rooms[o.id]}catch(t){if(t.data&&t.data.errorDetails){const e="ownerUpdateAutoRegister failure: "+t.data.errorDetails;throw this.logger.error("[roomService] "+e),new Error(e)}const e=await this.errorHelperService.getErrorInfo(t,"ownerUpdateAutoRegister");throw this.logger.error("[roomService] "+e.message),e.error}}async moderatorUpdateRoomConfig(e){try{this.logger.info("[roomService] moderatorUpdateRoomConfig");const t=`${this.portalURL}rooms/${e.dbId}`,i=this.authService.getPostHeader(),n=JSON.stringify({name:e.name,topic:e.desc,visibility:e.type?"public":"private",muteUponEntry:e.getMuteUponEntry(),disableTimeStats:e.getDisableTimeStats(),playEntryTone:e.getPlayEntryTone()}),s=await fetch(t,{method:"PUT",headers:i,body:n});if(!s.ok)throw s;const o=(await s.json()).data;return this.rooms[o.id].desc=o.topic,this.rooms[o.id].type="private"===o.visibility?r.Room.Type.PRIVATE:r.Room.Type.PUBLIC,(o.conference||o.confEndpoints)&&(this.rooms[o.id].conference=o.conference?o.conference:null,this.rooms[o.id].confEndpoints=o.confEndpoints?o.confEndpoints:[]),this.logger.info("[roomService] moderatorUpdateRoomConfig successfully ("+o.id+", "+o.jid+")"),this.rooms[o.id]}catch(t){if(t.data&&t.data.errorDetails){const e="moderatorUpdateRoomConfig failure: "+t.data.errorDetails;throw this.logger.error("[roomService] "+e),new Error(e)}const e=await this.errorHelperService.getErrorInfo(t,"moderatorUpdateRoomConfig");throw this.logger.error("[roomService] "+e.message),e.error}}async updateRoomPhoneNumbers(e,t=[]){try{this.logger.info("[roomService] updateRoomPhoneNumbers");const i=`${this.portalURL}rooms/${e}`,r=this.authService.getPostHeader(),n=JSON.stringify({phoneNumbers:t}),s=await fetch(i,{method:"PUT",headers:r,body:n});if(!s.ok)throw s;const o=(await s.json()).data;return o.conference&&o.conference.phoneNumbers&&o.conference.phoneNumbers.length&&(this.rooms[o.id].conference.phoneNumbers=o.conference.phoneNumbers?o.conference.phoneNumbers:[]),this.logger.info("[roomService] updateRoomPhoneNumbers successfully ("+o.id+", "+o.jid+")"),this.rooms[o.id]}catch(i){if(i.data&&i.data.errorDetails){const e="updateRoomPhoneNumbers failure: "+i.data.errorDetails;throw this.logger.error("[roomService] "+e),new Error(e)}const e=await this.errorHelperService.getErrorInfo(i,"updateRoomPhoneNumbers");throw this.logger.error("[roomService] "+e.message),e.error}}async updateIncludeAllPhoneNumbers(e,t){try{this.logger.info("[roomService] updateIncludeAllPhoneNumbers");const i=`${this.portalURL}rooms/${e}`,r=this.authService.getPostHeader(),n=JSON.stringify({includeAllPhoneNumbers:t}),s=await fetch(i,{method:"PUT",headers:r,body:n});if(!s.ok)throw s;const o=(await s.json()).data;return this.logger.info("[roomService] updateRoomPhoneNumbers successfully ("+o.id+", "+o.jid+")"),this.rooms[o.id]}catch(i){if(i.data&&i.data.errorDetails){const e="updateIncludeAllPhoneNumbers failure: "+i.data.errorDetails;throw this.logger.error("[roomService] "+e),new Error(e)}const e=await this.errorHelperService.getErrorInfo(i,"updateIncludeAllPhoneNumbers");throw this.logger.error("[roomService] "+e.message),e.error}}async updateMyRoomUser(e,t){try{let i=`${this.portalURL}rooms/${e.dbId}/users/${this.contactService.userContact.dbId}`;"webinar"===this.context&&(i+="?context=webinar");const r=this.authService.getPostHeader(),n=JSON.stringify({status:t}),s=await fetch(i,{method:"PUT",headers:r,body:n});if(!s.ok)throw s;return this.logger.info("[roomService] updateMyRoomUser "+this.contactService.userContact.nameForLogs+" to room "+e.dbId+"("+e.getNameForLogs()+") success"),e}catch(i){if(i.data&&i.data.errorDetails){const t="updateMyRoomUser "+this.contactService.userContact.nameForLogs+" to room "+e.dbId+"("+e.getNameForLogs()+") failure: "+i.data.errorDetails;throw this.logger.error("[roomService] "+t),new Error(t)}const t=await this.errorHelperService.getErrorInfo(i,"updateMyRoomUser");throw this.logger.error("[roomService] "+t.message),t.error}}unsubscribeMeFromRoom(e){return this.updateMyRoomUser(e,this.RoomUserStatus.UNSUBSCRIBED)}async participantCloseRoom(e){const t=this.contactService.userContact.dbId;try{this.logger.info("[roomService] participantCloseRoom");const i=`${this.portalURL}rooms/${e.dbId}/users/${t}`,r=this.authService.getRequestHeader(),n=await fetch(i,{method:"DELETE",headers:r});if(!n.ok)throw n;return this.logger.info("[roomService] participantCloseRoom "+t+" from room "+e.dbId+"("+e.getNameForLogs()+") success"),delete this.rooms[e.dbId],this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e),e}catch(i){if(i.data&&i.data.errorDetails){const r="participantCloseRoom "+t+" from room "+e.dbId+"("+e.getNameForLogs()+") failure: "+i.data.errorDetails;throw this.logger.error("[roomService] "+r),new Error(r)}const r=await this.errorHelperService.getErrorInfo(i,"participantCloseRoom");throw this.logger.error("[roomService] "+r.message),r.error}}acceptRoomInvitation(e){return this.updateMyRoomUser(e,this.RoomUserStatus.ACCEPTED)}declineRoomInvitation(e){return this.updateMyRoomUser(e,this.RoomUserStatus.REJECTED)}async getRoomConferenceEndPoint(e,t){try{this.logger.info("[roomService] getRoomConferenceEndPoint");const i=`${this.portalURL}rooms/${e.dbId}/conference/${t}`,r=this.authService.getRequestHeader(),n=await fetch(i,{method:"GET",headers:r});if(!n.ok)throw n;const s=(await n.json()).data;return this.logger.info("[roomService] getRoomConferenceEndPoint "+t+" from room "+e.dbId+"success"),s}catch(i){if(i.data&&i.data.errorDetails){const r="getRoomConferenceEndPoint "+t+" from room "+e.dbId+"failure: "+i.data.errorDetails;throw this.logger.error("[roomService] "+r),new Error(r)}const r=await this.errorHelperService.getErrorInfo(i,"getRoomConferenceEndPoint");throw this.logger.error("[roomService] "+r.message),r.error}}async addRoomConferenceEndPoint(e,t,i,r){try{if(this.logger.info("[roomService] addRoomConferenceEndPoint"),!t)throw new Error("No ConferenceEndPoint to associate with Room");let n=false;if(e.confEndpoints.forEach((e=>{e.confEndpointId===t.id&&(n=true)})),n)return this.logger.info("[roomService] addRoomConferenceEndPoint : already attached to room !"),e;const s=[];i&&"pstnAudio"===i&&Object.keys(this.rooms).forEach((e=>{this.rooms[e].conference&&!this.rooms[e].conference.scheduled&&this.rooms[e].getPstnConfEndpointId()===t.id&&s.push(this.deleteRoomConferenceEndPoint(this.rooms[e],t.id))})),await Promise.all(s);const o=`${this.portalURL}rooms/${e.dbId}/conferences`,a=this.authService.getPostHeader(),c=JSON.stringify({confId:t.id,createConversation:r||"true"}),l=await fetch(o,{method:"POST",headers:a,body:c});if(!l.ok)throw l;const d=(await l.json()).data;return this.logger.debug("[roomService] addRoomConferenceEndPoint response data:"+JSON.stringify(d)),e.confEndpoints.push(d),this.logger.info("[roomService] addRoomConferenceEndPoint "+t.id+" to room "+e.dbId+"success"),this.eventService.publish(this.ROOM_ADD_CONF_ENDPOINT_EVENT,e),this.sendEvent("ROOM_ADD_CONF_ENDPOINT_EVENT",e),e}catch(n){const e=await this.errorHelperService.getErrorInfo(n,"addRoomConferenceEndPoint");throw this.logger.error("[roomService] "+e.message),e.error}}async deleteRoomConferenceEndPoint(e,t){try{if(this.logger.info("[roomService] deleteRoomConferenceEndPoint"),!e||!t)return void this.logger.info("[roomService] deleteRoomConferenceEndPoint : missing parameters ");let i=false;if(e.confEndpoints&&e.confEndpoints.length){for(let r=0;r<e.confEndpoints.length;r++)if(e.confEndpoints[r].confEndpointId===t){i=true;break}}if(!i)return void this.logger.info("[roomService] deleteRoomConferenceEndPoint : room has no such conference attached");const r=`${this.portalURL}rooms/${e.dbId}/conferences/${t}`,n=this.authService.getRequestHeader(),s=await fetch(r,{method:"DELETE",headers:n});if(!s.ok)throw s;e.confEndpoints=(await s.json()).data,this.logger.info("[roomService] deleteRoomConferenceEndPoint "+t+" from room "+e.dbId+"success"),this.eventService.publish(this.ROOM_REMOVE_CONF_ENDPOINT_EVENT,e),this.sendEvent("ROOM_REMOVE_CONF_ENDPOINT_EVENT",e)}catch(i){const r=(await i.json()).data,n="deleteRoomConferenceEndPoint "+t+" from room "+e.dbId+"failure: "+r.errorDetails;if(this.logger.error("[roomService] "+n),404!==i.status)throw new Error(n);e.confEndpoints=[],this.eventService.publish(this.ROOM_REMOVE_CONF_ENDPOINT_EVENT,e),this.sendEvent("ROOM_REMOVE_CONF_ENDPOINT_EVENT",e)}}async inviteGuestEmailToJoinRoom(e,t){try{if(!t||!t.length)return null;this.logger.info("[roomService] inviteGuestEmailToJoinRoom");const i=`${this.portalURL}rooms/${e.dbId}/invitations`,r=this.authService.getPostHeader(),n=JSON.stringify({scenario:"chat",emails:t,lang:this.getLanguageWithIsoCode()}),s=await fetch(i,{method:"POST",headers:r,body:n});if(!s.ok)throw s;const o=await s.json();if(this.logger.info("[roomService] myBody = "+o),o.data&&o.data.failed&&o.data.failed.invalidUsers.length){const e=o.data.failed.invalidUsers[0].errorDetailsCode,t=this.errorHelperService.getLocalizedError(e,null,null);throw this.logger.error("[roomService] "+t),new Error(t)}return this.eventService.publish("ROOM_UPDATE_EVENT",e),e}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"inviteGuestEmailToJoinRoom");throw this.logger.error("[roomService] "+e.message),e.error}}async ownerCancelGuestFromRoom(e,t){try{if(this.logger.info("[roomService] ownerCancelGuestFromRoom"),!t||!t.length)return Promise.resolve(e);const i={emails:t,scenario:"chat",lang:this.getLanguageWithIsoCode()};e&&e.isMyPersonalMeetingRoom()&&e.getPstnConfEndpointId()&&(i.scenario="pstn-conference",i.confId=e.getPstnConfEndpointId());const r=`${this.portalURL}rooms/${e.dbId}/invitations/cancel`,n=this.authService.getPostHeader(),s=JSON.stringify(i),o=await fetch(r,{method:"POST",headers:n,body:s});if(!o.ok)throw o;return e.guestEmails=(await o.json()).guestEmails,this.eventService.publish("ROOM_UPDATE_EVENT",e),e}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"ownerCancelGuestFromRoom");throw this.logger.error("[roomService] "+e.message),e.error}}async notifyRoomUsersJoinConference(e,t,i){const r=e.getPstnConfEndpointId();try{if(this.logger.info("[roomService] notifyRoomUsersJoinConference"),!r)return e;const n=e.desc,s={scenario:"pstn-conference",confId:r,noMail:"false",update:"false",users:t?t.map((e=>e.dbId)):void 0,emails:i,instantMessage:n,lang:this.getLanguageWithIsoCode()},o=`${this.portalURL}rooms/${e.dbId}/invitations`,a=this.authService.getPostHeader(),c=JSON.stringify(s),l=await fetch(o,{method:"POST",headers:a,body:c});if(!l.ok)throw l;return this.logger.info("[roomService] notifyRoomUsersJoinConference "+r+" from room "+e.dbId+"success"),this.rooms[e.dbId].guestEmails=i,this.eventService.publish("ROOM_UPDATE_EVENT",this.rooms[e.dbId]),this.rooms[e.dbId]}catch(n){if(n.data&&n.data.errorDetails){const t="notifyRoomUsersJoinConference "+r+" from room "+e.dbId+"failure: "+n.data.errorDetails;throw this.logger.error("[roomService] "+t),new Error(t)}const t=await this.errorHelperService.getErrorInfo(n,"notifyRoomUsersJoinConference");throw this.logger.error("[roomService] "+t.message),t.error}}async notifyUsersCancelConference(e,t,i){const r=e.getPstnConfEndpointId();try{if(this.logger.debug("[roomService] notifyUsersCancelConference"),!r)return e;const n={scenario:"pstn-conference",confId:r,noMail:"false",users:t?t.map((e=>e.dbId)):void 0,emails:i,lang:this.getLanguageWithIsoCode()},s=`${this.portalURL}rooms/${e.dbId}/invitations`,o=this.authService.getPostHeader(),a=JSON.stringify(n),c=await fetch(s,{method:"DELETE",headers:o,body:a});if(!c.ok)throw c;return this.logger.info("[roomService] notifyUsersCancelConference "+r+" from room "+e.dbId+"success"),this.rooms[e.dbId].guestEmails=this.rooms[e.dbId].guestEmails.filter((e=>-1===i.indexOf(e))),this.eventService.publish("ROOM_UPDATE_EVENT",this.rooms[e.dbId]),this.rooms[e.dbId]}catch(n){if(n.data&&n.data.errorDetails){const t="notifyUsersCancelConference "+r+" from room "+e.dbId+"failure: "+n.data.errorDetails;throw this.logger.error("[roomService] "+t),new Error(t)}const t=await this.errorHelperService.getErrorInfo(n,"notifyUsersCancelConference");throw this.logger.error("[roomService] "+t.message),t.error}}async getRoomByConferenceEndpointId(e){try{this.logger.info("[roomService] getRoomFromConferenceEndpointId");const t=`${this.portalURL}rooms?userId=${this.contactService.userContact.dbId}&confId=${e}&format=full`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;this.logger.info("[roomService] getRoomFromConferenceEndpointId -- "+e+" -- success");const n=(await r.json()).data;if(n.length)return this.getRoomById(n[0].id)||this.createRoomFromData(n[0]),this.getRoomById(n[0].id);throw this.logger.info("[roomService] getRoomFromConferenceEndpointId -- no room with confId "+e),new Error("no room with confId "+e)}catch(t){if(t.data&&t.data.errorDetails){const i="getRoomFromConferenceEndpointId -- "+e+" -- failure: "+t.data.errorDetails;throw this.logger.error("[roomService] "+i),new Error(i)}const i=await this.errorHelperService.getErrorInfo(t,"getRoomByConferenceEndpointId");throw this.logger.error("[roomService] "+i.message),i.error}}removeAnotherRoomWithSameConfEndpointId(e,t){e&&t&&Object.keys(this.rooms).forEach((i=>{const r=this.rooms[i];r&&!r.isMeetingRoom()&&r.confEndpoints.length&&"webrtc"===r.confEndpoints[0].mediaType&&r.confEndpoints[0].confEndpointId===e&&r.dbId!==t.dbId&&(r.confEndpoints=[],this.rooms[r.dbId]=r,this.roomsByJids[r.jid]=r,this.logger.info("[roomService] removeAnotherRoomWithSameConfEndpointId : conferenceRemove event for room "+r.dbId),this.eventService.publish("ROOM_REMOVE_CONF_ENDPOINT_EVENT",r),this.sendEvent("ROOM_REMOVE_CONF_ENDPOINT_EVENT",r),r.rxSubject.next(s.RBEvent.create("ROOM_REMOVE_CONF_ENDPOINT_EVENT")))}))}async onRoomMessage(e){this.logger.info("[roomService] onRoomMessage");try{const t=$(e).find("event");if(t.length>0){const e=t.attr("name");if("conferenceAdd"===e||"conferenceRemove"===e||"invitation"===e)return true}const i=$(e).find("x").attr("thread"),r=await this.getServerRoom(i);return r.isMeetingRoom()&&this.eventService.publish("MEETING_CREATED_EVENT",r),this.computeInvitationCounter(),this.eventService.publish(this.ROOM_INVITATION,r),this.eventService.publish(this.ROOM_UPDATE_EVENT,r),this.sendEvent(this.ROOM_UPDATE_EVENT,r),true}catch(t){return this.logger.error("[roomService] onRoomMessage error "+t),true}}onRoomErrorMessage(e){try{const t=$(e).find("text");if("Only occupants are allowed to send messages to the conference"===(t&&t.length?t.text():"")){this.logger.info("[roomService] onRoomErrorMessage error -- missing presence in the bubble, resend it");const t=$(e).attr("from"),i=this.getRoomByJid(t);i&&(i.initPresenceAck=false,this.sendInitialRoomPresenceSync(i),i.isActive=true,this.eventService.publish(this.ROOM_UPDATE_EVENT,i),this.sendEvent(this.ROOM_UPDATE_EVENT,i))}return true}catch(t){return true}}onRoomNotificationMessage(e){try{const t=$(e),i=t.find("x");if(t.find("event").length&&i.length){const e=t.find("event").attr("name");if(!e||"invitation"!==e)return true;const r=$(i[0]).attr("roomid");if(!r)return this.logger.info("[roomService] onRoomNotificationMessage error -- missing roomId"),true;this.logger.info("[roomService] onRoomNotificationMessage : room event message with roomId "+r+" and event name "+e),setTimeout((()=>{this.getServerRoom(r).then((e=>{e.isMeetingRoom()&&this.eventService.publish("MEETING_CREATED_EVENT",e),e.isWebinarRoom()&&(e.webinarId=t.find("x[webinarid]").attr("webinarid")),"true"===this.settingsService.getSetting("autoAcceptRoomInvite")?this.acceptRoomInvitation(e):(this.computeInvitationCounter(),this.eventService.publish(this.ROOM_INVITATION,e),this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e),"accepted"===e.status&&e.isWebConferenceV2Room()?(e.rxSubject.next(s.RBEvent.create("ROOM_CONFERENCE_START_EVENT")),this.eventService.publish("ON_WEBCONFERENCE_STARTED_INVITATION",e)):"accepted"===e.status&&e.confEndpoints&&e.confEndpoints.length&&"webrtc"===e.confEndpoints[0].mediaType&&this.eventService.publish("ON_CONFERENCE_STARTED_INVITATION",e),this.logger.info("[roomService] onRoomNotificationMessage -- get server room success for roomId "+e.dbId+" and roomJid"+e.jid+" and name "+e.getNameForLogs()))})).catch((e=>(this.logger.error("[roomService] onRoomNotificationMessage failure :  impossible to get associated room : "+e.message),true)))}),2e3)}return true}catch(t){return this.logger.error("[roomService] onRoomNotificationMessage error "+t),true}}onRoomInfoMessage(e){this.logger.info("[roomService] onRoomInfoMessage");try{if($(e).find("event").length>0){this.logger.info("[roomService] onRoomInfoMessage : room event message");const t=$(e).attr("from"),i=this.xmppService.getBareJidFromJid(t);let r=$(e).find("event").attr("jid");const n=$(e).find("event").attr("name"),o=$(e).attr("id"),a="true"===$(e).find("deskphone").text(),c=$(e).find("gmwi");if(c&&c.length&&(r=this.contactService.userContact.jid),this.logger.info("[roomService] onRoomInfoMessage : room event message with parameters "+i+" || "+r+" || "+n+" || "+o),i&&r&&n&&o){const t=this.getRoomByJid(i);if(!t)return this.manageEventForNonExistingRoom(i,n,r,a),true;t.noNotificationPopUp=a;const l=t.getUserByJid(r);if("voicemessage"===n&&l&&"deleted"!==l.status&&c.length){const e=c.find("message").attr("new"),t=c.find("message").attr("old");return this.eventService.publish(this.ROOM_ADMIN_MESSAGE_EVENT,i,r,n,o,{newMsgs:e,oldMsgs:t}),true}if("conferenceDelegate"===n&&l&&"deleted"!==l.status){const i=$(e).find("event").attr("user-id");return t.setWebConferenceOwnerId(i),this.eventService.publish(this.ROOM_CONFERENCE_DELEGATE_EVENT,t.dbId,i),true}if("dialInEnable"===n||"dialInDisable"===n||"dialInReset"===n)return true;switch(l&&"deleted"!==l.status&&this.eventService.publish(this.ROOM_ADMIN_MESSAGE_EVENT,i,r,n,o),n){case"conferenceAdd":if(t.isWebinarRoom())return true;setTimeout((()=>{this.getServerRoom(t.dbId).then((e=>{if(e.isWebConferenceV2Room())return e.rxSubject.next(s.RBEvent.create("ROOM_CONFERENCE_START_EVENT")),this.eventService.publish("ON_WEBCONFERENCE_STARTED_INVITATION",e),void this.logger.info("[roomService] onRoomInfoMessage : conferenceAdd -- confV2 !");const i=e.confEndpoints&&e.confEndpoints[0]?e.confEndpoints[0].confEndpointId:void 0;e.getPstnConfEndpointId()&&e.isMeetingRoom()&&(this.currentPersonalAudioRoomId=t.dbId),(e.isMeetingRoom()||this.contactService.userContact.webrtcAudioEnabled)&&(this.logger.info("[roomService] onRoomInfoMessage : conferenceAdd event with conferenceObject related to room : "+i),this.eventService.publish("ROOM_UPDATE_CONFID",e),this.eventService.publish("ROOM_ADD_CONF_ENDPOINT_EVENT",e),this.sendEvent("ROOM_ADD_CONF_ENDPOINT_EVENT",e),e.rxSubject.next(s.RBEvent.create("ROOM_ADD_CONF_ENDPOINT_EVENT")),this.eventService.publish("ON_CONFERENCE_STARTED_INVITATION",e,l),this.removeAnotherRoomWithSameConfEndpointId(e.confEndpoints[0].confEndpointId,e))}))}),1e3);break;case"conferenceRemove":if(t.isWebinarRoom())return true;if(t.isWebConferenceV2Room())return t.conference.sessions=[],t.confEndpoints=[],this.rooms[t.dbId]=t,this.roomsByJids[t.jid]=t,t.rxSubject.next(s.RBEvent.create("ROOM_CONFERENCE_STOP_EVENT")),this.eventService.publish("ON_WEBCONFERENCE_ENDED_INVITATION",t.dbId),this.logger.info("[roomService] onRoomInfoMessage : conferenceRemove -- confV2 !"),true;if(t.isMeetingRoom())this.getServerRoom(t.dbId).then((e=>{t.getPstnConfEndpointId()&&!e.getPstnConfEndpointId()&&(this.currentPersonalAudioRoomId=""),this.logger.info("[roomService] onRoomInfoMessage : conferenceRemove event"),this.eventService.publish("ROOM_REMOVE_CONF_ENDPOINT_EVENT",e),this.sendEvent("ROOM_REMOVE_CONF_ENDPOINT_EVENT",e),e.rxSubject.next(s.RBEvent.create("ROOM_REMOVE_CONF_ENDPOINT_EVENT")),this.eventService.publish("ON_CONFERENCE_ENDED_INVITATION",e)}));else{const e=t.confEndpoints[0];t.confEndpoints=[],this.rooms[t.dbId]=t,this.roomsByJids[t.jid]=t,this.logger.info("[roomService] onRoomInfoMessage : conferenceRemove event"),this.eventService.publish("ROOM_REMOVE_CONF_ENDPOINT_EVENT",t),this.sendEvent("ROOM_REMOVE_CONF_ENDPOINT_EVENT",t),t.rxSubject.next(s.RBEvent.create("ROOM_REMOVE_CONF_ENDPOINT_EVENT")),this.eventService.publish("ON_CONFERENCE_ENDED_INVITATION",t,e)}break;case"invitation":!t.isUserModerator(this.contactService.userContact)||l&&l.status!==this.RoomUserStatus.DELETED||this.getServerRoom(t.dbId).then((e=>{this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,t)}))}}}else if($(e).find("subject").length>0){const t=$(e).attr("from"),i=this.xmppService.getBareJidFromJid(t),r=this.getRoomByJid(i),n=$(e).find("subject").text();r&&n&&(this.logger.info("[roomService] onRoomInfoMessage : update subject of room"),r.desc=n,this.eventService.publish(this.ROOM_UPDATE_EVENT,r),this.sendEvent(this.ROOM_UPDATE_EVENT,r))}return true}catch(t){return this.logger.error("[roomService] onRoomInfoMessage error "+t),true}}onRoomHistoryInfoMessage(e){const t=$(e).find("changed");if(t.length>0){const e=t.attr("with"),i=this.getRoomByJid(e);this.logger.debug("[roomService] onRoomHistoryInfoMessage with "+e),this.eventService.publish(this.ROOM_HISTORY_UPDATE_EVENT,i)}return true}async onRoomMessageConfig(e){try{const t=$(e),i=t.find("room"),r=i.attr("userjid"),n=i.attr("status"),s=t.find("delay");if(s.length>0&&"Offline Storage"===s.text())return true;if(i.length>0){const e=i.attr("roomid"),s=`[roomService] onRoomMessageConfig -- management -- ${e} --`,o=this.getRoomById(e);let a=false;if(o){const e=i.attr("topic"),c=i.attr("name");let l;const d=i.attr("playEntryTone");let u;"true"===d?l=true:"false"===d&&(l=false),void 0!==d&&(this.logger.info(s+" update playEntryTone"),o.setPlayEntryTone(l));const h=i.attr("muteUponEntry");let f;"true"===h?u=true:"false"===h&&(u=false),void 0!==h&&(this.logger.info(s+" update muteUponEntry"),o.setMuteUponEntry(u));const p=i.attr("includeAllPhoneNumbers");"true"===p?f=true:"false"===p&&(f=false),void 0!==p&&(this.logger.info(s+" update includeAllPhoneNumbers"),o.setIncludeAllPhoneNumbers(f));"true"===i.attr("phoneNumbersUpdated")&&(a=true),(c||e)&&(this.logger.info(s+" update name or topic"),o.name=c,o.desc=e||"");const g=i.find("guests");g.length>0&&"update"===g.attr("action")&&(this.logger.info(s+" update guests"),o.guestEmails=[],o.guestPhoneNumbers=[],$(g).find("email").each(((e,t)=>{o.guestEmails.push(t.textContent)})),$(g).find("phone-number").each(((e,t)=>{o.guestPhoneNumbers.push(t.textContent)})));const m=i.attr("autoRegister");m&&(this.logger.info(`${s} update autoRegister: ${m}`),o.setAutoRegister(m));const v=i.attr("customData");if(v)try{const e=this.extractHtmlContent(v);o.customData=JSON.parse(e),this.logger.info(s+" handle customData")}catch(dp){this.logger.error(`${s} handle customData -- FAILURE -- ${dp.message}`),o.customData="{}"}const S=i.attr("alertenabled");S&&(o.isAlertNotificationEnabled="true"===S);const b=t.find("avatar"),y=i.attr("lastAvatarUpdateDate"),C=b.length>0&&"delete"===b.attr("action")?"delete":"update";if(o&&(y||"delete"===C)&&(this.logger.info(s+" update avatar"),a=true),n){this.logger.info(s+" update user status");const e=o.getUserByJid(r);if(e){const t=void 0!==i.attr("alertenabled")?"alertEnabled":null;this.updateUserStatus(o,e,n,t)}else if(this.roomServiceConfig&&(this.roomServiceConfig.webinar||o.isWebinarRoom())&&"accepted"===n){let e=null,t=null;i.find("payload").each(((i,r)=>{const n=r.getAttribute("datatype"),s=$(r).find("json");"urn:rainbow:json:userdata"===n&&(e=this.contactService.createContactFromData(JSON.parse(s[0].textContent))),"urn:rainbow:json:roomuserdata"===n&&(t=JSON.parse(s[0].textContent))})),o.users.push({contact:e,status:"accepted",date:new Date(t.additionDate),privilege:t.privilege}),this.contactService.isUserContact(e)&&(o.status=t.status),this.refreshMemberAndOrganizerLists(o)}else this.logger.info(s+" update user status -- room exists, but user not. Update the room"),a=true}const w=i.attr("privilege");if(w){this.logger.info(`${s} update user's privilege ${w}`);const e=r?o.getUserByJid(r):null;if(this.roomServiceConfig&&this.roomServiceConfig.ignorePrivilege||(a=true),"owner"===w&&e&&e.contact&&e.contact.jid===this.contactService.userContact.jid){o.ownerContact=e.contact,o.owner=true;const t=this.i18n.translate("promotedToOwner",{name:escape(o.name)});this.eventService.publish("GLOBAL_NOTIFY_MESSAGE_EVENT",t)}}const _=i.find("tags");if(_&&_.length){this.logger.info(s+" update room tags");const e=_.attr("action");this.logger.info(`${s} action = ${e}`);const t=_.find("tag");"update"===e&&(o.tags=[],t&&t.length&&t.each(((e,t)=>{const i=t.getAttribute("value"),r=t.getAttribute("color"),n=t.getAttribute("emoji"),s={};i&&(s.tag=i),r&&(s.color=r),n&&(s.emoji=n),o.tags.push(s)})))}a&&await this.updateRoomFromServer(o),this.eventService.publish(this.ROOM_UPDATE_EVENT,o),this.sendEvent(this.ROOM_UPDATE_EVENT,o),o.rxSubject.next(void 0)}else if(void 0===o&&e&&!this.roomsInProgress[e]&&"deleted"!==n&&"rejected"!==n){this.logger.info(s+" room does not exist, create new one"),this.roomsInProgress[e]=true;const t=await this.getServerRoom(e);delete this.roomsInProgress[e],this.logger.info(s+" sendInitialRoomPresence to the new room"),this.sendInitialRoomPresence(t),this.updateLater[e]&&(delete this.updateLater[e],this.logger.info("[roomService] onRoomMessageConfig -- later update of the new room"),this.getServerRoom(e).then((e=>{e.updateAvatarInfo()})))}else this.roomsInProgress[e]&&(this.updateLater[e]=e)}const o=t.find("openinvite");if(o.length>0){this.logger.info("[roomService] onRoomMessageConfig -- openinvite");const e=o.attr("action"),t=o.find("roomid").text(),i=o.find("openinviteid").text(),r=o.find("roomType").text(),n=o.find("invitationURL").text();switch(e){case"update":{let e=false;"personal_audio_room"!==r||t||(e=true),Object.keys(this.openInviteIdByRoomId).forEach((s=>{this.openInviteIdByRoomId[s]&&this.openInviteIdByRoomId[s].openInviteId===i&&s!==t&&(this.logger.info("[roomService] onRoomMessageConfig -- openinviteId removed from "+s),delete this.openInviteIdByRoomId[s],this.openInviteIdByRoomIdSubject.next({invitationURL:n,openInviteId:i,roomType:r,id:t,action:"deleted"})),e&&"personal_audio_room"===this.openInviteIdByRoomId[s].roomType&&delete this.openInviteIdByRoomId[s]}))}case"create":t&&i&&(this.openInviteIdByRoomId[t]={},this.openInviteIdByRoomId[t].roomType=r,this.openInviteIdByRoomId[t].openInviteId=i,this.openInviteIdByRoomId[t].openInviteLink=n,this.openInviteIdByRoomIdSubject.next({invitationURL:n,openInviteId:i,roomType:r,id:t,action:"updated"}),this.logger.info("[roomService] onRoomMessageConfig -- openinviteId "+i+" assigned to room "+t),this.eventService.publish("ON_OPEN_INVITE_ID_UPDATED_EVENT",this.rooms[t]),"personal_audio_room"===r&&this.eventService.publish("ON_PERSONAL_MEETING_OPEN_INVITE_ID_UPDATED_EVENT"));break;case"delete":Object.keys(this.openInviteIdByRoomId).forEach((e=>{this.openInviteIdByRoomId[e]&&this.openInviteIdByRoomId[e].openInviteId===i&&e===t&&(this.logger.info("[roomService] onRoomMessageConfig -- openinviteId removed from "+e),delete this.openInviteIdByRoomId[e],this.openInviteIdByRoomIdSubject.next({invitationURL:n,openInviteId:i,roomType:r,id:t,action:"deleted"}),this.eventService.publish("ON_OPEN_INVITE_ID_DELETED_EVENT",this.rooms[t]))}));break;default:this.logger.info("[roomService] onRoomMessageConfig -- openinviteId - unkown action : "+e)}}const a=t.find("meeting");if("management"===t.attr("type")&&a.length>0){this.logger.debug("[roomService] onRoomMessageConfig -- management meeting event");const e=a.attr("action"),t=a.find("roomid").length?a.find("roomid").text():"";switch(e){case"saved":this.currentPersonalAudioRoomId="",this.logger.debug("meeting saved: "+t),this.sendEvent("ON_MEETING_SAVED_EVENT",t);break;case"deleted":this.logger.debug("meeting deleted: "+t),this.currentPersonalAudioRoomId="",this.sendEvent("ON_MEETING_DELETED_EVENT",t);break;case"created":this.logger.debug("meeting created: "+t),this.personalAudioRoomId=t,this.currentPersonalAudioRoomId=t,this.sendEvent("ON_MEETING_CREATED_EVENT",t);break;case"updated":this.logger.debug("meeting updated: "+t),this.personalAudioRoomId=t,this.currentPersonalAudioRoomId=t,this.sendEvent("ON_MEETING_UPDATED_EVENT",t)}}const c=t.find("roomscontainer");if("management"===t.attr("type")&&c.length>0){const e=c.attr("containerid"),t=c.attr("name");switch(c.attr("action")){case"update":{const i=[],r=c.find("added");r.length&&(r.find("roomid").each(((e,t)=>{i.push(t.textContent)})),i.forEach((i=>{this.rooms[i]&&(this.rooms[i].containerId=e,this.rooms[i].containerName=t)})));const n=[],s=c.find("removed");s.length&&(s.find("roomid").each(((e,t)=>{n.push(t.textContent)})),n.forEach((e=>{this.rooms[e]&&(this.rooms[e].containerId="",this.rooms[e].containerName="")}))),(i.length||n.length)&&this.sendEvent(this.ROOM_UPDATE_EVENT,null);break}case"create":{const i=[],r=c.find("added");r.length&&(r.find("roomid").each(((e,t)=>{i.push(t.textContent)})),i.forEach((i=>{this.rooms[i]&&(this.rooms[i].containerId=e,this.rooms[i].containerName=t)}))),i.length&&this.sendEvent(this.ROOM_UPDATE_EVENT,null);break}case"delete":{const t=this.getRoomsByContainerId(e);t.forEach((e=>{this.rooms[e.dbId].containerId="",this.rooms[e.dbId].containerName=""})),t.length&&this.sendEvent(this.ROOM_UPDATE_EVENT,null);break}}}return true}catch(t){return this.logger.info("[roomService] onRoomMessageConfig  -- failure -- "+t.message),true}}extractHtmlContent(e){const t=new DOMParser;let i="{}";try{i=t.parseFromString(e,"text/html").documentElement.textContent}catch(r){this.logger.error("[roomService] error in extractHtmlContent:"+r.message),i="{}"}return i}onRoomPresence(e){try{const t=$(e),i=t.attr("from"),r=this.xmppService.getBareJidFromJid(i);let n=this.xmppService.getResourceFromJid(i);const s=t.find("status");let o=null;s.each(((e,t)=>{"332"===$(t).attr("code")&&(o="332"),"338"===$(t).attr("code")&&(o="338"),"339"===$(t).attr("code")&&(o="339"),"110"!==$(t).attr("code")||o||(o="110")}));const a=this.getRoomByJid(r);if(a)if("338"===o)this.logger.info("[roomService] onRoomPresence - "+a.dbId+"- Deactivated"),a.isActive=false,this.eventService.publish(this.ROOM_UPDATE_EVENT,a),this.sendEvent(this.ROOM_UPDATE_EVENT,a);else if("339"===o)this.logger.info("[roomService] onRoomPresence - "+a.dbId+"- Reactivated"),a.initPresenceAck=false,this.sendInitialRoomPresenceSync(a),a.isActive=true,this.eventService.publish(this.ROOM_UPDATE_EVENT,a),this.sendEvent(this.ROOM_UPDATE_EVENT,a);else if(this.logger.info("[roomService] onRoomPresence -- "+a.dbId),-1!==n.indexOf("/")&&(n=this.xmppService.getBareJidFromJid(n)),this.contactService.isUserContactJid(n)){const e=t.attr("type");e&&"unavailable"===e&&"110"===o?this.logger.warn("[roomService] disconnected from room "+a.getNameForLogs()+" because of a unavailable presence -- do nothing"):"332"===o?(this.logger.warn("[roomService] disconnected from room "+a.getNameForLogs()+" because of a system shutdown"),a.initPresenceAck=false,this.sendInitialRoomPresenceSync(a)):(a.initPresenceAck=true,this.roomPresenceWaitingList&&this.roomPresenceWaitingList.length&&this.roomPresenceWaitingList.forEach(((e,t)=>{e.dbId===a.dbId&&this.roomPresenceWaitingList.splice(t,1)})),a.initPresPromise&&(this.logger.info("[roomService] onRoomPresence - initPresPromise resolved"),a.initPresPromiseResolve(a),a.initPresInterval&&(a.initPresInterval.unsubscribe(),a.initPresInterval=null),a.initPresPromise=null,a.initPresPromiseResolve=null,this.eventService.publish(this.ROOM_UPDATE_EVENT,a),this.sendEvent(this.ROOM_UPDATE_EVENT,a)))}else a.dbId&&!this.rooms[a.dbId]&&this.getServerRoom(a.dbId);return true}catch(t){return this.logger.error("[roomService] onRoomPresence error "+t),true}}updateUserStatus(e,t,i,n=null){if(this.logger.info("[roomService] "+t.status+" || "+i),this.contactService.isUserContactJid(t.contact.jid)&&t.status!==i)switch(this.logger.info("[roomService] my new status "+i),i){case"deleted":delete this.roomsByJids[e.jid],delete this.rooms[e.dbId],this.logger.info("[roomService] deleteRoom successfully ("+e.dbId+")"),this.sendUnavailableRoomPresence(e),this.computeInvitationCounter(),e.isMeetingRoom()&&this.eventService.publish("MEETING_DELETE_EVENT",e),this.eventService.publish(this.ROOM_UPDATE_EVENT,e,"remove"),this.sendEvent(this.ROOM_UPDATE_EVENT,e),this.contactService.userContact.guestMode&&!e.isWebinarRoom()&&this.eventService.publish("ON_OPEN_POPUP","concludeInvitation");break;case"unsubscribed":this.logger.info("[roomService] unsubscribed successfully ("+e.dbId+")"),this.sendUnavailableRoomPresence(e),e.status=this.RoomUserStatus.UNSUBSCRIBED,t.status=i,e.updateAvatarInfo(),e.isModerator=false,e.initPresenceAck=false,this.computeInvitationCounter(),this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e);break;case"accepted":e.status=this.RoomUserStatus.ACCEPTED,t.status=i,this.fileStorageService.retrieveReceivedFilesForRoom(e.dbId).then((()=>{this.sendInitialRoomPresenceSync(e),e.updateAvatarInfo(),this.computeInvitationCounter(),this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e),this.getServerRoom(e.dbId).then((e=>{if(this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e),e.isWebConferenceV2Room())return e.rxSubject.next(s.RBEvent.create("ROOM_CONFERENCE_START_EVENT")),this.eventService.publish("ON_WEBCONFERENCE_STARTED_INVITATION",e),void this.logger.info("[roomService] onRoomInfoMessage : conferenceAdd -- confV2 !");e.confEndpoints&&e.confEndpoints.length&&!e.isWebinarRoom()&&"webrtc"===e.confEndpoints[0].mediaType&&this.eventService.publish("ON_CONFERENCE_STARTED_INVITATION",e)})).catch((()=>{this.logger.warn("[roomService] getServerRoom "+e.dbId+" failed")}))}));break;case"rejected":delete this.roomsByJids[e.jid],delete this.rooms[e.dbId],e.status=this.RoomUserStatus.REJECTED,t.status=i,this.computeInvitationCounter(),this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e)}else t&&!this.contactService.isUserContactJid(t.contact.jid)&&(this.logger.info("[roomService] Update user with status "+i),t.status===this.RoomUserStatus.DELETED&&i===this.RoomUserStatus.ACCEPTED&&(t.date=new Date,t.privilege===r.Room.Privilege.MODERATOR&&(t.privilege=r.Room.Privilege.USER)),t.status=i,e.updateAvatarInfo(),this.refreshMemberAndOrganizerLists(e),this.eventService.publish(this.ROOM_UPDATE_EVENT,e),this.sendEvent(this.ROOM_UPDATE_EVENT,e),n||this.sendEvent(this.ROOM_USER_UPDATE_EVENT,{room:e,user:t}))}findRoomsWithConfId(e){return this.getRooms().filter((t=>!(!t.confEndpoints||!t.confEndpoints.length)&&t.confEndpoints.some((t=>t.confEndpointId===e))))}removeConfIdInAllRooms(e){const t=[];return e.forEach((e=>{e.confEndpoints&&e.confEndpoints.length>0&&t.push(this.deleteRoomConferenceEndPoint(e,e.confEndpoints[0].confEndpointId))})),Promise.all(t)}async resetOpenInviteId(e){try{if(!e)throw new Error("[roomService] resetOpenInviteId -- no roomId ");const t=`${this.portalURL}users/${this.contactService.userContact.dbId}/public-links/reset`,i=this.authService.getPostHeader(),r=JSON.stringify({roomId:e}),n=await fetch(t,{method:"PUT",headers:i,body:r});if(!n.ok)throw n;const s=(await n.json()).data;return s&&s.openInviteId&&s.roomId&&(this.logger.info("[roomService] resetOpenInviteId success - openinviteId "+s.openInviteId+" bound to room "+e),this.openInviteIdByRoomId[s.roomId]={},this.openInviteIdByRoomId[s.roomId].roomType=s.roomType,this.openInviteIdByRoomId[s.roomId].openInviteId=s.openInviteId,this.openInviteIdByRoomId[s.roomId].openInviteLink=s.invitationURL),s.openInviteId}catch(t){const e="resetOpenInviteId failure";throw this.logger.error("[contactService] "+e),new Error(e)}}async bindOpenInviteIdToRoom(e){try{const t=`${this.portalURL}users/${this.contactService.userContact.dbId}/public-links/bind`,i=this.authService.getPostHeader(),r=JSON.stringify({roomId:e.dbId}),n=await fetch(t,{method:"POST",headers:i,body:r});if(!n.ok)throw n;const s=(await n.json()).data;if(s&&s.roomId&&s.roomType&&s.openInviteId)return this.logger.info(`[roomService] createRoomOpenInviteId -- SUCCESS - room ${s.roomId} with type ${s.roomType} bound to openInviteId ${s.openInviteId}`),this.openInviteIdByRoomId[s.roomId]={},this.openInviteIdByRoomId[s.roomId].roomType=s.roomType,this.openInviteIdByRoomId[s.roomId].openInviteId=s.openInviteId,this.openInviteIdByRoomId[s.roomId].openInviteLink=s.invitationURL,this.rooms[e.dbId];throw new Error("[roomService] No or unvalid openInviteData")}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"bindOpenInviteIdToRoom");throw this.logger.error("[roomService] "+e.message),e.error}}async unbindOpenInviteFromRoom(e){try{const t=`${this.portalURL}users/${this.contactService.userContact.dbId}/public-links/unbind`,i=this.authService.getPostHeader(),r=JSON.stringify({roomId:e}),n=await fetch(t,{method:"PUT",headers:i,body:r});if(!n.ok)throw n;return void this.logger.info("[roomService] openInvite successfully unbound")}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"unbindOpenInviteFromRoom");throw this.logger.error("[roomService] "+e.message),e.error}}async joinRoomUsingOpenInviteId(e){try{const t=config.restServerUrl+"/api/rainbow/enduser/v1.0/rooms/open-invites",i=this.authService.getPostHeader(),r=JSON.stringify({openInviteId:e}),n=await fetch(t,{method:"POST",headers:i,body:r});if(!n.ok)throw n;const s=(await n.json()).data;if(s&&s.roomId)return s.roomId;throw new Error("No roomId info in openInvitation")}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"joinRoomUsingOpenInviteId");throw this.logger.error("[roomService] "+e.message),e.error}}async retrieveOpenInviteData(e=null,t=null){this.logger.debug("[roomService] retrieveOpenInviteData - type: "+e+" - roomId: "+t);try{let i="";t&&(i+="?roomId="+t),e&&(i+=i?"&type="+e:"?type="+e);const r=this.portalURL+"users/"+this.contactService.userContact.dbId+"/public-links"+i,n=this.authService.getRequestHeader(),s=await fetch(r,{method:"GET",headers:n});if(!s.ok)throw s;const o=(await s.json()).data;o&&o.length?(this.logger.debug("[roomService] retrieveOpenInviteData -- SUCCESS - found "+o.length),o.forEach((e=>{e.roomId&&(this.openInviteIdByRoomId[e.roomId]={},this.openInviteIdByRoomId[e.roomId].roomType=e.roomType,this.openInviteIdByRoomId[e.roomId].openInviteId=e.openInviteId,this.openInviteIdByRoomId[e.roomId].openInviteLink=e.invitationURL,this.logger.debug("[roomService] retrieveOpenInviteData - openInviteId "+e.openInviteId+" set for room "+e.roomId))}))):this.logger.debug("[roomService] retrieveOpenInviteData -- FAILURE - none found")}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"retrieveOpenInviteData");throw this.logger.error("[roomService] "+e.message),e.error}}async retrieveOpenInviteIdForRoom(e){this.logger.debug("[roomService] retrieveOpenInviteIdForRoom - roomId: "+e);try{const t=`${this.portalURL}rooms/${e}/public-links`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;const n=(await r.json()).data;return n.openInviteId&&(this.openInviteIdByRoomId[e]={},this.openInviteIdByRoomId[e].roomType="default",this.openInviteIdByRoomId[e].openInviteId=n.openInviteId,this.openInviteIdByRoomId[e].openInviteLink=n.invitationURL,this.logger.debug("[roomService] retrieveOpenInviteIdForRoom - openInviteId "+n.openInviteId+" set for room "+e)),n.openInviteId}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"retrieveOpenInviteIdForRoom");throw this.logger.error("[roomService] "+e.message),e.error}}async retrieveOpenInviteLinkForRoom(e){this.logger.debug("[roomService] retrieveOpenInviteLinkForRoom - roomId: "+e);try{const t=`${this.portalURL}rooms/${e}/public-links`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;const n=(await r.json()).data;return n.openInviteId&&(this.openInviteIdByRoomId[e]={},this.openInviteIdByRoomId[e].roomType="default",this.openInviteIdByRoomId[e].openInviteId=n.openInviteId,this.openInviteIdByRoomId[e].openInviteLink=n.invitationURL,this.logger.debug("[roomService] retrieveOpenInviteLinkForRoom - openInviteLink "+n.openInviteLink+" set for room "+e)),n.openInviteLink}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"retrieveOpenInviteLinkForRoom");throw this.logger.error("[roomService] "+e.message),e.error}}async checkOpenInviteIdValidity(e){this.logger.debug("[roomService] checkOpenInviteIdValidity - openInvideId: "+e);try{const t=`${config.restServerUrl}/api/rainbow/enduser/v1.0/rooms/open-invites/validate?openInviteId=${e}`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;const n=(await r.json()).data,s=n.roomName,o=n.roomTopic,a=n.roomLocked,c=n.invitingFirstName,l=n.invitingLastName,d=n.invitingCompanyName;return this.logger.info(`[roomService] checkOpenInviteIdValidity:\nroomName: ${s}\nroomTopic: ${o}\nroomLocked: ${a}\ninvitingFirstName: ${c}\ninvitingLastName: ${l}\ninvitingCompanyName: ${d}`),n}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"checkOpenInviteIdValidity");throw this.logger.error("[roomService] "+e.message),e.error}}updateRoomConfEndpoint(e,t){const i=this.findRoomsWithConfId(e);i&&i.length&&i.forEach((i=>{i.confEndpoints.forEach((i=>{i.confEndpointId===e&&(i.confEndpointId=t)})),this.getServerRoom(i.dbId).then((e=>{this.eventService.publish(this.ROOM_UPDATE_EVENT,e)})),this.sendEvent("ROOM_ADD_CONF_ENDPOINT_EVENT",i)}))}hasNoDefaultMeetingRooms(){return Object.keys(this.rooms).some((e=>this.rooms[e].isMeetingRoom()&&!this.rooms[e].isMyPersonalMeetingRoom()))}async retrievePersonalAudioRoom(e=false){if(!e&&this.personalAudioRoomId&&this.getRoomById(this.personalAudioRoomId))return this.logger.debug("[roomService] retrievePersonalAudioRoom from service data"),this.getRoomById(this.personalAudioRoomId);try{this.logger.debug("[roomService] retrievePersonalAudioRoom from server");const e=this.portalURL+"meetings/personal",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=(await i.json()).data;if(r.id){this.personalAudioRoomId=r.id;const e=this.getRoomById(r.id);return e?this.updateRoomData(e,r):this.createRoomFromData(r),this.getRoomById(r.id)}throw new Error("Wrong data from server")}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"retrievePersonalAudioRoom");throw this.logger.error("[roomService] "+e.message),e.error}}async retrieveCurrentPersonalAudioRoom(e=false){if(!e&&this.currentPersonalAudioRoomId&&this.getRoomById(this.currentPersonalAudioRoomId))return this.logger.debug("[roomService] retrieveCurrentPersonalAudioRoom from service data"),this.getRoomById(this.currentPersonalAudioRoomId);try{this.logger.debug("[roomService] retrieveCurrentPersonalAudioRoom from server");const e=this.portalURL+"meetings/current",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=(await i.json()).data;if(r.id){this.currentPersonalAudioRoomId=r.id;const e=this.getRoomById(r.id);return e?this.updateRoomData(e,r):this.createRoomFromData(r),this.getRoomById(r.id)}const n=new Error("Wrong data from server");throw this.logger.info("[roomService] "+n.message),n}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"retrieveCurrentPersonalAudioRoom");throw this.logger.error("[roomService] "+e.message),e.error}}async reUseMeetingRoom(e){if(this.logger.debug("[roomService] reUseMeetingRoom - "+e),!e){const e=new Error("reUseMeetingRoom - missing parameter");throw this.logger.error(e.message),e}const t=this.getRoomById(e);t&&!t.isActive&&this.sendAvailableRoomPresence(t);try{const t=`${this.portalURL}meetings/${e}/reuse`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;const n=(await r.json()).data;if(n.id){this.currentPersonalAudioRoomId=n.id;const e=this.getRoomById(n.id);return e?this.updateRoomData(e,n):this.createRoomFromData(n),this.getRoomById(n.id)}throw new Error("Wrong data from server")}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"reUseMeetingRoom");throw this.logger.error("[roomService] "+e.message),e.error}}async deletePersonalMeetingRoom(){this.logger.debug("[roomService] deletePersonalMeetingRoom");try{const e=this.portalURL+"meetings/delete",t=this.authService.getPostHeader(),i=await fetch(e,{method:"PUT",headers:t});if(!i.ok)throw i;const r=(await i.json()).data;if(r.id){let e=this.getRoomById(r.id);return e?this.updateRoomData(e,r):this.createRoomFromData(r),this.currentPersonalAudioRoomId=r.id,this.personalAudioRoomId=r.id,this.eventService.publish("ON_MEETING_CREATED_EVENT",r.id),e=this.getRoomById(r.id),e}throw new Error("Wrong data from server")}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"deletePersonalMeetingRoom");throw this.logger.error("[roomService] "+t.message),t.error}}async saveCurrentPersonalMeetingRoom(e){this.logger.debug("[roomService] saveCurrentPersonalMeetingRoom");try{const t=this.portalURL+"meetings/save",i=this.authService.getPostHeader(),r=await fetch(t,{method:"PUT",headers:i,body:JSON.stringify({name:e})});if(!r.ok)throw r;const n=(await r.json()).data;if(n.id){this.currentPersonalAudioRoomId=n.id;let e=this.getRoomById(n.id);return e?this.updateRoomData(e,n):this.createRoomFromData(n),this.currentPersonalAudioRoomId=n.id,this.personalAudioRoomId=n.id,this.eventService.publish("ON_MEETING_CREATED_EVENT",n.id),e=this.getRoomById(n.id),e}throw new Error("Wrong data from server")}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"saveCurrentPersonalMeetingRoom");throw this.logger.error("[roomService] "+e.message),e.error}}getRoomsWithSfuConferenceEndpoints(){const e=[];return Object.keys(this.rooms).forEach((t=>{const i=this.rooms[t];i&&!i.isWebConferenceV2Room()&&i.confEndpoints.length&&"webrtc"===i.confEndpoints[0].mediaType&&e.push(i.confEndpoints[0].confEndpointId)})),e}getPersonalAudioRoomOpenInviteIdLink(){return this.getOpenInviteIdLinkForRoom(this.personalAudioRoomId)}getOpenInviteIdLinkForRoom(e){return this.openInviteIdByRoomId[e]?this.openInviteIdByRoomId[e].openInviteLink:null}getOpenInviteIdForRoom(e){return this.openInviteIdByRoomId[e]?this.openInviteIdByRoomId[e].openInviteId:null}getName(e){return e.name}sortObjectByProperty(e){return(t,i)=>t[e]<i[e]?-1:t[e]>i[e]?1:0}async retrieveRoomConsumption(){this.logger.debug("[roomService] retrieveRoomConsumption");try{const e=this.portalURL+"rooms/consumption",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=(await i.json()).data;return this.logger.debug("[roomService] retrieveRoomConsumption -- SUCCESS -- "+r.currentValue),r.currentValue}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"retrieveRoomConsumption");throw this.logger.error("[roomService] "+t.message),t.error}}async startAdHocConference(e,t,i){try{const r=this.portalURL+"adhoc",n=this.authService.getPostHeader(),s={};e&&(s.caller=e),s.callee=t,s.participants=i;const o=await fetch(r,{method:"PUT",headers:n,body:JSON.stringify(s)});if(!o.ok)throw o;const a=(await o.json()).data;return this.logger.debug("[roomService] startAdHocConference -- SUCCESS -- "),a}catch(r){const e=await this.errorHelperService.getErrorInfo(r,"startAdHocConference");throw this.logger.error("[roomService] "+e.message),e.error}}async startAdHocConferenceV2(e,t){try{const i=this.portalURL+"ad-hoc",r=this.authService.getPostHeader(),n={};e&&(n.caller=e),n.participants=t;const s=await fetch(i,{method:"POST",headers:r,body:JSON.stringify(n)});if(!s.ok)throw s;const o=(await s.json()).data;return this.logger.debug("[roomService] startAdHocConferenceV2 -- SUCCESS -- "),o}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"startAdHocConferenceV2");throw this.logger.error("[roomService] "+e.message),e.error}}getParticipantDataForAdhocFromCall(e){const t={participant:null,blindTrasfer:false};if("Phone"===e.type.value){let i=false;null!==e.sipWiseEndPointDeviceList&&e.sipWiseEndPointDeviceList.length&&e.id===e.sipWiseEndPointDeviceList[0].callId&&(i="sip"===e.sipWiseEndPointDeviceList[0].deviceType),e.contact.temp?(t.participant={phoneNumber:e.contact.id,connected:true},t.blindTrasfer=true):e.sipWiseData&&e.sipWiseData.called&&e.sipWiseData.called.phoneNumber&&-1!==e.sipWiseData.called.phoneNumber.indexOf("+")?(t.participant={phoneNumber:e.sipWiseData.called.phoneNumber,connected:true},t.blindTrasfer=true):(t.participant={userId:e.contact.dbId,connected:true,deskphone:i},i&&(t.blindTrasfer=true))}else t.participant={userId:e.contact.dbId,connected:true};return this.logger.info(`[roomService] getParticipantDataForAdhocFromCall for call ${e.id}: type ${e.type.value} -- ${JSON.stringify(t.participant)} -- blind transfer : ${t.blindTrasfer}`),t}async manageEventForNonExistingRoom(e,t,i,r){try{setTimeout((async()=>{this.logger.debug("[roomService] manageEventForNonExistingRoom for "+e);let n=this.getRoomByJid(e);n||(n=await this.getServerRoomByJid(e));const o=n.getUserByJid(i);if("conferenceAdd"===t){if(!n.isMeetingRoom()&&!this.contactService.userContact.webrtcAudioEnabled)return n;n.noNotificationPopUp=r,n.isWebConferenceV2Room()?(n.rxSubject.next(s.RBEvent.create("ROOM_CONFERENCE_START_EVENT")),this.eventService.publish("ON_WEBCONFERENCE_STARTED_INVITATION",n),this.logger.info("[roomService] onRoomInfoMessage : conferenceAdd -- confV2 !")):(this.eventService.publish("ROOM_ADD_CONF_ENDPOINT_EVENT",n),this.sendEvent("ROOM_ADD_CONF_ENDPOINT_EVENT",n),this.eventService.publish("ON_CONFERENCE_STARTED_INVITATION",n,o))}return n}),4e3)}catch(n){const e=await this.errorHelperService.getErrorInfo(n,"manageEventForNonExistingRoom");throw this.logger.error("[roomService] "+e.message),e.error}}getLanguageWithIsoCode(){let e="en";if(this.contactService.userContact.language){const t=this.contactService.userContact.language.split("-");t.length>1&&(e=t[0]+"-"+t[1].toUpperCase())}return e}}t.RoomService=y},function(e,t,i){i.d(t,"a",(function(){return n}));var r=i(0),n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.a(t,e),t.prototype.notifyNext=function(e,t,i,r,n){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(i(2).a)},function(e,t,i){i.d(t,"a",(function(){return s}));var r=i(0),n=i(2);function s(e,t){return function(i){return i.lift(new o(e,t))}}var o=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.predicate,this.thisArg))},e}(),a=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.predicate=i,n.thisArg=r,n.count=0,n}return r.a(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(dp){return void this.destination.error(dp)}t&&this.destination.next(e)},t}(n.a)},function(e,t,i){i.d(t,"b",(function(){return r})),i.d(t,"a",(function(){return a}));var r,n=i(22),s=i(64),o=i(83);r||(r={});var a=function(){function e(e,t,i){this.kind=e,this.value=t,this.error=i,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,i){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return i&&i()}},e.prototype.accept=function(e,t,i){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,i)},e.prototype.toObservable=function(){switch(this.kind){case"N":return Object(s.a)(this.value);case"E":return Object(o.a)(this.error);case"C":return Object(n.b)()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}()},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7),n=i(18),s=i(4),o=i(28),a=i(9),c=i(6),l=i(67),d=i(11),u=i(417),h=i(43),f=i(14),p=i(56);class g{constructor(){this.firefoxPreferedSharing="window",this.started=false,this.connected=false,this.RTC=null,this.webrtcP2PEventHandler=null,this.calls={},this.autoreleaseTimeout=null,this.makingCall=false,this.reconnectCall=false,this.alreadyAttaching=false,this.virtualBackgroundService=l.VirtualBackgroundService.getInstance(),this.logger=s.LoggerService.getInstance(),this.rxSubject=new r.Subject,this.eventService=d.EventService.getInstance(),this.webrtcConfigAndUtils=h.WebrtcConfigAndUtils.getInstance(),this.contactService=c.ContactService.getInstance(),this.xmppService=a.XmppService.getInstance(),this.profileService=f.ProfileService.getInstance(),this.deviceManagementService=p.DeviceManagementService.getInstance(),this.isMixPstnWebRtcAllowed=false,this.audioProfileChanging=false,this.xmppConnectionSubscription=null,this.replaceBackgroundSubscription=null,this.deviceManagementSubscription=null,this.listeners=[]}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.webrtcP2PService||(e.rainbow.webrtcP2PService=new g),e.rainbow.webrtcP2PService}allowDesktopSharing(){return false}allowAdvancedDesktopSharing(){return false}getDesktopSharingSource(){return null}askToAddSharing(e,t=false){return false}askToStartSharing(e,t,i=false){return false}isNativeApplication(){return false}async start(){this.RTC=this.webrtcConfigAndUtils.getBrowserMethodHandler(),this.started=true,this.connected=true,this.xmppConnectionSubscription=this.xmppService.subscribeToConnectionEvents((e=>{this.onConnectionStateChangeEvent(e)})),this.listeners.push(this.eventService.subscribe("PUT_ACTIVE_WEBRTC_CALL_ON_HOLD",(()=>{this.putActiveWebrtcCallOnHold()}))),this.attachHandlers(),this.replaceBackgroundSubscription&&(this.replaceBackgroundSubscription.unsubscribe(),this.replaceBackgroundSubscription=null),this.replaceBackgroundSubscription=this.virtualBackgroundService.rxSubject.subscribe((e=>{"UPDATE_STREAM"===e.name&&this.onReplaceBackgroundChangeEvent(e)})),this.deviceManagementSubscription=this.deviceManagementService.subscribe((e=>{try{e.name===this.deviceManagementService.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED&&(this.logger.info(`[webrtcP2PService] deviceManagement event -- ${e.name} -- ${e.data.kind}`),("audioinput"===e.data.kind||"videoinput"===e.data.kind)&&setTimeout((()=>{this.onAudioVideoInputDeviceChange()}),1e3))}catch{}})),this.isMixPstnWebRtcAllowed=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.MIX_WEBRTC_PSTN_CALLS)||config.mixwebrtcpstn,this.logger.info("[webrtcP2PService] SERVICE | === STARTED ===")}async stop(){try{if(this.started){let e;for(this.started=false,this.xmppConnectionSubscription&&this.xmppConnectionSubscription.unsubscribe(),this.replaceBackgroundSubscription&&(this.replaceBackgroundSubscription.unsubscribe(),this.replaceBackgroundSubscription=null),this.deviceManagementSubscription&&(this.deviceManagementSubscription.unsubscribe(),this.deviceManagementSubscription=null);e=this.listeners.pop();)e();this.removeHandlers(),Object.keys(this.calls).forEach((e=>{this.calls[e]&&(this.calls[e].statsInterval&&(window.clearInterval(this.calls[e].statsInterval),this.calls[e].statsInterval=null),this.terminateAndRemoveCall(this.calls[e]))})),this.xmppService.connection.jingle.terminate(),this.connected=false,this.reconnectCall=false,this.makingCall=false,this.webrtcConfigAndUtils.stop(),this.logger.info("[webrtcP2PService] === STOPPED ===")}}catch(e){this.logger.info("[webrtcP2PService] SERVICE | === STOPPING ERROR : "+e)}}reconnect(){this.attachHandlers()}attachHandlers(){this.removeHandlers(),this.logger.info("[webrtcP2PService] attachHandlers"),this.webrtcP2PEventHandler=new u.WebrtcP2PEventHandler(this),this.reconnectSessionsIfNeeded()}removeHandlers(){this.logger.info("[webrtcP2PService] removeHandlers"),this.webrtcP2PEventHandler&&(this.webrtcP2PEventHandler=null)}reconnectSessionsIfNeeded(){this.logger.info("[webrtcP2PService] | reconnectSessionsIfNeeded"),this.connected=true,Object.keys(this.calls).forEach((e=>{if(this.calls[e]){const t=this.calls[e];t.statsInterval&&(window.clearInterval(t.statsInterval),t.statsInterval=null);const i=this.xmppService.connection.jingle.sessions[t.id];this.reconnectCall&&i&&i.peerconnection?(this.logger.info("[webrtcP2PService] | onConnectionStateChangeEvent : connected - start reconnection on session "+t.id),i.me=this.contactService.userContact.fullJid,i.isInitiator&&(i.initiator=i.me),i.connection=this.xmppService.connection,this.contactService.setBusyState("dnd",this.calculatePresenceMessage(t)),setTimeout((()=>{if(i.peerconnection){const e=i.peerconnection.connectionState?i.peerconnection.connectionState:i.peerconnection.iceConnectionState;if("stable"===i.peerconnection.signalingState&&"failed"!==e&&"disconnected"!==e)return void this.logger.info("[webrtcP2PService] sendTransportReplaceForSession not needed for "+i.sid);i.reconnectSession()}}),2e3)):i||this.rejectCall(t)}})),this.reconnectCall=false}subscribe(e){return this.rxSubject.subscribe(e)}sendEvent(e,t=null){this.rxSubject.next(n.RBEvent.create(e,t))}removeCallObject(e,t="",i=""){this.terminateAndRemoveCall(e,t,i)}terminateAndRemoveCall(e,t="",i=""){try{if(e){this.logger.info("[webrtcP2PService] terminateAndRemoveCall with id: "+e.id),e.status=o.Call.Status.UNKNOWN,e.stopDuration();const r=this.xmppService.connection.jingle.sessions?this.xmppService.connection.jingle.sessions[e.id]:null;r&&this.webrtcConfigAndUtils.disableAllStreamsForSession(r),this.webrtcConfigAndUtils.disableAllStreamsForSession(e),e.originalStream&&(e.originalStream.getTracks().forEach((e=>{e.enabled=false,e.stop(),e=null})),e.originalStream.stop&&e.originalStream.stop(),e.originalStream=null,this.virtualBackgroundService.stopProcessStream()),e.statsInterval&&(window.clearInterval(e.statsInterval),e.statsInterval=null),delete this.calls[e.id],this.eventService.publish("ON_CALL_UPDATED_EVENT",e),r&&this.xmppService.connection.jingle.terminate(e.id,t,i),this.sendEvent("stopHighlighting")}}catch(r){this.logger.info("[webrtcP2PService] terminateAndRemoveCall error "+r)}}onReplaceBackgroundChangeEvent(e){try{const t=this.getCurrentActiveCall();t&&(this.logger.info("[webrtcP2PService] onReplaceBackgroundChangeEvent"),this.changeBackgroundForCall(t,e.data,"none"===e.data.type))}catch(t){}}putActiveWebrtcCallOnHold(){const e=this.getActiveWebrtcAudioCall();e&&this.putCallOnHold(e)}onConnectionStateChangeEvent(e){try{"ON_XMPP_DISCONNECTED"===e.name?(this.logger.info("[webrtcP2PService] | onConnectionStateChangeEvent : disconnected"),this.connected=false):"ON_XMPP_CONNECTED"===e.name&&(this.connected=true)}catch(t){this.logger.info("[webrtcP2PService] | onConnectionStateChangeEvent : disconnected error : "+t)}}isUserContactInCall(){let e=false;return Object.keys(this.calls).forEach((t=>{if(this.calls[t]){const i=this.calls[t];i.status!==o.Call.Status.UNKNOWN&&i.status!==o.Call.Status.RINGING_INCOMMING&&(e=true)}})),e}getCurrentActiveCall(){let e=null;return Object.keys(this.calls).forEach((t=>{if(this.calls[t]){const i=this.calls[t];i.status!==o.Call.Status.UNKNOWN&&(e=i)}})),e}getCurrentActiveSessions(){const e=[];return Object.keys(this.calls).forEach((t=>{if(this.calls[t]){const i=this.calls[t];if(i.status!==o.Call.Status.UNKNOWN){const t=this.xmppService.connection.jingle.sessions[i.id];t&&e.push(t)}}})),e}getCurrentCallsNotMediaPillar(){const e=[];return Object.keys(this.calls).forEach((t=>{if(this.calls[t]){const i=this.calls[t];i.status===o.Call.Status.UNKNOWN||i.isMediaPillarCall()||e.push(i)}})),e}existWebrtcActiveSessionNotMP(){let e=false;return Object.keys(this.calls).forEach((t=>{if(this.calls[t]){const i=this.calls[t];i.status===o.Call.Status.UNKNOWN||!this.xmppService.connection.jingle.sessions[i.id]||i.isMediaPillarCall()||i.isSecondSharingCall||(e=true)}})),e}existMediaPillarAudioCall(){let e=false;return Object.keys(this.calls).forEach((t=>{if(this.calls[t]){const i=this.calls[t];i.status!==o.Call.Status.UNKNOWN&&i.localMedia&o.Call.Media.AUDIO&&i.isMediaPillarCall()&&(e=true)}})),e}getMediaPillarAudioCalls(){const e=[];return Object.keys(this.calls).forEach((t=>{if(this.calls[t]){const i=this.calls[t];i.status!==o.Call.Status.UNKNOWN&&i.localMedia&o.Call.Media.AUDIO&&i.isMediaPillarCall()&&e.push(i)}})),e}isInMediaPillarAudioCallWithContactJid(e){let t=false;return Object.keys(this.calls).forEach((i=>{if(this.calls[i]){const r=this.calls[i];r.status!==o.Call.Status.UNKNOWN&&r.localMedia&o.Call.Media.AUDIO&&r.isMediaPillarCall()&&r.fullJid===e&&(t=true)}})),t}hasMediaPillarCallWithContactJid(e){let t=false;return Object.keys(this.calls).forEach((i=>{if(this.calls[i]){const r=this.calls[i];r.status!==o.Call.Status.UNKNOWN&&r.localMedia&o.Call.Media.AUDIO&&r.isMediaPillarCall()&&r.contact&&r.contact.jid===e&&(t=true)}})),t}getCallOnHold(){let e=null;return Object.keys(this.calls).forEach((t=>{if(this.calls[t]){const i=this.calls[t];i.status!==o.Call.Status.HOLD||i.isMediaPillarCall()||(e=i)}})),e}getWebrtcAudioCall(){let e=null;return Object.keys(this.calls).forEach((t=>{if(this.calls[t]){const i=this.calls[t];i.status!==o.Call.Status.UNKNOWN&&i.localMedia&o.Call.Media.AUDIO&&!i.isMediaPillarCall()&&(e=i)}})),e}getActiveWebrtcAudioCall(){let e=null;return Object.keys(this.calls).forEach((t=>{if(this.calls[t]){const i=this.calls[t];i.status===o.Call.Status.ACTIVE&&i.localMedia&o.Call.Media.AUDIO&&!i.isMediaPillarCall()&&(e=i)}})),e}getMPWebrtcAudioCallByState(e){let t=null;return e?(Object.keys(this.calls).forEach((i=>{if(this.calls[i]){const r=this.calls[i];r.status===e&&null===r.mediaPillarCall&&r.isWebRtcMediaPillar()&&(t=r)}})),t):t}getCurrentSharingCall(){let e=null;return Object.keys(this.calls).forEach((t=>{if(this.calls[t]){const i=this.calls[t];i.status===o.Call.Status.UNKNOWN||i.localMedia!==o.Call.Media.SHARING&&i.remoteMedia!==o.Call.Media.SHARING||(e=i)}})),e}getOrCreateCallByCallId(e){let t=this.calls[e];if(!t){const i=this.xmppService.connection.jingle.sessions[e],r=this.xmppService.getBareJidFromJid(i.peerjid),n=this.contactService.getContactByJid(r);t=o.Call.create(o.Call.Status.UNKNOWN,e,o.Call.Type.WEBRTC,n),this.calls[t.id]=t}return t}getCallByContact(e){let t=null;return Object.keys(this.calls).forEach((i=>{if(this.calls[i]){const r=this.calls[i];r.contact&&e.jid===r.contact.jid&&(t=r)}})),t}endAllCallsForContact(e){e&&(this.logger.info("[webrtcP2PService] endAllCallsForContact "+e.jid),Object.keys(this.calls).forEach((t=>{if(this.calls[t]){const i=this.calls[t];i.status!==o.Call.Status.UNKNOWN&&i.contact&&i.contact.jid===e.jid&&!i.isWebRtcMediaPillar()&&i.localMedia===o.Call.Media.SHARING&&(this.logger.info("[webrtcP2PService] endAllCallsForContact "+e.jid+" release call (sharing): "+i),this.releaseCall(i))}})))}onVideoInputChangeEvent(){this.logger.info("[webrtcP2PService] MEDIA   | onVideoInputChangeEvent"),Object.keys(this.calls).forEach((e=>{if(this.calls[e]){const t=this.calls[e];this.xmppService.connection.jingle.sessions[t.id]&&t.localMedia&&t.localMedia&o.Call.Media.AUDIO&&t.localMedia&o.Call.Media.VIDEO&&(this.logger.info("[webrtcP2PService] MEDIA   | audio + video call, renegotiate the profile"),this.addVideoToCall(t,true))}}))}onAudioVideoInputDeviceChange(){this.audioProfileChanging&&this.logger.info("[webrtcP2PService] onAudioVideoInputDeviceChange -- ignore"),this.logger.info("[webrtcP2PService] onAudioVideoInputDeviceChange"),this.audioProfileChanging=true,Object.keys(this.calls).forEach((e=>{if(this.calls[e]){const t=this.calls[e];this.updateLocalAudioStreamForCall(t)}})),this.audioProfileChanging=false}getCallById(e){this.logger.info("[webrtcP2PService] getCallById "+e);let t=null;return Object.keys(this.calls).forEach((i=>{if(this.calls[i]){const r=this.calls[i];r.id===e&&(t=r)}})),t}getCallByJid(e,t=""){let i=null;return e||t?(this.logger.info("[webrtcP2PService] getCallByJid "+e),Object.keys(this.calls).forEach((t=>{if(this.calls[t]){const r=this.calls[t];r.contact&&r.contact.jid===e&&(i=r)}})),i||(this.logger.info("[webrtcP2PService] getCallByJid fallback "+t),Object.keys(this.calls).forEach((e=>{if(this.calls[e]){const r=this.calls[e];r&&r.fullJid===t&&(i=r)}}))),i):i}async resetAudioOutputElement(){config.deviceManagement&&this.logger.warn("[webrtcP2PService] resetAudioOutputElement -- should use the new device management!")}makeVideoCall(e){this.makeCall(e,"videoOnly")}makeDesktopSharingCall(e,t="sharing"){t||(t="sharing"),"sharing"===t&&this.isMixPstnWebRtcAllowed&&this.existMediaPillarAudioCall()&&this.eventService.publish("PUT_ACTIVE_TELEPHONY_CALL_ON_HOLD"),this.makingCall=true,this.logger.info("[webrtcP2PService] MEDIA   | makeDesktopSharingCall - trying to start a desktop sharing call with media "+t),this.webrtcP2PEventHandler.sendProposition(e,t),this.sendEvent("startHighlighting")}async makeCall(e,t,i=""){if(this.logger.info("[webrtcP2PService] MEDIA   | makeCall to "+JSON.stringify({displayName:e.nameForLogs,resources:e.resources})),this.makingCall)return void this.logger.info("[webrtcP2PService] | makeCall already making a call !");this.makingCall=true,this.isMixPstnWebRtcAllowed&&this.existMediaPillarAudioCall()&&this.eventService.publish("PUT_ACTIVE_TELEPHONY_CALL_ON_HOLD");const r=this.getActiveWebrtcAudioCall();r?(this.putCallOnHold(r),this.eventService.publish("CREATE_RAINBOW_ANALYTICS_EVENT",{category:"multi-call-management",action:"make-call-without-prior-hold"})):this.getCallOnHold()&&this.eventService.publish("CREATE_RAINBOW_ANALYTICS_EVENT",{category:"multi-call-management",action:"make-call-after-hold"}),await this.webrtcP2PEventHandler.sendProposition(e,t,i)}answerCall(e,t=""){e.isMediaPillarCall()||e.remoteMedia===o.Call.Media.SHARING||this.eventService.publish("PUT_ACTIVE_TELEPHONY_CALL_ON_HOLD");const i=this.getActiveWebrtcAudioCall();i?(this.putCallOnHold(i),this.eventService.publish("CREATE_RAINBOW_ANALYTICS_EVENT",{category:"multi-call-management",action:"take-call-without-prior-hold"})):this.getCallOnHold()&&this.eventService.publish("CREATE_RAINBOW_ANALYTICS_EVENT",{category:"multi-call-management",action:"take-call-after-hold"}),this.webrtcP2PEventHandler.acceptProposition(e,t)}rejectCall(e,t=""){if(!e)return void this.logger.info("[webrtcP2PService] MEDIA   | rejectCall - trying to rejectCall a non existing call !");this.makingCall=false,this.autoreleaseTimeout&&clearTimeout(this.autoreleaseTimeout);this.xmppService.connection.jingle.sessions[e.id]?this.releaseCall(e):e.isInitiator?this.webrtcP2PEventHandler.retractProposition(e):this.webrtcP2PEventHandler.rejectProposition(e,t)}releaseCall(e,t="",i=""){if(e){this.makingCall=false,this.logger.info("[webrtcP2PService] MEDIA   | releaseCall : "+e);try{const r=this.xmppService.connection.jingle.sessions[e.id];this.webrtcConfigAndUtils.disableAllStreamsForSession(r),this.eventService.publish("CHECK_AND_RESET_BUSY_STATE"),this.autoreleaseTimeout&&clearTimeout(this.autoreleaseTimeout),this.webrtcConfigAndUtils.createOrUpdateStatisticsForCall(e),this.webrtcConfigAndUtils.callsStats[e.id]&&delete this.webrtcConfigAndUtils.callsStats[e.id],this.webrtcConfigAndUtils.callsStatsSimplified[e.id]&&delete this.webrtcConfigAndUtils.callsStatsSimplified[e.id],this.removeCallObject(e,t,i),this.isUserContactInCall()||this.clearSrcObjectsFromElements()}catch(r){this.logger.info("[webrtcP2PService] MEDIA   | releaseCall ERROR"),this.logger.error(r),this.webrtcConfigAndUtils.createOrUpdateStatisticsForCall(e),this.webrtcConfigAndUtils.callsStats[e.id]&&delete this.webrtcConfigAndUtils.callsStats[e.id],this.webrtcConfigAndUtils.callsStatsSimplified[e.id]&&delete this.webrtcConfigAndUtils.callsStatsSimplified[e.id],this.resetToSafeState(e),this.removeCallObject(e)}}else this.logger.info("[webrtcP2PService] MEDIA   | releaseCall - trying to release a non existing call !")}async makeJingleCall(e,t="",i="",r=""){try{this.logger.info("[webrtcP2PService] makeJingleCall"),await this.webrtcConfigAndUtils.setWebrtcConfiguration();let n="";e.localMedia&o.Call.Media.AUDIO&&(n="audio"),e.localMedia&o.Call.Media.VIDEO&&(n=n?"audio+video":"video"),t&&""!==t&&this.logger.info("[webrtcP2PService] MEDIA   | makeJingleCall in mediaPillar case for number : "+i),t&&""!==t&&i&&""!==i?(n="sip",this.xmppService.connection.jingle.initiate(t,this.xmppService.connection.jid,n,e.localStreams,e.id,null,i)):this.xmppService.connection.jingle.initiate(e.fullJid,this.xmppService.connection.jid,n,e.localStreams,e.id,null,null,false,false,r),e.status=o.Call.Status.CONNECTING,this.eventService.publish("ON_CALL_UPDATED_EVENT",e)}catch(n){this.logger.info("[webrtcP2PService] MEDIA   | makeCall failure : "+JSON.stringify({error:n.message})),this.makingCall=false,e&&this.removeCallObject(e),this.resetToSafeState(e)}}async makeJingleSharingCall(e){try{this.logger.info("[webrtcP2PService] MEDIA   | makeJingleSharingCall - make desktop sharing call");let t="sharing";e.localMedia===o.Call.Media.SHARING&&(t="sharing-only"),await this.webrtcConfigAndUtils.setWebrtcConfiguration(),this.logger.info("[webrtcP2PService] SHARING | getUserMedia success");const i=[],r=this.getMediaPillarAudioCalls();r.forEach((e=>{const t=this.xmppService.connection.jingle.sessions[e.id],r=t?t.localStreams:null;r&&i.push.apply(i,r)}));const n=r&&0!==r.length?e.localStreams.filter((function(e){return!(i&&i.includes(e))})):e.localStreams;this.xmppService.connection.jingle.initiate(e.fullJid,this.xmppService.connection.jid,t,n,e.id),e.status=o.Call.Status.CONNECTING,this.eventService.publish("ON_CALL_UPDATED_EVENT",e)}catch(t){this.makingCall=false,e&&this.removeCallObject(e),this.resetToSafeState(e),this.logger.info("[webrtcP2PService] MEDIA   | makeJingleSharingCall failure : "+JSON.stringify({error:t.message}))}}startDesktopSharing(e,t){if(this.makingCall)return void this.logger.info("[webrtcP2PService] | startDesktopSharing already making a call !");this.makingCall=true;!this.askToStartSharing(e.jid,t)&&this.makeDesktopSharingCall(e,t)}startSharingCancelled(){this.makingCall=false}async answerJingleCall(e){try{this.logger.info("[webrtcP2PService] MEDIA   | answerJingleCall "+e.id);const t=[];let i="audio";e.localMedia&o.Call.Media.AUDIO&&t.push("audio"),e.localMedia&o.Call.Media.VIDEO&&(t.push("video"),i="audio+video"),e.localMedia===o.Call.Media.VIDEO&&(i="video");let r={};e.isInConversationWithMobile()&&(r=this.webrtcConfigAndUtils.getMobileMediaConstraints("video")),await this.webrtcConfigAndUtils.setWebrtcConfiguration();const n=await this.getBrowserMedia(t,r.fixedVideoWidth,r.fixedVideoHeight,r.fixedFrameRate),s=this.xmppService.connection.jingle.sessions[e.id];if(!s)return n&&this.disableStreams([n]),this.releaseCall(e),void this.resetToSafeState(e);if(n){let i=n;-1!==t.indexOf("video")&&(e.originalStream=n,i=await this.virtualBackgroundService.startProcessStream(n)),this.pushInLocalStreams(i,e.id),s.addStream(i),s.localStreams.push(i)}else i=null;s.localType=i,s.sendAnswer(),s.accept(),this.eventService.publish("ON_CALL_UPDATED_EVENT",e)}catch(t){this.logger.info("[webrtcP2PService] MEDIA   | answerJingleCall failure for : "+e+" failure : "+t.message),-1!==t.toString().indexOf("getUserMedia")&&(this.releaseCall(e),this.openErrorPopup()),this.resetToSafeState(e)}}onCallTransferred(e){const t=this.xmppService.connection.jingle.sessions[e.id];this.webrtcConfigAndUtils.disableAllStreamsForSession(t),this.autoreleaseTimeout&&clearTimeout(this.autoreleaseTimeout),this.webrtcConfigAndUtils.createOrUpdateStatisticsForCall(e),this.webrtcConfigAndUtils.callsStats[e.id]&&delete this.webrtcConfigAndUtils.callsStats[e.id],this.webrtcConfigAndUtils.callsStatsSimplified[e.id]&&delete this.webrtcConfigAndUtils.callsStatsSimplified[e.id],this.removeCallObject(e)}askToAddDesktopSharing(e){this.logger.info("[webrtcP2PService] MEDIA   | askToAddDesktopSharing - Desktop sharing escalation");!this.askToAddSharing(e.id)&&this.addSharingToCall(e.videoCall)}async addAudioToCall(e,t=false){try{this.logger.info("[webrtcP2PService] MEDIA   | addAudioToCall");const i=this.xmppService.connection.jingle.sessions[e.id];i.isRenegotiating=true;const r=["audio"],n=await this.getBrowserMedia(r);this.stopActiveAudioVideoStreams(i),this.pushInLocalStreams(n,e.id);for(let t=0;t<e.localStreams.length;t++)i.removeStream(e.localStreams[t]);const s=t?"contentModify":"contentAdd";this.updateCurrentCall(e,i,"audio",s),"contentModify"===s&&i.muteAudio(e.isMuted)}catch(i){this.logger.info("[webrtcP2PService] MEDIA   | addAudioToCall failure : "+i),this.releaseCall(e),this.resetToSafeState(e)}}async addSharingToCall(e){this.logger.info("[webrtcP2PService] MEDIA   | addSharingToCall - Desktop sharing escalation");const t=this.xmppService.connection.jingle.sessions[e.id];try{t.isRenegotiating=true;const i=["sharing"];let r={};e.isInConversationWithMobile()&&(r=this.webrtcConfigAndUtils.getMobileMediaConstraints("sharing"));const n=await this.getBrowserMedia(i,null,null,r.fixedFrameRate);for(let s=0;s<e.localStreams.length;s++)t.removeStream(e.localStreams[s]),t.localStreams[s]=null;t.localStreams=[],this.pushInLocalStreams(n,e.id);for(let s=0;s<e.localStreams.length;s++)t.removeStream(e.localStreams[s]);this.updateCurrentCall(e,t,"sharing","contentAdd"),this.sendEvent("startHighlighting")}catch(i){this.logger.info("[webrtcP2PService] MEDIA   | addSharingToCall failure : "+i),t.isRenegotiating=false,-1!==i.toString().indexOf("getUserMedia")&&this.openErrorPopup()}}async addVideoToCall(e,t=false){try{this.logger.info("[webrtcP2PService] MEDIA   | addVideoToCall");const i=this.xmppService.connection.jingle.sessions[e.id],r=["audio","video"];i.isRenegotiating=true;let n={};e.isInConversationWithMobile()&&(n=this.webrtcConfigAndUtils.getMobileMediaConstraints("video"));const s=await this.getBrowserMedia(r,n.fixedVideoWidth,n.fixedVideoHeight,n.fixedFrameRate);this.stopActiveAudioVideoStreams(i),e.originalStream&&(e.originalStream.getTracks().forEach((e=>{e.enabled=false,e.stop(),e=null})),e.originalStream.stop&&e.originalStream.stop(),e.originalStream=null);let o=s;-1!==r.indexOf("video")&&(e.originalStream=s,o=await this.virtualBackgroundService.startProcessStream(s)),this.pushInLocalStreams(o,e.id);for(let t=0;t<e.localStreams.length;t++)i.removeStream(e.localStreams[t]);const a=t?"contentModify":"contentAdd";this.updateCurrentCall(e,i,"video",a),i.muteAudio(e.isMuted)}catch(i){this.logger.info("[webrtcP2PService] MEDIA   | addVideoToCall failure for : "+e+" failure : "+i.message),-1!==i.toString().indexOf("getUserMedia")?(this.logger.warn("[webrtcP2PService] addVideoToCall impossible, no webcam plugged"),this.openErrorPopup()):(this.releaseCall(e),this.resetToSafeState(e))}}changeBackgroundForCall(e,t,i){const r=this.xmppService.connection.jingle.sessions[e.id];r.isRenegotiating=true;for(let s=0;s<e.localStreams.length;s++)r.removeStream(e.localStreams[s]);let n=-1;e.localStreams.forEach(((t,i)=>{t.id===e.originalStream.id&&(n=i)})),-1!==n&&e.localStreams.splice(n,1),n=-1,r.localStreams.forEach(((t,i)=>{t.id===e.originalStream.id&&(n=i)})),-1!==n&&r.localStreams.splice(n,1),i&&this.stopActiveAudioVideoStreams(r),this.pushInLocalStreams(t.stream,e.id),this.updateCurrentCall(e,r,"video","contentModify"),r.muteAudio(e.isMuted)}removeSharingFromCall(e){this.logger.info("[webrtcP2PService] MEDIA   | removeSharingFromCall");const t=this.xmppService.connection.jingle.sessions[e.id];this.stopActiveSharingStream(t),t.isRenegotiating=true,this.updateCurrentCall(e,t,"sharing","contentRemove"),this.sendEvent("stopHighlighting")}async removeVideoAndSharingFromCall(e){try{this.logger.info("[webrtcP2PService]  MEDIA   | removeVideoAndSharingFromCall");const t=this.xmppService.connection.jingle.sessions[e.id];this.stopAllActiveStreams(t),this.sendEvent("stopHighlighting"),e.originalStream&&(e.originalStream.getTracks().forEach((e=>{e.enabled=false,e.stop(),e=null})),e.originalStream.stop&&e.originalStream.stop(),e.originalStream=null,this.virtualBackgroundService.stopProcessStream()),e.localStreams.forEach((function(e){t.removeStream(e)}));const i=["audio"];t.isRenegotiating=true;const r=await this.getBrowserMedia(i);this.pushInLocalStreams(r,e.id),e.localMedia=o.Call.Media.AUDIO,this.updateCurrentCall(e,t,"video","contentRemove"),t.muteAudio(true)}catch(t){this.logger.info("[webrtcP2PService] MEDIA   | removeVideoAndSharingFromCall failure for : "+e+" failure : "+t),-1!==t.toString().indexOf("getUserMedia")&&this.openErrorPopup(),this.releaseCall(e),this.resetToSafeState(e)}}async removeVideoFromCall(e){try{this.logger.info("[webrtcP2PService] MEDIA   | removeVideoFromCall");const t=this.xmppService.connection.jingle.sessions[e.id];this.stopActiveAudioVideoStreams(t),e.originalStream&&(e.originalStream.getTracks().forEach((e=>{e.enabled=false,e.stop(),e=null})),e.originalStream.stop&&e.originalStream.stop(),e.originalStream=null,this.virtualBackgroundService.stopProcessStream()),e.localStreams.forEach((function(e){t.removeStream(e)}));const i=["audio"];t.isRenegotiating=true;const r=await this.getBrowserMedia(i);this.pushInLocalStreams(r,e.id),this.updateCurrentCall(e,t,"video","contentRemove"),e.status===o.Call.Status.PUT_ON_HOLD?t.muteAudio(true):t.muteAudio(e.isMuted)}catch(t){this.logger.info("[webrtcP2PService] MEDIA   | removeVideoFromCall failure for : "+e+" failure : "+t),-1!==t.toString().indexOf("getUserMedia")&&this.openErrorPopup(),this.releaseCall(e),this.resetToSafeState(e)}}muteAudio(e,t){const i=e.videoCall;if(!i)throw new Error("[webrtcP2PService] MEDIA   | muteAudio - trying to mute a non existing call !");this.logger.info("[webrtcP2PService] MEDIA   | mute audio: "+i+" | state: "+t),e.isMutedAudio=t,i.isMuted=t;const r=this.xmppService.connection.jingle.sessions[i.id];if(!r)throw new Error("[webrtcP2PService] MEDIA   | muteAudio - trying to mute a non existing session !");return r.muteAudio(t),this.eventService.publish("ON_CONVERSATION_CALL_MUTED_UPDATED_EVENT",{conversation:e,call:i}),i}sendDTMF(e,t,i=false){const r=this.xmppService.connection.jingle.sessions[t.id];if(r&&r.peerconnection){const n=r.peerconnection.getSenders().find((function(e){return e.dtmf&&e.track&&e.track.enabled&&"audio"===e.track.kind})),s=n?n.dtmf:null;s?(this.logger.info("[webrtcP2PService] sendDTMF: dtmf sender found on webrtc session for call id "+t.id+" dialstring: "+e),s.ontonechange=i?this.silentToneChangeEventHandle.bind(this):this.handleToneChangeEvent.bind(this),s.insertDTMF(e)):this.logger.error("[webrtcP2PService]sendDTMF: no dtmf sender found on webrtc session for call id "+t.id)}else this.logger.error("[webrtcP2PService]sendDTMF: no webrtc session found for call id "+t.id)}putCallOnHold(e){this.logger.info("[webrtcP2PService] putCallOnHold for call "+e.id);const t=this.xmppService.connection.jingle.sessions[e.id];e.localMedia&o.Call.Media.VIDEO&&(e.addVideoAfterUnhold=true),(e.localMedia&o.Call.Media.VIDEO||e.localMedia&o.Call.Media.SHARING)&&this.removeVideoAndSharingFromCall(e),t&&(t.sendHold(true),t.muteAudio(true),e.onHold=true,e.setStatus(o.Call.Status.HOLD),this.eventService.publish("ON_CALL_UPDATED_EVENT",e))}retrieveCallOnHold(e){this.logger.info("[webrtcP2PService] retrieveCallOnHold for call "+e.id);const t=this.xmppService.connection.jingle.sessions[e.id];if(t){this.eventService.publish("PUT_ACTIVE_TELEPHONY_CALL_ON_HOLD");const i=this.getActiveWebrtcAudioCall();i?(this.putCallOnHold(i),this.eventService.publish("CREATE_RAINBOW_ANALYTICS_EVENT",{category:"multi-call-management",action:"alternate"})):this.eventService.publish("CREATE_RAINBOW_ANALYTICS_EVENT",{category:"multi-call-management",action:"retrieve"}),t.sendHold(false),t.muteAudio(e.isMuted),e.onHold=false,e.setStatus(o.Call.Status.ACTIVE),this.eventService.publish("ON_CALL_UPDATED_EVENT",e),this.attachDistantMediaStreams(true,e),e.addVideoAfterUnhold&&this.addVideoToCall(e),e.addVideoAfterUnhold=false}}referTo(e,t,i){e?e.sendRefer(t,i):this.logger.info("[webrtcP2PService] MEDIA   | referTo - trying to transfer a non existing session !")}transferCall(e,t){e&&t?e.sendP2PTrasnferCallRefer(t.sid,t.peerjid):this.logger.info("[webrtcP2PService] MEDIA   | trasnferCall - trying to transfer a non existing session !")}sendReferStatus(e,t){const i=this.xmppService.connection.jingle.sessions[e];i?(this.logger.info("[webrtcP2PService] MEDIA   | sendReferStatus - "+t),i.sendReferStatus(t)):this.logger.info("[webrtcP2PService] MEDIA   | sendReferStatus - trying to transfer a non existing session !")}sendReferTransfer(e,t,i){const r=this.xmppService.connection.jingle.sessions[e];r?(this.logger.info("[webrtcP2PService] MEDIA   | sendReferTransfer - method "+t+" referTo "+i),r.sendReferTransfer(t,i)):this.logger.info("[webrtcP2PService] MEDIA   | sendReferStatus - trying to transfer a non existing session !")}disableStreams(e){if(e&&e.length)for(e.forEach((function(e){e.getTracks().forEach((function(e){e.enabled=false,e.stop(),e=null})),e=null}));e.length>0;)e.pop()}pushInLocalStreams(e,t){e.callId=t;const i=this.calls[t];i&&i.localStreams.push(e)}openErrorPopup(e=""){e||(e="cameraNotAvailable"),this.eventService.publish("ON_WEBRTC_CALL_ERROR_EVENT",e)}stopActiveSharingStream(e){if(e){const t=this.calls[e.sid];if(t&&t.localStreams.length){for(let e=0;e<t.localStreams.length;e++)if(t.localStreams[e]&&t.localStreams[e].getVideoTracks().length&&!t.localStreams[e].getAudioTracks().length){let i=t.localStreams.splice(e,1);i=i[0],i.getTracks().forEach((function(e){e.enabled=false,e.stop(),e=null})),i.stop&&i.stop(),i=null}}}e&&e.localStreams&&(e.localStreams.forEach((function(t){t.getVideoTracks().length&&!t.getAudioTracks().length&&(t.getTracks().forEach((function(e){e.enabled=false,e.stop(),e=null})),t.stop&&t.stop()),e.removeStream(t)})),e.localStreams=[]),e&&this.xmppService.connection.jingle.localStream&&e.removeStream(this.xmppService.connection.jingle.localStream)}stopActiveAudioVideoStreams(e,t=false){if(e){const i=this.calls[e.sid];if(i&&i.localStreams.length){if(t)for(;i.localStreams.length;){let e=i.localStreams.pop();e.getTracks().forEach((e=>{e.enabled=false,e.stop(),e=null})),e.stop&&e.stop(),e=null}else for(let e=0;e<i.localStreams.length;e++)if(i.localStreams[e]&&i.localStreams[e].getAudioTracks().length){let t=i.localStreams.splice(e,1);t=t[0],t.getTracks().forEach((e=>{e.enabled=false,e.stop(),e=null})),t.stop&&t.stop(),t=null}}}if(e&&e.localStreams){if(e.localStreams.forEach((function(i){(i.getAudioTracks().length||t)&&(i.getTracks().forEach((function(e){e.enabled=false,e.stop(),e=null})),i.stop&&i.stop(),e.removeStream(i))})),t)for(;e.localStreams.length;){e.localStreams.pop()}e.localStreams=[]}e&&this.xmppService.connection.jingle.localStream&&e.removeStream(this.xmppService.connection.jingle.localStream)}resetToSafeState(e=null){this.logger.info("[webrtcP2PService] MEDIA   | resetToSafeState"),this.autoreleaseTimeout&&clearTimeout(this.autoreleaseTimeout),e&&e.localStreams.length&&this.disableStreams(e.localStreams),e&&e.originalStream&&this.disableStreams([e.originalStream]),this.eventService.publish("CHECK_AND_RESET_BUSY_STATE")}getConstraintsForMedia(e,t,i,r,n){let s={},o=t||this.webrtcConfigAndUtils.videoQualityConfiguration.video.fixedVideoWidth,a=i||this.webrtcConfigAndUtils.videoQualityConfiguration.video.fixedVideoHeight,c=r||this.webrtcConfigAndUtils.videoQualityConfiguration.video.fixedFrameRate;if(e.indexOf("sharing")>=0&&(o=t||this.webrtcConfigAndUtils.videoQualityConfiguration.sharing.fixedVideoWidth,a=i||this.webrtcConfigAndUtils.videoQualityConfiguration.sharing.fixedVideoHeight,c=r||this.webrtcConfigAndUtils.videoQualityConfiguration.sharing.fixedFrameRate),this.logger.info("[webrtcP2PService] GetUserMedia new deviceManagement"),e.indexOf("audio")>=0){const e=this.deviceManagementService.getCurrentAudioInputDevice();let t="default";e&&e.deviceId?(s.audio={deviceId:{exact:e.deviceId}},t="id - "+e.deviceId+" and label "+e.label):s.audio=true,this.logger.info("[webrtcP2PService] GetUserMedia for microphone "+t)}if(e.indexOf("video")>=0){s.video={width:o,height:a,frameRate:c};const e=this.deviceManagementService.getCurrentVideoInputDevice();let t="default";e&&e.deviceId&&"default"!==e.deviceId&&(s.video.deviceId={exact:e.deviceId},t="id - "+e.deviceId+" and label "+e.label),this.logger.info("[webrtcP2PService] GetUserMedia for camera "+t)}if(e.indexOf("sharing")>=0)if(this.isNativeApplication()||"chrome"!==window.adapter.default.browserDetails.browser)if("firefox"===window.adapter.default.browserDetails.browser)s.video={mediaSource:this.firefoxPreferedSharing};else{const e=this.getDesktopSharingSource(),t=e&&e.chromeMediaSource?e.chromeMediaSource:"desktop",i=e&&e.chromeMediaSourceId?e.chromeMediaSourceId:null;s.video={mandatory:{chromeMediaSource:t,maxWidth:o,maxHeight:a,maxFrameRate:c}},n&&(s.audio={mandatory:{chromeMediaSource:"desktop"}}),i&&(s.video.mandatory.chromeMediaSourceId=i)}else s={},s={audio:n,video:{chromeMediaSource:"desktop",width:{max:o},height:{max:a},frameRate:{ideal:c}}};return s.audio||(s.audio=false),s.video||(s.video=false),s}async getBrowserMedia(e,t=0,i=0,r=0,n=null,s=false){try{let o=null;if(s=Boolean(s),!e||0===e.length)return o;let a=false;const c=this.getConstraintsForMedia(e,t,i,r,s);if(e.indexOf("sharing")>=0&&!this.isNativeApplication()&&"chrome"===window.adapter.default.browserDetails.browser&&(a=true),this.logger.info("[webrtcP2PService] GetUserMedia with constraint "+JSON.stringify(c)),!c)throw new Error("getUserMedia cancelled");if(a){if(o=await navigator.mediaDevices.getDisplayMedia(c),this.logger.info("[webrtcP2PService] | getDisplayMedia success"),o.getVideoTracks().length&&this.logger.info("[webrtcP2PService] getDisplayMedia video stream kind "+o.getVideoTracks()[0].kind+", id "+o.getVideoTracks()[0].id+", label "+o.getVideoTracks()[0].label+", readyState "+o.getVideoTracks()[0].readyState+", enabled "+o.getVideoTracks()[0].enabled),o&&(0===o.getAudioTracks().length&&0===o.getVideoTracks().length||false===o.active))throw this.logger.info("[webrtcP2PService] Stream has no active audio or video tracks"),new Error("getDisplayMedia failure : Stream has no active audio or video tracks");o.getVideoTracks()[0].onended=()=>{this.logger.info("[webrtcP2PService] Stop screensharing in chrome has been triggered"),this.eventService.publish("ON_CHROME_STOP_SCREEN_SHARING_TRIGGERED"),this.sendEvent("ON_CHROME_STOP_SCREEN_SHARING_TRIGGERED",{webinar:n})}}else{if(o=await navigator.mediaDevices.getUserMedia(c),this.logger.info("[webrtcP2PService] | getUserMedia success"),o.getAudioTracks().length&&this.logger.info("[webrtcP2PService] getUserMedia audio stream kind "+o.getAudioTracks()[0].kind+", id "+o.getAudioTracks()[0].id+", label "+o.getAudioTracks()[0].label+", readyState "+o.getAudioTracks()[0].readyState+", enabled "+o.getAudioTracks()[0].enabled),o.getVideoTracks().length&&this.logger.info("[webrtcP2PService] getUserMedia video stream kind "+o.getVideoTracks()[0].kind+", id "+o.getVideoTracks()[0].id+", label "+o.getVideoTracks()[0].label+", readyState "+o.getVideoTracks()[0].readyState+", enabled "+o.getVideoTracks()[0].enabled),o&&(0===o.getAudioTracks().length&&0===o.getVideoTracks().length||false===o.active))throw this.logger.info("[webrtcP2PService] Stream has no active audio or video tracks"),new Error("getUserMedia failure : Stream has no active audio or video tracks");e.indexOf("sharing")>=0&&(o.getVideoTracks()[0].onended=()=>{this.logger.info("Stop screensharing native button has been triggered"),this.eventService.publish("ON_CHROME_STOP_SCREEN_SHARING_TRIGGERED"),this.sendEvent("ON_CHROME_STOP_SCREEN_SHARING_TRIGGERED",{webinar:n})}),o&&o.getAudioTracks().length&&(o.getAudioTracks()[0].onended=e=>{this.logger.error("[webrtcP2PService] getUserMedia -- audio stream track ended"),this.logger.error(this),this.logger.error(e)})}return o}catch(dp){throw this.logger.info("[webrtcP2PService] | getUserMedia failure: "+dp),new Error("getUserMedia failure "+dp)}}calculatePresenceMessage(e){let t="audio";return e&&e.localMedia&o.Call.Media.VIDEO&&(t="video"),e&&e.remoteMedia&o.Call.Media.VIDEO&&(t="video"),e&&e.localMedia&o.Call.Media.SHARING&&(t="sharing"),t}updateRemoteTypeMedia(e,t){switch(e){case"audio":t.remoteMedia=o.Call.Media.AUDIO;break;case"video":t.remoteMedia=o.Call.Media.VIDEO;break;case"audio+video":t.remoteMedia=o.Call.Media.AUDIO|o.Call.Media.VIDEO;break;case"sharing":t.remoteMedia=o.Call.Media.SHARING|o.Call.Media.AUDIO;break;case"sharing-only":t.remoteMedia=o.Call.Media.SHARING;break;default:t.remoteMedia=null}this.logger.debug("[webrtcP2PService] updateRemoteTypeMedia "+t.remoteMedia)}async updateLocalAudioStreamForCall(e){const t=this.xmppService.connection.jingle.sessions[e.id];if(t)try{const i=["audio"],r=e.localMedia&o.Call.Media.VIDEO;let n;if(r&&i.push("video"),r&&e.originalStream&&(e.originalStream.getTracks().forEach((e=>{e.enabled=false,e.stop(),e=null})),e.originalStream.stop&&e.originalStream.stop(),e.originalStream=null),e.localMedia&o.Call.Media.SHARING)for(let e=0;e<t.localStreams.length;e++)t.localStreams[e]&&t.localStreams[e].getVideoTracks().length&&!t.localStreams[e].getAudioTracks().length&&(n=t.localStreams.splice(e,1)[0]);this.webrtcConfigAndUtils.disableMediaStreams(t.localStreams),t.localStreams=[],e.localStreams=[];const s=await this.getBrowserMedia(i);let a=s;r&&(e.originalStream=s,a=await this.virtualBackgroundService.startProcessStream(s)),await t.replaceTransceiverTrack(a.getAudioTracks()[0],0),r&&await t.replaceTransceiverTrack(a.getVideoTracks()[0],1),t.localStreams.push(a),this.pushInLocalStreams(a,e.id),n&&(t.localStreams.push(n),this.pushInLocalStreams(n,e.id)),this.logger.info("[webrtcP2PService] onAudioVideoInputDeviceChange -- success 'on the fly'"),this.eventService.publish("ON_WEBRTC_CALL_ESCALATION",e),this.sendEvent("localMediaUpdate")}catch{e.localMedia&o.Call.Media.VIDEO?this.addVideoToCall(e,true):this.addAudioToCall(e,true),this.logger.info("[webrtcP2PService] onAudioVideoInputDeviceChange -- success 'via transport-replace'")}else e&&!t&&setTimeout((()=>{this.onAudioVideoInputDeviceChange()}),2e3)}calculateNewCallType(e,t,i,r){let n=t.localType;return"contentAdd"===r&&("video"===i?(n=e.localMedia&o.Call.Media.SHARING?"sharing+video":"video",e.localMedia=e.localMedia|o.Call.Media.VIDEO):"sharing"===i?(n=e.localMedia&o.Call.Media.VIDEO?"sharing+video":"sharing",e.localMedia=e.localMedia|o.Call.Media.SHARING):"audio"===i&&(e.localMedia&o.Call.Media.SHARING?(n="sharing",e.localMedia=e.localMedia|o.Call.Media.AUDIO):(n="audio",e.localMedia=o.Call.Media.AUDIO))),"contentRemove"===r&&("video"===i?e.localMedia&o.Call.Media.SHARING?(n="sharing",e.localMedia=o.Call.Media.AUDIO|o.Call.Media.SHARING):(n="audio",e.localMedia=o.Call.Media.AUDIO):"sharing"===i&&(e.localMedia&o.Call.Media.VIDEO?(n="video",e.localMedia=o.Call.Media.AUDIO|o.Call.Media.VIDEO):(n="audio",e.localMedia=o.Call.Media.AUDIO))),"contentModify"===r&&e.localMedia&o.Call.Media.VIDEO&&!(e.localMedia&o.Call.Media.SHARING)&&(n="video"),this.logger.info("[webrtcP2PService] calculateNewCallType for type "+i+" and action "+r+" with result "+n),n}updateCurrentCall(e,t,i,r){this.logger.info("[webrtcP2PService] updateCurrentCall for type "+i+" and action "+r);const n=this.calculateNewCallType(e,t,i,r);for(let s=0;s<e.localStreams.length;s++)t.addStream(e.localStreams[s]),t.localStreams.push(e.localStreams[s]);switch(r){case"contentAdd":t.contentAdd(n);break;case"contentRemove":t.contentRemove(n);break;case"contentModify":t.contentModify(n)}this.contactService.setBusyState("dnd",this.calculatePresenceMessage(e)),this.eventService.publish("ON_CALL_UPDATED_EVENT",e),this.eventService.publish("ON_WEBRTC_CALL_ESCALATION",e)}stopAllActiveStreams(e){this.stopActiveAudioVideoStreams(e,true)}handleToneChangeEvent(e){""!==e.tone&&(this.logger.info("[webrtcP2PService] Dtmf Tone played: "+e.tone),this.eventService.publish("ON_DTMF_SENT",e.tone))}silentToneChangeEventHandle(e){this.logger.info("[webrtcP2PService] Dtmf Tone played: "+e.tone)}clearSrcObjectsFromElements(){0===Object.keys(this.xmppService.connection.jingle.sessions).length?(this.RTC.clearMediaStream($("#largevideo"),null),this.RTC.clearMediaStream($("#globalVideoTag"),null),this.RTC.clearMediaStream($("#globalAudioTag"),null)):this.logger.info("[webrtcP2PService]  clearSrcObjectsFromElements -- ignored because not all calls are terminated")}attachDistantMediaStreamsUnifiedPlan(e){const t=this.xmppService.connection.jingle.sessions[e.id];t?(t.remoteStreamsObject[0]&&(this.logger.info("[webrtcP2PService] attachDistantMediaStreamsUnifiedPlan audio track for element globalAudioTag "+t.remoteStreamsObject[0].id),this.RTC.attachMediaStream($("#globalAudioTag"),t.remoteStreamsObject[0])),t.remoteStreamsObject[1]&&t.remoteStreamsObject[2]?(this.RTC.attachMediaStreamIfNeeded($("#largevideo"),t.remoteStreamsObject[2],t.remoteStreamsObject[2].id),$("#largevideo")[0]&&($("#largevideo")[0].muted=true,$("#largevideo")[0].volume=0),this.RTC.attachMediaStreamIfNeeded($("#p2pSecondVideo"),t.remoteStreamsObject[1],t.remoteStreamsObject[1].id),$("#p2pSecondVideo")[0]&&($("#p2pSecondVideo")[0].muted=true,$("#p2pSecondVideo")[0].volume=0)):t.remoteStreamsObject[1]?(this.RTC.attachMediaStreamIfNeeded($("#largevideo"),t.remoteStreamsObject[1],t.remoteStreamsObject[1].id),$("#largevideo")[0]&&($("#largevideo")[0].muted=true,$("#largevideo")[0].volume=0)):t.remoteStreamsObject[2]&&(this.RTC.attachMediaStreamIfNeeded($("#largevideo"),t.remoteStreamsObject[2],t.remoteStreamsObject[2].id),$("#largevideo")[0]&&($("#largevideo")[0].muted=true,$("#largevideo")[0].volume=0))):this.logger.warn("[webrtcP2PService] attachDistantMediaStreamsUnifiedPlan -- missing session "+e.id)}attachDistantMediaStreams(e,t){if(e){if(this.alreadyAttaching)return;this.alreadyAttaching=true,this.attachDistantMediaStreamsUnifiedPlan(t),this.alreadyAttaching=false}else this.isUserContactInCall()||(this.RTC.clearMediaStream($("#largevideo"),null),this.RTC.clearMediaStream($("#globalVideoTag"),null),this.RTC.clearMediaStream($("#globalAudioTag"),null))}attachLocalVideoOnlyStreamToElement(e,t,i){this.logger.info("[webrtcP2PService] attachLocalVideoOnlyStreamToElement "+t),t?(e.localStreams&&e.localStreams.length&&e.localStreams.forEach((e=>{e.getVideoTracks().length&&e.getAudioTracks().length||e.getVideoTracks().length&&this.RTC.attachMediaStreamIfNeeded(i,e,e.id)})),i[0]&&(i[0].volume=0)):this.RTC.clearMediaStream(i,null)}attachLocalAudioVideoStreamToElement(e,t,i){this.logger.info("[webrtcP2PService] attachLocalAudioVideoStreamToElement "+t),t?(e.localStreams&&e.localStreams.length&&e.localStreams.forEach((e=>{e.getVideoTracks().length&&e.getAudioTracks().length&&this.RTC.attachMediaStreamIfNeeded(i,e,e.id)})),i[0]&&(i[0].volume=0)):this.RTC.clearMediaStream(i,null)}attachLocalMediaStreams(e,t=null){if(t||(t=this.getCurrentActiveCall()),this.logger.info("[webrtcP2PService] attachLocalMediaStreams "+e),e){if(t.localStreams&&t.localStreams.length){let e=false;t.localStreams.forEach((t=>{t.getVideoTracks().length&&t.getAudioTracks().length?(e?this.RTC.attachMediaStreamIfNeeded($("#minivideo2"),t,t.id):(e=true,this.RTC.attachMediaStreamIfNeeded($("#minivideo"),t,t.id)),this.RTC.attachMediaStreamIfNeeded($("#callVideoPip"),t,t.id)):t.getVideoTracks().length&&(e?this.RTC.attachMediaStreamIfNeeded($("#minivideo2"),t,t.id):(e=true,this.RTC.attachMediaStreamIfNeeded($("#minivideo"),t,t.id)),this.RTC.attachMediaStreamIfNeeded($("#callSharingPip"),t,t.id))}))}$("#callVideoPip")[0]&&($("#callVideoPip")[0].volume=0),$("#minivideo")[0]&&($("#minivideo")[0].volume=0),$("#minivideo2")[0]&&($("#minivideo2")[0].volume=0),$("#callSharingPip")[0]&&($("#callSharingPip")[0].volume=0)}else this.RTC.clearMediaStream($("#minivideo"),null),this.RTC.clearMediaStream($("#minivideo2"),null),this.RTC.clearMediaStream($("#callVideoPip"),null),this.RTC.clearMediaStream($("#callSharingPip"),null)}removeConferencePip(){return this.RTC.clearMediaStream($("#conferenceSharingPip"),null),this.RTC.clearMediaStream($("#conferenceVideoPip"),null),true}}t.WebrtcP2PService=g},function(e,t,i){function r(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}i.d(t,"a",(function(){return n}));var n=r()},function(e,t,i){function r(){}i.d(t,"a",(function(){return r}))},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(76),n=i(104),s=i(7),o=i(165),a=i(141),c=i(4),l=i(6),d=i(8),u=i(11),h=i(13);class f{constructor(){this.started=false,this.listeners=[],this.currentOrder="date",this.voiceMessageFileDescriptors=[],this.fileDescriptors=[],this.receivedFileDescriptors=[],this.mergedFileDescriptors=[],this.uploadingFileDescriptors=[],this.contactService=l.ContactService.getInstance(),this.logger=c.LoggerService.getInstance(),this.errorHelperService=h.ErrorHelperService.getInstance(),this.eventService=u.EventService.getInstance(),this.deleteFileWoConfirm=false,this.fileDescriptorsSubject=null,this.uploadingFileDescriptorsSubject=null,this.conferenceRecordingFiles=[],this.conferenceRecordingFilesSubject=null,this.sharedWithMeConferenceRecordingFiles=[],this.sharedWithMeConferenceRecordingFilesSubject=null,this.publicFileDownload=[],this.publicFileDownloadSubject=null,this.startedSubject=new s.BehaviorSubject(false),this.retrieveFileDescriptorPromises=[],this.authService=d.AuthService.getInstance()}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.fileStorageService||(e.rainbow.fileStorageService=new f),e.rainbow.fileStorageService}async start(e=null){this.started=false,this.portalURL=config.restServerUrl+"/api/rainbow/filestorage/v1.0/files",this.fileDescriptors=[],this.receivedFileDescriptors=[],this.mergedFileDescriptors=[],this.voiceMessageFileDescriptors=[],this.fileDescriptorsSubject=new s.Subject,this.uploadingFileDescriptorsSubject=new s.Subject,this.publicFileDownload=[],this.publicFileDownloadSubject=new s.Subject,this.conferenceRecordingFilesSubject=new s.Subject,this.sharedWithMeConferenceRecordingFilesSubject=new s.Subject,this.contactService.userContact.fileStorageEnabledSubject.pipe(a.distinctUntilChanged()).subscribe((async t=>{if(t){this.logger.info("[FileStorageService] === STARTING ===");try{this.consumptionData=null,await this.getFileDescriptorsFromServer(),this.started=true,this.logger.info("[FileStorageService] === STARTED ==="),this.startedSubject.next(true),this.contactService.userContact.fileStorageEnabledSubject.pipe(a.distinctUntilChanged()).subscribe((e=>{e||this.stop()}))}catch(i){this.logger.error("[FileStorageService] === STARTING === failure -- "+i.message),this.startedSubject.next(false)}e&&e.webinar||(this.retrieveUserConsumption(),this.retrieveVoiceMessageFileDescriptorsListPerOwner().then((()=>{this.logger.info("[FileStorageService] === STARTED (retrieveVoiceMessageFileDescriptorsListPerOwner)")})).catch((()=>{this.logger.error("[FileStorageService] === STARTING === failure -- (retrieveVoiceMessageFileDescriptorsListPerOwner)")}))),this.listeners.push(this.eventService.subscribe("ROOM_UPDATE_EVENT",((e,t,i)=>{i&&"remove"===i&&(this.logger.info("[FileStorageService] ROOM_UPDATE_EVENT REMOVED for roomId="+t.dbId),this.removeRoomFileViewer(t))})))}else this.logger.info("start skipped - fileStorageEnabled : false")}))}async stop(){this.logger.info("[FileStorageService] === STOPPING ==="),this.started&&(this.started=false),this.listeners&&this.listeners.forEach((e=>{e()})),this.voiceMessageFileDescriptors=[],this.fileDescriptors=[],this.receivedFileDescriptors=[],this.uploadingFileDescriptors=[],this.conferenceRecordingFiles=[],this.sharedWithMeConferenceRecordingFiles=[],this.logger.info("[FileStorageService] === STOPPED ==="),this.startedSubject.next(false)}async reinit(e=false){this.contactService&&this.contactService.userContact&&!this.contactService.userContact.fileStorageEnabled?this.logger.info("reinit skipped - fileStorageEnabled : "+this.contactService.userContact.fileStorageEnabled):e?await this.reinitInternal():this.reinitInternal()}async reinitInternal(){try{await this.retrieveFileDescriptorsListPerOwner(),await this.retrieveReceivedFiles(this.contactService.userContact.dbId),this.orderDocuments(),this.logger.info("[FileStorageService] reinitInternal done")}catch(e){throw this.logger.error("[FileStorageService] reinitInternal failure -- "+e.message),e}}removeRoomFileViewer(e){if(this.contactService&&this.contactService.userContact&&!this.contactService.userContact.fileStorageEnabled)this.logger.info("removeRoomFileViewer skipped - fileStorageEnabled : "+this.contactService.userContact.fileStorageEnabled);else{this.logger.info("[FileStorageService] >removeRoomFileViewer: "+e.dbId),this.receivedFileDescriptors.forEach((t=>{if(t&&t.ownerId!==this.contactService.userContact.dbId){const i=t.viewers.find((t=>t.viewerId===e.dbId));i&&(this.logger.info("[FileStorageService] >viewer found delete it"),t.viewers.splice(t.viewers.indexOf(i),1))}}));for(let e=0;e<this.receivedFileDescriptors.length;e++){const t=this.receivedFileDescriptors[e];!t||t.viewers&&t.viewers.length||(this.logger.info("[FileStorageService] >receivedFileDescriptor empty, delete it"),this.receivedFileDescriptors.splice(e,1),e-=1)}this.orderDocuments()}}getNewDocuments(e){switch(e){case"mine":return this.fileDescriptors;case"received":return this.receivedFileDescriptors;default:return this.mergedFileDescriptors}}getDocuments(e,t){return this.currentOrder!==e&&(this.currentOrder=e,this.orderDocuments()),t?this.receivedFileDescriptors:this.fileDescriptors}getFileDescriptorById(e){for(const t of this.fileDescriptors)if(t.id===e)return t;for(const t of this.receivedFileDescriptors)if(t.id===e)return t;for(const t of this.sharedWithMeConferenceRecordingFiles)if(t.id===e)return t;return null}getFileDescriptorByViewerId(e){for(const t of this.fileDescriptors)for(const i of t.viewers)if(i.viewerId===e)return t;for(const t of this.receivedFileDescriptors)if(t.id===e)return t;return null}getReceivedFileDescriptorsFromConversation(e){if(e.contact){const t=this.receivedFileDescriptors.filter((t=>e.contact.dbId===t.ownerId&&void 0!==t.viewers.find((e=>e.viewerId===this.contactService.userContact.dbId))));return t||[]}if(e.room){const t=this.receivedFileDescriptors.filter((t=>t.ownerId!==this.contactService.userContact.dbId&&void 0!==t.viewers.find((t=>t.viewerId===e.room.dbId))));return t||[]}return[]}getReceivedFilesFromContact(e){return this.receivedFileDescriptors.filter((t=>t.ownerId===e))}getSentFilesToContact(e){if(this.contactService&&this.contactService.userContact&&!this.contactService.userContact.fileStorageEnabled)return this.logger.info("getSentFilesToContact skipped - fileStorageEnabled : "+this.contactService.userContact.fileStorageEnabled),[];return this.fileDescriptors.filter((t=>{for(let i=0;i<t.viewers.length;i++)if(t.viewers[i].viewerId===e)return true;return false}))}getReceivedFilesForRoom(e){return this.receivedFileDescriptors.filter((t=>{for(let i=0;i<t.viewers.length;i++)if(t.viewers[i].viewerId===e&&t.ownerId!==this.contactService.userContact.dbId)return true;return false}))}getConsumptionData(){return this.consumptionData}getVoiceMessageFileDescriptorByMsgId(e){return this.voiceMessageFileDescriptors.find((t=>null!==t.tags&&t.tags.msgId===e))}async createFileDescriptor(e,t=[],i=null,r=false,n=false){const s=e.name,o=e.name.split(".").pop(),a=e.size;try{const e={fileName:s,extension:o,size:a,viewers:t};i&&(e.voicemessage=true,e.encoding=true,e.duration=i.duration),r&&(e.ccarelogs=true,e.ccareclientlogs=n);const c=this.portalURL,l=this.authService.getPostHeader(),d=JSON.stringify(e),u=await fetch(c,{method:"POST",headers:l,body:d});if(!u.ok)throw u;const h=(await u.json()).data,f=this.createFileDescriptorFromData(h);return f&&(this.fileDescriptors.push(f),this.uploadingFileDescriptors.push(f),this.uploadingFileDescriptorsSubject.next({size:this.getUploadingFilesSize()})),this.logger.info("[FileStorageService] createFileDescriptor -- "+f.id+" -- success"),this.orderDocuments(),f}catch(c){const e=await this.errorHelperService.getErrorInfo(c,"createFileDescriptor");throw 403153===e.error.errorDetailsCode&&(this.contactService.userContact.fileSharingEnabled=false,this.contactService.userContact.rxSubject.next(void 0)),this.logger.error("[fileStorageService] "+e.message),e.error}}createFileDescriptorFromData(e){if(e){let t=[];e.viewers&&(t=n.FileViewer.createFromData(e.viewers));let i=e.url;i||(i=config.restServerUrl+"/api/rainbow/fileserver/v1.0/files/"+e.id);const s=e.isUploaded?"uploaded":"not_uploaded",o=e.tags&&"voicemail"===e.tags.purpose,a=e.tags&&"conference_record"===e.tags.purpose,c=a&&e.tags&&e.tags.conferenceRecording?e.tags.conferenceRecording.filesConfRecordingId:null;let l="unknown";l=null===e.isClean?"notScanned":true===e.isClean?"isClean":"isInfected";try{return r.FileDescriptor.create(e.id,i,e.ownerId,e.fileName,e.extension,e.typeMIME,e.size,e.registrationDate,e.uploadedDate,e.dateToSort,t,s,e.thumbnail,e.orientation,e.original_w,e.original_h,e.tags,l,o,a,c)}catch(dp){return dp}}return null}async deleteFileDescriptor(e){try{const t=`${this.portalURL}/${e}`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"DELETE",headers:i});if(!r.ok)throw r;this.logger.info("[FileStorageService] deleteFileDescriptor -- SUCCESS"),this.removeUploadingFileFromId(e),this.deleteFileDescriptorFromCache(e),this.eventService.publish("ON_FILE_REMOVED_FROM_STORE_EVENT",{fileId:e}),this.retrieveUserConsumption()}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"deleteFileDescriptor");throw this.logger.error("[fileStorageService] "+e.message),e.error}}async deleteAllFileDescriptor(){try{const e=this.portalURL+"/all",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"DELETE",headers:t});if(!i.ok)throw i;this.logger.info("[FileStorageService] deleteAllFileDescriptor -- success"),this.deleteAllFilesDescriptorsFromCache(),this.retrieveUserConsumption()}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"deleteAllFileDescriptor");throw this.logger.error("[fileStorageService] "+t.message),t.error}}async getFileDescriptorsFromServer(){try{await Promise.all([this.retrieveFileDescriptorsListPerOwner(),this.retrieveReceivedFiles(this.contactService.userContact.dbId)]),this.orderDocuments()}catch(e){this.logger.error("getFilesDescriptorsFromServer - error")}}async retrieveFileDescriptorsListPerOwner(){try{this.fileDescriptors=[];const e=this.portalURL+"?format=full&limit=1000",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=await i.json();let n=r.data;if(!n)return this.fileDescriptors;const s=r.limit,o=r.total;let a=null;if(o<=s)a=Promise.resolve([]);else{let e=s;const t=o/s,i=[];for(let r=1;r<t;r++)i.push(this.retrieveFileDescriptorsListPerOwnerwithOffset(e,s)),e+=s;a=Promise.all(i)}(await a).forEach((e=>{n=n.concat(e)}));for(const c of n){const e=this.createFileDescriptorFromData(c);this.fileDescriptors.push(e)}return this.logger.info("[FileStorageService] retrieveFileDescriptorsListPerOwner -- success"),this.fileDescriptors}catch(e){this.logger.error("[FileStorageService] retrieveFileDescriptorsListPerOwner -- error"),this.logger.error(e);const t=await this.errorHelperService.getErrorInfo(e,"retrieveFileDescriptorsListPerOwner");throw this.logger.error("[fileStorageService] "+t.message),t.error}}async retrieveFileDescriptorsListPerOwnerwithOffset(e,t){const i=`${this.portalURL}?format=full&limit=${t}&offset=${e}`,r=this.authService.getRequestHeader(),n=await fetch(i,{method:"GET",headers:r});if(!n.ok)throw n;return(await n.json()).data}async retrieveVoiceMessageFileDescriptorsListPerOwner(){try{const e=this.portalURL+"?format=full&path=/voice-messages",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=(await i.json()).data;return r?(this.voiceMessageFileDescriptors=r.reduce(((e,t)=>{const i=this.createFileDescriptorFromData(t);return"not_uploaded"===i.state?(this.logger.info(`[FileStorageService] file ${i.fileName} not uploaded`),i&&i.ownerId===this.contactService.userContact.dbId?(this.logger.info(`[FileStorageService] file ${i.fileName} is our property, we can delete it`),this.deleteFileDescriptor(i.id)):this.logger.info(`[FileStorageService] file ${i.fileName} is NOT our property, we CANNOT delete it`)):e.push(i),e}),[]),this.logger.info("[FileStorageService] retrieveVoiceMessageFileDescriptorsListPerOwner -- success"),this.voiceMessageFileDescriptors):[]}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"retrieveVoiceMessageFileDescriptorsListPerOwner");throw this.logger.error("[fileStorageService] "+t.message),t.error}}async retrieveFilesReceivedFromPeer(e,t){try{const i=`${this.portalURL}/viewers/${e}?ownerId=${t}&format=full`,r=this.authService.getRequestHeader(),n=await fetch(i,{method:"GET",headers:r});if(!n.ok)throw n;const s=(await n.json()).data.map((e=>this.createFileDescriptorFromData(e)));return this.logger.info("[FileStorageService] retrieveFilesReceivedFromPeer success"),s}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"retrieveFilesReceivedFromPeer");throw this.logger.error("[fileStorageService] "+e.message),e.error}}async retrieveSentFiles(e){try{this.logger.info("[FileStorageService] >retrieveSentFiles");const t=`${this.portalURL}?format=full&viewerId=${e}`,i=this.authService.getRequestHeader(),n=await fetch(t,{method:"GET",headers:i});if(!n.ok)throw n;return(await n.json()).data.reduce(((e,t)=>{const i=this.createFileDescriptorFromData(t);return i.state===r.FileState.NOT_UPLOADED?this.logger.warn(`[FileStorageService] file ${i.fileName} not uploaded`):e.push(i),e}),[])}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"retrieveSentFiles");throw this.logger.error("[fileStorageService] "+e.message),e.error}}async retrieveReceivedFilesForRoom(e){try{const t=`${this.portalURL}/viewers/${e}?format=full`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;const s=(await r.json()).data;return s?s.reduce(((t,i)=>{if(i.ownerId!==this.contactService.userContact.dbId){i.viewers=[];const r=this.createFileDescriptorFromData(i);if(!r.viewers.length){const t=n.FileViewer.createFromData([{viewerId:e,type:"room"}])[0];r.viewers.push(t)}t.push(r),this.receivedFileDescriptors.find((e=>e.id===i.id))||this.receivedFileDescriptors.push(r)}return t}),[]):[]}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"retrieveReceivedFilesForRoom");throw this.logger.error("[fileStorageService] "+e.message),e.error}}async retrieveReceivedFiles(e){try{this.receivedFileDescriptors=[];const t=`${this.portalURL}/viewers/${e}?format=full&limit=1000`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;const n=await r.json();let s=n.data;if(!s)return this.receivedFileDescriptors;const o=n.limit,a=n.total;let c=null;if(a<=o)c=Promise.resolve([]);else{let t=o;const i=a/o,r=[];for(let n=1;n<i;n++)r.push(this.retrieveReceivedFilesWithOffset(e,t,o)),t+=o;c=Promise.all(r)}return(await c).forEach((e=>{s=s.concat(e)})),this.receivedFileDescriptors=s.reduce(((e,t)=>{const i=this.createFileDescriptorFromData(t);if(i&&i.ownerId!==this.contactService.userContact.dbId){const t=this.getFileDescriptorById(i.id);t&&(i.previewBlob=t.previewBlob,i.previewBlobSubject.next(URL.createObjectURL(i.previewBlob))),e.push(i)}return e}),[]),this.logger.info("[FileStorageService] retrieveReceivedFiles -- success"),this.receivedFileDescriptors}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"retrieveReceivedFiles");throw this.logger.error("[fileStorageService] "+e.message),e.error}}async retrieveReceivedFilesWithOffset(e,t,i){const r=`${this.portalURL}/viewers/${e}?format=full&limit=${i}&offset=${t}`,n=this.authService.getRequestHeader(),s=await fetch(r,{method:"GET",headers:n});if(!s.ok)throw s;return(await s.json()).data}async retrieveUserConsumption(){try{const e=config.restServerUrl+"/api/rainbow/filestorage/v1.0/users/consumption",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;return this.consumptionData=(await i.json()).data,this.logger.info("[FileStorageService] retrieveUserConsumption success - "+JSON.stringify(this.consumptionData)),this.eventService.publish("ON_CONSUMPTION_DATA_UPDATED_EVENT"),this.consumptionData}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"retrieveUserConsumption");throw this.logger.error("[fileStorageService] "+t.message),t.error}}async deleteFileViewer(e,t){try{const i=`${this.portalURL}/${t}/viewers/${e}`,r=this.authService.getRequestHeader(),n=await fetch(i,{method:"DELETE",headers:r});if(!n.ok)throw n;this.logger.info("[FileStorageService] deleteFileViewer "+n.statusText);const s=this.getFileDescriptorById(t);if(s){const t=s.viewers.findIndex((t=>t.viewerId===e));-1!==t&&s.viewers.splice(t,1),s.stateSubject.next(s.state)}}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"deleteFileViewer");throw this.logger.error("[fileStorageService] "+e.message),e.error}}async addFileViewer(e,t,i){let r=this.getFileDescriptorById(e);if(r||(r=await this.retrieveOneFileDescriptor(e)),r){if(r.isAlreadyFileViewer(t))return r;try{const s=`${this.portalURL}/${e}/viewers`,o=this.authService.getPostHeader(),a=JSON.stringify({viewerId:t,type:i}),c=await fetch(s,{method:"POST",headers:o,body:a});if(!c.ok)throw c;this.logger.info("[FileStorageService] addFileViewer success");const l=n.FileViewer.createFromData([{viewerId:t,type:i}])[0];return r.viewers.push(l),r.stateSubject.next(r.state),r}catch(s){const e=await this.errorHelperService.getErrorInfo(s,"addFileViewer");throw this.logger.error("[fileStorageService] "+e.message),e.error}}return null}async copyFileToUserCloudStorage(e){try{const t=`${this.portalURL}/${e}/copy`,i=this.authService.getPostHeader(),r=await fetch(t,{method:"POST",headers:i});if(!r.ok)throw r;const n=(await r.json()).data;this.logger.info(`[FileStorageService] copyFileToUserCloudStorage | copyFile ${e} -- success`);const s=await this.retrieveAndStoreOneFileDescriptor(n.id,true);return s.ownerId===this.contactService.userContact.dbId&&this.retrieveUserConsumption(),s}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"copyFileToUserCloudStorage");throw this.logger.error("[fileStorageService] "+e.message),e.error}}retrieveOneFileDescriptor(e){return this.retrieveFileDescriptorPromises[e]?(this.logger.info(`[FileStorageService] retrieveOneFileDescriptor for ${e} already lauched`),this.retrieveFileDescriptorPromises[e]):(this.retrieveFileDescriptorPromises[e]=(async()=>{try{this.logger.info("[FileStorageService] retrieveOneFileDescriptor "+e);const t=`${this.portalURL}/${e}?format=full`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;const n=(await r.json()).data,s=this.createFileDescriptorFromData(n);return this.logger.info(`[FileStorageService] retrieveOneFileDescriptor ${e} -- success`),delete this.retrieveFileDescriptorPromises[e],s}catch(t){const i=await this.errorHelperService.getErrorInfo(t,"retrieveOneFileDescriptor");throw this.logger.debug("[fileStorageService] "+i.message),delete this.retrieveFileDescriptorPromises[e],i.error}})(),this.retrieveFileDescriptorPromises[e])}retrieveAndStoreOneFileDescriptor(e,t=false){const i=this.getFileDescriptorById(e);return i&&!t?(this.logger.info("[FileStorageService] retrieveAndStoreOneFileDescriptor -- return existing fileDescriptor "+e),Promise.resolve(i)):this.retrieveOneFileDescriptor(e).then((e=>{if(e.recordingFile)return e.ownerId!==this.contactService.userContact.dbId&&(this.sharedWithMeConferenceRecordingFiles.push(e),this.sharedWithMeConferenceRecordingFilesSubject.next(this.sharedWithMeConferenceRecordingFiles)),Promise.resolve(e);i&&i.isImage()&&(e.previewBlob=i.previewBlob,e.previewBlobSubject.next(e.previewBlob));const t=this.fileDescriptors.find((t=>t.id===e.id));t&&t.update(e);const r=this.receivedFileDescriptors.find((t=>t.id===e.id));return r&&r.update(e),t||r||(e.ownerId===this.contactService.userContact.dbId?(this.fileDescriptors.push(e),this.logger.info("[FileStorageService] retrieveAndStoreOneFileDescriptor -- fileDescriptor "+e.id+" -- now stored in my files")):(this.receivedFileDescriptors.push(e),this.logger.info("[FileStorageService] retrieveAndStoreOneFileDescriptor -- fileDescriptor "+e.id+" -- now stored in received files")),this.fileDescriptorsSubject.next({action:"new",fd:e})),this.orderDocuments(),this.eventService.publish("ON_FILE_DESCRIPTOR_RECEIVED_EVENT",{fileId:e.id}),Promise.resolve(e)})).catch((e=>(e.status>=400&&e.status<500&&i&&(404===e.status&&this.deleteFileDescriptorFromCache(i.id),this.orderDocuments(),this.logger.debug("[FileStorageService] Sending ON_FILE_REMOVED_FROM_STORE_EVENT"),this.eventService.publish("ON_FILE_REMOVED_FROM_STORE_EVENT",{fileId:i.id})),Promise.reject(e))))}deleteFileDescriptorFromCache(e){this.logger.info("[FileStorageService] deleteFileDescriptorFromCache "+e);for(let t=0;t<this.receivedFileDescriptors.length;t++){const i=this.receivedFileDescriptors[t];if(i.id===e){this.receivedFileDescriptors.splice(t,1),i.setState(r.FileState.DELETED);break}}for(let t=0;t<this.sharedWithMeConferenceRecordingFiles.length;t++){const i=this.sharedWithMeConferenceRecordingFiles[t];if(i.id===e){this.sharedWithMeConferenceRecordingFiles.splice(t,1),this.sharedWithMeConferenceRecordingFilesSubject.next(this.sharedWithMeConferenceRecordingFiles),i.setState(r.FileState.DELETED);break}}for(let t=0;t<this.fileDescriptors.length;t++){const i=this.fileDescriptors[t];if(i.id===e){this.fileDescriptors.splice(t,1),i.setState(r.FileState.DELETED);break}}this.orderDocuments()}deleteAllFilesDescriptorsFromCache(){this.logger.info("[FileStorageService] deleteAllFilesDesceiptorsFromCache"),this.fileDescriptors.forEach((e=>{e.setState(r.FileState.DELETED),this.receivedFileDescriptors.forEach(((t,i)=>{t.id===e.id&&this.receivedFileDescriptors.splice(i,1)}))})),this.fileDescriptors=[],this.uploadingFileDescriptors=[],this.orderDocuments(),this.fileDescriptorsSubject.next({action:"listUpdate"})}orderDocuments(e="all"){this.logger.debug("[FileStorageService] orderDocuments");let t=null;switch(e){case"mine":t=this.fileDescriptors;break;case"received":t=this.receivedFileDescriptors;break;default:this.mergedFileDescriptors=this.fileDescriptors.concat(this.receivedFileDescriptors),t=this.mergedFileDescriptors}switch(this.currentOrder){default:t.sort(((e,t)=>t.time-e.time));break;case"name":t.sort(((e,t)=>e.fileName.localeCompare(t.fileName)));break;case"size":t.sort(((e,t)=>e.size-t.size))}}extractFileIdFromUrl(e){const t=e.split("/");return t.pop()||t.pop()}retrieveAndStoreOneVoiceMessageFileDescriptor(e){this.retrieveOneFileDescriptor(e).then((t=>{if(t.tags&&"/voice-messages"===t.tags.path){if(void 0!==this.voiceMessageFileDescriptors.find((t=>t.id===e))){const i=this.voiceMessageFileDescriptors.findIndex((e=>e.id===t.id));i>-1&&this.voiceMessageFileDescriptors.splice(i,1,t),this.logger.info("[FileStorageService] getRetrieveAndStoreOneVoiceMessageFileDescriptor "+e+" -- success")}else this.voiceMessageFileDescriptors.push(t)}}))}deleteVoiceMessageFileDescriptor(e){this.logger.info("[FileStorageService] deleteVoiceMessageFileDescriptore "+e);const t=this.voiceMessageFileDescriptors.find((t=>t.id===e));if(void 0!==t){const e=this.voiceMessageFileDescriptors.findIndex((e=>e.id===t.id));e>-1&&this.voiceMessageFileDescriptors.splice(e,1)}}updateAFileDescriptorLocally(e){this.fileDescriptors=this.fileDescriptors.map((t=>t.id===e.id?e:t)),this.receivedFileDescriptors=this.receivedFileDescriptors.map((t=>t.id===e.id?e:t)),this.orderDocuments()}getPublicFileDownloads(){return this.publicFileDownload}clearPublicFileDownloads(){this.publicFileDownload=[]}findPublicFileDownload(e){return this.publicFileDownload.find((t=>t.url===e))}updatePublicFileDownloadArray(e,t){this.logger.info("[FileStorageService] >updatePublicFileDownloadArray"),e.forEach((e=>{const i=this.findPublicFileDownload(e.url);if(i)this.logger.info("[FileStorageService] file ("+e.url+") Found - to update"),i.receivedBytes=e.receivedBytes,i.savePath=e.savePath,i.isDownloadFinished()&&i.openFolderOnceDownloadFinished&&(this.logger.debug("[FileStorageService] showItemInFolder auto on download completion"),t.showItemInFolder(i.savePath)),this.logger.debug("[FileStorageService] fileName="+i.fileName),this.logger.debug("[FileStorageService] file receivedBytes="+i.receivedBytes),this.logger.debug("[FileStorageService] file totalBytes="+i.totalBytes),this.logger.debug("[FileStorageService] file savePath="+i.savePath),i.progressSubject.next(void 0);else{this.logger.info("[FileStorageService] file Not Found");const t=o.FilePublicDownload.create(e.url,e.fileName,e.totalBytes,e.receivedBytes,e.savePath);this.publicFileDownload.unshift(t)}this.publicFileDownloadSubject.next(void 0)}))}removePublicFileDownload(e){if(!e||!e.url)return;const t=this.publicFileDownload.indexOf(e);t>=0&&(this.publicFileDownload.splice(t,1),this.publicFileDownloadSubject.next(void 0))}async getRecordingFileAvatar(e){try{const t=config.restServerUrl+"/api/rainbow/filestorage/v1.0/conferences-recordings/avatar/"+e+"?thumbnail=true",i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;const n=await r.blob();return URL.createObjectURL(n)}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getRecordingFileAvatar");throw this.logger.error("[fileStorageService] "+e.message),e.error}}getRecordingFiles(){return this.conferenceRecordingFilesSubject.next(this.conferenceRecordingFiles),this.conferenceRecordingFiles}async getRecordingFilesFromServer(){try{const e=config.restServerUrl+"/api/rainbow/filestorage/v1.0/conferences-recordings?format=full&limit=1000",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=(await i.json()).data;if(!r)throw r;return this.conferenceRecordingFiles=r,this.logger.info("[FileStorageService] getRecordingFilesFromServer -- success"),this.conferenceRecordingFilesSubject.next(this.conferenceRecordingFiles),await this.retrieveUserConsumption(),this.conferenceRecordingFiles}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getRecordingFilesFromServer");throw this.logger.error("[fileStorageService] "+t.message),t.error}}getSharedWithMeConferenceRecordingFiles(){return this.sharedWithMeConferenceRecordingFilesSubject.next(this.sharedWithMeConferenceRecordingFiles),this.sharedWithMeConferenceRecordingFiles}async getSharedWithMeConferenceRecordingFilesFromServer(){try{const e=`${this.portalURL}/viewers/${this.contactService.userContact.dbId}?format=full&purpose=conference_record&&typeMIME=video`,t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=(await i.json()).data;if(!r)throw r;const n=r.map((e=>this.createFileDescriptorFromData(e)));return this.sharedWithMeConferenceRecordingFiles=n,this.sharedWithMeConferenceRecordingFilesSubject.next(this.sharedWithMeConferenceRecordingFiles),this.logger.info("[FileStorageService] getSharedWithMeConferenceRecordingFiles -- success"),await this.retrieveUserConsumption(),this.sharedWithMeConferenceRecordingFiles}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getSharedWithMeConferenceRecordingFiles");throw this.logger.error("[fileStorageService] "+t.message),t.error}}async deleteConferenceRecordingFile(e){try{this.logger.info("[FileStorageService] deleteConferenceRecordingFile");const t=`${config.restServerUrl}/api/rainbow/filestorage/v1.0/conferences-recordings/${e}`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"DELETE",headers:i});if(!r.ok)throw r;const n=(await r.json()).data;if(!n)throw r;this.logger.info("[FileStorageService] deleteConferenceRecordingFile -- success");const s=this.conferenceRecordingFiles.filter((e=>e.id!==n.id));return this.conferenceRecordingFiles=s,this.conferenceRecordingFilesSubject.next(this.conferenceRecordingFiles),await this.retrieveUserConsumption(),this.conferenceRecordingFiles}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"deleteConferenceRecordingFile");throw this.logger.error("[fileStorageService] "+e.message),e.error}}async getConferenceRecordingAssociatedFiles(e){try{this.logger.info("[FileStorageService] getConferenceRecordingAssociatedFiles");const t=[];if(!e.associatedRecordingFiles){this.logger.info("[FileStorageService] getConferenceRecordingAssociatedFiles - fetching from the server"),e.associatedRecordingFiles=[];for(let i=0;i<e.records.length;i++){let r=this.getFileDescriptorById(e.records[i].fileId);r||(r=await this.retrieveOneFileDescriptor(e.records[i].fileId)),this.logger.info("[FileStorageService] getConferenceRecordingAssociatedFiles -- success: "+e.records[i].fileName),t.push(r)}return e.associatedRecordingFiles=t,t}return this.logger.info("[FileStorageService] getConferenceRecordingAssociatedFiles - return results from cache"),e.associatedRecordingFiles}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getConferenceRecordingAssociatedFiles");throw this.logger.error("[fileStorageService] "+e.message),e.error}}getUploadingFilesSize(){let e=0;return this.uploadingFileDescriptors.forEach((t=>{e+=t.size})),e}removeUploadingFileFromId(e){const t=this.uploadingFileDescriptors.find((t=>t.id===e));t&&this.removeUploadingFileDescriptor(t)}removeUploadingFileDescriptor(e){if(e.state===r.FileState.UPLOADED){const t=this.getConsumptionData(),i=0!==t.currentValue?t.currentValue:0;t.currentValue=i+e.size}const t=this.uploadingFileDescriptors.indexOf(e);t>-1&&(this.uploadingFileDescriptors.splice(t,1),this.uploadingFileDescriptorsSubject.next({size:this.getUploadingFilesSize()}))}isEnoughAvailableSpaceForFiles(e){if(!e.length)return true;let t=0;e.forEach((e=>{e.fd||(e.file?t+=e.file.size:e.size&&(t+=e.size))}));const i=this.getConsumptionData(),r=i.maxValue,n=0!==i.currentValue?i.currentValue:0,s=r-n,o=this.getUploadingFilesSize();return this.logger.debug(`[FileStorageService] isEnoughAvailableSpaceForFiles - totalAvailableSpace: ${r} - usedSpace: ${n} - filesUploadingSize: ${o}`),t<s-o}isEnoughAvailableSpaceForFileDescriptor(e,t){if(!e)return true;const i=this.getFileDescriptorById(e),r=this.getConsumptionData(),n=r.maxValue-(0!==r.currentValue?r.currentValue:0),s=this.getUploadingFilesSize();return i.size*t.length<n-s}stopAllFileTransfer(){this.fileDescriptors.forEach((e=>{e&&(e.abortTransferController&&e.abortTransferController.abort(),e.abortXMLHttpRequestArray&&e.abortXMLHttpRequestArray.length&&e.abortXMLHttpRequestArray.map((e=>{e()})))}))}}t.FileStorageService=f},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.SDK={OK:1,ERROR:-1,ERRORUNAUTHORIZED:-2,ERRORXMPP:-4,ERRORXMPPJID:-8,ERRORBADREQUEST:-16,ERRORUNSUPPORTED:-32,ERRORNOTFOUND:-64}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});t.sdkConfig={verboseLog:true,customLogger:null,measurePerformance:false,videoQuality:"high",newModels:false,experimentalModels:false,displayOrder:"FL",autoAway:true,autoAwayDelay:180,logs:{contactService:true,xmppMessages:true,xmppService:true,conversationService:true,presence:true},credentials:{appID:"",appSecret:"",host:"openrainbow.com"},features:{bots:true,channels:true,conference:true,telephony:true,profileService:true,roomService:true,favoriteService:true,conversationService:true,calendarService:true}}},function(e,t,i){i.d(t,"a",(function(){return r}));var r=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}()},function(e,t,i){i.d(t,"a",(function(){return r}));var r=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}()},function(e,t,i){i.r(t),i.d(t,"Base",(function(){return r})),i.d(t,"WordArray",(function(){return n})),i.d(t,"Hex",(function(){return s})),i.d(t,"Latin1",(function(){return o})),i.d(t,"Utf8",(function(){return a})),i.d(t,"BufferedBlockAlgorithm",(function(){return c})),i.d(t,"Hasher",(function(){return l})),i.d(t,"HMAC",(function(){return d}));class r{static create(...e){return new this(...e)}mixIn(e){return Object.assign(this,e)}clone(){const e=new this.constructor;return Object.assign(e,this),e}}class n extends r{constructor(e=[],t=4*e.length){super();let i=e;if(i instanceof ArrayBuffer&&(i=new Uint8Array(i)),(i instanceof Int8Array||i instanceof Uint8ClampedArray||i instanceof Int16Array||i instanceof Uint16Array||i instanceof Int32Array||i instanceof Uint32Array||i instanceof Float32Array||i instanceof Float64Array)&&(i=new Uint8Array(i.buffer,i.byteOffset,i.byteLength)),i instanceof Uint8Array){const e=i.byteLength,t=[];for(let r=0;r<e;r+=1)t[r>>>2]|=i[r]<<24-r%4*8;this.words=t,this.sigBytes=e}else this.words=e,this.sigBytes=t}static random(e){const t=[],i=e=>{let t=e,i=987654321;const r=4294967295;return()=>{i=36969*(65535&i)+(i>>16)&r,t=18e3*(65535&t)+(t>>16)&r;let e=(i<<16)+t&r;return e/=4294967296,e+=.5,e*(Math.random()>.5?1:-1)}};for(let r,n=0;n<e;n+=4){const e=i(4294967296*(r||Math.random()));r=987654071*e(),t.push(4294967296*e()|0)}return new n(t,e)}toString(e=s){return e.stringify(this)}concat(e){const t=this.words,i=e.words,r=this.sigBytes,n=e.sigBytes;if(this.clamp(),r%4)for(let s=0;s<n;s+=1){const e=i[s>>>2]>>>24-s%4*8&255;t[r+s>>>2]|=e<<24-(r+s)%4*8}else for(let s=0;s<n;s+=4)t[r+s>>>2]=i[s>>>2];return this.sigBytes+=n,this}clamp(){const{words:e,sigBytes:t}=this;e[t>>>2]&=4294967295<<32-t%4*8,e.length=Math.ceil(t/4)}clone(){const e=super.clone.call(this);return e.words=this.words.slice(0),e}}const s={stringify(e){const{words:t,sigBytes:i}=e,r=[];for(let n=0;n<i;n+=1){const e=t[n>>>2]>>>24-n%4*8&255;r.push((e>>>4).toString(16)),r.push((15&e).toString(16))}return r.join("")},parse(e){const t=e.length,i=[];for(let r=0;r<t;r+=2)i[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new n(i,t/2)}},o={stringify(e){const{words:t,sigBytes:i}=e,r=[];for(let n=0;n<i;n+=1){const e=t[n>>>2]>>>24-n%4*8&255;r.push(String.fromCharCode(e))}return r.join("")},parse(e){const t=e.length,i=[];for(let r=0;r<t;r+=1)i[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new n(i,t)}},a={stringify(e){try{return decodeURIComponent(escape(o.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:e=>o.parse(unescape(encodeURIComponent(e)))};class c extends r{constructor(){super(),this._minBufferSize=0}reset(){this._data=new n,this._nDataBytes=0}_append(e){let t=e;"string"==typeof t&&(t=a.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes}_process(e){let t;const{_data:i,blockSize:r}=this,s=i.words,o=i.sigBytes;let a=o/(4*r);a=e?Math.ceil(a):Math.max((0|a)-this._minBufferSize,0);const c=a*r,l=Math.min(4*c,o);if(c){for(let e=0;e<c;e+=r)this._doProcessBlock(s,e);t=s.splice(0,c),i.sigBytes-=l}return new n(t,l)}clone(){const e=super.clone.call(this);return e._data=this._data.clone(),e}}class l extends c{constructor(e){super(),this.blockSize=16,this.cfg=Object.assign(new r,e),this.reset()}static _createHelper(e){return(t,i)=>new e(i).finalize(t)}static _createHmacHelper(e){return(t,i)=>new d(e,i).finalize(t)}reset(){super.reset.call(this),this._doReset()}update(e){return this._append(e),this._process(),this}finalize(e){e&&this._append(e);return this._doFinalize()}}class d extends r{constructor(e,t){super();const i=new e;this._hasher=i;let r=t;"string"==typeof r&&(r=a.parse(r));const n=i.blockSize,s=4*n;r.sigBytes>s&&(r=i.finalize(t)),r.clamp();const o=r.clone();this._oKey=o;const c=r.clone();this._iKey=c;const l=o.words,d=c.words;for(let a=0;a<n;a+=1)l[a]^=1549556828,d[a]^=909522486;o.sigBytes=s,c.sigBytes=s,this.reset()}reset(){const e=this._hasher;e.reset(),e.update(this._iKey)}update(e){return this._hasher.update(e),this}finalize(e){const t=this._hasher,i=t.finalize(e);t.reset();return t.finalize(this._oKey.clone().concat(i))}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(8),n=i(4),s=i(19),o=i(9),a=i(17);class c{constructor(){this.mobileVideoQualityConfiguration={video:{fixedFrameRate:20,fixedVideoWidth:960,fixedVideoHeight:540},sharing:{fixedFrameRate:5,fixedVideoWidth:1280,fixedVideoHeight:720}},this.videoQualityConfiguration={video:{fixedFrameRate:24,fixedVideoWidth:1280,fixedVideoHeight:720},sharing:{fixedFrameRate:5,fixedVideoWidth:1920,fixedVideoHeight:1080}},this.RTC={browser:"",attachMediaStream:()=>{},clearMediaStream:()=>{},attachMediaStreamIfNeeded:()=>{},attachSessionMediaToElement:()=>{}},this.callsStats={},this.callsStatsSimplified={},this.logger=n.LoggerService.getInstance(),this.settingsService=s.SettingsService.getInstance(),this.authService=r.AuthService.getInstance(),this.xmppService=o.XmppService.getInstance(),this.mainService=a.MainService.getInstance(),this.ttl=0,this.ttlTimeout=null,this.started=false,this.xmppService.connected&&this.start(),this.subscription=this.xmppService.subscribeToConnectionEvents((e=>{this.onConnectionStateChangeEvent(e)}))}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.webrtcConfigAndUtils||(e.rainbow.webrtcConfigAndUtils=new c),e.rainbow.webrtcConfigAndUtils}start(){this.deviceManagementService=this.mainService.inject("deviceManagementService"),this.logger.log("[WebrtcConfigAndUtils] -- start"),this.RTC=this.getBrowserMethodHandler(),this.setWebrtcConfiguration(),this.started=true}stop(){this.logger.log("[WebrtcConfigAndUtils] -- stop"),this.ttl=0,this.webrtcConfig=null,this.companyConfig=null,this.ttlTimeout&&(clearTimeout(this.ttlTimeout),this.ttlTimeout=null)}onConnectionStateChangeEvent(e){"ON_XMPP_DISCONNECTED"===e.name?(this.started=false,"LOGOUT"===e.data.reason?this.stop():(this.logger.log("[WebrtcConfigAndUtils] onConnectionStateChangeEvent : disconnected"),this.ttlTimeout&&(clearTimeout(this.ttlTimeout),this.ttlTimeout=null),this.ttl=0)):"ON_XMPP_CONNECTED"===e.name&&(this.logger.log("[WebrtcConfigAndUtils] onConnectionStateChangeEvent : connected"),this.started||this.start())}getBrowserMethodHandler(){return window.adapter&&"chrome"!==window.adapter.default.browserDetails.browser?"firefox"===window.adapter.default.browserDetails.browser?this.RTC={browser:"firefox",attachMediaStream:(e,t)=>{e&&e[0]&&(e[0].mozSrcObject=t,e[0].srcObject=t,e[0].play())},clearMediaStream:e=>{try{e[0]&&(e[0].pause(),e[0].mozSrcObject=null,e[0].srcObject=null,e[0].uniqueId=null)}catch(dp){this.logger.log("[WebrtcConfigAndUtils] | clearMediaStream failure "+dp)}},attachMediaStreamIfNeeded:(e,t,i)=>{this.logger.log("[WebrtcConfigAndUtils] | attachMediaStreamIfNeeded for ID "+i),e&&e[0]&&(e[0].uniqueId!==i||!e[0].mozSrcObject&&!e[0].srcObject)?(e[0].uniqueId=i,this.RTC.attachMediaStream(e,t)):e&&e[0]&&e[0].srcObject&&t&&e[0].srcObject.id!==t.id&&(this.RTC.attachMediaStream(e,t),e[0].play())},attachSessionMediaToElement:(e,t)=>{const i=document.getElementById(e);i&&t&&(t.remoteStreamsObject[0]?this.RTC.attachMediaStreamIfNeeded([i],t.remoteStreamsObject[0],t.sid):t.localStreams&&this.RTC.attachMediaStreamIfNeeded([i],t.localStreams[0],t.sid))}}:this.RTC={browser:"safari",attachMediaStream:(e,t)=>{e&&e[0]&&(e[0].setAttribute("playsinline",true),e[0].srcObject=t,e[0].play())},clearMediaStream:e=>{try{e&&e[0]&&(e[0].pause(),e[0].srcObject=null,e[0].uniqueId=null)}catch(dp){this.logger.log("[WebrtcConfigAndUtils] | clearMediaStream failure "+dp)}},attachMediaStreamIfNeeded:(e,t,i)=>{this.logger.log("[WebrtcConfigAndUtils] | attachMediaStreamIfNeeded for ID "+i),!e||!e[0]||e[0].uniqueId===i&&e[0].srcObject?e&&e[0]&&e[0].srcObject&&t&&e[0].srcObject.id!==t.id&&this.RTC.attachMediaStream(e,t):(e[0].uniqueId=i,this.RTC.attachMediaStream(e,t))},attachSessionMediaToElement:(e,t)=>{const i=document.getElementById(e);i&&t&&(t.remoteStreamsObject[0]?this.RTC.attachMediaStreamIfNeeded([i],t.remoteStreamsObject[0],t.sid):t.localStreams&&this.RTC.attachMediaStreamIfNeeded([i],t.localStreams[0],t.sid))}}:this.RTC={browser:"chrome",attachMediaStream:(e,t)=>{this.logger.log("[WebrtcConfigAndUtils] | attachMediaStream to element"),e&&e[0]&&(e[0].srcObject=t,"VIDEO"===e[0].nodeName&&(e[0].autoplay=true,e[0].muted=true))},clearMediaStream:e=>{e&&e[0]&&(e[0].pause(),e[0].srcObject=null,e[0].uniqueId=null)},attachMediaStreamIfNeeded:(e,t,i)=>{this.logger.log("[WebrtcConfigAndUtils] | attachMediaStreamIfNeeded for ID "+i),!e||!e[0]||e[0].uniqueId===i&&e[0].srcObject?e&&e[0]&&e[0].srcObject&&t&&e[0].srcObject.id!==t.id&&(this.RTC.attachMediaStream(e,t),e[0].play()):(e[0].uniqueId=i,this.RTC.attachMediaStream(e,t))},attachSessionMediaToElement:(e,t)=>{const i=document.getElementById(e);i&&t&&(t.remoteStreamsObject[0]?this.RTC.attachMediaStreamIfNeeded([i],t.remoteStreamsObject[0],t.sid):t.localStreams&&this.RTC.attachMediaStreamIfNeeded([i],t.localStreams[0],t.sid))}},this.RTC}disableAllStreamsForSession(e){if(e&&e.localStreams){if(e.localStreams.length>0){for(e.localStreams.forEach((e=>{e.getTracks().forEach((e=>{e.enabled=false,e.stop(),e=null})),e=null}));e.localStreams.length>0;)e.localStreams.pop();this.logger.log("[WebrtcConfigAndUtils] | disableAllStreamsForSession : Session streams stopped and removed.")}}else this.logger.log("[WebrtcConfigAndUtils] | disableAllStreamsForSession -- missing session or no localStreams")}disableMediaStreams(e){if(e&&e.length)for(e.forEach((e=>{e.getTracks().forEach((e=>{e.enabled=false,e.stop(),e=null})),e=null}));e.length>0;)e.pop()}disableMediaStream(e){e&&(e.getTracks().forEach((e=>{e.enabled=false,e.stop(),e=null})),e=null)}getMobileMediaConstraints(e){return this.mobileVideoQualityConfiguration[e]}async createOrUpdateStatisticsForCall(e){try{if(!e)throw new Error("[WebrtcConfigAndUtils] createOrUpdateStatisticsForCall -- missing call");if(!e.contact)throw new Error("[WebrtcConfigAndUtils] createOrUpdateStatisticsForCall -- missing contact for call");const t=e.id,i=e.contact.dbId?e.contact.dbId:e.contact.id;if(!t||!i)throw new Error(`[WebrtcConfigAndUtils] createOrUpdateStatisticsForCall -- missing informations for ${t} `);const r=[];if(this.callsStats[t])return this.callsStats[t].RainMetrics&&this.callsStats[t].push(this.callsStats[t].RainMetrics),r.push({connectionId:t,stats:this.callsStats[t]}),void(await this.updateStatisticsForCall(this.callsStats[t].id,t,"ended",r));this.logger.info("[WebrtcConfigAndUtils] createOrUpdateStatisticsForCall "+t),this.callsStats[t]={},r.push({connectionId:t,stats:this.callsStats[t]});const n=await this.createStatisticsForSession(t,i,"pending");this.callsStats[t].id=n,this.logger.info("[WebrtcConfigAndUtils] createOrUpdateStatisticsForCall success for session "+t+" with id "+n)}catch(t){this.logger.error("[WebrtcConfigAndUtils] createOrUpdateStatisticsForCall error -- "+t.message)}}async updateStatisticsForCall(e,t,i,r){try{if(!e)throw new Error("[WebrtcConfigAndUtils] updateStatisticsForCall -- missing id "+e);this.logger.info("[WebrtcConfigAndUtils] updateStatisticsForCall "+t);const n=config.restServerUrl+"/api/rainbow/metrics/v1.0/";window.adapter.default.browserDetails.browser&&r[0]&&r[0].stats&&r[0].stats.push({browser:window.adapter.default.browserDetails.browser});const s=await fetch(n+"webrtcmetrics/"+e+"/metrics",{method:"POST",headers:this.authService.getPostHeader(),body:JSON.stringify({metrics:r})});if(!s.ok)throw s;if(this.logger.info("[WebrtcConfigAndUtils] updateStatisticsForCall success"),"ended"===i){this.logger.info("[WebrtcConfigAndUtils] updateStatisticsForCall -- update call state with "+i);const t=await fetch(n+"webrtcmetrics/"+e,{method:"PUT",headers:this.authService.getPostHeader(),body:JSON.stringify({callState:i})});if(!t.ok)throw t;this.logger.info("[WebrtcConfigAndUtils] updateStatisticsForCall -- update call state success")}}catch(n){this.logger.error("[WebrtcConfigAndUtils] updateStatisticsForCall failure "+n.errorMsg)}}async createStatisticsForSession(e,t,i){try{this.logger.info("[WebrtcConfigAndUtils] createStatisticsForSession "+e);const r=config.restServerUrl+"/api/rainbow/metrics/v1.0/webrtcmetrics",n=await fetch(r,{method:"POST",headers:this.authService.getPostHeader(),body:JSON.stringify({callId:e,peerId:t,callState:i})});if(!n.ok)throw n;const s=(await n.json()).data,o=s?s.id:null;return this.logger.info("[WebrtcConfigAndUtils] createStatisticsForSession success"),o&&!this.callsStats[e]&&(this.callsStats[e]={}),o}catch(r){throw this.logger.error("[WebrtcConfigAndUtils] createStatisticsForSession failure "+r.errorMsg),r}}async setWebrtcConfiguration(){try{const e=[];e.push(this.setIceConfig()),e.push(this.setCompanyWebrtcConfig()),await Promise.all(e),this.logger.info("[WebrtcConfigAndUtils] setWebrtcConfiguration -- done")}catch(e){this.logger.info("[WebrtcConfigAndUtils] setWebrtcConfiguration -- error -- proceed anyway")}}async getVirginBrowserMedia(e){try{this.logger.info("[WebrtcConfigAndUtils] getVirginBrowserMedia");const t=this.getConstraintsForMedia(e),i=await navigator.mediaDevices.getUserMedia(t);return this.logger.info("[WebrtcConfigAndUtils] getVirginBrowserMedia -- done"),i.getAudioTracks().length&&this.logger.info("[WebrtcConfigAndUtils] getVirginBrowserMedia audio stream kind "+i.getAudioTracks()[0].kind+", id "+i.getAudioTracks()[0].id+", label "+i.getAudioTracks()[0].label+", readyState "+i.getAudioTracks()[0].readyState+", enabled "+i.getAudioTracks()[0].enabled),i.getVideoTracks().length&&this.logger.info("[WebrtcConfigAndUtils] getVirginBrowserMedia video stream kind "+i.getVideoTracks()[0].kind+", id "+i.getVideoTracks()[0].id+", label "+i.getVideoTracks()[0].label+", readyState "+i.getVideoTracks()[0].readyState+", enabled "+i.getVideoTracks()[0].enabled),i}catch(t){throw this.logger.info("[WebrtcConfigAndUtils] getVirginBrowserMedia -- error -- "+t),t}}getConstraintsForMedia(e){const t={};if(this.logger.info("[WebrtcConfigAndUtils] getConstraintsForMedia with medias: "+e),e.indexOf("audio")>=0){const e=this.deviceManagementService.getCurrentAudioInputDevice();t.audio=true;let i="default";e&&e.deviceId&&(t.audio={deviceId:{exact:e.deviceId}},i="id - "+e.deviceId+" and label "+e.label),this.logger.info("[WebrtcConfigAndUtils] getConstraintsForMedia for microphone "+i)}if(e.indexOf("video")>=0){t.video=true;const e=this.deviceManagementService.getCurrentVideoInputDevice();let i="default";e&&e.deviceId&&"default"!==e.deviceId&&(t.video={deviceId:{exact:e.deviceId}},i="id - "+e.deviceId+" and label "+e.label),this.logger.info("[WebrtcConfigAndUtils] GetUserMedia for camera "+i)}return t.audio||(t.audio=false),t.video||(t.video=false),t}async setIceConfig(){try{if(this.webrtcConfig&&0!==this.ttl)return this.logger.info("[WebrtcConfigAndUtils] setIceConfig from stored variable"),void(this.xmppService.connection.jingle.ice_config=this.webrtcConfig);this.webrtcConfig&&(this.xmppService.connection.jingle.ice_config=this.webrtcConfig);const e=await this.getIceConfig();if(this.webrtcConfig)this.webrtcConfig.iceServers=e.iceServers,this.webrtcConfig.dc=e.dc;else{this.webrtcConfig=e;"true"===this.settingsService.getSetting("enableDSCP")&&(this.logger.info("[WebrtcConfigAndUtils] setWebrtcConfiguration - DSCP is enabled"),this.webrtcConfig.enableDSCP=true);"true"===this.settingsService.getSetting("dtx")&&(this.logger.info("[WebrtcConfigAndUtils] setWebrtcConfiguration - DTX is enabled"),this.webrtcConfig.dtx=true),this.logger.info("[WebrtcConfigAndUtils] setWebrtcConfiguration - Simulcasting is enabled"),this.webrtcConfig.simulcast=true;"true"===this.settingsService.getSetting("debugWebRTC")&&(this.logger.info("[WebrtcConfigAndUtils] setWebrtcConfiguration - debugWebRTC is enabled"),this.webrtcConfig.debugWeRTC=true)}this.xmppService.connection.jingle.ice_config=this.webrtcConfig,this.logger.info("[WebrtcConfigAndUtils] setIceConfig from server success !")}catch(e){throw this.logger.error("[WebrtcConfigAndUtils] setIceConfig from server ERROR : "+e),e}}async getIceConfig(){const e=this.settingsService.getSetting("geoip");let t="";e&&(t="&geoip="+e);const i=config.restServerUrl+"/api/rainbow/geolocation/v1.0/settings/iceservers?nbServers=2"+t;try{const e=await fetch(i,{method:"GET",headers:this.authService.getRequestHeader()});if(!e.ok)throw e;const t=await e.json();this.ttl=t.ttl,this.ttl&&(this.ttlTimeout=setTimeout((()=>{this.ttl=0,this.setWebrtcConfiguration()}),1e3*t.ttl));const r=t.data,n=[];return r.forEach((function(e){e.dc&&!n.includes(e.dc)&&n.push(e.dc),delete e.dc,delete e.id}),this),this.logger.info(`[WebrtcConfigAndUtils] getIceConfig success -- iceServers number ${r.length} and dc number ${n.length}`),{iceServers:r,dc:n}}catch(r){throw this.logger.error("[WebrtcConfigAndUtils] getIceConfig failure -- "+r.message),r}}async setCompanyWebrtcConfig(){try{if(this.companyConfig)return this.logger.info("[WebrtcConfigAndUtils] setCompanyWebrtcConfig from stored variable"),this.xmppService.connection.jingle.company_config=this.companyConfig,void this.setVideoQualityConfigurationForCompany();this.logger.info("[WebrtcConfigAndUtils] setCompanyWebrtcConfig"),this.companyConfig=await this.getCompanyWebrtcConfig(),this.xmppService.connection.jingle.company_config=this.companyConfig,this.setVideoQualityConfigurationForCompany(),this.logger.info("[WebrtcConfigAndUtils] setCompanyWebrtcConfig from server success !")}catch(e){throw this.logger.error("[WebrtcConfigAndUtils] setCompanyWebrtcConfig from server ERROR : "+e),e}}setVideoQualityConfigurationForCompany(){this.companyConfig&&this.companyConfig.video&&(this.videoQualityConfiguration.video.fixedVideoHeight=this.companyConfig.video.height?this.companyConfig.video.height:this.videoQualityConfiguration.video.fixedVideoHeight,this.videoQualityConfiguration.video.fixedVideoWidth=this.companyConfig.video.width?this.companyConfig.video.width:this.videoQualityConfiguration.video.fixedVideoWidth,this.videoQualityConfiguration.video.fixedFrameRate=this.companyConfig.video.frameRate?this.companyConfig.video.frameRate:this.videoQualityConfiguration.video.fixedFrameRate),this.companyConfig&&this.companyConfig.sharing&&(this.videoQualityConfiguration.sharing.fixedVideoHeight=this.companyConfig.sharing.height?this.companyConfig.sharing.height:this.videoQualityConfiguration.sharing.fixedVideoHeight,this.videoQualityConfiguration.sharing.fixedVideoWidth=this.companyConfig.sharing.width?this.companyConfig.sharing.width:this.videoQualityConfiguration.sharing.fixedVideoWidth,this.videoQualityConfiguration.sharing.fixedFrameRate=this.companyConfig.sharing.frameRate?this.companyConfig.sharing.frameRate:this.videoQualityConfiguration.sharing.fixedFrameRate)}async getCompanyWebrtcConfig(){try{const e=config.restServerUrl+"/api/rainbow/enduser/v1.0/settings/webrtc",t=await fetch(e,{method:"GET",headers:this.authService.getRequestHeader()});if(!t.ok)throw t;const i=(await t.json()).data;return this.logger.info("[WebrtcConfigAndUtils] getCompanyWebrtcConfig success"),i}catch(e){const t=e&&e.data?e.data.errorDetails:"Unknown error";if(e&&e.data&&400100===e.data.errorDetailsCode)return this.logger.info("[WebrtcConfigAndUtils] getCompanyWebrtcConfig -- "+t),{};throw this.logger.error("[WebrtcConfigAndUtils] getCompanyWebrtcConfig failure -- "+t),e}}}t.WebrtcConfigAndUtils=c},function(e,t,i){i.d(t,"a",(function(){return r}));var r=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}()},function(e,t,i){function r(e){return"function"==typeof e}i.d(t,"a",(function(){return r}))},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(19),n=i(4),s=i(7);class o{constructor(){this.isInitialized=false,this.subject=new s.Subject,this.settingsService=r.SettingsService.getInstance(),this.loggerService=n.LoggerService.getInstance(),this.subscription=this.settingsService.subscribeUpdateEvent("LANGUAGE_UPDATED",(()=>{this.updateTranslationLanguage()}))}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.i18nService||(e.rainbow.i18nService=new o),e.rainbow.i18nService}subscribe(e){return this.subject.subscribe(e)}async configure(e){this.translator=e,await this.updateTranslationLanguage()}translate(e,t=null){return this.translator?this.translator.instant(e,t):e}getCurrentLanguage(){return this.translator?this.translator.use():"en"}async updateTranslationLanguage(){try{const e=this.settingsService.getAppliLanguage();if(this.translator){const t=await this.translator.use(e.code);this.loggerService.info(`[I18nService] updateTranslationLanguage -- "${t}" labels are loaded`),this.isInitialized=true,this.subject.next()}moment.locale(e.codeMoment)}catch(e){this.loggerService.error("[I18nService] updateTranslationLanguage -- failure")}}}t.I18nService=o},function(e,t,i){(function(e){Object.defineProperty(t,"__esModule",{value:true});const r=i(76),n=i(423),s=i(8),o=i(9),a=i(4),c=i(37),l=i(13),d=i(11),u=i(7),h=i(497),f=i(17);class p{release(){URL.revokeObjectURL(this.url)}constructor(e,t){t&&(this.url=URL.createObjectURL(t)),this.fd=e}}t.LocalImage=p;t.Capabilities=class{};class g{constructor(){this.ONE_KILOBYTE=1024,this.ONE_MEGABYTE=1048576,this.ONE_GIGABYTE=1073741824,this.FILE_RANGE=4*this.ONE_MEGABYTE,this.PARALLEL_REQUEST_NB=10,this._started=false,this.serviceStatusSubject=new u.Subject,this.portalURL=config.restServerUrl+"/api/rainbow/fileserver/v1.0/files",this.thumbnailPromises=[],this.thumbnailPreviewPromises=[],this.authService=s.AuthService.getInstance(),this.xmppService=o.XmppService.getInstance(),this.logger=a.LoggerService.getInstance(),this.fileStorageService=c.FileStorageService.getInstance(),this.errorHelperService=l.ErrorHelperService.getInstance(),this.centralizedService=null,this.eventService=d.EventService.getInstance(),this.mainService=f.MainService.getInstance(),this.fileReader=new FileReader}get started(){return this._started}set started(e){this._started=e,this.serviceStatusSubject.next(this._started)}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.fileServerService||(e.rainbow.fileServerService=new g),e.rainbow.fileServerService}async waitTillStarted(){return new Promise((e=>{this.started?e():this.serviceStatusSubject.pipe(h.filter((e=>true===e))).subscribe((()=>{e()}))}))}async start(){try{this.logger.info("[FileServerService] === STARTING ===");try{"caches"in self&&(this.cache=await caches.open("RainbowImageCache"))}catch(e){}this.started=true,this.portalURL=config.restServerUrl+"/api/rainbow/fileserver/v1.0/files",await this.getServercapabilities();try{this.centralizedService=this.mainService.inject("centralizedService")}catch(e){}this.attachHandlers(),this.logger.info("[FileServerService] === STARTED ===")}catch(e){this.logger.error("[FileServerService] === STARTING FAILURE === "+e.message)}}async stop(){this.logger.info("[FileServerService] === STOPPING ==="),this.started&&(this.started=false),this.logger.info("[FileServerService] === STOPPED ===")}reconnect(){this.attachHandlers()}attachHandlers(){this.removeHandlers(),this.fileDescriptorEventHandler=n.FileDescriptorEventHandlerService.create(),this.fileMessageHandlerRef||(this.fileMessageHandlerRef=this.xmppService.addHandler((e=>(setTimeout((()=>{this.fileDescriptorEventHandler.onManagementMessageReceived(e)}),250),true)),null,"message","management"))}removeHandlers(){this.fileDescriptorEventHandler=void 0,this.fileMessageHandlerRef=void 0}async getFileDescriptorPublicUrl(e){if(await this.waitTillStarted(),!e)return null;if((!this.centralizedService||!this.centralizedService.isDesktopApp())&&e.publicUrl){this.logger.info("[FileServerService]  >getFileDescriptorPublicUrl: publicUrlExpirationDate="+moment(e.publicUrlExpirationDate).format("DD-MM-YYYY_H_mm_ss")),this.logger.info("[FileServerService]  >getFileDescriptorPublicUrl: isDateExpired="+e.isPublicUrlExpired());const t=moment(),i=moment.duration(moment(e.publicUrlExpirationDate).diff(t)).asSeconds();if(this.logger.info("[FileServerService] >getFileDescriptorPublicUrl: date expiration="+i),i>1800)return e.publicUrl}try{const t=new URL(this.portalURL+"/"+e.id+"/temporary-url"),i=this.authService.getRequestHeader();i["Content-Type"]="application/json";const r=await fetch(t.href,{method:"GET",headers:i});if(r.ok){const t=await r.json();e.publicUrl=t.data.url;const i=moment(t.data.expirationDate);return i.isValid()&&(e.publicUrlExpirationDate=i.toDate(),this.logger.info("[FileServerService] >getFileDescriptorPublicUrl: Get PublicUrl Success, publicUrlExpirationDate="+moment(e.publicUrlExpirationDate).format("DD-MM-YYYY_H_mm_ss"))),this.logger.info("[FileServerService] Get PublicUrl Success"),e.publicUrl}return""}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getFileDescriptorPublicUrl");throw this.logger.error("[FileServerService] "+e.message),e.error}}async getFileDescriptorUrl(e,t=false,i=false){try{let r=null;const n=new Request(`/rainbowImages/${t?"thumbnail/":""}${e.id}`);if(i&&this.cache){const e=await this.cache.match(n);e&&(r=await e.blob())}return r||(t?r=e.previewBlob?e.previewBlob:await this.getBlobThumbnailFromFileDescriptor(e):(r=await this.getBlobFromFileDescriptor(e,false,null),!e.orientation&&e.isImage()&&await this.setImageOrientationForFileDescriptor(e,r).catch((()=>{}))),i&&this.cache&&this.cache.put(n,new Response(r))),URL.createObjectURL(r)}catch(r){throw new Error(`getFileDescriptorUrl(${e.id}, ${t}) -- failure -- ${r}`)}}removeFileDescriptorFromCache(e){this.cache&&(this.cache.delete("/rainbowImages/thumbnail/"+e.id),this.cache.delete("/rainbowImages/"+e.id))}async clearCache(){if(this.cache)try{await caches.delete("RainbowImageCache"),this.cache=await caches.open("RainbowImageCache")}catch(e){}}async getLocalImage(e,t,i=true){await this.waitTillStarted();try{let r=this.fileStorageService.getFileDescriptorById(e);r||(r=await this.fileStorageService.retrieveAndStoreOneFileDescriptor(e)),r.fileName.includes("__rboriginal__")&&(t=false);let n=null;return n=t&&r.previewBlob&&!i?r.previewBlob:t?await this.getLargeBlobThumbnail(r):await this.getBlobFromFileDescriptor(r,false,null),new p(r,n)}catch(r){throw this.logger.debug(`[fileServerService] getFileLocalURL -- no file descriptor found with ${e} + " id.`),r}}getLargeBlobThumbnail(e){const t=e.url+"?thumbnail500=true";return this.getBlobFileDescriptorFromUrl(t,e)}async getPartialDataFromServer(e,t,i,r,n,s,o){try{await this.waitTillStarted();const s=this.authService.getRequestHeaderWithRange("bytes="+i+"-"+r),a=await fetch(t,{method:"GET",headers:s,signal:e.abortTransferController.signal});if(!a.ok)throw a;const c=a.body.getReader(),l=Number(a.headers.get("Content-Length"));let d=0;const u=[];let h=true;for(;h;){const{done:t,value:i}=await c.read();if(t){h=false;continue}if(u.push(i),d+=i.length,e.loadingRef!==o){this.logger.info("[FileServerService] This load has been canceled - NTIA");continue}const r=Math.floor(100*d/l);e&&(e.chunkPercentArray[n]=r,e.updateProgressInfo())}return{data:new Blob(u),index:n}}catch(a){if(a instanceof DOMException&&a.code===DOMException.ABORT_ERR)throw this.logger.warn("[FileServerService] "+a.message),a;{const e=await this.errorHelperService.getErrorInfo(a,"getPartialDataFromServer");throw this.logger.error("[FileServerService] "+e.message),e.error}}}getFileStorageService(){return this.fileStorageService}async getBlobThumbnailPreviewFromFileDescriptor(e){await this.waitTillStarted();const t=e.url+"?thumbnail500=true";return this.thumbnailPreviewPromises[e.id]=new Promise(((i,r)=>{this.getBlobFileDescriptorFromUrl(t,e).then((t=>{(e=this.fileStorageService.getFileDescriptorById(e.id)).previewBlob=t,e.previewDownloaded=true,e.previewBlobSubject.next(e.previewBlob),this.eventService.publish("ON_FILE_TRANSFER_EVENT",{result:"success",type:"download",fileDesc:e}),delete this.thumbnailPreviewPromises[e.id],i(t)})).catch((t=>{this.eventService.publish("ON_FILE_TRANSFER_EVENT",{result:"failure",type:"download",message:t.message,fileDesc:e}),delete this.thumbnailPreviewPromises[e.id],r(t)}))})),this.thumbnailPreviewPromises[e.id]}async getBlobThumbnailFromFileDescriptor(e){if(await this.waitTillStarted(),e.thumbnail.isThumbnailAvailable()||e.isImage()||e.recordingFile){let t=e.url;return e.thumbnail.isThumbnailAvailable()?this.thumbnailPreviewPromises[e.id]?(this.logger.info("[FileServerService] getBlobThumbnailFromFileDescriptor preview for "+e.id+" already lauched"),this.thumbnailPreviewPromises[e.id]):this.getBlobThumbnailPreviewFromFileDescriptor(e):this.thumbnailPromises[e.id]?(this.logger.info("[FileServerService] getBlobThumbnailFromFileDescriptor full image update for "+e.id+" already lauched"),this.thumbnailPromises[e.id]):(e.uploadedDate&&(t+="?update="+f.MainService.MD5(e.uploadedDate)),this.thumbnailPromises[e.id]=new Promise(((i,r)=>{this.getBlobFileDescriptorFromUrl(t,e).then((async t=>{(e=e.recordingFile?await this.fileStorageService.retrieveOneFileDescriptor(e.id):this.fileStorageService.getFileDescriptorById(e.id))&&(e.previewBlob||(e.previewBlob=t),!e.orientation&&e.isImage()&&await this.setImageOrientationForFileDescriptor(e,t).catch((()=>{})),e.previewBlobSubject.next(e.previewBlob),this.eventService.publish("ON_FILE_TRANSFER_EVENT",{result:"success",type:"download",fileDesc:e}),delete this.thumbnailPromises[e.id],i(t))})).catch((t=>{this.eventService.publish("ON_FILE_TRANSFER_EVENT",{result:"failure",type:"download",message:t.message,fileDesc:e}),delete this.thumbnailPromises[e.id],r(t)}))})),this.thumbnailPromises[e.id])}throw new Error("No available thumbnail")}async callAndProcessGetPartialDataFromServer(e,t,i,r,n,s,o,a,c=null){try{const l=await this.getPartialDataFromServer(e,t,i,r,n,s,o);return e.loadingRef!==o?(this.logger.info("[FileServerService] This load has been canceled - NTIA"),null):(e.updateProgressInfo(),this.logger.info("[FileServerService] getBlobFromFileDescriptor : chunk"+n+" downloaded"),this.logger.debug("[FileServerService] refreshFilePercent: chunkPerformedPercent="+e.chunkPerformedPercent),a[l.index]=l.data,this.writeAvailableChunksInDisk(e,a),this.eventService.publish("ON_FILE_TRANSFER_EVENT",{type:"download",fileDesc:e,cancelable:s}),c?(await c(l,e.id),l.data):l)}catch(l){throw this.logger.info("[FileServerService] error on chunk download="+l),l}}async getBlobFromFileDescriptor(e,t=true,i=null){if(await this.waitTillStarted(),!e){const e=new Error("[FileServerService] getBlobFromFileDescriptor : missing file descriptor");throw this.logger.warn(e.message),e}if(this.logger.info("[FileServerService] getBlobFromFileDescriptor: "+e.id),e.state!==r.FileState.UPLOADED){const t=new Error("[FileServerService] getBlobFromFileDescriptor : file is not in uploaded state="+e.state);throw this.logger.warn(t.message),t}let n=e.url;e.uploadedDate&&(n+="?update="+f.MainService.MD5(e.uploadedDate));let s=this.FILE_RANGE;if(Boolean(this.capabilities.maxChunkSizeDownload)&&0!==e.size&&e.size>s){e.size>=100*s&&(s=e.size/100+this.ONE_KILOBYTE,this.logger.debug("[FileServerService] changing chunk size: "+s));const o=[],a=[];e.state=r.FileState.DOWNLOADING,e.chunkTotalNumber=Math.ceil(e.size/s),e.chunkPerformedPercent=0,e.chunkWrittenInDisk=-1,e.chunkPercentArray=new Array(e.chunkTotalNumber),e.chunkPercentArray.fill(0),e.abortTransferController=new AbortController;const c=++e.loadingRef;e.updateProgressInfo(),this.eventService.publish("ON_FILE_TRANSFER_EVENT",{type:"download",fileDesc:e,cancelable:t}),this.logger.info("[FileServerService] getBlobFromFileDescriptor: need to download "+e.chunkTotalNumber+" chunks");for(let r=0;r<e.chunkTotalNumber;r++){let l=r*s,d=(r+1)*s-1;d=d<e.size?d:e.size,a.push({fileDescriptor:e,url:n,minRange:l,maxRange:d,i:r,cancelable:t,currentLoadingRef:c,blobArray:o,actionOnPartialResponse:i})}return new Promise(((t,i)=>{e.fileTransferSubscription=u.from(a).pipe(h.mergeMap((e=>this.callAndProcessGetPartialDataFromServer(e.fileDescriptor,e.url,e.minRange,e.maxRange,e.i,e.cancelable,e.currentLoadingRef,e.blobArray,e.actionOnPartialResponse)),this.PARALLEL_REQUEST_NB)).pipe(h.catchError((async t=>{if(e.loadingRef!==c)return void this.logger.info("[FileServerService] This load has been canceled - NTIA");e.setState(r.FileState.UPLOADED),e.chunkTotalNumber=0,e.chunkPerformedPercent=0,t instanceof DOMException&&t.code===DOMException.ABORT_ERR&&(this.logger.warn("[FileServerService] "+t.message),i(t));const n=await this.errorHelperService.getErrorInfo(t,"getFileDescriptorPublicUrl"),s=n.error&&n.error.translatedMessage?n.error.translatedMessage:n.message;this.logger.error("[FileServerService] error= "+s),this.eventService.publish("ON_FILE_TRANSFER_EVENT",{result:"failure",type:"download",message:s,fileDesc:e}),i(n)}))).pipe(h.toArray()).subscribe((()=>{if(e.loadingRef!==c)return void this.logger.info("[FileServerService] This load has been canceled - NTIA");this.logger.info("[FileServerService] getBlobFromFileDescriptor: promisesCompletion");const i=new Blob(o,{type:e.typeMIME});this.logger.info("[FileServerService] getBlobFromFileDescriptor success"),e.setState(r.FileState.UPLOADED),e.chunkTotalNumber=0,e.chunkPerformedPercent=0,e.updateProgressInfo(),this.writeAvailableChunksInDisk(e,o),e.writeStream&&(this.logger.info("[FileServerService] Close WriteStream"),e.writeStream.end()),this.eventService.publish("ON_FILE_TRANSFER_EVENT",{type:"download",fileDesc:e}),t(i)}))}))}try{e.state=r.FileState.DOWNLOADING;const t=await this.getBlobFileDescriptorFromUrl(n,e);return this.eventService.publish("ON_FILE_TRANSFER_EVENT",{fileDesc:e}),t}catch(o){throw e.state=r.FileState.UPLOADED,this.eventService.publish("ON_FILE_TRANSFER_EVENT",{fileDesc:e}),this.logger.info("[FileServerService] arrayPromise : error "+o.message),o}}writeAvailableChunksInDisk(t,i){if(this.logger.debug("[FileServerService] >writeAvailableChunksInDisk"),!t.writeStream)return;const r=t.chunkWrittenInDisk+1;this.logger.debug("[FileServerService] >writeAvailableChunksInDisk : We start at "+r);for(let n=r;n<i.length;n++){if(!i[n]){this.logger.debug("[FileServerService] >writeAvailableChunksInDisk : Blob "+n+" NOT available");break}this.logger.debug("[FileServerService] >writeAvailableChunksInDisk : Blob "+n+" available"),t.chunkWrittenInDisk=n,t.writeStream.write(e.from(i[n])),i[n]=null}}async getBlobFileDescriptorFromUrl(e,t){await this.waitTillStarted(),this.logger.debug("[FileServerService] >getBlobFileDescriptorFromUrl: "+e),t.chunkTotalNumber=1,t.chunkPerformedPercent=0,t.chunkPercentArray=new Array(t.chunkTotalNumber),t.chunkPercentArray.fill(0);const i=++t.loadingRef;t.updateProgressInfo(),this.eventService.publish("ON_FILE_TRANSFER_EVENT",{fileDesc:t,cancelable:false});try{const n=this.authService.getRequestHeader(),s=await fetch(e,{method:"GET",headers:n,signal:t.abortTransferController.signal});if(!s.ok)throw s;const o=s.body.getReader(),a=Number(s.headers.get("Content-Length"));let c=0;const l=[];let d=true;for(;d;){const{done:e,value:r}=await o.read();if(e){d=false;continue}if(l.push(r),c+=r.length,t.loadingRef!==i){this.logger.info("[FileServerService] This load has been canceled - NTIA");continue}const n=Math.floor(100*c/a);t&&(t.chunkPercentArray[0]=n,t.updateProgressInfo())}if(t.loadingRef!==i)return this.logger.info("[FileServerService] This load has been canceled - NTIA"),null;const u=new Blob(l,{type:t.typeMIME});return t.state=r.FileState.UPLOADED,t.chunkPerformedPercent=0,t.updateProgressInfo(),this.logger.debug("[FileServerService] getBlobFileDescriptorFromUrl success"),u}catch(n){if(t.loadingRef!==i)return this.logger.info("[FileServerService] This load has been canceled - NTIA"),null;t.state=r.FileState.UPLOADED;const e=await this.errorHelperService.getErrorInfo(n,"getBlobFileDescriptorFromUrl");throw this.logger.error("[FileServerService] "+e.message),e.error}}async getBlobUrlAndOrientationByFileDescriptorId(e){const t=this.fileStorageService.getFileDescriptorById(e);if(!t)throw this.logger.error("[FileServerService] getBlobUrlAndOrientationById no file descriptor found for ID "+e),new Error("[FileServerService] getBlobUrlAndOrientationById no file descriptor found");try{const r=await this.getBlobFromFileDescriptor(t,false,null),n={id:e,blob:r,blobUrl:URL.createObjectURL(r)};if(t.orientation)return n.orientation=t.orientation,t.blobOrientationSubject.next(n),n;try{const e=await this.setImageOrientationForFileDescriptor(t,r);n.orientation=e}catch(i){}return t.blobOrientationSubject.next(n),n}catch(i){throw this.logger.error("[FileServerService] Error on getBlobFromFileDescriptor"),i}}setImageOrientationForFileDescriptor(e,t){return new Promise(((i,r)=>{if(!e||!e.isImage())return void r();const n=new FileReader;n.onload=t=>{e.orientation=1;const n=t.target.result,s=new DataView(n);if(65496!==s.getUint16(0,false))return void r();const o=s.byteLength;let a=2;for(;a<o;){if(s.getUint16(a+2,false)<=8)return void r();const t=s.getUint16(a,false);if(a+=2,65505===t){if(1165519206!==s.getUint32(a+=2,false))return void r();const t=18761===s.getUint16(a+=6,false);a+=s.getUint32(a+4,t);const n=s.getUint16(a,t);a+=2;for(let r=0;r<n;r++)if(274===s.getUint16(a+12*r,t)){const n=s.getUint16(a+12*r+8,t);return e.orientation=n,void i(n)}}else{if(65280!=(65280&t))break;a+=s.getUint16(a,false)}}r()},n.readAsArrayBuffer(t)}))}async sendPartialDataToServer(e){await this.waitTillStarted();const t=e.fileDescriptor;return this.eventService.publish("ON_FILE_TRANSFER_EVENT",{fileDesc:t,cancelable:true}),new Promise(((i,r)=>{const n=new XMLHttpRequest;let s=new URL(this.portalURL+"/"+t.id),o=this.authService.getPostHeader("application/octet-stream");t.chunkTotalNumber>1&&(s=new URL(this.portalURL+"/"+t.id+"/parts/"+e.index),o=this.authService.getPostHeaderWithRange("bytes "+e.minRange+"-"+e.maxRange+"/"+t.size,"application/octet-stream")),n.open("PUT",s.href),Object.entries(o).map((([e,t])=>{n.setRequestHeader(e,t)})),t.abortXMLHttpRequestArray.push((()=>{n.abort()})),n.upload.addEventListener("progress",(i=>{const r=i.loaded/i.total*100;t.chunkPercentArray[e.index]=r,t.updateProgressInfo()})),n.onload=()=>{if(200!==n.status){const e={errorDetailsCode:n.status,message:n.statusText};r(e)}const s=JSON.parse(n.responseText).data;this.logger.info("[FileServerService] sendPartialDataToServer success"),t.chunkPercentArray[e.index]=100,t.updateProgressInfo(),this.eventService.publish("ON_FILE_TRANSFER_EVENT",{fileDesc:t,cancelable:true}),i(s)},n.onerror=async e=>{const t=await this.errorHelperService.getErrorInfo(e,"sendPartialDataToServer");this.logger.error("[FileServerService] "+t.message),r(t.error)},n.addEventListener("abort",(()=>{this.logger.warn(`[FileServerService] Request aborted for ${t.id} - part: ${e.index}`),i(null)})),n.send(e.blob)}))}async uploadAFileByChunk(e,t){await this.waitTillStarted(),this.logger.info("[FileServerService] >uploadAFileByChunk");let i=this.FILE_RANGE;t.size>=100*i&&(i=Math.round(t.size/100+this.ONE_KILOBYTE),this.logger.debug("[FileServerService] changing chunk size: "+i));const n=Math.ceil(t.size/i),s=[];e.chunkTotalNumber=n,e.chunkPerformedPercent=0,e.chunkPercentArray=new Array(e.chunkTotalNumber),e.chunkPercentArray.fill(0),e.state=r.FileState.UPLOADING;for(let r=0;r<n;r++){const o=r*i;let a=(r+1)*i-1;a=a<t.size?a:t.size;const c=t.slice(o,a+1);s.push({fileDescriptor:e,blob:c,minRange:o,maxRange:a,index:r,nbOfChunks:n})}const o=u.from(s);return new Promise(((t,i)=>{e.fileTransferSubscription=o.pipe(h.mergeMap((e=>this.sendPartialDataToServer(e)),this.PARALLEL_REQUEST_NB)).pipe(h.catchError((async t=>{this.eventService.publish("ON_FILE_TRANSFER_EVENT",{result:"failure",type:"upload",fileDesc:e});try{const e=await this.errorHelperService.getErrorInfo(t,"uploadAFileByChunk"),r=e.error&&e.error.translatedMessage?e.error.translatedMessage:e.message;throw this.logger.error("[FileServerService] error= "+r),i(e),e}catch(r){throw i(t),t}}))).pipe(h.toArray()).subscribe((async()=>{try{if(e.chunkTotalNumber>1){const t=new URL(this.portalURL+"/"+e.id+"/parts/end"),i=this.authService.getPostHeader("application/octet-stream"),r=await fetch(t.href,{method:"PUT",headers:i});if(!r.ok)throw r}this.logger.info("[FileServerService] uploadAFileByChunk success"),e.setState(r.FileState.UPLOADED),e.chunkPerformed=0,e.chunkTotalNumber=0,e.chunkPerformedPercent=0,e.fileToSend=null,this.eventService.publish("ON_FILE_TRANSFER_EVENT",{result:"success",type:"upload",fileDesc:e}),this.fileStorageService.removeUploadingFileDescriptor(e),this.fileStorageService.orderDocuments(),this.fileStorageService.retrieveUserConsumption(),t(e)}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"uploadAFileByChunk");throw this.logger.error("[FileServerService] "+e.message),e.error}}),(()=>{this.eventService.publish("ON_FILE_TRANSFER_EVENT",{result:"failure",type:"upload",fileDesc:e}),this.fileStorageService.removeUploadingFileDescriptor(e),this.fileStorageService.retrieveUserConsumption()}))}))}async uploadFile(e){await this.waitTillStarted();const t=e.fileToSend;this.logger.info("[FileServerService] >uploadFile");let i=this.FILE_RANGE;t.size>=100*i&&(i=Math.round(t.size/100+this.ONE_KILOBYTE),this.logger.debug("[FileServerService] changing chunk size: "+i));const n=Math.ceil(t.size/i),s=[];e.chunkTotalNumber=n,e.chunkPerformedPercent=0,e.chunkPercentArray=new Array(e.chunkTotalNumber),e.chunkPercentArray.fill(0),e.state=r.FileState.UPLOADING;for(let r=0;r<n;r++){const o=r*i;let a=(r+1)*i-1;a=a<t.size?a:t.size;const c=t.slice(o,a+1);s.push({fileDescriptor:e,blob:c,minRange:o,maxRange:a,index:r,nbOfChunks:n})}const o=u.from(s);return new Promise(((t,i)=>{e.fileTransferSubscription=o.pipe(h.mergeMap((e=>this.sendPartialDataToServer(e)),this.PARALLEL_REQUEST_NB)).pipe(h.catchError((async t=>{this.eventService.publish("ON_FILE_TRANSFER_EVENT",{result:"failure",type:"upload",fileDesc:e});try{const e=await this.errorHelperService.getErrorInfo(t,"uploadFile"),r=e.error&&e.error.translatedMessage?e.error.translatedMessage:e.message;throw this.logger.error("[FileServerService] error= "+r),i(e),e}catch(r){throw i(t),t}}))).pipe(h.toArray()).subscribe((async()=>{try{if(e.chunkTotalNumber>1){const t=new URL(this.portalURL+"/"+e.id+"/parts/end"),i=this.authService.getPostHeader("application/octet-stream"),r=await fetch(t.href,{method:"PUT",headers:i});if(!r.ok)throw r}this.logger.info("[FileServerService] uploadFile success"),e.setState(r.FileState.UPLOADED),e.chunkPerformed=0,e.chunkTotalNumber=0,e.chunkPerformedPercent=0,e.fileToSend=null,this.eventService.publish("ON_FILE_TRANSFER_EVENT",{result:"success",type:"upload",fileDesc:e}),this.fileStorageService.removeUploadingFileDescriptor(e),this.fileStorageService.orderDocuments(),this.fileStorageService.retrieveUserConsumption(),t(e)}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"uploadFile");throw this.logger.error("[FileServerService] "+e.message),e.error}}),(()=>{this.eventService.publish("ON_FILE_TRANSFER_EVENT",{result:"failure",type:"upload",fileDesc:e}),this.fileStorageService.removeUploadingFileDescriptor(e),this.fileStorageService.retrieveUserConsumption()}))}))}cancelCurrentFiletransfer(e){const t=this.fileStorageService.getFileDescriptorById(e);t&&(t.abortTransferController&&t.abortTransferController.abort(),t.abortXMLHttpRequestArray&&t.abortXMLHttpRequestArray.length&&t.abortXMLHttpRequestArray.map((e=>{e()})),t.fileTransferSubscription&&t.fileTransferSubscription.unsubscribe(),t.state===r.FileState.UPLOADING?t.state=r.FileState.NOT_UPLOADED:t.state===r.FileState.DOWNLOADING&&(t.state=r.FileState.UPLOADED),t.progressSubject.next({}))}async getServercapabilities(){try{await this.waitTillStarted();const e=new URL(config.restServerUrl+"/api/rainbow/fileserver/v1.0/capabilities"),t=this.authService.getRequestHeader(),i=await fetch(e.href,{method:"GET",headers:t});if(!i.ok)throw i;return this.capabilities=(await i.json()).data,this.logger.info("[FileServerService] getServercapabilities -- success -- "+this.capabilities),this.capabilities}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getServercapabilities");throw this.logger.error("[fileStorageService] "+t.message),t.error}}}t.FileServerService=g}).call(this,i(97).Buffer)},function(e,t,i){i.d(t,"a",(function(){return r}));var r=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}()},function(e,t,i){i.d(t,"b",(function(){return a})),i.d(t,"a",(function(){return d}));var r=i(0),n=i(20),s=i(23),o=i(3);function a(e,t,i){return void 0===i&&(i=Number.POSITIVE_INFINITY),"function"==typeof t?function(r){return r.pipe(a((function(i,r){return Object(s.a)(e(i,r)).pipe(Object(n.a)((function(e,n){return t(i,e,r,n)})))}),i))}:("number"==typeof t&&(i=t),function(t){return t.lift(new c(e,i))})}var c=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.project,this.concurrent))},e}(),l=function(e){function t(t,i,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var n=e.call(this,t)||this;return n.project=i,n.concurrent=r,n.hasCompleted=false,n.buffer=[],n.active=0,n.index=0,n}return r.a(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t,i=this.index++;try{t=this.project(e,i)}catch(dp){return void this.destination.error(dp)}this.active++,this._innerSub(t)},t.prototype._innerSub=function(e){var t=new o.a(this),i=this.destination;i.add(t);var r=Object(o.c)(e,t);r!==t&&i.add(r)},t.prototype._complete=function(){this.hasCompleted=true,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(o.b),d=a},function(e,t,i){i.d(t,"a",(function(){return o}));var r=i(5),n=i(124),s=i(90);function o(e,t){return t?Object(s.a)(e,t):new r.a(Object(n.a)(e))}},function(e,t,i){i.d(t,"a",(function(){return s}));var r=i(0),n=i(100),s=function(e){function t(i,r){void 0===r&&(r=n.a.now);var s=e.call(this,i,(function(){return t.delegate&&t.delegate!==s?t.delegate.now():r()}))||this;return s.actions=[],s.active=false,s.scheduled=void 0,s}return r.a(t,e),t.prototype.schedule=function(i,r,n){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(i,r,n):e.prototype.schedule.call(this,i,r,n)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var i;this.active=true;do{if(i=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=false,i){for(;e=t.shift();)e.unsubscribe();throw i}}},t}(n.a)},function(e,t,i){i.d(t,"a",(function(){return o}));var r=i(0),n=i(12),s=i(10),o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.hasNext=false,t.hasCompleted=false,t}return r.a(t,e),t.prototype._subscribe=function(t){return this.hasError?(t.error(this.thrownError),s.a.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),s.a.EMPTY):e.prototype._subscribe.call(this,t)},t.prototype.next=function(e){this.hasCompleted||(this.value=e,this.hasNext=true)},t.prototype.error=function(t){this.hasCompleted||e.prototype.error.call(this,t)},t.prototype.complete=function(){this.hasCompleted=true,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},t}(n.a)},function(e,t,i){var r=i(0),n=function(e){function t(t,i){return e.call(this)||this}return r.a(t,e),t.prototype.schedule=function(e,t){return this},t}(i(10).a);i.d(t,"a",(function(){return s}));var s=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.scheduler=t,r.work=i,r.pending=false,r}return r.a(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var i=this.id,r=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(r,i,t)),this.pending=true,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,i){return void 0===i&&(i=0),setInterval(e.flush.bind(e,this),i)},t.prototype.recycleAsyncId=function(e,t,i){if(void 0===i&&(i=0),null!==i&&this.delay===i&&false===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=false;var i=this._execute(e,t);if(i)return i;false===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var i=false,r=void 0;try{this.work(e)}catch(n){i=true,r=!!n&&n||new Error(n)}if(i)return this.unsubscribe(),r},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,i=t.actions,r=i.indexOf(this);this.work=null,this.state=null,this.pending=false,this.scheduler=null,-1!==r&&i.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(n)},function(e,t,i){i.d(t,"a",(function(){return n}));var r=i(16);function n(e){return!Object(r.a)(e)&&e-parseFloat(e)+1>=0}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.LogLevel=t.RefreshMode=t.TypeErrorType=t.ContainerFitStatus=t.ValidationEvent=t.ValidationPhase=t.ContainerStyle=t.InputTextStyle=t.ActionIconPlacement=t.FillMode=t.Orientation=t.ShowCardActionMode=t.ImageStyle=t.ActionAlignment=t.VerticalAlignment=t.HorizontalAlignment=t.TextColor=t.Spacing=t.FontType=t.TextWeight=t.TextSize=t.SizeUnit=t.ImageSize=t.Size=t.ActionMode=t.ActionStyle=void 0;var r=function(){function e(){}return e.Default="default",e.Positive="positive",e.Destructive="destructive",e}();t.ActionStyle=r;var n=function(){function e(){}return e.Primary="primary",e.Secondary="secondary",e}();t.ActionMode=n,function(e){e[e.Auto=0]="Auto",e[e.Stretch=1]="Stretch",e[e.Small=2]="Small",e[e.Medium=3]="Medium",e[e.Large=4]="Large"}(t.Size||(t.Size={})),function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Large=2]="Large"}(t.ImageSize||(t.ImageSize={})),function(e){e[e.Weight=0]="Weight",e[e.Pixel=1]="Pixel"}(t.SizeUnit||(t.SizeUnit={})),function(e){e[e.Small=0]="Small",e[e.Default=1]="Default",e[e.Medium=2]="Medium",e[e.Large=3]="Large",e[e.ExtraLarge=4]="ExtraLarge"}(t.TextSize||(t.TextSize={})),function(e){e[e.Lighter=0]="Lighter",e[e.Default=1]="Default",e[e.Bolder=2]="Bolder"}(t.TextWeight||(t.TextWeight={})),function(e){e[e.Default=0]="Default",e[e.Monospace=1]="Monospace"}(t.FontType||(t.FontType={})),function(e){e[e.None=0]="None",e[e.Small=1]="Small",e[e.Default=2]="Default",e[e.Medium=3]="Medium",e[e.Large=4]="Large",e[e.ExtraLarge=5]="ExtraLarge",e[e.Padding=6]="Padding"}(t.Spacing||(t.Spacing={})),function(e){e[e.Default=0]="Default",e[e.Dark=1]="Dark",e[e.Light=2]="Light",e[e.Accent=3]="Accent",e[e.Good=4]="Good",e[e.Warning=5]="Warning",e[e.Attention=6]="Attention"}(t.TextColor||(t.TextColor={})),function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"}(t.HorizontalAlignment||(t.HorizontalAlignment={})),function(e){e[e.Top=0]="Top",e[e.Center=1]="Center",e[e.Bottom=2]="Bottom"}(t.VerticalAlignment||(t.VerticalAlignment={})),function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right",e[e.Stretch=3]="Stretch"}(t.ActionAlignment||(t.ActionAlignment={})),function(e){e[e.Default=0]="Default",e[e.Person=1]="Person"}(t.ImageStyle||(t.ImageStyle={})),function(e){e[e.Inline=0]="Inline",e[e.Popup=1]="Popup"}(t.ShowCardActionMode||(t.ShowCardActionMode={})),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical"}(t.Orientation||(t.Orientation={})),function(e){e[e.Cover=0]="Cover",e[e.RepeatHorizontally=1]="RepeatHorizontally",e[e.RepeatVertically=2]="RepeatVertically",e[e.Repeat=3]="Repeat"}(t.FillMode||(t.FillMode={})),function(e){e[e.LeftOfTitle=0]="LeftOfTitle",e[e.AboveTitle=1]="AboveTitle"}(t.ActionIconPlacement||(t.ActionIconPlacement={})),function(e){e[e.Text=0]="Text",e[e.Tel=1]="Tel",e[e.Url=2]="Url",e[e.Email=3]="Email",e[e.Password=4]="Password"}(t.InputTextStyle||(t.InputTextStyle={}));var s=function(){function e(){}return e.Default="default",e.Emphasis="emphasis",e.Accent="accent",e.Good="good",e.Attention="attention",e.Warning="warning",e}();t.ContainerStyle=s,function(e){e[e.Parse=0]="Parse",e[e.ToJSON=1]="ToJSON",e[e.Validation=2]="Validation"}(t.ValidationPhase||(t.ValidationPhase={})),function(e){e[e.Hint=0]="Hint",e[e.ActionTypeNotAllowed=1]="ActionTypeNotAllowed",e[e.CollectionCantBeEmpty=2]="CollectionCantBeEmpty",e[e.Deprecated=3]="Deprecated",e[e.ElementTypeNotAllowed=4]="ElementTypeNotAllowed",e[e.InteractivityNotAllowed=5]="InteractivityNotAllowed",e[e.InvalidPropertyValue=6]="InvalidPropertyValue",e[e.MissingCardType=7]="MissingCardType",e[e.PropertyCantBeNull=8]="PropertyCantBeNull",e[e.TooManyActions=9]="TooManyActions",e[e.UnknownActionType=10]="UnknownActionType",e[e.UnknownElementType=11]="UnknownElementType",e[e.UnsupportedCardVersion=12]="UnsupportedCardVersion",e[e.DuplicateId=13]="DuplicateId",e[e.UnsupportedProperty=14]="UnsupportedProperty",e[e.RequiredInputsShouldHaveLabel=15]="RequiredInputsShouldHaveLabel",e[e.RequiredInputsShouldHaveErrorMessage=16]="RequiredInputsShouldHaveErrorMessage",e[e.Other=17]="Other"}(t.ValidationEvent||(t.ValidationEvent={})),function(e){e[e.FullyInContainer=0]="FullyInContainer",e[e.Overflowing=1]="Overflowing",e[e.FullyOutOfContainer=2]="FullyOutOfContainer"}(t.ContainerFitStatus||(t.ContainerFitStatus={})),function(e){e[e.UnknownType=0]="UnknownType",e[e.ForbiddenType=1]="ForbiddenType"}(t.TypeErrorType||(t.TypeErrorType={})),function(e){e[e.Disabled=0]="Disabled",e[e.Manual=1]="Manual",e[e.Automatic=2]="Automatic"}(t.RefreshMode||(t.RefreshMode={})),function(e){e[e.Info=0]="Info",e[e.Warning=1]="Warning",e[e.Error=2]="Error"}(t.LogLevel||(t.LogLevel={}))},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7),n=i(18),s=i(4),o=i(43),a=i(19),c=i(9);class l{constructor(e=null,t=null,i=null,r=null,n=null,s=null,o=null,a=null,c=null,l=null){this.setSetSinkIdForAudioElement=e,this.getCurrentAudioInputDevice=t,this.getCurrentAudioOutputDevice=i,this.getCurrentVideoInputDevice=r,this.setCurrentVideoInputDevice=n,this.setCurrentAudioOutputDevice=s,this.setCurrentAudioInputDevice=o,this.getAllVideoInputDevices=a,this.getAllAudioInputDevices=c,this.getAllAudioOutputDevices=l}}class d{constructor(){this._sdkApis=Object.keys(new l),this.RAINBOW_ONAUDIOVIDEODEVICEACCESSERROR="rainbowonaudiovideodeviceaccesserror",this.RAINBOW_ONAUDIOVIDEODEVICELISTUPDATE="rainbowonaudiovideodevicelistupdate",this.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED="rainbowonnewaudiovideodeviceselected",this.RAINBOW_ONNEWSECONDARYOUTPUTDEVICESELECTED="rainbowonnewsecondaryoutputdeviceselected",this.logger=s.LoggerService.getInstance(),this.webrtcConfigAndUtils=o.WebrtcConfigAndUtils.getInstance(),this.settingsService=a.SettingsService.getInstance(),this.xmppService=c.XmppService.getInstance(),this.rxSubject=new r.Subject,this.deviceWatcher=null,this.audioInputDevices=[],this.audioOutputDevices=[],this.videoInputDevices=[],this.currentAudioInputDevice=null,this.currentAudioOutputDevice=null,this.currentVideoInputDevice=null,this.currentSecondaryOutputDevice=null,this.getUserMediaForAudioDone=false,this.getUserMediaForVideoDone=false,this.started=false,this.devicesToIgnore=["display","screen","amd ","monitor","cran","lenovo usb audio","(hdmi)"," dac("],this.inputDevicesToAcceptEvenWhenNotDefault=["plantronics","jabra","konftel","sennheiser"]}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.deviceManagementService||(e.rainbow.deviceManagementService=new d),e.rainbow.deviceManagementService}async start(){this.started||(this.checkDeviceList(),this.xmppConnectionSubscription=this.xmppService.subscribeToConnectionEvents((e=>{try{"ON_XMPP_CONNECTED"===e.name&&"RECONNECTION"===e.data.reason&&(this.logger.info("[DeviceManagementService] XMPP Connection state event : RECONNECTION"),this.setGlobalTagSinkId(true))}catch{}})),this.started=true)}async stop(){this.deviceWatcher&&(this.deviceWatcher=null),this.xmppConnectionSubscription&&(this.xmppConnectionSubscription.unsubscribe(),this.xmppConnectionSubscription=null),navigator.mediaDevices&&navigator.mediaDevices.ondevicechange&&(navigator.mediaDevices.ondevicechange=null),this.started=false}subscribe(e){return this.rxSubject.subscribe(e)}sendEvent(e,t=null){this.rxSubject.next(n.RBEvent.create(e,t))}arrayContains(e,t){return e.some((function(e){return t.indexOf(e)>-1}))}getHashFromLabel(e){const t=e.lastIndexOf("("),i=e.lastIndexOf(")");let r="";return t&&i&&(r=e.substring(t+1,i),-1===r.indexOf(":")&&(r="")),r}compareHashInLabel(e,t){const i=this.getHashFromLabel(e),r=this.getHashFromLabel(t);return i&&r&&i===r}async setSetSinkIdForAudioElement(e,t){if(!e)throw new Error("[DeviceManagementService] setSetSinkIdForAudioElement -- no HTML Audio Element received !");if(e.setSinkId)if(t){if(e.sinkId!==t.deviceId)try{this.logger.debug("[DeviceManagementService] -- setSetSinkIdForAudioElement to new device -- "+t.deviceId),await e.setSinkId(t.deviceId),e.load&&e.load()}catch(i){return void this.logger.error("[DeviceManagementService] -- setSetSinkIdForAudioElement error -- "+i)}}else this.logger.debug("[DeviceManagementService] setSetSinkIdForAudioElement -- no output device or setSinkId does not exist !")}getCurrentAudioInputDevice(){return this.currentAudioInputDevice}setCurrentAudioInputDevice(e){if(!e||"audioinput"!==e.kind)throw new Error("[DeviceManagementService] setCurrentAudioInputDevice -- wrong parameter !");this.currentAudioInputDevice=e,this.logger.debug(`[DeviceManagementService] API setCurrentAudioInputDevice ${this.currentAudioInputDevice.deviceId} -- ${this.currentAudioInputDevice.label}`),this.settingsService.setSetting("handFreeInputDeviceName",this.currentAudioInputDevice.label),this.sendEvent(this.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED,{kind:e.kind})}getAllAudioInputDevices(){return this.audioInputDevices}getCurrentAudioOutputDevice(){return this.currentAudioOutputDevice}setCurrentAudioOutputDevice(e){if(!e||"audiooutput"!==e.kind)throw new Error("[DeviceManagementService] setCurrentAudioOutputDevice -- wrong parameter !");this.currentAudioOutputDevice=e,this.settingsService.setSetting("handFreeOutputDeviceName",this.currentAudioOutputDevice.label),this.logger.debug(`[DeviceManagementService] API setCurrentAudioOutputDevice ${this.currentAudioOutputDevice.deviceId} -- ${this.currentAudioOutputDevice.label}`),this.setGlobalTagSinkId(),this.sendEvent(this.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED,{kind:e.kind})}getAllAudioOutputDevices(){return this.audioOutputDevices}getCurrentVideoInputDevice(){return this.currentVideoInputDevice}setCurrentVideoInputDevice(e){if(!e||"videoinput"!==e.kind)throw new Error("[DeviceManagementService] setCurrentVideoInputDevice -- wrong parameter !");this.currentVideoInputDevice=e,this.logger.debug(`[DeviceManagementService] API setCurrentVideoInputDevice ${this.currentVideoInputDevice.deviceId} -- ${this.currentVideoInputDevice.label}`),this.settingsService.setSetting("cameraUsed",this.currentVideoInputDevice.label),this.sendEvent(this.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED,{kind:e.kind})}getAllVideoInputDevices(){return this.videoInputDevices}getCurrentSecondaryOutputDevice(){return this.currentSecondaryOutputDevice}setCurrentSecondaryOutputDevice(e){if(!e||"audiooutput"!==e.kind)throw new Error("[DeviceManagementService] setCurrentSecondaryOutputDevice -- wrong parameter !");this.currentSecondaryOutputDevice=e,this.logger.debug(`[DeviceManagementService] API setCurrentSecondaryOutputDevice ${this.currentSecondaryOutputDevice.deviceId} -- ${this.currentSecondaryOutputDevice.label}`),this.settingsService.setSetting("ringingSpeaker",this.currentSecondaryOutputDevice.label),this.sendEvent(this.RAINBOW_ONNEWSECONDARYOUTPUTDEVICESELECTED)}startDeviceWatcher(){navigator&&navigator.mediaDevices&&!navigator.mediaDevices.ondevicechange&&(navigator.mediaDevices.ondevicechange=e=>{this.logger.info("[DeviceManagementService] ondevicechange detected "+JSON.stringify(e)),this.deviceWatcher||(this.deviceWatcher=setTimeout((()=>{this.checkDeviceList(),this.deviceWatcher=null}),500))})}async checkDeviceList(){let e=null;if(window.adapter&&"firefox"===window.adapter.default.browserDetails.browser&&(this.getUserMediaForVideoDone||this.getUserMediaForAudioDone))try{e=await navigator.mediaDevices.getUserMedia({audio:true,video:false})}catch{}const t=await navigator.mediaDevices.enumerateDevices();this.logger.info("[DeviceManagementService] devices brut list "+JSON.stringify(t));const i=[],r=[],n=[];t.forEach((e=>{e.deviceId&&e.label&&("audioinput"!==e.kind&&"audiooutput"!==e.kind||(this.getUserMediaForAudioDone=true),"videoinput"===e.kind&&(this.getUserMediaForVideoDone=true)),"audioinput"===e.kind&&i.push(e),"audiooutput"===e.kind&&r.push(e),"videoinput"===e.kind&&n.push(e)})),this.getUserMediaForAudioDone||this.getUserMediaForVideoDone||!i.length||!n.length?this.getUserMediaForAudioDone||!i.length?this.getUserMediaForVideoDone||!n.length?(this.startDeviceWatcher(),this.updateCurrentAudioInputDevices(i),this.updateCurrentAudioOutputDevices(r),this.updateCurrentVideoInputDevices(n),e&&this.webrtcConfigAndUtils.disableMediaStream(e)):this.testGetUserMedia([],n):this.testGetUserMedia(i,[]):this.testGetUserMedia(i,n)}async testGetUserMedia(e,t){let i=true,r=true;e.length||(this.logger.info("[DeviceManagementService] testGetUserMedia -- ignore audio test... "),i=false),t.length||(this.logger.info("[DeviceManagementService] testGetUserMedia -- inore video test... "),r=false),this.logger.info(`[DeviceManagementService] testGetUserMedia for audio ${i} and video ${r}`);try{const e=await navigator.mediaDevices.getUserMedia({audio:i,video:r});this.webrtcConfigAndUtils.disableMediaStream(e)}catch(n){this.logger.warn("[DeviceManagementService] testGetUserMedia -- default devices does not work -- "+n),(n&&n.indexOf&&-1!==n.indexOf("NotAllowedError")||n&&n.toString&&-1!==n.toString().indexOf("NotAllowedError"))&&this.sendEvent(this.RAINBOW_ONAUDIOVIDEODEVICEACCESSERROR)}this.getUserMediaForVideoDone=r,this.getUserMediaForAudioDone=i,this.logger.info(`[DeviceManagementService] testGetUserMedia results after test: for audio ${this.getUserMediaForAudioDone} and video ${this.getUserMediaForVideoDone} -- success`),this.checkDeviceList()}isDeviceSelectedByDefaultByOS(e,t){let i=false,r=false;return t.forEach((t=>{"default"!==t.deviceId&&"communications"!==t.deviceId||(r=true,e.groupId===t.groupId&&e.label&&t.label&&-1!==t.label.indexOf(e.label)&&(i=true))})),!r||i}updateCurrentAudioInputDevice(e){let t=null;e.forEach((e=>{"default"===e.deviceId&&(t=e,this.currentAudioInputDevice||(this.currentAudioInputDevice=t)),"communications"===e.deviceId&&this.currentAudioInputDevice&&"default"===this.currentAudioInputDevice.deviceId&&(this.currentAudioInputDevice=e),this.currentAudioInputDevice&&this.currentAudioInputDevice.groupId===e.groupId&&("default"!==this.currentAudioInputDevice.deviceId&&"communications"!==this.currentAudioInputDevice.deviceId?-1===e.label.toLowerCase().indexOf("stereo")&&(this.currentAudioInputDevice=e):this.currentAudioInputDevice=e)})),this.currentAudioInputDevice||(this.currentAudioInputDevice=e[0])}updateCurrentAudioInputDevices(e=[]){if(this.audioInputDevices.length!==e.length&&this.logger.info(`[DeviceManagementService] updateCurrentAudioInputDevices -- current length: ${this.audioInputDevices.length} -- new length: ${e.length}`),this.audioInputDevices.length||e.length){if(!this.audioInputDevices.length&&e.length){this.audioInputDevices=e,this.currentAudioInputDevice=null;const t=this.settingsService.getSetting("handFreeInputDeviceName");t&&this.audioInputDevices.forEach((e=>{e.label===t&&(this.currentAudioInputDevice=e,this.logger.info("[DeviceManagementService] currentAudioInputDevice has changed (start-up) from settings -- "+t))})),this.currentAudioInputDevice||this.updateCurrentAudioInputDevice(this.audioInputDevices),this.currentAudioInputDevice?this.logger.info("[DeviceManagementService] currentAudioInputDevice has changed (start-up) "+this.currentAudioInputDevice.deviceId+" -- "+this.currentAudioInputDevice.label):this.logger.info("[DeviceManagementService] currentAudioInputDevice has changed (start-up) is now null"),this.sendEvent(this.RAINBOW_ONAUDIOVIDEODEVICELISTUPDATE,{kind:"audioinput",action:"added"}),this.sendEvent(this.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED,{kind:"audioinput"})}else if(this.audioInputDevices.length&&!e.length)this.audioInputDevices=[],this.currentAudioInputDevice=null,this.logger.info("[DeviceManagementService] currentAudioInputDevice is now null"),this.sendEvent(this.RAINBOW_ONAUDIOVIDEODEVICELISTUPDATE,{kind:"audioinput",action:"removed"}),this.sendEvent(this.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED,{kind:"audioinput"});else if(this.audioInputDevices.length===e.length){let t=false,i=false,r=false;this.audioInputDevices.forEach((r=>{const n=e.find((e=>r.deviceId===e.deviceId));n||(i=true),n||r.deviceId!==this.currentAudioInputDevice.deviceId||(t=true)})),this.audioInputDevices.forEach((t=>{if("default"===t.deviceId||"communications"===t.deviceId){const n=e.find((e=>t.deviceId===e.deviceId));n&&n.label!==t.label&&(i=true,this.currentAudioInputDevice&&n.deviceId===this.currentAudioInputDevice.deviceId&&(r=true))}})),this.audioInputDevices=e,this.currentAudioInputDevice&&this.audioInputDevices.forEach((e=>{e.deviceId===this.currentAudioInputDevice.deviceId&&(this.currentAudioInputDevice=e)})),i&&(this.logger.info("[DeviceManagementService] currentAudioInputDeviceListChanged has changed"),this.sendEvent(this.RAINBOW_ONAUDIOVIDEODEVICELISTUPDATE,{kind:"audioinput",action:"updated"})),r&&!t&&(this.logger.info("[DeviceManagementService] currentAudioInputDevice has changed (id change) "+this.currentAudioInputDevice.deviceId+" -- "+this.currentAudioInputDevice.label),this.sendEvent(this.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED,{kind:"audioinput"})),t&&(this.currentAudioInputDevice=null,this.updateCurrentAudioInputDevice(this.audioInputDevices),this.logger.info("[DeviceManagementService] currentAudioInputDevice has changed (id change) "+this.currentAudioInputDevice.deviceId+" -- "+this.currentAudioInputDevice.label),this.sendEvent(this.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED,{kind:"audioinput"}))}else if(this.audioInputDevices.length>e.length){let t=false,i=false;this.audioInputDevices.forEach((r=>{const n=e.find((e=>r.deviceId===e.deviceId));n||r.deviceId!==this.currentAudioInputDevice.deviceId?n&&r.deviceId===this.currentAudioInputDevice.deviceId&&n.label!==this.currentAudioInputDevice.label&&(i=true):t=true})),this.audioInputDevices=e,this.currentAudioInputDevice&&this.audioInputDevices.forEach((e=>{e.deviceId===this.currentAudioInputDevice.deviceId&&(this.currentAudioInputDevice=e)})),this.sendEvent(this.RAINBOW_ONAUDIOVIDEODEVICELISTUPDATE,{kind:"audioinput",action:"removed"}),i&&!t?(this.currentAudioInputDevice&&this.logger.info("[DeviceManagementService] currentAudioInputDevice has changed (after current device disconnected) "+this.currentAudioInputDevice.deviceId+" -- "+this.currentAudioInputDevice.label),this.sendEvent(this.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED,{kind:"audioinput",plugOut:true})):t&&(this.currentAudioInputDevice=null,this.updateCurrentAudioInputDevice(this.audioInputDevices),this.currentAudioInputDevice?this.logger.info("[DeviceManagementService] currentAudioInputDevice has changed (after current device disconnected) "+this.currentAudioInputDevice.deviceId+" -- "+this.currentAudioInputDevice.label):this.logger.info("[DeviceManagementService] currentAudioInputDevice has changed (after current device disconnected) is now null"),this.sendEvent(this.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED,{kind:"audioinput",plugOut:true}))}else if(this.audioInputDevices.length<e.length){let t=false;e.forEach((i=>{if(!this.audioInputDevices.find((e=>i.deviceId===e.deviceId))&&i.deviceId!==this.currentAudioInputDevice.deviceId){const r=i.label?i.label.toLowerCase():"";(this.isDeviceSelectedByDefaultByOS(i,e)||this.arrayContains(this.inputDevicesToAcceptEvenWhenNotDefault,r))&&r&&-1===r.indexOf("webcam")&&-1===r.indexOf("camera")&&-1===r.indexOf("konftel cam")&&(this.currentAudioInputDevice=i,t=true)}})),this.audioInputDevices=e,this.currentAudioInputDevice&&this.audioInputDevices.forEach((e=>{e.deviceId===this.currentAudioInputDevice.deviceId&&(this.currentAudioInputDevice=e)})),this.sendEvent(this.RAINBOW_ONAUDIOVIDEODEVICELISTUPDATE,{kind:"audioinput",action:"added"}),t&&(this.logger.info("[DeviceManagementService] currentAudioInputDevice has changed (new device connected) "+this.currentAudioInputDevice.deviceId+" -- "+this.currentAudioInputDevice.label),this.settingsService.setSetting("handFreeInputDeviceName",this.currentAudioInputDevice.label),this.sendEvent(this.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED,{kind:"audioinput",plugIn:true}))}}else this.logger.info("[DeviceManagementService] checkDeviceList -- no audio input device detected !")}updateCurrentAudioOutputDevice(e){let t=null;this.currentAudioInputDevice&&this.currentAudioInputDevice.label&&e.forEach((e=>{const t=this.currentAudioInputDevice.groupId===e.groupId,i=this.currentAudioInputDevice.label===e.label||this.compareHashInLabel(this.currentAudioInputDevice.label,e.label);(t||i)&&(this.currentAudioOutputDevice=e)})),this.currentAudioOutputDevice||e.forEach((e=>{"default"===e.deviceId&&(t=e,this.currentAudioOutputDevice||(this.currentAudioOutputDevice=t)),"communications"===e.deviceId&&this.currentAudioOutputDevice&&"default"===this.currentAudioOutputDevice.deviceId&&(this.currentAudioOutputDevice=e),this.currentAudioOutputDevice&&this.currentAudioOutputDevice.groupId===e.groupId&&(this.currentAudioOutputDevice=e)})),this.currentAudioOutputDevice||(this.currentAudioOutputDevice=e[0]),this.currentAudioOutputDevice&&this.setGlobalTagSinkId()}async setGlobalTagSinkId(e=false){const t=this.currentAudioOutputDevice,i=document.getElementById("globalAudioTag");if(i)if(t&&i.setSinkId){if(!e&&i.sinkId===t.deviceId)return this.logger.debug("[DeviceManagementService] setGlobalTagSinkId -- Already using the same device id"),void(i.load&&i.load());try{this.logger.debug("[DeviceManagementService] -- setGlobalTagSinkId to new device -- "+t.deviceId),i.srcObject&&!i.srcObject.active&&this.webrtcConfigAndUtils.RTC.clearMediaStream([document.getElementById("globalAudioTag")]),await i.setSinkId(t.deviceId),i.load&&i.load()}catch(r){this.logger.error("[DeviceManagementService] -- setGlobalTagSinkId error -- "+r);let e=this.audioOutputDevices.find((e=>"default"!==e.deviceId&&"communications"!==e.deviceId&&e.deviceId!==t.deviceId));e||(e=this.audioOutputDevices[0]),this.logger.debug("[DeviceManagementService] setGlobalTagSinkId -- Try to set another device "+e.deviceId),await i.setSinkId(e.deviceId),this.logger.debug("[DeviceManagementService] setGlobalTagSinkId -- Try to set to the selected device "+t.deviceId),await i.setSinkId(t.deviceId),i.load&&i.load()}}else this.logger.warn("[DeviceManagementService] setGlobalTagSinkId -- no output device or setSinkId does not exist !");else this.logger.debug("[DeviceManagementService] setGlobalTagSinkId -- globalAudioTag is missing")}updateCurrentAudioOutputDevices(e=[]){if(this.audioOutputDevices.length!==e.length&&this.logger.info(`[DeviceManagementService] updateCurrentAudioOutputDevices -- current length: ${this.audioOutputDevices.length} -- new length: ${e.length}`),this.audioOutputDevices.length||e.length){if(!this.audioOutputDevices.length&&e.length){this.audioOutputDevices=e,this.currentAudioOutputDevice=null;const t=this.settingsService.getSetting("handFreeOutputDeviceName");t&&this.audioOutputDevices.forEach((e=>{e.label===t&&(this.currentAudioOutputDevice=e,this.setGlobalTagSinkId(),this.logger.info("[DeviceManagementService] currentAudioOutputDevice has changed (start-up) from settings -- "+t))})),this.currentAudioOutputDevice||this.updateCurrentAudioOutputDevice(this.audioOutputDevices),this.currentAudioOutputDevice?this.logger.info("[DeviceManagementService] currentAudioOutputDevice has changed (start-up) "+this.currentAudioOutputDevice.deviceId+" -- "+this.currentAudioOutputDevice.label):this.logger.info("[DeviceManagementService] currentAudioOutputDevice has changed (start-up) is now null"),this.sendEvent(this.RAINBOW_ONAUDIOVIDEODEVICELISTUPDATE,{kind:"audiooutput",action:"added"}),this.sendEvent(this.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED,{kind:"audiooutput"});const i=this.settingsService.getSetting("ringingSpeaker");i&&this.audioOutputDevices.forEach((e=>{e.label===i&&(this.currentSecondaryOutputDevice=e,this.logger.info("[DeviceManagementService] currentSecondaryOutputDevice has changed (start-up) from settings "+e.label))})),this.currentSecondaryOutputDevice||(this.currentSecondaryOutputDevice=this.audioOutputDevices[0]),this.sendEvent(this.RAINBOW_ONNEWSECONDARYOUTPUTDEVICESELECTED)}else if(this.audioOutputDevices.length&&!e.length)this.audioOutputDevices=[],this.currentAudioOutputDevice=null,this.currentSecondaryOutputDevice=null,this.logger.info("[DeviceManagementService] currentAudioOutputDevice is now null"),this.sendEvent(this.RAINBOW_ONAUDIOVIDEODEVICELISTUPDATE,{kind:"audiooutput",action:"removed"}),this.sendEvent(this.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED,{kind:"audiooutput"}),this.sendEvent(this.RAINBOW_ONNEWSECONDARYOUTPUTDEVICESELECTED);else if(this.audioOutputDevices.length===e.length){let t=false,i=false,r=false,n=false;this.audioOutputDevices.forEach((r=>{const n=e.find((e=>r.deviceId===e.deviceId));n||(i=true),n||r.deviceId!==this.currentAudioOutputDevice.deviceId||(t=true)})),this.audioOutputDevices.forEach((t=>{if("default"===t.deviceId||"communications"===t.deviceId){const s=e.find((e=>t.deviceId===e.deviceId));s&&s.label!==t.label&&(i=true,this.currentAudioOutputDevice&&s.deviceId===this.currentAudioOutputDevice.deviceId&&(r=true),this.currentSecondaryOutputDevice&&s.deviceId===this.currentSecondaryOutputDevice.deviceId&&(n=true))}})),this.audioOutputDevices=e,this.currentAudioOutputDevice&&this.audioOutputDevices.forEach((e=>{e.deviceId===this.currentAudioOutputDevice.deviceId&&(this.currentAudioOutputDevice=e),this.currentSecondaryOutputDevice&&e.deviceId===this.currentSecondaryOutputDevice.deviceId&&(this.currentSecondaryOutputDevice=e)})),i&&(this.logger.info("[DeviceManagementService] currentAudioOutputDeviceListChanged has changed"),this.sendEvent(this.RAINBOW_ONAUDIOVIDEODEVICELISTUPDATE,{kind:"audiooutput",action:"updated"})),r&&!t&&(this.logger.info("[DeviceManagementService] currentAudioOutputDevice has changed (id change) "+this.currentAudioOutputDevice.deviceId+" -- "+this.currentAudioOutputDevice.label),this.sendEvent(this.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED,{kind:"audiooutput"})),n&&(this.logger.info("[DeviceManagementService] currentSecondaryAudioOutputDeviceChanged has changed (id change) "+this.currentSecondaryOutputDevice.deviceId+" -- "+this.currentSecondaryOutputDevice.label),this.sendEvent(this.RAINBOW_ONNEWSECONDARYOUTPUTDEVICESELECTED)),t&&(this.currentAudioOutputDevice=null,this.updateCurrentAudioOutputDevice(this.audioOutputDevices),this.currentAudioOutputDevice?this.logger.info("[DeviceManagementService] currentAudioOutputDevice has changed (id change) "+this.currentAudioOutputDevice.deviceId+" -- "+this.currentAudioOutputDevice.label):this.logger.info("[DeviceManagementService] currentAudioOutputDevice has changed (id change) is now null"),this.sendEvent(this.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED,{kind:"audiooutput"}))}else if(this.audioOutputDevices.length>e.length){let t=false,i=false,r=false;this.audioOutputDevices.forEach((r=>{const n=e.find((e=>r.deviceId===e.deviceId));n||r.deviceId!==this.currentAudioOutputDevice.deviceId?n&&r.deviceId===this.currentAudioOutputDevice.deviceId&&n.label!==this.currentAudioOutputDevice.label&&(i=true):t=true}));let n=false;this.currentSecondaryOutputDevice&&this.audioOutputDevices.forEach((t=>{const i=e.find((e=>t.deviceId===e.deviceId));i||t.deviceId!==this.currentSecondaryOutputDevice.deviceId?i&&t.deviceId===this.currentSecondaryOutputDevice.deviceId&&i.label!==this.currentSecondaryOutputDevice.label&&(r=true):n=true})),this.audioOutputDevices=e,this.currentAudioOutputDevice&&this.audioOutputDevices.forEach((e=>{e.deviceId===this.currentAudioOutputDevice.deviceId&&(this.currentAudioOutputDevice=e),this.currentSecondaryOutputDevice&&e.deviceId===this.currentSecondaryOutputDevice.deviceId&&(this.currentSecondaryOutputDevice=e)})),this.sendEvent(this.RAINBOW_ONAUDIOVIDEODEVICELISTUPDATE,{kind:"audiooutput",action:"removed"}),i&&!t?(this.currentAudioOutputDevice&&this.logger.info("[DeviceManagementService] currentAudioOutputDevice has changed (after current device disconnected) "+this.currentAudioOutputDevice.deviceId+" -- "+this.currentAudioOutputDevice.label),this.sendEvent(this.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED,{kind:"audiooutput",plugOut:true})):t&&(this.currentAudioOutputDevice=null,this.updateCurrentAudioOutputDevice(this.audioOutputDevices),this.currentAudioOutputDevice?this.logger.info("[DeviceManagementService] currentAudioOutputDevice has changed (after current device disconnected) "+this.currentAudioOutputDevice.deviceId+" -- "+this.currentAudioOutputDevice.label):this.logger.info("[DeviceManagementService] currentAudioOutputDevice has changed (after current device disconnected) is now null"),this.sendEvent(this.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED,{kind:"audiooutput",plugOut:true})),r&&!n?this.sendEvent(this.RAINBOW_ONNEWSECONDARYOUTPUTDEVICESELECTED):n&&(this.currentSecondaryOutputDevice=this.audioOutputDevices[0],this.sendEvent(this.RAINBOW_ONNEWSECONDARYOUTPUTDEVICESELECTED))}else if(this.audioOutputDevices.length<e.length){let t=false;e.forEach((i=>{if(!this.audioOutputDevices.find((e=>i.deviceId===e.deviceId))&&i.deviceId!==this.currentAudioOutputDevice.deviceId){const r=this.audioInputDevices.find((e=>e.groupId===i.groupId)),n=this.audioInputDevices.find((e=>e.label&&i.label&&(e.label===i.label||this.compareHashInLabel(e.label,i.label)))),s=i.label?i.label.toLowerCase():"";r||n?(this.currentAudioInputDevice.groupId===i.groupId||this.currentAudioInputDevice.label&&(this.currentAudioInputDevice.label===i.label||this.compareHashInLabel(this.currentAudioInputDevice.label,i.label)))&&(this.currentAudioOutputDevice=i,t=true):this.isDeviceSelectedByDefaultByOS(i,e)&&!this.arrayContains(this.devicesToIgnore,s)&&(-1!==s.indexOf("stereo")&&this.currentAudioInputDevice&&this.currentAudioInputDevice.label&&-1!==this.currentAudioInputDevice.label.toLowerCase().indexOf("ag audio")||(this.currentAudioOutputDevice=i,t=true))}}));let i=false;this.currentSecondaryOutputDevice&&this.audioOutputDevices.forEach((t=>{const r=e.find((e=>t.deviceId===e.deviceId));r&&t.deviceId===this.currentSecondaryOutputDevice.deviceId&&r.label!==this.currentSecondaryOutputDevice.label&&(i=true)})),this.audioOutputDevices=e,this.currentAudioOutputDevice&&this.audioOutputDevices.forEach((e=>{e.deviceId===this.currentAudioOutputDevice.deviceId&&(this.currentAudioOutputDevice=e),this.currentSecondaryOutputDevice&&e.deviceId===this.currentSecondaryOutputDevice.deviceId&&(this.currentSecondaryOutputDevice=e)})),this.sendEvent(this.RAINBOW_ONAUDIOVIDEODEVICELISTUPDATE,{kind:"audiooutput",action:"added"}),t&&(this.logger.info("[DeviceManagementService] currentAudioOutputDevice has changed (new device connected) "+this.currentAudioOutputDevice.deviceId+" -- "+this.currentAudioOutputDevice.label),this.settingsService.setSetting("handFreeOutputDeviceName",this.currentAudioOutputDevice.label),this.setGlobalTagSinkId(),this.sendEvent(this.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED,{kind:"audiooutput",plugIn:true})),i&&this.sendEvent(this.RAINBOW_ONNEWSECONDARYOUTPUTDEVICESELECTED)}}else this.logger.info("[DeviceManagementService] checkDeviceList -- no audio output device detected !")}updateCurrentVideoInputDevice(e){let t=null;e.forEach((e=>{"default"===e.deviceId&&(t=e,this.currentVideoInputDevice||(this.currentVideoInputDevice=t)),this.currentVideoInputDevice&&this.currentVideoInputDevice.groupId===e.groupId&&(this.currentVideoInputDevice=e)})),this.currentVideoInputDevice||(this.currentVideoInputDevice=e[0])}updateCurrentVideoInputDevices(e=[]){if(this.videoInputDevices.length||e.length){if(this.videoInputDevices.length!==e.length&&this.logger.info(`[DeviceManagementService] updateCurrentVideoInputDevices -- current length: ${this.videoInputDevices.length} -- new length: ${e.length}`),!this.videoInputDevices.length&&e.length){if(this.videoInputDevices=e,this.currentVideoInputDevice=null,!this.currentVideoInputDevice){const e=this.settingsService.getSetting("cameraUsed");e&&this.videoInputDevices.forEach((t=>{t.label===e&&(this.currentVideoInputDevice=t,this.logger.info("[DeviceManagementService] currentVideoInputDevice has changed from settings"))}))}this.currentVideoInputDevice||this.updateCurrentVideoInputDevice(e),this.currentVideoInputDevice?this.logger.info("[DeviceManagementService] new currentVideoInputDevice (start-up) "+this.currentVideoInputDevice.deviceId+" -- "+this.currentVideoInputDevice.label):this.logger.info("[DeviceManagementService] new currentVideoInputDevice (start-up) is null"),this.sendEvent(this.RAINBOW_ONAUDIOVIDEODEVICELISTUPDATE,{kind:"videoinput",action:"added"}),this.sendEvent(this.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED,{kind:"videoinput"})}else if(this.videoInputDevices.length&&!e.length)this.videoInputDevices=[],this.currentVideoInputDevice=null,this.logger.info("[DeviceManagementService] currentVideoInputDevice is now null"),this.sendEvent(this.RAINBOW_ONAUDIOVIDEODEVICELISTUPDATE,{kind:"videoinput",action:"removed"}),this.sendEvent(this.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED,{kind:"videoinput"});else if(this.videoInputDevices.length>e.length){let t=false;this.videoInputDevices.forEach((i=>{e.find((e=>i.deviceId===e.deviceId))||i.deviceId!==this.currentVideoInputDevice.deviceId||(t=true)})),this.videoInputDevices=e,!t&&this.currentVideoInputDevice&&this.videoInputDevices.forEach((e=>{e.deviceId===this.currentVideoInputDevice.deviceId&&(this.currentVideoInputDevice=e)})),this.sendEvent(this.RAINBOW_ONAUDIOVIDEODEVICELISTUPDATE,{kind:"videoinput",action:"removed"}),t&&(this.currentVideoInputDevice=null,this.updateCurrentVideoInputDevice(e),this.currentVideoInputDevice?this.logger.info("[DeviceManagementService] new currentVideoInputDevice has changed (after current device disconnected) "+this.currentVideoInputDevice.deviceId+" -- "+this.currentVideoInputDevice.label):this.logger.info("[DeviceManagementService] new currentVideoInputDevice has changed (after current device disconnected) is null"),this.sendEvent(this.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED,{kind:"videoinput"}))}else if(this.videoInputDevices.length<e.length){let t=false;e.forEach((e=>{this.videoInputDevices.find((t=>e.deviceId===t.deviceId))||e.deviceId===this.currentVideoInputDevice.deviceId||e.label&&-1===e.label.toLowerCase().indexOf("facetime")&&-1===e.label.toLowerCase().indexOf("virtual")&&(this.currentVideoInputDevice=e,t=true)})),this.videoInputDevices=e,!t&&this.currentVideoInputDevice&&this.videoInputDevices.forEach((e=>{e.deviceId===this.currentVideoInputDevice.deviceId&&(this.currentVideoInputDevice=e)})),this.sendEvent(this.RAINBOW_ONAUDIOVIDEODEVICELISTUPDATE,{kind:"videoinput",action:"added"}),t&&(this.logger.info("[DeviceManagementService] currentVideoInputDevice has changed (new device connected) "+this.currentVideoInputDevice.deviceId+" -- "+this.currentVideoInputDevice.label),this.settingsService.setSetting("cameraUsed",this.currentVideoInputDevice.label),this.sendEvent(this.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED,{kind:"videoinput",plugIn:true}))}}else this.logger.info("[DeviceManagementService] checkDeviceList -- no video input device detected !")}}t.DeviceManagementService=d},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7),n=i(28),s=i(19),o=i(4),a=i(8),c=i(9),l=i(17),d=i(14),u=i(65),h=i(6),f=i(34),p=i(13),g=i(11),m=i(426),v=i(428),S=i(448);class b{constructor(){this.calls={},this.pendingMakeCalls=[],this.agentStatus={},this.currentPgiObject={},this.starting=false,this.started=false,this.isOxo=false,this.isOxe=false,this.isThirdParty=false,this.forwardObject={},this.nomadicObject={},this.listeners=[],this.subscriptions=[],this.CALLSERVICE_NS="urn:xmpp:pbxagent:callservice:1",this.sipWise=false,this.rxSubject=new r.Subject,this.settingsService=s.SettingsService.getInstance(),this.xmppService=c.XmppService.getInstance(),this.logger=o.LoggerService.getInstance(),this.authService=a.AuthService.getInstance(),this.profileService=d.ProfileService.getInstance(),this.errorHelperService=p.ErrorHelperService.getInstance(),this.contactService=h.ContactService.getInstance(),this.eventService=g.EventService.getInstance(),this.mainService=l.MainService.getInstance(),this.webrtcP2PService=f.WebrtcP2PService.getInstance(),this.telephonyServiceSipWise=m.TelephonyServiceSipWise.getInstance(),this.makingCall=false,this.mediaPillarConfigured=false,this.mediaPillarRemoteExtension="",this.mediaPillarAlive=false,this.nomadicAnswerNotTakedIntoAccount=false,this.sipWiseUserGroupsData={},this.telAPIPromiseInProgress=[],this.cliOptions=[],this.currentCli=null}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.telephonyService||(e.rainbow.telephonyService=new b),e.rainbow.telephonyService}async start(){this.logger.info("[telephonyService] [TEL] === STARTING ==="),this.setSipWise(this.isSipWiseRoot()),this.isSipWise()&&(this.logger.info("[telephonyService] starting in sipWise mode"),this.telephonyServiceSipWise.start()),this.calls={},this.pendingMakeCalls=[],this.starting=this.started=false,this.agentStatus={phoneApi:"disconnected",xmppAgent:"stopped",agentVersion:"unknown",featureVVM:false,featureOXOMULTICALL:false},this.voicemailNumber=this.contactService.userContact.voicemailNumber,this.pbxId=this.contactService.userContact.pbxId,this.makingCall=false,this.telAPIPromiseInProgress=[],this.forwardObject={forwardType:"Desactivation",forwardTo:void 0,pbxForwardType:"no_forward"},this.nomadicObject={},this.nomadicAnswerNotTakedIntoAccount=false,this.sipWiseUserGroupsData={myMemberId:"",managerAssistGrId:0,managerId:0,managerName:"",managerStatus:"",managerForward:"unknow",assistantId:0,assistantName:"",assistantStatus:"",isSomeMngAssistAsHG:false,huntingGroupNb:0,managerAssistantNb:0,managerAssistantMyAssistList:[],managerAssistantMyMngList:[],sipWiseUserGroupsList:[],initialized:false},this.isBasicCallAllowed=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_BASIC_CALL),this.isSecondCallAllowed=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_SECOND_CALL),this.isTransferAllowed=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_TRANSFER_CALL),this.isConferenceAllowed=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_CONFERENCE_CALL),this.isVMDeflectCallAllowed=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_DEFLECT_CALL),this.voiceMailFeatureEnabled=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_VOICE_MAIL),this.isForwardEnabled=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_CALL_FORWARD),this.isNomadicEnabled=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_NOMADIC),this.isWebrtcBlindTransferAllowed=true,this.isAdhocConferenceAllowed=this.contactService.userContact.webrtcAudioEnabled&&(this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.WEBRTC_CONFERENCE_ALLOWED)||this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.WEBRTC_ADD_PARTICIPANT))&&this.contactService.userContact.roomsEnabled,this.isMixPstnWebRtcAllowed=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.MIX_WEBRTC_PSTN_CALLS)||config.mixwebrtcpstn,this.userJidTel=this.authService.jidTel,this.portalURL=config.restServerUrl+"/api/rainbow/telephony/v1.0/",this.subscriptions.push(this.xmppService.subscribeToContactEvents((e=>{"ON_CONTACT_PRESENCE_EVENT"===e.name&&this.onTelPresenceChange(e.data)}))),this.subscriptions.push(this.xmppService.subscribeToConnectionEvents((e=>{try{"ON_XMPP_DISCONNECTED"===e.name&&(this.starting=this.started=false,this.telephonyOfflineCallManagement(),this.eventService.publish("ON_TELEPHONY_STATUS_CHANGED_EVENT","stopped"))}catch(t){}}))),this.telephonyEventHandler=this.isSipWise()?S.TelephonySipWiseEventHandler.create(this):v.TelephonyHybridEventHandler.create(this),this.logger.info("[telephonyService] starting on user jidTel: "+this.userJidTel),this.contactService.userContact&&(this.logger.info("[telephonyService] [TEL] starting user name: "+this.contactService.userContact.nameForLogs+", full jid: "+this.contactService.userContact.fullJid),this.logger.info("[telephonyService] [TEL] starting phonePbx: "+u.default(this.contactService.userContact.phonePbx)+", phonePro: "+u.default(this.contactService.userContact.phonePro)+", voicemailNumber: "+u.default(this.contactService.userContact.voicemailNumber)+", pbxId: "+this.contactService.userContact.pbxId)),this.contactService.userContact&&(this.contactService.userContact.telStatus?(this.logger.info("[telephonyService] start with my existing telephony presence "+this.contactService.userContact.telStatus+" of user contact ("+this.contactService.userContact.jidtel+") "),this.onTelPresenceChange({jid:this.userJidTel+"/phone",status:this.contactService.userContact.telStatus})):(this.logger.info("[telephonyService] Subscribe and wait for my telephony presence ("+this.contactService.userContact.jidtel+")"),this.contactService.sendSubscribeInvitation(this.contactService.userContact.jidtel))),this.listeners.push(this.eventService.subscribe("ON_ACTIVE_CONVERSATION_CHANGE",this.onActiveConversationChange.bind(this))),this.listeners.push(this.eventService.subscribe("ON_CALL_UPDATED_EVENT",this.onCallUpdated.bind(this))),this.listeners.push(this.eventService.subscribe("PUT_ACTIVE_TELEPHONY_CALL_ON_HOLD",this.putActiveTelephonyCallOnHold.bind(this))),this.listeners.push(this.eventService.subscribe("ON_WEBRTCGATEWAY_CONFIG_CHANGE",this.onMediaPillarConfigChanged.bind(this))),this.listeners.push(this.eventService.subscribe("ON_WEBRTCGATEWAY_STATE_CHG",this.onMediaPillarStateChanged.bind(this))),this.listeners.push(this.eventService.subscribe("TELEPHONY_MAKE_SIMPLE_CALL_TO_NUMBER",((e,t)=>{this.makeCall(null,t)}))),this.listeners.push(this.eventService.subscribe("ON_SIPWISE_HUNTING_GROUP_UPDATE_EVENT",(()=>{this.onUpdateHuntingGroupsData()})))}attachHandlers(){this.logger.info("[telephonyService] attachHandlers"),this.telephonyEventHandler.attachHandlers()}async stop(){let e;for(this.logger.info(""),this.logger.info("[telephonyService] [TEL] === STOPPING ==="),this.starting=this.started=false,this.userJidTel=null,this.calls=null,this.telAPIPromiseInProgress=[],this.telephonyEventHandler&&(this.telephonyEventHandler.detachHandlers(),this.telephonyEventHandler=null);e=this.listeners.pop();)e();this.currentPgiObject={},this.subscriptions&&this.subscriptions.forEach((e=>{e.unsubscribe()})),this.logger.info("[telephonyService] [TEL] === STOPPED ==="),this.eventService.publish("ON_TELEPHONY_STATUS_CHANGED_EVENT","stopped")}async onTelPresenceChange(e){if(this.contactService.isTelJid(e.jid)){const i=this.contactService.getResourceFromJid(e.jid);if("phone"!==i&&"pcg2"!==i)return true;const r=this.contactService.getImJid(e.jid);if(!r)return true;const n=e.status;if(this.contactService.isUserContactJid(r)){if(this.telAPIPromiseInProgress=[],"unavailable"===n||"offline"===n)this.logger.info("[telephonyService] received my telephony presence -- "+n),this.starting=this.started=false,this.telephonyOfflineCallManagement(),this.eventService.publish("ON_TELEPHONY_STATUS_CHANGED_EVENT","stopped"),this.logger.info("[telephonyService] [TEL] === STOPPED ===");else if(!this.started&&!this.starting){this.logger.info("[telephonyService] received my telephony presence -- "+n),this.starting=true;try{if(await this.getAgentStatus(),this.attachHandlers(),this.isSipWise())this.sipWiseUserGroupsDataClear(),this.telephonyServiceSipWise.emergencyCallDataClear(),this.telephonyServiceSipWise.routingDataClear(),await this.getTelephonyState(false);else if(this.isNomadicEnabled){await this.getNomadicStatus();const e=this.nomadicObject.featureActivated&&this.nomadicObject.modeActivated&&!this.nomadicObject.makeCallInitiatorIsMain;await this.getTelephonyState(e)}else await this.getTelephonyState(false);this.isForwardEnabled&&this.getForwardStatus(),this.logger.info("[telephonyService] [TEL] === STARTED ==="),this.started=true,this.starting=false,this.eventService.publish("ON_TELEPHONY_STATUS_CHANGED_EVENT","started")}catch(t){this.starting=false,this.logger.error("[telephonyService] receive telephony presence but error in initialization - "+(t?t.message:"unknown error")),setTimeout((()=>{this.logger.debug("[telephonyService] -- try to reinit after 10sec timeout"),this.launchTelephonyInitilization()}),1e4)}}}}return true}launchTelephonyInitilization(){this.contactService.userContact&&this.contactService.userContact.telStatus?(this.logger.info("[telephonyService] launchTelephonyInitilization telStatus: "+this.contactService.userContact.telStatus+" => start"),this.onTelPresenceChange({jid:this.userJidTel+"/phone",status:this.contactService.userContact.telStatus})):this.logger.info("[telephonyService] launchTelephonyInitilization no tel presence => do nothing")}reconnect(){this.logger.info("[telephonyService] [TEL] reconnect (xmpp reconnection)"),this.attachHandlers()}telephonyOfflineCallManagement(){this.logger.info("[telephonyService] telephony Offline Call Management");try{Object.keys(this.calls||{}).forEach((e=>{const t=this.calls[e];if(t){t.status!==n.Call.Status.RINGING_INCOMMING&&t.status!==n.Call.Status.QUEUED_INCOMMING||(t.mediaPillarCall&&t.mediaPillarCall.webrtcCallRef&&(this.logger.info("[telephonyService] Offline Call Management: release MP webrtc call for phone call "+t.id+" in state "+t.status.value),this.webrtcP2PService.releaseCall(t.mediaPillarCall.webrtcCallRef)),this.logger.info("[telephonyService] Offline Call Management: stop popup and ringing tone for phone call "+t.id+" in state "+t.status.value),t.setStatus(n.Call.Status.UNKNOWN),t.publish("ON_CALL_UPDATED_EVENT"),this.eventService.publish("ON_CALL_UPDATED_EVENT",t)),(t.status===n.Call.Status.RINGING_OUTGOING||t.status===n.Call.Status.QUEUED_OUTGOING)&&t.mediaPillarCall&&t.mediaPillarCall.webrtcCallRef&&(this.logger.info("[telephonyService] Offline Call Management: release MP webrtc call for phone call "+t.id+" in state "+t.status.value),this.webrtcP2PService.releaseCall(t.mediaPillarCall.webrtcCallRef));t.isMediaPillarCall()&&t.status===n.Call.Status.ACTIVE?(this.logger.info("[telephonyService] Offline Call Management: keep MP call for phone call "+t.id+" in state "+t.status.value),t.pbxConnectionDown=true):(delete this.calls[t.id],this.logger.info("[telephonyService] Offline Call Management: phone call deleted: "+t.id+" in state "+t.status.value))}})),this.logger.info("[telephonyService] Offline Call Management: clear "+this.pendingMakeCalls.length+" pending makecalls"),this.pendingMakeCalls=[]}catch(e){const t=e&&e.message?e.message:"Unknown error",i=e&&e.stack?e.stack:"Unknown stack";this.logger.error("[telephonyService] telephonyOfflineCallManagement  exception  -- "+t+" : "+i)}}async getAgentStatus(){let e="/phone";this.isSipWise()&&(this.logger.info("[telephonyService] getAgentStatus --- sipWise version"),e="/pcg2");const t=$iq({type:"get",to:this.userJidTel+e}).c("pbxagentstatus",{xmlns:"urn:xmpp:pbxagent:monitoring:1"});try{const e=await this.xmppService.sendIQ(t,6e4),i=$(e).find("phoneapi").text(),r=$(e).find("xmppagent").text(),n=$(e).find("version").text(),s=$(e).find("features").text(),o=$(e).find("type").text(),a=$(e).find("featuresCapabilities").text();let c=false,l=false;if(a){const e=a.split(",");c=e.includes("VVM"),l=e.includes("OXO_MULTICALL")}else s&&(c="VVM"===s);if(n&&(this.agentStatus={phoneApi:i,xmppAgent:r,agentVersion:n,featureVVM:c,featureOXOMULTICALL:l},o?(this.isOxe=o.toLowerCase().includes("oxe"),this.isOxo=o.toLowerCase().includes("oxo"),this.isThirdParty=o.toLowerCase().includes("tp")):(this.isOxe=n.toLowerCase().includes("oxe"),this.isOxo=n.toLowerCase().includes("oxo"),this.isThirdParty=n.toLowerCase().includes("tp"))),this.isSipWise()&&"RVCP"!==o){this.setSipWise(false);const e="getAgentStatus -- sipWise failure : wrong PCG type";throw this.logger.error("[telephonyService] "+e),new Error(e)}this.logger.info("[telephonyService] [TEL] getAgentStatus -- success -- version "+n+" isOxe:"+this.isOxe+" isOxo:"+this.isOxo+" isSipWise:"+this.isSipWise()+" isThirdParty:"+this.isThirdParty),this.eventService.publish("ON_AGENT_STATUS_RECEIVED_EVENT")}catch(i){const e="getAgentStatus -- failure : "+i.message;throw this.logger.error("[telephonyService] "+e),new Error(e)}}async getTelephonyState(e){if(this.isSipWise()){this.logger.info("[telephonyService] getTelephonyState -- sipWise get Devices then routingInfo then snapshot");try{return await this.telephonyServiceSipWise.getUserDevices(),await this.telephonyServiceSipWise.getUserRoutingInfo(),await this.telephonyServiceSipWise.processSnapshot(),this.getSipWiseUserGroups(),void this.telephonyServiceSipWise.getEmergencyCallData()}catch(i){this.logger.info("[telephonyService] sipwise getTelephonyState CATCH");const e="sipwise getTelephonyState -- "+i.message;throw this.logger.error("[telephonyService] "+e),i}}let t;t=e?$iq({type:"get",to:this.userJidTel+"/phone"}).c("callservice",{xmlns:this.CALLSERVICE_NS}).c("connections",{deviceType:"SECONDARY"}):$iq({type:"get",to:this.userJidTel+"/phone"}).c("callservice",{xmlns:this.CALLSERVICE_NS}).c("connections");try{const r=await this.xmppService.sendIQ(t,6e4),n=this.getErrorMessage(r,"getTelephonyState");if(n)throw this.logger.info("[telephonyService] getTelephonyState -- failure -- "+n),new Error(n);const s=$(r).find("connection");if(this.logger.info("[telephonyService] [TEL] getTelephonyState ("+(e?"SECONDARY":"MAIN")+") -- success -- "+s.length+" existing call(s)"),0===s.length)return;const o=[];s.each(((t,i)=>{o.push(this.createCallFromConnectionElem(i,e))}));try{await Promise.all(o),this.logger.info("[telephonyService] getTelephonyState ("+(e?"SECONDARY":"MAIN")+") -- calls creation completed -- "+s.length+" calls created")}catch(i){throw this.logger.error("[telephonyService] getTelephonyState -- calls creation failure -- "+i.message),i}}catch(i){throw this.logger.error("[telephonyService] getTelephonyState -- failure -- "+i.message),i}}async snapshotDevice(e){if(this.isSipWise())return;let t=this.portalURL+"snapshotdevice";e&&(t+="?deviceType=SECONDARY");try{const e=t,i=this.authService.getRequestHeader(),r=await fetch(e,{method:"GET",headers:i});if(!r.ok)throw r;const n=(await r.json()).data;return this.logger.info("[telephonyService] snapshotdevice success "),n}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"snapshotdevice");throw this.logger.error("[telephonyService] "+e.message),e.error}}async createCallFromConnectionElem(e,t){const i=$(e),r=i.attr("endpointIm");let s=i.attr("endpointTel");const o=i.attr("callId"),a=i.attr("endpointLci"),c=i.attr("lci"),l=i.find("participant"),d=i.find("identity").attr("firstName"),h=i.find("identity").attr("lastName"),f=i.find("party");let p="",g="";r||s||(s="****"),this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_PHONE_BOOK)&&0===l.length&&h&&h.length&&(g=h,d&&d.length&&(p=d),this.logger.info("[telephonyService] createCallFromConnectionElem - name resolution for: "+o+" for phoneNumber:"+u.default(s)+" with firstname : "+p.slice(0,1)+"***"));const m=()=>0===l.length?this.contactService.getOrCreateContact(r,s):this.getParticipantsFromParticipantsElem(l);try{const e=await m();let i=n.Call.Status.ACTIVE;"LCI_INITIATED"===c&&(i=n.Call.Status.DIALING),"LCI_HELD"===c&&"LCI_CONNECTED"===a&&(i=n.Call.Status.HOLD),"LCI_CONNECTED"===c&&"LCI_HELD"===a&&(i=n.Call.Status.PUT_ON_HOLD),"LCI_CONNECTED"===c&&"LCI_QUEUED"===a&&(i=n.Call.Status.QUEUED_OUTGOING),"LCI_QUEUED"===c&&"LCI_CONNECTED"===a&&(i=n.Call.Status.QUEUED_INCOMMING),"LCI_ALERTING"===c&&(i=n.Call.Status.RINGING_INCOMMING);let r=null;if(0===l.length?(e&&e.temp&&""!==g&&e.updateName(p,g),r=this.getOrCreateCall(i,o,e),this.logger.info("[telephonyService] [TEL] createCallFromConnectionElem - create call "+r+" for user: "+e.id)):(r=this.getOrCreateCall(i,o),r.setParticipants(e),r.isConference=true,this.logger.info("[telephonyService] [TEL] createCallFromConnectionElem - create conference call "+r)),f&&f.length&&(r.calledNumber=f.attr("number")||"",r.calledNumber)){r.calledRole=f.attr("role")||"",r.calledJID=f.attr("jid")||"";const e=f.attr("displayName")||"",t=f.attr("firstName")||"",i=f.attr("lastName")||"";r.calledDisplayName=e||r.calledDisplayName,r.calledFirstName=t||r.calledFirstName,r.calledLastName=i||r.calledLastName,r.calledFirstName||r.calledLastName?r.calledDisplayName=this.computeDisplayName(r.calledFirstName,r.calledLastName):r.calledDisplayName||(r.calledDisplayName=r.calledNumber)}return r.relevantEquipmentId=n.Call.getDeviceIdFromConnectionId(o),r.isSecondary=t,r.publish("ON_CALL_UPDATED_EVENT"),this.eventService.publish("ON_CALL_UPDATED_EVENT",r),r}catch(v){throw this.logger.error("[TelephonyService] createCallFromConnectionElem - failure - "+v.message),v}}computeDisplayName(e,t){const i=e?e.charAt(0).toUpperCase()+e.slice(1):null,r=t?t.charAt(0).toUpperCase()+t.slice(1):null;let n="";return n=r&&i?"FL"===this.settingsService.getSetting("displayOrder")?i+" "+r:r+" "+i:r&&!i?r:i||"Anonymous",n}async getParticipantsFromParticipantsElem(e){const t=[],i=[];return e.each(((e,r)=>{const n=$(r);let s=n.find("endpointTel").text();const o=n.find("endpointIm").text();o&&this.contactService.isUserContactJid(o)||i.push((async()=>{o||s||(s="****");const e=await this.contactService.getOrCreateContact(o,s);t.push(e)})())})),await Promise.all(i),t}getOrCreateCall(e,t,i=null){let r=this.calls[n.Call.getIdFromConnectionId(t)];return r?(r.setConnectionId(t),r.startDate=r.startDate||new Date):(r=n.Call.create(e,null,n.Call.Type.PHONE,i),r.setConnectionId(t),this.calls[r.id]=r),r}createCallSipWise(e,t){let i=null;return t&&(i=this.calls[t]),i?i.startDate=i.startDate||new Date:(i=n.Call.create(e,t,n.Call.Type.PHONE),this.calls[i.id]=i),i}getOrCreateCallSipWise(e,t,i,r,s){let o=null;return t&&(o=this.calls[t]),o?(o.setConnectionIdSipWise(i),s&&o.setContact(s),r&&o.setDeviceIdSipWise(r),o.startDate=o.startDate||new Date):(o=n.Call.create(e,t,n.Call.Type.PHONE,s),o.setConnectionIdSipWise(i),o.setDeviceIdSipWise(r),this.calls[o.id]=o),o}getActiveCall(){return this.getCall(n.Call.Status.ACTIVE)}getRingingOutgoingCall(){return this.getCall(n.Call.Status.RINGING_OUTGOING)}getCall(e){let t=null;return Object.keys(this.calls||{}).forEach((i=>{const r=this.calls[i];r.status===e&&(t=r)})),t}getOngoingOutgoingCall(){let e=null;return Object.keys(this.calls||{}).forEach((t=>{const i=this.calls[t];i.status!==n.Call.Status.RINGING_OUTGOING&&i.status!==n.Call.Status.QUEUED_OUTGOING&&i.status!==n.Call.Status.DIALING&&i.status!==n.Call.Status.ERROR||(e=i)})),e}getRingingIncomingCalls(){return this.getCalls(n.Call.Status.RINGING_INCOMMING)}getQueuedIncomingCalls(){return this.getCalls(n.Call.Status.QUEUED_INCOMMING)}getCallsOnHold(){return this.getCalls(n.Call.Status.HOLD)}getCalls(e=null){const t=[],i=e?Array.isArray(e)?e:[e]:[n.Call.Status.DIALING,n.Call.Status.RINGING_OUTGOING,n.Call.Status.QUEUED_OUTGOING,n.Call.Status.ACTIVE,n.Call.Status.HOLD,n.Call.Status.PUT_ON_HOLD,n.Call.Status.ERROR];return Object.keys(this.calls||{}).forEach((e=>{const r=this.calls[e],n=r.status;i.includes(n)&&t.push(r)})),t}getNotIdleCalls(){const e=[];return Object.keys(this.calls||{}).forEach((t=>{const i=this.calls[t];i.status!==n.Call.Status.UNKNOWN&&e.push(i)})),e}isUserIdle(){return!Object.keys(this.calls||{}).some((e=>this.calls[e].status!==n.Call.Status.UNKNOWN))}getActiveCallsForContact(e){const t=[];return e&&e.jid&&Object.keys(this.calls||{}).forEach((i=>{!this.calls[i].contact||this.calls[i].contact.jid!==e.jid||this.calls[i].status!==n.Call.Status.DIALING&&this.calls[i].status!==n.Call.Status.RINGING_OUTGOING&&this.calls[i].status!==n.Call.Status.QUEUED_OUTGOING&&this.calls[i].status!==n.Call.Status.ACTIVE&&this.calls[i].status!==n.Call.Status.HOLD&&this.calls[i].status!==n.Call.Status.PUT_ON_HOLD||t.push(this.calls[i])})),t}getCallsForContact(e){const t=[];return e&&e.jid&&Object.keys(this.calls||{}).forEach((i=>{const r=this.calls[i];r.contact&&r.contact.jid===e.jid&&r.status!==n.Call.Status.UNKNOWN&&t.push(r)})),t}getConferenceCallForContact(e){let t=null;return e&&e.jid&&Object.keys(this.calls||{}).forEach((i=>{this.calls[i].status===n.Call.Status.ACTIVE&&this.calls[i].isConference&&(this.calls[i].participants||[]).some((t=>t&&t.jid===e.jid))&&(t=this.calls[i])})),t}getOtherCallWithSameGlobalCallId(e){if(!e||!e.globalCallId)return null;const t=Object.keys(this.calls||{}).reverse().find((t=>{const i=this.calls[t];return this.logger.debug("[telephonyService] getOtherCallWithSameGlobalCallId check call "+i),i.id!==e.id&&i.globalCallId===e.globalCallId})),i=t?this.calls[t]:null;return this.logger.info("[telephonyService] getOtherCallWithSameGlobalCallId source call id: "+e.id+" globalCallId: "+e.globalCallId+" => "+(i?"found call "+i:"not found")),i}logMakecallReqData(e,t){const i={};Object.keys(e).forEach((r=>{switch(r){case"calleeExtNumber":case"calleeIntNumber":case"calleeShortNumber":i[r]=u.default(e[r]);break;case"calleeDisplayName":t&&(i[r]=t&&t.nameForLogs?t.nameForLogs:"");break;default:i[r]=e[r]}})),this.logger.info("[telephonyService] makeCall data: "+JSON.stringify(i))}async makeCall(e,t,i,r,n,s){if(this.logger.info("[telephonyService] [TEL] makeCall to "+(e&&e.nameForLogs?e.nameForLogs:u.default(t))),this.makingCall)return void this.logger.warn("[telephonyService] [TEL] makeCall failure - makeCall already making a call");if(this.getRingingOutgoingCall())return this.logger.warn("[telephonyService] [TEL] makeCall failure - ringingOutgoing call in progress"),void this.displayNotAllowedNotification(e,t);const o=this.getActiveCall();if(o&&o.isConference)return this.logger.warn("[telephonyService] [TEL] makeCall failure - conference call in progress"),void this.displayNotAllowedNotification(e,t);if(!this.contactService.userContact.capabilities.telephony)return this.logger.warn("[telephonyService] [TEL] makeCall failure - user cannot make telephony call (telephony capability)"),void this.displayNotAllowedNotification(e,t);if(this.isMixPstnWebRtcAllowed&&this.eventService.publish("PUT_ACTIVE_WEBRTC_CALL_ON_HOLD"),this.makingCall=true,!o)return this.isSipWise()?this.telephonyServiceSipWise.makeSimpleCall(e,t,s):this.makeSimpleCall(e,t,i,r,n,s);if(!this.isSipWise())return this.makeConsultationCall(e,t,o.connectionId,r,n);if(this.isMediaPillarAvailable()&&this.isMediaPillarUserSelected())try{return await this.telephonyServiceSipWise.holdCall(o),this.telephonyServiceSipWise.makeSimpleCall(e,t)}catch(a){return}return this.telephonyServiceSipWise.makeSimpleCall(e,t)}displayNotAllowedNotification(e,t){this.logger.debug("[telephonyService] displayNotAllowedNotification");const i=n.Call.create(n.Call.Status.ERROR,null,n.Call.Type.PHONE,e);i.errorMessage="notAllowed",i.isSecondary=this.nomadicObject&&!this.nomadicObject.makeCallInitiatorIsMain,i.isOwner=true,i.setIsVm(t===this.voicemailNumber),this.calls[i.contact.id]=i,setTimeout((()=>{this.clearCall(i)}),5e3),i.publish("ON_CALL_UPDATED_EVENT"),this.eventService.publish("ON_CALL_UPDATED_EVENT",i)}async makeSimpleCall(e,t,i,r,n,s){if(this.logger.info("[telephonyService] makeSimpleCall to "+(e&&e.nameForLogs?e.nameForLogs:u.default(t))),!this.isBasicCallAllowed){const e=new Error("makeSimpleCall failure - Not Allowed");throw e.status=e.errorDetailsCode="403",this.logger.error("[telephonyService] "+e.message),this.makingCall=false,e}if(this.isMediaPillarAvailable()&&this.isMediaPillarUserSelected()&&this.webrtcP2PService.getWebrtcAudioCall())throw this.logger.info("[telephonyService] makeCall failure - webrtcgateway call not possible when webrtc call already engaged"),this.makingCall=false,this.eventService.publish("ON_CALL_NOTALLOWED_EVENT","webCallAlreadyProgress"),new Error("webCallAlreadyProgress");const o=this.getPhoneInfo(e,t),a=this.portalURL+"calls",c={calleeExtNumber:o.longNumber,calleeIntNumber:o.internalNumber,calleeShortNumber:o.shortNumber,calleePbxId:o.pbxId,calleeDisplayName:e.displayName,callSubject:i,correlatorData:r,correlatorDataHex:n,secondaryDeviceMakeCall:void 0!==this.nomadicObject.makeCallInitiatorIsMain&&true===this.nomadicObject.featureActivated&&this.isNomadicEnabled?this.nomadicObject.makeCallInitiatorIsMain?"false":"true":void 0,resource:this.xmppService.getResourceFromJid(this.contactService.userContact.fullJid),calledNumber:""};return s&&(c.calledNumber=s),this.logger.info("[telephonyService] makeSimpleCall "+a),this.logMakecallReqData(c,e),this.doRequestMakecall(e,t,a,c)}async makeConsultationCall(e,t,i,r,s){if(this.logger.info("[telephonyService] makeConsultationCall to "+(e&&e.nameForLogs?e.nameForLogs:u.default(t))),!this.isSecondCallAllowed){const e=new Error("makeConsultationCall failure - Not Allowed");throw e.status=e.errorDetailsCode="403",this.logger.error("[telephonyService] "+e.message),this.makingCall=false,e}const o=this.getPhoneInfo(e,t,r,s),a=this.portalURL+"calls/"+encodeURIComponent(i)+"/consultation",c={calleeExtNumber:o.longNumber,calleeIntNumber:o.internalNumber,calleeShortNumber:o.shortNumber,calleePbxId:o.pbxId,calleeDisplayName:e.displayName,correlatorData:o.correlatorData,correlatorDataHex:o.correlatorDataHex,resource:this.xmppService.getResourceFromJid(this.contactService.userContact.fullJid)};this.logger.info("[telephonyService] makeConsultationCall "+a),this.logMakecallReqData(c,e);try{return this.doRequestMakecall(e,t,a,c)}catch(l){throw this.deleteCallIfInvalid(l,this.calls[n.Call.getIdFromConnectionId(i)]),l}}async doRequestMakecall(e,t,i,r){this.logger.info("[telephonyService] doRequestMakecall to "+(e&&e.nameForLogs?e.nameForLogs:u.default(t)));const s=n.Call.create(n.Call.Status.UNKNOWN,null,n.Call.Type.PHONE,e);s.isSecondary=this.nomadicObject&&!this.nomadicObject.makeCallInitiatorIsMain,s.isOwner=true,s.setIsVm(t===this.voicemailNumber),this.pendingMakeCalls.push(s),this.logger.info("[telephonyService] doRequestMakecall Call created ("+s+")");try{const e=i,o=this.authService.getPostHeader(),a=r,c=JSON.stringify(a),l=await fetch(e,{method:"POST",headers:o,body:c});if(!l.ok)throw l;const d=await l.json();this.logger.info("[telephonyService] [TEL] makecall - success : callee "+u.default(t)+" callId: "+d.data.callId);return this.pendingMakeCalls.includes(s)?(s.setStatus(n.Call.Status.DIALING),s.setConnectionId(d.data.callId),s.setRelevantEquipmentId(n.Call.getDeviceIdFromConnectionId(s.connectionId)),this.calls[s.id]=s,this.pendingMakeCalls.splice(this.pendingMakeCalls.indexOf(s),1),this.logger.info("[telephonyService] doRequestMakecall Call confirmed by makecall acknowlegement ("+s+")"),s.publish("ON_CALL_UPDATED_EVENT"),this.eventService.publish("ON_CALL_UPDATED_EVENT",s),s.id):s.id?s.id:d.data.callId}catch(o){const e=await this.errorHelperService.getErrorInfo(o,"makeCall");throw this.logger.error("[telephonyService] [TEL] "+e.message),s.setStatus(n.Call.Status.ERROR),s.errorMessage="403"===e.error.errorDetailsCode?"notAllowed":"invalidPhoneNumber",this.calls[s.contact.id]=s,this.pendingMakeCalls.splice(this.pendingMakeCalls.indexOf(s),1),setTimeout((()=>{this.clearCall(s)}),5e3),s.publish("ON_CALL_UPDATED_EVENT"),this.eventService.publish("ON_CALL_UPDATED_EVENT",s),e.error}finally{this.makingCall=false}}async makeCallByPhoneNumber(e,t,i,r){if(this.logger.info("[telephonyService] [TEL] makeCallByPhoneNumber : "+u.default(e)),!this.started){const e="makeCallByPhoneNumber failure: telephony not started";throw this.logger.error("[telephonyService] "+e),new Error(e)}if(this.contactService.userContact.phonePro===e||this.contactService.userContact.phoneProCan===e||this.contactService.userContact.phonePbx===e){const e="makeCallByPhoneNumber failure: impossible to call its own phone number";throw this.logger.error("[telephonyService] "+e),new Error(e)}try{const n=await this.contactService.getOrCreateContact(null,e);await this.makeCall(n,e,t,i,r)}catch(n){const e="makeCallByPhoneNumber failure "+(n?n.message:"");throw this.logger.error("[telephonyService] - callService - "+e),new Error(e)}}getPhoneInfo(e,t,i=null,r=null){let n=t,s="",o="",a="";return e&&(t===e.phonePro||t===e.phoneProCan?(n=e.phoneProCan?e.phoneProCan:"",s=e.phonePbx,a=e.pbxId,o=e.phoneInternalNumber):t===e.phonePbx&&(n="",s=e.phonePbx,a=e.pbxId,o=e.phoneInternalNumber)),{longNumber:n,shortNumber:s,pbxId:a,internalNumber:o,correlatorData:i,correlatorDataHex:r}}getErrorMessage(e,t){let i=t+" failure : ";if("error"===$(e).attr("type")){const t=$(e).find("error");if(t){const e=t.attr("type"),r=t.attr("code");e&&(i+=e+" : ","modify"===e&&(i+=t.find("text").text())),r&&"503"===r&&(i+="Agent error : service unavailable"),this.logger.error("[telephonyService] "+i)}else i+="Unknown error";return i}return null}async releaseCall(e){this.logger.info("[telephonyService] [TEL] releaseCall "+e.id);const t="releaseCall"+e.id;return this.telAPIPromiseInProgress[t]?this.logger.info("[telephonyService] [TEL] releaseCall "+e.id+" already engaged then not re-sent to API"):this.telAPIPromiseInProgress[t]=new Promise(((i,r)=>{this.innerReleaseCall(e).then((e=>{i(e),delete this.telAPIPromiseInProgress[t]})).catch((e=>{r(e),delete this.telAPIPromiseInProgress[t]}))})),this.telAPIPromiseInProgress[t]}async innerReleaseCall(e){if(!this.isBasicCallAllowed){const e=new Error("innerReleaseCall failure - Not Allowed");throw e.status=e.errorDetailsCode="403",this.logger.error("[telephonyService] [TEL] "+e.message),e}if(e.pbxConnectionDown)return e.mediaPillarCall&&e.mediaPillarCall.webrtcCallRef&&e.mediaPillarCall.webrtcCallRef.status!==n.Call.Status.UNKNOWN?(this.logger.info("[telephonyService] innerReleaseCall "+e.id+" with pbx connection down : we release the mediapillar web call: "+e.mediaPillarCall.webrtcCallRef),this.webrtcP2PService.releaseCall(e.mediaPillarCall.webrtcCallRef)):this.logger.info("[telephonyService] innerReleaseCall "+e.id+" with pbx connection down : "+(e.mediaPillarCall?e.mediaPillarCall.webrtcCallRef?"no need to release webrtc call with status "+e.mediaPillarCall.webrtcCallRef:"no MP webrtc call to release":"no MP context!")),this.logger.info("[telephonyService] [TEL] innerReleaseCall "+e.id+" with pbx connection down : we remove the phone call"),this.clearCall(e),e;if(this.isSipWise())return this.telephonyServiceSipWise.releaseCall(e);this.logger.info("[telephonyService] [TEL] innerReleaseCall "+e.id);try{const t=this.portalURL+"calls/"+encodeURIComponent(e.connectionId),i=this.authService.getPostHeader(),r=await fetch(t,{method:"DELETE",headers:i});if(!r.ok)throw r;return e.setStatus(n.Call.Status.UNKNOWN),e.startDate=null,e.setIsVm(false),this.logger.info("[telephonyService] [TEL] releaseCall "+e.id+" - success"),e.publish("ON_CALL_UPDATED_EVENT"),this.eventService.publish("ON_CALL_UPDATED_EVENT",e),delete this.calls[e.id],e}catch(t){const i=await this.errorHelperService.getErrorInfo(t,"innerReleaseCall");throw this.deleteCallIfInvalid(i.error,e),this.logger.error("[telephonyService] [TEL] "+i.message),i.error}}async releaseCallAndNotify(e){try{await this.releaseCall(e)}catch(t){throw e.setStatus(n.Call.Status.UNKNOWN),this.eventService.publish("ON_CALL_UPDATED_EVENT",e),t}}deleteCallIfInvalid(e,t){e&&"telephony"===e.portal&&404100===e.errorDetailsCode&&e.message&&(e.message.toLowerCase().includes("invalid connection identifier")||e.message.toLowerCase().includes("failed to send releasecall"))&&t&&(this.logger.warn("[telephonyService] deleteCallIfInvalid: delete client call non existing on server: "+t.id),t.setStatus(n.Call.Status.UNKNOWN),t.publish("ON_CALL_UPDATED_EVENT"),this.eventService.publish("ON_CALL_UPDATED_EVENT",t),this.calls[t.id]&&delete this.calls[t.id])}async answerCall(e){this.logger.info("[telephonyService] [TEL] answerCall : "+e.id);const t=this.getActiveCall();if(!this.isBasicCallAllowed){const e=new Error("answerCall failure - Not Allowed");throw e.status=e.errorDetailsCode="403",this.logger.error("[telephonyService] "+e.message),e}if(this.isMixPstnWebRtcAllowed&&this.eventService.publish("PUT_ACTIVE_WEBRTC_CALL_ON_HOLD"),this.isSipWise())return this.telephonyServiceSipWise.answerCall(e);if(e.status!==n.Call.Status.QUEUED_INCOMMING||!t||!this.isOxe)return this.doRequestAnswerCall(e);try{await this.holdCall(t)}catch(i){this.logger.warn("[telephonyService] holdCall (before answerCall) failed on callId:"+t.connectionId+" "+i)}try{return await this.doRequestAnswerCall(e)}catch(i){const e="answerCall failure : "+i.message;throw this.logger.error("[telephonyService] - callService -  "+e),new Error(e)}}async doRequestAnswerCall(e){try{const t=this.portalURL+"calls/"+encodeURIComponent(e.connectionId)+"/answer",i=this.authService.getPostHeader(),r=await fetch(t,{method:"PUT",headers:i});if(!r.ok)throw r;const s=(await r.json()).data;return this.logger.info("[telephonyService] [TEL] answerCall - success : "+u.default(e.contact.displayName)+" Call ("+e+")"),this.isOxo?(this.logger.info("[telephonyService] answerCall call id "+e.id+" -- OXO specific mng wait established"),e):(e.status===n.Call.Status.RINGING_INCOMMING||e.status===n.Call.Status.QUEUED_INCOMMING?(e.setConnectionId(s.callId),e.setStatus(n.Call.Status.ACTIVE),e.publish("ON_CALL_UPDATED_EVENT"),this.eventService.publish("ON_CALL_UPDATED_EVENT",e)):this.logger.info("[telephonyService] answerCall Call ("+e+") not ringing anymore: don't modify it"),e)}catch(t){const i=await this.errorHelperService.getErrorInfo(t,"answerCall");throw this.logger.error("[telephonyService] [TEL] "+i.message),i.error&&"Device is not able to answer a call"===i.error.errorDetails&&(this.logger.info("[telephonyService] [TEL] errorDetails "+i.error.errorDetails),this.mainService.showGlobalPopupMessage({autoClose:false,okLabel:"close",popupTitle:"warning",popupBody:"deviceDoesntAllowAnswer"})),this.deleteCallIfInvalid(i.error,e),i.error}}async holdCall(e){if(this.logger.info("[telephonyService] [TEL] holdCall : callId: "+e.id+" "+e.contact.nameForLog),!e||e.status===n.Call.Status.HOLD)return e;if(this.isSipWise())return this.telephonyServiceSipWise.holdCall(e);try{const t=this.portalURL+"calls/"+encodeURIComponent(e.connectionId)+"/hold",i=this.authService.getPostHeader(),r=await fetch(t,{method:"PUT",headers:i});if(!r.ok)throw r;const s=(await r.json()).data;return this.logger.info("[telephonyService] [TEL] holdCall - success : "+u.default(e.contact.displayName)+" Call ("+e+")"),e.setConnectionId(s.callId),e.setStatus(n.Call.Status.HOLD),e.publish("ON_CALL_UPDATED_EVENT"),this.eventService.publish("ON_CALL_UPDATED_EVENT",e),e}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"holdCall");throw this.logger.error("[telephonyService] [TEL] "+e.message),e.error}}async retrieveCall(e){this.logger.info("[telephonyService] [TEL] retrieveCall callId: "+e.id+" "+e.contact.nameForLog),this.isMixPstnWebRtcAllowed&&this.eventService.publish("PUT_ACTIVE_WEBRTC_CALL_ON_HOLD");const t=this.getActiveCall();if(t)try{return await this.holdCall(t),await this.retrieveCall(e)}catch(i){const e="retrieveCall failure : "+i.message;throw this.logger.error("[telephonyService] [TEL] - callService -  "+e),new Error(e)}else{if(this.isSipWise())return this.telephonyServiceSipWise.retrieveCall(e);try{const t=this.portalURL+"calls/"+encodeURIComponent(e.connectionId)+"/retrieve",i=this.authService.getPostHeader(),r=await fetch(t,{method:"PUT",headers:i});if(!r.ok)throw r;const s=(await r.json()).data;return this.logger.info("[telephonyService] [TEL] retrieveCall - success : "+u.default(e.contact.displayName)+" Call ("+e+")"),e.setConnectionId(s.callId),e.setStatus(n.Call.Status.ACTIVE),e.publish("ON_CALL_UPDATED_EVENT"),this.eventService.publish("ON_CALL_UPDATED_EVENT",e),e}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"retrieveCall");throw this.logger.error("[telephonyService] [TEL] "+e.message),e.error}}}async alternateCall(e,t){if(e&&t){if(!this.isSecondCallAllowed){const e=new Error("alternateCall failure - Not Allowed");throw e.status=e.errorDetailsCode="403",this.logger.error("[telephonyService] "+e.message),e}this.logger.info("[telephonyService] [TEL] alternateCall held("+t.contact.displayName+") to active("+e.contact.displayName+")");try{const i=this.portalURL+"calls/"+encodeURIComponent(e.connectionId)+"/alternate/"+encodeURIComponent(t.connectionId),r=this.authService.getPostHeader(),n=await fetch(i,{method:"PUT",headers:r});if(!n.ok)throw n;this.logger.info("[telephonyService] [TEL] alternateCall - success")}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"alternateCall");throw this.logger.error("[telephonyService] [TEL] "+e.message),e.error}}}async deflectCallToVM(e){if(e){if(!this.isVMDeflectCallAllowed){const e=new Error("deflectCall failure - Not Allowed");throw e.status=e.errorDetailsCode="403",this.logger.error("[telephonyService] "+e.message),e}if(this.logger.info("[telephonyService] [TEL] deflectCallToVM "+e.contact.nameForLogs),this.isSipWise())await this.telephonyServiceSipWise.deflectCall(e,this.voicemailNumber);else try{const t=this.portalURL+"calls/"+encodeURIComponent(e.connectionId)+"/deflect",i=this.authService.getPostHeader(),r={calleeExtNumber:"",calleeIntNumber:"VOICEMAILBOX",calleeShortNumber:this.voicemailNumber,calleePbxId:this.pbxId},n=JSON.stringify(r),s=await fetch(t,{method:"PUT",headers:i,body:n});if(!s.ok)throw s;this.logger.info("[telephonyService] [TEL] deflectCall - success")}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"deflectCallToVM");throw this.logger.error("[telephonyService] [TEL] "+e.message),e.error}}}async deflectCallToNumber(e,t){if(!e||!t)return;let i;if(!this.isVMDeflectCallAllowed)throw i=new Error("deflectCall failure - Not Allowed"),i.status=i.errorDetailsCode="403",this.logger.error("[telephonyService] "+i.message),i;if(this.logger.info("[telephonyService] [TEL] deflectCallToNumber "+e.contact.nameForLog),!this.isSipWise())throw i=new Error("deflectCall failure - Not Allowed"),i.status=i.errorDetailsCode="403",this.logger.error("[telephonyService] [TEL] "+i.message),i;await this.telephonyServiceSipWise.deflectCall(e,t)}async transfertCall(e,t){if(e&&t){if(!this.isTransferAllowed){const e=new Error("transferCall failure - Not Allowed");throw e.status=e.errorDetailsCode="403",this.logger.error("[telephonyService] "+e.message),e}if(this.logger.info("[telephonyService] transfertCall [TEL] held("+t.contact.displayName+") to active("+e.contact.displayName+")"),this.isSipWise())await this.telephonyServiceSipWise.transferCall(e,t);else try{const i=this.portalURL+"calls/"+encodeURIComponent(e.connectionId)+"/transfer/"+encodeURIComponent(t.connectionId),r=this.authService.getPostHeader(),n=await fetch(i,{method:"PUT",headers:r});if(!n.ok)throw n;this.logger.info("[telephonyService] [TEL] transferCall - success")}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"transfertCall");throw this.logger.error("[telephonyService] [TEL] "+e.message),e.error}}}async blindTransfertCall(e,t,i){if(!e||!t&&!i)throw new Error("[telephonyService] blindTransfertCall -- missing parameters");if(!this.isSipWise())throw new Error("[telephonyService] blindTransfertCall -- only allowed for RB Hub users");if(t&&!this.isTransferAllowed){const e=new Error("[telephonyService] blind transfertCall failure - Transfer Not Allowed");throw e.status=e.errorDetailsCode="403",this.logger.error("[telephonyService] "+e.message),e}if(i&&!this.isMixPstnWebRtcAllowed){const e=new Error("[telephonyService] blind transfertCall failure - Mix WEBRTC_PSTN Not Allowed");throw e.status=e.errorDetailsCode="403",this.logger.error("[telephonyService] "+e.message),e}return this.telephonyServiceSipWise.blindTransferCall(e,t,i)}async conferenceCall(e,t){if(e&&t){if(!this.isConferenceAllowed){const e=new Error("conferenceCall failure - Not Allowed");throw e.status=e.errorDetailsCode="403",this.logger.error("[telephonyService] "+e.message),e}if(this.logger.info("[telephonyService] [TEL] conferenceCall "+e.connectionId+" ("+e.contact.displayName+") and "+t.connectionId+" ("+t.contact.displayName+")"),this.isSipWise())return this.conferenceCallSipWise(e,t);try{const i=this.portalURL+"calls/"+encodeURIComponent(e.connectionId)+"/conference/"+encodeURIComponent(t.connectionId),r=this.authService.getPostHeader(),n=await fetch(i,{method:"PUT",headers:r});if(!n.ok)throw n;return void this.logger.info("[telephonyService] [TEL] conferenceCall - success")}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"conferenceCall");throw this.logger.error("[telephonyService] [TEL] "+e.message),e.error}}}async conferenceCallSipWise(e,t){try{if(!this.isMixPstnWebRtcAllowed)throw new Error("conferenceCallSipWise failure - Not Allowed -- missing feature flag");const i=this.mainService.inject("roomService");if(!i)throw new Error("conferenceCallSipWise failure - Room / Bubble service is missing");const r=this.mainService.inject("webConferenceServiceV2");if(!r)throw new Error("conferenceCallSipWise failure - Web conference service is missing");this.logger.info("[telephonyService] conferenceCallSipWise");const s={userId:this.contactService.userContact.dbId},o=[];let a=false,c=false;const l=i.getParticipantDataForAdhocFromCall(e);o.push(l.participant),a=l.blindTrasfer;const d=i.getParticipantDataForAdhocFromCall(t);o.push(d.participant),c=d.blindTrasfer;const u=await i.startAdHocConferenceV2(s,o);this.logger.info("[telephonyService] conferenceCallSipWise -- ad hoc started "+JSON.stringify(u));let h=i.getRoomById(u.roomId);h&&h.isWebConferenceV2Room()||(h=await i.getServerRoom(u.roomId));const f=e.type===n.Call.Type.WEBRTC?e.id:t.type===n.Call.Type.WEBRTC?t.id:null,p=this.xmppService.connection.jingle.sessions[f];await r.transferP2pCallToConference(p,u.jingleJid,h,true,e.isMuted);const g=u&&u.gatewayPrefix&&u.participantGatewaySessionIds?u.gatewayPrefix+u.participantGatewaySessionIds[0]:"",m=u&&u.gatewayPrefix&&u.participantGatewaySessionIds?u.gatewayPrefix+u.participantGatewaySessionIds[1]:"",v="urn:xmpp:jingle:apps:rtp:info:1";return a?(this.logger.info("[telephonyService] conferenceCallSipWise -- activeCallBlindTransfer "+g),this.blindTransfertCall(e,g)):e.type===n.Call.Type.PHONE?(this.logger.info("[telephonyService] conferenceCallSipWise -- activeCall invite via IQ refer"),this.xmppService.send($msg({from:this.contactService.userContact.fullJid,to:e.contact.jid}).c("refer",{xmlns:v,confEndpointId:h.dbId,referTo:u.jingleJid,telCallId:e.id}))):e.type===n.Call.Type.WEBRTC&&this.webrtcP2PService.referTo(p,h.dbId,u.jingleJid),c?(this.logger.info("[telephonyService] conferenceCallSipWise -- heldCallBlindTransfer "+c),this.blindTransfertCall(t,m)):t.type===n.Call.Type.PHONE?(this.logger.info("[telephonyService] conferenceCallSipWise -- heldCall invite via IQ refer"),this.xmppService.send($msg({from:this.contactService.userContact.fullJid,to:t.contact.jid}).c("refer",{xmlns:v,confEndpointId:h.dbId,referTo:u.jingleJid,telCallId:t.id}))):t.type===n.Call.Type.WEBRTC&&this.webrtcP2PService.referTo(p,h.dbId,u.jingleJid),h}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"conferenceCallSipWise");throw this.logger.error("[telephonyService] [TEL] "+e.message),e.error}}async sipWiseForwardToDevice(e,t,i){if(this.logger.info("[telephonyService] [TEL] sipWiseforwardToDevice : "+e+" / destType = "+t+" / fwType = "+i),!this.isForwardEnabled){const e=new Error("sipWiseforwardToDevice failure - Not Allowed");throw e.status=e.errorDetailsCode="403",this.logger.error("[telephonyService] "+e.message),e}if(this.contactService.userContact.phonePro===e||this.contactService.userContact.phoneProCan===e||this.contactService.userContact.phonePbx===e){const e="sipWiseforwardToDevice failure: impossible to forward its own phone number";throw this.logger.error("[telephonyService] "+e),new Error(e)}if(!e||!i||""===i||!t||""===t){const e="sipWiseforwardToDevice failure: bad parameters";throw this.logger.error("[telephonyService] "+e),new Error(e)}if(!this.isSipWise()){const e="sipWiseforwardToDevice not implemented if not sipWise case";throw this.logger.error("[telephonyService] "+e),new Error(e)}try{await this.telephonyServiceSipWise.forwardToDevice(e,t,i)}catch(r){const e=await this.errorHelperService.getErrorInfo(r,"sipWiseForwardToDevice");throw this.logger.error("[telephonyService] "+e.message),e.error}}async sipWiseCancelForward(e){if(this.logger.info("[telephonyService] [TEL] sipWiseCancelForward :  fwType = "+e),!this.isForwardEnabled){const e=new Error("cancelForward failure - Not Allowed");throw e.status=e.errorDetailsCode="403",this.logger.error("[telephonyService] "+e.message),e}if(!this.isSipWise()){const e="sipWiseCancelForward not implemented if not sipWise case";throw this.logger.error("[telephonyService] "+e),new Error(e)}try{return void(await this.telephonyServiceSipWise.cancelForward(e))}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"sipWiseCancelForward");throw this.logger.error("[telephonyService] "+e.message),e.error}}async forwardToDevice(e,t){if(this.logger.info("[telephonyService] [TEL] forwardToDevice : "+e+" forwardType :"+t),!this.isForwardEnabled){const e=new Error("forwardToDevice failure - Not Allowed");throw e.status=e.errorDetailsCode="403",this.logger.error("[telephonyService] "+e.message),e}if(this.contactService.userContact.phonePro===e||this.contactService.userContact.phoneProCan===e||this.contactService.userContact.phonePbx===e){const e="forwardToDevice failure: impossible to forward its own phone number";throw this.logger.error("[telephonyService] "+e),new Error(e)}if(this.isSipWise())try{const i=await this.contactService.getOrCreateContact(null,e),r=this.getPhoneInfo(i,e);let n="externalNumber";return t="immediate",""!==r.longNumber?(n="externalNumber",e=r.longNumber):(n="internalNumber",e=r.shortNumber),void(await this.telephonyServiceSipWise.forwardToDevice(e,n,t))}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"forwardToDevice");throw this.logger.error("[telephonyService] "+e.message),e.error}try{const i=await this.contactService.getOrCreateContact(null,e),r=this.getPhoneInfo(i,e);t=t||"immediate";const n=this.portalURL+"forward",s=this.authService.getPostHeader(),o={calleeExtNumber:r.longNumber,calleeIntNumber:r.internalNumber,calleeShortNumber:r.shortNumber,calleePbxId:r.pbxId,calleeDisplayName:i.displayName,forwardType:t},a=JSON.stringify(o),c=await fetch(n,{method:"PUT",headers:s,body:a});if(!c.ok)throw c;this.logger.info("[telephonyService] [TEL] forwardToDevice - success")}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"forwardToDevice");throw this.logger.error("[telephonyService] [TEL] "+e.message),e.error}}async forwardToVoicemail(e,t){if(this.logger.info("[telephonyService] [TEL] forwardToVoicemail forwardType :"+e),!this.voiceMailFeatureEnabled||!this.isForwardEnabled){const e=new Error("forwardToVoicemail failure - voicemail/forward feature not enabled");throw this.logger.error("[telephonyService] "+e.message),e}if(e=e||"immediate",this.isSipWise()){const r="voicemail";try{return void(await this.telephonyServiceSipWise.forwardToDevice(this.voicemailNumber,r,e,t))}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"forwardToVoicemail");throw this.logger.error("[telephonyService] "+e.message),e.error}}try{const t=this.portalURL+"forward",i=this.authService.getPostHeader(),r={calleeExtNumber:"",calleeIntNumber:"VOICEMAILBOX",calleePbxId:this.pbxId,forwardType:e},n=JSON.stringify(r),s=await fetch(t,{method:"PUT",headers:i,body:n});if(!s.ok)throw s;this.logger.info("[telephonyService] [TEL] forwardToVoicemail - success")}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"forwardToVoicemail");throw this.logger.error("[telephonyService] [TEL] "+e.message),e.error}}async cancelForward(e){if(this.logger.info("[telephonyService] [TEL] cancelForward"),!this.isForwardEnabled){const e=new Error("cancelForward failure - Not Allowed");throw e.status=e.errorDetailsCode="403",this.logger.error("[telephonyService] "+e.message),e}if(this.isSipWise()){const i="immediate";try{return void(await this.telephonyServiceSipWise.cancelForward(i,e))}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"cancelForward");throw this.logger.error("[telephonyService] "+e.message),e.error}}if(this.contactService.userContact.phonePbx)try{const e=this.portalURL+"forward",t=this.authService.getPostHeader(),i={calleeExtNumber:"",calleeIntNumber:"CANCELFORWARD",calleePbxId:this.pbxId,forwardType:"no_forward"},r=JSON.stringify(i),n=await fetch(e,{method:"PUT",headers:t,body:r});if(!n.ok)throw n;this.logger.info("[telephonyService] [TEL] cancelForward - success")}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"cancelForward");throw this.logger.error("[telephonyService] [TEL] "+e.message),e.error}}async getForwardStatus(){if(!this.isForwardEnabled){const e=new Error("getForwardStatus failure - Not Allowed");throw e.status=e.errorDetailsCode="403",this.logger.error("[telephonyService] "+e.message),e}if(!this.starting&&!this.started)throw new Error("getForwardStatus failure - Telephony not started");if(this.isSipWise())try{return void(await this.telephonyServiceSipWise.getForwardStatus())}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getForwardStatus");throw this.logger.error("[telephonyService] "+t.message),t.error}this.logger.info("[telephonyService] [TEL] getForwardStatus");try{const e=this.portalURL+"forward",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=(await i.json()).data;this.eventService.publish("ON_CALL_FORWARDED_EVENT",{forwardType:r.forwardType,forwardTo:r.forwardTo,pbxForwardType:r.pbxForwardType}),this.forwardObject.forwardType=r.forwardType,this.forwardObject.forwardTo=r.forwardTo,this.forwardObject.pbxForwardType=r.pbxForwardType,this.logger.info("[telephonyService] getForwardStatus - success - forwardType: "+r.forwardType+" forwardTo: "+r.forwardTo+" pbxForwardType: "+r.pbxForwardType)}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getForwardStatus");throw this.logger.error("[telephonyService] "+t.message),t.error}}getForwardObject(){return this.forwardObject}async isOverFlowStatusActivated(){if(this.isSipWise()){return(await this.telephonyServiceSipWise.getOverFlowStatus(this.contactService.userContact.systemId,this.contactService.userContact.phoneNumberId)).activate}return false}async nomadicLogin(e,t=false,i=false){if(!this.isNomadicEnabled||!this.nomadicObject.featureActivated){const e=new Error("nomadicLogin failure - Not Allowed");throw e.status=e.errorDetailsCode="403",this.logger.error("[telephonyService] "+e.message),e}if(this.contactService.userContact.phonePro===e||this.contactService.userContact.phoneProCan===e||this.contactService.userContact.phonePbx===e){const e="nomadicLogin failure: impossible to use its own phone number like nomadic phone",t="nomadicImpossibleUseOwnPhonenumber";throw this.logger.error("[telephonyService] "+e),new Error(t)}this.logger.info("[telephonyService] [TEL] nomadicLogin : "+u.default(e)),i=i||false,t=t||false,this.nomadicAnswerNotTakedIntoAccount=i;try{const i=await this.contactService.getOrCreateContact(null,e),r=this.getPhoneInfo(i,e),n=this.portalURL+"nomadic/login",s={destinationExtNumber:r.longNumber,destinationIntNumber:r.internalNumber,destinationShortNumber:r.shortNumber,destinationRainbowNumber:t?e:"",destinationPbxId:r.pbxId,destinationDisplayName:i.displayName,destinationCountry:i.country},o=JSON.stringify(s),a=this.authService.getPostHeader(),c=await fetch(n,{method:"PUT",headers:a,body:o});if(!c.ok)throw c;this.logger.info("[telephonyService] [TEL] nomadicLogin - success")}catch(r){const e=await this.errorHelperService.getErrorInfo(r,"nomadicLogin");throw this.logger.error("[telephonyService] [TEL] "+e.message),e.error}}async nomadicLoginOnOfficePhone(){if(!this.isNomadicEnabled||!this.nomadicObject.featureActivated){const e=new Error("nomadicLoginOnOfficePhone failure - Not Allowed");throw e.status=e.errorDetailsCode="403",this.logger.error("[telephonyService] "+e.message),e}this.logger.info("[telephonyService] [TEL] nomadicLoginOnOfficePhone");try{const e=this.portalURL+"nomadic/login",t=this.authService.getPostHeader(),i=await fetch(e,{method:"PUT",headers:t});if(!i.ok)throw i;this.logger.info("[telephonyService] [TEL] nomadicLoginOnOfficePhone - success")}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"nomadicLoginOnOfficePhone");throw this.logger.error("[telephonyService] "+t.message),t.error}}async nomadicLogout(){if(!this.isNomadicEnabled||!this.nomadicObject.featureActivated){const e=new Error("nomadicLogout failure - Not Allowed");throw e.status=e.errorDetailsCode="403",this.logger.error("[telephonyService] "+e.message),e}this.logger.info("[telephonyService] [TEL] nomadicLogout");try{const e=this.portalURL+"nomadic/logout",t=this.authService.getPostHeader(),i=await fetch(e,{method:"PUT",headers:t});if(!i.ok)throw i;this.logger.info("[telephonyService] [TEL] nomadicLogout - success")}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"nomadicLogout");throw this.logger.error("[telephonyService] [TEL] "+t.message),t.error}}async getNomadicStatus(){if(this.isSipWise())this.logger.info("[telephonyService] getNomadicStatus -- SipWise bypass Nomadic");else{if(!this.isNomadicEnabled){const e=new Error("getNomadicStatus failure - Not Allowed");throw e.status=e.errorDetailsCode="403",this.logger.error("[telephonyService] "+e.message),e}if(!this.starting&&!this.started)throw new Error("getNomadicStatus failure - Telephony not started");try{const e=this.portalURL+"nomadic",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=(await i.json()).data;this.updateNomadicData(r)}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getNomadicStatus");throw this.logger.error("[telephonyService] "+t.message),t.error}}}async setNomadicState(){this.logger.info("[telephonyService] [TEL] setNomadicState");try{const e=this.portalURL+"nomadic/state",t={makeCallInitiatorIsMain:"true"},i=JSON.stringify(t),r=this.authService.getPostHeader(),n=await fetch(e,{method:"PUT",headers:r,body:i});if(!n.ok)throw n;this.logger.info("[telephonyService] [TEL] setNomadicState - success")}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"setNomadicState");throw this.logger.error("[telephonyService] "+t.message),t.error}}async updateNomadicData(e){const t=e.destination?u.default(e.destination):"";this.logger.info("[telephonyService] [TEL] updateNomadicData destination: "+t+" featureActivated: "+e.featureActivated+" makeCallInitiatorIsMain: "+e.makeCallInitiatorIsMain+" modeActivated: "+e.modeActivated+" monodevice: "+this.contactService.userContact.isVirtualTerm+" NomadicInitialized: "+e.nomadicModeInitialized+" otherPhoneModeDenied:"+e.otherPhoneModeDenied);const i=JSON.parse(JSON.stringify(this.nomadicObject));this.nomadicObject.featureActivated="true"===e.featureActivated,this.nomadicObject.modeActivated="true"===e.modeActivated,this.nomadicObject.destination=e.destination,this.nomadicObject.makeCallInitiatorIsMain="true"===e.makeCallInitiatorIsMain,this.nomadicObject.otherPhoneModeDenied="true"===e.otherPhoneModeDenied,void 0===e.nomadicModeInitialized?this.nomadicObject.nomadicModeInitialized=true:this.nomadicObject.nomadicModeInitialized="true"===e.nomadicModeInitialized;const r=i.makeCallInitiatorIsMain!==this.nomadicObject.makeCallInitiatorIsMain;if(this.nomadicAnswerNotTakedIntoAccount||this.eventService.publish("ON_CALL_NOMADIC_EVENT",this.nomadicObject),this.nomadicAnswerNotTakedIntoAccount=false,!this.nomadicObject.featureActivated||this.nomadicObject.nomadicModeInitialized||""!==this.nomadicObject.destination&&void 0!==this.nomadicObject.destination||!this.isMediaPillarConfigured())if(this.contactService.userContact.isVirtualTerm||!this.nomadicObject.featureActivated||this.nomadicObject.nomadicModeInitialized||""!==this.nomadicObject.destination&&void 0!==this.nomadicObject.destination||!this.contactService.userContact.mobileProCan&&!this.contactService.userContact.mobilePerso)if(!this.contactService.userContact.isVirtualTerm||!this.nomadicObject.featureActivated||this.nomadicObject.nomadicModeInitialized||""!==this.nomadicObject.destination&&void 0!==this.nomadicObject.destination||!this.contactService.userContact.mobileProCan&&!this.contactService.userContact.mobilePerso){if(this.contactService.userContact.isVirtualTerm&&this.nomadicObject.featureActivated&&!this.nomadicObject.makeCallInitiatorIsMain&&!this.nomadicObject.modeActivated&&this.isMediaPillarConfigured()){const e=this.getMyMediaPillarRemoteExtension();this.nomadicLogin(e)}}else{const e=this.contactService.userContact.mobileProCan?this.contactService.userContact.mobileProCan:this.contactService.userContact.mobilePerso;this.nomadicLogin(e)}else{const e=this.contactService.userContact.mobileProCan?this.contactService.userContact.mobileProCan:this.contactService.userContact.mobilePerso;(async()=>{await this.nomadicLogin(e,false,true),this.nomadicLoginOnOfficePhone()})()}else{const e=this.getMyMediaPillarRemoteExtension();this.nomadicLogin(e)}return r}getNomadicObject(){return this.nomadicObject}getNomadicDestination(){return this.nomadicObject.destination}isMediaPillarConfigured(){return this.mediaPillarConfigured&&this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_WEBRTC_PSTN_CALLING)}getMyMediaPillarRemoteExtension(){if(!this.isSipWise())return this.mediaPillarRemoteExtension;const e=this.telephonyServiceSipWise.getDeviceIdWithType("webrtc");return e||""}isMediaPillarAvailable(){return this.isMediaPillarConfigured()&&this.mediaPillarAlive}isMediaPillarUserSelected(){let e;if(this.isSipWise()){const t=this.telephonyServiceSipWise.getCurrentDevice();e=t&&"webrtc"===t.type}else e=!this.nomadicObject.makeCallInitiatorIsMain&&this.getNomadicDestination()===this.getMyMediaPillarRemoteExtension();return e}async sendDtmf(e,t){if(e&&t){if(this.logger.info("[telephonyService] [TEL] sendDtmf for call "+e.id),this.isSipWise())return void(await this.telephonyServiceSipWise.sendDtmf(e,t));try{const i=this.portalURL+"calls/"+encodeURIComponent(e.connectionId)+"/dtmf",r={dtmf:t},n=JSON.stringify(r),s=this.authService.getPostHeader(),o=await fetch(i,{method:"PUT",headers:s,body:n});if(!o.ok)throw o;this.logger.info("[telephonyService] [TEL] sendDtmf - success");return(await o.json()).data}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"sendDtmf");throw this.logger.error("[telephonyService] [TEL] "+e.message),e.error}}}clearCall(e,t=false){if(e)this.logger.info("[telephonyService] clearCall for call id: "+e.id),e.setStatus(n.Call.Status.UNKNOWN),t||(e.publish("ON_CALL_UPDATED_EVENT"),this.eventService.publish("ON_CALL_UPDATED_EVENT",e)),e.contact&&delete this.calls[e.contact.id],e.getCurrentCalled()&&e.setCurrentCalled(null);else{const e="clearCall failure : call null";this.logger.error("[telephonyService]"+e)}}startAsPhoneNumber(e){const t=e.trim().split(".").join("");if(t.length<1)return false;const i=t.match(/^(\+|\d|#|\*|\(|\)|\.|-|||\s|\/)*$/);return!!i&&i[0]===t}updateContactFromOutlookInfos(e,t,i,r){this.logger.info("[telephonyService] default updateContactFromOutlookInfos")}isSipWiseRoot(){return this.contactService.userContact&&this.contactService.userContact.systDeviceName===b.SIPWISE_RVCP}setSipWise(e){this.sipWise=e}isSipWise(){return this.sipWise}isSipWiseEmulatedRingBackTone(){let e=false;const t=this.telephonyServiceSipWise.getSettings();return t&&(e=Boolean(t.emulatedRingBackTone)),e}getSipWiseRoutingInfo(){this.logger.info("[telephonyService] getSipWiseRoutingInfo"),this.isSipWise()?this.telephonyServiceSipWise.getUserRoutingInfo():this.logger.info("[telephonyService] getSipWiseRoutingInfo Anomaly not a sipWise situation")}setSipWiseCurrentDevice(e){this.isSipWise()?this.telephonyServiceSipWise.putUserRoutingInfo(e,null):this.logger.info("[telephonyService] setSipWiseCurrentDevice Anomaly not a sipWise situation")}async getSipWiseCurrentCli(e=false){if(!this.isSipWiseRoot())throw this.logger.info("[telephonyService] getSipWiseCurrentCli Anomaly not a sipWise situation"),new Error("Anomaly not a sipWise situation");if(false===Boolean(this.currentCli)||e)try{this.currentCli=await this.telephonyServiceSipWise.getCliOptionsCurrent()}catch(t){throw this.logger.error("[telephonyService] getSipWiseCurrentCli - error retrieving option"),this.currentCli=null,t}return this.currentCli}async getSipWiseAllCli(e=false){if(!this.isSipWiseRoot())throw this.logger.info("[telephonyService] getSipWiseAllCli Anomaly not a sipWise situation"),new Error("Anomaly not a sipWise situation");if(0===this.cliOptions.length||e)try{this.cliOptions=await this.telephonyServiceSipWise.getCliOptionsAll(),this.currentCli=this.cliOptions.find((e=>true===e.current))}catch(t){throw this.logger.error("[telephonyService] getSipWiseAllCli - error retrieving options, empty the list"),this.cliOptions=[],t}return this.cliOptions}async getSipWiseCurrentCliIfEditable(){if(!this.isSipWiseRoot())throw this.logger.info("[telephonyService] getSipWiseCurrentCliIfEditable Anomaly not a sipWise situation"),new Error("Anomaly not a sipWise situation");const e=await this.getSipWiseAllCli();return e&&e.length>1?this.currentCli:null}async setSipWiseCliOption(e){if(!this.isSipWiseRoot())throw this.logger.info("[telephonyService] setSipWiseCliOption Anomaly not a sipWise situation"),new Error("Anomaly not a sipWise situation");return await this.telephonyServiceSipWise.setCliOption(e)}async getSipWiseClir(){if(!this.isSipWiseRoot())throw this.logger.info("[telephonyService] getSipWiseClir Anomaly not a sipWise situation"),new Error("Anomaly not a sipWise situation");return await this.telephonyServiceSipWise.getClirOption()}async setSipWiseClirOption(e){if(!this.isSipWiseRoot())throw this.logger.info("[telephonyService] setSipWiseClirOption Anomaly not a sipWise situation"),new Error("Anomaly not a sipWise situation");await this.telephonyServiceSipWise.setClirOption(e)}isMonolineIncomingModeActivated(){return this.telephonyServiceSipWise.isMonolineIncomingModeActivated()}sipWiseUserGroupsDataClear(){this.sipWiseUserGroupsData.myMemberId="",this.sipWiseUserGroupsData.managerAssistGrId=0,this.sipWiseUserGroupsData.managerId=0,this.sipWiseUserGroupsData.managerName="",this.sipWiseUserGroupsData.managerStatus="",this.sipWiseUserGroupsData.managerForward="unknow",this.sipWiseUserGroupsData.assistantId=0,this.sipWiseUserGroupsData.assistantName="",this.sipWiseUserGroupsData.assistantStatus="",this.sipWiseUserGroupsData.isSomeMngAssistAsHG=false,this.sipWiseUserGroupsData.huntingGroupNb=0,this.sipWiseUserGroupsData.managerAssistantNb=0,this.sipWiseUserGroupsData.managerAssistantMyAssistList=[],this.sipWiseUserGroupsData.managerAssistantMyMngList=[],this.sipWiseUserGroupsData.sipWiseUserGroupsList=[]}sipWiseGetFormerManagerAssistGrId(){return this.sipWiseUserGroupsData.managerAssistGrId}sipWiseUserGroupsDataIsManagerAssistant(){return!!(this.isSipWise()&&this.sipWiseUserGroupsData.managerAssistantNb>0)&&(1===this.sipWiseUserGroupsData.managerAssistantNb||(this.logger.info("[telephonyService] sipWiseUserGroupsDataIsManagerAssistant Anomaly not 1:1 Manager/Assistant"),false))}sipWiseManAssistGetMyRole(){let e="";if(this.isSipWise()&&this.sipWiseUserGroupsData.managerAssistantNb>0){const t=this.sipWiseUserGroupsData.sipWiseUserGroupsList.find((e=>"manager_assistant"===e.type));if(t){const i=t.members.find((e=>e.memberId===this.contactService.userContact.dbId));i&&(e=i.roles[0])}}return e}sipWiseManAssistIamManagerForwarded(){let e="unknown",t=false;return this.isSipWise()&&this.sipWiseUserGroupsData.managerAssistantNb>=1&&"manager"===this.sipWiseManAssistGetMyRole()&&(e=this.sipWiseUserGroupsData.managerForward),"activated"===e&&(t=true),t}getSipWiseUserGroupsData(){return this.sipWiseUserGroupsData}async getSipWiseUserGroups(){if(this.logger.info("[telephonyService] getSipWiseUserGroups"),this.isSipWise())try{await this.telephonyServiceSipWise.getUserGroups(),await this.telephonyServiceSipWise.getAllUserGroupsForwards(),this.eventService.publish("ON_TEL_USER_GROUPS_EVENT",this.sipWiseUserGroupsData)}catch(e){this.logger.info("[telephonyService] sipwise getSipWiseUserGroups CATCH");const t="sipwise getUserGroups -- "+e.message;throw this.logger.error("[telephonyService] "+t),e}else{const e="sipwise getUserGroups -- not a sipWise situation";this.logger.error("[telephonyService] "+e)}}async setSipWiseJoinGroup(e){if(this.logger.info("[telephonyService] [TEL] setSipWiseJoinGroup"),this.isSipWise())if(e)try{await this.telephonyServiceSipWise.joinGroup(e)}catch(t){this.logger.info("[telephonyService] sipwise joinGroup CATCH");const e="sipwise join Group -- "+t.message;throw this.logger.error("[telephonyService] "+e),t}else{const e="sipwise join Group -- groupId anomaly";this.logger.error("[telephonyService] "+e)}else{const e="sipwise join Group -- not a sipWise situation";this.logger.error("[telephonyService] "+e)}}async setSipWiseLeaveGroup(e){if(this.logger.info("[telephonyService] [TEL] setSipWiseLeaveGroup"),this.isSipWise())if(e)try{await this.telephonyServiceSipWise.leaveGroup(e)}catch(t){this.eventService.publish("ON_TEL_USER_GROUPS_EVENT",this.sipWiseUserGroupsData),this.logger.info("[telephonyService] sipwise leaveGroup CATCH");const e="sipwise leave Group -- "+(t.data?t.data.errorDetails:"");throw this.logger.error("[telephonyService] "+e),t}else{const e="sipwise leave Group -- groupId anomaly";this.logger.error("[telephonyService] "+e)}else{const e="sipwise leave Group -- not a sipWise situation";this.logger.error("[telephonyService] "+e)}}async setSipWiseJoinAllGroups(){if(this.logger.info("[telephonyService] [TEL] setSipWiseJoinAllGroups"),this.isSipWise())try{await this.telephonyServiceSipWise.joinAllGroups()}catch(e){this.logger.info("[telephonyService] setSipWiseJoinAllGroups CATCH");const t="sipwise joinAllGroups -- "+e.message;throw this.logger.error("[telephonyService] "+t),e}else{const e="sipwise joinAllGroups -- not a sipWise situation";this.logger.error("[telephonyService] "+e)}}async setSipWiseLeaveAllGroups(){if(this.logger.info("[telephonyService] [TEL] setSipWiseLeaveAllGroups"),this.isSipWise())try{return await this.telephonyServiceSipWise.leaveAllGroups()}catch(e){this.logger.info("[telephonyService] setSipWiseLeaveAllGroups CATCH");const t="sipwise leaveAllGroups -- "+e.message;throw this.logger.error("[telephonyService] "+t),e}else{const e="sipwise leaveAllGroups -- not a sipWise situation";this.logger.error("[telephonyService] "+e)}}async getSipWiseUserGroupsForwards(e){if(this.logger.info("[telephonyService] [TEL] getSipWiseUserGroupsForwards"),this.isSipWise())try{await this.telephonyServiceSipWise.getUserGroupForwards(e),this.eventService.publish("ON_TEL_USER_GROUPS_EVENT",this.sipWiseUserGroupsData)}catch(t){this.logger.info("[telephonyService] sipwise getSipWiseUserGroupsForwards CATCH");const e="sipwise getUserGroupsForwards -- "+t.message;throw this.logger.error("[telephonyService] "+e),t}else{const e="sipwise getUserGroupsForward -- not a sipWise situation";this.logger.error("[telephonyService] "+e)}}async setSipWiseUserGroupsForwards(e,t,i){if(this.logger.info("[telephonyService] [TEL] setSipWiseUserGroupsForwards"),this.isSipWise())try{await this.telephonyServiceSipWise.setUserGroupForward(e,t,i)}catch(r){this.logger.info("[telephonyService] setSipWiseUserGroupsForwards CATCH");const e="sipwise setSipWiseUserGroupsForwards -- "+r.message;throw this.logger.error("[telephonyService] "+e),r}else{const e="sipwise setSipWiseUserGroupsForwards -- not a sipWise situation";this.logger.error("[telephonyService] "+e)}}sipWiseManAssistActivate(e,t){let i,r=true;if(this.logger.info("[telephonyService] [TEL] sipWiseManAssistActivate  Activ : "+e+" groupName : "+t),0===this.sipWiseUserGroupsData.managerAssistantNb){const e="sipwise sipWiseManAssistActivate -- no Manager Assistant group available";return void this.logger.error("[telephonyService] "+e)}if(t||(t=""),this.sipWiseUserGroupsData.sipWiseUserGroupsList.forEach((e=>{r&&"manager_assistant"===e.type&&(t!==e.name&&""!==t||(i=e.id,r=false))})),r)return;const n={destinationType:"managersecretary",activate:e};this.setSipWiseUserGroupsForwards(i,"immediate",n)}async sipWiseManAssistAsHGJoinLeave(e="",t,i){if(this.logger.info("[telephonyService] [TEL] sipWiseManAssistAsHGJoinLeave  Activ : "+e+" groupId: "+t+" leaderId: "+i),this.isSipWise())if(this.sipWiseUserGroupsData.isSomeMngAssistAsHG)if("join"===e||"leave"===e){if(t){if(!this.sipWiseUserGroupsData.sipWiseUserGroupsList.find((e=>"hunting_group"===e.type&&"manager_assistant"===e.subType&&e.id===t))){const e="sipwise sipWiseManAssistAsHGJoinLeave -- invalid groupId";return void this.logger.error("[telephonyService] "+e)}}if(i){if(!this.sipWiseUserGroupsData.sipWiseUserGroupsList.find((e=>"hunting_group"===e.type&&"manager_assistant"===e.subType&&e.members[0].memberId===i))){const e="sipwise sipWiseManAssistAsHGJoinLeave -- invalid leaderId";return void this.logger.error("[telephonyService] "+e)}}if(t)if("join"===e)try{await this.telephonyServiceSipWise.joinGroup(t,i)}catch(r){this.logger.info("[telephonyService] sipWiseManAssistAsHGJoinLeave CATCH");const e="sipwise joinGroup -- "+r.message;throw this.logger.error("[telephonyService] "+e),r}else try{await this.telephonyServiceSipWise.leaveGroup(t,i)}catch(r){this.logger.info("[telephonyService] sipWiseManAssistAsHGJoinLeave CATCH");const e="sipwise leaveGroup -- "+r.message;throw this.logger.error("[telephonyService] "+e),r}else if("join"===e)try{await this.telephonyServiceSipWise.joinAllGroups("manager_assistant")}catch(r){this.logger.info("[telephonyService] setSipWiseJoinAllGroups CATCH");const e="sipwise joinAllGroups -- "+r.message;throw this.logger.error("[telephonyService] "+e),r}else try{await this.telephonyServiceSipWise.leaveAllGroups("manager_assistant")}catch(r){this.logger.info("[telephonyService] setSipWiseLeaveAllGroups CATCH");const e="sipwise leaveAllGroups -- "+r.message;throw this.logger.error("[telephonyService] "+e),r}}else{const e="sipwise sipWiseManAssistAsHGJoinLeave -- invalid action";this.logger.error("[telephonyService] "+e)}else{const e="sipwise sipWiseManAssistAsHGJoinLeave -- no Manager Assistant group available";this.logger.error("[telephonyService] "+e)}else{const e="sipWiseManAssistAsHGJoinLeave -- not a sipWise situation";this.logger.error("[telephonyService] "+e)}}sipWiseUserGroupsDataIsMngAssistAsHG(){return this.sipWiseUserGroupsData.isSomeMngAssistAsHG}async onUpdateHuntingGroupsData(){try{await this.getSipWiseUserGroups()}catch(e){this.logger.info("[telephonyService] onUpdateHuntingGroupsData CATCH");const t="onUpdateHuntingGroupsData -- "+e.message;throw this.logger.error("[telephonyService] "+t),e}}oxoMultiCallMode(){if(!this.isOxo)return false;let e=false;e=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_OXO_MULTICALL),e=e&&this.agentStatus.featureOXOMULTICALL;const t=this.settingsService.getSetting("sipWiseMode");return e=e||"RQ6394"===t,e}sipWiseMode(){let e=this.settingsService.getSetting("sipWiseMode");return this.sipWise||(e="false"),e}async resetAllSipWiseCall(){if(this.isSipWise()){const t=$iq({type:"set",to:this.userJidTel+"/pcg2"}).c("telephony",{xmlns:"urn:xmpp:pbxagent:telephony:1"}).c("service").c("deleteCalls",{forced:"true"});try{const e=await this.xmppService.sendIQ(t,6e4);this.logger.error("[telephonyService] resetAllSipWiseCall : try to reset all ghost calls !"+e)}catch(e){const t="resetAllSipWiseCall failure : "+e.message;this.logger.error("[telephonyService]"+t)}}}async oxopbxsUpdateIndividualPassword(e){try{const t="${config.restServerUrl}/api/rainbow/oxopbxprovisioning/v1.0/oxopbxs/"+this.contactService.userContact.systemId+"/subscribers/"+this.contactService.userContact.dbId+"/password",i={password:e},r=JSON.stringify(i),n=this.authService.getPostHeader(),s=await fetch(t,{method:"PUT",headers:n,body:r});if(!s.ok)throw s;this.logger.info("[telephonyService] oxopbxsUpdateIndividualPassword : success");return(await s.json()).data}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"oxopbxsUpdateIndividualPassword");throw this.logger.error("[telephonyService] "+e.message),e.error}}setPgiCallObject(e,t,i,r){this.currentPgiObject={numberCalled:e,dtmfToSend:t,roomJid:i,callId:r}}onMediaPillarConfigChanged(e,t,i){this.mediaPillarConfigured=t,this.mediaPillarRemoteExtension=i,this.logger.info("[telephonyService] onMediaPillarConfigChanged isConfigured: "+t+" remoteExtension: "+i)}onMediaPillarStateChanged(e,t){this.mediaPillarAlive=t,this.logger.info("[telephonyService] onMediaPillarStateChanged alive: "+t)}getCapabilitiesForCall(e,t=null){if(!e)return{};const i={makeCall:false,answer:false,drop:false,hold:false,retrieve:false,transfer:false,conference:false,deflect:false,blindTransfer:false,adhocConference:false},r=this.getOngoingOutgoingCall();switch(e.status){case n.Call.Status.RINGING_INCOMMING:i.answer=true,i.drop=true,i.makeCall=this.isSecondCallAllowed&&!r,i.deflect=true;break;case n.Call.Status.QUEUED_INCOMMING:i.answer=this.isSecondCallAllowed,i.drop=true,i.makeCall=this.isSecondCallAllowed&&!r,i.deflect=true;break;case n.Call.Status.DIALING:case n.Call.Status.QUEUED_OUTGOING:case n.Call.Status.RINGING_OUTGOING:i.drop=true;break;case n.Call.Status.ACTIVE:{const r=this.activeConversation?this.activeConversation.audioCall:null;i.drop=true,i.hold=!e.isConference,i.makeCall=this.isSecondCallAllowed&&!e.isConference&&(!t||e.contact.jid!==t.jid),i.blindTransfer=this.isSipWise()&&this.isTransferAllowed&&(!t||e.contact.jid!==t.jid),i.adhocConference=this.isSipWise()&&this.isAdhocConferenceAllowed&&!(this.contactService.userContact&&this.contactService.userContact.attendantConsoleEnabled),i.transfer=this.isTransferAllowed&&r&&r.status===n.Call.Status.HOLD;break}case n.Call.Status.HOLD:{const e=this.activeConversation?this.activeConversation.audioCall:null;i.retrieve=this.isSecondCallAllowed&&!r,i.makeCall=this.isSecondCallAllowed&&!r,i.transfer=this.isTransferAllowed&&e&&(e.status===n.Call.Status.ACTIVE||e.status===n.Call.Status.RINGING_OUTGOING&&!this.isSipWise()),i.conference=this.isConferenceAllowed&&e&&e.status===n.Call.Status.ACTIVE&&!this.isSipWise();break}case n.Call.Status.PUT_ON_HOLD:i.drop=true,i.makeCall=this.isSecondCallAllowed&&!r;break;case n.Call.Status.ERROR:i.drop=true}return this.logger.info("[telephonyService] TelCapabilities getCapabilitiesForCall call: "+e+" => "+JSON.stringify(i)),i}getCapabilitiesForContact(e){if(!e)return;if(this.contactService.userContact&&e.jid===this.contactService.userContact.jid)return this.getCapabilitiesForMyContact();const t={makeCall:false,answer:false,drop:false,hold:false,retrieve:false,transfer:false,conference:false,deflect:false,blindTransfer:false,adhocConference:false},i=this.getCallsForContact(e);return 1===i.length?this.getCapabilitiesForCall(i[0],e):0===i.length?this.getCapabilitiesForMyContact():(this.logger.info("[telephonyService] TelCapabilities getCapabilitiesForContact contact: "+e+" => "+JSON.stringify(t)),t)}getCapabilitiesForMyContact(){const e={makeCall:false,deflect:false,blindTransfer:false};e.makeCall=!this.getOngoingOutgoingCall();const t=this.activeConversation?this.activeConversation.audioCall:null;switch(t?t.status:null){case n.Call.Status.RINGING_INCOMMING:case n.Call.Status.QUEUED_INCOMMING:e.deflect=!t.sipWiseData||"distributed"!==t.sipWiseData.initCause;break;case n.Call.Status.ACTIVE:e.blindTransfer=true}return this.logger.info("[telephonyService] TelCapabilities getCapabilitiesForMyContact => "+JSON.stringify(e)),e}notifyTelCapabilitiesChange(e){if(e&&e.contact){const t=this.getCapabilitiesForCall(e);!this.telCapabilitiesEquals(t,e.contact.telCapabilities)?(this.logger.info("[telephonyService] TelCapabilities Notify for jid: "+e.contact.jid+" => "+JSON.stringify(t)),e.contact.telCapabilities=t):this.logger.debug("[telephonyService] TelCapabilities nothing to notify for jid: "+e.contact.jid)}const t=this.getCapabilitiesForMyContact();!this.telCapabilitiesEquals(t,this.contactService.userContact.telCapabilities)?(this.logger.info("[telephonyService] TelCapabilities Notify for my jid => "+JSON.stringify(t)),this.contactService.userContact.telCapabilities=t):this.logger.debug("[telephonyService] TelCapabilities nothing to notify for my jid")}telCapabilitiesEquals(e,t){if(null==e||null==t)return e===t;const i=Object.keys(e);return Object.keys(t).every((e=>-1!==i.indexOf(e)))&&i.every((i=>e[i]===t[i]))}onActiveConversationChange(e,t){this.contactService.userContact&&(this.contactService.userContact.attendantConsoleEnabled||this.contactService.userContact.supervisorConsoleEnabled)&&(this.logger.info("[telephonyService] TelCapabilities onActiveConversationChange conv: "+(t?t.id:"null")),this.activeConversation=t,this.notifyTelCapabilitiesChange(null))}onCallUpdated(e,t){this.contactService.userContact&&(this.contactService.userContact.attendantConsoleEnabled||this.contactService.userContact.supervisorConsoleEnabled)&&t&&t.type===n.Call.Type.PHONE&&(this.logger.info("[telephonyService] TelCapabilities onCallUpdated call: "+t),this.notifyTelCapabilitiesChange(t))}async putActiveTelephonyCallOnHold(){if(this.isMixPstnWebRtcAllowed&&this.isMediaPillarAvailable()&&this.isMediaPillarUserSelected())try{const e=this.getActiveCall();e&&(this.logger.info("[telephonyService] putActiveTelephonyCallOnHold "+e),await this.holdCall(e))}catch(e){this.logger.info("[telephonyService] putActiveTelephonyCallOnHold error -- "+e)}}}b.SIPWISE_RVCP="RVCP Subscriber",t.TelephonyService=b},function(e,t,i){i.d(t,"a",(function(){return s}));var r=i(64),n=i(114);function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Object(n.a)()(r.a.apply(void 0,e))}},function(e,t,i){var r=i(124),n=i(60),s=i(35),o=i(40),a=i(125),c=i(126),l=i(88);i.d(t,"a",(function(){return d}));var d=function(e){if(e&&"function"==typeof e[o.a])return d=e,function(e){var t=d[o.a]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if(Object(a.a)(e))return Object(r.a)(e);if(Object(c.a)(e))return i=e,function(e){return i.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,n.a),e};if(e&&"function"==typeof e[s.a])return t=e,function(e){for(var i=t[s.a]();;){var r=void 0;try{r=i.next()}catch(dp){return e.error(dp),e}if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof i.return&&e.add((function(){i.return&&i.return()})),e};var t,i,d,u=Object(l.a)(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+u+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")}},function(e,t,i){function r(e){setTimeout((function(){throw e}),0)}i.d(t,"a",(function(){return r}))},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.UUID=t.SizeAndUnit=t.PaddingDefinition=t.SpacingDefinition=t.StringWithSubstitutions=t.ContentTypes=t.GlobalSettings=void 0;var r=i(55),n=function(){function e(){}return e.useAdvancedTextBlockTruncation=true,e.useAdvancedCardBottomTruncation=false,e.useMarkdownInRadioButtonAndCheckbox=true,e.allowMarkForTextHighlighting=false,e.alwaysBleedSeparators=false,e.enableFullJsonRoundTrip=false,e.displayInputValidationErrors=true,e.allowPreProcessingPropertyValues=false,e.setTabIndexAtCardRoot=true,e.enableFallback=true,e.useWebkitLineClamp=true,e.allowMoreThanMaxActionsInOverflowMenu=false,e.applets={logEnabled:true,logLevel:r.LogLevel.Error,maximumRetryAttempts:3,defaultTimeBetweenRetryAttempts:3e3,authPromptWidth:400,authPromptHeight:600,refresh:{mode:r.RefreshMode.Manual,timeBetweenAutomaticRefreshes:3e3,maximumConsecutiveAutomaticRefreshes:3,allowManualRefreshesAfterAutomaticRefreshes:true}},e}();t.GlobalSettings=n,t.ContentTypes={applicationJson:"application/json",applicationXWwwFormUrlencoded:"application/x-www-form-urlencoded"};var s=function(){function e(){this._isProcessed=false}return e.prototype.getReferencedInputs=function(e,t){if(!t)throw new Error("The referencedInputs parameter cannot be null.");for(var i=0,r=e;i<r.length;i++){var n=r[i];null!=new RegExp("\\{{2}("+n.id+").value\\}{2}","gi").exec(this._original)&&n.id&&(t[n.id]=n)}},e.prototype.substituteInputValues=function(e,i){if(this._processed=this._original,this._original)for(var r=/\{{2}([a-z0-9_$@]+).value\}{2}/gi,n=void 0;null!==(n=r.exec(this._original));)for(var s=0,o=Object.keys(e);s<o.length;s++){var a=o[s];if(a.toLowerCase()==n[1].toLowerCase()){var c=e[a],l="";c.value&&(l=c.value),i===t.ContentTypes.applicationJson?l=(l=JSON.stringify(l)).slice(1,-1):i===t.ContentTypes.applicationXWwwFormUrlencoded&&(l=encodeURIComponent(l)),this._processed=this._processed.replace(n[0],l);break}}this._isProcessed=true},e.prototype.getOriginal=function(){return this._original},e.prototype.get=function(){return this._isProcessed?this._processed:this._original},e.prototype.set=function(e){this._original=e,this._isProcessed=false},e}();t.StringWithSubstitutions=s;var o=function(e,t,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),this.left=0,this.top=0,this.right=0,this.bottom=0,this.top=e,this.right=t,this.bottom=i,this.left=r};t.SpacingDefinition=o;var a=function(e,t,i,n){void 0===e&&(e=r.Spacing.None),void 0===t&&(t=r.Spacing.None),void 0===i&&(i=r.Spacing.None),void 0===n&&(n=r.Spacing.None),this.top=r.Spacing.None,this.right=r.Spacing.None,this.bottom=r.Spacing.None,this.left=r.Spacing.None,this.top=e,this.right=t,this.bottom=i,this.left=n};t.PaddingDefinition=a;var c=function(){function e(e,t){this.physicalSize=e,this.unit=t}return e.parse=function(t,i){void 0===i&&(i=false);var n=new e(0,r.SizeUnit.Weight);if("number"==typeof t)return n.physicalSize=t,n;if("string"==typeof t){var s=/^([0-9]+)(px|\*)?$/g.exec(t),o=i?3:2;if(s&&s.length>=o)return n.physicalSize=parseInt(s[1]),3==s.length&&"px"==s[2]&&(n.unit=r.SizeUnit.Pixel),n}throw new Error("Invalid size: "+t)},e}();t.SizeAndUnit=c;
/**
     * Fast UUID generator, RFC4122 version 4 compliant.
     * @author Jeff Ward (jcward.com).
     * @license MIT license
     * @link http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/21963136#21963136
     **/var l=function(){function e(){}return e.generate=function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return e.lut[255&t]+e.lut[t>>8&255]+e.lut[t>>16&255]+e.lut[t>>24&255]+"-"+e.lut[255&i]+e.lut[i>>8&255]+"-"+e.lut[i>>16&15|64]+e.lut[i>>24&255]+"-"+e.lut[63&r|128]+e.lut[r>>8&255]+"-"+e.lut[r>>16&255]+e.lut[r>>24&255]+e.lut[255&n]+e.lut[n>>8&255]+e.lut[n>>16&255]+e.lut[n>>24&255]},e.initialize=function(){for(var t=0;t<256;t++)e.lut[t]=(t<16?"0":"")+t.toString(16)},e.lut=[],e}();t.UUID=l,l.initialize()},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(28),n=i(66),s=i(18),o=i(104),a=i(95),c=i(107),l=i(76),d=i(107),u=i(17),h=i(8),f=i(9),p=i(14),g=i(6),m=i(4),v=i(30),S=i(11),b=i(46),y=i(13),C=i(37),w=i(47),_=i(70),E=i(119),T=i(57),I=i(164),P=i(451),A=i(311),M=i(7);class D{constructor(){this.activeConversation=null,this.searchTextConvResults=new c.SearchTextConvResults,this.conversationServiceBulkHistoryHandler=null,this.missedInfoCounters=new M.BehaviorSubject(a.ConversationMissedInfoCounters.create()),this.isReinit=false,this.pendingMessages={},this.conversations=[],this.conversationCreationPromise={},this.inCallConversations=[],this.idleConversations=[],this.involvedContactIds=[],this.rxSubject=new M.Subject,this.isBasicCallAllowed=false,this.isSecondCallAllowed=false,this.isSecondWebrtcCallAllowed=false,this.manageTwoWebrtcCallsAllowed=false,this.subscriptions=[],this.eventServiceSubscriptionHandlers=[],this.xmppSubscriptionHandlers=[],this.conversationServiceEventHandler=null,this.conversationHistoryHandler=null,this.webConferenceService=null,this.mainService=u.MainService.getInstance(),this.eventService=S.EventService.getInstance(),this.authService=h.AuthService.getInstance(),this.xmppService=f.XmppService.getInstance(),this.i18n=b.I18nService.getInstance(),this.logger=m.LoggerService.getInstance(),this.profileService=p.ProfileService.getInstance(),this.contactService=g.ContactService.getInstance(),this.errorHelperService=y.ErrorHelperService.getInstance(),this.fileStorageService=C.FileStorageService.getInstance(),this.roomService=v.RoomService.getInstance(),this.telephonyService=T.TelephonyService.getInstance(),this.fileServerService=w.FileServerService.getInstance(),this.webrtcGatewayService=_.WebrtcGatewayService.getInstance(),this.botService=E.BotService.getInstance(),this.favoriteService=null}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.conversationService||(e.rainbow.conversationService=new D),e.rainbow.conversationService}async start(e){try{this.logger.info(""),this.logger.info("[conversationService] === STARTING ==="),this.webConferenceService=e,this.pgiConferenceService=this.mainService.inject("pgiConferenceService"),this.webConferenceServiceV2=this.mainService.inject("webConferenceServiceV2"),this.webrtcP2PService=this.mainService.inject("webrtcP2PService"),this.isBasicCallAllowed=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_BASIC_CALL),this.isSecondCallAllowed=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_SECOND_CALL),this.isSecondWebrtcCallAllowed=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.MIX_WEBRTC_PSTN_CALLS)||config.mixwebrtcpstn,this.manageTwoWebrtcCallsAllowed=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.WEBRTC_MANAGE_TWO_CALLS)||config.mixwebrtcpstn,this.attachHandlers(),await this.getServerConversations(),this.linkAllActiveCallsToConversations(),this.cleanUnwantedConversations(),this.pgiConferenceService&&this.subscriptions.push(this.pgiConferenceService.conferenceSessionsSubject.subscribe((e=>{e.id===this.pgiConferenceService.getPstnInstantConferenceEndpointId()&&"created"===e.action&&this.pgiConferenceService.subscribeToMyConferenceSessions((e=>{this.onPGiConferenceStateEvent(e)}))}))),this.logger.info("[conversationService] === STARTED ==="),this.eventServiceSubscriptionHandlers.forEach((e=>{e()})),this.eventServiceSubscriptionHandlers=[],this.eventServiceSubscriptionHandlers.push(this.eventService.subscribe("ON_CONTACT_UPDATED_EVENT",((e,t)=>{this.onContactChangedEvent(t)}))),this.eventServiceSubscriptionHandlers.push(this.eventService.subscribe(this.roomService.ROOM_UPDATE_EVENT,((e,t,i)=>{this.onRoomChangedEvent(t,i)}))),this.eventServiceSubscriptionHandlers.push(this.eventService.subscribe(this.roomService.ROOM_ADD_CONF_ENDPOINT_EVENT,(()=>{this.onRoomAddConferenceEvent()}))),this.eventServiceSubscriptionHandlers.push(this.eventService.subscribe(this.roomService.ROOM_HISTORY_UPDATE_EVENT,((e,t)=>{this.onRoomHistoryChangedEvent(t)}))),this.eventServiceSubscriptionHandlers.push(this.eventService.subscribe("ON_CALL_UPDATED_EVENT",((e,t)=>{this.onCallEvent(t)}))),this.eventServiceSubscriptionHandlers.push(this.eventService.subscribe("ON_WEBRTC_GW_CALL_UPDATED_EVENT",((e,t)=>{this.onCallEvent(t,true)}))),this.eventServiceSubscriptionHandlers.push(this.eventService.subscribe("ON_CONVERSATIONS_UPDATED_EVENT",(()=>{this.onConversationEvent()}))),this.eventServiceSubscriptionHandlers.push(this.eventService.subscribe("ON_UPDATE_MYCONTACT_EVENT",(()=>{this.onMyContactChangedEvent()}))),this.eventServiceSubscriptionHandlers.push(this.eventService.subscribe("ON_TELEPHONY_STATUS_CHANGED_EVENT",(()=>{this.onTelephonyStateChangeEvent()}))),this.eventServiceSubscriptionHandlers.push(this.eventService.subscribe("ON_CONFERENCE_STATE_EVENT",(()=>{this.onConferenceStateChangeEvent()}))),this.eventServiceSubscriptionHandlers.push(this.eventService.subscribe("ON_CONFERENCE_PARTICIPANT_EVENT",(()=>{this.onConferenceParticipantChangeEvent()}))),this.eventServiceSubscriptionHandlers.push(this.eventService.subscribe("ON_RELOAD_CAPABILITIES_FOR_MY_CONYTACT",(()=>{this.onReloadCapabilitiesForMyContactEvent()}))),this.eventServiceSubscriptionHandlers.push(this.eventService.subscribe(this.roomService.ROOM_ADMIN_MESSAGE_EVENT,((e,t,i,r,n,s)=>{this.onRoomAdminMessageEvent(t,i,r,n,s)}))),this.webConferenceServiceV2&&this.subscriptions.push(this.webConferenceServiceV2.subscribe((e=>{try{e.name===this.webConferenceServiceV2.RAINBOW_ONWEBCONFERENCESTATUSUPDATED&&(this.logger.debug("[conversationService] on RAINBOW_ONWEBCONFERENCESTATUSUPDATED -- should update conversation list"),this.orderConversations(),this.computeCapabilitiesForMyContact())}catch(t){return true}return true})))}catch(t){throw this.logger.error("[conversationService] === STARTING FAILURE === "+t.message),t}}reconnect(){this.removeHandlers(),this.attachHandlers()}removeHandlers(){this.logger.info("[conversationService] removeHandlers "),this.conversationHistoryHandler=null,this.conversationServiceEventHandler=null,this.conversationServiceBulkHistoryHandler=null,this.xmppSubscriptionHandlers.forEach((e=>{this.xmppService.deleteHandler(e)})),this.xmppSubscriptionHandlers=[]}attachHandlers(){this.logger.info("[conversationService] attachHandlers"),this.conversationHistoryHandler=A.ConversationServiceHistoryHandler.create(this),this.conversationServiceEventHandler=I.ConversationServiceEventHandler.create(this,this.webConferenceServiceV2),this.conversationServiceBulkHistoryHandler=new P.ConversationServiceBulkHistoryHandler(this),this.xmppService.addHistoryHandler((e=>this.conversationHistoryHandler.onHistoryMessageReceived(e))),this.xmppService.addBulkHistoryHandler((e=>this.conversationServiceBulkHistoryHandler.onHistoryMessageReceived(e))),this.xmppService.addSearchTextHandler(((e,t)=>{if(this.searchTextConvResults.isCurrentQuery(e)){const e=this.conversationHistoryHandler.onSearchTextMessageReceived(t);e&&this.storeSearchTextResult(e)}})),this.xmppSubscriptionHandlers.push(this.xmppService.addHandler((e=>(this.conversationServiceEventHandler.onChatMessageReceived(e),true)),null,"message","chat")),this.xmppSubscriptionHandlers.push(this.xmppService.addHandler((e=>(this.conversationServiceEventHandler.onErrorMessageReceived(e),true)),null,"message","error")),this.xmppSubscriptionHandlers.push(this.xmppService.addHandler((e=>(this.conversationServiceEventHandler.onChatMessageReceived(e),true)),null,"message","groupchat")),this.xmppSubscriptionHandlers.push(this.xmppService.addHandler((e=>(this.conversationServiceEventHandler.onFileMessageReceived(e),true)),null,"message","file")),this.xmppSubscriptionHandlers.push(this.xmppService.addHandler((e=>(this.conversationServiceEventHandler.onWebRTCMessageReceived(e),true)),null,"message","webrtc")),this.xmppSubscriptionHandlers.push(this.xmppService.addHandler((e=>(this.conversationServiceEventHandler.onPBXMessageReceived(e),true)),null,"message","phone")),this.xmppSubscriptionHandlers.push(this.xmppService.addHandler((e=>(this.conversationServiceEventHandler.onManagementMessageReceived(e),true)),null,"message","management")),this.xmppSubscriptionHandlers.push(this.xmppService.addHandler((e=>(this.conversationServiceEventHandler.onReceiptMessageReceived(e),true)),null,"message")),this.xmppSubscriptionHandlers.push(this.xmppService.addHandler((e=>(this.conversationServiceEventHandler.onConferenceMessageReceived(e),true)),"jabber:x:audioconference","message","chat")),this.xmppSubscriptionHandlers.push(this.xmppService.addHandler((e=>(this.onAskSharingMessageReceived(e),true)),"http://jabber.org/protocol/commands","iq"))}async stop(){this.logger.info("[conversationService] === STOPPING ==="),this.conversations=[],this.isReinit=false,this.removeHandlers(),this.eventServiceSubscriptionHandlers.forEach((e=>{e()})),this.eventServiceSubscriptionHandlers=[],this.subscriptions.forEach((e=>{e.unsubscribe()})),this.subscriptions=[],this.logger.info("[conversationService] === STOPPED ===")}subscribe(e){return this.rxSubject.subscribe(e)}publish(e){this.rxSubject.next(e)}async getServerConversations(){if(this.logger.info("[conversationService] getServerConversations"),!this.contactService.userContact||this.contactService.userContact.instantMessagesEnabled)try{const e=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.contactService.userContact.dbId}/conversations?webinar=true`,t=await fetch(e,{headers:this.authService.getRequestHeader()});if(!t.ok)throw t;const i=(await t.json()).data;i.forEach((e=>{e.creationDateSort=e.creationDate?new Date(e.creationDate):void 0,e.lastModificationSort=e.lastMessageDate?new Date(e.lastMessageDate):void 0})),i.sort(((e,t)=>{const i=!e.lastModificationSort&&e.creationDateSort?e.creationDateSort:e.lastModificationSort;return(!t.lastModificationSort&&t.creationDateSort?t.creationDateSort:t.lastModificationSort)-i}));const r=this.authService.fromSDK?3e3:20,n=[];let s=0;i.forEach((e=>{const t=parseInt(e.unreadMessageNumber,10),i="room"===e.type&&(e.name.startsWith("Webinar 1 - ")||e.name.startsWith("Webinar 2 - "));s>=r&&0===t||i?this.deleteServerConversation(e.id):"room"!==e.type||this.roomService&&this.roomService.started?(this.logger.info("getServerConversations -- create conversation "+e.jid_im+" "+e.id),n.push(this.createConversationFromData(e)),s++):this.logger.info("getServerConversations -- create room conversation "+e.jid_im+" "+e.id+" -- ignored !")})),await this.allSettled(n),this.orderConversations()}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getServerConversations");throw this.logger.error("[ConversationService] "+t.message),t.error}else this.logger.warn("[conversationService] getServerConversations skipped - instantMessagesEnabled : false")}allSettled(e){const t=e.map((e=>Promise.resolve(e).then((e=>({status:"fulfilled",value:e})),(e=>({status:"rejected",reason:e})))));return Promise.all(t)}async createServerConversation(e){try{if(e.dbId)return e;const t=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.contactService.userContact.dbId}/conversations`;let i=null;switch(e.type){case a.Conversation.Type.ONE_TO_ONE:i={peerId:e.contact.dbId,type:"user"};break;case a.Conversation.Type.ROOM:i={peerId:e.room.dbId,type:"room"};break;case a.Conversation.Type.BOT:e.type=a.Conversation.Type.ONE_TO_ONE,i={peerId:e.contact.dbId,type:"bot"}}const r=await fetch(t,{method:"POST",headers:this.authService.getPostHeader(),body:JSON.stringify(i)});if(!r.ok)throw r;const n=(await r.json()).data;return e.dbId=n.id,e}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"createServerConversation");throw this.logger.error("[ConversationService] "+e.message),e.error}}async deleteServerConversation(e){try{const t=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.contactService.userContact.dbId}/conversations/${e}`,i=await fetch(t,{method:"DELETE",headers:this.authService.getRequestHeader()});if(!i.ok)throw i;this.logger.info("[conversationService] deleteServerConversation success: "+e),this.orderConversations()}catch(t){const i=await this.errorHelperService.getErrorInfo(t,"deleteServerConversation");if(404002===i.error.status)return void this.logger.info("[conversationService] deleteServerConversation success: "+e);throw this.logger.error("[ConversationService] "+i.message),i.error}}async updateServerConversation(e){if(!e.dbId)return e;try{const t=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.contactService.userContact.dbId}/conversations/${e.dbId}`,i=await fetch(t,{method:"PUT",headers:this.authService.getPostHeader(),body:JSON.stringify({mute:e.muted})});if(!i.ok)throw i;return e}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"updateServerConversation");throw this.logger.error("[ConversationService] "+e.message),e.error}}async ackAllMessages(e,t=false){try{if(!e.ackReadAllReceivedMessages()&&!t)return void this.logger.info("[conversationService] ackAllMessages for conversation "+e.dbId+" already updated");const i=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.contactService.userContact.dbId}/conversations/${e.dbId}/markallread`,r=this.contactService.userContact.readReceiptsCustomisation?{}:{maskRead:true},n=await fetch(i,{method:"PUT",headers:this.authService.getPostHeader(),body:JSON.stringify(r)});if(!n.ok)throw n;this.logger.info("[conversationService] ackAllMessages success: "+e.dbId)}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"ackAllMessages");throw this.logger.error("[ConversationService] "+e.message),e.error}}async setConversationBookmark(e,t){try{const i=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.contactService.userContact.dbId}/conversations/${e.dbId}/bookmark?analyticsConversationType=${e.type===a.Conversation.Type.ONE_TO_ONE?"p2p":"bubble"}`,r={messageId:t},n=await fetch(i,{method:"POST",headers:this.authService.getPostHeader(),body:JSON.stringify(r)});if(!n.ok)throw n;this.logger.info("[conversationService] setConversationBookmark success: "+e.dbId)}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"setConversationBookmark");throw this.logger.error("[ConversationService] "+e.message),e.error}}async deleteConversationBookmark(e){try{const t=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.contactService.userContact.dbId}/conversations/${e.dbId}/bookmark?analyticsConversationType=${e.type===a.Conversation.Type.ONE_TO_ONE?"p2p":"bubble"}`,i=await fetch(t,{method:"DELETE",headers:this.authService.getPostHeader()});if(!i.ok)throw i;this.logger.info("[conversationService] deleteConversationBookmark success: "+e.dbId)}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"deleteConversationBookmark");throw this.logger.error("[ConversationService] "+e.message),e.error}}async getOrCreateConversation(e,t){return this["room"===t?"getRoomConversationInternal":"getOrCreateOneToOneConversationInternal"](e)}async createConversationFromData(e){const t=parseInt(e.unreadMessageNumber,10),i=true===e.mute;return"user"===e.type?this.getOrCreateOneToOneConversationInternal(e.jid_im,e.id,e.lastMessageDate,e.lastMessageText,t,i,e.creationDate,e.lastMessageSender,e.call,e.replace,e.forwardFrom,e.forwardedMessage,e.instantMessagesCustomisation,e.filename,e.geoloc,e.contentType,e.bookmark):this.getRoomConversationInternal(e.jid_im,e.id,e.lastMessageDate,e.lastMessageText,t,i,e.creationDate,e.lastMessageSender,e.topic,e.type,e.forwardFrom,e.forwardedMessage,e.eventName,e.eventJid,e.filename,e.geoloc,e.contentType,e.bookmark)}getOrCreateTelephonyConversation(e){this.logger.info("getOrCreateTelephonyConversation -- "+e.id);let t=this.getConversation(e.id);return e.id&&this.telephonyService.currentPgiObject&&this.telephonyService.currentPgiObject.callId&&e.id===this.telephonyService.currentPgiObject.callId&&(t=this.getConversation(this.telephonyService.currentPgiObject.roomJid)),t||(t=new a.Conversation(e.id),e.isConference?t.telephonyContacts=e.participants:(t.contact=e.contact,e.contact.conversation=t),this.conversations[e.id]=t),t}getOrCreateOneToOneConversationInternal(e,t,i,r,n,s,o,c,l,d,u,h,f,p,g,m,v){if(this.logger.info("[conversationService] getOrCreateOneToOneConversation "+e+" "+t+" "+n),!this.conversationCreationPromise[e]){const S=this.getConversation(e);if(S)return S.preload=true,Promise.resolve(S);this.conversationCreationPromise[e]=new Promise((S=>{this.contactService.getOrCreateContact(e).then((e=>{f&&"disabled"===f&&(e.instantMessagesEnabled=false);const S=a.Conversation.createOneToOneConversation(e);return S.lastModification=i?new Date(i):void 0,S.lastCallInfo=l,S.replaceLastMsgId=d,r&&(S.lastMessageText=r),m&&(S.lastMessageContentType=m),S.lastMessageSender=this.xmppService.getBareJidFromJid(c),S.muted=s,S.creationDate=o?new Date(o):new Date,this.computeCapabilitiesForContact(e),S.dbId=t,S.missedCounter=n||0,u&&-1!==u.indexOf("/")&&(u=this.xmppService.getBareJidFromJid(u)),S.forwardFrom=u,S.forwardedMessage=h,S.isForwardedMessageFile=Boolean(u&&p),S.isGeoLoc=g,S.bookmark=v||null,this.createServerConversation(S)})).then((t=>{this.conversations[t.contact.id]=t,this.orderConversations(),this.eventService.publish("ON_CONVERSATIONS_UPDATED_EVENT",t,a.Conversation.EventType.NEW),S(t),delete this.conversationCreationPromise[e]})).catch((t=>{const i="getOrCreateOneToOneConversation "+e+" failure "+t.message;throw this.logger.error("[conversationService] "+i),delete this.conversationCreationPromise[e],new Error(i)}))}))}return this.conversationCreationPromise[e]}getRoomConversationInternal(e,t,i,r,n,s,o,c,l,d,u,h,f,p,g,m,v,S){if(this.logger.info("[conversationService] getRoomConversation "+e),!this.conversationCreationPromise[e]){const b=this.getConversation(e);if(b)return b.preload=true,Promise.resolve(b);this.conversationCreationPromise[e]=new Promise(((b,y)=>{const C=this.roomService.getRoomByJid(e);if(C||"bot"===d)if(C){const d=a.Conversation.createRoomConversation(C);d.dbId=t,d.lastModification=i?new Date(i):void 0,r&&("conferenceRemove"===f?d.lastMessageText="conferenceRemoveMsgRoom":"conferenceAdd"===f?d.lastMessageText="conferenceAddMsgRoom":"voicemessage"===f?(d.lastMessageText=this.i18n.translate("newVoiceMessage"),d.lastMessageSide="ADMIN"):d.lastMessageText=r),d.muted=s,d.creationDate=o?new Date(o):new Date,d.preload=false,d.lastMessageSender=f&&p?p:this.xmppService.getBareJidFromJid(c),u&&-1!==u.indexOf("/")&&(u=this.xmppService.getBareJidFromJid(u)),d.forwardFrom=u,d.forwardedMessage=h,d.isForwardedMessageFile=Boolean(u&&g),d.isGeoLoc=m,d.bookmark=S||null,d.room&&l&&(d.room.desc=l),n&&(d.missedCounter=n),t&&(this.conversations[d.id]=d,this.getRoomPstnConferences(d),this.eventService.publish("ON_CONVERSATIONS_UPDATED_EVENT",d,a.Conversation.EventType.NEW),b(d),delete this.conversationCreationPromise[e]),this.createServerConversation(d).then((t=>{const i=this.roomService.getRoomByJid(e);t.room=i,this.conversations[t.id]=t,this.orderConversations(),i&&"unsubscribed"!==i.status&&i.isActive&&this.roomService.sendInitialRoomPresence(i),this.eventService.publish("ON_CONVERSATIONS_UPDATED_EVENT",t,a.Conversation.EventType.NEW),b(t),delete this.conversationCreationPromise[e]})).catch((t=>{const i="getRoomConversationInternal -- createServerConversation failure: "+t.message;this.logger.error("[conversationService] "+i),delete this.conversationCreationPromise[e],y(new Error(i))}))}else this.botService.getBotContactByJid(e).then((a=>{if(!a)throw new Error(`No contact found for bot ${e} at all`);delete this.conversationCreationPromise[e],this.getOrCreateOneToOneConversationInternal(e,t,i,r,n,s,o),b()})).catch((t=>{const i="getRoomConversation failure: "+t.message;this.logger.error("[conversationService] "+i),delete this.conversationCreationPromise[e],y(new Error(i))}));else this.logger.error("[conversationService] getRoomConversation ("+e+") failure : no such room -- try to get from server and update"),setTimeout((()=>{this.roomService.getServerRoomByJid(e).then((d=>{const y=a.Conversation.createRoomConversation(d);y.dbId=t,y.lastModification=i?new Date(i):void 0,y.muted=s,y.creationDate=o?new Date(o):new Date,y.preload=false,y.bookmark=S||null,u&&-1!==u.indexOf("/")&&(u=this.xmppService.getBareJidFromJid(u)),y.forwardFrom=u,y.forwardedMessage=h,y.isForwardedMessageFile=Boolean(u&&g),y.isGeoLoc=m,r&&("conferenceRemove"===f?y.lastMessageText="conferenceRemoveMsgRoom":"conferenceAdd"===f?y.lastMessageText="conferenceAddMsgRoom":"voicemessage"===f?(y.lastMessageText=this.i18n.translate("newVoiceMessage"),y.lastMessageSide="ADMIN"):y.lastMessageText=r),v&&(y.lastMessageContentType=v),y.lastMessageSender=f&&p?p:this.xmppService.getBareJidFromJid(c),y.room&&l&&(y.room.desc=l),n&&(y.missedCounter=n),t?(this.conversations[y.id]=y,this.eventService.publish("ON_CONVERSATIONS_UPDATED_EVENT",y,a.Conversation.EventType.NEW),b(y),delete this.conversationCreationPromise[e]):(b(),delete this.conversationCreationPromise[e]),this.conversations[y.id]&&d&&d.isWebConferenceV2Room()?this.eventService.publish("ON_WEBCONF_ADD_HOC_COMPLETED",d):d&&d.confEndpoints&&d.confEndpoints[0]&&this.eventService.publish("ON_ADD_HOC_COMPLETED",d)})).catch((()=>{this.logger.error(`[conversationService] getRoomConversation (${e}) failure : no such room at all`),y()}))}),500)}))}return this.conversationCreationPromise[e]}getRoomPstnConferences(e){if(!this.pgiConferenceService)return;const t=e.room.confEndpoints;t&&t.forEach((t=>{if("pstnAudio"===t.mediaType){const i=this.pgiConferenceService.getConferenceSessionById(t.confEndpointId);i&&(e.pstnConferenceSession=i)}}))}updateRoomConferences(){this.getConversations().forEach((e=>{if(e.room&&e.room.confEndpoints){if(this.pgiConferenceService){const t=this.pgiConferenceService.getConferenceSessionById(e.room.getPstnConfEndpointId());e.pstnConferenceSession=t||null}const t=this.webConferenceService.getConferenceSessionForRoom(e.room.confEndpoints);e.webConferenceSession=t||null}else e.pstnConferenceSession=null,e.webConferenceSession=null}))}async closeConversation(e){this.logger.info("[conversationService] closeConversation "+e.id),await this.deleteServerConversation(e.dbId),this.removeConversation(e)}removeConversation(e){this.logger.info("[conversationService] remove conversation "+e.id),e.videoCall&&e.videoCall.status!==r.Call.Status.UNKNOWN?this.logger.info("[conversationService] Ignore conversation deletion message for conversation"+e.id):(delete this.conversations[e.id],this.orderConversations(),this.activeConversation&&this.activeConversation.id===e.id&&this.selectNewActiveConversation(),e.contact&&(e.contact.conversation=null,e.contact=null),this.eventService.publish("ON_CONVERSATION_REMOVE_EVENT",e))}selectNewActiveConversation(){const e=this.getOrderedConversations();return e.inCall.length>0?this.setActiveConversation(e.inCall[0]):e.idle.length>0?this.setActiveConversation(e.idle[0]):this.setActiveConversation(null),this.getActiveConversation()}searchConversations(e){const t=e.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(/[ -]+/);return this.getOrderedConversations().idle.filter((e=>{const i=e.filterName.trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(/[ -]+/);return t.every((e=>i.some(((t,r)=>!(!t.length||-1===t.indexOf(e))&&(i[r]="",true)))))}))}sendChatMessage(e,t,i=null,r=null,n=null,s=null,o=null,c){const l=a.Conversation.getUniqueMessageId(),d=t?t.startsWith("/code")?t:e.shortnameToUnicode(t):"",u=r?r.id:null,h=r?r.date:null,f=new Date,p=this.contactService.userContact,g=r?r.urgencyAck:null,m=this.addChatMessage(e,p,f,d,l,true,null,u,h,i,n,g,null);if(m)return m.urgency=s,m.urgencyAck=g,m.urgencyAckType=o,m.urlMetadata=c,this.pendingMessages[m.id]={conversation:e,message:m},this.sendXmppMessage(e,m),m}async sendChatForwardMessage(e,t,i,r){t&&t.length&&this.sendChatMessage(e,t);let s=null,o=i.fileId?this.fileStorageService.getFileDescriptorById(i.fileId):null;o?(o.ownerId!==this.contactService.userContact.dbId&&(o=await this.fileStorageService.copyFileToUserCloudStorage(o.id)),await this.shareFileToViewer(e,o),s=n.Message.createFileSharingMessage(i.id,i.date,i.from,i.side,i.data,i.status,o.id,i.fileName,null,i.geoloc)):s=n.Message.create(i.id,i.date,i.from,i.side,i.getLastTextModified(),i.status),r.type===a.Conversation.Type.ONE_TO_ONE?s.to=r.contact.jid!==i.from.jid?r.contact:this.contactService.userContact:s.to=r.room,i.urlMetadata?s.urlMetadata=i.urlMetadata:i.forwardedMsg&&i.forwardedMsg.urlMetadata&&(s.urlMetadata=i.forwardedMsg.urlMetadata);const c=a.Conversation.getUniqueMessageId(),l=new Date,d=this.contactService.userContact,u=this.addForwardChatMessage(e,d,l,c,s,r);if(u)return this.pendingMessages[u.id]={conversation:e,newForwardedMsg:s,message:u},this.sendXmppMessage(e,u),u}async shareFileToViewer(e,t){if(t)try{const i=0===e.type?"user":"room",r=0===e.type?e.contact.dbId:e.room.dbId;await this.fileStorageService.addFileViewer(t.id,r,i)}catch(i){throw new Error(i)}}async uploadFileForConversation(e,t,i=false){const r=e.type===a.Conversation.Type.ONE_TO_ONE?{viewerId:e.contact.dbId,type:"user"}:{viewerId:e.room.dbId,type:"room"},n=o.FileViewer.createFromData([r]),s=await this.fileStorageService.createFileDescriptor(t,n,i);s.fileToSend=t,s.isImage()&&t.preview&&(s.previewBlob=t.preview);try{s.setState(l.FileState.UPLOADING),this.eventService.publish("ON_FILE_TRANSFER_EVENT",{fileDesc:s,cancelable:true}),await this.fileServerService.uploadAFileByChunk(s,t),s.setState(l.FileState.UPLOADED),s.fileToSend=null,s.chunkPerformed=0,s.chunkTotalNumber=0,this.eventService.publish("ON_FILE_TRANSFER_EVENT",{fileDesc:s})}catch(c){throw this.logger.error("[conversationService] uploadFileForConversation --  error"),s.setState("uploadError"),c}}async sendFSMessage(e,t,i,r,s,c){try{const u=e.type===a.Conversation.Type.ONE_TO_ONE?{viewerId:e.contact.dbId,type:"user"}:{viewerId:e.room.dbId,type:"room"},h=o.FileViewer.createFromData([u]),f=await this.fileStorageService.createFileDescriptor(t,h,r||false);f.fileToSend=t,f.isImage()&&t.preview&&(f.previewBlob=t.preview);let p="object"==typeof i?i:void 0;p||(p=this.addFSMessage(e,f.id,i,l.FileState.UPLOADING,s,null,c),s&&!s.attachedMsgId&&(p.attachedMsgId=p.id)),p.fileId=f.id,p.fileName=f.fileName,p.urgency=c;try{this.pendingMessages[p.id]={conversation:e,message:p},f.setState(l.FileState.UPLOADING),this.eventService.publish("ON_FILE_TRANSFER_EVENT",{fileDesc:f,cancelable:true}),await this.fileServerService.uploadAFileByChunk(f,t),f.setState(l.FileState.UPLOADED),f.fileToSend=null,f.chunkPerformed=0,f.chunkTotalNumber=0,this.eventService.publish("ON_FILE_TRANSFER_EVENT",{fileDesc:f}),this.sendXmppMessage(e,p,f)}catch(d){throw this.logger.error("[conversationService] sendFSMessage -- uploadAFile error"),s||this.fileStorageService.deleteFileDescriptor(f.id),f.setState("uploadError"),p.receiptStatus=n.Message.ReceiptStatus.ERROR,p.fileErrorMsg=d.translatedMessage?d.translatedMessage:this.i18n.translate("unableToShareFile"),p.sendUpdateEvent(),d}return p}catch(d){if(d instanceof DOMException&&d.code===DOMException.ABORT_ERR)return null;let e=d.translatedMessage?d.translatedMessage:this.i18n.translate("unableToShareFile");throw 403153===d.errorDetailsCode&&(e=this.i18n.translate("fileSharingNoMoreAllowedMsg")),this.mainService.showGlobalPopupMessage({popupTitle:"fileTransfer",popupBodyTranslated:e,okLabel:"ok"}),new Error(d)}}async resendFSMessage(e,t){try{if(!t)return;const r=this.fileStorageService.getFileDescriptorById(t.fileId);try{this.pendingMessages[t.id]={conversation:e,message:t},t.setReceiptStatus(n.Message.ReceiptStatus.IN_PROGRESS),r.chunkPerformedPercent=0,r.chunkPerformed=0,r.chunkTotalNumber=0,r.setState(l.FileState.UPLOADING),t.sendUpdateEvent(),this.eventService.publish("ON_FILE_TRANSFER_EVENT",{fileDesc:r,cancelable:true}),await this.fileServerService.uploadAFileByChunk(r,r.fileToSend),r.setState(l.FileState.UPLOADED),r.fileToSend=null,r.chunkPerformed=0,r.chunkTotalNumber=0,this.eventService.publish("ON_FILE_TRANSFER_EVENT",{fileDesc:r}),this.sendXmppMessage(e,t,r)}catch(i){throw this.logger.error("[conversationService] sendFSMessage -- uploadAFile error"),r.setState("uploadError"),t.receiptStatus=n.Message.ReceiptStatus.ERROR,t.fileErrorMsg=i.translatedMessage?i.translatedMessage:this.i18n.translate("unableToShareFile"),t.sendUpdateEvent(),i}}catch(i){let e=i.translatedMessage?i.translatedMessage:this.i18n.translate("unableToShareFile");throw 403153===i.errorDetailsCode&&(e=this.i18n.translate("fileSharingNoMoreAllowedMsg")),this.mainService.showGlobalPopupMessage({popupTitle:"fileTransfer",popupBodyTranslated:e,okLabel:"ok"}),new Error(i)}}async sendEFSMessage(e,t,i,r,s,o){let c=null;try{i&&0!==i.length||(i=t.fileName);const n=e.type===a.Conversation.Type.ONE_TO_ONE?"user":"room",l=e.type===a.Conversation.Type.ONE_TO_ONE?e.contact.dbId:e.room.dbId;return await this.fileStorageService.addFileViewer(t.id,l,n),c=this.addFSMessage(e,t.id,i,t.state,r,s,o),c.fileName=t.fileName,r&&!c.attachedMsgId&&(c.attachedMsgId=c.id),this.sendXmppMessage(e,c,t),this.pendingMessages[c.id]={conversation:e,message:c},this.eventService.publish("ON_SEND_EFS_MESSAGE",t),c}catch(l){c.receiptStatus=n.Message.ReceiptStatus.ERROR,c.sendUpdateEvent()}}sendXmppMessage(e,t,i=null){if(!t)return null;const r=t.id,s=t.data.startsWith("/code")?t.data:e.shortnameToUnicode(t.data),o=e.type===a.Conversation.Type.ONE_TO_ONE?e.contact.jid:e.room.jid,c=e.type===a.Conversation.Type.ONE_TO_ONE?"chat":"groupchat",l=$msg({to:o,type:c,id:r,"xml:lang":this.contactService.currentLanguage});if(l.c("body",{"xml:lang":this.contactService.currentLanguage}).t(s).up(),l.c("store",{xmlns:"urn:xmpp:hints"}).up(),l.c("request",{xmlns:a.Conversation.ReceiptNS}).up(),l.c("active",{xmlns:a.Conversation.ChatstatesNS}).up(),i&&(l.c("x",{xmlns:"jabber:x:oob",index:t.attachIndex,count:t.attachNumber}).c("url",{},config.restServerUrl+"/api/rainbow/fileserver/v1.0/files/"+i.id).c("mime",{},i.typeMIME).c("filename",{},i.fileName).c("size",{},i.size).up(),t.fileId=i.id,i.tags&&"voicemail"===i.tags.purpose&&l.c("voicemessage",{xmlns:"http://jabber.org/protocol/voicemessage"}).up()),t.attachedMsgId&&l.c("attach-to",{xmlns:"urn:xmpp:message-attaching:1",id:t.attachedMsgId}).up(),t.geoloc&&l.c("geoloc",{xmlns:"http://jabber.org/protocol/geoloc"}).c("lat",t.geoloc.lat).c("lon",t.geoloc.lon),t.additionalContent&&l.c("content",{xmlns:a.Conversation.contentNS,type:t.additionalContent.type}).t(t.additionalContent.message).up(),t.answeredMsgId&&(t.urgencyAck&&t.urgencyAckType?l.c("answeredMsg",{type:"urgent",action:t.urgencyAckType,stamp:t.answeredMsgDate.getTime()}).t(t.answeredMsgId).up():l.c("answeredMsg",{stamp:t.answeredMsgDate.getTime()}).t(t.answeredMsgId).up()),t.mentions&&t.mentions.length&&(l.c("mention",{xmlns:a.Conversation.AttentionNS}),t.mentions.forEach((e=>{l.c("jid",{pos:e.pos,size:e.size},e.jid)})),l.up()),t.urgency&&"std"!==t.urgency&&(l.c("headers",{xmlns:"http://jabber.org/protocol/shim"}).c("header",{name:"Urgency"}).t(t.urgency).up().up(),l.c("retry-push",{xmlns:"urn:xmpp:hints"}).up()),t.forwardedMsg&&this.addXmppForwardMessage(e,l,t),t.urlMetadata){const e=t.urlMetadata;l.c("url-metadata",{xmlns:"urn:xmpp:message-urlmetadata",title:e.title,description:e.description,url:e.url,image:e.image}).up()}return t.serverAckTimer=setTimeout((()=>{t.receiptStatus=n.Message.ReceiptStatus.ERROR,t.sendUpdateEvent()}),1e4),t.setReceiptStatus(n.Message.ReceiptStatus.SENT),t.sendUpdateEvent(),this.xmppService.send(l),e.room&&(e.room.lastActivityDate=new Date),t}addXmppForwardMessage(e,t,i){t.c("forwarded",{xmlns:a.Conversation.FORWARDNS});const r=e.shortnameToUnicode(i.forwardedMsg.data),n=i.forwardedMsg.from.fullJid?i.forwardedMsg.from.fullJid:i.forwardedMsg.from.jid;t.c("message",{to:i.forwardedMsg.to.jid,from:n,id:i.forwardedMsg.id,type:i.forwardConvType,xmlns:"jabber:client"}),t.c("body",{"xml:lang":this.contactService.currentLanguage}).t(r).up();const s=this.fileStorageService.getFileDescriptorById(i.forwardedMsg.fileId);if(s&&(t.c("x",{xmlns:"jabber:x:oob",index:i.attachIndex,count:i.attachNumber}).c("url",{},s.state===l.FileState.UPLOADED?config.restServerUrl+"/api/rainbow/fileserver/v1.0/files/"+s.id:"").c("mime",{},s.typeMIME).c("filename",{},s.fileName).c("size",{},s.size).up(),s.tags&&"voicemail"===s.tags.purpose&&t.c("voicemessage",{xmlns:"http://jabber.org/protocol/voicemessage"}).up()),i.forwardedMsg.geoloc&&t.c("geoloc",{xmlns:"http://jabber.org/protocol/geoloc"}).c("lat",i.forwardedMsg.geoloc.lat).up().c("lon",i.forwardedMsg.geoloc.lon).up().up(),i.answeredMsgId&&t.c("answeredMsg",{stamp:i.forwardedMsg.answeredMsgDate.getTime()}).t(i.forwardedMsg.answeredMsgId).up(),i.forwardedMsg.urlMetadata){const e=i.forwardedMsg.urlMetadata;t.c("url-metadata",{xmlns:"urn:xmpp:message-urlmetadata",title:e.title,description:e.description,url:e.url,image:e.image}).up()}t.up(),t.up()}sendAckReadOrReceivedMessage(e,t,i){this.logger.info(`[ConversationService] ${e.id} send ${i} status for message ${t}`);const r=e.type===a.Conversation.Type.ONE_TO_ONE?e.contact.jid:e.room.jid,n=e.type===a.Conversation.Type.ONE_TO_ONE?"chat":"groupchat",s=this.contactService.userContact.jid,o=!this.contactService.userContact.readReceiptsCustomisation,c={xmlns:a.Conversation.ReceiptNS,id:t,event:i,entity:"client"};"read"===i&&e.type===a.Conversation.Type.ONE_TO_ONE&&o&&(c.maskread="true"),e.type!==a.Conversation.Type.ONE_TO_ONE&&(c.type="muc"),this.xmppService.send($msg({to:r,from:s,type:n}).c("received",c))}sendAckReceivedMessage(e,t){t.receiptStatus>=n.Message.ReceiptStatus.UNREAD||(this.sendAckReadOrReceivedMessage(e,t.id,"received"),t.setReceiptStatus(n.Message.ReceiptStatus.UNREAD))}sendAckReadMessage(e,t){t.receiptStatus!==n.Message.ReceiptStatus.READ&&(this.sendAckReadOrReceivedMessage(e,t.id,"read"),t.setReceiptStatus(n.Message.ReceiptStatus.READ),t.replaceMsgs&&t.replaceMsgs.length&&t.replaceMsgs.forEach((t=>{this.sendAckReadOrReceivedMessage(e,t.id,"read")})))}sendAckReadMessages(e){this.logger.info(`[ConversationService] ${e.id} sendAckReadMessages`);let t=false;return e.messages.forEach((i=>{i.receiptStatus!==n.Message.ReceiptStatus.SENT&&i.receiptStatus!==n.Message.ReceiptStatus.UNREAD||i.side!==n.Message.Side.LEFT&&i.side!==n.Message.Side.ADMIN||(this.sendAckReadMessage(e,i),t=true)})),t}sendChatStatus(e,t){if(e.status===t)return;this.logger.info(`[ConversationService] ${e.id} setStatus ${t.value}`),e.status=t;const i=e.type===a.Conversation.Type.ONE_TO_ONE?e.contact.jid:e.room.jid,r=e.type===a.Conversation.Type.ONE_TO_ONE?"chat":"groupchat";this.xmppService.send($msg({to:i,type:r}).c(t.value,{xmlns:a.Conversation.ChatstatesNS}))}sendIsTypingState(e,t){const i=a.Conversation.getUniqueMessageId(),r=t?"composing":"active",n=e.type===a.Conversation.Type.ONE_TO_ONE?e.contact.jid:e.room.jid,s=e.type===a.Conversation.Type.ONE_TO_ONE?"chat":"groupchat",o=this.contactService.currentLanguage;this.xmppService.send($msg({to:n,type:s,id:i,"xml:lang":o}).c(r,{xmlns:a.Conversation.ChatstatesNS}).up())}sendRecordingMessage(e,t){const i=a.Conversation.getUniqueMessageId(),r=e.contact.jid,s=e.shortnameToUnicode(t),o=this.contactService.currentLanguage,c=this.addRecordingMessage(e,this.contactService.userContact,new Date,s,i);if(!c)return null;const l=$msg({to:r,type:"chat",id:i,"xml:lang":o}).c("body",{"xml:lang":o}).up().c("recording",{xmlns:"jabber:iq:recordingP2P"}).t(s).up().c("request",{xmlns:a.Conversation.ReceiptNS}).up().c("active",{xmlns:a.Conversation.ChatstatesNS}).up();return c.serverAckTimer=setTimeout((()=>{c.receiptStatus=n.Message.ReceiptStatus.ERROR,c.sendUpdateEvent()}),1e4),this.xmppService.send(l),this.pendingMessages[c.id]={conversation:e,message:c},c}sendCorrectedChatMessage(e,t,i,r,s){const o=e.getMessageById(t);if(!o)return this.logger.info("[conversationService] sendCorrectedChatMessage - original message not found"),null;if(o.from.jid!==this.contactService.userContact.jid)return this.logger.info("[conversationService] sendCorrectedChatMessage forbidden Action - only sent messages can be modified"),null;this.sendAckReadMessages(e);const c=t,l=e.type===a.Conversation.Type.ONE_TO_ONE?e.contact.jid:e.room.jid,d=e.type===a.Conversation.Type.ONE_TO_ONE?"chat":"groupchat",u=null==i?"":i,h=e.shortnameToUnicode(u),f=this.contactService.currentLanguage,p=$msg({to:l,type:d,id:c,"xml:lang":f}).c("body",{"xml:lang":this.contactService.currentLanguage}).t(h).up().c(0===u.length&&null==r?"deleted":"modified",{xmlns:"urn:xmpp:message-correct:0"}).up();return r&&p.c("content",{xmlns:a.Conversation.contentNS,type:r.type}).t(r.message).up(),s&&s.length?(p.c("mention",{xmlns:a.Conversation.AttentionNS}),s.forEach((e=>{p.c("jid",{pos:e.pos,size:e.size},e.jid)}))):o.mentionedMembersArray&&o.mentionedMembersArray.length&&(o.mentionedMembersArray=[],o.mentions=null),o.urgency&&"std"!==o.urgency&&(p.c("headers",{xmlns:"http://jabber.org/protocol/shim"}).c("header",{name:"Urgency"}).t(o.urgency).up().up(),p.c("retry-push",{xmlns:"urn:xmpp:hints"}).up()),p.c("store",{xmlns:"urn:xmpp:hints"}).up().c("request",{xmlns:a.Conversation.ReceiptNS}).up().c("active",{xmlns:a.Conversation.ChatstatesNS}).up(),o.serverAckTimer=setTimeout((()=>{o.receiptStatus=n.Message.ReceiptStatus.ERROR,o.sendUpdateEvent()}),1e4),o.modify({body:h,mentions:s}),this.xmppService.send(p),e.room&&(e.room.lastActivityDate=new Date),e.updateAfterReplaceEvent(o),this.orderConversations(),this.pendingMessages[c]={conversation:e,message:o},o.sendUpdateEvent(),o}removeChatMessage(e,t){this.sendCorrectedChatMessage(e,t,null,null)}removeAllMessages(e){return new Promise((t=>{this.logger.info("[conversationService] removeAllMessage "+e.id);const i={queryid:this.xmppService.connection.getUniqueId(),with:e.id,onComplete:()=>{t()}},r=this.xmppService.connection.getUniqueId();this.xmppService.connection.mam.delete(r,i)}))}async sendConversationByEmail(e){try{const t=this.contactService.userContact,i=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/"+t.dbId+"/conversations/"+e.dbId+"/downloads",r=await fetch(i,{method:"POST",headers:this.authService.getPostHeader()});if(!r.ok)throw r}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getServerConversations");if(409011===e.error.status)return t.message="No messages to export for the last 30 days.",void this.logger.info("[conversationService] deleteServerConversation success: "+t.message);throw this.logger.error("[ConversationService] "+e.message),e.error}}retrieveMsgByDate(e,t){return t&&t.getTime&&(t=t.getTime()),this.logger.debug("[conversationService] >retrieveMsgByDate: "+t),this.conversationHistoryHandler.retrieveMsgByDate(e,t+"000")}clearSearchTextResults(){this.searchTextConvResults.clearAll(),this.searchTextConvResults.isSearching=false}async searchTextInRoomsAndConversations(e){try{this.searchTextConvResults.clearAll(),this.searchTextConvResults.isSearching=true,await Promise.all([this.searchTextInConversations(e),this.searchTextInRooms(e)]),this.searchTextConvResults.isSearching=false}catch(t){this.searchTextConvResults.isSearching=false}}async searchTextInConversations(e){const t=this.xmppService.connection.getUniqueId();this.searchTextConvResults.queryIds.push(t),this.searchTextConvResults.searchedText=e,await this.conversationHistoryHandler.searchTextInConversations(t,e),Object.keys(this.searchTextConvResults.partResults).forEach((e=>{const t=this.searchTextConvResults.partResults[e];t.room||this.contactService.getOrCreateContact(e).then((i=>{t.contact=i,this.sortResults(t),this.searchTextConvResults.totalCount+=t.convRes.length,this.searchTextConvResults.results.push(t),delete this.searchTextConvResults.partResults[e]}))}))}async searchTextInRooms(e){const t=this.roomService.getRooms().map((t=>t.desc&&t.desc.startsWith("Rainbow_OutlookCreation_InternalUseOnly")||t.isWebinarRoom()?Promise.resolve():this.searchTextInConversation(e,false,t.jid,"room")));await Promise.all(t)}async searchTextInConversation(e,t,i,r=null){t&&this.searchTextConvResults.clearAll();const n=this.xmppService.connection.getUniqueId();this.searchTextConvResults.searchedText=e,this.searchTextConvResults.queryIds.push(n);const s="room"===r?"searchTextResultsInRoom":"searchTextResultsInConversation",o=await this.conversationHistoryHandler[s](n,e,i),a=this.searchTextConvResults.partResults[i];a&&(a.totalCount=o,this.sortResults(a),this.searchTextConvResults.totalCount+=o,this.searchTextConvResults.results.push(a),delete this.searchTextConvResults.partResults[i])}storeSearchTextResult(e){const t=e.otherJid;if(e.body.startsWith("/img"))return;let i=this.searchTextConvResults.partResults[t];i||(i=new d.SearchTextResult(t),e.isRoom&&(i.room=this.roomService.getRoomByJid(t)),this.searchTextConvResults.partResults[t]=i),i.addMsgItem(e),i.totalCount++}sortResults(e){e.convRes.sort(((e,t)=>e.date?t.date?e.date-t.date:1:-1))}setActiveConversation(e){return this.logger.debug("[conversationService] - setActiveConversation: "+(e?e.id:"null")),this.activeConversation=e,this.eventService.publish("ON_ACTIVE_CONVERSATION_CHANGE",e),this.activeConversation}setMostRecentConversationActive(){const e=this.getConversations().sort(this.sortFunction);return e.length>0?this.setActiveConversation(e[0]):this.setActiveConversation(null)}getConversations(){return Object.keys(this.conversations).map((e=>this.conversations[e]))}getConversation(e){if(!this.conversations)return null;let t=this.conversations[e];if(!t){const i=Object.keys(this.conversations).find((t=>this.conversations[t]&&this.conversations[t].dbId===e));t=i?this.conversations[i]:null}if(!t){const i=Object.keys(this.conversations).find((t=>this.conversations[t]&&this.conversations[t].room&&this.conversations[t].room.dbId===e));t=i?this.conversations[i]:null}return t}getActiveConversation(){return this.activeConversation}orderConversations(){this.inCallConversations=[],this.idleConversations=[],this.involvedContactIds=[],Object.keys(this.conversations).forEach((e=>{const t=this.conversations[e];if(t.type===a.Conversation.Type.ROOM){if(t.room.owner&&t.room.isMeetingRoom()&&this.pgiConferenceService){const e=this.pgiConferenceService.getConferenceSessionById(t.room.getPstnConfEndpointId());if(e&&e.active)return void this.inCallConversations.push(t)}if(t.room&&this.webConferenceServiceV2){const e=this.webConferenceServiceV2.getWebConferenceSessionById(t.room.dbId);if(e&&e.haveJoined)return void this.inCallConversations.push(t)}}this.isInCall(t)?this.inCallConversations.push(t):t.room&&t.room.isWebinarRoom()||t.isAudioCallIncomming()||this.idleConversations.push(t),t.type===a.Conversation.Type.ONE_TO_ONE&&this.involvedContactIds.push(t.contact.id)})),this.inCallConversations.sort(this.sortInCallFunction),this.idleConversations.sort(this.sortFunction),this.publish(s.RBEvent.create("reorder"))}getOrderedConversations(){return{inCall:this.inCallConversations,idle:this.idleConversations,contactIds:this.involvedContactIds}}sortFunction(e,t){const i=!e.lastModification&&e.creationDate?e.creationDate:e.lastModification;return(!t.lastModification&&t.creationDate?t.creationDate:t.lastModification)-i}sortInCallFunction(e,t){const i=e.audioCall?e.audioCall.startDate:null,r=t.audioCall?t.audioCall.startDate:null;return i&&r?i-r:0}formatDate(e){return moment(e).utc().format("YYYY-MM-DDTHH:mm:ss")+"Z"}resetConversationMissedCounters(e){this.mainService.appVisible.getValue()&&(e.missedCounter=0,e.missedCalls=0,this.updateMissedCounters())}decreaseMissedIMCounterForConversation(e){e.missedCounter>0&&(e.missedCounter-=1),this.updateMissedCounters()}updateMissedCounters(){let e=0;const t=[];Object.keys(this.conversations).forEach((i=>{const r=this.conversations[i];0!==r.missedCounter&&(e+=r.missedCounter,t.push(r))})),e!==this.missedInfoCounters.value.missedIMCounter&&(this.missedInfoCounters.value.missedIMCounter=e,this.missedInfoCounters.value.missedIMDetails=t,this.missedInfoCounters.next(this.missedInfoCounters.value))}allowDesktopSharing(){return!(adapter&&adapter.default&&adapter.default.browserDetails)||"safari"!==adapter.default.browserDetails.browser}allowAdvancedDesktopSharing(){return false}updateConversationCall(e,t){t.type===r.Call.Type.WEBRTC?e.videoCall=t:t.type===r.Call.Type.PHONE&&(e.audioCall=t),t.setConversationId(e.id),!t.isConference&&e.contact&&this.computeCapabilitiesForContact(e.contact),this.computeCapabilitiesForMyContact()}computeCapabilitiesForContact(e,t=false){let i=false,n=false,s=false,o=false,c=false;const l=e.status,d=e.fullJid,u=this.contactService.userContact;if(e.jid===u.jid)return void this.computeCapabilitiesForMyContact();const h=e.company&&this.contactService.userContact.company&&"Rainbow"!==e.company.name&&"Default"!==e.company.name&&e.company.name===this.contactService.userContact.company.name,f=this.getConversation(e.id);if(this.webrtcP2PService&&this.webrtcP2PService.started){const t=f?f.videoCall:null;t&&t.status!==r.Call.Status.UNKNOWN||("unknown"!==l&&"wait"!==l||!h)&&"online"!==l&&"online-mobile"!==l&&"away"!==l||((e.webrtcAudioEnabled||e.webrtcSharingEnabled)&&(n=true),s=true)}if(this.telephonyService.started){const t=e.phonePro||e.phonePbx&&e.pbxId||e.mobilePro||e.phonePerso||e.mobilePerso,r=this.telephonyService.getActiveCallsForContact(e);0===r.length&&t&&(i=true),d&&(0!==r.length||this.webrtcP2PService&&this.webrtcP2PService.isInMediaPillarAudioCallWithContactJid(d))&&(c=true)}"online"!==l&&"busy"!==l&&"away"!==l&&"dnd"!==l||(o=true);let p={telephony:i,webRTC:n,sharedDesktop:s,fileTransfert:o,mediaAvailable:i||n,addMedia:c};if((e.isBot||e.displayName&&-1!==e.displayName.indexOf("E-HELPER"))&&(p={telephony:false,webRTC:false,sharedDesktop:false,fileTransfert:false,mediaAvailable:false,addMedia:false}),e.capabilities=p,f){const e=Object.assign({},f.capabilities);f.capabilities=p,t||this.shallowEqual(e,p)||this.eventService.publish("ON_CONVERSATIONS_UPDATED_EVENT",f,a.Conversation.EventType.CAPABILITIES)}}computeCapabilitiesForMyContact(){let e=false,t=false,i=false,r=false,n=false;const s=this.contactService.userContact,o=this.webConferenceService&&this.webConferenceService.hasActiveConferenceSession&&this.webConferenceService.hasActiveConferenceSession()||this.webConferenceServiceV2&&this.webConferenceServiceV2.hasActiveWebConferenceSession();if(this.webrtcP2PService&&this.webrtcP2PService.started)if(o)t=false;else{if(this.webrtcP2PService.isUserContactInCall()){if(this.manageTwoWebrtcCallsAllowed){const e=this.webrtcP2PService.getCurrentActiveSessions().length;(e<2||2===e&&this.webrtcP2PService.getCurrentSharingCall())&&(t=true)}else this.isSecondWebrtcCallAllowed&&this.webrtcP2PService.existMediaPillarAudioCall()&&1===this.telephonyService.getCalls().length&&(t=true);this.webrtcP2PService.existMediaPillarAudioCall()&&!this.webrtcP2PService.getCurrentSharingCall()&&this.allowDesktopSharing()&&(i=true)}else(s.webrtcAudioEnabled||s.webrtcSharingEnabled)&&(t=true),this.allowDesktopSharing()&&(i=true)}if(this.telephonyService.started&&this.webrtcGatewayService.isMediaPillarCallSituation()){const e=this.telephonyService.getCalls(),t=this.webrtcP2PService&&this.webrtcP2PService.existWebrtcActiveSessionNotMP();if(this.contactService.userContact.attendantConsoleEnabled)r=true;else if(o)r=false;else if(this.manageTwoWebrtcCallsAllowed){const e=this.webrtcP2PService.getCurrentActiveSessions().length;(e<2||2===e&&this.webrtcP2PService.getCurrentSharingCall())&&(r=true,n=Boolean(e))}else if(this.isSecondWebrtcCallAllowed)if(t)r=!e.length;else{(0===e.length&&this.isBasicCallAllowed||1===e.length&&this.isSecondCallAllowed)&&(r=true),n=1===e.length;const t=this.telephonyService.getActiveCall();t&&t.isConference&&(n=false)}else(!t&&0===e.length&&this.isBasicCallAllowed||e.length>=1&&this.isSecondCallAllowed)&&(r=true)}else if(this.telephonyService.started&&!this.webrtcGatewayService.isMediaPillarCallSituation()){const e=this.telephonyService.getCalls();(0===e.length&&this.isBasicCallAllowed||e.length>=1&&this.isSecondCallAllowed)&&(r=true)}e=r;const a={telephony:e,webRTC:t,sharedDesktop:i,mediaAvailable:e||t,canReceiveSecondWebrtcCall:n};this.logger.debug("[ConversationService] computeCapabilitiesForMyContact  capabilities "+JSON.stringify(a)),s.capabilities=a}shallowEqual(e,t){const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return false;for(const n of i)if(e[n]!==t[n])return false;return true}onCallEvent(e,t=false){switch(e.type){case r.Call.Type.WEBRTC:this.handleWebRtcCallEvent(e);break;case r.Call.Type.PHONE:this.handleTelephonyCallEvent(e,t)}}async handleWebRtcCallEvent(e){if(this.webrtcGatewayService.isMediaPillarJid(e.fullJid)){if(this.eventService.publish("ON_MPMEDIA_CONVERSATION_CALL_UPDATED_EVENT",{call:e}),e.status===r.Call.Status.ACTIVE&&e.mediaPillarCall){(e.mediaPillarCall.telephonyCallRefs||[]).forEach((t=>{if(null!==t&&t.type.value===r.Call.Type.PHONE.value){const i=this.getConversation(t.conversationId);i&&i.rxSubject.next({name:"callUpdate",value:e})}}))}e.status!==r.Call.Status.RINGING_INCOMMING&&(this.computeCapabilitiesForMyContact(),e.mediaPillarCall&&e.mediaPillarCall.isIncomingCallPopupWithWebRtcCall&&this.eventService.publish("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:null,call:e}))}else this.getOrCreateConversation(e.contact.id,"contact").then((t=>{this.updateConversationCall(t,e),this.orderConversations(),t.rxSubject.next({name:"callUpdate",value:e}),this.eventService.publish("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:t,call:e}),this.isSecondWebrtcCallAllowed&&this.activeConversation&&(this.activeConversation.audioCall||this.activeConversation.videoCall)&&this.activeConversation.rxSubject.next({name:"otherCallUpdate",value:e})}))}existAnotherCallForContact(e){if(e.conversationId&&e.conversationId!==e.id)return false;return this.telephonyService.getCallsForContact(e.contact).some((t=>Boolean(t.conversationId)&&t.id!==e.id))}isTempTelephonyConversation(e){return!e.contact||e.contact.temp||e.contact.o365Flag||e.contact.companyDirectoryFlag||e.contact.personalDirectoryFlag||e.isConference||this.contactService.isUserContact(e.contact)||this.existAnotherCallForContact(e)}async handleTelephonyCallEvent(e,t=false){if(e.status===r.Call.Status.UNKNOWN){if(this.logger.info("[ConversationService] onCallEvent -- "+e+" conversation: "+e.conversationId),e.conversationId){const t=this.getConversation(e.conversationId);if(e.conversationId===e.id?(t&&(this.logger.info("[ConversationService] onCallEvent "+e.id+" UNKNOWN, conversation "+e.conversationId+" : removeConversation"),this.removeConversation(t)),this.eventService.publish("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:null,call:e})):(t&&(this.logger.info("[ConversationService] onCallEvent "+e.id+" UNKNOWN, conversation "+e.conversationId+" : set inactive"),t.audioCall=null),this.eventService.publish("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:t,call:e})),t&&t.rxSubject.next({name:"callUpdate",value:e}),this.orderConversations(),!this.activeConversation||this.activeConversation&&t&&this.activeConversation.id===t.id&&!this.telephonyService.isUserIdle()){const t=this.activeConversation,i=this.selectNewActiveConversation();this.logger.info("[ConversationService] onCallEvent "+e.id+" UNKNOWN, new Active Conversation : "+(i?i.id:"null")),i&&t&&t.id!==i.id&&(this.logger.debug("[ConversationService] onCallEvent "+e.id+" UNKNOWN, active conversation has changed to "+i.id),this.publish(s.RBEvent.create("activeConversation",i)))}"BUSY"===e.lastCause&&this.publish(s.RBEvent.create("callBusy")),this.activeConversation&&this.activeConversation.audioCall&&this.activeConversation.audioCall.status===r.Call.Status.RINGING_INCOMMING&&this.eventService.publish("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:this.activeConversation,call:this.activeConversation.audioCall}),!this.activeConversation||!this.activeConversation.audioCall&&!this.activeConversation.videoCall||t&&this.activeConversation.id===t.id||this.activeConversation.rxSubject.next({name:"otherCallUpdate",value:e})}else this.eventService.publish("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:null,call:e}),this.logger.error("[ConversationService] onCallEvent UNKNOWN for "+e.id+"/ Anomaly no conversationId !");e.contact&&!this.telephonyService.getConferenceCallForContact(e.contact)&&this.webrtcP2PService&&this.webrtcP2PService.endAllCallsForContact(e.contact),e.isConference&&setTimeout((()=>{(e.participants||[]).forEach((e=>{e&&0===this.telephonyService.getActiveCallsForContact(e).length&&this.webrtcP2PService&&this.webrtcP2PService.endAllCallsForContact(e)}))}),1e3)}if(!t&&this.webrtcGatewayService.isMediaPillarCallSituation(e)){if(!e.isSecondary)return this.eventService.publish("ON_UPDATE_TELEPHONY_ICON_EVENT"),void this.logger.info("[ConversationService] onCallEvent -- "+e+"=> event from handler IGNORED : MediaPillarCallSituation but not secondary call");if(e.status===r.Call.Status.RINGING_INCOMMING)return void this.logger.info("[ConversationService] onCallEvent -- "+e+"=> event from handler IGNORED : incoming mediapillar call events are dispatched by gateway service")}if(e.status!==r.Call.Status.UNKNOWN&&null!==e.connectionId){if(!this.isSecondCallAllowed){const t=this.telephonyService.getNotIdleCalls();if(t.length>1&&t.findIndex((t=>t.id===e.id))>0)return void this.logger.info("[ConversationService] onCallEvent -- "+e+"=> event from handler IGNORED : number of calls not supported (feature Second Call not Allowed)")}const t=this.isTempTelephonyConversation(e);this.logger.info("[ConversationService] onCallEvent -- "+e+" isTempConversation: "+t);let i=t?this.getOrCreateTelephonyConversation(e):this.getConversation(e.contact.id);i||(i=t?this.getOrCreateTelephonyConversation(e):await this.getOrCreateConversation(e.contact.id,"contact")),t&&!e.isConference&&e.conversationId===e.id&&!i.contact&&i.telephonyContacts&&(this.logger.info("[ConversationService] onCallEvent -- "+e.id+" : demote conference conversation to single conversation "+e.id),i.telephonyContacts=null,i.contact=e.contact,e.contact.conversation=i,i.rxSubject.next({name:"convContactChange",value:e})),t&&i.contact&&e.contact&&(e.contact.firstname||e.contact.lastname)&&i.contact.updateName(e.contact.firstname,e.contact.lastname);let n=false;if(e.conversationId&&e.conversationId!==i.id)if(this.logger.info("[ConversationService] onCallEvent -- "+e.id+" : conversation changed id "+e.conversationId+" => id "+i.id),e.isInExternalWindow&&this.eventService.publish("ON_REPLACE_CONVERSATIONS_IN_EXTERNAL_POPOUT",i,e),e.conversationId===e.id){const i=this.conversations[e.id];!t&&i&&(this.logger.info("[ConversationService] onCallEvent -- "+e.id+" : remove prevous temp conversation "+e.id),this.conversations[e.id]&&this.conversations[e.id].audioCall&&(this.conversations[e.id].audioCall=null),delete this.conversations[e.id],this.activeConversation&&this.activeConversation.id===i.id&&(n=true,this.setActiveConversation(null)))}else{const t=this.getConversation(e.conversationId);t&&(this.logger.info("[ConversationService] onCallEvent -- "+e.id+" : set previous conversation to known rainbow contact inactive "+e.conversationId),t.audioCall=null,this.activeConversation&&this.activeConversation.id===t.id&&(n=true,this.setActiveConversation(null)),this.eventService.publish("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:t,call:e}))}this.updateConversationCall(i,e),(e.status===r.Call.Status.ACTIVE||e.status===r.Call.Status.DIALING||e.status===r.Call.Status.RINGING_OUTGOING||e.status===r.Call.Status.QUEUED_OUTGOING||n)&&(this.eventService.publish("DISPLAY_CONVERSATIONS_IF_NECESSARY"),setTimeout((()=>{this.logger.info("[ConversationService] onCallEvent -- "+e.id+" : activate conversation "+i.id),this.publish(s.RBEvent.create("activeConversation",i)),i&&e.isInExternalWindow&&this.eventService.publish("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:i,call:e})}),400)),this.orderConversations(),this.eventService.publish("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:i,call:e}),i.rxSubject.next({name:"callUpdate",value:e}),this.activeConversation&&(this.activeConversation.audioCall||this.activeConversation.videoCall)&&this.activeConversation.id!==i.id&&this.activeConversation.rxSubject.next({name:"otherCallUpdate",value:e});if(e.getDeviceIdFromConnectionIdFromCall()!==e.relevantEquipmentId&&e.status!==r.Call.Status.ACTIVE)return void this.eventService.publish("ON_UPDATE_TELEPHONY_ICON_EVENT");e.status===r.Call.Status.ACTIVE&&e.isConference&&(e.participants||[]).forEach((e=>{e&&this.webrtcP2PService&&this.webrtcP2PService.endAllCallsForContact(e)}))}if(e.status===r.Call.Status.ERROR){let t=false;e.connectionId&&(!this.telephonyService.isSipWise()||"busy"!==e.errorMessage&&"invalidPhoneNumber"!==e.errorMessage&&"numberNotAllowed"!==e.errorMessage)||(t=true),t&&this.publish(s.RBEvent.create("callError",e))}}async onPGiConferenceStateEvent(e){if(e)try{const e=await this.roomService.retrieveCurrentPersonalAudioRoom();await this.getOrCreateConversation(e.jid,"room")}catch(t){this.logger.debug("[conversationService] error handling pgi conference event")}this.orderConversations()}onReloadCapabilitiesForMyContactEvent(){this.logger.info("[conversationService] onReloadCapabilitiesForMyContactEvent"),this.computeCapabilitiesForMyContact()}onConversationEvent(){this.updateMissedCounters()}onContactChangedEvent(e){this.computeCapabilitiesForContact(e),this.computeCapabilitiesForMyContact()}onTelephonyStateChangeEvent(){const e=this.getConversations();e&&e.forEach((e=>{e.type===a.Conversation.Type.ONE_TO_ONE&&this.computeCapabilitiesForContact(e.contact)})),this.computeCapabilitiesForMyContact()}onConferenceStateChangeEvent(){this.updateRoomConferences(),this.orderConversations(),this.eventService.publish("ON_CONVERSATIONS_UPDATED_EVENT")}onConferenceParticipantChangeEvent(){this.orderConversations(),this.eventService.publish("ON_CONVERSATIONS_UPDATED_EVENT")}onRoomChangedEvent(e,t){if(e){const i=this.getConversation(e.jid);i&&("remove"===t?this.closeConversation(i):(i.room=e,i.rxSubject.next({name:"roomUpdated",value:i})))}}onRoomHistoryChangedEvent(e){if(e){const t=this.getConversation(e.jid);t&&t.chatRenderer&&(t.reset(),t.chatRenderer.loadMore())}}onRoomAdminMessageEvent(e,t,i,r,n){this.logger.info("[conversationService] onRoomAdminMessageEvent");const s=this.getConversation(e);s&&"welcome"===i&&s.room&&s.room.ownerContact&&(t=s.room.ownerContact.jid);const o=this.contactService.getContactByJid(t);if(s&&o){if(!s.room.owner&&"invitation"===i)return;if(s.room&&s.room.isMeetingRoom())return;if(s.room&&s.room.isWebinarRoom())return;let e="";"voicemessage"===i&&(e=this.i18n.translate("huntingGroupVmCounters",{newMsgs:n.newMsgs,oldMsgs:n.oldMsgs})),this.conversationServiceEventHandler.onRoomAdminMessageReceived(s,o,i,r,e)}}onRoomAddConferenceEvent(){this.logger.info("[conversationService] onRoomAddConferenceEvent"),this.updateRoomConferences(),this.orderConversations(),this.eventService.publish("ON_CONVERSATIONS_UPDATED_EVENT")}onMyContactChangedEvent(){this.getOrderedConversations().idle.forEach((e=>{e.type===a.Conversation.Type.ONE_TO_ONE&&this.computeCapabilitiesForContact(e.contact)})),this.computeCapabilitiesForMyContact()}async reinit(){const e=[];try{this.logger.info("[conversationService] Re-initialize conversation service"),this.activeConversation&&(this.activeConversation.reset(),this.activeConversation=null),Object.keys(this.conversations).forEach((t=>{const i=this.conversations[t];i.innerHtml&&e.push({id:i.id,innerHtml:i.innerHtml})})),delete this.conversations,this.conversations=[],this.conversationCreationPromise||(this.conversationCreationPromise={}),this.isReinit=true,this.orderConversations(),this.logger.info("[conversationService] getServerConversations"),await this.getServerConversations(),this.isReinit=false,this.linkAllActiveCallsToConversations(),this.updateRoomConferences(),this.orderConversations(),this.missedInfoCounters.next(this.missedInfoCounters.value),e.length>0&&e.forEach((e=>{const t=this.getConversation(e.id);t&&(t.innerHtml=e.innerHtml)}))}catch(t){this.isReinit=false,setTimeout((async()=>{this.logger.info("[conversationService] getServerConversations failure, try again"),await this.getServerConversations(),this.linkAllActiveCallsToConversations(),this.updateRoomConferences(),this.orderConversations(),e.length>0&&e.forEach((e=>{const t=this.getConversation(e.id);t&&(t.innerHtml=e.innerHtml)}))}),1e4)}}linkAllActiveCallsToConversations(){this.telephonyService.calls&&Object.keys(this.telephonyService.calls).forEach((e=>{const t=this.telephonyService.calls[e];this.eventService.publish("ON_CALL_UPDATED_EVENT",t)})),this.webrtcP2PService&&this.webrtcP2PService.calls&&Object.keys(this.webrtcP2PService.calls).forEach((e=>{const t=this.webrtcP2PService.calls[e];this.eventService.publish("ON_CALL_UPDATED_EVENT",t)}))}async askForSharing(e,t){const i=$iq({from:this.xmppService.jid,to:t.fullJid,type:"set"});i.c("command",{xmlns:"http://jabber.org/protocol/commands",node:"request-transfert-sharing",convId:e}),await this.xmppService.sendIQ(i)}async acceptTransfertSharing(e,t){const i=$iq({from:this.xmppService.jid,to:t.fullJid,type:"set"});i.c("command",{xmlns:"http://jabber.org/protocol/commands",node:"accept-transfert-sharing",convId:e}),await this.xmppService.sendIQ(i)}async refuseTransfertSharing(e,t){const i=$iq({from:this.xmppService.jid,to:t.fullJid,type:"set"});i.c("command",{xmlns:"http://jabber.org/protocol/commands",node:"refuse-transfert-sharing",convId:e}),await this.xmppService.sendIQ(i)}onAskSharingMessageReceived(e){try{const t=$(e),i=t.attr("from"),r=this.contactService.getContactByJid(this.xmppService.getBareJidFromJid(i)),n=t.find("command"),s=n.attr("convId"),o=this.getConversation(s);if(n.length>0){const e=this.getActiveConversation();e&&s===e.id?this.onAskSharingIsOnActiveCall(n.attr("node"),o,r):this.onAskSharingIsNotOnActiveCall(n.attr("node"),r)}}catch(t){return true}return true}onAskSharingIsOnActiveCall(e,t,i){switch(e){case"request-transfert-sharing":t.rxSubject.next({name:"request-transfert-sharing",fromContact:i});break;case"accept-transfert-sharing":t.rxSubject.next({name:"accept-transfert-sharing",fromContact:i});break;case"refuse-transfert-sharing":t.rxSubject.next({name:"refuse-transfert-sharing",fromContact:i})}}onAskSharingIsNotOnActiveCall(e,t){switch(e){case"request-transfert-sharing":this.eventService.publish("GLOBAL_NOTIFY_MESSAGE_EVENT",this.i18n.translate("askForSharing",{displayName:t.displayName}));break;case"accept-transfert-sharing":this.eventService.publish("GLOBAL_NOTIFY_MESSAGE_EVENT",this.i18n.translate("acceptTransfertSharing",{displayName:t.displayName}));break;case"refuse-transfert-sharing":this.eventService.publish("GLOBAL_NOTIFY_MESSAGE_EVENT",this.i18n.translate("refuseTransfertSharing",{displayName:t.displayName}))}}cleanUnwantedConversations(){Object.keys(this.conversations).forEach((e=>{const t=this.conversations[e];t.type===a.Conversation.Type.ROOM&&(!this.contactService.userContact.roomsEnabled||t.room&&t.room.isMeetingRoom()&&!this.contactService.userContact.phoneMeetingsEnabled)&&(this.logger.info("cleanUnwantedConversations -- close conversation "+t.id+" due to customisation limitation"),this.closeConversation(t))}))}async openConversationWithEmily(){try{this.logger.info("[conversationService] openConversationWithEmily");const e=await this.botService.getEmily(),t=await this.getOrCreateConversation(e.jid,"contact");return this.setActiveConversation(t),t}catch(e){const t="[conversationService] openConversationWithEmily -- failure:"+e.message;throw this.logger.error(t),new Error(t)}}addChatMessage(e,t,i,r,s,o,a,c,l,d,u,h,f){if(e.getMessageById(s))return this.logger.info("[ConversationService] addChatMessage -- "+e.id+" add CHAT message ("+s+") already exists."),null;this.logger.info("[ConversationService] addChatMessage -- "+e.id+" add CHAT message ("+s+") from "+t.jid);const p=this.contactService.isUserContact(t)?"R":"L",g=n.Message.create(s,i,t,p,r,false,d,a,c,l,u);if(g.urgency=h,g.isForwarded=f,o?g.setReceiptStatus(n.Message.ReceiptStatus.IN_PROGRESS):g.setReceiptStatus(n.Message.ReceiptStatus.SENT),g.isAdaptiveCardResponse()){if(""===JSON.parse(g.additionalContent.message).rainbow.text)return g}return this.addMessage(e,g)}addAdminBubbleMessage(e,t,i,r,s,o=""){if(e.getMessageById(s))return this.logger.info("[ConversationService] addAdminBubbleMessage -- "+e.id+" add addAdminBubbleMessage message ("+s+") already exists."),null;this.logger.info("[ConversationService] addAdminBubbleMessage -- "+e.id+" add addAdminBubbleMessage from "+t.jid+" : "+r);let a=r+"MsgRoom";"voicemessage"===r&&(a=o);const c=n.Message.create(s,i,t,n.Message.Side.ADMIN,a,false);return c.setReceiptStatus(n.Message.ReceiptStatus.SENT),this.addMessage(e,c)}addFSMessage(e,t,i,r,s,o=null,c=null,l=null){const d=a.Conversation.getUniqueMessageId(),u=e.shortnameToUnicode(i),h=new Date;this.logger.info("[ConversationService] addFSMessage --"+e.id+" add FILE SHARING message from me");const f=n.Message.createFileSharingMessage(d,h,this.contactService.userContact,"R",u,r,t,null,s,o,l);return f.urgency=c,f.setReceiptStatus(n.Message.ReceiptStatus.IN_PROGRESS),this.addMessage(e,f)}addForwardChatMessage(e,t,i,r,s,o){if(e.getMessageById(r))return this.logger.info("[Conversation] "+e.id+" add ForwardChat message ("+r+") already exists."),null;this.logger.info("[Conversation] "+e.id+" add ForwardChat message ("+r+") from "+t.jid);const c=this.contactService.isUserContact(t)?"R":"L",l=n.Message.createFromMsg(s);return l.id=r,l.side=c,l.date=i,l.from=t,l.isForwarded=true,l.forwardedMsg=s,l.setReceiptStatus(n.Message.ReceiptStatus.IN_PROGRESS),l.forwardConvType=o.type===a.Conversation.Type.ONE_TO_ONE?"chat":"groupchat",this.addMessage(e,l),l}addRecordingMessage(e,t,i,r,s){const o=n.Message.createRecordingAdminMessage(s,i,t,r);return this.addMessage(e,o)}addFileMessage(e,t,i,r,s,o=null){this.logger.info("[Conversation] "+e.id+" add FILE message from "+t.jid+" : "+r);const a=this.contactService.isUserContact(t)?"R":"L",c=n.Message.createFileMessage(s,i,t,a,r,false);return c.urgency=o,this.addMessage(e,c)}addFileSharingMessage(e,t,i,r,s,o,a,c,l,d,u=null){this.logger.info("[Conversation] "+e.id+" add FILE SHARING message from "+t.jid+" : "+r);const h=this.contactService.isUserContact(t)?"R":"L",f=n.Message.createFileSharingMessage(s,i,t,h,r,false,o,a,null,c,u);return f.urgency=l,f.isForwarded=d,this.addMessage(e,f)}addWebRTCMessage(e,t,i,r,s){if(e.getMessageById(s))return this.logger.info("[Conversation] "+e.id+" add addWebRTCMessage message ("+s+") already exists."),null;const o=this.contactService.isUserContact(t)?n.Message.Side.RIGHT:n.Message.Side.LEFT,a=n.Message.createWebRTCMessage(s,i,t,o,r,false);return this.addMessage(e,a)}shouldUpdateLastEditableMsg(e){const t=e.side===n.Message.Side.RIGHT,i=e.type===n.Message.Type.CHAT,r=e.type===n.Message.Type.FS&&e.data&&e.fileName&&e.data!==e.fileName;return t&&(i||r)}addMessage(e,t){if(e.messages.find((e=>e.id===t.id)))return this.logger.info("[ConversationService] addMessage -- "+e.id+" try to add an already stored message with id "+t.id),t;if(t.side===n.Message.Side.LEFT)t.type===n.Message.Type.WEBRTC&&(e.missedCalls+=1),this.setStatusMessage(e,t.from,a.Conversation.Status.ACTIVE);else if(this.shouldUpdateLastEditableMsg(t)){const i=e.lastEditableMsg;e.lastEditableMsg=t,i&&i.sendUpdateEvent()}return e.messages.push(t),e.lastModification=new Date,e.lastMessageText=t.data,e.lastMessageSender=t.from.id,e.replaceLastMsgId=null,e.forwardFrom=t.isForwarded?t.from.jid:null,e.forwardedMessage=t.isForwarded?t.data:null,e.isForwardedMessageFile=Boolean(t.isForwarded&&t.fileName),e.lastMessageSide=t.side,e.rxSubject.next({name:"appendMessage",message:t}),this.eventService.publish("ON_CONVERSATION_UPDATED_EVENT",e.id),t}setStatusMessage(e,t,i){this.logger.info(`[ConversationService] setStatusMessage -- ${e.id} add status message from ${t.jid} : ${i.value}`),e.participantStatuses[t.jid]=i,e.rxSubject.next({name:"status",value:i})}isInCall(e){return e.pstnConferenceSession?e.pstnConferenceSession.isParticipantConnectedByJid(this.contactService.userContact.jid):e.webConferenceSession?e.webConferenceSession.isParticipantConnectedByJid(this.contactService.userContact.jid)&&e.webConferenceSession.haveJoined:e.videoCall&&e.videoCall.status&&"Unknown"!==e.videoCall.status.value&&"incommingCall"!==e.videoCall.status.value||e.audioCall&&e.audioCall.status&&"Unknown"!==e.audioCall.status.value&&(this.contactService.userContact.attendantConsoleEnabled||"incommingCall"!==e.audioCall.status.value&&"queuedIncomming"!==e.audioCall.status.value)}}t.ConversationService=D},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(19),n=i(17),s=i(4);class o{constructor(){this.userColors=["#ca8741","#e44647","#c62582","#9b4ce7","#6573ee","#1b70e0","#6ec7d9","#98d1b1","#7fbd40","#b2d334","#dcd232","#f1be00"],this.userColorNames=["purple-lavender","purple-violet","red-coral","blue-jeanlouisdavid","green-mint","green-yellow","orange-jade","pink-lady","yellow-submarine","blue-teal"],this.logger=s.LoggerService.getInstance(),this.settingsService=r.SettingsService.getInstance()}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.userInfoService||(e.rainbow.userInfoService=new o),e.rainbow.userInfoService}getAvatarImage(e,t,i,r,s){if(!(s=void 0!==s&&s))return t?this.createDefaultAvatarImage(t,i):null;let o=config.webservices.protocol+"://"+config.webservices.currentServer+"/api/avatar/"+e+"?size="+(r||256);return s&&(o+="&update="+n.MainService.MD5(s)),{src:o}}getNameInformation(e,t){const i={displayName:"",initials:""};return 1!==t.length&&2!==e.length?"FL"===this.settingsService.getSetting("displayOrder")?(i.displayName=e+" "+t,i.initials=e.charAt(0).toUpperCase()+t.charAt(0).toUpperCase()):(i.displayName=t+" "+e,i.initials=t.charAt(0).toUpperCase()+e.charAt(0).toUpperCase()):("FL"===this.settingsService.getSetting("displayOrder")?i.displayName=e+" "+t:i.displayName=t+" "+e,i.initials=e.charAt(0).toUpperCase()+e.charAt(1).toUpperCase()),i}createDefaultAvatarImage(e,t){const i=new Image,r=document.createElement("canvas");r.width=i.width=225,r.height=i.height=225;const n=r.getContext("2d");return n.rect(0,0,225,225),n.fillStyle=t,n.fill(),n.font="bold 100px Helvetica",n.textAlign="center",n.fillStyle="white",n.fillText(e,110,150),i.src=r.toDataURL("image/png"),i}computeUserColor(e){const t={colorIndex:0,color:this.userColors[0],colorName:this.userColorNames[0]};try{const i=e.toUpperCase();let r=0;for(let e=0;e<i.length;e++)r+=i.charCodeAt(e);t.colorIndex=r%12,t.color=this.userColors[t.colorIndex],t.colorName=this.userColorNames[t.colorIndex]}catch(i){this.logger.error("[UserInfoService] computeUserColor failure"),t.colorIndex=1,t.color=this.userColors[t.colorIndex],t.colorName=this.userColorNames[t.colorIndex]}return t}}t.UserInfoService=o},function(e,t,i){i.d(t,"a",(function(){return o}));var r=i(21),n=i(50),s=i(90);function o(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=e[e.length-1];return Object(r.a)(i)?(e.pop(),Object(s.a)(e,i)):Object(n.a)(e)}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.default=e=>{if(!e)return null;if(config&&config.debug)return e;let t="";return 0===e.indexOf("+")&&(t="+"),t=e.length>4?t+"*".repeat(e.length-4-t.length)+e.slice(e.length-4):e,t}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7),n=i(162);class s{constructor(e,t){this.type=e,this.message=t}static create(e,t){return new s(e,t)}}t.MessageAdditionalContent=s;class o{constructor(e,t,i,n,s,a,c=null,l=null,d=null,u=null,h=null,f=null,p=null,g=null){this.sendStatus=0,this.urlMetadata=null,this.urgencyAck=false,this.urgencyAckType=null,this.urgencyHandler=null,this.translatedText=null,this.modified=false,this.deleted=false,this.lastReadSubject=new r.BehaviorSubject(null),this.historyIndex=null,this.fileErrorMsg=null,this.shortFileDescriptor=null,this.attachedMsgId=null,this.forwardedMsg=null,this.id=e,this.date=t,this.from=i,this.side=n,this.data=s,this.status=a,this.fileId=c,this.additionalContent=l,this.subject=d,this.fileName=u,this.answeredMsgId=h,this.answeredMsgDate=f,this.geoloc=p,this.mentions=g,this.receiptStatus=o.ReceiptStatus.NONE,this.serverAckTimer=null,this.index=null,this.showCorrectedMessages=false,this.replaceMsgs=[],this.rxSubject=new r.Subject,this.isMerged=false}static create(e,t,i,r,n,s,a=null,c=null,l=null,d=null,u=null){const h=new o(e,t,i,r,n,s,null,a,c,null,l,d,null,u);return h.type=h.isAdaptiveCard()?o.Type.FORM:o.Type.CHAT,h}static createFromMsg(e){const t=o.create(e.id,e.date,e.from,e.side,e.data,e.status);return t.type=e.type,t.additionalContent=e.additionalContent,e.fileId&&(t.type=o.Type.FS,t.fileId=e.fileId,t.fileName=e.fileName),e.geoloc&&(t.geoloc=e.geoloc),t}static createFileSharingMessage(e,t,i,r,n,s,a,c,l,d,u=null){const h=new o(e,t,i,r,n,s,a,null,null,c,null,null,d,u);return h.type=o.Type.FS,l&&(h.attachedMsgId=l.attachedMsgId,h.attachIndex=l.index,h.attachNumber=l.number),h}static createFileMessage(e,t,i,r,n,s){const a=new o(e,t,i,r,n,s);return a.type=o.Type.FILE,a}static createWebRTCMessage(e,t,i,r,n,s){const a=new o(e,t,i,r,n,s);return a.type=o.Type.WEBRTC,a}static createBubbleAdminMessage(e,t,i,r,n){const s=n||r+"MsgRoom",a=new o(e,t,i,o.Side.ADMIN,s,null);return a.type=o.Type.CHAT,a}static createRecordingAdminMessage(e,t,i,r){const n=new o(e,t,i,o.Side.ADMIN,r+"Recording",null);return n.type=o.Type.RECORDING,n}sendUpdateEvent(e=null){this.rxSubject.next(e)}listenUpdateEvent(e){return this.rxSubject.subscribe(e)}isTextModified(){return this.replaceMsgs.length>0}isModified(){return this.modified||this.replaceMsgs.length>0&&""!==this.getLastTextModified()}isDeleted(){return this.deleted||0===this.getLastTextModified().length&&null===this.additionalContent}getLastTextModified(){return this.replaceMsgs.length>0?this.replaceMsgs[this.replaceMsgs.length-1].body:this.data}addReplaceMsg(e,t){const i=n.ReplaceMsg.create(e,t);this.replaceMsgs.push(i)}setReceiptStatus(e){return this.serverAckTimer&&e>o.ReceiptStatus.IN_PROGRESS&&(clearTimeout(this.serverAckTimer),this.serverAckTimer=null),e>this.receiptStatus&&(this.receiptStatus=e),this.sendUpdateEvent({name:"receiptStatus",value:e}),this}getInfoForLogs(){const e=this.data.length?this.data.substr(0,1)+"***"+this.data.substr(this.data.length-1):"";return"Id "+this.id+", type "+this.type.value+", side "+this.side+", date "+this.date+" and data "+e}modify(e){this.data=e.body,this.additionalContent=e.additionalContent,this.mentions=e.mentions,this.modified=true,this.deleted=null!==this.data&&0===this.data.length&&(null===this.additionalContent||void 0===this.additionalContent),this.sendUpdateEvent()}hasAdditionalContent(){return null!==this.additionalContent&&void 0!==this.additionalContent}isMarkDown(){return this.hasAdditionalContent()&&"text/markdown"===this.additionalContent.type}isAdaptiveCard(){return this.hasAdditionalContent()&&"form/json"===this.additionalContent.type}isAdaptiveCardResponse(){return this.hasAdditionalContent()&&"rainbow/json"===this.additionalContent.type}}o.Type={CHAT:{key:0,value:"Chat"},FILE:{key:1,value:"File"},FS:{key:2,value:"FileSharing"},WEBRTC:{key:4,value:"WebRTC CAll"},RECORDING:{key:5,value:"Recording"},FORM:{key:6,value:"FORM"},FORWARD:{key:7,value:"FORWARD"}},o.ReceiptStatus={NONE:0,ERROR:1,IN_PROGRESS:2,SENT:3,UNREAD:4,READ:5},o.SendStatus={NONE:0,ERROR:1},o.ReceiptStatusText=["close","error--filled","calllog","check","done","read"],o.Side={LEFT:"L",RIGHT:"R",ADMIN:"ADMIN"},t.Message=o;t.AnswerMessage=class{constructor(e,t,i){this.name=e,this.messageAnswered=t,this.answeredMessageData=i}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(391),n=i(392),s=i(7),o=i(18),a=i(4),c=i(19),l=i(14),d=i(393),u=i(399),h=i(6),f=i(8),p=i(13),g=i(71),m=i(9),v=i(400),S=i(401);t.glsl=String.raw,t.segmentationDimensions={model96:{height:96,width:160},model144:{height:144,width:256}},t.VIRTUAL_BACKGROUND_TYPE={IMAGE:"image",BLUR:"blur",BLUR_PLUS:"blur-plus",NONE:"none",VIDEO:"video"};class b{constructor(){this.fps=0,this.preProcessingDuration=0,this.inferenceDuration=0,this.postProcessingDuration=0,this.webglinitialization=0,this.resizingstage=0,this.tflite=0,this.softMax=0,this.jointBilateralFilter=0,this.realization=0,this.initialisation=0,this.synchro=0,this.copy=0,this.ecriture=0}static create(){return new b}computeAverage(){this.preProcessingDuration=this.preProcessingDuration?this.preProcessingDuration/this.fps:0,this.inferenceDuration=this.inferenceDuration?this.inferenceDuration/this.fps:0,this.postProcessingDuration=this.postProcessingDuration?this.postProcessingDuration/this.fps:0,this.webglinitialization=this.webglinitialization?this.webglinitialization/this.fps:0,this.resizingstage=this.resizingstage?this.resizingstage/this.fps:0,this.tflite=this.tflite?this.tflite/this.fps:0,this.softMax=this.softMax?this.softMax/this.fps:0,this.jointBilateralFilter=this.jointBilateralFilter?this.jointBilateralFilter/this.fps:0,this.realization=this.realization?this.realization/this.fps:0,this.initialisation=this.initialisation?this.initialisation/this.fps:0,this.synchro=this.synchro?this.synchro/this.fps:0,this.copy=this.copy?this.copy/this.fps:0,this.ecriture=this.ecriture?this.ecriture/this.fps:0}reset(){this.fps=this.preProcessingDuration=this.inferenceDuration=this.postProcessingDuration=this.webglinitialization=this.resizingstage=this.tflite=this.softMax=this.jointBilateralFilter=this.realization=this.initialisation=this.synchro=this.copy=this.ecriture=0}}t.VirtualBackgroundStats=b;class y{constructor(){if(this.settingsService=c.SettingsService.getInstance(),this.profileService=l.ProfileService.getInstance(),this.logger=a.LoggerService.getInstance(),this.contactService=h.ContactService.getInstance(),this.authService=f.AuthService.getInstance(),this.errorHelperService=p.ErrorHelperService.getInstance(),this.xmppService=m.XmppService.getInstance(),this.videoPipeline=null,this.statsEnabledFlag=true,this.statsInterval=null,this.started=false,this.isStreamMirrored=true,this.simdSupported=false,this.xmppSubscription=null,this.outputCanvasElement=null,this.videoElement=null,this.testVideo=null,this.rxSubject=new s.Subject,this.stats=new s.BehaviorSubject(b.create()),this.webglFlag=false,this.webglAllowed=false,this.models={model96:"/cacheV2/virtual-background/models/segm_lite_v681.tflite",model144:"/cacheV2/virtual-background/models/segm_full_v679.tflite"},this.settings={showVideoBackground:"false",webGLAllowed:"false",sigmaSpace:"1",sigmaColor:"0.1",coverageMax:"0.75",coverageMin:"0.5",lightWrapping:"0.3",blendMode:"screen"},this.webglSubscription=null,!this.wasmAvailable())return this.settingsService.setSetting("virtualBackgroundFlag","false"),void this.logger.warn("[VirtualBackgroundService] NOT AVAILABLE -- REASON : ENHANCED BROWSER SECUITY ACTIVATED FOR THIS SITE");this.settingsService.setSetting("virtualBackgroundFlag","true"),this.simdSupported=this.simdAvailable(),this.videoElement=document.createElement("video"),this.webglAvailable(),this.isStreamMirrored=this.settingsService.getBooleanSetting("virtualBackgroundMirror"),this.backgroundImages=new s.BehaviorSubject({companyBackgrounds:[],userBackgrounds:[]}),this.loadBg=new s.BehaviorSubject({loadPersonalBg:[]})}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.virtualBackgroundService||(e.rainbow.virtualBackgroundService=new y),e.rainbow.virtualBackgroundService}async start(){this.logger.info(`[VirtualBackgroundService] === Start === ${this.webglAllowed?"webgl":"canvas2d"} pipeline == simd ${this.simdSupported?"supported":"not supported"}`),this.backgroundImages.next(await this.getBackgrounds()),this.backgroundImages.value.companyBackgrounds.reverse(),this.backgroundImages.value.userBackgrounds.reverse(),this.loadBg.next({loadPersonalBg:[]}),this.xmppSubscription=this.xmppService.addHandler((e=>(this.onXmppEvent(e),true)),"jabber:iq:configuration","message","management")}async stop(){this.logger.info("[VirtualBackgroundService] === Stop ==="),this.backgroundImages.next({companyBackgrounds:[],userBackgrounds:[]}),this.loadBg.next({loadPersonalBg:[]}),this.cleanUp(),this.xmppSubscription&&(this.xmppService.deleteHandler(this.xmppSubscription),this.xmppSubscription=null),this.webglSubscription&&this.webglSubscription.unsubscribe()}async reconnect(){this.logger.info("[VirtualBackgroundService] === Reconnect ==="),this.cleanUp(),this.backgroundImages.next(await this.getBackgrounds()),this.loadBg.next({loadPersonalBg:[]}),this.xmppSubscription&&(this.xmppService.deleteHandler(this.xmppSubscription),this.xmppSubscription=null),this.xmppSubscription=this.xmppService.addHandler((e=>(this.onXmppEvent(e),true)),"jabber:iq:configuration","message","management")}onXmppEvent(e){try{const t=$(e).find("background"),i=t.attr("backgroundId"),r=t.attr("action"),n=t.attr("type");switch(this.logger.info(`[virtualBackgroundService] onXmppEvent-- ${r} `),r){case"create":setTimeout((()=>{"userBackgrounds"===n&&this.loadBg.next({loadPersonalBg:[]}),this.backgroundImages.value[n].unshift({id:i}),this.backgroundImages.next(this.backgroundImages.value)}),1);break;case"delete":this.backgroundImages.value[n].splice(this.backgroundImages.value[n].map((e=>e.id)).indexOf(i),1),this.backgroundImages.next(this.backgroundImages.value)}}catch(t){this.logger.error("[VirtualBackgroundService] onXmppEvent -- failure -- "+t.message)}return true}async startProcessStream(e,t){return this.logger.info("[VirtualBackgroundService] startProcessStream from service "+(t||"Unknown")),this.setInputStream(e)}async stopProcessStream(){this.logger.info("[VirtualBackgroundService] stopProcessStream "),await this.stopEffect()}async setBackgroundMode(e,i=""){const r=this.settingsService.getSetting("virtualBackgroundType"),n=this.settingsService.getSetting("imgVirtualBackground");e===r&&(e!==t.VIRTUAL_BACKGROUND_TYPE.IMAGE&&e!==t.VIRTUAL_BACKGROUND_TYPE.VIDEO||n===i)||(this.logger.info(`[VirtualBackgroundService] setBackgroundMode "${e}" ${i?'"'+i+'"':""} `),this.settingsService.setSetting("virtualBackgroundType",e),this.settingsService.setSetting("imgVirtualBackground",i),await this.setInputStream(this.stream),this.maskFrameTimerWorker.postMessage({id:v.SET_TIMEOUT,timeMs:1e3/30}),r!==t.VIRTUAL_BACKGROUND_TYPE.NONE&&e!==t.VIRTUAL_BACKGROUND_TYPE.NONE||this.rxSubject.next(o.RBEvent.create("UPDATE_STREAM",{stream:this.modifiedStream,type:e})))}getBackgroundMode(){return{type:this.settingsService.getSetting("virtualBackgroundType"),url:this.settingsService.getSetting("imgVirtualBackground")}}setMirror(e){this.settingsService.setSetting("virtualBackgroundMirror",e?"true":"false"),this.isStreamMirrored=e,this.rxSubject.next(o.RBEvent.create("UPDATE_STREAM_MIRROR"))}getMirror(){return this.isStreamMirrored}enableStats(e){this.statsEnabledFlag=e}webglAvailable(){this.cleanUp(),this.outputCanvasElement&&this.outputCanvasElement.remove(),this.outputCanvasElement=document.createElement("canvas"),this.outputCanvasElement.setAttribute("style","display:none"),this.webglFlag=S.parseBool("true"===this.getSetting("webGLAllowed")),this.webglFlag?(this.gl=this.outputCanvasElement.getContext("webgl2"),this.gl&&this.gl instanceof WebGL2RenderingContext?this.webglAllowed=true:(this.logger.warn("[VirtualBackgroundService] NOT AVAILABLE -- REASON : Failed to get Webgl2 context"),this.outputCanvasElement.remove(),this.outputCanvasElement=document.createElement("canvas"),this.outputCanvasElement.setAttribute("style","display:none"))):this.webglAllowed=false}async startEffect(e,i){try{this.options=i,this.options.segmentationDimensions=this.simdSupported?t.segmentationDimensions.model144:t.segmentationDimensions.model96,this.statsEnabledFlag&&(this.statsInterval=setInterval((()=>{this.stats.value.computeAverage(),this.stats.next(this.stats.value),this.stats.value.reset()}),1e3)),this.maskFrameTimerWorker=new Worker(v.timerWorkerScript,{name:"Virtual background effect worker"}),this.maskFrameTimerWorker.onmessage=this.onMaskFrameTimer;const r=e.getVideoTracks()[0],{height:n,frameRate:s,width:o}=r.getSettings?r.getSettings():r.getConstraints();this.videoElement.width=o,this.videoElement.height=n,this.videoElement.srcObject=e,this.videoElement.onloadeddata=async()=>{this.videoElement.muted=true,await this.videoElement.play(),this.maskFrameTimerWorker.postMessage({id:v.SET_TIMEOUT,timeMs:1e3/30})},this.outputCanvasElement.width=o,this.outputCanvasElement.height=n,this.videoPipeline=this.webglAllowed?d.Webgl2Pipeline.create():u.Canvas2DPipeline.create(),this.videoPipeline.init();const a=this.outputCanvasElement.captureStream(s);return e.getAudioTracks().length>0&&a.addTrack(e.getAudioTracks()[0].clone()),a}catch(r){return this.logger.error("[VirtualBackgroundService] startEffect -- Failure -- "+r.message),null}}async stopEffect(){this.maskFrameTimerWorker&&(this.maskFrameTimerWorker.postMessage({id:v.CLEAR_TIMEOUT}),this.maskFrameTimerWorker.terminate(),this.videoElement.pause(),this.videoElement.srcObject=null),this.statsInterval&&clearInterval(this.statsInterval)}async setInputStream(e){const i=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.BLURRING_UI_2_0)&&"true"===this.settingsService.getSetting("virtualBackgroundFlag")?this.settingsService.getSetting("virtualBackgroundType"):t.VIRTUAL_BACKGROUND_TYPE.NONE,r=this.settingsService.getSetting("imgVirtualBackground");return this.stream=e,i===t.VIRTUAL_BACKGROUND_TYPE.NONE||0===this.stream.getVideoTracks().length?(await this.stopEffect(),this.modifiedStream=this.stream):(await this.initVirtualBackground(),await this.stopEffect(),this.modifiedStream=await this.startEffect(this.stream,{backgroundType:i,imgBg:r})),this.modifiedStream}async initVirtualBackground(){try{if(!this.started){this.started=true,this.videoElement.play(),this.simdSupported?this.tflite=await n({locateFile:()=>"/cacheV2/virtual-background/tflite/tflite-simd.wasm"}):this.tflite=await r({locateFile:()=>"/cacheV2/virtual-background/tflite/tflite.wasm"});const e=await fetch(this.simdSupported?this.models.model144:this.models.model96),i=this.tflite._getModelBufferMemoryOffset();if(!e.ok)throw new Error("Failed to download tflite model!");const s=await e.arrayBuffer();this.tflite.HEAPU8.set(new Uint8Array(s),i),this.tflite._loadModel(s.byteLength),this.segmentationPixelCount=this.simdSupported?t.segmentationDimensions.model144.width*t.segmentationDimensions.model144.height:t.segmentationDimensions.model96.width*t.segmentationDimensions.model96.height,this.outputMemoryOffset=this.tflite._getOutputMemoryOffset()/4,this.onMaskFrameTimer=this.onMaskFrameTimer.bind(this)}}catch(e){this.logger.error(`[VirtualBackgroundService] initVirtualBackground-- failure-- ${e.message} `)}}onMaskFrameTimer(e){e.data.id===v.TIMEOUT_TICK&&this.render()}wasmAvailable(){return"object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate}simdAvailable(){if(!this.wasmAvailable())return false;const e=((...e)=>((...e)=>Uint32Array.of(1836278016,1,...e))(1610679297,33751040,...e,40239360,259))(84344833,6357249,17369600,4259847,186257917,1845758464);return WebAssembly.validate(e)}async render(){try{this.videoPipeline.render(),this.maskFrameTimerWorker.postMessage({id:v.SET_TIMEOUT,timeMs:1e3/30})}catch(e){this.logger.error(`[VirtualBackgroundService] render-- failure-- ${e.message} `)}}cleanUp(){this.videoPipeline&&this.videoPipeline.cleanUp(),this.statsInterval&&clearInterval(this.statsInterval)}async getBackgrounds(){try{const e=this.contactService.userContact.dbId,t=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${e}/backgrounds`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;return(await r.json()).data}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getBackgrounds");throw this.logger.error("[VirtualBackgroundService] "+t.message),t.error}}async putPersonnalBackgroundImage(e,t){try{const i=this.contactService.userContact.dbId,r=g.getBinaryData(e);this.loadBg.value.loadPersonalBg.unshift({url:t}),this.loadBg.next(this.loadBg.value);const n=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${i}/backgrounds/upload`,s=this.authService.getPostHeader("image/"+r.type),o=await fetch(n,{method:"POST",headers:s,body:r.data});if(!o.ok)throw o;return await o.json()}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"putPersonnalBackgroudImage");throw this.logger.error("[VirtualBackgroundService] "+e.message),e.error}}async deletePersonnalBackgroundImage(e){try{const t=this.contactService.userContact.dbId,i=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${t}/backgrounds/${e}`,r=this.authService.getPostHeader(),n=await fetch(i,{method:"DELETE",headers:r});if(!n.ok)throw n}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"deletePersonnalBackgroundImage");throw this.logger.error("[VirtualBackgroundService] "+e.message),e.error}}async putAdminBackgroundImage(e){try{const t=this.contactService.userContact.company.id,i=g.getBinaryData(e),r=`${config.restServerUrl}/api/rainbow/admin/v1.0/companies/${t}/backgrounds/upload`,n=this.authService.getPostHeader("image/"+i.type),s=await fetch(r,{method:"POST",headers:n,body:i.data});if(!s.ok)throw s;return await s.json()}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"putAdminBackgroundImage");throw this.logger.error("[VirtualBackgroundService] "+e.message),e.error}}async deleteAdminBackgroundImage(e){try{const t=this.contactService.userContact.company.id,i=`${config.restServerUrl}/api/rainbow/admin/v1.0/companies/${t}/backgrounds/${e}`,r=this.authService.getPostHeader(),n=await fetch(i,{method:"DELETE",headers:r});if(!n.ok)throw n}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"deleteAdminBackgroundImage");throw this.logger.error("[VirtualBackgroundService] "+e.message),e.error}}setSetting(e,t){switch(e){case"webGLAllowed":this.settings[e]=t,localStorage.setItem(e,t),this.webglAvailable();break;case"showVideoBackground":this.settings[e]=t,localStorage.setItem(e,t);break;case"sigmaColor":case"sigmaSpace":case"coverageMax":case"coverageMin":case"lightWrapping":case"blendMode":this.settings[e]=t,localStorage.setItem(e,t),this.setPostProcessingValue(),this.webglAllowed&&this.videoPipeline.updatePostProcessingConfig()}}getSetting(e){return this.settings[e]}setPostProcessingValue(){this.sigmaSpace=this.getSetting("sigmaSpace"),this.sigmaColor=this.getSetting("sigmaColor"),this.coverageMax=this.getSetting("coverageMax"),this.coverageMin=this.getSetting("coverageMin"),this.lightWrapping=this.getSetting("lightWrapping"),this.blendMode=this.getSetting("blendMode")}}t.VirtualBackgroundService=y,t.default=y.getInstance()},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.clearElementChildren=t.getScrollY=t.getScrollX=t.getFitStatus=t.truncate=t.stringToCssColor=t.parseEnum=t.getEnumValueByName=t.parseBool=t.parseNumber=t.parseString=t.appendChild=t.generateUniqueId=t.isMobileOS=t.isInternetExplorer=void 0;var r=i(55),n=i(61);function s(e,t){for(var i in e){var r=parseInt(i,10);if(r>=0){var n=e[i];if(n&&"string"==typeof n&&n.toLowerCase()===t.toLowerCase())return r}}}function o(e,t){for(t+=1;t<e.length&&"<"==e[t];)for(;t<e.length&&">"!=e[t++];);return t}t.isInternetExplorer=function(){return void 0!==window.document.documentMode},t.isMobileOS=function(){var e=window.navigator.userAgent;return!!e.match(/Android/i)||!!e.match(/iPad/i)||!!e.match(/iPhone/i)},t.generateUniqueId=function(){return"__ac-"+n.UUID.generate()},t.appendChild=function(e,t){t&&e.appendChild(t)},t.parseString=function(e,t){return"string"==typeof e?e:t},t.parseNumber=function(e,t){return"number"==typeof e?e:t},t.parseBool=function(e,t){if("boolean"==typeof e)return e;if("string"==typeof e)switch(e.toLowerCase()){case"true":return true;case"false":return false;default:return t}return t},t.getEnumValueByName=s,t.parseEnum=function(e,t,i){if(!t)return i;var r=s(e,t);return void 0!==r?r:i},t.stringToCssColor=function(e){if(e){var t=/#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})?/gi.exec(e);if(t&&t[4]){var i=parseInt(t[1],16)/255;return"rgba("+parseInt(t[2],16)+","+parseInt(t[3],16)+","+parseInt(t[4],16)+","+i+")"}}return e},t.truncate=function(e,t,i){var r=function(){return t-e.scrollHeight>=-1};if(!r()){for(var n=e.innerHTML,s=function(t){e.innerHTML=n.substring(0,t)+"..."},a=function(e){var t=[],i=o(e,-1);for(;i<e.length;)" "==e[i]&&t.push(i),i=o(e,i);return t}(n),c=0,l=a.length,d=0;c<l;){var u=Math.floor((c+l)/2);s(a[u]),r()?(d=a[u],c=u+1):l=u}if(s(d),i&&t-e.scrollHeight>=i-1){for(var h=o(n,d);h<n.length&&(s(h),r());)d=h,h=o(n,h);s(d)}}},t.getFitStatus=function(e,t){var i=e.offsetTop;return i+e.clientHeight<=t?r.ContainerFitStatus.FullyInContainer:i<t?r.ContainerFitStatus.Overflowing:r.ContainerFitStatus.FullyOutOfContainer},t.getScrollX=function(){return window.pageXOffset},t.getScrollY=function(){return window.pageYOffset},t.clearElementChildren=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}},function(e,t,i){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:true}),t.SerializableObject=t.property=t.SerializableObjectSchema=t.CustomProperty=t.SerializableObjectCollectionProperty=t.SerializableObjectProperty=t.EnumProperty=t.ValueSetProperty=t.StringArrayProperty=t.PixelSizeProperty=t.NumProperty=t.BoolProperty=t.StringProperty=t.PropertyDefinition=t.BaseSerializationContext=t.isVersionLessOrEqual=t.Versions=t.Version=void 0;var s=i(61),o=i(68),a=i(55),c=i(79),l=function(){function e(e,t,i){void 0===e&&(e=1),void 0===t&&(t=1),this._isValid=true,this._major=e,this._minor=t,this._label=i}return e.parse=function(t,i){if(t){var r=new e;r._versionString=t;var n=/(\d+).(\d+)/gi.exec(t);return null!=n&&3==n.length?(r._major=parseInt(n[1]),r._minor=parseInt(n[2])):r._isValid=false,r._isValid||i.logParseEvent(void 0,a.ValidationEvent.InvalidPropertyValue,c.Strings.errors.invalidVersionString(r._versionString)),r}},e.prototype.toString=function(){return this._isValid?this._major+"."+this._minor:this._versionString},e.prototype.toJSON=function(){return this.toString()},e.prototype.compareTo=function(e){if(!this.isValid||!e.isValid)throw new Error("Cannot compare invalid version.");return this.major>e.major?1:this.major<e.major?-1:this.minor>e.minor?1:this.minor<e.minor?-1:0},Object.defineProperty(e.prototype,"label",{get:function(){return this._label?this._label:this.toString()},enumerable:false,configurable:true}),Object.defineProperty(e.prototype,"major",{get:function(){return this._major},enumerable:false,configurable:true}),Object.defineProperty(e.prototype,"minor",{get:function(){return this._minor},enumerable:false,configurable:true}),Object.defineProperty(e.prototype,"isValid",{get:function(){return this._isValid},enumerable:false,configurable:true}),e}();t.Version=l;var d=function(){function e(){}return e.v1_0=new l(1,0),e.v1_1=new l(1,1),e.v1_2=new l(1,2),e.v1_3=new l(1,3),e.v1_4=new l(1,4),e.v1_5=new l(1,5),e.latest=e.v1_5,e}();t.Versions=d,t.isVersionLessOrEqual=function(e,t){return!(e instanceof l)||(!(t instanceof l)||t.compareTo(e)>=0)};var u=function(){function e(e){void 0===e&&(e=d.latest),this.targetVersion=e,this._validationEvents=[]}return e.prototype.serializeValue=function(e,t,i,r,n){void 0===r&&(r=void 0),void 0===n&&(n=false),null==i||i===r?s.GlobalSettings.enableFullJsonRoundTrip&&!n||delete e[t]:i===r?delete e[t]:e[t]=i},e.prototype.serializeString=function(e,t,i,r){null==i||i===r?delete e[t]:e[t]=i},e.prototype.serializeBool=function(e,t,i,r){null==i||i===r?delete e[t]:e[t]=i},e.prototype.serializeNumber=function(e,t,i,r){null==i||i===r||isNaN(i)?delete e[t]:e[t]=i},e.prototype.serializeEnum=function(e,t,i,r,n){void 0===n&&(n=void 0),null==r||r===n?delete t[i]:t[i]=e[r]},e.prototype.serializeArray=function(e,t,i){var r=[];if(i)for(var n=0,s=i;n<s.length;n++){var o=s[n],a=void 0;void 0!==(a=o instanceof T?o.toJSON(this):o.toJSON?o.toJSON():o)&&r.push(a)}0==r.length?e.hasOwnProperty(t)&&Array.isArray(e[t])&&delete e[t]:this.serializeValue(e,t,r)},e.prototype.clearEvents=function(){this._validationEvents=[]},e.prototype.logEvent=function(e,t,i,r){this._validationEvents.push({source:e,phase:t,event:i,message:r})},e.prototype.logParseEvent=function(e,t,i){this.logEvent(e,a.ValidationPhase.Parse,t,i)},e.prototype.getEventAt=function(e){return this._validationEvents[e]},Object.defineProperty(e.prototype,"eventCount",{get:function(){return this._validationEvents.length},enumerable:false,configurable:true}),e}();t.BaseSerializationContext=u;var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(u),f=function(){function e(t,i,r,n){this.targetVersion=t,this.name=i,this.defaultValue=r,this.onGetInitialValue=n,this.isSerializationEnabled=true,this.sequentialNumber=e._sequentialNumber,e._sequentialNumber++}return e.prototype.getInternalName=function(){return this.name},e.prototype.parse=function(e,t,i){return t[this.name]},e.prototype.toJSON=function(e,t,i,r){r.serializeValue(t,this.name,i,this.defaultValue)},e._sequentialNumber=0,e}();t.PropertyDefinition=f;var p=function(e){function t(t,i,r,n,s,o){void 0===r&&(r=true);var a=e.call(this,t,i,s,o)||this;return a.targetVersion=t,a.name=i,a.treatEmptyAsUndefined=r,a.regEx=n,a.defaultValue=s,a.onGetInitialValue=o,a}return n(t,e),t.prototype.parse=function(e,t,i){var r=o.parseString(t[this.name],this.defaultValue);if(!(void 0===r||""===r&&this.treatEmptyAsUndefined)&&void 0!==this.regEx&&!this.regEx.exec(r))return void i.logParseEvent(e,a.ValidationEvent.InvalidPropertyValue,c.Strings.errors.invalidPropertyValue(r,this.name));return r},t.prototype.toJSON=function(e,t,i,r){r.serializeString(t,this.name,""===i&&this.treatEmptyAsUndefined?void 0:i,this.defaultValue)},t}(f);t.StringProperty=p;var g=function(e){function t(t,i,r,n){var s=e.call(this,t,i,r,n)||this;return s.targetVersion=t,s.name=i,s.defaultValue=r,s.onGetInitialValue=n,s}return n(t,e),t.prototype.parse=function(e,t,i){return o.parseBool(t[this.name],this.defaultValue)},t.prototype.toJSON=function(e,t,i,r){r.serializeBool(t,this.name,i,this.defaultValue)},t}(f);t.BoolProperty=g;var m=function(e){function t(t,i,r,n){var s=e.call(this,t,i,r,n)||this;return s.targetVersion=t,s.name=i,s.defaultValue=r,s.onGetInitialValue=n,s}return n(t,e),t.prototype.parse=function(e,t,i){return o.parseNumber(t[this.name],this.defaultValue)},t.prototype.toJSON=function(e,t,i,r){r.serializeNumber(t,this.name,i,this.defaultValue)},t}(f);t.NumProperty=m;var v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.parse=function(e,t,i){var r=void 0,n=t[this.name];if("string"==typeof n){var o=false;try{var l=s.SizeAndUnit.parse(n,true);l.unit==a.SizeUnit.Pixel&&(r=l.physicalSize,o=true)}catch(d){}o||i.logParseEvent(e,a.ValidationEvent.InvalidPropertyValue,c.Strings.errors.invalidPropertyValue(t[this.name],"minHeight"))}return r},t.prototype.toJSON=function(e,t,i,r){r.serializeValue(t,this.name,"number"!=typeof i||isNaN(i)?void 0:i+"px")},t}(f);t.PixelSizeProperty=v;var S=function(e){function t(t,i,r,n){var s=e.call(this,t,i,r,n)||this;return s.targetVersion=t,s.name=i,s.defaultValue=r,s.onGetInitialValue=n,s}return n(t,e),t.prototype.parse=function(e,t,i){var r=t[this.name];if(void 0===r||!Array.isArray(r))return this.defaultValue;for(var n=[],s=0,o=r;s<o.length;s++){var c=o[s];"string"==typeof c?n.push(c):i.logParseEvent(e,a.ValidationEvent.InvalidPropertyValue,'Invalid array value "'+c+'" of type "'+typeof c+'" ignored for "'+this.name+'".')}return n},t.prototype.toJSON=function(e,t,i,r){r.serializeArray(t,this.name,i)},t}(f);t.StringArrayProperty=S;var b=function(e){function t(t,i,r,n,s){var o=e.call(this,t,i,n,s)||this;return o.targetVersion=t,o.name=i,o.values=r,o.defaultValue=n,o.onGetInitialValue=s,o}return n(t,e),t.prototype.isValidValue=function(e,t){for(var i=0,r=this.values;i<r.length;i++){var n=r[i];if(e.toLowerCase()===n.value.toLowerCase())return(n.targetVersion?n.targetVersion:this.targetVersion).compareTo(t.targetVersion)<=0}return false},t.prototype.parse=function(e,t,i){var r=t[this.name];if(void 0===r)return this.defaultValue;if("string"==typeof r)for(var n=0,s=this.values;n<s.length;n++){var o=s[n];if(r.toLowerCase()===o.value.toLowerCase()){var l=o.targetVersion?o.targetVersion:this.targetVersion;return l.compareTo(i.targetVersion)<=0?o.value:(i.logParseEvent(e,a.ValidationEvent.InvalidPropertyValue,c.Strings.errors.propertyValueNotSupported(r,this.name,l.toString(),i.targetVersion.toString())),this.defaultValue)}}return i.logParseEvent(e,a.ValidationEvent.InvalidPropertyValue,c.Strings.errors.invalidPropertyValue(r,this.name)),this.defaultValue},t.prototype.toJSON=function(e,t,i,r){var n=false;if(void 0!==i){n=true;for(var s=0,o=this.values;s<o.length;s++){var l=o[s];if(l.value===i){var d=l.targetVersion?l.targetVersion:this.targetVersion;if(d.compareTo(r.targetVersion)<=0){n=false;break}r.logEvent(e,a.ValidationPhase.ToJSON,a.ValidationEvent.InvalidPropertyValue,c.Strings.errors.propertyValueNotSupported(i,this.name,d.toString(),r.targetVersion.toString()))}}}n||r.serializeValue(t,this.name,i,this.defaultValue,true)},t}(f);t.ValueSetProperty=b;var y=function(e){function t(t,i,r,n,s,o){var a=e.call(this,t,i,n,o)||this;if(a.targetVersion=t,a.name=i,a.enumType=r,a.defaultValue=n,a.onGetInitialValue=o,a._values=[],s)a._values=s;else for(var c in r){var l=parseInt(c,10);l>=0&&a._values.push({value:l})}return a}return n(t,e),t.prototype.parse=function(e,t,i){var r=t[this.name];if("string"!=typeof r)return this.defaultValue;var n=o.getEnumValueByName(this.enumType,r);if(void 0!==n)for(var s=0,l=this.values;s<l.length;s++){var d=l[s];if(d.value===n){var u=d.targetVersion?d.targetVersion:this.targetVersion;return u.compareTo(i.targetVersion)<=0?n:(i.logParseEvent(e,a.ValidationEvent.InvalidPropertyValue,c.Strings.errors.propertyValueNotSupported(r,this.name,u.toString(),i.targetVersion.toString())),this.defaultValue)}}return i.logParseEvent(e,a.ValidationEvent.InvalidPropertyValue,c.Strings.errors.invalidPropertyValue(r,this.name)),this.defaultValue},t.prototype.toJSON=function(e,t,i,r){var n=false;if(void 0!==i){n=true;for(var s=0,o=this.values;s<o.length;s++){var l=o[s];if(l.value===i){if((l.targetVersion?l.targetVersion:this.targetVersion).compareTo(r.targetVersion)<=0){n=false;break}r.logEvent(e,a.ValidationPhase.ToJSON,a.ValidationEvent.InvalidPropertyValue,c.Strings.errors.invalidPropertyValue(i,this.name))}}}n||r.serializeEnum(this.enumType,t,this.name,i,this.defaultValue)},Object.defineProperty(t.prototype,"values",{get:function(){return this._values},enumerable:false,configurable:true}),t}(f);t.EnumProperty=y;var C=function(e){function t(t,i,r,n,s){void 0===n&&(n=false);var o=e.call(this,t,i,s,(function(e){return o.nullable?void 0:new o.objectType}))||this;return o.targetVersion=t,o.name=i,o.objectType=r,o.nullable=n,o}return n(t,e),t.prototype.parse=function(e,t,i){var r=t[this.name];if(void 0===r)return this.onGetInitialValue?this.onGetInitialValue(e):this.defaultValue;var n=new this.objectType;return n.parse(r,i),n},t.prototype.toJSON=function(e,t,i,r){var n=void 0;void 0===i||i.hasAllDefaultValues()||(n=i.toJSON(r)),"object"==typeof n&&0===Object.keys(n).length&&(n=void 0),r.serializeValue(t,this.name,n,this.defaultValue,true)},t}(f);t.SerializableObjectProperty=C;var w=function(e){function t(t,i,r,n){var s=e.call(this,t,i,void 0,(function(e){return[]}))||this;return s.targetVersion=t,s.name=i,s.objectType=r,s.onItemAdded=n,s}return n(t,e),t.prototype.parse=function(e,t,i){var r=[],n=t[this.name];if(Array.isArray(n))for(var s=0,o=n;s<o.length;s++){var a=o[s],c=new this.objectType;c.parse(a,i),r.push(c),this.onItemAdded&&this.onItemAdded(e,c)}return r.length>0?r:this.onGetInitialValue?this.onGetInitialValue(e):void 0},t.prototype.toJSON=function(e,t,i,r){r.serializeArray(t,this.name,i)},t}(f);t.SerializableObjectCollectionProperty=w;var _=function(e){function t(t,i,r,n,s,o){var a=e.call(this,t,i,s,o)||this;if(a.targetVersion=t,a.name=i,a.onParse=r,a.onToJSON=n,a.defaultValue=s,a.onGetInitialValue=o,!a.onParse)throw new Error("CustomPropertyDefinition instances must have an onParse handler.");if(!a.onToJSON)throw new Error("CustomPropertyDefinition instances must have an onToJSON handler.");return a}return n(t,e),t.prototype.parse=function(e,t,i){return this.onParse(e,this,t,i)},t.prototype.toJSON=function(e,t,i,r){this.onToJSON(e,this,t,i,r)},t}(f);t.CustomProperty=_;var E=function(){function e(){this._properties=[]}return e.prototype.indexOf=function(e){for(var t=0;t<this._properties.length;t++)if(this._properties[t]===e)return t;return-1},e.prototype.add=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var i=0;i<e.length;i++)-1===this.indexOf(e[i])&&this._properties.push(e[i])},e.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var i=0,r=e;i<r.length;i++)for(var n=r[i];;){var s=this.indexOf(n);if(!(s>=0))break;this._properties.splice(s,1)}},e.prototype.getItemAt=function(e){return this._properties[e]},e.prototype.getCount=function(){return this._properties.length},e}();t.SerializableObjectSchema=E,t.property=function(e){return function(t,i){var r=Object.getOwnPropertyDescriptor(t,i)||{};r.get||r.set||(r.get=function(){return this.getValue(e)},r.set=function(t){this.setValue(e,t)},Object.defineProperty(t,i,r))}};var T=function(){function e(){this._propertyBag={},this._rawProperties={},this.maxVersion=e.defaultMaxVersion;for(var t=this.getSchema(),i=0;i<t.getCount();i++){var r=t.getItemAt(i);r.onGetInitialValue&&this.setValue(r,r.onGetInitialValue(this))}}return e.prototype.getDefaultSerializationContext=function(){return new h},e.prototype.populateSchema=function(t){var i=this.constructor,r=[];for(var n in i)try{var s=i[n];s instanceof f&&r.push(s)}catch(a){}if(r.length>0){var o=r.sort((function(e,t){return e.sequentialNumber>t.sequentialNumber?1:e.sequentialNumber<t.sequentialNumber?-1:0}));t.add.apply(t,o)}e.onRegisterCustomProperties&&e.onRegisterCustomProperties(this,t)},e.prototype.getValue=function(e){return this._propertyBag.hasOwnProperty(e.getInternalName())?this._propertyBag[e.getInternalName()]:e.defaultValue},e.prototype.setValue=function(e,t){null==t?delete this._propertyBag[e.getInternalName()]:this._propertyBag[e.getInternalName()]=t},e.prototype.internalParse=function(e,t){if(this._propertyBag={},this._rawProperties=s.GlobalSettings.enableFullJsonRoundTrip&&e||{},e)for(var i=this.getSchema(),r=0;r<i.getCount();r++){var n=i.getItemAt(r);if(n.isSerializationEnabled){var o=n.onGetInitialValue?n.onGetInitialValue(this):void 0;e.hasOwnProperty(n.name)&&(n.targetVersion.compareTo(t.targetVersion)<=0?o=n.parse(this,e,t):t.logParseEvent(this,a.ValidationEvent.UnsupportedProperty,c.Strings.errors.propertyNotSupported(n.name,n.targetVersion.toString(),t.targetVersion.toString()))),this.setValue(n,o)}}else this.resetDefaultValues()},e.prototype.internalToJSON=function(e,t){for(var i=this.getSchema(),r=[],n=0;n<i.getCount();n++){var s=i.getItemAt(n);s.isSerializationEnabled&&s.targetVersion.compareTo(t.targetVersion)<=0&&-1===r.indexOf(s.name)&&(s.toJSON(this,e,this.getValue(s),t),r.push(s.name))}},e.prototype.shouldSerialize=function(e){return true},e.prototype.parse=function(e,t){this.internalParse(e,t||new h)},e.prototype.toJSON=function(e){var t;if(e&&e instanceof u?t=e:(t=this.getDefaultSerializationContext()).toJSONOriginalParam=e,this.shouldSerialize(t)){var i=void 0;return i=s.GlobalSettings.enableFullJsonRoundTrip&&this._rawProperties&&"object"==typeof this._rawProperties?this._rawProperties:{},this.internalToJSON(i,t),i}},e.prototype.hasDefaultValue=function(e){return this.getValue(e)===e.defaultValue},e.prototype.hasAllDefaultValues=function(){for(var e=this.getSchema(),t=0;t<e.getCount();t++){var i=e.getItemAt(t);if(!this.hasDefaultValue(i))return false}return true},e.prototype.resetDefaultValues=function(){for(var e=this.getSchema(),t=0;t<e.getCount();t++){var i=e.getItemAt(t);this.setValue(i,i.defaultValue)}},e.prototype.setCustomProperty=function(e,t){"string"==typeof t&&!t||null==t?delete this._rawProperties[e]:this._rawProperties[e]=t},e.prototype.getCustomProperty=function(e){return this._rawProperties[e]},e.prototype.getSchema=function(){var t=e._schemaCache[this.getSchemaKey()];return t||(t=new E,this.populateSchema(t),e._schemaCache[this.getSchemaKey()]=t),t},e.defaultMaxVersion=d.latest,e._schemaCache={},e}();t.SerializableObject=T},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7),n=i(28),s=i(1),o=i(4),a=i(6),c=i(8),l=i(9),d=i(14),u=i(11),h=i(34),f=i(57),p=i(13);var g;!function(e){e[e.Unknow=0]="Unknow",e[e.Free=1]="Free",e[e.WaitWebrtc=2]="WaitWebrtc",e[e.WaitTelephony=3]="WaitTelephony",e[e.CallOffer=4]="CallOffer",e[e.CallOnGoing=5]="CallOnGoing",e[e.CallActive=6]="CallActive",e[e.CallActiveNoWebMedia=7]="CallActiveNoWebMedia",e[e.TelCallReleasing=8]="TelCallReleasing",e[e.WebCallReleasing=9]="WebCallReleasing",e[e.RemoteControled=10]="RemoteControled",e[e.AnomalyCCS=11]="AnomalyCCS"}(g=t.MPCallState||(t.MPCallState={}));class m{constructor(){this.started=false,this.listeners=[],this.myContact=null,this.mediaPillarContact=null,this.mediaPillarConfigured=false,this.mediaPillarAlive=false,this.evtQueue=[],this.SEM=0,this.mediaPillarPollingSelected=false,this.TO_transition=15e3,this.TO_transition_long=3e4,this.TO_NoWebMedia=6e4,this.TO_NoWebMediaNotel=5e3,this.TO_PILLAR_POLLING=3e5,this.TO_waitTelephony=600,this.mediaPillarKeepAliveSuspend=false,this.keepAliveIterationCpt=0,this.mediaPillarCallContexts=[],this.mediaPillarCallContextId=1,this.isMixPstnWebRtcAllowed=false,this.rxSubject=new r.Subject,this.xmppService=l.XmppService.getInstance(),this.logger=o.LoggerService.getInstance(),this.authService=c.AuthService.getInstance(),this.profileService=d.ProfileService.getInstance(),this.errorHelperService=p.ErrorHelperService.getInstance(),this.contactService=a.ContactService.getInstance(),this.eventService=u.EventService.getInstance(),this.webrtcP2PService=h.WebrtcP2PService.getInstance(),this.telephonyService=f.TelephonyService.getInstance()}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.webrtcGatewayService||(e.rainbow.webrtcGatewayService=new m),e.rainbow.webrtcGatewayService}async start(){if(this.setMediaPillarConfigured(false),this.mediaPillarAlive=false,this.portalURL=config.restServerUrl+"/api/rainbow/mediapillar/v1.0/mediapillars",this.myContact=this.contactService.userContact,this.mediaPillarContact=null,this.mediaPillarPollingSelected=false,this.mediaPillarConnection={keepAlive_TO:null,mediaPillarJidArray:[],rainbowPhoneNumber:"",remoteExtension:"",mediaPillarStatesPool:{}},this.mediaPillarCallContext={id:0,callState:g.Free,callState_TO:null,waitTelephony_TO:null,isOutgoingCall3PCC:false,telephonyCallRefs:[],webrtcCallRef:null,previousCallConnectionId:null,previousCallStatus:null,updateContactFlag:false,isIncomingCallPopupWithWebRtcCall:false,onGoingCallMediaPillarJid:"",callOwnerForOxoMultiClientFlag:false,getMediaPillarJid:()=>this.getOnGoingMediaPillarJid()},this.mediaPillarCallContexts=[],this.isMixPstnWebRtcAllowed=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.MIX_WEBRTC_PSTN_CALLS)||config.mixwebrtcpstn,this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_WEBRTC_PSTN_CALLING)){this.logger.info("[WebrtcGatewayService] === STARTING ==="),this.started=true,this.SEM=0,this.resetEvtAutomaton(),this.mediaPillarKeepAliveSuspend=false;try{const e=await this.getMediaPillarData();if(!e){throw new Error("Anomaly getMediaPillarData")}const t=e[0];if(this.mediaPillarContact=this.createMediaPillarContact(t),this.mediaPillarConnection.mediaPillarJidArray=e,this.logger.info("[WebrtcGatewayService] Pillar remoteExtension used : "+this.mediaPillarConnection.remoteExtension),""!==this.mediaPillarConnection.remoteExtension?(this.mediaPillarConnection.mediaPillarJidArray.forEach((e=>{this.logger.info("[WebrtcGatewayService] MPJid: "+e),this.mediaPillarConnection.mediaPillarStatesPool[e]={mediaPillarConfigured:true,mediaPillarAlive:false}})),this.setMediaPillarConfigured(this.isMediaPillarPoolConfigured(null)),this.telephonyService.started&&this.telephonyService.getNomadicStatus()):(this.logger.warn("[WebrtcGatewayService] no remoteExtention available "),this.setMediaPillarConfigured(false)),this.mediaPillarConfigured)try{await this.registerMediaPillarPool()}finally{this.mediaPillarAlive?(this.logger.info("[WebrtcGatewayService] Pseudo media pillar register OK with extension "+this.mediaPillarConnection.remoteExtension),this.eventService.publish("ON_WEBRTCGATEWAY_STATE_CHG",this.mediaPillarAlive)):(this.logger.info("[WebrtcGatewayService] Pseudo media pillar register KO"),this.logger.info("[WebrtcGatewayService] Initial polling activated on starting issue"),this.mediaPillarKeepAlivePolling("START",3e5),this.eventService.publish("ON_WEBRTCGATEWAY_STATE_CHG",this.mediaPillarAlive))}this.xmppConnectionSubscription=this.xmppService.subscribeToConnectionEvents((e=>{"ON_XMPP_DISCONNECTED"===e.name?(this.logger.info("[WebrtcGatewayService] onConnectionStateChangeEvent : disconnected then MP keepalive suspended"),this.mediaPillarKeepAliveSuspend=true):"ON_XMPP_CONNECTED"===e.name&&(this.logger.info("[WebrtcGatewayService] onConnectionStateChangeEvent : connected then keepalive as necessary"),this.mediaPillarKeepAliveSuspend=false,this.isMediaPillarUserSelected()&&(this.TO_PILLAR_POLLING=15e3,this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING)))})),this.listeners.push(this.eventService.subscribe("ON_CALL_UPDATED_EVENT",((e,t,i)=>{this.onCallEvent(e,t,i)}))),this.listeners.push(this.eventService.subscribe("ON_MEDIAPILLAR_CALL_REMOTE_CTRL_EVENT",((e,t)=>{this.onRemoteCtrlCall(e,t)}))),this.listeners.push(this.eventService.subscribe("ON_MEDIAPILLAR_CALL_REJECT_EVENT",((e,t)=>{let i=null;for(const r in this.telephonyService.calls)if(this.telephonyService.calls.hasOwnProperty(r)&&this.telephonyService.calls[r].status===n.Call.Status.RINGING_INCOMMING){i=this.telephonyService.calls[r];break}this.logger.info("[WebrtcGatewayService] on_mediapillar_call_reject_event"),i&&(this.telephonyService.releaseCall(i),i.setStatus(n.Call.Status.UNKNOWN),this.eventService.publish("ON_CALL_UPDATED_EVENT",i))}))),this.listeners.push(this.eventService.subscribe("ON_REPLACE_CALLREFS_REQUEST",((e,t,i)=>{this.logger.info(`[WebrtcGatewayService] ON_REPLACE_CALLREFS_REQUEST newCall ${t} call ${i}`),this.replaceCallRefs(t,i)}))),this.listeners.push(this.eventService.subscribe("ON_ANSWER_CALL_REQUEST",((e,t)=>{this.logger.info("[WebrtcGatewayService] ON_ANSWER_CALL_REQUEST call "+t),this.answerCall(t)}))),this.logger.info("[WebrtcGatewayService] === STARTED ===")}catch(e){this.started=false,this.mediaPillarConnection.mediaPillarJidArray=[],this.mediaPillarConnection.rainbowPhoneNumber="",this.mediaPillarConnection.remoteExtension="",this.setMediaPillarConfigured(false),this.mediaPillarAlive=false,this.mediaPillarConnection.mediaPillarStatesPool={},this.logger.info("[WebrtcGatewayService] === STARTING FAILURE === "+e.message)}}else this.logger.info("[WebrtcGatewayService] === NO WEBRTCGATEWAY ENVOLVED === ")}async stop(){this.logger.info("[WebrtcGatewayService] === STOPPING ==="),this.started=false,this.setMediaPillarConfigured(false),this.mediaPillarAlive=false,this.mediaPillarKeepAlivePolling("STOP",0),this.mediaPillarConnection&&(this.mediaPillarConnection.mediaPillarJidArray=[],this.mediaPillarConnection.rainbowPhoneNumber="",this.mediaPillarConnection.remoteExtension="",this.mediaPillarConnection.mediaPillarStatesPool={}),this.mediaPillarCallContext&&(this.releaseMediaPillarCallContext(),this.mediaPillarCallContext.callState=g.Unknow),this.mediaPillarCallContexts.forEach((e=>{this.releaseMediaPillarCallContext(e),e.callState=g.Unknow})),this.mediaPillarCallContexts=[],this.xmppConnectionSubscription&&this.xmppConnectionSubscription.unsubscribe(),this.listeners&&this.listeners.forEach((e=>{e()})),this.logger.info("[WebrtcGatewayService] === STOPPED ===")}setMediaPillarConfigured(e){this.mediaPillarConfigured=e,this.eventService.publish("ON_WEBRTCGATEWAY_CONFIG_CHANGE",this.mediaPillarConfigured,e&&this.mediaPillarConnection?this.mediaPillarConnection.remoteExtension:"")}onCallEvent(e,t,i){if(this.isMediaPillarCallCase()||t&&t.getMixtWebTelSingleStepTrans()){const e=this.getOrCreateMediaPIllarCallContext(t);if(!e)return void this.logger.warn("[WebrtcGatewayService] onCallEvent : no mediaPillar Call Context found : Evt IGNORED");if(this.SEM++,this.logger.info("[WebrtcGatewayService] onCallEvent IN("+this.SEM+") state = "+e.callState),this.logger.info("[WebrtcGatewayService] onCallEvent "+e.callState+" --- "+t.type.value+"("+t.id+","+t.status.value+")"),i&&null!==i&&(this.logger.info("[WebrtcGatewayService] onCallEvent tel infoEvt : Evt = "+i.actionElemName+" / cause = "+i.cause),"updatecall"!==i.actionElemName&&"updateparty"!==i.actionElemName||(e.updateContactFlag=true,this.logger.info("[WebrtcGatewayService] updateContactFlag = true"))),t.connectionId===e.previousCallConnectionId&&t.status===e.previousCallStatus&&!this.mediaPillarCallContext.updateContactFlag)return e.previousCallConnectionId=t.connectionId,e.previousCallStatus=t.status,this.logger.info("[WebrtcGatewayService] onCallEvent | DEBOUNCE EVT"),this.SEM--,void this.logger.info("[WebrtcGatewayService] onCallEvent OUT("+this.SEM+")");if(t.type.value===n.Call.Type.PHONE.value&&null===t.id)return e.previousCallConnectionId=t.connectionId,e.previousCallStatus=t.status,this.logger.info("[WebrtcGatewayService] onCallEvent | FILTER EVT null/error"),this.SEM--,void this.logger.info("[WebrtcGatewayService] onCallEvent OUT("+this.SEM+")");if(e.previousCallConnectionId=t.connectionId,e.previousCallStatus=t.status,this.evtQueue.push({call:t,mediaPillarCallContext:e}),this.evtQueue.length>1)return this.SEM--,void this.logger.info("[WebrtcGatewayService] onCallEvent OUT("+this.SEM+") evt pushed = "+t.status.value);for(;this.evtQueue.length;){try{this.processEvt(this.evtQueue[0])}catch(r){this.logger.error("[WebrtcGatewayService] onCallEvent queue processing | call : "+this.evtQueue[0].status.value+" Error : "+r)}this.evtQueue.splice(0,1)}this.SEM--,this.logger.info("[WebrtcGatewayService] onCallEvent OUT("+this.SEM+") state = "+this.mediaPillarCallContext.callState),0!==this.SEM&&(this.logger.error("[WebrtcGatewayService] onCallEvent OUT | Unmanaged Eventing Reentrancy Situation"),this.resetEvtAutomaton(),this.SEM=0)}else if(t&&t.type===n.Call.Type.WEBRTC&&t.fullJid&&this.isMediaPillarJid(this.xmppService.getBareJidFromJid(t.fullJid)))switch(t.status){case n.Call.Status.ACTIVE:this.mediaPillarCallContext&&this.mediaPillarCallContext.callState===g.CallActiveNoWebMedia&&(this.logger.info("[WebrtcGatewayService] case when WebrtcCall goes to Active -- (but MP is not connected)"),this.mediaPillarCallContext.callState=g.CallActive,this.stopCallStateTimeOut())}}processEvt(e){const t=e.call;if(this.mediaPillarCallContext=e.mediaPillarCallContext,this.logger.info("[WebrtcGatewayService] processEvt | process "+t.type.value+"("+t.id+","+t.status.value+") in MPcontextCallstate = "+this.mediaPillarCallContext.callState+" CTX id "+this.mediaPillarCallContext.id),t.type.value===n.Call.Type.PHONE.value){const e=this.telephonyService.getCalls().length;if((()=>{let e=false;return(t.status===n.Call.Status.DIALING||this.telephonyService.isSipWise())&&(t.isSecondary=true),t.isSecondary?t.status===n.Call.Status.UNKNOWN||t.status===n.Call.Status.RINGING_INCOMMING||t.status===n.Call.Status.QUEUED_INCOMMING||t.status===n.Call.Status.ACTIVE?(this.addTelCallRefs(t),t.setMediaPillarCall(this.getMediaPillarCallContext()),e=false,e):this.mediaPillarCallContext.callState===g.RemoteControled?(this.logger.info("[WebrtcGatewayService] processEvt |  RemoteControled state for call : "+t.id+" then ignore"),e=true,e):(this.addTelCallRefs(t),this.mediaPillarCallContext.telephonyCallRefs.length>1?(this.logger.info("[WebrtcGatewayService] processEvt |  nthCall : "+this.mediaPillarCallContext.telephonyCallRefs.length+" then ignore"),e=true,e):e):(this.logger.info("[WebrtcGatewayService] processEvt | NOT SECONDARY then ignore"),e=true,e)})())this.logger.info("[WebrtcGatewayService] processEvt |  call("+t.id+" / SEC "+t.isSecondary+", "+t.status.value+") -> EVT IGNORED"),this.logger.info("[WebrtcGatewayService] processEvt |  telephonyCallRefs.length = "+this.mediaPillarCallContext.telephonyCallRefs.length),this.logger.info("[WebrtcGatewayService] processEvt |  calls.length = "+e);else switch(this.logger.info("[WebrtcGatewayService] processEvt |  call("+t.id+" / SEC "+t.isSecondary+", "+t.status.value+") -> EVT PROCESSED"),this.logger.info("[WebrtcGatewayService] processEvt |  telephonyCallRefs.length = "+this.mediaPillarCallContext.telephonyCallRefs.length),this.logger.info("[WebrtcGatewayService] processEvt |  calls.length = "+e),t.status){case n.Call.Status.RINGING_INCOMMING:this.onTelCallIncomming(t);break;case n.Call.Status.DIALING:this.onTelCallDialling(t);break;case n.Call.Status.RINGING_OUTGOING:this.onTelCallOutgoing(t);break;case n.Call.Status.ACTIVE:this.onTelCallActive(t);break;case n.Call.Status.UNKNOWN:this.onTelCallReleasing(t)}}else if(this.isMediaPillarJid(this.xmppService.getBareJidFromJid(t.fullJid)))switch(t.status){case n.Call.Status.RINGING_INCOMMING:this.onWebrtcCallIncomming(t);break;case n.Call.Status.CONNECTING:this.onWebrtcCallConnecting(t);break;case n.Call.Status.ACTIVE:this.onWebrtcCallActive(t);break;case n.Call.Status.ANSWERING:this.onWebrtcCallAnswering(t);break;case n.Call.Status.UNKNOWN:this.onWebrtcCallReleasing(t)}else this.logger.info("[WebrtcGatewayService] processEvt | process call("+t.id+","+t.status.value+") -> Not a webrtcgateway case")}getOrCreateMediaPIllarCallContext(e){if(!this.telephonyService.isSipWise())return this.mediaPillarCallContext;if(e.type===n.Call.Type.WEBRTC){if(this.isMediaPillarJid(this.xmppService.getBareJidFromJid(e.fullJid)))switch(e.status){case n.Call.Status.RINGING_INCOMMING:return this.getOrCreateContextForWebrtcCallIncoming(e);default:return this.getContextForWebrtcCallExisting(e)}}else if(e.type===n.Call.Type.PHONE)return this.getOrCreateContextForTelCall(e);return null}getOrCreateContextForTelCall(e){this.logger.info("[WebrtcGatewayService] CTX getOrCreateContextForTelCall "+e);let t=this.mediaPillarCallContexts.find((t=>t.telephonyCallRefs&&t.telephonyCallRefs.length&&t.telephonyCallRefs[0].id===e.id));return t?(this.logger.info("[WebrtcGatewayService] CTX getOrCreateContextForTelCall "+e+" returns context id "+t.id),t):(t=this.mediaPillarCallContexts.find((t=>t.callState===g.WaitTelephony&&(!t.webrtcCallRef.getAssocPhoneCallId()||t.webrtcCallRef.getAssocPhoneCallId().includes(e.id)))),t?(this.logger.info("[WebrtcGatewayService] CTX getOrCreateContextForTelCall "+e+" returns context id "+t.id),t):e.status===n.Call.Status.UNKNOWN?null:this.createMediaPIllarCallContext())}getOrCreateContextForWebrtcCallIncoming(e){this.logger.info("[WebrtcGatewayService] CTX getOrCreateContextForWebrtcCallIncoming "+e);const t=this.mediaPillarCallContexts.find((t=>t.callState===g.WaitWebrtc&&(!e.getAssocPhoneCallId()||t.telephonyCallRefs&&t.telephonyCallRefs.length&&e.getAssocPhoneCallId().includes(t.telephonyCallRefs[0].id))));return t?(this.logger.info("[WebrtcGatewayService] CTX getOrCreateContextForWebrtcCallIncoming "+e+" returns context id "+t.id),t):this.createMediaPIllarCallContext()}getContextForWebrtcCallExisting(e){this.logger.info("[WebrtcGatewayService] CTX getContextForWebrtcCallExisting "+e);const t=this.mediaPillarCallContexts.find((t=>t.webrtcCallRef&&t.webrtcCallRef.id===e.id));return this.logger.info("[WebrtcGatewayService] CTX getContextForWebrtcCallExisting "+e+" returns context id "+(t?t.id:" not found")),t}createMediaPIllarCallContext(){const e={id:this.mediaPillarCallContextId++,callState:g.Free,callState_TO:null,waitTelephony_TO:null,isOutgoingCall3PCC:false,telephonyCallRefs:[],webrtcCallRef:null,previousCallConnectionId:null,previousCallStatus:null,updateContactFlag:false,isIncomingCallPopupWithWebRtcCall:false,onGoingCallMediaPillarJid:"",callOwnerForOxoMultiClientFlag:false,getMediaPillarJid:()=>this.getOnGoingMediaPillarJid()};return this.mediaPillarCallContexts.push(e),this.logger.info("[WebrtcGatewayService] CTX createMediaPIllarCallContext id "+e.id+" => nb contexts "+this.mediaPillarCallContexts.length),e}releaseMediaPillarCallContext(e=null){e||(e=this.mediaPillarCallContext),e.callState=g.Free,this.stopCallStateTimeOut(e),this.stopWaitTelephonyTimeOut(e),e.isOutgoingCall3PCC=false,e.updateContactFlag=false,e.telephonyCallRefs.length>0&&this.logger.warn("[WebrtcGatewayService] releaseMediaPillarCallContext | reset context but telephonyCallRefs not empty !"),null!==e.webrtcCallRef&&this.logger.warn("[WebrtcGatewayService] releaseMediaPillarCallContext | reset context but webrtcCallRef not null !"),e.telephonyCallRefs=[],e.webrtcCallRef=null,e.previousCallConnectionId=null,e.previousCallStatus="",e.isIncomingCallPopupWithWebRtcCall=false,e.onGoingCallMediaPillarJid="",e.callOwnerForOxoMultiClientFlag=false;const t=this.mediaPillarCallContexts.indexOf(e);this.mediaPillarCallContexts.splice(t,1),this.logger.info("[WebrtcGatewayService] releaseMediaPillarCallContext id "+e.id+" => nb contexts "+this.mediaPillarCallContexts.length),this.logger.log("[WebrtcGatewayService] releaseMediaPillarCallContext | =====  mediaPillarCallContext RELEASED  ===== ")}resetEvtAutomaton(){this.evtQueue=[]}stopCallStateTimeOut(e=null){e||(e=this.mediaPillarCallContext),e.callState_TO&&clearTimeout(e.callState_TO),e.callState_TO=null}stopWaitTelephonyTimeOut(e=null){e||(e=this.mediaPillarCallContext),e.waitTelephony_TO&&clearTimeout(e.waitTelephony_TO),e.waitTelephony_TO=null}onRemoteCtrlCall(e,t){this.logger.info("[WebrtcGatewayService] onRemoteCtrlCall for call "+t.id+" in previous state: "+this.mediaPillarCallContext.callState+": => Becomes REMOTECONTROLED");let i=t.getMediaPillarCall();i||(i=this.mediaPillarCallContext),i.callState=g.RemoteControled,this.stopCallStateTimeOut(i)}addTelCallRefs(e){if(null==e)return void this.logger.warn("[WebrtcGatewayService] addTelCallRefs | ANOMALY callRef not valid");let t=false;for(let i=0;i<this.mediaPillarCallContext.telephonyCallRefs.length;i++)this.mediaPillarCallContext.telephonyCallRefs.length&&this.mediaPillarCallContext.telephonyCallRefs[i].id===e.id&&(t=true);t||this.mediaPillarCallContext.telephonyCallRefs.push(e)}removeTelCallRefs(e){if(null==e)return void this.logger.warn("[WebrtcGatewayService] removeTelCallRefs | ANOMALY callRef not valid");let t=0;for(;t<this.mediaPillarCallContext.telephonyCallRefs.length;)this.mediaPillarCallContext.telephonyCallRefs[t].id===e.id?(this.mediaPillarCallContext.telephonyCallRefs.splice(t,1),0===t&&this.mediaPillarCallContext.telephonyCallRefs.length&&(this.mediaPillarCallContext.telephonyCallRefs[0].setMediaPillarCall(this.getMediaPillarCallContext()),this.logger.log("[WebrtcGatewayService] removeTelCallRefs | master MP call becomes : "+this.mediaPillarCallContext.telephonyCallRefs[0].id))):t++}putAsMasterTelCallRefs(e){if(null==e)return void this.logger.warn("[WebrtcGatewayService] putAsMasterTelCallRefs | ANOMALY callRef not valid");let t=-1;for(let i=0;i<this.mediaPillarCallContext.telephonyCallRefs.length;i++)this.mediaPillarCallContext.telephonyCallRefs[i].id===e.id&&(t=i);if(this.logger.log("[WebrtcGatewayService] putAsMasterTelCallRefs | master MP call is : "+e.id),0!==t)if(-1!==t){const i=this.mediaPillarCallContext.telephonyCallRefs[0];this.mediaPillarCallContext.telephonyCallRefs[0]=e,this.mediaPillarCallContext.telephonyCallRefs[t]=i,e.setMediaPillarCall(this.getMediaPillarCallContext())}else this.logger.warn("[WebrtcGatewayService] putAsMasterTelCallRefs | Anomaly call not in telephonyCallRefs")}isMasterTelCallRefs(e){return null==e?(this.logger.warn("[WebrtcGatewayService] isMasterTelCallRefs | ANOMALY callRef not valid"),false):0!==this.mediaPillarCallContext.telephonyCallRefs.length&&this.mediaPillarCallContext.telephonyCallRefs[0].id===e.id}isInTelCallRefs(e){if(null==e)return this.logger.warn("[WebrtcGatewayService] isInTelCallRefs | ANOMALY callRef not valid"),false;if(e.type!==n.Call.Type.PHONE)return this.logger.warn("[WebrtcGatewayService] isInTelCallRefs | ANOMALY callRef not Tel PHONE"),false;const t=this.getMediaPillarCallContext(e);if(!t)return this.logger.warn("[WebrtcGatewayService] isInTelCallRefs | ANOMALY mediaPillarCallContext not found"),false;let i=-1;for(let r=0;r<t.telephonyCallRefs.length;r++)if(t.telephonyCallRefs[r].id===e.id){i=r;break}return-1!==i}replaceCallRefs(e,t){if(null==e||null==t)return void this.logger.warn("[WebrtcGatewayService] replaceCallRefs | ANOMALY callRef not valid");let i=false;const r=e.isMediaPillarCall(),n=t.isMediaPillarCall();this.isInTelCallRefs(e)&&(i=true,this.logger.warn("[WebrtcGatewayService] replaceCallRefs | ANOMALY newcallRef already existing"),this.removeTelCallRefs(e));let s=-1;for(let o=0;o<this.mediaPillarCallContext.telephonyCallRefs.length;o++)this.mediaPillarCallContext.telephonyCallRefs[o].id===t.id&&(s=o);-1!==s?(this.mediaPillarCallContext.telephonyCallRefs[s]=e,n&&e.setMediaPillarCall(this.getMediaPillarCallContext()),t.setMediaPillarCall(null),0===s&&this.logger.log("[WebrtcGatewayService] replaceCallRefs | master MP call becomes : "+this.mediaPillarCallContext.telephonyCallRefs[0].id)):(this.logger.warn("[WebrtcGatewayService] replaceCallRefs | ANOMALY oldCallRef not found"),i&&(this.addTelCallRefs(e),r&&e.setMediaPillarCall(this.getMediaPillarCallContext())))}automatonDefenseTimout(e,t=null){t||(t=this.mediaPillarCallContext);let i=0;if(null!=e)if(e.type.value===n.Call.Type.PHONE.value)switch(this.logger.log("[WebrtcGatewayService] automatonDefenseTimout | transition telcall call="+e.id+" evt="+e.status.value+" then timout"),e.status){case n.Call.Status.RINGING_OUTGOING:case n.Call.Status.RINGING_INCOMMING:break;default:t.callState!==g.CallActive&&t.callState!==g.CallActiveNoWebMedia&&t.callState!==g.CallOffer&&t.callState!==g.CallOnGoing&&(i=2)}else if(this.isMediaPillarJid(this.xmppService.getBareJidFromJid(e.fullJid)))switch(this.logger.log("[WebrtcGatewayService] automatonDefenseTimout | transition webrtc "+e.status.value+" then timout"),e.status){case n.Call.Status.ACTIVE:break;default:t.callState!==g.CallActive&&t.callState!==g.CallActiveNoWebMedia&&t.callState!==g.CallOffer&&t.callState!==g.CallOnGoing&&(i=3)}else this.logger.warn("[WebrtcGatewayService] automatonDefenseTimout | anomaly transition webrtc call but Not a webrtcgateway case"),i=2;else t.callState!==g.CallActive&&t.callState!==g.CallActiveNoWebMedia&&t.callState!==g.RemoteControled&&t.callState!==g.CallOffer&&t.callState!==g.CallOnGoing&&(this.logger.log("[WebrtcGatewayService] automatonDefenseTimout | anomaly timout in unexpected state"),i=2);switch(0!==i&&this.logger.warn("[WebrtcGatewayService] automatonDefenseTimout | actionlevel "+i),i){case 0:break;case 1:this.TO_PILLAR_POLLING=3e5,this.mediaPillarAlive||this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING);break;case 2:this.TO_PILLAR_POLLING=3e5,this.mediaPillarAlive||this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING),this.releaseMediaPillarCallContext(t);break;case 3:this.TO_PILLAR_POLLING=3e5,this.mediaPillarAlive||this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING),this.mediaPillarReleaseWebrtcCall(t),this.releaseMediaPillarCallContext(t);break;default:this.TO_PILLAR_POLLING=3e5,this.mediaPillarAlive||this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING),this.mediaPillarCallTerminator(t)}t.callState!==g.Free&&(t.callState_TO=setTimeout((()=>{this.automatonDefenseTimout(null,t)}),this.TO_transition))}onTelCallIncomming(e){if(this.mediaPillarCallContext.telephonyCallRefs.length>1&&this.mediaPillarCallContext.callState!==g.Free&&this.mediaPillarCallContext.callState!==g.WaitTelephony&&this.mediaPillarCallContext.callState!==g.WaitWebrtc)return this.logger.info("[WebrtcGatewayService] onTelCallIncomming | nth calls BUT trig the GUI & link the call"),e.setMediaPillarCall(this.getMediaPillarCallContext()),this.logger.info("[WebrtcGatewayService] onTelCallIncomming | ON_WEBRTC_GW_CALL_UPDATED_EVENT for call = "+e.id),this.mediaPillarCallContext.updateContactFlag=true,void this.eventService.publish("ON_WEBRTC_GW_CALL_UPDATED_EVENT",e);switch(this.logger.info("[WebrtcGatewayService] onTelCallIncomming | mediapilaryse as necessary for call "+e.id+" date "+s().format("HH:mm:ss:SSS")),this.mediaPillaryseTheCall(e,null)){case"Ok":if(this.stopWaitTelephonyTimeOut(),this.stopCallStateTimeOut(),this.mediaPillarCallContext.callState_TO=setTimeout((()=>{this.automatonDefenseTimout(e)}),this.TO_transition),!this.isMediaPillarOutgoingCall()&&this.mediaPillarCallContext.callState===g.CallOffer&&this.mediaPillarCallContext.webrtcCallRef||e.getMixtWebTelSingleStepTrans()){const t=this.mediaPillarCallContext.isIncomingCallPopupWithWebRtcCall;if(t&&(this.logger.info("[WebrtcGatewayService] onTelCallIncomming | Incoming tel phone while Popup displayed with Webrtc Call should happen in rare cases when csta event is very slow: use phone call info anyway for call "+e.id),this.mediaPillarCallContext.webrtcCallRef.contact!==e.contact&&(this.mediaPillarCallContext.webrtcCallRef.contact=e.contact,this.eventService.publish("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:null,call:this.mediaPillarCallContext.webrtcCallRef}))),e.autoOffHookResource)if(e.autoOffHookResource===this.xmppService.getResourceFromJid(this.contactService.userContact.fullJid))if(this.logger.info("[WebrtcGatewayService] onTelCallIncomming | blindPickup in progress : let's answer to call "+e.id),"singleStepTransfer"===e.getInitCauseSipWiseData()){this.logger.info("[WebrtcGatewayService] onTelCallIncomming | case of singleStepTransfer, release active webrtc call ");const t=this.webrtcP2PService.getWebrtcAudioCall();if(t&&this.webrtcP2PService.releaseCall(t),this.mediaPillarCallContext.callState===g.WaitWebrtc&&!this.mediaPillarCallContext.webrtcCallRef&&this.telephonyService.isSipWise()){this.logger.info("[WebrtcGatewayService] onTelCallIncomming | case of singleStepTransfer, retrieve incoming MP webrtc media call ");const t=this.specialCaseNotComputerModeButMPCall(e);t?(this.logger.debug("[WebrtcGatewayService] onTelCallIncomming | blindPickup in progress for telcall:"+e.id+" and webCall: "+t.id),this.answerCall(e)):this.logger.debug("[WebrtcGatewayService] onTelCallIncomming | blindPickup in progress for telcall:"+e.id+" but not yet webrtcCall")}else this.answerCall(e)}else this.answerCall(e);else this.logger.debug("[WebrtcGatewayService] onTelCallIncomming | blindPickup in progress on another client of our user: do nothing for call "+e.id);else for(let i=0;i<this.mediaPillarCallContext.telephonyCallRefs.length;i++)(!t&&(this.mediaPillarCallContext.telephonyCallRefs[i].status===n.Call.Status.RINGING_INCOMMING||this.mediaPillarCallContext.telephonyCallRefs[i].status===n.Call.Status.QUEUED_INCOMMING)||t&&this.mediaPillarCallContext.telephonyCallRefs[i].status===n.Call.Status.QUEUED_INCOMMING)&&(this.logger.info("[WebrtcGatewayService] onTelCallIncomming | ON_WEBRTC_GW_CALL_UPDATED_EVENT for call = "+e.id),this.eventService.publish("ON_WEBRTC_GW_CALL_UPDATED_EVENT",this.mediaPillarCallContext.telephonyCallRefs[i]))}break;case"Update":this.stopCallStateTimeOut(),this.isMediaPillarOutgoingCall()||!this.mediaPillarCallContext.webrtcCallRef||e.status!==n.Call.Status.RINGING_INCOMMING&&e.status!==n.Call.Status.QUEUED_INCOMMING?this.logger.info("[WebrtcGatewayService] onTelCallIncomming | ignore update call"):(this.eventService.publish("ON_WEBRTC_GW_CALL_UPDATED_EVENT",e),this.logger.info("[WebrtcGatewayService] onTelCallIncomming | update call"));break;case"Ignore":this.logger.info("[WebrtcGatewayService] onTelCallIncomming | ignore evt");break;default:this.logger.error("[WebrtcGatewayService] onTelCallIncomming | media Pillar call anomaly "+status)}}onTelCallDialling(e){if(this.mediaPillarCallContext.isOutgoingCall3PCC=e.isOwner||e.isMPAudioOwner,this.logger.info("[WebrtcGatewayService] onTelCallDialling | isOwner "+e.isOwner+" isMPAudioOwner "+e.isMPAudioOwner+" => outgoing3PCC "+this.mediaPillarCallContext.isOutgoingCall3PCC),this.mediaPillarCallContext.isOutgoingCall3PCC)if(this.mediaPillarCallContext.callState===g.Free||this.mediaPillarCallContext.callState===g.WaitTelephony)switch(this.mediaPillarCallContext.callState_TO=setTimeout((()=>{this.automatonDefenseTimout(e)}),this.TO_transition),this.mediaPillaryseTheCall(e,null)){case"Ok":this.mediaPillarCallContext.webrtcCallRef&&this.mediaPillarCallContext.callState===g.CallOffer&&(this.webrtcP2PService.answerCall(this.mediaPillarCallContext.webrtcCallRef,"audio"),this.logger.info("[WebrtcGatewayService] onTelCallDialling | outgoing3PCC then send webrtc proceed")),this.stopCallStateTimeOut(),this.mediaPillarCallContext.callState_TO=setTimeout((()=>{this.automatonDefenseTimout(e)}),this.TO_transition);break;case"Ignore":case"Update":this.logger.info("[WebrtcGatewayService] onTelCallDialling | ignore evt");break;default:this.logger.error("[WebrtcGatewayService] onTelCallDialling | media Pillar call anomaly "+status),this.mediaPillarCallTerminator()}else this.mediaPillarCallContext.callState!==g.CallOffer&&this.mediaPillarCallContext.callState!==g.CallOnGoing||this.logger.warn("[WebrtcGatewayService] onTelCallDialling | media Pillar call anomaly, on state : "+this.mediaPillarCallContext.callState),this.logger.info("[WebrtcGatewayService] onTelCallDialling | ignored , on state : "+this.mediaPillarCallContext.callState);else this.stopCallStateTimeOut(),this.logger.info("[WebrtcGatewayService] onTelCallDialling but not call owner (=>other client) | ignore evt on state : "+this.mediaPillarCallContext.callState)}onTelCallOutgoing(e){this.isMediaPillarOutgoingCall()||this.mediaPillarCallContext.callState===g.CallActive?this.stopCallStateTimeOut():(this.logger.warn("[WebrtcGatewayService] onTelCallOutgoing | media Pillar, not a 1st 3PCC outgoing call then ignore & release MP CallContext"),this.releaseMediaPillarCallContext())}async onTelCallActive(e){switch(this.mediaPillarCallContext.callState){case g.CallOnGoing:this.stopCallStateTimeOut(),e.setMediaPillarCall(this.getMediaPillarCallContext()),this.mediaPillarCallContext.callState=g.CallActive;break;case g.TelCallReleasing:if(this.logger.warn("[WebrtcGatewayService] onTelCallActive | media Pillar recv tel active on state = "+this.mediaPillarCallContext.callState),this.logger.info("[WebrtcGatewayService] onTelCallActive | media Pillar , RE-ACTIVATION"),this.stopCallStateTimeOut(),e.setMediaPillarCall(this.getMediaPillarCallContext()),this.telephonyService.oxoMultiCallMode()){this.logger.info("[WebrtcGatewayService] onTelCallActive -- OXO specific mng for call when re-activation : "+e.id);const t=e.getMediaPillarCall();t&&t.webrtcCallRef&&t.webrtcCallRef.status===n.Call.Status.RINGING_INCOMMING&&this.mediaPillarCallContext.callOwnerForOxoMultiClientFlag?(e.noIncomingPopup=true,await this.actionOnActiveCallIfNecessary(e),t.webrtcCallRef&&t.webrtcCallRef.status===n.Call.Status.RINGING_INCOMMING?(this.logger.info("[WebrtcGatewayService] onTelCallActive -- OXO specific mng | send webrtc proceed for call : "+e.id),t.callState=g.CallOnGoing,this.webrtcP2PService.answerCall(t.webrtcCallRef,"audio"),e.isMPAudioOwner=true):this.logger.info("[WebrtcGatewayService] onTelCallActive | oxo case when re-activation ano webrtc state")):this.logger.info("[WebrtcGatewayService] onTelCallActive | oxo case when re-activation not possible to answer webrtc part"),this.mediaPillarCallContext.callState_TO=setTimeout((()=>{this.automatonDefenseTimout(e)}),this.TO_transition)}else this.mediaPillarCallContext.callState=g.CallActive;break;case g.CallActive:this.logger.info("[WebrtcGatewayService] onTelCallActive | media Pillar , ignore tel active on state CallActive ");break;case g.WebCallReleasing:this.logger.info("[WebrtcGatewayService] onTelCallActive | media Pillar recv tel active on state WebCallReleasing then releaseMediaPillarCallContext"),this.releaseMediaPillarCallContext();break;case g.Free:this.logger.info("[WebrtcGatewayService] onTelCallActive | media Pillar recv tel active on state = 1 ; probably call taken on deskphone ; ignore active & release call context "),this.releaseMediaPillarCallContext();break;case g.CallOffer:if(this.telephonyService.oxoMultiCallMode()){this.logger.info("[WebrtcGatewayService] onTelCallActive -- OXO specific mng for call : "+e.id),this.stopCallStateTimeOut();const t=e.getMediaPillarCall();t&&t.webrtcCallRef&&t.webrtcCallRef.status===n.Call.Status.RINGING_INCOMMING&&this.mediaPillarCallContext.callOwnerForOxoMultiClientFlag?(e.noIncomingPopup=true,await this.actionOnActiveCallIfNecessary(e),this.logger.info("[WebrtcGatewayService] onTelCallActive -- OXO specific mng | send webrtc proceed for call : "+e.id),t.callState=g.CallOnGoing,this.webrtcP2PService.answerCall(t.webrtcCallRef,"audio"),e.isMPAudioOwner=true):this.logger.info("[WebrtcGatewayService] onTelCallActive | oxo case not possible to answer webrtc part"),this.mediaPillarCallContext.callState_TO=setTimeout((()=>{this.automatonDefenseTimout(e)}),this.TO_transition);break}default:this.logger.info("[WebrtcGatewayService] onTelCallActive | Anomaly media Pillar recv tel active on state = "+this.mediaPillarCallContext.callState)}}onTelCallReleasing(e){this.telephonyService.getCalls().length;if(this.mediaPillarCallContext.telephonyCallRefs.length>1)return e.setMediaPillarCall(null),this.removeTelCallRefs(e),void this.logger.info("[WebrtcGatewayService] onTelCallReleasing -- "+e.id+" -- postpone mediaPillarCallContext release ;  remaining calls = "+this.mediaPillarCallContext.telephonyCallRefs.length);this.isMediaPillarReleasableCall()?(e.setMediaPillarCall(null),this.removeTelCallRefs(e),this.mediaPillarCallContext.webrtcCallRef&&this.mediaPillarCallContext.callState!==g.WebCallReleasing&&this.mediaPillarCallContext.callState!==g.RemoteControled?this.mediaPillarCallContext.callState!==g.TelCallReleasing?(this.mediaPillarCallContext.callState=g.TelCallReleasing,this.stopCallStateTimeOut(),this.mediaPillarCallContext.callState_TO=setTimeout((()=>{this.automatonDefenseTimout(e)}),this.TO_transition),this.logger.info("[WebrtcGatewayService] onTelCallReleasing -- "+e.id+" -- wait web release: state = "+this.mediaPillarCallContext.callState)):this.logger.info("[WebrtcGatewayService] onTelCallReleasing -- "+e.id+" -- ignore telrelease on state = "+this.mediaPillarCallContext.callState):this.mediaPillarCallContext.callState!==g.Free&&(this.releaseMediaPillarCallContext(),this.logger.info("[WebrtcGatewayService] onTelCallReleasing -- "+e.id+" -- release MP context"))):(this.logger.warn("[WebrtcGatewayService] onTelCallReleasing | media Pillar call release anomaly on state = "+this.mediaPillarCallContext.callState),this.mediaPillarCallTerminator())}onWebrtcCallIncomming(e){if(this.mediaPillarCallContext.webrtcCallRef)this.logger.info("[WebrtcGatewayService] onWebrtcCallIncomming -- "+e.id+" --- ignored other incomming");else{if(this.mediaPillarCallContext.callState===g.WebCallReleasing&&0!==this.mediaPillarCallContext.telephonyCallRefs.length&&this.mediaPillarCallContext.telephonyCallRefs[0].status!==n.Call.Status.UNKNOWN){if(this.logger.info("[WebrtcGatewayService] onWebrtcCallIncomming -- "+e.id+" --- re propose during ongoing tel call"),this.mediaPillarCallContext.telephonyCallRefs[0].status!==n.Call.Status.QUEUED_INCOMMING&&this.mediaPillarCallContext.telephonyCallRefs[0].status!==n.Call.Status.RINGING_INCOMMING)return this.mediaPillarCallContext.webrtcCallRef=e,this.mediaPillarCallContext.webrtcCallRef.setMediaPillarCall(this.getMediaPillarCallContext()),this.webrtcP2PService.answerCall(this.mediaPillarCallContext.webrtcCallRef,"audio"),this.stopCallStateTimeOut(),this.mediaPillarCallContext.callState_TO=setTimeout((()=>{this.automatonDefenseTimout(e)}),this.TO_transition,1),void(this.mediaPillarCallContext.callState=g.CallOnGoing);this.mediaPillarCallContext.callState=g.WaitWebrtc,this.mediaPillarCallContext.telephonyCallRefs[0].setMediaPillarCall(this.getMediaPillarCallContext())}switch(this.mediaPillarConnection.mediaPillarJidArray.includes(e.fullJid)&&(this.mediaPillarCallContext.onGoingCallMediaPillarJid=e.fullJid),this.mediaPillaryseTheCall(null,e)){case"Ok":if(this.stopCallStateTimeOut(),!this.isMediaPillarOutgoingCall()&&this.mediaPillarCallContext.callState===g.WaitTelephony&&this.telephonyService.isOxe||(this.logger.debug("[WebrtcGatewayService] onWebrtcCallIncomming: arm callState_TO"),this.mediaPillarCallContext.callState_TO=setTimeout((()=>{this.automatonDefenseTimout(e)}),this.TO_transition,1)),this.isMediaPillarOutgoingCall())this.webrtcP2PService.answerCall(this.mediaPillarCallContext.webrtcCallRef,"audio"),this.logger.info("[WebrtcGatewayService] onWebrtcCallIncomming | outgoing3PCC then send webrtc proceed");else if(this.mediaPillarCallContext.callState===g.WaitTelephony&&this.telephonyService.isOxe)this.logger.info("[WebrtcGatewayService] onWebrtcCallIncomming | incoming webrtc WaitTelephony on Oxe : arm waitTelephony_TO "),this.stopWaitTelephonyTimeOut(),this.mediaPillarCallContext.waitTelephony_TO=setTimeout((()=>{this.waitTelephonyTimeout(e,this.mediaPillarCallContext)}),this.TO_waitTelephony,1);else if(this.mediaPillarCallContext.callState===g.CallOffer){this.logger.info("[WebrtcGatewayService] onWebrtcCallIncomming | incoming webrtc + telephony"),this.stopCallStateTimeOut();for(let e=0;e<this.mediaPillarCallContext.telephonyCallRefs.length;e++){const t=this.mediaPillarCallContext.telephonyCallRefs[e];t.status!==n.Call.Status.RINGING_INCOMMING&&t.status!==n.Call.Status.QUEUED_INCOMMING||(t.autoOffHookResource?t.autoOffHookResource===this.xmppService.getResourceFromJid(this.contactService.userContact.fullJid)?(this.logger.info("[WebrtcGatewayService] onWebrtcCallIncomming | blindPickup in progress : let's answer to call "+t.id),this.answerCall(t)):this.logger.debug("[WebrtcGatewayService] onWebrtcCallIncomming | blindPickup in progress on another client of our user: do nothing for call "+t.id):(this.logger.info("[WebrtcGatewayService] onWebrtcCallIncomming | ON_CONVERSATION_CALL_UPDATED_EVENT for call = "+this.mediaPillarCallContext.telephonyCallRefs[e].id),this.eventService.publish("ON_WEBRTC_GW_CALL_UPDATED_EVENT",t)))}}break;case"Ignore":break;default:this.logger.error("[WebrtcGatewayService] onWebrtcCallIncomming | media Pillar call anomaly "+status)}}}onWebrtcCallConnecting(e){return this.mediaPillarCallContext.callState===g.CallActive?(this.logger.info("[WebrtcGatewayService] onWebrtcCallConnecting -- media Pillar call reconnecting attempts for call : "+e),this.mediaPillarCallContext.callState=g.CallActiveNoWebMedia,this.stopCallStateTimeOut(),void(this.mediaPillarCallContext.callState_TO=setTimeout((()=>{this.timeOutCallActiveNoWebMedia(this.mediaPillarCallContext)}),this.TO_NoWebMedia,1))):this.mediaPillarCallContext.callState===g.TelCallReleasing?(this.logger.info("[WebrtcGatewayService] onWebrtcCallConnecting -- media Pillar webrtc call reconnecting while TelCallReleasing"),this.mediaPillarCallContext.callState=g.CallActiveNoWebMedia,this.stopCallStateTimeOut(),void(this.mediaPillarCallContext.callState_TO=setTimeout((()=>{this.timeOutCallActiveNoWebMedia(this.mediaPillarCallContext)}),this.TO_NoWebMediaNotel,1))):void 0}onWebrtcCallActive(e){this.mediaPillarCallContext.callState===g.CallActiveNoWebMedia?(this.logger.info("[WebrtcGatewayService] onWebrtcCallActive -- media Pillar call reconnected"),this.mediaPillarCallContext.callState=g.CallActive,this.stopCallStateTimeOut()):this.telephonyService.oxoMultiCallMode()&&this.mediaPillarCallContext.callState===g.CallOnGoing&&(this.mediaPillarCallContext.telephonyCallRefs[0].status===n.Call.Status.ACTIVE?(this.stopCallStateTimeOut(),this.mediaPillarCallContext.callState=g.CallActive,this.logger.info("[WebrtcGatewayService] onWebrtcCallActive -- OXO specific mng | MP call becomes fully Active ")):this.logger.info("[WebrtcGatewayService] onWebrtcCallActive -- OXO specific mng call State Anomaly"))}onWebrtcCallAnswering(e){this.mediaPillarCallContext.callState=g.CallOnGoing,this.stopCallStateTimeOut(),this.mediaPillarCallContext.callState_TO=setTimeout((()=>{this.automatonDefenseTimout(e)}),this.TO_transition,1)}onWebrtcCallReleasing(e){if(this.isMediaPillarReleasableCall())if(e.setMediaPillarCall(null),this.mediaPillarCallContext.webrtcCallRef=null,0!==this.mediaPillarCallContext.telephonyCallRefs.length&&this.mediaPillarCallContext.callState!==g.TelCallReleasing&&this.mediaPillarCallContext.callState!==g.RemoteControled)if(this.mediaPillarCallContext.callState!==g.WebCallReleasing){this.mediaPillarCallContext.callState=g.WebCallReleasing,this.stopCallStateTimeOut(),this.mediaPillarCallContext.callState_TO=setTimeout((()=>{this.automatonDefenseTimout(e)}),this.TO_transition,1),this.releasePbxCallIfPbxConnectionDown();for(let e=0;e<this.mediaPillarCallContext.telephonyCallRefs.length;e++)this.mediaPillarCallContext.telephonyCallRefs[e].status!==n.Call.Status.RINGING_INCOMMING&&this.mediaPillarCallContext.telephonyCallRefs[e].status!==n.Call.Status.QUEUED_INCOMMING||(this.logger.info("[WebrtcGatewayService] onWebrtcCallReleasing | ON_CONVERSATION_CALL_UPDATED_EVENT for call = "+this.mediaPillarCallContext.telephonyCallRefs[e].id),this.eventService.publish("ON_WEBRTC_GW_CALL_UPDATED_EVENT",this.mediaPillarCallContext.telephonyCallRefs[e]));this.logger.info("[WebrtcGatewayService] onWebrtcCallReleasing -- "+e.id+" -- wait tel release: state = "+this.mediaPillarCallContext.callState)}else this.logger.info("[WebrtcGatewayService] onWebrtcCallReleasing -- "+e.id+" -- ignore webrelease on state = "+this.mediaPillarCallContext.callState);else this.releaseMediaPillarCallContext(),this.logger.info("[WebrtcGatewayService] onWebrtcCallReleasing -- "+e.id+" -- release MP context");else this.logger.warn("[WebrtcGatewayService] onWebrtcCallReleasing | media Pillar call release anomaly on state = "+this.mediaPillarCallContext.callState),this.mediaPillarCallTerminator()}async waitTelephonyTimeout(e,t){if(t.callState===g.WaitTelephony){this.logger.info("[WebrtcGatewayService] waitTelephonyTimeout date "+s().format("HH:mm:ss:SSS")+" -- "+e.id+" -- state = "+t.callState+" : perform snpashot on secondary device to check remote extension's csta state");try{const i=await this.telephonyService.snapshotDevice(true),r=i?i.connections:null;t.callState!==g.WaitTelephony||r&&0!==r.length?(this.logger.info("[WebrtcGatewayService] waitTelephonyTimeout date "+s().format("HH:mm:ss:SSS")+" -- "+e.id+" -- state = "+t.callState+" => no more waiting for phone call or existing csta call: don't display any incoming call popup"),this.stopCallStateTimeOut(t),t.callState_TO=setTimeout((()=>{this.automatonDefenseTimout(e,t)}),this.TO_transition,1)):(this.logger.info("[WebrtcGatewayService] waitTelephonyTimeout date "+s().format("HH:mm:ss:SSS")+" -- "+e.id+" -- state = "+t.callState+" => still waiting for phone call and no csta call: send event to open incoming call popup with webrtc call"),t.isIncomingCallPopupWithWebRtcCall=true,this.eventService.publish("ON_CONVERSATION_CALL_UPDATED_EVENT",{conversation:null,call:e}))}catch(i){this.logger.error("[WebrtcGatewayService] waitTelephonyTimeout date "+s().format("HH:mm:ss:SSS")+" -- "+e.id+" -- state = "+t.callState+" => snpashotdevice error "+i)}}else this.logger.info("[WebrtcGatewayService] waitTelephonyTimeout date "+s().format("HH:mm:ss:SSS")+" -- "+e.id+" -- state = "+t.callState+" => IGNORED");t.waitTelephony_TO=null}releasePbxCallIfPbxConnectionDown(){const e=this.getActivePbxCall();e&&e.pbxConnectionDown&&(this.logger.info("[WebrtcGatewayService] releasePbxCallIfPbxConnectionDown | release call"+e),this.telephonyService.releaseCall(e),e.mediaPillarCall=null)}mediaPillarMakeCall1PCC(e,t){this.logger.info("[WebrtcGatewayService] mediaPillarMakeCall1PCC");const i=this.getDefaultMediaPillarJid();if(!this.mediaPillarConfigured||!this.mediaPillarAlive)return this.logger.info("[WebrtcGatewayService] mediaPillarMakeCall1PCC ANOMALY webrtcgateway not available"),null;if(this.webrtcP2PService.makingCall=true,""!==i){const r="web_"+crypto.randomUUID();if(!t||null===t){const t=n.Call.create(n.Call.Status.DIALING,r,n.Call.Type.WEBRTC,this.mediaPillarContact);return t.fullJid=i,this.mediaPillarStartCall(t,e,i),t}const s=n.Call.create(n.Call.Status.DIALING,r,n.Call.Type.WEBRTC,t);return s.fullJid=i,this.mediaPillarStartCall(s,e,i),s}return this.logger.info("[WebrtcGatewayService] mediaPillarMakeCall ANOMALY no mediaPillarJid"),null}mediaPillarReleaseCall1PCC(e){if(this.logger.info("[WebrtcGatewayService] mediaPillarReleaseCall1PCC"),!this.mediaPillarConfigured)return void this.logger.info("[WebrtcGatewayService] mediaPillarReleaseCall1PCC ANOMALY webrtcgateway not available");const t=this.webrtcP2PService.calls[e.id];t&&t.type===n.Call.Type.WEBRTC?this.webrtcP2PService.rejectCall(t):this.logger.info("[WebrtcGatewayService] mediaPillarReleaseCall1PCC ANOMALY invalid call")}mediaPillarMakeCall(e,t){this.logger.info("[WebrtcGatewayService] mediaPillarMakeCall");const i=this.getDefaultMediaPillarJid();if(e.length>6&&t&&(e=t.phonePbx),this.webrtcP2PService.makingCall=true,""!==i){const r="web_"+crypto.randomUUID();if(t&&null!==t){const s=n.Call.create(n.Call.Status.DIALING,r,n.Call.Type.WEBRTC,t);s.fullJid=i,this.mediaPillarStartCall(s,e,i)}else{const t=n.Call.create(n.Call.Status.DIALING,r,n.Call.Type.WEBRTC,this.mediaPillarContact);t.fullJid=i,this.mediaPillarStartCall(t,e,i)}}else this.logger.info("[WebrtcGatewayService] mediaPillarMakeCall ANOMALY no mediaPillarJid")}async mediaPillarStartCall(e,t,i){this.logger.info("[WebrtcGatewayService] mediaPillarStartCall for phone number "+t);try{await this.initiateMediaPillarCall(e);try{await this.registerOneMediaPillar(i),this.logger.info("[WebrtcGatewayService ] mediaPillarStartCall for number "+t),this.webrtcP2PService.makeJingleCall(e,i,t)}catch(r){this.logger.info("[WebrtcGatewayService] mediaPillarStartCall ANOMALY registerOneMediaPillar then abort call"),this.abortCall(e)}}catch(r){this.logger.info("[WebrtcGatewayService] mediaPillarMakeCall ANOMALY initiateMediaPillarCall then abort call"),this.abortCall(e)}}abortCall(e){this.webrtcP2PService.makingCall=false,e&&this.webrtcP2PService.removeCallObject(e),this.webrtcP2PService.resetToSafeState()}async initiateMediaPillarCall(e){const t=["audio"];try{this.logger.info("[WebrtcGatewayService] initiateMediaPillarCall");const i=await this.webrtcP2PService.getBrowserMedia(t);this.webrtcP2PService.calls[e.id]=e,e.isInitiator=true,this.webrtcP2PService.pushInLocalStreams(i,e.id),e.localMedia=e.localMedia|n.Call.Media.AUDIO,this.contactService.setBusyState("dnd",this.webrtcP2PService.calculatePresenceMessage(e)),this.eventService.publish("ON_CALL_UPDATED_EVENT",e)}catch(i){this.logger.info("[WebrtcGatewayService]   | initate call failure : "+JSON.stringify({error:i.message})),t.indexOf("sharing")>=0||-1===i.toString().indexOf("getUserMedia")||this.webrtcP2PService.openErrorPopup()}}async registerOneMediaPillar(e){if(!e){this.logger.debug("[WebrtcGatewayService] registerOneMediaPillar -- missing MPJid --");throw new Error("registerOneMediaPillar -- missing MPJid --")}if(!this.mediaPillarConnection.mediaPillarJidArray.includes(e)){this.logger.debug("[WebrtcGatewayService] registerOneMediaPillar -- unknow MPJid --"+e);throw new Error("registerOneMediaPillar -- unknow MPJid --"+e)}if(!this.mediaPillarConnection.mediaPillarStatesPool[e].mediaPillarConfigured){this.logger.debug("[WebrtcGatewayService] registerOneMediaPillar -- MPJid not configured --"+e),this.mediaPillarConnection.mediaPillarStatesPool[e].mediaPillarAlive=false;throw new Error("registerOneMediaPillar -- MPJid not configured --"+e)}const t=$iq({from:this.myContact.fullJid,to:e,type:"set"}).c("mediapillar",{xmlns:"urn:xmpp:janus:1"}).c("register").c("jidIm").t(this.contactService.userContact.jid).up().c("jidTel").t(this.contactService.userContact.jidtel).up().c("number").t(this.mediaPillarConnection.rainbowPhoneNumber).up().c("displayName").t(this.myContact.displayName).up().c("secret").t(this.mediaPillarConnection.rainbowPhoneNumber).up();try{await this.xmppService.sendIQ(t),this.mediaPillarConnection.mediaPillarStatesPool[e].mediaPillarAlive=true}catch(i){throw this.mediaPillarConnection.mediaPillarStatesPool[e].mediaPillarAlive=false,this.logger.info("[WebrtcGatewayService] registerOneMediaPillar -- register failure -- for MPJid = "+e+" // error : "+i.message),i}}async registerMediaPillarPool(){const e=[];this.mediaPillarConnection.mediaPillarJidArray.forEach((t=>{e.push((async()=>{try{await this.registerOneMediaPillar(t)}catch(e){}})())}));try{await Promise.all(e)}finally{this.mediaPillarAlive=this.isMediaPillarPoolAlive(null)}}async getMediaPillarData(){if(!this.telephonyService.isSipWise())try{const e=this.portalURL+"/data",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=(await i.json()).data;if(this.logger.log("[WebrtcGatewayService] getMediaPillarData success"),r){const e=r.prefix,t=r.rainbowPhoneNumber;e&&t&&(this.mediaPillarConnection.rainbowPhoneNumber=t,this.mediaPillarConnection.remoteExtension=e+t);let i=[];if(r.jid_im&&Array.isArray(r.jid_im))i=r.jid_im,i=i.map((e=>(-1===e.indexOf("/")&&(e+="/mediapillar"),e)));else{let e=r.jid_im;e&&-1===e.indexOf("/")&&(e+="/mediapillar"),i[0]=e}return i}throw this.logger.error("[WebrtcGatewayService] getMediaPillarData success -- missing data"),new Error("[WebrtcGatewayService] getMediaPillarData -- missing data in response")}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getMediaPillarData");throw this.logger.error("[WebrtcGatewayService] "+t.message),t.error}try{const e=this.telephonyService.telephonyServiceSipWise.getPortalURL()+"devices",t=this.authService.getRequestHeader();this.logger.info("[WebrtcGatewayService] getMediaPillarData sipwise device  GET "+e);const i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=await i.json();this.logger.log("[WebrtcGatewayService] getMediaPillarData sipwise success/ status : "+i.statusText);const n=[];if(r){if(r.forEach((e=>{if("webrtc"===e.type){this.mediaPillarConnection.rainbowPhoneNumber=e.deviceId,this.mediaPillarConnection.remoteExtension=e.deviceId;let t=e.jid_wrg;t&&-1===t.indexOf("/")&&(t+="/mediapillar"),n.push(t)}})),""!==n[0])return n;throw this.logger.error("[WebrtcGatewayService] getMediaPillarData sipwise success but missing jid_wrg"),new Error("[WebrtcGatewayService] getMediaPillarData sipwise -- missing jid_wrg in response")}throw this.logger.error("[WebrtcGatewayService] getMediaPillarData sipwise success but missing data"),new Error("[WebrtcGatewayService] getMediaPillarData sipwise -- missing data in response")}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getMediaPillarData");throw this.logger.error("[WebrtcGatewayService] getMediaPillarData sipwise error --  "+t.message),t.error}}mediaPillarKeepAlivePolling(e,t){if(this.started)switch(e){case"START":this.mediaPillarConnection&&this.mediaPillarConnection.keepAlive_TO&&(clearTimeout(this.mediaPillarConnection.keepAlive_TO),this.mediaPillarConnection.keepAlive_TO=null),this.mediaPillarConnection.keepAlive_TO=setTimeout((()=>{this.mediaPillarKeepAlive()}),t,1);break;case"STOP":this.mediaPillarPollingSelected=false,this.mediaPillarCallContext&&this.mediaPillarConnection.keepAlive_TO&&clearTimeout(this.mediaPillarConnection.keepAlive_TO),this.mediaPillarConnection.keepAlive_TO=null;break;default:this.logger.error("[WebrtcGatewayService] mediaPillarKeepAlivePolling cmd error : "+e)}}mediaPillarUserSelectAndPolling(e){this.started&&(this.logger.log("[WebrtcGatewayService] mediaPillarUserSelectAndPolling : "+e),e?this.mediaPillarPollingSelected?this.logger.log("[WebrtcGatewayService] mediaPillarUserSelectAndPolling polling already started"):(this.mediaPillarPollingSelected=true,this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING),this.mediaPillarKeepAlive()):this.mediaPillarAlive&&(this.mediaPillarKeepAlivePolling("STOP",0),this.mediaPillarPollingSelected=false))}async mediaPillarKeepAlive(){if(this.mediaPillarKeepAliveSuspend)this.logger.info("[WebrtcGatewayService] KeepAlive suspended");else{const e=this.mediaPillarAlive;try{await this.registerMediaPillarPool()}finally{this.mediaPillarAlive!==e&&(this.mediaPillarAlive?this.logger.info("[WebrtcGatewayService] mediaPillarKeepAlive webrtcgateway is UP"):this.logger.info("[WebrtcGatewayService] mediaPillarKeepAlive webrtcgateway is DOWN"),this.eventService.publish("ON_WEBRTCGATEWAY_STATE_CHG",this.mediaPillarAlive),this.logger.info("[WebrtcGatewayService] mediaPillarKeepAlive ON_WEBRTCGATEWAY_STATE_CHG"),this.keepAliveIterationCpt=0),this.mediaPillarAlive?(this.TO_PILLAR_POLLING<9e5?this.TO_PILLAR_POLLING+=1800:this.TO_PILLAR_POLLING=9e5,this.keepAliveIterationCpt=0):(++this.keepAliveIterationCpt<=2?this.TO_PILLAR_POLLING=15e3:this.TO_PILLAR_POLLING=3e5,this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING)),this.isMediaPillarUserSelected()&&this.mediaPillarAlive&&this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING)}}}forceMPpooling(){this.started&&(this.logger.log("[WebrtcGatewayService] forceMPpolling "),this.TO_PILLAR_POLLING=3e5,this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING),this.eventService.publish("ON_WEBRTCGATEWAY_STATE_CHG",this.mediaPillarAlive))}isMediaPillarPoolConfigured(e){let t=false;if(e&&this.mediaPillarConnection.mediaPillarStatesPool[e])t=this.mediaPillarConnection.mediaPillarStatesPool[e].mediaPillarConfigured;else{this.mediaPillarConnection.mediaPillarJidArray.find((e=>this.mediaPillarConnection.mediaPillarStatesPool[e]&&true===this.mediaPillarConnection.mediaPillarStatesPool[e].mediaPillarConfigured))&&(t=true)}return t}isMediaPillarPoolAlive(e){let t=false;return t=e&&this.mediaPillarConnection.mediaPillarStatesPool[e]?this.mediaPillarConnection.mediaPillarStatesPool[e].mediaPillarAlive:this.mediaPillarConnection.mediaPillarJidArray.some((e=>this.mediaPillarConnection.mediaPillarStatesPool[e]&&true===this.mediaPillarConnection.mediaPillarStatesPool[e].mediaPillarAlive)),t}getAllMediaPillarJid(){return this.mediaPillarConnection.mediaPillarJidArray}getDefaultMediaPillarJid(){let e=this.mediaPillarConnection.mediaPillarJidArray[0];return e||(e=""),e}getOnGoingMediaPillarJid(){let e=this.getDefaultMediaPillarJid();return this.mediaPillarCallContext&&this.mediaPillarCallContext.onGoingCallMediaPillarJid&&""!==this.mediaPillarCallContext.onGoingCallMediaPillarJid&&(e=this.mediaPillarCallContext.onGoingCallMediaPillarJid),e}getMyMediaPillarRemoteExtension(){if(!this.telephonyService.isSipWise())return this.mediaPillarConnection.remoteExtension;const e=this.telephonyService.telephonyServiceSipWise.getDeviceIdWithType("webrtc");return e||""}shouldUseMediaPillar(){return false}isMediaPillarConfigured(){return this.mediaPillarConfigured&&this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_WEBRTC_PSTN_CALLING)}isMediaPillarAvailable(){let e=this.isMediaPillarConfigured();return e=e&&this.mediaPillarAlive,e}isMediaPillarUserSelected(){let e;if(this.telephonyService.isSipWise()){const t=this.telephonyService.telephonyServiceSipWise.getCurrentDevice();e=t&&"webrtc"===t.type}else e=!this.telephonyService.nomadicObject.makeCallInitiatorIsMain&&this.telephonyService.getNomadicDestination()===this.getMyMediaPillarRemoteExtension();return e}isMediaPillarJid(e){let t=-1;return!!e&&(t=e.search("mp_"),0===t)}isMediaPillarCallCase(){return this.isMediaPillarAvailable()&&this.isMediaPillarUserSelected()}isMediaPillarCallSituation(e=null){let t=this.isMediaPillarCallCase();if(e)if(e.type===n.Call.Type.WEBRTC)t=t&&this.isMediaPillarJid(e.fullJid);else if(this.telephonyService.getCalls().length<=1&&this.mediaPillarCallContext.telephonyCallRefs.length<=1)switch(e.status){case n.Call.Status.RINGING_INCOMMING:case n.Call.Status.RINGING_OUTGOING:case n.Call.Status.QUEUED_INCOMMING:case n.Call.Status.DIALING:case n.Call.Status.RELEASING:break;default:t=!!e.mediaPillarCall&&(t&&this.isInTelCallRefs(e))}else switch(e.status){case n.Call.Status.RINGING_INCOMMING:case n.Call.Status.RINGING_OUTGOING:case n.Call.Status.QUEUED_INCOMMING:case n.Call.Status.DIALING:case n.Call.Status.RELEASING:break;default:e.mediaPillarCall?(t=t&&e.mediaPillarCall.telephonyCallRefs.length>=1,t=t&&this.isInTelCallRefs(e)):t=false}return t}mediaPillaryseTheCall(e,t){if(this.mediaPillarCallContext.callState!==g.Free){if(e&&this.telephonyService.oxoMultiCallMode()&&this.mediaPillarCallContext.callState===g.TelCallReleasing&&e.status===n.Call.Status.RINGING_INCOMMING)return this.logger.info("[WebrtcGatewayService] mediaPillaryseTheCall | special oxoMulticall situation with re nego of csta & web ref"),e.setMediaPillarCall(this.getMediaPillarCallContext()),this.mediaPillarCallContext.callState=g.CallOnGoing,"Update";if(e&&this.mediaPillarCallContext.updateContactFlag)return this.logger.info("[WebrtcGatewayService] mediaPillaryseTheCall | only Update"),e.setMediaPillarCall(this.getMediaPillarCallContext()),"Update";if(e&&this.mediaPillarCallContext.callState===g.TelCallReleasing&&e.status===n.Call.Status.RINGING_INCOMMING)return this.logger.info("[WebrtcGatewayService] mediaPillaryseTheCall |  transfer managed as Update"),e.setMediaPillarCall(this.getMediaPillarCallContext()),this.mediaPillarCallContext.callState=g.CallOffer,"Update";if(t&&this.mediaPillarCallContext.callState!==g.WaitWebrtc)return this.logger.info("[WebrtcGatewayService] mediaPillaryseTheCall | only Ignore"),"Ignore"}let i="";if(!e&&!t)return"NoCallRef";if(e&&t)return"toManyCallRef";if(e){switch(this.mediaPillarCallContext.callState){case g.Free:this.mediaPillarCallContext.callState=g.WaitWebrtc,i="Ok";break;case g.WaitTelephony:this.mediaPillarCallContext.callState=g.CallOffer,i="Ok";break;case g.CallOffer:this.logger.info("[WebrtcGatewayService] mediaPillaryseTheCall | in callOffer received again incomingCall then ignore"),i="Ignore";break;case g.CallActive:case g.WebCallReleasing:e.status===n.Call.Status.RINGING_INCOMMING&&(i="Ignore");break;case g.WaitWebrtc:this.mediaPillarCallContext.telephonyCallRefs.length>1?(this.logger.info("[WebrtcGatewayService] mediaPillaryseTheCall but 2nd incomming in WaitWebrtc| only Ignore"),e.setMediaPillarCall(this.getMediaPillarCallContext()),i="Ignore"):this.telephonyService.isSipWise()?this.logger.info("[WebrtcGatewayService] multiple mediaPillaryseTheCall but sipwise case | only Ignore"):(this.mediaPillarCallContext.callState=g.AnomalyCCS,i="Ano_inTel_contextCallState_"+this.mediaPillarCallContext.callState,this.logger.info("[WebrtcGatewayService] mediaPillaryseTheCall again in WaitWebrtc"));break;default:this.mediaPillarCallContext.callState=g.AnomalyCCS,i="Ano_inTel_contextCallState_"+this.mediaPillarCallContext.callState}"Ok"===i&&(this.putAsMasterTelCallRefs(e),e.setMediaPillarCall(this.getMediaPillarCallContext()))}else if(t){switch(this.mediaPillarCallContext.webrtcCallRef=t,this.mediaPillarCallContext.callState){case g.Free:this.mediaPillarCallContext.callState=g.WaitTelephony,i="Ok";break;case g.WaitWebrtc:this.mediaPillarCallContext.callState=g.CallOffer,i="Ok";break;default:this.mediaPillarCallContext.callState=g.AnomalyCCS,i="Ano_inWrtc_contextCallState_"+this.mediaPillarCallContext.callState}"Ok"===i&&t.setMediaPillarCall(this.getMediaPillarCallContext())}return i}getMediaPillarCallContext(e=null){if(!e||!this.telephonyService.isSipWise())return this.mediaPillarCallContext;const t=this.mediaPillarCallContexts.find((t=>t.telephonyCallRefs&&t.telephonyCallRefs.length&&t.telephonyCallRefs[0].id===e.id||t.webrtcCallRef&&t.webrtcCallRef.id===e.id));return t?this.logger.debug("[WebrtcGatewayService] CTX getMediaPillarCallContext for "+e+" returns context id "+t.id):this.logger.error("[WebrtcGatewayService] CTX getMediaPillarCallContext for "+e+" returns context not found"),t}isMediaPillarOutgoingCall(){let e;switch(this.mediaPillarCallContext.callState){case g.WaitWebrtc:case g.WaitTelephony:case g.CallOffer:case g.CallOnGoing:case g.CallActive:case g.CallActiveNoWebMedia:case g.TelCallReleasing:case g.WebCallReleasing:e=true;break;default:e=false}return e&&this.mediaPillarCallContext.isOutgoingCall3PCC}isMediaPillarReleasableCall(){let e;switch(this.mediaPillarCallContext.callState){case g.AnomalyCCS:case g.Unknow:e=false;break;default:e=true}return e}mediaPillarReleaseWebrtcCall(e){e.webrtcCallRef&&(e.webrtcCallRef.mediaPillarCall=null,this.webrtcP2PService.releaseCall(e.webrtcCallRef))}timeOutCallActiveNoWebMedia(e){this.logger.info("[WebrtcGatewayService] timeOutCallActiveNoWebMedia"),e.callState===g.CallActiveNoWebMedia&&(this.mediaPillarCallTerminator(e),this.mediaPillarKeepAlive(),this.logger.info("[WebrtcGatewayService] timeOutCallActiveNoWebMedia noWebMedia then release calls if existing & force keepalive"))}mediaPillarCallTerminator(e=null){e||(e=this.mediaPillarCallContext),0!==e.telephonyCallRefs.length&&e.telephonyCallRefs.forEach((e=>{null!==e&&e.type.value===n.Call.Type.PHONE.value&&(e.mediaPillarCall=null,this.telephonyService.releaseCall(e),this.logger.info("[WebrtcGatewayService] mediaPillarCallTerminator | release call"+e))})),this.mediaPillarReleaseWebrtcCall(e),this.releaseMediaPillarCallContext(e),this.resetEvtAutomaton(),this.TO_PILLAR_POLLING+=3e5,this.mediaPillarKeepAlivePolling("START",this.TO_PILLAR_POLLING),this.logger.warn("[WebrtcGatewayService] mediaPillarCallTerminator | Full cleaning")}createMediaPillarContact(e){this.logger.info("[webrtcGatewayService] createMediaPillarContact -- "+e);const t=this.contactService.createBasicContact(e);return t.displayName="mediaPillar",t.avatar=new Image,this.authService.fromSDK?t.avatar.src="":t.avatar.src="/assets/skins/rainbow/images/conversations/unknownUser.jpeg",this.xmppService.getResourceFromJid(e)&&this.contactService.createBasicContact(this.xmppService.getBareJidFromJid(e)),t}muteAudio(e,t,i){if(e){if(this.getMediaPillarCallContext(e)){const r=this.getMediaPillarCallContext(e).webrtcCallRef;if(r){const n=this.xmppService.connection.jingle.sessions[r.id];if(n){n.muteAudio(t),r.isMuted=t,i&&(i.isMutedAudio=t,i.rxSubject.next({name:"callUpdate",value:e})),e.isMuted=t,this.logger.info("[webrtcGatewayService] muteAudio conversation: "+(i?i.id:"undefined")+" / pbxcall: "+e.id+"-- "+(t?"mute":"unumute"));const s={call:e};i&&(s.conversation=i),this.eventService.publish("ON_CONVERSATION_CALL_MUTED_UPDATED_EVENT",s),this.eventService.publish("ON_MPMEDIA_CONVERSATION_CALL_UPDATED_EVENT",{call:r})}else this.logger.error("[webrtcGatewayService] muteAudio "+e.id+" -- failure: no session")}}}else this.logger.error("[webrtcGatewayService] muteAudio - trying to mute a non existing call !")}getActivePbxCall(){return this.isMediaPillarCallCase()&&this.mediaPillarCallContext?this.mediaPillarCallContext.telephonyCallRefs.find((e=>e.status===n.Call.Status.ACTIVE)):null}async answerCall(e){const t=e.getMediaPillarCall();if(this.logger.info("[WebrtcGatewayService] [TEL] -- answerCall call id "+e.id+" -- webrtcCallRef "+(t&&t.webrtcCallRef?t.webrtcCallRef:"no context or no webrtc call")),this.isMixPstnWebRtcAllowed&&this.eventService.publish("PUT_ACTIVE_WEBRTC_CALL_ON_HOLD"),this.telephonyService.oxoMultiCallMode()&&e.type.value===n.Call.Type.PHONE.value&&(this.logger.info("[WebrtcGatewayService] -- answerCall call id "+e.id+" -- OXO specific mng"),e.status===n.Call.Status.QUEUED_INCOMMING||e.status===n.Call.Status.RINGING_INCOMMING))return this.logger.info("[WebrtcGatewayService] -- answerCall -- by telephony service for call : "+e.id),this.putAsMasterTelCallRefs(e),this.mediaPillarCallContext.callOwnerForOxoMultiClientFlag=true,this.mediaPillarCallContext.callState=g.CallOffer,void this.telephonyService.answerCall(e).catch((()=>{this.eventService.publish("ON_CALL_UPDATED_EVENT",e)}));t&&t.webrtcCallRef&&t.webrtcCallRef.status===n.Call.Status.RINGING_INCOMMING?(e.noIncomingPopup=true,await this.actionOnActiveCallIfNecessary(e),this.logger.info("[WebrtcGatewayService] -- answerCall -- send webrtc proceed for call : "+e.id),this.webrtcP2PService.answerCall(t.webrtcCallRef,"audio"),e.isMPAudioOwner=true):e.status===n.Call.Status.QUEUED_INCOMMING||e.status===n.Call.Status.RINGING_INCOMMING?(this.logger.info("[WebrtcGatewayService] -- answerCall -- by telephony service for call : "+e.id),this.telephonyService.answerCall(e).catch((()=>{this.eventService.publish("ON_CALL_UPDATED_EVENT",e)}))):this.logger.info("[WebrtcGatewayService] -- answerCall -- Anomaly media Pillar : answerAudioAction but no webrtcCallref & no 2nd call")}async actionOnActiveCallIfNecessary(e){this.isMixPstnWebRtcAllowed&&this.eventService.publish("PUT_ACTIVE_WEBRTC_CALL_ON_HOLD");const t=this.telephonyService.getOngoingOutgoingCall();if(t&&t.id!==e.id)return this.telephonyService.releaseCall(t);if(this.telephonyService.isSipWise()){const t=this.telephonyService.getActiveCall();if(t&&t.id!==e.id)return this.telephonyService.holdCall(t)}}releaseCall(e){const t=e.getMediaPillarCall();t&&t.webrtcCallRef?e.type===n.Call.Type.PHONE?(this.logger.info("[WebrtcGatewayService] [TEL] -- releaseCall MP PHONE -- "+e.id),t.telephonyCallRefs.length<=1&&(this.logger.info("[WebrtcGatewayService] -- rejectCall MP webrtc call -- "+t.webrtcCallRef),this.webrtcP2PService.rejectCall(t.webrtcCallRef)),this.telephonyService.releaseCall(e).catch((()=>{e.setStatus(n.Call.Status.UNKNOWN),this.eventService.publish("ON_CALL_UPDATED_EVENT",e)}))):(this.logger.info("[WebrtcGatewayService] [TEL] -- releaseCall MP WEBRTC -- "+e.id),this.webrtcP2PService.rejectCall(t.webrtcCallRef)):(this.logger.info("[WebrtcGatewayService] [TEL] releaseCall | Anomaly media Pillar : declineAction but no webrtcCallref for call = "+e.id),this.telephonyService.releaseCall(e).catch((()=>{e.setStatus(n.Call.Status.UNKNOWN),this.eventService.publish("ON_CALL_UPDATED_EVENT",e)})))}async deflectCallToVm(e){this.logger.info("[WebrtcGatewayService] [TEL] -- deflectCallToVm -- "+e.id);try{await this.telephonyService.deflectCallToVM(e)}finally{if(e.type===n.Call.Type.PHONE){const t=e.getMediaPillarCall();t&&t.webrtcCallRef&&t.telephonyCallRefs.length<=1&&this.webrtcP2PService.rejectCall(t.webrtcCallRef),e.setStatus(n.Call.Status.UNKNOWN),this.eventService.publish("ON_CALL_UPDATED_EVENT",e)}}}specialCaseNotComputerModeButMPCall(e){if(!e)return void this.logger.info("[WebrtcGatewayService] specialCaseNotComputerModeButMPCall | Anomaly no tel call provided");const t=this.webrtcP2PService.getMPWebrtcAudioCallByState(n.Call.Status.RINGING_INCOMMING);if(!t)return this.logger.info("[WebrtcGatewayService] specialCaseNotComputerModeButMPCall | no valid MP webrtcCall found"),null;const i=this.getMediaPillarCallContext();return i.webrtcCallRef=t,t.setMediaPillarCall(i),e.setMediaPillarCall(i),i.callState=g.CallOffer,t.setMixtWebTelSingleStepTrans(true),this.stopWaitTelephonyTimeOut(),this.stopCallStateTimeOut(),e.noIncomingPopup=true,this.logger.debug("[WebrtcGatewayService] specialCaseNotComputerModeButMPCall | hack the telCall: "+e.id+" / webCall: "+t.id),t}}t.WebrtcGatewayService=m},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.resizeImage=(e,t,i)=>new Promise(((r,n)=>{const s=new Image;s.onload=()=>{let e=s.width,n=s.height;e>n?e>t&&(n*=t/e,e=t):n>i&&(e*=i/n,n=i);const o=document.createElement("canvas");o.width=e,o.height=n,s.width=e,s.height=n,s.crossOrigin="Anonymous";o.getContext("2d").drawImage(s,0,0,e,n);const a=new Image;a.src=o.toDataURL("image/png"),r(a)},s.onerror=()=>{n()},s.src=e})),t.getBinaryData=e=>{const t=e.src.indexOf("image/")+6,i=e.src.indexOf(";base64,"),r=e.src.slice(i+8),n=e.src.slice(t,i),s=window.atob(r),o=s.length,a=new Uint8Array(o);for(let c=0;c<o;c++)a[c]=s.charCodeAt(c);return{type:n,data:a}},t.getBase64Image=async e=>new Promise((t=>{const i=new Image;i.crossOrigin="anonymous";const r=document.createElement("canvas");i.onload=()=>{r.width=i.width,r.height=i.height;r.getContext("2d").drawImage(i,0,0),t(r.toDataURL("image/png"))},i.src=e}))},function(e,t,i){i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return s}));var r=i(29);function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s(e)}function s(e){return 0===e.length?r.a:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}},function(e,t,i){var r=i(0),n=1,s=function(){return Promise.resolve()}(),o={};function a(e){return e in o&&(delete o[e],true)}var c=function(e){var t=n++;return o[t]=true,s.then((function(){return a(t)&&e()})),t},l=function(e){a(e)},d=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.scheduler=t,r.work=i,r}return r.a(t,e),t.prototype.requestAsyncId=function(t,i,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,i,r):(t.actions.push(this),t.scheduled||(t.scheduled=c(t.flush.bind(t,null))))},t.prototype.recycleAsyncId=function(t,i,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,i,r);0===t.actions.length&&(l(i),t.scheduled=void 0)},t}(i(53).a),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.a(t,e),t.prototype.flush=function(e){this.active=true,this.scheduled=void 0;var t,i=this.actions,r=-1,n=i.length;e=e||i.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<n&&(e=i.shift()));if(this.active=false,t){for(;++r<n&&(e=i.shift());)e.unsubscribe();throw t}},t}(i(51).a);i.d(t,"b",(function(){return h})),i.d(t,"a",(function(){return f}));var h=new u(d),f=h},function(e,t,i){i.d(t,"a",(function(){return r}));var r=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}()},function(e,t,i){i.d(t,"a",(function(){return r}));var r=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}()},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(131),n=i(7),s=i(103);class o{}o.DELETED="deleted",o.UPLOADING="uploading",o.UPLOADED="uploaded",o.NOT_UPLOADED="not_uploaded",o.DOWNLOADING="downloading",o.UNKNOWN="unknown",t.FileState=o;class a{constructor(e,t,i){this.icon=e,this.style=t,this.type=i}}class c{constructor(e){e?(this.availableThumbnail=e.availableThumbnail,this.md5sum=e.md5sum,this.size=e.size,this.wantThumbnailDate=e.wantThumbnailDate):this.availableThumbnail=false}isThumbnailAvailable(){return this.availableThumbnail}}class l{constructor(e=null,t=null,i=null,o=null,a=null,l=null,d=null,u=null,h=null,f=null,p=null,g=null,m=null,v=0,S=0,b=0,y=null,C=null,w=false,_=false,E=""){this.viewersSubject=new r.BehaviorSubject([]),this.abortXMLHttpRequestArray=[],this.id=e,this.url=t,this.ownerId=i,this.fileName=s.default(o),this.extension=a,this.typeMIME=l,this.thumbnailPlaceholder=this.getThumbnailPlaceholderFromMimetype(l),this.size=d,this.registrationDate=u,this.uploadedDate=h,this.dateToSort=f,this.viewers=p,this.state=g,this.stateSubject=new r.BehaviorSubject(this.state),this.thumbnail=new c(m),this.fileToSend=void 0,this.previewBlob=void 0,this.previewBlobSubject=new r.BehaviorSubject(this.previewBlob),this.blobOrientation=void 0,this.blobOrientationSubject=new r.BehaviorSubject(this.blobOrientation),this.previewDownloaded=false,this.tags=y,this.orientation=v||void 0,this.virusScanState=C,this.original_w=S||0,this.original_h=b||0,this.voiceMessage=w,this.recordingFile=_,this.recordingConferenceId=E,this.time=this.getDate().getTime(),this.progressSubject=new n.Subject,this.loadingRef=0,this.abortTransferController=new AbortController}get viewers(){return this._viewers}set viewers(e){this._viewers=e,this.viewersSubject.next(this._viewers)}static create(e,t,i,r,n,s,o,a,c,d,u,h,f,p,g,m,v,S,b,y,C){return new l(e,t,i,r,n,s,o,a,c,d,u,h,f,p,g,m,v,S,b,y,C)}isMicrosoftFile(){return["docx","doc","ppt","pptx","xls","xlsx"].some((e=>e===this.extension))}isThumbnailPossible(){return this.isImage()||this.isPDF()}isPDF(){return"application/pdf"===this.typeMIME}isSVG(){return"svg"===this.extension}isImage(){return this.typeMIME&&this.typeMIME.length>="image/".length&&"image/"===this.typeMIME.slice(0,"image/".length)}isAudioVideo(){return["avi","mpg","wma","mp3","wmv","mkv","mov","wav","ogg","mp4","aac"].some((e=>e===this.extension))}isUploaded(){return this.state&&this.state===o.UPLOADED}isPublicUrlExpired(){if(!this.publicUrlExpirationDate)return false;const e=moment();return moment(this.publicUrlExpirationDate).isBefore(e)}isAlreadyFileViewer(e){return!!this.viewers&&this.viewers.some((t=>t.viewerId===e))}getDisplayName(){return s.default(this.fileName.replace(/\.[^/.]+$/,""))}getDisplayNameTruncated(){const e=this.fileName.replace(/\.[^/.]+$/,"");return[e.substring(0,e.length-4),e.slice(-4)]}getExtension(){return this.fileName.toUpperCase()===this.extension.toUpperCase()?"":"."+this.extension}getDuration(){return this.tags&&this.tags.duration?Math.floor(this.tags.duration):0}getThumbnailPlaceholderFromMimetype(e){return e?"image/vnd.adobe.photoshop"===e||"image/photoshop"===e||"image/x-photoshop"===e||"image/psd"===e||"application/photoshop"===e||"application/psd"===e?new a("psd-type","psdStyle","psd"):0===e.indexOf("image")?new a("image-type","imageStyle","image"):"application/msword"===e||/^application\/vnd.openxmlformats-officedocument.wordprocessingml.*$/.test(e)||"application/vnd.oasis.opendocument.text"===e?new a("document-type","docStyle","doc"):/^application\/vnd.ms-powerpoint.*$/.test(e)||/^application\/vnd.openxmlformats-officedocument.presentationml.*$/.test(e)||"application/vnd.oasis.opendocument.presentation"===e?new a("powerpoint-type","pptStyle","ppt"):0===e.indexOf("application/vnd.ms-excel")||/^application\/vnd.openxmlformats-officedocument.spreadsheetml.*$/.test(e)?new a("excel-type","xlsStyle","xls"):"application/pdf"===e||"application/vnd.oasis.opendocument.spreadsheet"===e?new a("pdf-type","pdfStyle","pdf"):0===e.indexOf("video/")?new a("video-type","videoStyle","video"):0===e.indexOf("audio/")?new a("audio-type","audioStyle","audio"):"text/plain"===e?new a("txt-type","txtStyle","txt"):"application/zip"===e||"application/x-rar-compressed"===e||"application/x-7z-compressed"===e||"application/x-tar"===e?new a("archive-type","archiveStyle","archive"):"application/illustrator"===e||0===e.indexOf("application/postscript")?new a("ai-type","aiStyle","ai"):"text/css"===e||"text/html"===e||"application/javascript"===e||"application/json"===e||"application/typescript"===e||"application/xml"===e?new a("code-type","codeStyle","code"):new a("unknown-type","otherStyle","other"):new a("unknown-type","otherStyle","other")}releaseURL(){this.localURL=void 0}setState(e){this.state=e,this.stateSubject.next(this.state)}setOriginalImageDimensions(e,t){this.original_w=e,this.original_h=t}update(e){this.id=e.id,this.url=e.url,this.ownerId=e.ownerId,this.fileName=s.default(e.fileName),this.extension=e.extension,this.typeMIME=e.typeMIME,this.size=e.size,this.registrationDate=e.registrationDate,this.uploadedDate=e.uploadedDate,this.dateToSort=e.dateToSort,this.viewers=e.viewers,this.setState(e.state),this.thumbnail=e.thumbnail,this.orientation=e.orientation,this.time=this.getDate().getTime()}getDate(){return this.uploadedDate?new Date(this.uploadedDate):this.registrationDate?new Date(this.registrationDate):new Date(this.dateToSort)}refreshFilePercent(){let e=0;this.chunkPercentArray.forEach((t=>{e+=t})),this.chunkPerformedPercent=Math.floor(e/this.chunkTotalNumber)}updateProgressInfo(){this.refreshFilePercent(),this.progressSubject.next({})}isInfected(){return"isInfected"===this.virusScanState}isSoleFileViewer(e){return!!this.viewers&&(1===this.viewers.length&&this.viewers[0].viewerId===e)}}t.FileDescriptor=l},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});var r=i(362),n=i(363),s=i(155),o=i(364),a=function(){function e(e){this.closed=false,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=true,this._unsubscribe=e)}var t;return e.prototype.unsubscribe=function(){var t;if(!this.closed){var i=this._parentOrParents,a=this._ctorUnsubscribe,l=this._unsubscribe,d=this._subscriptions;if(this.closed=true,this._parentOrParents=null,this._subscriptions=null,i instanceof e)i.remove(this);else if(null!==i)for(var u=0;u<i.length;++u){i[u].remove(this)}if(s.isFunction(l)){a&&(this._unsubscribe=void 0);try{l.call(this)}catch(p){t=p instanceof o.UnsubscriptionError?c(p.errors):[p]}}if(r.isArray(d)){u=-1;for(var h=d.length;++u<h;){var f=d[u];if(n.isObject(f))try{f.unsubscribe()}catch(p){t=t||[],p instanceof o.UnsubscriptionError?t=t.concat(c(p.errors)):t.push(p)}}}if(t)throw new o.UnsubscriptionError(t)}},e.prototype.add=function(t){var i=t;if(!t)return e.EMPTY;switch(typeof t){case"function":i=new e(t);case"object":if(i===this||i.closed||"function"!=typeof i.unsubscribe)return i;if(this.closed)return i.unsubscribe(),i;if(!(i instanceof e)){var r=i;(i=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var n=i._parentOrParents;if(null===n)i._parentOrParents=this;else if(n instanceof e){if(n===this)return i;i._parentOrParents=[n,this]}else{if(-1!==n.indexOf(this))return i;n.push(this)}var s=this._subscriptions;return null===s?this._subscriptions=[i]:s.push(i),i},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var i=t.indexOf(e);-1!==i&&t.splice(i,1)}},e.EMPTY=((t=new e).closed=true,t),e}();function c(e){return e.reduce((function(e,t){return e.concat(t instanceof o.UnsubscriptionError?t.errors:t)}),[])}t.Subscription=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{static create(){return new r}constructor(){}initShader(e,t,i){const r=e.createShader(t);if(e.shaderSource(r,i),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){const t=e.getShaderInfoLog(r);throw new Error("Unable to compile the shader. \n\n "+t)}return r}initProgram(e,t,i,r,n){const s=this.createProgram(e,t,i),o=e.getAttribLocation(s,"a_position");e.enableVertexAttribArray(o),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(o,2,e.FLOAT,false,0,0);const a=e.getAttribLocation(s,"a_texCoord");return e.enableVertexAttribArray(a),e.bindBuffer(e.ARRAY_BUFFER,n),e.vertexAttribPointer(a,2,e.FLOAT,false,0,0),s}createProgram(e,t,i){const r=e.createProgram();if(e.attachShader(r,t),e.attachShader(r,i),e.linkProgram(r),!e.getProgramParameter(r,e.LINK_STATUS)){const t=e.getProgramInfoLog(r);throw new Error("Unable to compile the WebGL program. \n\n + "+t)}return r}createTexture(e,t,i,r,n=e.NEAREST,s=e.NEAREST){const o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,s),e.texStorage2D(e.TEXTURE_2D,1,t,i,r),o}}t.WebglHelper=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.Strings=void 0;var r=function(){function e(){}return e.errors={unknownElementType:function(e){return'Unknown element type "'+e+'". Fallback will be used if present.'},unknownActionType:function(e){return'Unknown action type "'+e+'". Fallback will be used if present.'},elementTypeNotAllowed:function(e){return'Element type "'+e+'" is not allowed in this context.'},actionTypeNotAllowed:function(e){return'Action type "'+e+'" is not allowed in this context.'},invalidPropertyValue:function(e,t){return'Invalid value "'+e+'" for property "'+t+'".'},showCardMustHaveCard:function(){return'"An Action.ShowCard must have its "card" property set to a valid AdaptiveCard object.'},invalidColumnWidth:function(e){return'Invalid column width "'+e+'" - defaulting to "auto".'},invalidCardVersion:function(e){return'Invalid card version. Defaulting to "'+e+'".'},invalidVersionString:function(e){return'Invalid version string "'+e+'".'},propertyValueNotSupported:function(e,t,i,r){return'Value "'+e+'" for property "'+t+'" is supported in version '+i+", but you are using version "+r+"."},propertyNotSupported:function(e,t,i){return'Property "'+e+'" is supported in version '+t+", but you are using version "+i+"."},indexOutOfRange:function(e){return"Index out of range ("+e+")."},elementCannotBeUsedAsInline:function(){return"RichTextBlock.addInline: the specified card element cannot be used as a RichTextBlock inline."},inlineAlreadyParented:function(){return"RichTextBlock.addInline: the specified inline already belongs to another RichTextBlock."},interactivityNotAllowed:function(){return"Interactivity is not allowed."},inputsMustHaveUniqueId:function(){return"All inputs must have a unique Id."},choiceSetMustHaveAtLeastOneChoice:function(){return"An Input.ChoiceSet must have at least one choice defined."},choiceSetChoicesMustHaveTitleAndValue:function(){return"All choices in an Input.ChoiceSet must have their title and value properties set."},propertyMustBeSet:function(e){return'Property "'+e+'" must be set.'},actionHttpHeadersMustHaveNameAndValue:function(){return"All headers of an Action.Http must have their name and value properties set."},tooManyActions:function(e){return"Maximum number of actions exceeded ("+e+")."},columnAlreadyBelongsToAnotherSet:function(){return"This column already belongs to another ColumnSet."},invalidCardType:function(){return`Invalid or missing card type. Make sure the card's type property is set to "AdaptiveCard".`},unsupportedCardVersion:function(e,t){return"The specified card version ("+e+") is not supported. The maximum supported card version is "+t+"."},duplicateId:function(e){return'Duplicate Id "'+e+'".'},markdownProcessingNotEnabled:function(){return"Markdown processing isn't enabled. Please see https://www.npmjs.com/package/adaptivecards#supporting-markdown"},processMarkdownEventRemoved:function(){return"The processMarkdown event has been removed. Please update your code and set onProcessMarkdown instead."},elementAlreadyParented:function(){return"The element already belongs to another container."},actionAlreadyParented:function(){return"The action already belongs to another element."},elementTypeNotStandalone:function(e){return"Elements of type "+e+" cannot be used as standalone elements."}},e.magicCodeInputCard={tryAgain:function(){return"That didn't work... let's try again."},pleaseLogin:function(){return'Please login in the popup. You will obtain a magic code. Paste that code below and select "Submit"'},enterMagicCode:function(){return"Enter magic code"},pleaseEnterMagicCodeYouReceived:function(){return"Please enter the magic code you received."},submit:function(){return"Submit"},cancel:function(){return"Cancel"},somethingWentWrong:function(){return"Something went wrong. This action can't be handled."},authenticationFailed:function(){return"Authentication failed."}},e.runtime={automaticRefreshPaused:function(){return"Automatic refresh paused."},clckToRestartAutomaticRefresh:function(){return"Click to restart."},refreshThisCard:function(){return"Refresh this card"}},e.hints={dontUseWeightedAndStrecthedColumnsInSameSet:function(){return"It is not recommended to use weighted and stretched columns in the same ColumnSet, because in such a situation stretched columns will always get the minimum amount of space."}},e.defaults={inlineActionTitle:function(){return"Inline Action"},overflowButtonText:function(){return"..."},mediaPlayerAriaLabel:function(){return"Media content"},mediaPlayerPlayMedia:function(){return"Play media"}},e}();t.Strings=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});var r=i(324),n=i(325),s=i(97),o=i(470),a=i(471);function c(e){return e.reduce((function(e,i){return"b"!==i.type||"SimpleBlock"!==i.name?e:t.ebmlBlock(i.data).frames.some((function(e){return"9d012a"===e.slice(3,6).toString("hex")}))?e.concat(i):e}),[])}function l(e){var i=d("VP8 ",e);return d("RIFF",m([new t.Buffer("WEBP","ascii"),i]))}function d(e,i){var r=new t.Buffer(4);return r.writeUInt32LE(i.byteLength,0),m([new t.Buffer(e.substr(0,4),"ascii"),r,i,new t.Buffer(i.byteLength%2==0?0:1)])}function u(e,t){for(var i=-1,r=0;r<t.length;r++){var n=t[r];if(n.name===e){if("m"!==n.type)return void t.splice(r,1);if(n.isEnd){if(-1==i)throw new Error("Detected "+e+" closing element before finding the start");return void t.splice(i,r-i+1)}i=r}}}function h(e,t){for(var i=[],r=-1,n=0;n<t.length;n++){var s=t[n];if(s.name===e){if("m"!==s.type){i.push(t[n]);break}if(s.isEnd){if(-1==r)throw new Error("Detected "+e+" closing element before finding the start");i=t.slice(r,n+1);break}r=n}}return i}function f(e){var t=new n.default;return e.reduce((function(e,i){return e.concat(t.encode([i]))}),[]).reduce((function(e,t){return e+t.byteLength}),0)}function p(e,i,r){var n=r.duration,s=r.clusterPtrs,o=r.cues,a=e.slice(0);if("number"==typeof n){var c=false;a.forEach((function(e){"f"===e.type&&"Duration"===e.name&&(c=true,e.data=b(n,8))})),c||g(a,"Info",[{name:"Duration",type:"f",data:b(n,8)}])}Array.isArray(o)&&g(a,"Cues",function(e,t){var i=[];return e.forEach((function(e){var r=e.CueTrack,n=e.CueClusterPosition,s=e.CueTime;i.push({name:"CuePoint",type:"m",isEnd:false}),i.push({name:"CueTime",type:"u",data:v(s)}),i.push({name:"CueTrackPositions",type:"m",isEnd:false}),i.push({name:"CueTrack",type:"u",data:v(r)}),i.push({name:"CueClusterPosition",type:"u",data:v(n+t)}),i.push({name:"CueTrackPositions",type:"m",isEnd:true}),i.push({name:"CuePoint",type:"m",isEnd:true})})),i}(o,i));var l=[];return Array.isArray(s)&&(console.warn("append cluster pointers to seekhead is deprecated. please use cues"),l=function(e,i){var r=[];return e.forEach((function(e){r.push({name:"Seek",type:"m",isEnd:false}),r.push({name:"SeekID",type:"b",data:new t.Buffer([31,67,182,117])}),r.push({name:"SeekPosition",type:"u",data:v(e+i)}),r.push({name:"Seek",type:"m",isEnd:true})})),r}(s,i)),g(a,"SeekHead",l,true),a}function g(e,t,i,r){void 0===r&&(r=false);for(var n=-1,s=0;s<e.length;s++){var o=e[s];if("m"===o.type&&o.name===t&&false===o.isEnd){n=s;break}}n>=0?Array.prototype.splice.apply(e,[n+1,0].concat(i)):r?[].concat([{name:t,type:"m",isEnd:false}],i,[{name:t,type:"m",isEnd:true}]).reverse().forEach((function(t){e.unshift(t)})):(e.push({name:t,type:"m",isEnd:false}),i.forEach((function(t){e.push(t)})),e.push({name:t,type:"m",isEnd:true}))}function m(e){for(var i=0,r=0;i<e.length;++i)r+=e[i].length;var n=t.Buffer.allocUnsafe(r),s=0;for(i=0;i<e.length;++i){var o=e[i];o.copy(n,s),s+=o.length}return n}function v(e){for(var i=1;e>=Math.pow(2,8*i);i++);if(i>=7)return console.warn("7bit or more bigger uint not supported."),new r.Uint64BE(e).toBuffer();var n=new t.Buffer(i);return n.writeUIntBE(e,0,i),n}function S(e){for(var i=1;e>=Math.pow(2,8*i);i++);if(i>=7)return console.warn("7bit or more bigger uint not supported."),new r.Int64BE(e).toBuffer();var n=new t.Buffer(i);return n.writeIntBE(e,0,i),n}function b(e,i){var r;if(void 0===i&&(i=8),8===i)return(r=new t.Buffer(8)).writeDoubleBE(e,0),r;if(4===i)return(r=new t.Buffer(4)).writeFloatBE(e,0),r;throw new Error("float type bits must 4bytes or 8bytes")}t.Buffer=s.Buffer,t.readVint=o.readVint,t.writeVint=o.writeVint,t.ebmlBlock=a,t.readBlock=function(e){return t.ebmlBlock(new t.Buffer(e))},t.encodeTag=function(e,i,r){return void 0===r&&(r=false),m([e,r?new t.Buffer("01ffffffffffffff","hex"):t.writeVint(i.length),i])},t.WebPFrameFilter=function(e){return c(e).reduce((function(e,i){return t.ebmlBlock(i.data).frames.reduce((function(e,t){var i=l(t),r=new Blob([i],{type:"image/webp"});return e.concat(r)}),e)}),[])},t.WebPBlockFilter=c,t.VP8BitStreamToRiffWebPBuffer=l,t.createRIFFChunk=d,t.makeMetadataSeekable=function(e,i,r){var s=h("EBML",e),o=f(s)+12,a=e[e.length-1].dataEnd-o,c=h("Info",e);u("Duration",c),c.splice(1,0,{name:"Duration",type:"f",data:b(i,8)});for(var l=f(c),d=h("Tracks",e),p=f(d),g=47,m=[],S=5+15*r.length,y=[],C=-1,w=function(e){var i=g,n=i+l,s=n+p,c=s+S-a;if((m=[]).push({name:"SeekHead",type:"m",isEnd:false}),m.push({name:"Seek",type:"m",isEnd:false}),m.push({name:"SeekID",type:"b",data:new t.Buffer([21,73,169,102])}),m.push({name:"SeekPosition",type:"u",data:v(i)}),m.push({name:"Seek",type:"m",isEnd:true}),m.push({name:"Seek",type:"m",isEnd:false}),m.push({name:"SeekID",type:"b",data:new t.Buffer([22,84,174,107])}),m.push({name:"SeekPosition",type:"u",data:v(n)}),m.push({name:"Seek",type:"m",isEnd:true}),m.push({name:"Seek",type:"m",isEnd:false}),m.push({name:"SeekID",type:"b",data:new t.Buffer([28,83,187,107])}),m.push({name:"SeekPosition",type:"u",data:v(s)}),m.push({name:"Seek",type:"m",isEnd:true}),m.push({name:"SeekHead",type:"m",isEnd:true}),g=f(m),(y=[]).push({name:"Cues",type:"m",isEnd:false}),r.forEach((function(e){var t=e.CueTrack,i=e.CueClusterPosition,r=e.CueTime;y.push({name:"CuePoint",type:"m",isEnd:false}),y.push({name:"CueTime",type:"u",data:v(r)}),y.push({name:"CueTrackPositions",type:"m",isEnd:false}),y.push({name:"CueTrack",type:"u",data:v(t)}),i-=o,i+=c,y.push({name:"CueClusterPosition",type:"u",data:v(i)}),y.push({name:"CueTrackPositions",type:"m",isEnd:true}),y.push({name:"CuePoint",type:"m",isEnd:true})})),y.push({name:"Cues",type:"m",isEnd:true}),S=f(y),C===c)return"break";if(C=c,9===e)throw new Error("Failed to converge to a stable metadata size")},_=0;_<10;_++){if("break"===w(_))break}var E=[].concat.apply([],[s,{name:"Segment",type:"m",isEnd:false,unknownSize:true},m,c,d,y]);return(new n.default).encode(E)},t.removeElement=u,t.extractElement=h,t.putRefinedMetaData=function(e,i){Array.isArray(i.cueInfos)&&!Array.isArray(i.cues)&&(console.warn("putRefinedMetaData: info.cueInfos property is deprecated. please use info.cues"),i.cues=i.cueInfos);for(var r=[],s=[],o=0;o<e.length;o++){var a=e[o];if("m"===a.type&&"Segment"===a.name){if(r=e.slice(0,o),s=e.slice(o),a.unknownSize){s.shift();break}throw new Error("this metadata is not streaming webm file")}}if(!(s[s.length-1].dataEnd>0))throw new Error("metadata dataEnd has wrong number");var c,l=s[s.length-1].dataEnd,d=r[r.length-1].dataEnd,u=(new n.default).encode(r).byteLength-d,h=l-s[0].tagStart,f=(s[0].tagStart,s[0].tagStart,new t.Buffer([24,83,128,103])),g=new t.Buffer("01ffffffffffffff","hex"),m=f.byteLength+g.byteLength,v=h;for(c=1;c<20;c++){var S=p(s,u+(d+m+v-l),i),b=(new n.default).encode(S).byteLength;if(b===v)return(new n.default).encode([].concat(r,[{type:"m",name:"Segment",isEnd:false,unknownSize:true}],S));v=b}throw new Error("unable to refine metadata, stable size could not be found in "+c+" iterations!")},t.concat=m,t.encodeValueToBuffer=function(e){var i=new t.Buffer(0);if("m"===e.type)return e;switch(e.type){case"u":i=v(e.value);break;case"i":i=S(e.value);break;case"f":i=b(e.value);break;case"s":i=new t.Buffer(e.value,"ascii");break;case"8":i=new t.Buffer(e.value,"utf8");break;case"b":i=e.value;break;case"d":i=new r.Int64BE(e.value.getTime().toString()).toBuffer()}return Object.assign({},e,{data:i})},t.createUIntBuffer=v,t.createIntBuffer=S,t.createFloatBuffer=b,t.convertEBMLDateToJSDate=function(e){return e instanceof Date?e:new Date(new Date("2001-01-01T00:00:00.000Z").getTime()+Number(e)/1e3/1e3)}},function(e,t,i){i.d(t,"a",(function(){return s}));var r=i(0),n=i(2);function s(){return function(e){return e.lift(new o(e))}}var o=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var i=this.connectable;i._refCount++;var r=new a(e,i),n=t.subscribe(r);return r.closed||(r.connection=i.connect()),n},e}(),a=function(e){function t(t,i){var r=e.call(this,t)||this;return r.connectable=i,r}return r.a(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var i=this.connection,r=e._connection;this.connection=null,!r||i&&r!==i||r.unsubscribe()}}else this.connection=null},t}(n.a)},function(e,t,i){i.d(t,"a",(function(){return d}));var r=i(0),n=i(12),s=i(98),o=i(10),a=i(112),c=i(41),l=i(123),d=function(e){function t(t,i,r){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===i&&(i=Number.POSITIVE_INFINITY);var n=e.call(this)||this;return n.scheduler=r,n._events=[],n._infiniteTimeWindow=false,n._bufferSize=t<1?1:t,n._windowTime=i<1?1:i,i===Number.POSITIVE_INFINITY?(n._infiniteTimeWindow=true,n.next=n.nextInfiniteTimeWindow):n.next=n.nextTimeWindow,n}return r.a(t,e),t.prototype.nextInfiniteTimeWindow=function(t){var i=this._events;i.push(t),i.length>this._bufferSize&&i.shift(),e.prototype.next.call(this,t)},t.prototype.nextTimeWindow=function(t){this._events.push(new u(this._getNow(),t)),this._trimBufferThenGetEvents(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t,i=this._infiniteTimeWindow,r=i?this._events:this._trimBufferThenGetEvents(),n=this.scheduler,s=r.length;if(this.closed)throw new c.a;if(this.isStopped||this.hasError?t=o.a.EMPTY:(this.observers.push(e),t=new l.a(this,e)),n&&e.add(e=new a.a(e,n)),i)for(var d=0;d<s&&!e.closed;d++)e.next(r[d]);else for(d=0;d<s&&!e.closed;d++)e.next(r[d].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),t},t.prototype._getNow=function(){return(this.scheduler||s.a).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,i=this._windowTime,r=this._events,n=r.length,s=0;s<n&&!(e-r[s].time<i);)s++;return n>t&&(s=Math.max(s,n-t)),s>0&&r.splice(0,s),r},t}(n.a),u=function(){return function(e,t){this.time=e,this.value=t}}()},function(e,t,i){i.d(t,"a",(function(){return n}));var r=i(5);function n(e,t){return t?new r.a((function(i){return t.schedule(s,0,{error:e,subscriber:i})})):new r.a((function(t){return t.error(e)}))}function s(e){var t=e.error;e.subscriber.error(t)}},function(e,t,i){i.d(t,"b",(function(){return d})),i.d(t,"a",(function(){return u}));var r=i(0),n=i(21),s=i(16),o=i(31),a=i(25),c=i(50),l={};function d(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=void 0,r=void 0;return Object(n.a)(e[e.length-1])&&(r=e.pop()),"function"==typeof e[e.length-1]&&(i=e.pop()),1===e.length&&Object(s.a)(e[0])&&(e=e[0]),Object(c.a)(e,r).lift(new u(i))}var u=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new h(e,this.resultSelector))},e}(),h=function(e){function t(t,i){var r=e.call(this,t)||this;return r.resultSelector=i,r.active=0,r.values=[],r.observables=[],r}return r.a(t,e),t.prototype._next=function(e){this.values.push(l),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var i=0;i<t;i++){var r=e[i];this.add(Object(a.a)(this,r,void 0,i))}}},t.prototype.notifyComplete=function(e){0==(this.active-=1)&&this.destination.complete()},t.prototype.notifyNext=function(e,t,i){var r=this.values,n=r[i],s=this.toRespond?n===l?--this.toRespond:this.toRespond:0;r[i]=t,0===s&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))},t.prototype._tryResultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(dp){return void this.destination.error(dp)}this.destination.next(t)},t}(o.a)},function(e,t,i){i.d(t,"a",(function(){return s}));var r=i(49),n=i(29);function s(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),Object(r.b)(n.a,e)}},function(e,t,i){i.d(t,"a",(function(){return o}));var r=i(5),n=i(23),s=i(22);function o(e){return new r.a((function(t){var i;try{i=e()}catch(dp){return void t.error(dp)}return(i?Object(n.a)(i):Object(s.b)()).subscribe(t)}))}},function(e,t,i){i.d(t,"b",(function(){return l})),i.d(t,"a",(function(){return d}));var r=i(0),n=i(50),s=i(16),o=i(2),a=i(35),c=i(3);function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=e[e.length-1];return"function"==typeof i&&e.pop(),Object(n.a)(e,void 0).lift(new d(i))}var d=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.resultSelector))},e}(),u=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.resultSelector=i,n.iterators=[],n.active=0,n.resultSelector="function"==typeof i?i:void 0,n}return r.a(t,e),t.prototype._next=function(e){var t=this.iterators;Object(s.a)(e)?t.push(new f(e)):"function"==typeof e[a.a]?t.push(new h(e[a.a]())):t.push(new p(this.destination,this,e))},t.prototype._complete=function(){var e=this.iterators,t=e.length;if(this.unsubscribe(),0!==t){this.active=t;for(var i=0;i<t;i++){var r=e[i];if(r.stillUnsubscribed)this.destination.add(r.subscribe());else this.active--}}else this.destination.complete()},t.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},t.prototype.checkIterators=function(){for(var e=this.iterators,t=e.length,i=this.destination,r=0;r<t;r++){if("function"==typeof(o=e[r]).hasValue&&!o.hasValue())return}var n=false,s=[];for(r=0;r<t;r++){var o,a=(o=e[r]).next();if(o.hasCompleted()&&(n=true),a.done)return void i.complete();s.push(a.value)}this.resultSelector?this._tryresultSelector(s):i.next(s),n&&i.complete()},t.prototype._tryresultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(dp){return void this.destination.error(dp)}this.destination.next(t)},t}(o.a),h=function(){function e(e){this.iterator=e,this.nextResult=e.next()}return e.prototype.hasValue=function(){return true},e.prototype.next=function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e},e.prototype.hasCompleted=function(){var e=this.nextResult;return Boolean(e&&e.done)},e}(),f=function(){function e(e){this.array=e,this.index=0,this.length=0,this.length=e.length}return e.prototype[a.a]=function(){return this},e.prototype.next=function(e){var t=this.index++,i=this.array;return t<this.length?{value:i[t],done:false}:{value:null,done:true}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),p=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.parent=i,n.observable=r,n.stillUnsubscribed=true,n.buffer=[],n.isComplete=false,n}return r.a(t,e),t.prototype[a.a]=function(){return this},t.prototype.next=function(){var e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:true}:{value:e.shift(),done:false}},t.prototype.hasValue=function(){return this.buffer.length>0},t.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},t.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=true,this.parent.notifyInactive()):this.destination.complete()},t.prototype.notifyNext=function(e){this.buffer.push(e),this.parent.checkIterators()},t.prototype.subscribe=function(){return Object(c.c)(this.observable,new c.a(this))},t}(c.b)},function(e,t,i){function r(e){return null!==e&&"object"==typeof e}i.d(t,"a",(function(){return r}))},function(e,t,i){i.d(t,"a",(function(){return n}));var r=i(2);function n(e){for(;e;){var t=e,i=t.closed,n=t.destination,s=t.isStopped;if(i||s)return false;e=n&&n instanceof r.a?n:null}return true}},function(e,t,i){i.d(t,"a",(function(){return s}));var r=i(5),n=i(10);function s(e,t){return new r.a((function(i){var r=new n.a,s=0;return r.add(t.schedule((function(){s!==e.length?(i.next(e[s++]),i.closed||r.add(this.schedule())):i.complete()}))),r}))}},function(e,t,i){var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},r.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},r.parseCandidate=function(e){for(var t,i={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":i.relatedAddress=t[r+1];break;case"rport":i.relatedPort=parseInt(t[r+1],10);break;case"tcptype":i.tcpType=t[r+1];break;case"ufrag":i.ufrag=t[r+1],i.usernameFragment=t[r+1];break;default:i[t[r]]=t[r+1]}return i},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),i={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),i.name=t[0],i.clockRate=parseInt(t[1],10),i.channels=3===t.length?parseInt(t[2],10):1,i.numChannels=i.channels,i},r.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var i=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==i?"/"+i:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,i={},r=e.substr(e.indexOf(" ")+1).split(";"),n=0;n<r.length;n++)i[(t=r[n].trim().split("="))[0].trim()]=t[1];return i},r.writeFmtp=function(e){var t="",i=e.payloadType;if(void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+i+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",i=e.payloadType;return void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+i+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),i={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(i.attribute=e.substr(t+1,r-t-1),i.value=e.substr(r+1)):i.attribute=e.substr(t+1),i},r.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var i="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){i+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),i},r.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},r.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?r.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},r.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},r.getCryptoParameters=function(e,t){return r.matchPrefix(e+t,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(e,t){var i=r.matchPrefix(e+t,"a=ice-ufrag:")[0],n=r.matchPrefix(e+t,"a=ice-pwd:")[0];return i&&n?{usernameFragment:i.substr(12),password:n.substr(10)}:null},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=r.splitLines(e)[0].split(" "),n=3;n<i.length;n++){var s=i[n],o=r.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(o){var a=r.parseRtpMap(o),c=r.matchPrefix(e,"a=fmtp:"+s+" ");switch(a.parameters=c.length?r.parseFmtp(c[0]):{},a.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(r.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(r.parseExtmap(e))})),t},r.writeRtpDescription=function(e,t){var i="";i+="m="+e+" ",i+=t.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){i+=r.writeRtpMap(e),i+=r.writeFmtp(e),i+=r.writeRtcpFb(e)}));var n=0;return t.codecs.forEach((function(e){e.maxptime>n&&(n=e.maxptime)})),n>0&&(i+="a=maxptime:"+n+"\r\n"),i+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach((function(e){i+=r.writeExtmap(e)})),i},r.parseRtpEncodingParameters=function(e){var t,i=[],n=r.parseRtpParameters(e),s=-1!==n.fecMechanisms.indexOf("RED"),o=-1!==n.fecMechanisms.indexOf("ULPFEC"),a=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=a.length>0&&a[0].ssrc,l=r.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));l.length>0&&l[0].length>1&&l[0][0]===c&&(t=l[0][1]),n.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(r.rtx={ssrc:t}),i.push(r),s&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},i.push(r))}})),0===i.length&&c&&i.push({ssrc:c});var d=r.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,i.forEach((function(e){e.maxBitrate=d}))),i},r.parseRtcpParameters=function(e){var t={},i=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];i&&(t.cname=i.value,t.ssrc=i.ssrc);var n=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=n.length>0,t.compound=0===n.length;var s=r.matchPrefix(e,"a=rtcp-mux");return t.mux=s.length>0,t},r.parseMsid=function(e){var t,i=r.matchPrefix(e,"a=msid:");if(1===i.length)return{stream:(t=i[0].substr(7).split(" "))[0],track:t[1]};var n=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return n.length>0?{stream:(t=n[0].value.split(" "))[0],track:t[1]}:void 0},r.parseSctpDescription=function(e){var t,i=r.parseMLine(e),n=r.matchPrefix(e,"a=max-message-size:");n.length>0&&(t=parseInt(n[0].substr(19),10)),isNaN(t)&&(t=65536);var s=r.matchPrefix(e,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substr(12),10),protocol:i.fmt,maxMessageSize:t};if(r.matchPrefix(e,"a=sctpmap:").length>0){var o=r.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(o[0],10),protocol:o[1],maxMessageSize:t}}},r.writeSctpDescription=function(e,t){var i=[];return i="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&i.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),i.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t,i){var n=void 0!==t?t:2;return"v=0\r\no="+(i||"thisisadapterortc")+" "+(e||r.generateSessionId())+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,i,n){var s=r.writeRtpDescription(e.kind,t);if(s+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":"active"),s+="a=mid:"+e.mid+"\r\n",e.direction?s+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?s+="a=sendrecv\r\n":e.rtpSender?s+="a=sendonly\r\n":e.rtpReceiver?s+="a=recvonly\r\n":s+="a=inactive\r\n",e.rtpSender){var o="msid:"+n.id+" "+e.rtpSender.track.id+"\r\n";s+="a="+o,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),s},r.getDirection=function(e,t){for(var i=r.splitLines(e),n=0;n<i.length;n++)switch(i[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[n].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},r.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return false;for(var t=r.splitLines(e),i=0;i<t.length;i++)if(t[i].length<2||"="!==t[i].charAt(1))return false;return true},e.exports=r},function(e,t,i){i.d(t,"a",(function(){return s}));var r=i(26),n=i(60),s={closed:true,next:function(e){},error:function(e){if(r.a.useDeprecatedSynchronousErrorHandling)throw e;Object(n.a)(e)},complete:function(){}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});var r=i(361),n=i(365),s=i(366),o=i(367),a=i(133),c=function(){function e(e){this._isScalar=false,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var i=new e;return i.source=this,i.operator=t,i},e.prototype.subscribe=function(e,t,i){var r=this.operator,s=n.toSubscriber(e,t,i);if(r?s.add(r.call(s,this.source)):s.add(this.source||a.config.useDeprecatedSynchronousErrorHandling&&!s.syncErrorThrowable?this._subscribe(s):this._trySubscribe(s)),a.config.useDeprecatedSynchronousErrorHandling&&s.syncErrorThrowable&&(s.syncErrorThrowable=false,s.syncErrorThrown))throw s.syncErrorValue;return s},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(dp){a.config.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=true,e.syncErrorValue=dp),r.canReportError(e)?e.error(dp):console.warn(dp)}},e.prototype.forEach=function(e,t){var i=this;return new(t=l(t))((function(t,r){var n;n=i.subscribe((function(t){try{e(t)}catch(dp){r(dp),n&&n.unsubscribe()}}),r,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[s.observable]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:o.pipeFromArray(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=l(e))((function(e,i){var r;t.subscribe((function(e){return r=e}),(function(e){return i(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function l(e){if(e||(e=a.config.Promise||Promise),!e)throw new Error("no Promise impl found");return e}t.Observable=c},function(e,t,i){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:true});var s=i(155),o=i(156),a=i(77),c=i(134),l=i(133),d=i(157),u=function(e){function t(i,r,n){var s=e.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=false,s.syncErrorThrowable=false,s.isStopped=false,arguments.length){case 0:s.destination=o.empty;break;case 1:if(!i){s.destination=o.empty;break}if("object"==typeof i){i instanceof t?(s.syncErrorThrowable=i.syncErrorThrowable,s.destination=i,i.add(s)):(s.syncErrorThrowable=true,s.destination=new h(s,i));break}default:s.syncErrorThrowable=true,s.destination=new h(s,i,r,n)}return s}return n(t,e),t.prototype[c.rxSubscriber]=function(){return this},t.create=function(e,i,r){var n=new t(e,i,r);return n.syncErrorThrowable=false,n},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=true,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=true,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=true,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=false,this.isStopped=false,this._parentOrParents=e,this},t}(a.Subscription);t.Subscriber=u;var h=function(e){function t(t,i,r,n){var a,c=e.call(this)||this;c._parentSubscriber=t;var l=c;return s.isFunction(i)?a=i:i&&(a=i.next,r=i.error,n=i.complete,i!==o.empty&&(l=Object.create(i),s.isFunction(l.unsubscribe)&&c.add(l.unsubscribe.bind(l)),l.unsubscribe=c.unsubscribe.bind(c))),c._context=l,c._next=a,c._error=r,c._complete=n,c}return n(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;l.config.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,i=l.config.useDeprecatedSynchronousErrorHandling;if(this._error)i&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)i?(t.syncErrorValue=e,t.syncErrorThrown=true):d.hostReportError(e),this.unsubscribe();else{if(this.unsubscribe(),i)throw e;d.hostReportError(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var i=function(){return e._complete.call(e._context)};l.config.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,i),this.unsubscribe()):(this.__tryOrUnsub(i),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(dp){if(this.unsubscribe(),l.config.useDeprecatedSynchronousErrorHandling)throw dp;d.hostReportError(dp)}},t.prototype.__tryOrSetError=function(e,t,i){if(!l.config.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,i)}catch(dp){return l.config.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=dp,e.syncErrorThrown=true,true):(d.hostReportError(dp),true)}return false},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(u);t.SafeSubscriber=h},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(28),n=i(7),s=i(66);t.ConversationCapabilities=class{constructor(){this.telephony=false,this.webRTC=false,this.sharedDesktop=false,this.fileTransfert=false,this.mediaAvailable=false,this.addMedia=false}};class o{constructor(){this.missedIMCounter=0,this.missedIMDetails=[]}static create(){return new o}}t.ConversationMissedInfoCounters=o;t.ConversationBookmark=class{constructor(){this.messageId="",this.timestamp=-1}};class a{constructor(e){this.id=null,this.dbId=null,this.type=null,this.name="",this.filterName="",this.contact=null,this.room=null,this.avatar="",this.infoVisible=true,this.owner=null,this.capabilities=null,this.presenceStatus=null,this.missedCounter=0,this.missedCalls=0,this.messages=[],this.participantStatuses={},this.status=a.Status.INACTIVE,this.historyIndex=-1,this.number=-1,this.historyMessages=[],this.historyDefered=null,this.historyAboveComplete=false,this.historyBelowComplete=false,this.currentHistoryId=null,this.lastModification=void 0,this.creationDate=void 0,this.lastMessageText="",this.lastMessageSender="",this.lastMessageSide="",this.lastMessageContentType="",this.forwardFrom=null,this.forwardedMessage=null,this.replaceLastMsgId="",this.pip=true,this.showVideoGallery=true,this.videoCall=null,this.audioCall=null,this.pstnConferenceSession=null,this.webConferenceSession=null,this.muted=false,this.isMutedAudio=false,this.isMutedVideo=false,this.largeInfoVisible=true,this.selectedTabName="chat",this.isFavorite=false,this.lastEditableMsg=null,this.cacheMessages=[],this.rxSubject=new n.Subject,this.msgLevelDraft="standard",this.innerHtml="",this.mentionedMembersArray=[],this.telephonyContacts=null,this.isFullScreenNoChat=false,this.isWebinarConversation=false,this.webinar=null,this.preload=false,this.lastCallInfo=null,this.chatRenderer=null,this.isForwardedMessageFile=false,this.isGeoLoc=false,this._bookmark=null,this._shouldRemoveBookMark=false,this.ackReadAllSentMessages=function(){this.messages.forEach((e=>{"R"!==e.side||e.receiptStatus!==s.Message.ReceiptStatus.SENT&&e.receiptStatus!==s.Message.ReceiptStatus.UNREAD||(e.setReceiptStatus(s.Message.ReceiptStatus.READ),e.sendUpdateEvent())}))},this.id=e,this.dbId=null,this.type=null,this.owner=null,this.contact=null,this.room=null,this.capabilities=null,this.avatar=null,this.presenceStatus=null,this.filterName="",this.missedCounter=0,this.missedCalls=0,this.messages=[],this.participantStatuses={},this.status=a.Status.INACTIVE,this.historyIndex=-1,this.historyLastIndex=-1,this.historyMessages=[],this.historyDefered=null,this.historyAboveComplete=false,this.historyBelowComplete=false,this.lastModification=void 0,this.creationDate=new Date,this.lastMessageText="",this.lastMessageContentType="",this.isForwardedMessageFile=false,this.lastMessageSender="",this.lastMessageSide="",this.forwardFrom=null,this.forwardedMessage=null,this.replaceLastMsgId="",this.pip=true,this.showVideoGallery=true,this.videoCall={status:r.Call.Status.UNKNOWN},this.audioCall=null,this.pstnConferenceSession=null,this.webConferenceSession=null,this.muted=false,this.isMutedAudio=false,this.isMutedVideo=false,this.infoVisible=false,this.largeInfoVisible=true,this.selectedTabName="chat",this.isFavorite=false,this.lastEditableMsg=null,this.cacheMessages=[],this.rxSubject=new n.Subject,this.msgLevelDraft="standard",this.innerHtml="",this.mentionedMembersArray=[],this.telephonyContacts=null,this.isFullScreenNoChat=false,this.isWebinarConversation=false,this.webinar=null,this.bookmark=null,this.shouldRemoveBookMark=false}static createOneToOneConversation(e){const t=new a(e.id);return t.contact=e,t.name=e.name,t.type=e.isBot?a.Type.BOT:a.Type.ONE_TO_ONE,t.infoVisible=e.isBot,t.avatar=e.avatar&&!e.isBot?e.avatar.src:null,t.filterName=e.displayName?e.displayName.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,""):null,e.conversation=t,t}static createRoomConversation(e){const t=new a(e.jid);return t.type=a.Type.ROOM,t.room=e,t.filterName=e.name.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,""),t.infoVisible=true,t}static getUniqueMessageId(){return"web_"+a.randomBase+a.messageId++}static stringToStatus(e){switch(e){case"composing":return a.Status.COMPOSING;case"paused":return a.Status.PAUSED;default:return a.Status.ACTIVE}}get bookmark(){return this._bookmark}set bookmark(e){this._bookmark=e,this.rxSubject.next({name:"bookmark"})}get shouldRemoveBookMark(){return this._shouldRemoveBookMark}set shouldRemoveBookMark(e){this._shouldRemoveBookMark=e,this.rxSubject.next({name:"bookmark"})}getMessageInCacheById(e){return this.cacheMessages.find((t=>t.id===e))}getMessageById(e,t=false){if(t){const t=this.getMessageInCacheById(e);if(t)return t}return this.messages.find((t=>t.id===e))}getMessageByIdInHistory(e){return this.historyMessages.find((t=>t.id===e))}getReplacedMessageById(e){let t=null;return this.messages.forEach((i=>{t=i.replaceMsgs.find((t=>t.id===e))})),t}reset(){this.messages=[],this.historyIndex=-1,this.historyLastIndex=-1,this.historyMessages=[],this.historyAboveComplete=false,this.historyBelowComplete=false,this.currentHistoryId=null,this.lastMessageText=null,this.lastMessageContentType=null,this.rxSubject.next({name:"appendMessage"})}subscribe(e){return this.rxSubject.subscribe(e)}setMissedCounter(e){this.missedCounter=e,this.rxSubject.next({name:"missedCounter",value:e})}shortnameToUnicode(e){return emojione?emojione.shortnameToUnicode(e):e}isActive(){return this.videoCall&&this.videoCall.status&&"active"===this.videoCall.status.value||this.audioCall&&this.audioCall.status&&"active"===this.audioCall.status.value}isHeld(){return this.videoCall&&this.videoCall.status&&"held"===this.videoCall.status.value||this.audioCall&&this.audioCall.status&&"held"===this.audioCall.status.value}isAudioCallIncomming(){return this.audioCall&&this.audioCall.status&&("queuedIncomming"===this.audioCall.status.value||"incommingCall"===this.audioCall.status.value)}addMessageInHistoryMessages(e){if(e&&(this.historyMessages.push(e),e.side===s.Message.Side.RIGHT&&e.type===s.Message.Type.CHAT))if(this.lastEditableMsg){if(e.date.getTime()>this.lastEditableMsg.date.getTime()){const t=this.lastEditableMsg;this.lastEditableMsg=e,t&&t.sendUpdateEvent()}}else this.lastEditableMsg=e}addMessageInCacheMessages(e){if(!e)return;this.getMessageInCacheById(e.id)||(this.cacheMessages.push(e),this.rxSubject.next({name:"cachedMessage",message:e}))}removeMessage(e){const t=this.messages.lastIndexOf(e);-1!==t&&this.messages.splice(t,1)}ackReceivedAllSentMessages(){this.messages.forEach((e=>{"R"===e.side&&e.receiptStatus===s.Message.ReceiptStatus.SENT&&(e.setReceiptStatus(s.Message.ReceiptStatus.UNREAD),e.sendUpdateEvent())}))}ackReadAllReceivedMessages(){let e=false;return this.messages.forEach((t=>{"R"===t.side||t.receiptStatus!==s.Message.ReceiptStatus.SENT&&t.receiptStatus!==s.Message.ReceiptStatus.UNREAD||(t.setReceiptStatus(s.Message.ReceiptStatus.READ),t.sendUpdateEvent(),e=true)})),e}updateAfterReplaceEvent(e){const t=this.messages[this.messages.length-1];t&&t.id===e.id&&(this.lastModification=new Date,this.lastMessageText=e.getLastTextModified(),this.lastMessageSender=e.from.id,this.replaceLastMsgId=t.id),this.rxSubject.next({name:"replaceMessage",message:e})}}a.randomBase=crypto.randomUUID(),a.messageId=0,a.ChatstatesNS="http://jabber.org/protocol/chatstates",a.ReceiptNS="urn:xmpp:receipts",a.contentNS="urn:xmpp:content",a.AttentionNS="urn:xmpp:attention:0",a.FORWARDNS="urn:xmpp:forward:0",a.Type={ONE_TO_ONE:0,ROOM:1,BOT:2},a.EventType={NEW:0,IM:1,CAPABILITIES:2,FILE:3},a.Status={ACTIVE:{key:0,value:"active"},INACTIVE:{key:1,value:"inactive"},COMPOSING:{key:2,value:"composing"},PAUSED:{key:3,value:"paused"}},t.Conversation=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7),n=i(18),s=i(412),o=i(8),a=i(6),c=i(4),l=i(9),d=i(14),u=i(13),h=i(169),f=i(17),p=i(415),g=i(11),m=i(416),v=i(67),S=i(43),b=i(19),y=i(34),C=i(56);class w{constructor(e=null,t=null,i=null){this.start=e,this.stop=t,this.reconnect=i}}t.SdkApis=w;class _{constructor(){this._sdkApis=Object.keys(new w),this.RAINBOW_ONWEBCONFERENCESTATUSUPDATED="rainbowonwebconferencestatusupdated",this.RAINBOW_ONWEBCONFERENCEPARTICIPANTLISTUPDATED="rainbowonwebconferenceparticipantlistupdated",this.RAINBOW_ONWEBCONFERENCEPARTICIPANTADDED="rainbowonwebconferenceparticipantadded",this.RAINBOW_ONWEBCONFERENCEPUBLISHERSADDED="rainbowonwebconferencepublishersadded",this.RAINBOW_ONWEBCONFERENCEPUBLISHERSREMOVED="rainbowonwebconferencepublishersremoved",this.RAINBOW_ONWEBCONFERENCELOCKSTATEUPDATED="rainbowonwebconferencelockstateupdated",this.RAINBOW_ONWEBCONFERENCELOCALMEDIAUPDATE="rainbowonwebconferencelocalmediaupdate",this.RAINBOW_ONWEBCONFERENCEREMOTEMEDIAUPDATE="rainbowonwebconferenceremotemediaupdate",this.RAINBOW_ONWEBCONFERENCEREPARTICIPANTAUPDATE="rainbowonwebconferenceparticipantupdate",this.RAINBOW_ONWEBCONFERENCERETALKERAUPDATE="rainbowonwebconferencetalkerupdate",this.RAINBOW_ONWEBCONFERENCEDELEGATED="rainbowonwebconferencedelegated",this.RAINBOW_ONWEBCONFERENCESTARTEDEVENT="RAINBOW_ONWEBCONFERENCESTARTEDEVENT",this.RAINBOW_ONWEBCONFERENCESERVICEUPDATE="rainbowonwebconferenceserviceupdate",this.webConferenceSessions={},this.webrtcConfigAndUtils=S.WebrtcConfigAndUtils.getInstance(),this.logger=c.LoggerService.getInstance(),this.authService=o.AuthService.getInstance(),this.errorHelperService=u.ErrorHelperService.getInstance(),this.contactService=a.ContactService.getInstance(),this.xmppService=l.XmppService.getInstance(),this.profileService=d.ProfileService.getInstance(),this.mainService=f.MainService.getInstance(),this.eventService=g.EventService.getInstance(),this.virtualBackgroundService=v.VirtualBackgroundService.getInstance(),this.settingsService=b.SettingsService.getInstance(),this.webrtcP2PService=y.WebrtcP2PService.getInstance(),this.deviceManagementService=C.DeviceManagementService.getInstance(),this.rxSubject=new r.Subject,this.conferenceRef=null,this.makingCall=false,this.addingMedia=false,this.connected=false,this.xmppServiceSubscription=null,this.xmppConnectionSubscription=null,this.subscriptions=[],this.eventServiceSubscriptions=[],this.statsIntervals=[],this.reconnectionsInProgress={},this.audioProfileChanging=false,this.promiseInProgress=[]}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.webConferenceServiceV2||(e.rainbow.webConferenceServiceV2=new _),e.rainbow.webConferenceServiceV2}async start(){!this.contactService.userContact||this.contactService.userContact.roomsEnabled?(this.attachHandlers(),this.webConferenceHelper=new m.WebConferenceHelper(this),this.webConferenceHelper.start(),this.connected=true):this.logger.info("[WebConferenceServiceV2] === start skipped - rooms are disabled for this contact")}async stop(){for(;this.statsIntervals.length;){let e=this.statsIntervals.pop();e&&(clearInterval(e),e=null)}this.eventServiceSubscriptions.forEach((e=>{e()})),this.subscriptions.forEach((e=>{e.unsubscribe()})),this.eventServiceSubscriptions=[],this.subscriptions=[],this.conferenceRef&&(this.xmppService.connection.deleteHandler(this.conferenceRef),this.conferenceRef=null),this.xmppServiceSubscription&&(this.xmppServiceSubscription.unsubscribe(),this.xmppServiceSubscription=null),this.xmppConnectionSubscription&&(this.xmppConnectionSubscription.unsubscribe(),this.xmppConnectionSubscription=null),this.webConferenceHelper&&(this.webConferenceHelper.stop(),this.webConferenceHelper=null)}async reconnect(){}attachXmppHandlers(){this.conferenceRef&&(this.xmppService.connection.deleteHandler(this.conferenceRef),this.conferenceRef=null),this.conferenceRef=this.xmppService.connection.addHandler((e=>(this.onConferenceMessage(e),true)),"jabber:iq:conference:2","message",null),this.xmppServiceSubscription&&(this.xmppServiceSubscription.unsubscribe(),this.xmppServiceSubscription=null),this.xmppServiceSubscription=this.xmppService.connection.jingle.rxSubject.subscribe((e=>{try{this.onJingleMessage(e)}catch(t){this.logger.error("[WebConferenceServiceV2] onJingleMessage error -- "+t)}}))}subscribe(e){return this.rxSubject.subscribe(e)}sendCustomEvent(e,t=null){this.rxSubject.next(n.RBEvent.create(e,t))}sendEvent(e,t=null){this.rxSubject.next(n.RBEvent.create(e,t))}attachVideoSessionToHtmlElement(e,t){if(!e||!t)throw Error("attachVideoSessionToHtmlElement -- missing or wrong paramerets");this.webrtcConfigAndUtils.RTC.attachSessionMediaToElement(e,t)}getConferenceLeaderContact(e){if(!e||!e.room)throw Error("getConferenceLeaderContact -- missing or wrong parameters");const t=e.room.getWebConferenceOwnerId();let i;return t&&(i=this.contactService.getContactById(t)),i}setHelperServiceConfiguration(e=false,t=false){this.webConferenceHelper.setConfiguration(e,t)}attachHandlers(){this.logger.info("[WebConferenceServiceV2] attachHandlers"),this.attachXmppHandlers(),this.xmppConnectionSubscription&&(this.xmppConnectionSubscription.unsubscribe(),this.xmppConnectionSubscription=null),this.xmppConnectionSubscription=this.xmppService.subscribeToConnectionEvents((e=>{try{"ON_XMPP_DISCONNECTED"===e.name?(this.logger.info("[WebConferenceServiceV2] onConnectionStateChangeEvent : disconnected"),this.connected=false):"ON_XMPP_CONNECTED"===e.name&&"RECONNECTION"===e.data.reason&&(this.logger.info("[WebConferenceServiceV2] onConnectionStateChangeEvent : reconnected"),this.attachXmppHandlers(),this.connected=true,this.reconnectActiveConferenceSession())}catch(t){this.logger.error("[WebConferenceServiceV2] onConnectionStateChangeEvent error : "+t)}})),this.eventServiceSubscriptions.push(this.eventService.subscribe("ROOM_CONFERENCE_DELEGATE_EVENT",((e,t,i)=>{this.onConferenceDelegated(t,i)}))),this.eventServiceSubscriptions.push(this.eventService.subscribe("ON_WEBCONFERENCE_STARTED_INVITATION",((e,t)=>{this.sendEvent(this.RAINBOW_ONWEBCONFERENCESTARTEDEVENT,{room:t})}))),this.subscriptions.push(this.virtualBackgroundService.rxSubject.subscribe((e=>{"UPDATE_STREAM"===e.name&&this.onReplaceBackgroundChangeEvent(e)}))),this.subscriptions.push(this.webrtcP2PService.subscribe((e=>{this.onWebrtcP2PService(e)}))),this.subscriptions.push(this.deviceManagementService.subscribe((e=>{try{e.name===this.deviceManagementService.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED&&("audioinput"===e.data.kind?this.onAudioInputDeviceChange():"videoinput"===e.data.kind&&this.onVideoInputDeviceChange())}catch{}})))}getWebConferenceSessionById(e=null){return this.webConferenceSessions[e]}hasActiveWebConferenceSession(){let e=false;return this.webConferenceSessions&&Object.keys(this.webConferenceSessions).forEach((t=>{this.webConferenceSessions[t]&&this.webConferenceSessions[t].haveJoined&&(e=true)})),e}getActiveWebConferenceSession(){let e=null;return this.webConferenceSessions&&Object.keys(this.webConferenceSessions).forEach((t=>{this.webConferenceSessions[t]&&this.webConferenceSessions[t].haveJoined&&(e=this.webConferenceSessions[t])})),e}async stopWebConference(e){try{if(this.logger.debug("[WebConferenceServiceV2] stopWebConference"),!e)throw Error("Wrong or missing parameters");const t=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.dbId}/stop`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"DELETE",headers:i});if(!r.ok)throw r;this.logger.info("[WebConferenceServiceV2] stopWebConference -- successfully"),this.webConferenceSessions[e.dbId]&&this.removeActiveConferenceSession(this.webConferenceSessions[e.dbId])}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"stopWebConference");throw this.logger.error("[WebConferenceServiceV2] -- "+e.message),e.error}}async startOrJoinWebConference(e){if(!e)throw Error("Wrong or missing parameters");return e.isWebConferenceV2Room()?this.joinWebConference(e):this.startWebConference(e)}async startWebConference(e){try{if(!e)throw Error("Wrong or missing parameters");if(!this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.WEBRTC_CONFERENCE_ALLOWED))throw Error("[WebConferenceServiceV2] startWebConference -- User does not have the profile feature WEBRTC_CONFERENCE_ALLOWED");this.logger.debug("[WebConferenceServiceV2] startWebConference -- "+e.dbId);const t={};(this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.WEBRTC_GRID49)||this.settingsService.getBooleanSetting("grid49"))&&(this.logger.info("[WebConferenceServiceV2] startWebConference -- activate grid 49"),t.services=["video-compositor"]);const i=JSON.stringify(t),r=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.dbId}/start`,n=this.authService.getPostHeader(),o=await fetch(r,{method:"POST",headers:n,body:i});if(!o.ok)throw o;if(this.logger.info("[WebConferenceServiceV2] startWebConference -- successfully"),!this.webConferenceSessions[e.dbId]){const t=new s.WebConferenceSession(e.dbId,e);this.webConferenceSessions[e.dbId]=t}return this.webConferenceSessions[e.dbId].isMyConference=true,"connecting"!==this.webConferenceSessions[e.dbId].status&&(this.webConferenceSessions[e.dbId].status="connecting",this.sendEvent(this.RAINBOW_ONWEBCONFERENCESTATUSUPDATED,{roomDbId:e.dbId,status:"connecting"})),this.joinWebConference(e)}catch(t){this.resetBusyStateIfNeeded();const e=await this.errorHelperService.getErrorInfo(t,"startWebConference");this.logger.error("[WebConferenceServiceV2] -- "+e.message);const i={popupTitle:"unableToJoin",popupBody:"joinMeetingFailure",okLabel:"ok"};throw this.mainService.showGlobalPopupMessage(i),e.error}}async joinWebConferenceWithoutAudio(e){try{if(this.makingCall)throw this.logger.warn("[WebConferenceServiceV2] joinWebConferenceWithoutAudio -- already joining a conference"),Error("Joining web conference in progress");if(!e)throw Error("Wrong or missing parameters");if(this.logger.debug("[WebConferenceServiceV2] joinWebConferenceWithoutAudio -- "+e.dbId),this.makingCall=true,this.eventService.publish("ON_WEBCONFERENCE_ENDED_INVITATION",e.dbId),this.contactService.setBusyState("dnd","audio"),!this.webConferenceSessions[e.dbId]){const t=new s.WebConferenceSession(e.dbId,e);this.webConferenceSessions[e.dbId]=t}"connecting"!==this.webConferenceSessions[e.dbId].status&&(this.webConferenceSessions[e.dbId].status="connecting",this.sendEvent(this.RAINBOW_ONWEBCONFERENCESTATUSUPDATED,{roomDbId:e.dbId,status:"connecting"}));const t={mute:false,media:["video"]};this.webrtcConfigAndUtils&&this.webrtcConfigAndUtils.webrtcConfig&&this.webrtcConfigAndUtils.webrtcConfig.dc&&(t.dc=this.webrtcConfigAndUtils.webrtcConfig.dc),this.webConferenceSessions[e.dbId].localStreams=[],this.webConferenceSessions[e.dbId].noAudio=true,this.webConferenceSessions[e.dbId].haveJoined=true;const i=JSON.stringify(t),r=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.dbId}/join`,n=this.authService.getPostHeader(),o=await fetch(r,{method:"POST",headers:n,body:i});if(!o.ok)throw o;const a=(await o.json()).data;this.logger.info("[WebConferenceServiceV2] joinWebConferenceWithoutAudio -- successfully"),this.makingCall=false;const c=a.jingleJid;this.webConferenceSessions[e.dbId].jingleJid=c;const l=e.getWebConferenceOwnerId();return!this.webConferenceSessions[e.dbId].isMyConference&&l&&l===this.contactService.userContact.dbId&&(this.webConferenceSessions[e.dbId].isMyConference=true),this.webConferenceSessions[e.dbId].status="connected",this.webConferenceSessions[e.dbId].startDuration(),this.sendEvent(this.RAINBOW_ONWEBCONFERENCESTATUSUPDATED,{roomDbId:e.dbId,status:"connected"}),this.webConferenceSessions[e.dbId]}catch(t){this.makingCall=false,this.webConferenceSessions[e.dbId].haveJoined=false;const i=await this.errorHelperService.getErrorInfo(t,"joinWebConferenceWithoutAudio");this.logger.error("[WebConferenceServiceV2] -- "+i.message),this.removeActiveConferenceSession(this.webConferenceSessions[e.dbId]),this.resetBusyStateIfNeeded();const r={popupTitle:"unableToJoin",popupBody:"joinMeetingFailure",okLabel:"ok"};throw i&&i.error&&403615===i.error.errorDetailsCode&&(r.popupBody="maximumNumberConferenceParticipantsReach"),i&&i.error&&403060===i.error.errorDetailsCode&&(r.popupBody="lockedConferenceError"),this.mainService.showGlobalPopupMessage(r),delete this.webConferenceSessions[e.dbId],this.sendEvent(this.RAINBOW_ONWEBCONFERENCESTATUSUPDATED,{roomDbId:e.dbId,status:"ended"}),i&&i.error&&403068===i.error.errorDetailsCode&&(e.isWebConferenceV2Room()&&(e.conference.sessions=[],e.confEndpoints=[]),e.rxSubject.next(n.RBEvent.create("ROOM_CONFERENCE_STOP_EVENT"))),i.error}}async joinWebConference(e,t=false){try{if(this.makingCall)throw this.logger.warn("[WebConferenceServiceV2] joinWebConference -- already joining a conference"),Error("Joining web conference in progress");if(!e)throw Error("Wrong or missing parameters");if(t)return await this.joinWebConferenceWithoutAudio(e),this.webConferenceSessions[e.dbId];if(this.logger.debug("[WebConferenceServiceV2] joinWebConference -- "+e.dbId),this.makingCall=true,this.eventService.publish("ON_WEBCONFERENCE_ENDED_INVITATION",e.dbId),this.contactService.setBusyState("dnd","audio"),!this.webConferenceSessions[e.dbId]){const t=new s.WebConferenceSession(e.dbId,e);this.webConferenceSessions[e.dbId]=t}"connecting"!==this.webConferenceSessions[e.dbId].status&&(this.webConferenceSessions[e.dbId].status="connecting",this.sendEvent(this.RAINBOW_ONWEBCONFERENCESTATUSUPDATED,{roomDbId:e.dbId,status:"connecting"}));const i="web_"+h(),r={mute:false};this.webrtcConfigAndUtils&&this.webrtcConfigAndUtils.webrtcConfig&&this.webrtcConfigAndUtils.webrtcConfig.dc&&(r.dc=this.webrtcConfigAndUtils.webrtcConfig.dc);const n=await this.getUserMediaForSession(e.dbId);if(!this.webConferenceSessions[e.dbId]||"ended"===this.webConferenceSessions[e.dbId].status||!this.makingCall)throw"noMic"!==n&&this.disableMediaStream(n),Error("Web conference is no longer active");"noMic"===n?(r.microphone=false,this.webConferenceSessions[e.dbId].localStreams=[]):this.webConferenceSessions[e.dbId].localStreams.push(n),this.webConferenceSessions[e.dbId].haveJoined=true;const o=JSON.stringify(r),a=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.dbId}/join`,c=this.authService.getPostHeader(),l=await fetch(a,{method:"POST",headers:c,body:o});if(!l.ok)throw l;const d=(await l.json()).data;this.logger.info("[WebConferenceServiceV2] joinWebConference -- successfully"),this.makingCall=false;const u=d.jingleJid,f=d.transportTurn;this.webConferenceSessions[e.dbId].jingleJid=u,await this.initJingleCall(u,e.dbId,i,f);const p=e.getWebConferenceOwnerId();return!this.webConferenceSessions[e.dbId].isMyConference&&p&&p===this.contactService.userContact.dbId&&(this.webConferenceSessions[e.dbId].isMyConference=true),this.webConferenceSessions[e.dbId]}catch(i){this.makingCall=false,this.webConferenceSessions[e.dbId].haveJoined=false;const t=await this.errorHelperService.getErrorInfo(i,"joinWebConference");this.logger.error("[WebConferenceServiceV2] -- "+t.message),this.removeActiveConferenceSession(this.webConferenceSessions[e.dbId]),this.resetBusyStateIfNeeded();const r={popupTitle:"unableToJoin",popupBody:"joinMeetingFailure",okLabel:"ok"};throw t&&t.error&&403615===t.error.errorDetailsCode&&(r.popupBody="maximumNumberConferenceParticipantsReach"),t&&t.error&&403060===t.error.errorDetailsCode&&(r.popupBody="lockedConferenceError"),this.mainService.showGlobalPopupMessage(r),delete this.webConferenceSessions[e.dbId],this.sendEvent(this.RAINBOW_ONWEBCONFERENCESTATUSUPDATED,{roomDbId:e.dbId,status:"ended"}),t&&t.error&&403068===t.error.errorDetailsCode&&(e.isWebConferenceV2Room()&&(e.conference.sessions=[],e.confEndpoints=[]),e.rxSubject.next(n.RBEvent.create("ROOM_CONFERENCE_STOP_EVENT"))),t.error}}async joinWebConferenceByPhone(e){try{if(this.makingCall)throw this.logger.warn("[WebConferenceServiceV2] joinWebConferenceByPhone -- already joining a conference"),Error("Joining web conference in progress");if(!e)throw Error("Wrong or missing parameters");this.logger.debug("[WebConferenceServiceV2] joinWebConferenceByPhone -- "+e.dbId),this.eventService.publish("ON_WEBCONFERENCE_ENDED_INVITATION",e.dbId);const t={deskphone:true},i=JSON.stringify(t),r=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.dbId}/join`,n=this.authService.getPostHeader(),s=await fetch(r,{method:"POST",headers:n,body:i});if(!s.ok)throw s;const o=(await s.json()).data;this.logger.info("[WebConferenceServiceV2] joinWebConferenceByPhone -- successfully");const a=String(o.gatewayPrefix)+String(o.gatewaySessionId);this.eventService.publish("TELEPHONY_MAKE_SIMPLE_CALL_TO_NUMBER",a)}catch(t){this.makingCall=false,this.webConferenceSessions[e.dbId].haveJoined=false;const i=await this.errorHelperService.getErrorInfo(t,"joinWebConference");this.logger.error("[WebConferenceServiceV2] -- "+i.message),this.removeActiveConferenceSession(this.webConferenceSessions[e.dbId]),this.resetBusyStateIfNeeded();const r={popupTitle:"unableToJoin",popupBody:"joinMeetingFailure",okLabel:"ok"};throw i&&i.error&&403615===i.error.errorDetailsCode&&(r.popupBody="maximumNumberConferenceParticipantsReach"),i&&i.error&&403060===i.error.errorDetailsCode&&(r.popupBody="lockedConferenceError"),this.mainService.showGlobalPopupMessage(r),delete this.webConferenceSessions[e.dbId],this.sendEvent(this.RAINBOW_ONWEBCONFERENCESTATUSUPDATED,{roomDbId:e.dbId,status:"ended"}),i.error}}async addPSTNParticipantToWebConference(e,t){try{if(!e||!t)throw new Error("[WebConferenceServiceV2] addPSTNParticipantToWebConference -- missing session or parameters");if(!this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.USE_CLOUD_PBX))throw new Error("[WebConferenceServiceV2] addPSTNParticipantToWebConference -- user does not have the right feature to use this function");this.logger.debug("[WebConferenceServiceV2] addPSTNParticipantToWebConference for wb conference: "+e.id+" - phoneNumber: "+t);const i={participantPhoneNumber:t},r=JSON.stringify(i),n=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.id}/add`,s=this.authService.getPostHeader(),o=await fetch(n,{method:"POST",headers:s,body:r});if(!o.ok)throw o;return void this.logger.info("[ConferenceService] addPSTNParticipantToWebConference success")}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"addPSTNParticipantToWebConference");throw this.logger.error("[ConferenceService] "+e.message),e.error}}async declineInvitationToJoinConference(e){try{if(this.logger.debug("[WebConferenceServiceV2] declineInvitationToJoinConference"),!e)throw Error("Wrong or missing parameters");const t=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.dbId}/reject`,i=this.authService.getPostHeader(),r=await fetch(t,{method:"PUT",headers:i});if(!r.ok)throw r;this.logger.info("[WebConferenceServiceV2] declineInvitationToJoinConference -- successfully")}catch(t){this.makingCall=false;const e=await this.errorHelperService.getErrorInfo(t,"declineInvitationToJoinConference");throw this.logger.error("[WebConferenceServiceV2] -- "+e.message),e.error}}async addAudioToWebConferenceSession(e){if(e&&e.localParticipant&&e.haveJoined&&e.noAudio){this.logger.info("[WebConferenceServiceV2] addAudioToWebConferenceSession");const t=["audio"];try{const i=await this.webrtcP2PService.getBrowserMedia(t);if(e.localStreams.push(i),e.audioSession)e.audioSession.addStream(e.localStreams[0]),e.audioSession.sendTransportReplace(),e.localParticipant.noMicrophone&&(e.noAudio=false,this.updateParticipant(e,e.localParticipant.id,"plug"));else{await this.updateParticipant(e,e.localParticipant.id,"addAudio");const t="web_"+h();await this.initJingleCall(e.jingleJid,e.id,t),e.noAudio=false}}catch{this.logger.info("[WebConferenceServiceV2] onAudioInputDeviceChange -- audio device unplugged"),e.audioSession.removeStream(e.localStreams[0]),this.webrtcP2PService.stopActiveAudioVideoStreams(e.audioSession),e.audioSession.sendTransportReplace(),e.localParticipant.noMicrophone||this.updateParticipant(e,e.localParticipant.id,"unplug")}}}async addMediaToWebConferenceSession(e,t,i=null){try{if(!e)throw Error("Wrong or missing parameters");if(this.addingMedia)throw Error("Already adding media");this.addingMedia=true;const r=[t];"sharing"===t&&this.contactService.setBusyState("dnd","sharing"),this.logger.info("[WebConferenceServiceV2] addMediaToWebConferenceSession to session "+e.id+" with media "+t);const n=i||await this.webrtcP2PService.getBrowserMedia(r);let s=n;"video"===t&&(e.originalVideoStream=n,s=await this.virtualBackgroundService.startProcessStream(n)),this.addingMedia=false;const o=[s],a=this.xmppService.connection.jingle.initiate(e.jingleJid,this.xmppService.connection.jid,t,o,null,e.id,null);if("video"===t)e.localParticipant.isVideoAvailable=true,e.localParticipant.videoSession=a;else{const t=new p.WebConferenceParticipant(e.localParticipant.id);t.contact=e.localParticipant.contact,t.isSharingParticipant=true,t.videoSession=a,e.setSharingParticipant(t),e.hasLocalSharing=true,e.localSharingSession=a,e.updatePinnedParticipant(e.getSharingParticipant(),"sharing"),this.sendEvent("startHighlighting")}this.sendEvent(this.RAINBOW_ONWEBCONFERENCELOCALMEDIAUPDATE,{roomDbId:e.id,mediaType:t,action:"added"}),this.webrtcConfigAndUtils.callsStats[a.sid]={},this.updateStatisticsForSession(e,a.sid),this.statsIntervals.push(a.getStats(8e3))}catch(r){this.addingMedia=false}}removeMediaFromWebConferenceSession(e,t){if(!e)throw Error("Wrong or missing parameters");this.logger.info("[WebConferenceServiceV2] removeMediaFromConferenceSession from session "+e.id);const i="video"===t?e.localParticipant.videoSession:e.getLocalSharingSession();if(i){const t=i.sid;this.webrtcConfigAndUtils.disableAllStreamsForSession(i),this.xmppService.connection.jingle.terminate(t),this.updateStatisticsForSession(e,t),delete this.webrtcConfigAndUtils.callsStats[t]}"video"===t?(e.localParticipant.videoSession=null,e.localParticipant.isVideoAvailable=false,e.originalVideoStream&&this.disableMediaStream(e.originalVideoStream),e.originalVideoStream=null,this.virtualBackgroundService.stopProcessStream()):"sharing"===t&&(e.localSharingSession=null,e.hasLocalSharing=false,e.setSharingParticipant(null),this.contactService.setBusyState("dnd","audio"),this.sendEvent("stopHighlighting")),this.sendEvent(this.RAINBOW_ONWEBCONFERENCELOCALMEDIAUPDATE,{roomDbId:e.id,mediaType:t,action:"removed"})}async leaveWebConference(e){try{if(!e)throw Error(" Wrong or missing parameters");if(e&&!e.localParticipant)return void this.removeActiveConferenceSession(this.webConferenceSessions[e.id]);await this.disconnectUserFromWebConference(e,e.localParticipant.id)}catch(t){throw Error("[WebConferenceServiceV2] leaveWebConference error -- "+t)}}async disconnectPstnParticipantFromWebConference(e,t){try{if(this.logger.debug("[WebConferenceServiceV2] disconnectPstnParticipantFromWebConference"),!e||!t)throw Error("Wrong or missing parameters");const i=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.id}/phone-numbers/${t}`,r=this.authService.getRequestHeader(),n=await fetch(i,{method:"DELETE",headers:r});if(!n.ok)throw n;this.logger.info("[WebConferenceServiceV2] disconnectPstnParticipantFromWebConference -- successfully")}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"disconnectPstnParticipantFromWebConference");throw this.logger.error("[WebConferenceServiceV2] -- "+e.message),e.error}}async innerDisconnectUserFromWebConference(e,t){try{let i=e.getParticipantById(t);if(i||(i=e.findParticipantByContactDbId(t)),i&&i.isPstnParticipant)return void(await this.disconnectPstnParticipantFromWebConference(e,i.id));const r=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.id}/users/${t}`,n=this.authService.getRequestHeader(),s=await fetch(r,{method:"DELETE",headers:n});if(!s.ok)throw s;this.logger.info("[WebConferenceServiceV2] disconnectUserFromWebConference -- successfully"),t===this.contactService.userContact.dbId&&this.webConferenceSessions[e.id]&&this.removeActiveConferenceSession(this.webConferenceSessions[e.id])}catch(i){t===this.contactService.userContact.dbId&&this.webConferenceSessions[e.id]&&this.removeActiveConferenceSession(this.webConferenceSessions[e.id]);const r=await this.errorHelperService.getErrorInfo(i,"disconnectUserFromWebConference");throw this.logger.error("[WebConferenceServiceV2] -- "+r.message),r.error}}async disconnectUserFromWebConference(e,t){if(!e||!t)throw Error("[WebConferenceServiceV2] disconnectUserFromWebConference -- Wrong or missing parameters");return this.logger.debug(`[WebConferenceServiceV2] disconnectUserFromWebConference ${e.id} -- ${t}`),this.promiseInProgress[e.id]||(this.promiseInProgress[e.id]=new Promise(((i,r)=>{this.innerDisconnectUserFromWebConference(e,t).then((()=>{i(),delete this.promiseInProgress[e.id]})).catch((t=>{r(t),delete this.promiseInProgress[e.id]}))}))),this.promiseInProgress[e.id]}async subscribeToDynamicFeed(e){try{if(e.dynamicFeedSession)return void this.logger.warn(`[WebConferenceServiceV2] subscribeToDynamicFeed -- ${e.id} -- already subscribed`);if(e.dynamicFeedSubscriptionInProgress)return void this.logger.warn(`[WebConferenceServiceV2] subscribeToDynamicFeed -- ${e.id} -- subscription in progress`);this.logger.info("[WebConferenceServiceV2] subscribeToDynamicFeed -- "+e.id);const t=e.participants.find((e=>e.isVideoAvailable));if(!t)return void this.logger.warn(`[WebConferenceServiceV2] subscribeToDynamicFeed -- ${e.id} -- dynamic feed is not available`);e.dynamicFeedSubscriptionInProgress=true;const i=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.id}/users/${t.id}/subscribe`,r=this.authService.getPostHeader(),n={media:"video",dynamicFeed:true,subStreamLevel:0},s=JSON.stringify(n),o=await fetch(i,{method:"PUT",headers:r,body:s});if(!o.ok)throw o;e.dynamicFeedSubscriptionInProgress=false,this.logger.info(`[WebConferenceServiceV2] subscribeToDynamicFeed -- ${e.id} -- success`)}catch(t){this.logger.error(`[WebConferenceServiceV2] subscribeToDynamicFeed -- ${e.id} -- error`);const i=await this.errorHelperService.getErrorInfo(t,"subscribeToParticipantVideo");throw this.logger.error("[WebConferenceServiceV2] -- "+i.message),e.dynamicFeedSubscriptionInProgress=false,i.error}}async subscribeToService(e,t){try{e.subscribedToGridService=true;const i=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.id}/services/${t}/subscribe`,r=this.authService.getPostHeader(),n=await fetch(i,{method:"PUT",headers:r});if(!n.ok)throw n;const s=(await n.json()).data.sid;this.logger.info(`[WebConferenceServiceV2] subscribeToService -- ${e.id} -- ${t} -- ${s} -- success `),e.gridServiceSubscription={id:t,sessionId:s,videoSession:this.xmppService.connection.jingle.sessions[s]},e.gridServiceSubscription.videoSession&&e.gridServiceSubscription.videoSession.peerconnection&&"connected"===e.gridServiceSubscription.videoSession.peerconnection.iceConnectionState&&(this.logger.info("[WebConferenceServiceV2] video sessionEstablished -- grid/mozaic service -- "+e.id),this.sendEvent(this.RAINBOW_ONWEBCONFERENCEREMOTEMEDIAUPDATE,{roomDbId:e.id,mediaType:"mozaic",action:"added"}))}catch(i){const t=await this.errorHelperService.getErrorInfo(i,"subscribeToService");throw this.logger.error(t.message),e.subscribedToGridService=false,e.gridServiceSubscription=null,t.error}}async subscribeToParticipantVideo(e,t){try{this.logger.info(`[WebConferenceServiceV2] subscribeToParticipantVideo -- ${e.id} -- ${t.id}`),t.subscriptionInProgress=true;const i=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.id}/users/${t.id}/subscribe`,r=this.authService.getPostHeader(),n={media:"video"};t.simulcast&&(n.subStreamLevel="0",t.subStreamLevel=0,t.temporalLevel=2);const s=JSON.stringify(n),o=await fetch(i,{method:"PUT",headers:r,body:s});if(!o.ok)throw o;t.subscriptionInProgress=false,this.logger.info(`[WebConferenceServiceV2] subscribeToParticipantVideo -- ${e.id} -- ${t.id} -- success`)}catch(i){this.logger.error(`[WebConferenceServiceV2] subscribeToParticipantVideo -- ${e.id} -- ${t.id} -- error`);const r=await this.errorHelperService.getErrorInfo(i,"subscribeToParticipantVideo");throw this.logger.error("[WebConferenceServiceV2] -- "+r.message),r.error&&404032===r.error.errorDetailsCode&&(t.isVideoAvailable=false),t.subscriptionInProgress=false,r.error}}async updatePstnParticipant(e,t,i){try{this.logger.info("[WebConferenceServiceV2] updatePstnParticipant( webConfId="+e.id+"participantId="+t+" option="+i+")");const r={option:i},n=JSON.stringify(r),s=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.id}/phone-numbers/${t}`,o=this.authService.getPostHeader(),a=await fetch(s,{method:"PUT",headers:o,body:n});if(!a.ok)throw a;this.logger.info("[WebConferenceServiceV2] updatePstnParticipant -- successfully ( webConfId="+e.id+"participantId="+t+" option="+i+")")}catch(r){const e=await this.errorHelperService.getErrorInfo(r,"updatePstnParticipant");throw this.logger.error("[WebConferenceServiceV2] -- "+e.message),e.error}}async updateParticipant(e,t,i,r=null,n=null,s=null,o=null){try{if(this.logger.info("[WebConferenceServiceV2] updateParticipant( webConfId="+e.id+"participantId="+t+" option="+i+" subStreamLevel "+s+" publisherId "+o+")"),!e||!t||!i)throw new Error("[WebConferenceServiceV2] updateParticipant - missing a parameter");let a=e.getParticipantById(t);if(a||(a=e.findParticipantByContactDbId(t)),a&&a.isPstnParticipant)return void(await this.updatePstnParticipant(e,a.id,i));const c={option:i};r&&(c.media=r),n&&(c.bitRate=n),o&&(c.publisherId=o),s&&(c.subStreamLevel=s);const l=JSON.stringify(c),d=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.id}/users/${a.id}`,u=this.authService.getPostHeader(),h=await fetch(d,{method:"PUT",headers:u,body:l});if(!h.ok)throw h;this.logger.info("[WebConferenceServiceV2] updateParticipant -- successfully ( webConfId="+e.id+"participantId="+a.id+" option="+i+" subStreamLevel "+s+" publisherId "+o+")")}catch(a){const e=await this.errorHelperService.getErrorInfo(a,"updateParticipant");throw this.logger.error("[WebConferenceServiceV2] -- "+e.message),e.error}}async updateConferenceParameters(e,t){try{if(!e||!t)throw new Error("[WebConferenceServiceV2] updateConferenceParameters - missing a parameter");this.logger.info("[WebConferenceServiceV2] updateConferenceParameters( webConfId= "+e.id+", option= "+t+")");const i={option:t},r=JSON.stringify(i),n=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.id}/update`,s=this.authService.getPostHeader(),o=await fetch(n,{method:"PUT",headers:s,body:r});if(!o.ok)throw o;this.logger.info("[WebConferenceServiceV2] updateConferenceParameters( webConfId= "+e.id+", option= "+t+") -- successfully")}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"updateConferenceParameters");throw this.logger.error("[WebConferenceServiceV2] -- "+e.message),e.error}}async delegateConferenceToParticipant(e,t){try{if(this.logger.info("[WebConferenceServiceV2] delegateConferenceToParticipant for webConfId="+e.id+"participantId="+t),!e||!t)throw new Error("[WebConferenceServiceV2] delegateConferenceToParticipant - missing a parameter");const i=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.id}/users/${t}/delegate`,r=this.authService.getPostHeader(),n=await fetch(i,{method:"PUT",headers:r});if(!n.ok)throw n;this.logger.info("[WebConferenceServiceV2] delegateConferenceToParticipant -- successfully -- webConfId="+e.id+"participantId="+t)}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"delegateConferenceToParticipant");throw this.logger.error("[WebConferenceServiceV2] -- "+e.message),e.error}}async getConferenceTalkingTimeStats(e){try{const t=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e}/talking-time`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;const n=await r.json();return this.logger.info("[WebConferenceServiceV2] startMediaEchoTest success -- "+n.data.participants.length),n.data.participants}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getConferenceTalkingTimeStats");throw this.logger.error("[WebConferenceServiceV2] "+e.message),e.error}}async startMediaEchoTest(){this.logger.info("[WebConferenceServiceV2] startMediaEchoTest");try{const e=config.restServerUrl+"/api/rainbow/conference/v1.0/echotest",t=this.authService.getPostHeader(),i=await fetch(e,{method:"PUT",headers:t});if(!i.ok)throw i;this.logger.info("[WebConferenceServiceV2] startMediaEchoTest success");const r=(await i.json()).data;if(r.jingleJid)return r.jingleJid;throw new Error("Something went wrong")}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"startMediaEchoTest");throw this.logger.error("[WebConferenceServiceV2] -- "+t.message),t.error}}async stopMediaEchoTest(){this.logger.info("[WebConferenceServiceV2] stopMediaEchoTest");try{const e=config.restServerUrl+"/api/rainbow/conference/v1.0/stop-echotest",t=this.authService.getPostHeader(),i=await fetch(e,{method:"PUT",headers:t});if(!i.ok)throw i;this.logger.info("[WebConferenceServiceV2] stopMediaEchoTest success")}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"stopMediaEchoTest");throw this.logger.error("[WebConferenceServiceV2] -- "+t.message),t.error}}async transferP2pCallToConference(e,t,i,r=false,n=false){try{if(this.logger.info("[WebConferenceServiceV2] transferP2pCallToConference to "+i.dbId),this.webConferenceSessions[i.dbId]&&this.webConferenceSessions[i.dbId].haveJoined)throw this.logger.info("[WebConferenceServiceV2] transferP2pCallToConference to "+i.dbId+" -- already in progress or done"),new Error("Already making transfer call");if(this.makingCall=true,this.eventService.publish("ON_WEBCONFERENCE_ENDED_INVITATION",i.dbId),this.contactService.setBusyState("dnd","audio"),!this.webConferenceSessions[i.dbId]){const e=new s.WebConferenceSession(i.dbId,i);this.webConferenceSessions[i.dbId]=e}"connecting"!==this.webConferenceSessions[i.dbId].status&&(this.webConferenceSessions[i.dbId].status="connecting",this.sendEvent(this.RAINBOW_ONWEBCONFERENCESTATUSUPDATED,{roomDbId:i.dbId,status:"connecting"}));const o=await this.makeSnapshotByRoomDbId(i.dbId);await this.updateWebConferenceFromSnapshotData(i.dbId,o);const a=await this.getUserMediaForSession(i.dbId);this.webConferenceSessions[i.dbId].localStreams.push(a),this.webConferenceSessions[i.dbId].jingleJid=t;const c="web_"+h();await this.initJingleCall(t,i.dbId,c,false),this.webConferenceSessions[i.dbId].haveJoined=true,this.webConferenceSessions[i.dbId].isMyConference=r,this.makingCall=false;try{if(e&&-1!==e.localType.indexOf("sharing")&&(-1===e.remoteType.indexOf("sharing")||r)){let t=e.localStreams.length-1;e.localStreams[e.localStreams.length-1].getAudioTracks().length&&(t=0);const r=e.localStreams[t].clone();setTimeout((()=>{this.addMediaToWebConferenceSession(this.webConferenceSessions[i.dbId],"sharing",r)}),1500)}e&&-1!==e.localType.indexOf("video")&&setTimeout((()=>{this.addMediaToWebConferenceSession(this.webConferenceSessions[i.dbId],"video")}),1500),n&&setTimeout((()=>{this.updateParticipant(this.webConferenceSessions[i.dbId],this.webConferenceSessions[i.dbId].localParticipant.id,"mute")}),1e3)}catch(dp){return void this.logger.error("[WebConferenceServiceV2] transferP2pCallToConference error on duplicate stream -- "+dp)}}catch(o){this.makingCall=false,this.logger.error("[WebConferenceServiceV2] transferP2pCallToConference error -- "+o)}}putAllRemoteVideoSessionsOnHold(e){if(this.logger.info("[WebConferenceServiceV2] putAllRemoteVideoSessionsOnHold for webConfId="+e.id),!e)throw new Error("[WebConferenceServiceV2] putAllRemoteVideoSessionsOnHold - missing a parameter");e.participants.forEach((e=>{!e.videoSession||e.isSharingParticipant||e.videoSession.onHold||e.videoSession.sendHold(true)})),e.dynamicFeedSession&&!e.dynamicFeedSession.onHold&&e.dynamicFeedSession.sendHold(true),e.gridServiceSubscription&&e.gridServiceSubscription.videoSession&&!e.gridServiceSubscription.videoSession.onHold&&e.gridServiceSubscription.videoSession.sendHold(true),this.logger.info("[WebConferenceServiceV2] putAllRemoteVideoSessionsOnHold -- successfully -- webConfId="+e.id)}putRemoteVideoSessionOnHold(e){e&&(this.logger.info("[WebConferenceServiceV2] putRemoteVideoSessionOnHold for webConfId="+e.id),e&&e.videoSession&&!e.isSharingParticipant&&!e.videoSession.onHold&&e.videoSession.sendHold(true))}putRemoteVideoSessionOnUnhold(e){e&&(this.logger.info("[WebConferenceServiceV2] putRemoteVideoSessionOnUnhold for webConfId="+e.id),e&&e.videoSession&&!e.isSharingParticipant&&e.videoSession.onHold&&e.videoSession.sendHold(false))}async onVideoInputDeviceChange(){const e=this.getActiveWebConferenceSession();e&&e.localParticipant&&e.localParticipant.videoSession&&e.haveJoined&&(this.logger.info("[WebConferenceServiceV2] onVideoInputDeviceChange"),setTimeout((async()=>{const t=["video"];try{e.originalVideoStream&&(e.originalVideoStream.getTracks().forEach((e=>{e.enabled=false,e.stop(),e=null})),e.originalVideoStream.stop&&e.originalVideoStream.stop(),e.originalVideoStream=null),this.webrtcConfigAndUtils.disableMediaStreams(e.localParticipant.videoSession.localStreams);const i=await this.webrtcP2PService.getBrowserMedia(t);e.originalVideoStream=i;const r=await this.virtualBackgroundService.startProcessStream(i);try{await e.localParticipant.videoSession.replaceTransceiverTrack(r.getVideoTracks()[0]),e.localParticipant.videoSession.localStreams=[],e.localParticipant.videoSession.localStreams.push(r),this.logger.info("[WebConferenceServiceV2] onVideoInputDeviceChange -- success 'on the fly'"),this.sendEvent("peerConnectionEstablished",{sessionId:e.localParticipant.videoSession.sid}),this.sendEvent(this.RAINBOW_ONWEBCONFERENCELOCALMEDIAUPDATE,{roomDbId:e.id,mediaType:"video",action:"added"})}catch{e.localParticipant.videoSession.removeStream(),e.localParticipant.videoSession.localStreams=[],e.localParticipant.videoSession.localStreams.push(r),e.audioSession.addStream(e.localParticipant.videoSession.localStreams[0]),e.audioSession.sendTransportReplace(),this.logger.info("[WebConferenceServiceV2] onVideoInputDeviceChange -- success 'via transport-replace'"),this.sendEvent("peerConnectionEstablished",{sessionId:e.localParticipant.videoSession.sid}),this.sendEvent(this.RAINBOW_ONWEBCONFERENCELOCALMEDIAUPDATE,{roomDbId:e.id,mediaType:"video",action:"added"})}}catch{this.logger.info("[WebConferenceServiceV2] onVideoInputDeviceChange -- video device unplugged or not working -- remove media from conference and re-add it again"),this.removeMediaFromWebConferenceSession(e,"video"),this.addMediaToWebConferenceSession(e,"video")}}),500))}async onAudioInputDeviceChange(){const e=this.getActiveWebConferenceSession();e&&e.localParticipant&&e.haveJoined&&!e.noAudio&&!this.audioProfileChanging&&(this.logger.info("[WebConferenceServiceV2] onAudioInputDeviceChange"),this.audioProfileChanging=true,setTimeout((async()=>{this.audioProfileChanging=false;const t=["audio"];try{this.webrtcConfigAndUtils.disableMediaStreams(e.localStreams),e.localStreams=[];const i=await this.webrtcP2PService.getBrowserMedia(t);try{await e.audioSession.replaceTransceiverTrack(i.getAudioTracks()[0]),e.localStreams.push(i),e.localParticipant.noMicrophone&&this.updateParticipant(e,e.localParticipant.id,"plug"),this.logger.info("[WebConferenceServiceV2] onAudioInputDeviceChange -- success 'on the fly'")}catch{e.audioSession.removeStream(e.localStreams[0]),this.webrtcP2PService.stopActiveAudioVideoStreams(e.audioSession),e.localStreams=[],e.localStreams.push(i),e.audioSession.addStream(e.localStreams[0]),e.audioSession.sendTransportReplace(),e.localParticipant.noMicrophone&&this.updateParticipant(e,e.localParticipant.id,"plug"),this.logger.info("[WebConferenceServiceV2] onAudioInputDeviceChange -- success 'via transport-replace'")}}catch{this.logger.info("[WebConferenceServiceV2] onAudioInputDeviceChange -- audio device unplugged"),e.audioSession.removeStream(e.localStreams[0]),this.webrtcP2PService.stopActiveAudioVideoStreams(e.audioSession),e.audioSession.sendTransportReplace(),e.localParticipant.noMicrophone||this.updateParticipant(e,e.localParticipant.id,"unplug")}}),500))}async onReplaceBackgroundChangeEvent(e){const t=this.getActiveWebConferenceSession();if(t&&t.localParticipant&&t.localParticipant.videoSession){this.logger.info("[WebConferenceServiceV2] onReplaceBackgroundChangeEvent");const i=t.localParticipant.videoSession;let r=i.localStreams.pop();e.data.type===v.VIRTUAL_BACKGROUND_TYPE.NONE&&(r.getTracks().forEach((e=>{e.enabled=false,e.stop(),e=null})),r.stop&&r.stop(),r=null);const n=e.data.stream;i.localStreams.push(n);try{await i.replaceTransceiverTrack(n.getVideoTracks()[0]),this.sendEvent("peerConnectionEstablished",{sessionId:i.sid}),this.sendEvent(this.RAINBOW_ONWEBCONFERENCELOCALMEDIAUPDATE,{roomDbId:t.id,mediaType:"video",action:"added"})}catch{i.addStream(n),i.sendTransportReplace(),this.sendEvent(this.RAINBOW_ONWEBCONFERENCELOCALMEDIAUPDATE,{roomDbId:t.id,mediaType:"video",action:"added"})}}}askToAddSharingToWebConferenceSession(e,t){!this.webrtcP2PService.askToAddSharing(e.id)&&this.addMediaToWebConferenceSession(t,"sharing")}async getUserMediaForSession(e){if(!this.webConferenceSessions[e])throw Error("Web conference is no longer active");try{return await this.webrtcP2PService.getBrowserMedia(["audio"])}catch(t){return this.logger.error("[WebConferenceServiceV2] getUserMediaForSession error -- getUserMedia failed -- "+t),this.sendEvent("joinWithoutAudio"),"noMic"}}disableMediaStream(e){e.getTracks().forEach((e=>{e.enabled=false,e.stop(),e=null})),e=null}async initJingleCall(e,t,i,r=false){try{await this.webrtcConfigAndUtils.setWebrtcConfiguration()}catch{this.logger.error("[WebConferenceServiceV2] initCall - setWebrtcConfiguration failed")}const n=this.xmppService.connection.jingle.initiate(e,this.xmppService.connection.jid,"audio",this.webConferenceSessions[t].localStreams,i,t,null,r);this.webConferenceSessions[t].audioSession=n,this.createStatisticsForSession(t,n.sid),this.statsIntervals.push(n.getStats(3e3))}async createStatisticsForSession(e,t){if(this.logger.info("[WebConferenceServiceV2] createStatisticsForSession for conf "+e+" and session "+t),e&&t)try{this.webrtcConfigAndUtils.callsStats[t]={};[].push({connectionId:t,stats:this.webrtcConfigAndUtils.callsStats[t]});const i=await this.webrtcConfigAndUtils.createStatisticsForSession(e,e,"pending");this.logger.info("[WebConferenceServiceV2] createStatisticsForSession success "+i),this.webrtcConfigAndUtils.callsStats[t].id=i,this.webConferenceSessions[e].metricsId=i,this.webConferenceSessions[e].metricsState="pending"}catch(i){this.logger.error("[WebConferenceServiceV2] createStatisticsForSession error for conf "+e)}else this.logger.warn("[WebConferenceServiceV2] createStatisticsForSession -- missing parameters")}updateStatisticsForSession(e,t){if(!e||!t)return void this.logger.warn("[WebConferenceServiceV2] updateStatisticsForSession -- missing parameters");if(!e||!e.metricsId)return void this.logger.warn("[WebConferenceServiceV2] updateStatisticsForSession -- missing webConference or no metricsId");e.metricsState||(e.metricsState="pending");const i=[];this.webrtcConfigAndUtils.callsStats[t]&&Object.keys(this.webrtcConfigAndUtils.callsStats[t]).length&&(this.webrtcConfigAndUtils.callsStats[t].RainMetrics&&this.webrtcConfigAndUtils.callsStats[t].push(this.webrtcConfigAndUtils.callsStats[t].RainMetrics),i.push({connectionId:t,stats:this.webrtcConfigAndUtils.callsStats[t]}),this.webrtcConfigAndUtils.updateStatisticsForCall(e.metricsId,e.id,e.metricsState,i))}onConferenceDelegated(e,t){const i=this.getWebConferenceSessionById(e);if(!i||!t)return void this.logger.warn("[WebConferenceServiceV2] onConferenceDelegated -- missing parameters or no existing conference");let r=false;t!==this.contactService.userContact.dbId||i.isMyConference?t!==this.contactService.userContact.dbId&&i.isMyConference&&(i.isMyConference=false,r=true):i.isMyConference=true,this.sendEvent(this.RAINBOW_ONWEBCONFERENCEDELEGATED,{roomDbId:i.id,userDbId:t,gaveOwnership:r})}async makeSnapshotByRoomDbId(e){try{if(!e)throw new Error("[WebConferenceServiceV2] makeSnapshotByRoomDbId - missing a parameter");this.logger.info("[WebConferenceServiceV2] makeSnapshotByRoomDbId for roomDbId "+e);const t=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e}/snapshot`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;const n=(await r.json()).data;return this.logger.info("[WebConferenceServiceV2] makeSnapshotByRoomDbId -- successfully -- roomDbId "+e),n}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"makeSnapshotByRoomDbId");throw this.logger.error("[WebConferenceServiceV2] -- "+e.message),e.error}}async createSessionParticipantFromSnapshotData(e){let t=e.userId;const i=e.phoneNumber,r=e.associatedUserId,n=e.associatedGroupName;let s;if(!t&&r?(s=await this.contactService.getContactByDBId(r),t=i):t?s=await this.contactService.getContactByDBId(t):(s=this.contactService.createBasicContact(null,i),t=i,n&&(s.displayName=n)),s){const r=p.WebConferenceParticipant.create(t);return r.contact=s,r.mute=false,r.delegateCapability="moderator"===e.participantRole,r.role=e.participantRole,r.noMicrophone=false,i&&(r.isPstnParticipant=true),r}return null}async updateWebConferenceFromSnapshotData(e,t){if(!e||!this.webConferenceSessions[e]||!t)throw new Error("[WebConferenceServiceV2] updateWebConferenceFromSnapshotData - missing a parameter or conf session");if(t.active){const i=[];t.participants.forEach((e=>{i.push(this.createSessionParticipantFromSnapshotData(e))}));(await Promise.all(i)).forEach((t=>{t&&(this.contactService.isUserContact(t.contact)&&!this.webConferenceSessions[e].localParticipant?this.webConferenceSessions[e].localParticipant=t:this.webConferenceSessions[e].addOrUpdateParticipant(t),this.logger.info(`[WebConferenceServiceV2] updateWebConferenceFromSnapshotData participant added -- ${t.id} -- ${e}`))}))}}disableAllLocalStreamsForSession(e){this.webrtcConfigAndUtils.disableMediaStreams(e.localStreams),e.originalVideoStream&&this.webrtcConfigAndUtils.disableMediaStream(e.originalVideoStream),e.audioSession&&(this.updateStatisticsForSession(e,e.audioSession.sid),this.webrtcConfigAndUtils.disableAllStreamsForSession(e.audioSession),this.xmppService.connection.jingle.terminate(e.audioSession.sid),delete this.webrtcConfigAndUtils.callsStats[e.audioSession.sid]),e.localParticipant&&e.localParticipant.videoSession&&(this.updateStatisticsForSession(e,e.localParticipant.videoSession.sid),e.localParticipant.videoSession.terminate(),this.webrtcConfigAndUtils.disableAllStreamsForSession(e.localParticipant.videoSession),delete this.webrtcConfigAndUtils.callsStats[e.localParticipant.videoSession.sid]),e.localSharingSession&&(this.updateStatisticsForSession(e,e.localSharingSession.sid),e.localSharingSession.terminate(),this.webrtcConfigAndUtils.disableAllStreamsForSession(e.localSharingSession),delete this.webrtcConfigAndUtils.callsStats[e.localSharingSession.sid]),e.gridServiceSubscription&&e.gridServiceSubscription.videoSession&&(this.updateStatisticsForSession(e,e.gridServiceSubscription.videoSession.sid),e.gridServiceSubscription.videoSession.terminate(),this.webrtcConfigAndUtils.disableAllStreamsForSession(e.gridServiceSubscription.videoSession),e.gridServiceSubscription.videoSession=null,delete this.webrtcConfigAndUtils.callsStats[e.gridServiceSubscription.videoSession.sid])}removeActiveConferenceSession(e){if(e){let t;for(e.status="ended",e.metricsState="ended",e.haveJoined=false,this.disableAllLocalStreamsForSession(e),e.audioSession=null,e.localParticipant=null,this.sendEvent(this.RAINBOW_ONWEBCONFERENCESTATUSUPDATED,{roomDbId:e.id,status:"ended"}),delete this.webConferenceSessions[e.id],e=null,this.resetBusyStateIfNeeded();this.statsIntervals.length;)t=this.statsIntervals.pop(),t&&(window.clearInterval(t),t=null);this.sendEvent("stopHighlighting"),this.contactService.userContact.guestMode&&this.eventService.publish("ON_OPEN_POPUP","concludeInvitation")}}resetBusyStateIfNeeded(){this.eventService.publish("CHECK_AND_RESET_BUSY_STATE")}async createSessionParticipantFromElem(e,t){try{let i=e.find("user-id").text();const r=e.find("role").text(),n=e.find("phone-number").text(),s=e.find("associated-user-id").text(),o=e.find("associated-group-name").text();let a;!i&&s?(a=await this.contactService.getContactByDBId(s),i=n):i?a=await this.contactService.getContactByDBId(i):(a=this.contactService.createBasicContact(null,n),i=n,o&&(a.displayName=o));let c=e.find("microphone").text();c&&"true"!==c?"false"===c&&(c=false):c=true;const l=$(e).find("talking-time").text(),d="true"===$(e).find("talking").text();if(a){const s=p.WebConferenceParticipant.create(i);s.contact=a,s.mute="true"===e.find("mute").text(),s.delegateCapability="true"===e.find("delegate-capability").text(),s.role=r,s.noMicrophone=!c,n&&(s.isPstnParticipant=true);const o=l?parseInt(l,10):0;return t.updateTalkingTimeForParticipant(i,o),d&&(t.talker=i),s}return null}catch(i){return this.logger.error("[WebinarConferenceService] createSessionParticipantFromParticipantElem -- Failure"),null}}async onConferenceMessage(e){try{const t=$(e),i=t.find("room-id").text(),r=this.webConferenceSessions[i];if(!r){this.logger.debug(`[WebConferenceServiceV2] onConferenceMessage -- roomId ${i} -- no web conference session`);const e=t.find("conference-info");if(e.length){if("reject"===e.attr("action"))return this.logger.debug(`[WebConferenceServiceV2] onConferenceMessage -- roomId ${i} -- action reject received`),this.eventService.publish("ON_WEBCONFERENCE_ENDED_INVITATION",i),true;const r=t.find("participants").find("participant");r.length&&r.each(((e,t)=>{const r=$(t).find("user-id").text();r&&this.contactService.userContact.dbId===r&&(this.logger.debug(`[WebConferenceServiceV2] onConferenceMessage -- roomId ${i} -- user has joined from another device`),this.eventService.publish("ON_WEBCONFERENCE_ENDED_INVITATION",i))}))}return true}const s=t.find("conference-info");if(s.length){const e=t.find("conference-state");if(e.length){if(!("true"===$(e).find("active").text())){this.logger.info(`[WebConferenceServiceV2] onConferenceMessage -- ${r.id} -- has ended`);const e=r.room;return this.removeActiveConferenceSession(r),e&&e.isWebConferenceV2Room()&&(e.conference.sessions=[],e.confEndpoints=[],e.rxSubject.next(n.RBEvent.create("ROOM_CONFERENCE_STOP_EVENT"))),true}const t="true"===e.find("lock").text();let i=e.find("locked-by").text();i||(i=e.find("unlocked-by").text()),r.isLocked()!==t&&(r.setLocked(t),i&&this.sendEvent(this.RAINBOW_ONWEBCONFERENCELOCKSTATEUPDATED,{roomDbId:r.id,isLock:t,lockedBy:i}));const o=s.find("recording-user-id");o.length&&(r.recordingUserId=o.text());const a=s.find("recording-state");if(a.length){const e=a.text();"on"!==e&&"pause"!==e||(r.recordingStarted=true,r.currentRecordingState=e,this.eventService.publish("on"===e?"ON_CONFERENCE_RECORDING_STARTED":"ON_CONFERENCE_RECORDING_PAUSED",r))}}const i=s.find("recording-user-id");i.length&&(r.recordingUserId=i.text());const o=s.find("record");if(o.length){const e=o.text();"on"===e||"pause"===e?(r.recordingStarted=true,r.currentRecordingState=e,this.eventService.publish("on"===e?"ON_CONFERENCE_RECORDING_STARTED":"ON_CONFERENCE_RECORDING_PAUSED",r)):"off"===e?(r.recordingStarted=false,r.currentRecordingState="",this.eventService.publish("ON_CONFERENCE_RECORDING_STOPPED",r)):"recordingEnding"===e&&r.record&&r.record.isRecording&&(this.logger.info(`[WebConferenceServiceV2] onConferenceMessage ${e} -- Warning -- ${r.id}`),this.eventService.publish("ON_CONFERENCE_RECORDING_WILL_STOP"))}}let o="newParticipant",a=t.find("participants").find("participant");if(0===a.length&&(a=t.find("added-participants").find("participant"),o="addParticipant"),0===a.length&&(a=t.find("updated-participants").find("participant"),o="updateParticipant"),a.length){const e=[];a.each(((t,i)=>{e.push(this.createSessionParticipantFromElem($(i),r))}));(await Promise.all(e)).forEach((e=>{if(e){this.contactService.isUserContact(e.contact)&&!r.localParticipant?r.localParticipant=e:r.addOrUpdateParticipant(e);const t=e.id===r.localParticipant.id?"local":e.id;this.logger.info(`[WebConferenceServiceV2] onConferenceMessage ${o} -- ${t} -- ${r.id}`),"addParticipant"===o&&this.sendEvent(this.RAINBOW_ONWEBCONFERENCEPARTICIPANTADDED,{roomDbId:r.id,participantId:e.id})}})),"newParticipant"===o||"addParticipant"===o?this.sendEvent(this.RAINBOW_ONWEBCONFERENCEPARTICIPANTLISTUPDATED,{roomDbId:r.id}):"updateParticipant"===o&&this.sendEvent(this.RAINBOW_ONWEBCONFERENCEREPARTICIPANTAUPDATE,{roomDbId:r.id})}const c=t.find("removed-participants");if(c.length){let e=false;$(c).find("user-id").each(((t,i)=>{const n=$(i).text(),s=r.participants.findIndex((e=>e.id===n));-1!==s&&r.participants.splice(s,1),r.localParticipant&&n===r.localParticipant.id&&(e=true),this.logger.info(`[WebConferenceServiceV2] onConferenceMessage removedParticipant -- ${n} -- ${r.id}`)}));$(c).find("phone-number").each(((e,t)=>{const i=$(t).text(),n=r.participants.findIndex((e=>e.id===i));-1!==n&&r.participants.splice(n,1),this.logger.info(`[WebConferenceServiceV2] onConferenceMessage removedParticipant PSTN -- ${i} -- ${r.id}`)})),e?this.removeActiveConferenceSession(r):this.sendEvent(this.RAINBOW_ONWEBCONFERENCEPARTICIPANTLISTUPDATED,{roomDbId:r.id})}let l="publishers",d=t.find("publishers");0===d.length&&(d=t.find("added-publishers"),l="addPublisher"),d.length&&(d.find("publisher").each(((e,t)=>{const i=$(t),n=i.find("user-id").text(),s=i.find("media-type").text(),o="true"===i.find("simulcast").text();if(n===r.localParticipant.id)"video"===s?r.localParticipant.isVideoAvailable=true:"sharing"===s&&(r.hasLocalSharing=true);else{const e=r.getParticipantById(n);if("video"===s)e.isVideoAvailable=true,e.simulcast=o;else if("sharing"===s){const t=new p.WebConferenceParticipant(e.id);t.contact=e.contact,t.isSharingParticipant=true,r.setSharingParticipant(t)}}this.logger.info(`[WebConferenceServiceV2] onConferenceMessage -- ${r.id} -- ${l} -- ${n} -- ${s}`)})),d.find("publisher").length&&this.sendEvent(this.RAINBOW_ONWEBCONFERENCEPUBLISHERSADDED,{roomDbId:r.id}));const u=t.find("removed-publishers");u.length&&(u.find("publisher").each(((e,t)=>{const i=$(t),n=i.find("user-id").text(),s=i.find("media-type").text();if(n===r.localParticipant.id){if("video"===s)r.localParticipant.isVideoAvailable=false,r.localParticipant.videoSession&&(this.webrtcConfigAndUtils.disableAllStreamsForSession(r.localParticipant.videoSession),r.localParticipant.videoSession.terminate(),r.localParticipant.videoSession=null);else if("sharing"===s){r.hasLocalSharing=false;let e=r.getLocalSharingSession();e&&(this.webrtcConfigAndUtils.disableAllStreamsForSession(e),e.terminate(),e=null)}}else{const e=r.getParticipantById(n);if("video"===s)e.isVideoAvailable=false,e.simulcast=false,e.videoSession&&(e.videoSession.terminate(),e.videoSession=null);else if("sharing"===s){const t=r.getSharingParticipant();t&&t.id===e.id&&r.setSharingParticipant(null)}}this.logger.info(`[WebinarConferenceService] onConferenceMessage -- ${r.id} -- removePublisher -- ${n} -- ${s}`)})),this.sendEvent(this.RAINBOW_ONWEBCONFERENCEPUBLISHERSREMOVED,{roomDbId:r.id}));const h=t.find("silents");if(h.length){const e=h.find("user-id").text(),t=h.find("talking-time").text();if(e&&(r.talker=null,t)){const i=t?parseInt(t,10):0;r.updateTalkingTimeForParticipant(e,i)}}const f=t.find("talkers");if(f.length){const e=f.find("user-id").text(),t=f.find("talking-time").text();if(e&&(r.lastTalker=e,r.talker=e,t)){const i=t?parseInt(t,10):0;r.updateTalkingTimeForParticipant(e,i)}}const g=t.find("substream");if(g.length){const e=t.find("user-id").text(),i=r.getParticipantById(e);i&&i.videoSession&&(i.subStreamLevel=parseInt($(g[0]).text(),10))}(h.length||f.length)&&this.sendEvent(this.RAINBOW_ONWEBCONFERENCERETALKERAUPDATE,{roomDbId:r.id});if(t.find("session-info").length){const e=t.find("phone-number").text(),i=t.find("session-info").text();if(e&&i){const t=r.getParticipantById(e);t&&(t.currentPstnState=i,"ringing"===i||"in_progress"===i?t.noMicrophone=true:"active"===i&&(t.noMicrophone=false)),this.sendEvent(this.RAINBOW_ONWEBCONFERENCEREPARTICIPANTAUPDATE,{roomDbId:r.id})}}const m=t.find("services");return m.length&&(m.find("service").each(((e,t)=>{const i=$(t),n=i.find("service-id").text(),s=i.find("service-type").text();r.addOrUpdateService(n,s),this.logger.info(`[WebinarConferenceService] onConferenceMessage -- ${r.id} -- services`)})),this.sendEvent(this.RAINBOW_ONWEBCONFERENCESERVICEUPDATE,{roomDbId:r.id})),true}catch(t){return this.logger.error("[WebinarConferenceService] onConferenceMessage -- "+t.message),true}}attachRemoteAudioStream(e){if(e.noAudio)return;const t=e.getAudioSession();t&&t.remoteStreams&&t.remoteStreams.forEach((e=>{e.getAudioTracks().length>0&&this.webrtcConfigAndUtils.RTC.attachMediaStreamIfNeeded([document.getElementById("globalAudioTag")],e,t.sid)})),t&&t.remoteStreamsObject[0]&&this.webrtcConfigAndUtils.RTC.attachMediaStreamIfNeeded([document.getElementById("globalAudioTag")],t.remoteStreamsObject[0],t.sid);const i=e.getRemoteSharingSession();i&&i.remoteStreamsObject[0]&&i.remoteStreamsObject[0].getAudioTracks().length&&this.webrtcConfigAndUtils.RTC.attachMediaStreamIfNeeded([document.getElementById("globalVideoTag")],i.remoteStreamsObject[0],i.sid)}getWebConferenceByJingleSessionId(e,t=null){let i=t;if(!i){const t=this.xmppService.connection.jingle.sessions[e];if(!t)return null;i=t.conference_id}return this.webConferenceSessions[i]}onJingleUpdateStream(e,t){t&&t.audio&&this.attachRemoteAudioStream(e)}onWebrtcP2PService(e){try{if("ON_CHROME_STOP_SCREEN_SHARING_TRIGGERED"===e.name){const e=this.getActiveWebConferenceSession();e&&e.localSharingSession&&this.removeMediaFromWebConferenceSession(e,"sharing")}}catch(t){this.logger.debug(`[WebConferenceServiceV2] onWebrtcP2PService error -- ${e.name} -- ${t}`)}}onJingleMessage(e){try{const t=this.getWebConferenceByJingleSessionId(e.data.sid,e.data.confId);if(t)switch(e.name){case"jingleSessionInvitation":this.onJingleSessionInvite(t,e.data.sid);break;case"iceconnectionstatechange.jingle":this.onJingleConnectionStateChange(t,e.data.session);break;case"callterminated.jingle":this.onSessionTerminated(t,e.data.sid,e.data.reason);break;case"jingleUpdateStream":this.onJingleUpdateStream(t,e.data.medias);break;case"error.jingle":this.onJingleErrorEvent(t,e.data.sid,e.data.error);break;case"resubscriptionNeeded":this.onJingleResubscriptionNeededEvent(t,e.data.sid);break;case"webrtcSessionStatsSimplyfied.jingle":this.onJingleSessionStats(t,e.data.sid,e.data.data);break;case"packetLostQualityImpactEvent":this.onJinglePacketLostEvent(t,e.data.sid,e.data.decreaseQuality);break;case"ack.jingle":break;default:this.logger.debug(`[WebConferenceServiceV2] onJingleMessage ignored -- ${e.name} -- ${t.id}`)}}catch(t){this.logger.info("[WebConferenceServiceV2] onJingleMessage -- failure -- "+e.name)}}onJingleSessionInvite(e,t){this.logger.info(`[WebConferenceServiceV2] onJingleSessionInvite -- ${e.id} -- ${t}`);const i=this.xmppService.connection.jingle.sessions[t];i.localType=i.remoteType,i.sendAnswer(),i.accept(),this.statsIntervals.push(i.getStats(8e3)),"video"!==i.localType||i.isInitiator||i.publisherId||(this.logger.info(`[WebConferenceServiceV2] onJingleSessionInvite -- ${e.id} -- ${t} -- marked as dynamic feed`),e.dynamicFeedSession=i),this.logger.info(`[WebConferenceServiceV2] onJingleSessionInvite -- accept -- ${e.id} -- ${t}`)}onSessionTerminated(e,t,i=""){if(this.logger.info(`[WebinarConferenceService] onJingleMessage -- onSessionTerminated -- ${e.id} -- ${t} -- with reason ${i}`),"multi-device"===i)this.removeActiveConferenceSession(e);else if(e.audioSession&&e.audioSession.sid===t)this.removeActiveConferenceSession(e);else{const i=this.xmppService.connection.jingle.sessions[t];i&&"video"===i.remoteType&&!i.isInitiator?this.sendEvent(this.RAINBOW_ONWEBCONFERENCEREMOTEMEDIAUPDATE,{roomDbId:e.id,mediaType:"video",action:"removed"}):i||e.participants.forEach((i=>{i&&i.videoSession&&i.videoSession.sid===t&&(i.videoSession.terminate(),i.videoSession=null,this.sendEvent(this.RAINBOW_ONWEBCONFERENCEREMOTEMEDIAUPDATE,{roomDbId:e.id,mediaType:"video",action:"removed"}))}))}}onJingleSessionStats(e,t,i){e.audioSession&&e.audioSession.sid===t&&(e.networkQuality=i.networkQualityFlag,this.eventService.publish("ON_CONFERENCE_NETWORK_UPDATE_EVENT",e,"networkQuality",e.networkQuality))}onJinglePacketLostEvent(e,t,i){if(this.logger.info(`[WebConferenceServiceV2] onJinglePacketLostEvent -- ${e.id} -- session sid ${t} -- decreaseQuality ${i}`),!this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.WEBRTC_MODULATE_VIDEO_QUALITY))return void this.logger.info("[WebConferenceServiceV2] onJinglePacketLostEvent -- ignored -- profile not enabled");const r=this.xmppService.connection.jingle.sessions[t];if(r){if(!r.isInitiator&&"video"===r.remoteType){const t=e.getParticipantById(r.publisherId);t&&this.webConferenceHelper.updateParticipantBasedOnPacketLostQualityLimitation(e,t,i,r)}}else this.logger.info("[WebConferenceServiceV2] onJinglePacketLostEvent -- ignored -- session not found")}onJingleResubscriptionNeededEvent(e,t){this.logger.warn(`[WebConferenceServiceV2] onJingleResubscriptionNeededEvent -- ${e.id} -- session sid ${t}`);const i=this.xmppService.connection.jingle.sessions[t];if(i&&!i.isInitiator){if("video"===i.remoteType){this.logger.info("[WebConferenceServiceV2] -- onJingleResubscriptionNeededEvent -- try to reconnect the remote video session -- "+i.sid),this.xmppService.connection.jingle.terminate(i.sid);const t=e.getParticipantById(i.publisherId);t.videoSession&&(t.videoSession=null,this.updateStatisticsForSession(e,i.sid),delete this.webrtcConfigAndUtils.callsStats[i.sid],this.sendEvent(this.RAINBOW_ONWEBCONFERENCEREMOTEMEDIAUPDATE,{roomDbId:e.id,mediaType:"video",action:"removed"}),this.subscribeToParticipantVideo(e,t))}if("sharing"===i.remoteType){this.logger.info("[WebConferenceServiceV2] -- onJingleResubscriptionNeededEvent -- try to reconnect the remote sharing session -- "+i.sid),this.xmppService.connection.jingle.terminate(i.sid,"icefailed");const t=e.getRemoteSharingParticipant();t&&t.videoSession&&(t.videoSession=null,this.updateStatisticsForSession(e,i.sid),delete this.webrtcConfigAndUtils.callsStats[i.sid],this.sendEvent(this.RAINBOW_ONWEBCONFERENCEREMOTEMEDIAUPDATE,{roomDbId:e.id,mediaType:"sharing",action:"removed"}))}}}onJingleErrorEvent(e,t,i){if(this.logger.error(`[WebConferenceServiceV2] onJingleErrorEvent -- ${e.id} -- ${JSON.stringify(i)}`),e.audioSession.sid===t)this.leaveWebConference(e);else if(e.localParticipant.videoSession&&e.localParticipant.videoSession.sid===t)this.removeMediaFromWebConferenceSession(e,"video");else if(e.localSharingSession&&e.localSharingSession.sid===t)this.removeMediaFromWebConferenceSession(e,"sharing");else{const i=this.xmppService.connection.jingle.sessions[t];if(i&&!i.isInitiator){if("video"===i.remoteType){this.logger.info("[WebConferenceServiceV2] -- onJingleErrorEvent -- try to reconnect the remote video session -- "+i.sid),this.xmppService.connection.jingle.terminate(i.sid);const t=e.getParticipantById(i.publisherId);t.videoSession&&(t.videoSession=null,this.updateStatisticsForSession(e,i.sid),delete this.webrtcConfigAndUtils.callsStats[i.sid],this.sendEvent(this.RAINBOW_ONWEBCONFERENCEREMOTEMEDIAUPDATE,{roomDbId:e.id,mediaType:"video",action:"removed"}),this.subscribeToParticipantVideo(e,t))}if("sharing"===i.remoteType){this.logger.info("[WebConferenceServiceV2] -- onJingleErrorEvent -- try to reconnect the remote sharing session -- "+i.sid),this.xmppService.connection.jingle.terminate(i.sid,"icefailed");const t=e.getRemoteSharingParticipant();t&&t.videoSession&&(t.videoSession=null,this.updateStatisticsForSession(e,i.sid),delete this.webrtcConfigAndUtils.callsStats[i.sid],this.sendEvent(this.RAINBOW_ONWEBCONFERENCEREMOTEMEDIAUPDATE,{roomDbId:e.id,mediaType:"sharing",action:"removed"}))}}}}async onJingleConnectionStateChange(e,t){try{if(t&&t.peerconnection&&"stable"===t.peerconnection.signalingState){const i=t.peerconnection.connectionState?t.peerconnection.connectionState:t.peerconnection.iceConnectionState;switch(this.logger.info(`[WebConferenceServiceV2] onJingleConnectionStateChange -- ${e.id} -- ${t.sid} -- ${i}`),i){case"connecting":setTimeout((()=>{if(e&&t&&t.peerconnection){const i=t.peerconnection.connectionState?t.peerconnection.connectionState:t.peerconnection.iceConnectionState;"connecting"===i&&(this.logger.info(`[WebConferenceService] onJingleConnectionStateChange -- session remains blocked in connecting state -- ${e.id} -- ${t.sid} -- ${i} -- ${t.peerconnection.signalingState}`),"audio"===t.localType||("video"===t.localType||"sharing"===t.localType)&&t.isInitiator?(t.connection=this.xmppService.connection,t.sendTransportReplace()):this.onIceConnectionFailedForSession(e,t))}}),2e4);break;case"connected":case"completed":if("audio"===t.localType&&(e.status="connected",e.startDuration(),this.attachRemoteAudioStream(e),this.sendEvent(this.RAINBOW_ONWEBCONFERENCESTATUSUPDATED,{roomDbId:e.id,status:"connected"})),"sharing"===t.localType)if(t.publisherId&&t.publisherId!==e.localParticipant.id){let i=e.getSharingParticipant();if(!i){const r=e.getParticipantById(t.publisherId);i=new p.WebConferenceParticipant(r.id),i.contact=r.contact,i.isSharingParticipant=true,e.setSharingParticipant(i)}i.videoSession=t,e.updatePinnedParticipant(e.getSharingParticipant(),"sharing"),this.sendEvent(this.RAINBOW_ONWEBCONFERENCEREMOTEMEDIAUPDATE,{roomDbId:e.id,mediaType:"sharing",action:"added"}),this.logger.info(`[WebConferenceServiceV2] sharing sessionEstablished -- ${i.id} -- ${e.id}`)}else this.logger.info("[WebConferenceServiceV2] sharing sessionEstablished -- local -- "+e.id);else if("video"===t.localType)if(t.publisherId===e.localParticipant.id)this.logger.info("[WebConferenceServiceV2] video sessionEstablished -- local -- "+e.id);else if(t.publisherId){const i=e.getParticipantById(t.publisherId);i&&(i.isVideoAvailable=true,i.videoSession=t,i.subscriptionInProgress=false),e&&e.gridServiceSubscription&&e.gridServiceSubscription.sessionId===t.sid?(this.logger.info("[WebConferenceServiceV2] video sessionEstablished -- grid/mozaic service -- "+e.id),e.gridServiceSubscription.videoSession=t,this.sendEvent(this.RAINBOW_ONWEBCONFERENCEREMOTEMEDIAUPDATE,{roomDbId:e.id,mediaType:"mozaic",action:"added"})):this.sendEvent(this.RAINBOW_ONWEBCONFERENCEREMOTEMEDIAUPDATE,{roomDbId:e.id,mediaType:"video",action:"added"})}else this.logger.info("[WebConferenceServiceV2] video sessionEstablished -- dynamicFeed -- "+e.id),this.sendEvent(this.RAINBOW_ONWEBCONFERENCEREMOTEMEDIAUPDATE,{roomDbId:e.id,mediaType:"dynamicFeed",action:"added"});this.sendEvent("peerConnectionEstablished",{sessionId:t.sid});break;case"disconnected":this.logger.info(`[WebConferenceServiceV2] session ICE Disconnected -- ${e.id} -- ${t.sid}`),this.onIceConnectionDisconnectedForSession(e,t);break;case"failed":this.logger.info(`[WebConferenceServiceV2] session ICE Failed -- ${e.id} -- ${t.sid}`),this.onIceConnectionFailedForSession(e,t)}}else t&&t.peerconnection&&"stable"!==t.peerconnection.signalingState&&this.logger.info(`[WebConferenceService] onJingleConnectionStateChange signaling state change -- ${e.id} -- ${t.sid} -- ${t.peerconnection.signalingState}`)}catch(i){this.logger.error("[WebConferenceServiceV2] onIceConnectionStateChange error -- "+i)}}reconnectActiveConferenceSession(){const e=this.getActiveWebConferenceSession();e&&(e.localParticipant?(this.logger.info("[WebConferenceServiceV2] -- reconnectAllActiveConferenceSessions -- try to reconnect the audio session"),this.sendTransportReplaceForSession(e,e.audioSession,1e3),e.localParticipant.videoSession&&(this.logger.info("[WebConferenceServiceV2] -- reconnectAllActiveConferenceSessions -- try to reconnect the video session"),this.sendTransportReplaceForSession(e,e.localParticipant.videoSession,2e3)),e.localSharingSession&&(this.logger.info("[WebConferenceServiceV2] -- reconnectAllActiveConferenceSessions -- try to reconnect the sharing session"),this.sendTransportReplaceForSession(e,e.localSharingSession,3e3)),setTimeout((()=>{const t=e.getRemoteSharingParticipant();if(t&&t.videoSession&&t.videoSession.peerconnection){const i=t.videoSession.peerconnection.connectionState?t.videoSession.peerconnection.connectionState:t.videoSession.peerconnection.iceConnectionState;"stable"!==t.videoSession.peerconnection.signalingState||"failed"!==i&&"disconnected"!==i||this.onIceConnectionFailedForSession(e,t.videoSession)}if(e.dynamicFeedSession&&e.dynamicFeedSession.peerconnection){const t=e.dynamicFeedSession.peerconnection.connectionState?e.dynamicFeedSession.peerconnection.connectionState:e.dynamicFeedSession.peerconnection.iceConnectionState;"stable"!==e.dynamicFeedSession.peerconnection.signalingState||"failed"!==t&&"disconnected"!==t||this.onIceConnectionFailedForSession(e,e.dynamicFeedSession)}if(e.gridServiceSubscription&&e.gridServiceSubscription.videoSession&&e.gridServiceSubscription.videoSession.peerconnection){const t=e.gridServiceSubscription.videoSession.peerconnection.connectionState?e.gridServiceSubscription.videoSession.peerconnection.connectionState:e.gridServiceSubscription.videoSession.peerconnection.iceConnectionState;"stable"!==e.gridServiceSubscription.videoSession.peerconnection.signalingState||"failed"!==t&&"disconnected"!==t||this.onIceConnectionFailedForSession(e,e.gridServiceSubscription.videoSession)}e.participants.forEach((t=>{if(t.videoSession&&t.videoSession.peerconnection){const i=t.videoSession.peerconnection.connectionState?t.videoSession.peerconnection.connectionState:t.videoSession.peerconnection.iceConnectionState;"stable"!==t.videoSession.peerconnection.signalingState||"failed"!==i&&"disconnected"!==i||this.onIceConnectionFailedForSession(e,t.videoSession)}}))}),4e3)):this.removeActiveConferenceSession(e))}onIceConnectionFailedForSession(e,t){if("audio"===t.localType||("video"===t.localType||"sharing"===t.localType)&&t.isInitiator)this.onIceConnectionDisconnectedForSession(e,t);else if(this.connected&&!t.isInitiator){if("video"===t.remoteType)if(this.logger.info("[WebConferenceServiceV2] -- onIceConnectionFailedForSession -- reconnect the remote video session -- "+t.sid),this.xmppService.connection.jingle.terminate(t.sid),this.updateStatisticsForSession(e,t.sid),delete this.webrtcConfigAndUtils.callsStats[t.sid],e.gridServiceSubscription&&e.gridServiceSubscription.videoSession&&e.gridServiceSubscription.videoSession.sid===t.sid)this.logger.info("[WebConferenceServiceV2] -- onIceConnectionFailedForSession -- reconnect the grid / mozaic service session -- "+t.sid),e.gridServiceSubscription=null,e.services.forEach((t=>{"video-compositor"===t.name&&this.subscribeToService(e,t.id)}));else if(t.publisherId){const i=e.getParticipantById(t.publisherId);i.videoSession=null,this.subscribeToParticipantVideo(e,i)}else this.logger.info("[WebConferenceServiceV2] -- onIceConnectionFailedForSession -- reconnect the dynamic feed session -- "+t.sid),e.dynamicFeedSession=null,this.subscribeToDynamicFeed(e);if("sharing"===t.remoteType){this.logger.info("[WebConferenceServiceV2] -- onIceConnectionFailedForSession -- reconnect the remote sharing session -- "+t.sid),this.xmppService.connection.jingle.terminate(t.sid,"icefailed");const i=e.getRemoteSharingParticipant();i&&i.videoSession&&(i.videoSession=null),this.updateStatisticsForSession(e,t.sid),delete this.webrtcConfigAndUtils.callsStats[t.sid]}}}onIceConnectionDisconnectedForSession(e,t){"audio"===t.localType?(e.status="reconnecting",this.sendEvent(this.RAINBOW_ONWEBCONFERENCESTATUSUPDATED,{roomDbId:e.id,status:"reconnecting"}),this.connected&&this.sendTransportReplaceForSession(e,t,5e3)):"video"!==t.localType&&"sharing"!==t.localType||!t.isInitiator||this.connected&&this.sendTransportReplaceForSession(e,t,8e3)}sendTransportReplaceForSession(e,t,i=1e3){if(!t||!t.sid)return void this.logger.warn("[WebConferenceServiceV2] sendTransportReplaceForSession missing session !");if(!t.peerconnection)return void this.logger.warn("[WebConferenceServiceV2] sendTransportReplaceForSession missing peerconnection for session !");const r=t.peerconnection.connectionState?t.peerconnection.connectionState:t.peerconnection.iceConnectionState;t.peerconnection&&"stable"===t.peerconnection.signalingState&&"failed"!==r&&"disconnected"!==r?this.logger.info("[WebConferenceServiceV2] sendTransportReplaceForSession not needed for "+t.sid):this.reconnectionsInProgress[t.sid]?this.logger.info("[WebConferenceServiceV2] sendTransportReplaceForSession already reconnecting for session "+t.sid):(this.reconnectionsInProgress[t.sid]=true,setTimeout((()=>{if(this.reconnectionsInProgress[t.sid]=false,delete this.reconnectionsInProgress[t.sid],this.connected&&t&&t.peerconnection&&"stable"===t.peerconnection.signalingState&&("failed"===t.peerconnection.iceConnectionState||"disconnected"===t.peerconnection.iceConnectionState)){this.logger.info("[WebConferenceServiceV2] sendTransportReplaceForSession for session "+t.sid),t.connection=this.xmppService.connection,t.sendTransportReplace();const i=e&&e.localSharingSession?"sharing":"audio";this.contactService.setBusyState("dnd",i)}else this.connected&&t&&t.peerconnection&&"closed"===t.peerconnection.iceConnectionState?"audio"===t.localType?this.leaveWebConference(e):"video"!==t.localType&&"sharing"!==t.localType||!t.isInitiator||this.removeMediaFromWebConferenceSession(e,t.localType):this.logger.info("[WebConferenceServiceV2] sendTransportReplaceForSession for session "+t.sid+" is not send ...")}),i))}}t.WebConferenceServiceV2=_},function(e,t,i){(function(e){
/*!
       * The buffer module from node.js, for the browser.
       *
       * @author   Feross Aboukhadijeh <http://feross.org>
       * @license  MIT
       */
var r=i(420),n=i(421),s=i(422);function o(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,i){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,i);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return u(this,e)}return l(this,e,t,i)}function l(e,t,i,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,i,r){if(t.byteLength,i<0||t.byteLength<i)throw new RangeError("'offset' is out of bounds");if(t.byteLength<i+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===i&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,i):new Uint8Array(t,i,r);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=h(e,t);return e}(e,t,i,r):"string"==typeof t?function(e,t,i){"string"==typeof i&&""!==i||(i="utf8");if(!c.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,i),n=(e=a(e,r)).write(t,i);n!==r&&(e=e.slice(0,n));return e}(e,t,i):function(e,t){if(c.isBuffer(t)){var i=0|f(t.length);return 0===(e=a(e,i)).length||t.copy(e,0,0,i),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?a(e,0):h(e,t);if("Buffer"===t.type&&s(t.data))return h(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function d(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function u(e,t){if(d(t),e=a(e,t<0?0:0|f(t)),!c.TYPED_ARRAY_SUPPORT)for(var i=0;i<t;++i)e[i]=0;return e}function h(e,t){var i=t.length<0?0:0|f(t.length);e=a(e,i);for(var r=0;r<i;r+=1)e[r]=255&t[r];return e}function f(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function p(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var i=e.length;if(0===i)return 0;for(var r=false;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return W(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return B(e).length;default:if(r)return W(e).length;t=(""+t).toLowerCase(),r=true}}function g(e,t,i){var r=false;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return M(this,t,i);case"utf8":case"utf-8":return I(this,t,i);case"ascii":return P(this,t,i);case"latin1":case"binary":return A(this,t,i);case"base64":return T(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D(this,t,i);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=true}}function m(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function v(e,t,i,r,n){if(0===e.length)return-1;if("string"==typeof i?(r=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=n?0:e.length-1),i<0&&(i=e.length+i),i>=e.length){if(n)return-1;i=e.length-1}else if(i<0){if(!n)return-1;i=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:S(e,t,i,r,n);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?n?Uint8Array.prototype.indexOf.call(e,t,i):Uint8Array.prototype.lastIndexOf.call(e,t,i):S(e,[t],i,r,n);throw new TypeError("val must be string, number or Buffer")}function S(e,t,i,r,n){var s,o=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,i/=2}function l(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(n){var d=-1;for(s=i;s<a;s++)if(l(e,s)===l(t,-1===d?0:s-d)){if(-1===d&&(d=s),s-d+1===c)return d*o}else-1!==d&&(s-=s-d),d=-1}else for(i+c>a&&(i=a-c),s=i;s>=0;s--){for(var u=true,h=0;h<c;h++)if(l(e,s+h)!==l(t,h)){u=false;break}if(u)return s}return-1}function b(e,t,i,r){i=Number(i)||0;var n=e.length-i;r?(r=Number(r))>n&&(r=n):r=n;var s=t.length;if(s%2!=0)throw new TypeError("Invalid hex string");r>s/2&&(r=s/2);for(var o=0;o<r;++o){var a=parseInt(t.substr(2*o,2),16);if(isNaN(a))return o;e[i+o]=a}return o}function y(e,t,i,r){return H(W(t,e.length-i),e,i,r)}function C(e,t,i,r){return H(function(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(t),e,i,r)}function w(e,t,i,r){return C(e,t,i,r)}function _(e,t,i,r){return H(B(t),e,i,r)}function E(e,t,i,r){return H(function(e,t){for(var i,r,n,s=[],o=0;o<e.length&&!((t-=2)<0);++o)i=e.charCodeAt(o),r=i>>8,n=i%256,s.push(n),s.push(r);return s}(t,e.length-i),e,i,r)}function T(e,t,i){return 0===t&&i===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,i))}function I(e,t,i){i=Math.min(e.length,i);for(var r=[],n=t;n<i;){var s,o,a,c,l=e[n],d=null,u=l>239?4:l>223?3:l>191?2:1;if(n+u<=i)switch(u){case 1:l<128&&(d=l);break;case 2:128==(192&(s=e[n+1]))&&(c=(31&l)<<6|63&s)>127&&(d=c);break;case 3:s=e[n+1],o=e[n+2],128==(192&s)&&128==(192&o)&&(c=(15&l)<<12|(63&s)<<6|63&o)>2047&&(c<55296||c>57343)&&(d=c);break;case 4:s=e[n+1],o=e[n+2],a=e[n+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(c=(15&l)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&c<1114112&&(d=c)}null===d?(d=65533,u=1):d>65535&&(d-=65536,r.push(d>>>10&1023|55296),d=56320|1023&d),r.push(d),n+=u}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var i="",r=0;for(;r<t;)i+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return i}(r)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return false}}(),t.kMaxLength=o(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,i){return l(null,e,t,i)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:true})),c.alloc=function(e,t,i){return function(e,t,i,r){return d(t),t<=0?a(e,t):void 0!==i?"string"==typeof r?a(e,t).fill(i,r):a(e,t).fill(i):a(e,t)}(null,e,t,i)},c.allocUnsafe=function(e){return u(null,e)},c.allocUnsafeSlow=function(e){return u(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var i=e.length,r=t.length,n=0,s=Math.min(i,r);n<s;++n)if(e[n]!==t[n]){i=e[n],r=t[n];break}return i<r?-1:r<i?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}},c.concat=function(e,t){if(!s(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var i;if(void 0===t)for(t=0,i=0;i<e.length;++i)t+=e[i].length;var r=c.allocUnsafe(t),n=0;for(i=0;i<e.length;++i){var o=e[i];if(!c.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,n),n+=o.length}return r},c.byteLength=p,c.prototype._isBuffer=true,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?I(this,0,e):g.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",i=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,i).match(/.{2}/g).join(" "),this.length>i&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,i,r,n){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===i&&(i=e?e.length:0),void 0===r&&(r=0),void 0===n&&(n=this.length),t<0||i>e.length||r<0||n>this.length)throw new RangeError("out of range index");if(r>=n&&t>=i)return 0;if(r>=n)return-1;if(t>=i)return 1;if(this===e)return 0;for(var s=(n>>>=0)-(r>>>=0),o=(i>>>=0)-(t>>>=0),a=Math.min(s,o),l=this.slice(r,n),d=e.slice(t,i),u=0;u<a;++u)if(l[u]!==d[u]){s=l[u],o=d[u];break}return s<o?-1:o<s?1:0},c.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},c.prototype.indexOf=function(e,t,i){return v(this,e,t,i,true)},c.prototype.lastIndexOf=function(e,t,i){return v(this,e,t,i,false)},c.prototype.write=function(e,t,i,r){if(void 0===t)r="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)r=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(i)?(i|=0,void 0===r&&(r="utf8")):(r=i,i=void 0)}var n=this.length-t;if((void 0===i||i>n)&&(i=n),e.length>0&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var s=false;;)switch(r){case"hex":return b(this,e,t,i);case"utf8":case"utf-8":return y(this,e,t,i);case"ascii":return C(this,e,t,i);case"latin1":case"binary":return w(this,e,t,i);case"base64":return _(this,e,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,e,t,i);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=true}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function P(e,t,i){var r="";i=Math.min(e.length,i);for(var n=t;n<i;++n)r+=String.fromCharCode(127&e[n]);return r}function A(e,t,i){var r="";i=Math.min(e.length,i);for(var n=t;n<i;++n)r+=String.fromCharCode(e[n]);return r}function M(e,t,i){var r=e.length;(!t||t<0)&&(t=0),(!i||i<0||i>r)&&(i=r);for(var n="",s=t;s<i;++s)n+=j(e[s]);return n}function D(e,t,i){for(var r=e.slice(t,i),n="",s=0;s<r.length;s+=2)n+=String.fromCharCode(r[s]+256*r[s+1]);return n}function R(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>i)throw new RangeError("Trying to access beyond buffer length")}function O(e,t,i,r,n,s){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>n||t<s)throw new RangeError('"value" argument is out of bounds');if(i+r>e.length)throw new RangeError("Index out of range")}function N(e,t,i,r){t<0&&(t=65535+t+1);for(var n=0,s=Math.min(e.length-i,2);n<s;++n)e[i+n]=(t&255<<8*(r?n:1-n))>>>8*(r?n:1-n)}function x(e,t,i,r){t<0&&(t=4294967295+t+1);for(var n=0,s=Math.min(e.length-i,4);n<s;++n)e[i+n]=t>>>8*(r?n:3-n)&255}function L(e,t,i,r,n,s){if(i+r>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function k(e,t,i,r,s){return s||L(e,0,i,4),n.write(e,t,i,r,23,4),i+4}function F(e,t,i,r,s){return s||L(e,0,i,8),n.write(e,t,i,r,52,8),i+8}c.prototype.slice=function(e,t){var i,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(i=this.subarray(e,t)).__proto__=c.prototype;else{var n=t-e;i=new c(n,void 0);for(var s=0;s<n;++s)i[s]=this[s+e]}return i},c.prototype.readUIntLE=function(e,t,i){e|=0,t|=0,i||R(e,t,this.length);for(var r=this[e],n=1,s=0;++s<t&&(n*=256);)r+=this[e+s]*n;return r},c.prototype.readUIntBE=function(e,t,i){e|=0,t|=0,i||R(e,t,this.length);for(var r=this[e+--t],n=1;t>0&&(n*=256);)r+=this[e+--t]*n;return r},c.prototype.readUInt8=function(e,t){return t||R(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||R(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||R(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||R(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||R(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,i){e|=0,t|=0,i||R(e,t,this.length);for(var r=this[e],n=1,s=0;++s<t&&(n*=256);)r+=this[e+s]*n;return r>=(n*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,i){e|=0,t|=0,i||R(e,t,this.length);for(var r=t,n=1,s=this[e+--r];r>0&&(n*=256);)s+=this[e+--r]*n;return s>=(n*=128)&&(s-=Math.pow(2,8*t)),s},c.prototype.readInt8=function(e,t){return t||R(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||R(e,2,this.length);var i=this[e]|this[e+1]<<8;return 32768&i?4294901760|i:i},c.prototype.readInt16BE=function(e,t){t||R(e,2,this.length);var i=this[e+1]|this[e]<<8;return 32768&i?4294901760|i:i},c.prototype.readInt32LE=function(e,t){return t||R(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||R(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||R(e,4,this.length),n.read(this,e,true,23,4)},c.prototype.readFloatBE=function(e,t){return t||R(e,4,this.length),n.read(this,e,false,23,4)},c.prototype.readDoubleLE=function(e,t){return t||R(e,8,this.length),n.read(this,e,true,52,8)},c.prototype.readDoubleBE=function(e,t){return t||R(e,8,this.length),n.read(this,e,false,52,8)},c.prototype.writeUIntLE=function(e,t,i,r){(e=+e,t|=0,i|=0,r)||O(this,e,t,i,Math.pow(2,8*i)-1,0);var n=1,s=0;for(this[t]=255&e;++s<i&&(n*=256);)this[t+s]=e/n&255;return t+i},c.prototype.writeUIntBE=function(e,t,i,r){(e=+e,t|=0,i|=0,r)||O(this,e,t,i,Math.pow(2,8*i)-1,0);var n=i-1,s=1;for(this[t+n]=255&e;--n>=0&&(s*=256);)this[t+n]=e/s&255;return t+i},c.prototype.writeUInt8=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):N(this,e,t,true),t+2},c.prototype.writeUInt16BE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):N(this,e,t,false),t+2},c.prototype.writeUInt32LE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):x(this,e,t,true),t+4},c.prototype.writeUInt32BE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):x(this,e,t,false),t+4},c.prototype.writeIntLE=function(e,t,i,r){if(e=+e,t|=0,!r){var n=Math.pow(2,8*i-1);O(this,e,t,i,n-1,-n)}var s=0,o=1,a=0;for(this[t]=255&e;++s<i&&(o*=256);)e<0&&0===a&&0!==this[t+s-1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+i},c.prototype.writeIntBE=function(e,t,i,r){if(e=+e,t|=0,!r){var n=Math.pow(2,8*i-1);O(this,e,t,i,n-1,-n)}var s=i-1,o=1,a=0;for(this[t+s]=255&e;--s>=0&&(o*=256);)e<0&&0===a&&0!==this[t+s+1]&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+i},c.prototype.writeInt8=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):N(this,e,t,true),t+2},c.prototype.writeInt16BE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):N(this,e,t,false),t+2},c.prototype.writeInt32LE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):x(this,e,t,true),t+4},c.prototype.writeInt32BE=function(e,t,i){return e=+e,t|=0,i||O(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):x(this,e,t,false),t+4},c.prototype.writeFloatLE=function(e,t,i){return k(this,e,t,true,i)},c.prototype.writeFloatBE=function(e,t,i){return k(this,e,t,false,i)},c.prototype.writeDoubleLE=function(e,t,i){return F(this,e,t,true,i)},c.prototype.writeDoubleBE=function(e,t,i){return F(this,e,t,false,i)},c.prototype.copy=function(e,t,i,r){if(i||(i=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<i&&(r=i),r===i)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-i&&(r=e.length-t+i);var n,s=r-i;if(this===e&&i<t&&t<r)for(n=s-1;n>=0;--n)e[n+t]=this[n+i];else if(s<1e3||!c.TYPED_ARRAY_SUPPORT)for(n=0;n<s;++n)e[n+t]=this[n+i];else Uint8Array.prototype.set.call(e,this.subarray(i,i+s),t);return s},c.prototype.fill=function(e,t,i,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,i=this.length):"string"==typeof i&&(r=i,i=this.length),1===e.length){var n=e.charCodeAt(0);n<256&&(e=n)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;var s;if(t>>>=0,i=void 0===i?this.length:i>>>0,e||(e=0),"number"==typeof e)for(s=t;s<i;++s)this[s]=e;else{var o=c.isBuffer(e)?e:W(new c(e,r).toString()),a=o.length;for(s=0;s<i-t;++s)this[s+t]=o[s%a]}return this};var U=/[^+\/0-9A-Za-z-_]/g;function j(e){return e<16?"0"+e.toString(16):e.toString(16)}function W(e,t){var i;t=t||1/0;for(var r=e.length,n=null,s=[],o=0;o<r;++o){if((i=e.charCodeAt(o))>55295&&i<57344){if(!n){if(i>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&s.push(239,191,189);continue}n=i;continue}if(i<56320){(t-=3)>-1&&s.push(239,191,189),n=i;continue}i=65536+(n-55296<<10|i-56320)}else n&&(t-=3)>-1&&s.push(239,191,189);if(n=null,i<128){if((t-=1)<0)break;s.push(i)}else if(i<2048){if((t-=2)<0)break;s.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;s.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return s}function B(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(U,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function H(e,t,i,r){for(var n=0;n<r&&!(n+i>=t.length||n>=e.length);++n)t[n+i]=e[n];return n}}).call(this,i(130))},function(e,t,i){var r=i(0),n=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.scheduler=t,r.work=i,r}return r.a(t,e),t.prototype.schedule=function(t,i){return void 0===i&&(i=0),i>0?e.prototype.schedule.call(this,t,i):(this.delay=i,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,i){return i>0||this.closed?e.prototype.execute.call(this,t,i):this._execute(t,i)},t.prototype.requestAsyncId=function(t,i,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?e.prototype.requestAsyncId.call(this,t,i,r):t.flush(this)},t}(i(53).a),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.a(t,e),t}(i(51).a);i.d(t,"b",(function(){return o})),i.d(t,"a",(function(){return a}));var o=new s(n),a=o},function(e,t,i){i.d(t,"a",(function(){return o}));var r=i(0),n=i(12),s=i(41),o=function(e){function t(t){var i=e.call(this)||this;return i._value=t,i}return r.a(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:true,configurable:true}),t.prototype._subscribe=function(t){var i=e.prototype._subscribe.call(this,t);return i&&!i.closed&&t.next(this._value),i},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new s.a;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(n.a)},function(e,t,i){i.d(t,"a",(function(){return r}));var r=function(){function e(t,i){void 0===i&&(i=e.now),this.SchedulerAction=t,this.now=i}return e.prototype.schedule=function(e,t,i){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(i,t)},e.now=function(){return Date.now()},e}()},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{static createFromData(e){return new r(e.id,e.companyId,e.companyName,e.invitedUserId,e.invitedUserEmail,e.invitingAdminId,e.invitingAdminLoginEmail,e.invitationDate,e.lastNotificationDate,e.requestedNotificationLanguage,e.status,e.acceptationDate,e.declinationDate,e.invitedToBeCompanyAdmin)}constructor(e,t,i,r,n,s,o,a,c,l,d,u,h,f){this.id=e,this.companyId=t,this.companyName=i,this.invitedUserId=r,this.invitedUserEmail=n,this.invitingAdminId=s,this.invitingAdminLoginEmail=o,this.invitationDate=a,this.lastNotificationDate=c,this.requestedNotificationLanguage=l,this.status=d,this.acceptationDate=u,this.declinationDate=h,this.invitedToBeCompanyAdmin=f}}t.CompanyInvitation=r},function(e,t,i){i.d(t,"b",(function(){return c})),i.d(t,"a",(function(){return h}));var r=i(0),n=i(2),s=i(10),o=i(5),a=i(12);function c(e,t,i,r){return function(n){return n.lift(new l(e,t,i,r))}}var l=function(){function e(e,t,i,r){this.keySelector=e,this.elementSelector=t,this.durationSelector=i,this.subjectSelector=r}return e.prototype.call=function(e,t){return t.subscribe(new d(e,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))},e}(),d=function(e){function t(t,i,r,n,s){var o=e.call(this,t)||this;return o.keySelector=i,o.elementSelector=r,o.durationSelector=n,o.subjectSelector=s,o.groups=null,o.attemptedToUnsubscribe=false,o.count=0,o}return r.a(t,e),t.prototype._next=function(e){var t;try{t=this.keySelector(e)}catch(dp){return void this.error(dp)}this._group(e,t)},t.prototype._group=function(e,t){var i=this.groups;i||(i=this.groups=new Map);var r,n=i.get(t);if(this.elementSelector)try{r=this.elementSelector(e)}catch(dp){this.error(dp)}else r=e;if(!n){n=this.subjectSelector?this.subjectSelector():new a.a,i.set(t,n);var s=new h(t,n,this);if(this.destination.next(s),this.durationSelector){var o=void 0;try{o=this.durationSelector(new h(t,n))}catch(dp){return void this.error(dp)}this.add(o.subscribe(new u(t,n,this)))}}n.closed||n.next(r)},t.prototype._error=function(e){var t=this.groups;t&&(t.forEach((function(t,i){t.error(e)})),t.clear()),this.destination.error(e)},t.prototype._complete=function(){var e=this.groups;e&&(e.forEach((function(e,t){e.complete()})),e.clear()),this.destination.complete()},t.prototype.removeGroup=function(e){this.groups.delete(e)},t.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=true,0===this.count&&e.prototype.unsubscribe.call(this))},t}(n.a),u=function(e){function t(t,i,r){var n=e.call(this,i)||this;return n.key=t,n.group=i,n.parent=r,n}return r.a(t,e),t.prototype._next=function(e){this.complete()},t.prototype._unsubscribe=function(){var e=this.parent,t=this.key;this.key=this.parent=null,e&&e.removeGroup(t)},t}(n.a),h=function(e){function t(t,i,r){var n=e.call(this)||this;return n.key=t,n.groupSubject=i,n.refCountSubscription=r,n}return r.a(t,e),t.prototype._subscribe=function(e){var t=new s.a,i=this.refCountSubscription,r=this.groupSubject;return i&&!i.closed&&t.add(new f(i)),t.add(r.subscribe(e)),t},t}(o.a),f=function(e){function t(t){var i=e.call(this)||this;return i.parent=t,t.count++,i}return r.a(t,e),t.prototype.unsubscribe=function(){var t=this.parent;t.closed||this.closed||(e.prototype.unsubscribe.call(this),t.count-=1,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())},t}(s.a)},function(e,t,i){i.r(t),function(e){const i=/[&<>"'`]/g,r=RegExp(i.source),n="object"==typeof e&&e&&e.Object===Object&&e,s="object"==typeof self&&self&&self.Object===Object&&self,o=n||s||Function("return this")();const a=(c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},function(e){return null==c?void 0:c[e]});var c;const l=Object.prototype.toString,d=o.Symbol,u=d?d.prototype:void 0,h=u?u.toString:void 0;function f(e){if("string"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return Boolean(e)&&"object"==typeof e}(e)&&"[object Symbol]"==l.call(e)}(e))return h?h.call(e):"";const t=String(e);return"0"==t&&1/e==-1/0?"-0":t}t.default=function(e){var t;return(e=null==(t=e)?"":f(t))&&r.test(e)?e.replace(i,a):e}}.call(this,i(130))},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{constructor(e,t){this.viewerId=null,this.type=null,this.contact=null,this.room=null,this.channel=null,this.viewerId=e,this.type=t}static createFromData(e){return e.map((e=>new r(e.viewerId,e.type)))}}t.FileViewer=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(4);class n{constructor(){this.queue=[],this.started=false,this.logger=r.LoggerService.getInstance()}static create(){return new n}add(e){this.queue.push(e),this.started||(this.started=true,this.execute())}execute(){const e=this.queue.shift();if(e)try{this.timeoutPromise(2e4,e).then((()=>{this.execute()})).catch((e=>{const t=e&&e.message?e.message:"Unknown error";this.logger.error("[PromiseQueue] execute failure -- "+t),this.execute()}))}catch(t){const e=t&&t.message?t.message:"Unknown error",i=t&&t.stack?t.stack:"Unknown stack";this.logger.error(`[PromiseQueue] execution exception  -- ${e} : ${i}`),this.execute()}else this.started=false}timeoutPromise(e,t){let i=null;const r=new Promise(((t,r)=>{i=setTimeout((()=>{r(new Error("Timed out in "+e+"ms."))}),e)}));return Promise.race([t(),r]).then((e=>(clearTimeout(i),e)))}}t.PromiseQueue=n},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7),n=i(24),s=i(137),o=i(138);class a{constructor(e=null,t=null,i=null){this.id=null,this.dbId=null,this.jid=null,this.fullJid=null,this.jidtel=null,this.login=null,this.temp=false,this.roster=false,this.initialized=false,this.isTerminated=false,this.ask=null,this.subscription=null,this.guest=false,this.confId=null,this.conversation=null,this.personalAudioRoomOpenInviteId=null,this.personalAudioRoomOpenInviteIdSubject=null,this.capabilities=null,this.groups=null,this.nameUpdatePrio=null,this.rxSubject=new r.Subject,this.isBot=false,this.isBotSharing=false,this.isConfiguringSettings=false,this.status=null,this.telStatus=null,this.imStatus=null,this.oldImStatus=null,this.imStatusStamp=null,this.resources=null,this.lastActivityDate=null,this.lastActivityMessage=null,this.statusMessage=null,this.message=null,this.loginEmail=null,this.lastname=null,this.firstname=null,this.initials=null,this.name=null,this.nickname=null,this.title=null,this.jobTitle=null,this.company=null,this.companyFeatures=null,this.isInDefaultCompany=false,this.language=null,this.country=null,this.timezone=null,this.tags=null,this._displayName=null,this.nameForLogs=null,this.displayShortName=null,this.displayOrder="FL",this.o365Flag=false,this.outlookFlag=false,this.invitation=null,this.botDetails="",this._avatar=null,this.defaultAvatar=null,this.avatarSrc=null,this.calendarState=null,this.calendarStateRaw=null,this.phoneProCan=null,this.pbxId=null,this.organisationId=null,this.siteId=null,this.systemId=null,this.phoneNumberId=null,this.phonePbx=null,this.phoneInternalNumber=null,this.mobilePro=null,this.mobileProCan=null,this.isMobileProShared=false,this.phonePerso=null,this.phonePersoCan=null,this.isPhonePersoShared=false,this.mobilePerso=null,this.mobilePersoCan=null,this.isMobilePersoShared=false,this.isVirtualTerm=false,this.systDeviceName=null,this.voicemailNumber=null,this.hasPhoneNumber=false,this.hasPhoneProDdiNumber=false,this.phoneNumbersInitialized=false,this.isCCDAgentEnabled=false,this.mobilePhones=[],this.businessPhones=[],this.email="",this.companyDirectoryFlag=false,this.userId=null,this.personalDirectoryFlag=false,this.directoryObsolete=false,this.emailPro=null,this.emailPerso=null,this.note1=null,this.note2=null,this.department=null,this.otherPhoneNumbers=null,this.postalCode=null,this.state=null,this.street=null,this.city=null,this.companyName=null,this.businessCompanyId=null,this.isTv=false,this.rainbowTvData=null,this.roles=null,this.adminType=null,this.customData=null,this.userInfo1=null,this.userInfo2=null,this.userTitleNameEnabled=false,this.alertNotificationEnabledForMyCompany=false,this.msTeamsPresence="",this._guestMode=false,this.guestModeSubject=new r.BehaviorSubject(this._guestMode),this._outOfOffice={active:false,message:""},this.giphyEnabled=true,this.telephonySettingsEnabled=true,this.recordConversationEnabled=true,this.changeSettingsEnabled=true,this.newUiEnabled=false,this.denySelfRegister=false,this.webinarEnabled=true,this.attendantConsoleEnabled=false,this.supervisorConsoleEnabled=false,this.isAlertNotificationEnabled=false,this.eLearningCustomisation=false,this.eLearningGamificationCustomisation=false,this._fileSharingEnabled=false,this._fileStorageEnabled=false,this._instantMessagesEnabled=false,this._changePresenceEnabled=false,this._phoneMeetingsEnabled=false,this._channelsEnabled=false,this._roomsEnabled=false,this._webrtcAudioEnabled=false,this._webrtcVideoEnabled=false,this._webrtcSharingEnabled=false,this._modifyProfileEnabled=false,this._useDialOutEnabled=false,this._useSpeakingTimeStatistics=false,this._readReceiptsCustomisation=false,this._telCapabilities=null,this._supervisionCapabilities=null,this._supervisionState=null,this._forwards=null,this._personalRoutines=null,this.id=e,this.dbId=null,this.jid=e,this.fullJid=null,this.jidtel=null,this.login=null,this.temp=false,this.roster=false,this.initialized=false,this.ask="none",this.subscription="none",this.guest=false,this.confId="",this.conversation=null,this.personalAudioRoomOpenInviteId=null,this.personalAudioRoomOpenInviteIdSubject=new r.BehaviorSubject(this.personalAudioRoomOpenInviteId),this.capabilities=null,this.groups=null,this.nameUpdatePrio=a.NameUpdatePrio.MAX_UPDATE_PRIO,this.status="unknown",this.telStatus="",this.imStatus="offline",this.oldImStatus=null,this.imStatusStamp=[],this.resources={},this.mobileResource=null,this.lastActivityDate=null,this.lastActivityMessage=null,this.statusMessage=null,this.message="",this.loginEmail="",this.lastname="",this.firstname="",this.initials="",this.name={value:this._displayName},this.nameForLogs="",this._displayName=t||e,this.nickname="",this.title="",this.jobTitle="",this.company=i,this.isInDefaultCompany=false,this.language=null,this.country="",this.timezone="",this.tags=null,this.defaultAvatar=null,this._avatar=null,this.avatarSrc=null,this.calendarState={},this.calendarStateRaw={},this.phonePro="",this.phoneProCan="",this.pbxId="",this.phonePbx="",this.phoneInternalNumber="",this.mobilePro="",this.mobileProCan="",this.isMobileProShared=false,this.phonePerso="",this.phonePersoCan="",this.isPhonePersoShared=false,this.mobilePerso="",this.mobilePersoCan="",this.isMobilePersoShared=false,this.isVirtualTerm=false,this.systDeviceName=null,this.emailPro="",this.emailPerso="",this.note1="",this.note2="",this.department="",this.otherPhoneNumbers=[],this.postalCode="",this.state="",this.street="",this.city="",this.businessCompanyId="",this.userId="",this.companyName="",this.isTv=false,this.rainbowTvData={},this.roles=[],this.adminType=null,this.newUiEnabled=false,this._fileSharingEnabled=true,this._fileStorageEnabled=true,this.fileStorageEnabledSubject=new r.BehaviorSubject(true),this._instantMessagesEnabled=true,this._changePresenceEnabled=true,this._phoneMeetingsEnabled=true,this.phoneMeetingsEnabledSubject=new r.BehaviorSubject(true),this._channelsEnabled=true,this.webinarEnabled=true,this._roomsEnabled=true,this._webrtcAudioEnabled=true,this._webrtcVideoEnabled=true,this._webrtcSharingEnabled=true,this._modifyProfileEnabled=true,this._useDialOutEnabled=true,this._useSpeakingTimeStatistics=true,this._readReceiptsCustomisation=true,this.attendantConsoleEnabled=false,this.supervisorConsoleEnabled=false,this.isAlertNotificationEnabled=false,this.userTitleNameEnabled=true,this.giphyEnabled=true,this.isCCDAgentEnabled=false,this.msTeamsPresence="",this.denySelfRegister=false,this.eLearningCustomisation=false,this.eLearningGamificationCustomisation=false}get guestMode(){return this._guestMode}set guestMode(e){this._guestMode=e,this.guestModeSubject.next(this._guestMode)}get outOfOffice(){return this._outOfOffice}set outOfOffice(e){this._outOfOffice=e,this.rxSubject.next({name:"outOfOffice"})}updateFromUserData(e){this.isBot=false,this.isBotSharing=false,void 0!==e.id&&(this.dbId=e.id),void 0!==e.loginEmail&&(this.loginEmail=e.loginEmail),void 0!==e.firstName&&(this.firstname=e.firstName),void 0!==e.lastName&&(this.lastname=e.lastName),void 0!==e.nickName&&(this.nickname=e.nickName),void 0!==e.title&&(this.title=e.title),void 0!==e.jobTitle&&(this.jobTitle=e.jobTitle),void 0!==e.organisationId&&(this.organisationId=e.organisationId),void 0!==e.siteId&&(this.siteId=e.siteId),void 0!==e.country&&(this.country=e.country),void 0!==e.timezone&&(this.timezone=e.timezone),void 0!==e.roles&&(this.roles=e.roles),void 0!==e.adminType&&(this.adminType=e.adminType),void 0!==e.isTerminated&&(this.isTerminated=e.isTerminated),void 0!==e.isInDefaultCompany&&(this.isInDefaultCompany=e.isInDefaultCompany),void 0!==e.lastAvatarUpdateDate&&(this.lastAvatarUpdateDate=e.lastAvatarUpdateDate),void 0!==e.isInitialized&&(this.initialized=e.isInitialized),void 0!==e.guestMode&&(this.guestMode=e.guestMode),void 0!==e.personalAudioRoomOpenInviteId&&(this.personalAudioRoomOpenInviteId=e.personalAudioRoomOpenInviteId,this.personalAudioRoomOpenInviteIdSubject.next(this.personalAudioRoomOpenInviteId)),void 0!==e.isTv&&(this.isTv=e.isTv),void 0!==e.tags&&(this.tags=e.tags),void 0!==e.department&&(this.department=e.department),void 0!==e.customData&&(this.customData=e.customData),void 0!==e.denySelfRegister&&(this.denySelfRegister=e.denySelfRegister),void 0!==e.userInfo1&&(this.userInfo1=e.userInfo1),void 0!==e.userInfo2&&(this.userInfo2=e.userInfo2),void 0!==e.jid_im&&(this.id=e.jid_im,this.jid=e.jid_im,this.jidtel=e.jid_tel),this.company&&this.company.id===e.companyId||(this.company=n.Company.create(e.companyId,e.companyName)),void 0!==e.fileSharingCustomisation&&(this._fileSharingEnabled="enabled"===e.fileSharingCustomisation),void 0!==e.fileStorageCustomisation&&(this.fileStorageEnabled="enabled"===e.fileStorageCustomisation),void 0!==e.userTitleNameCustomisation&&(this.userTitleNameEnabled="enabled"===e.userTitleNameCustomisation),void 0!==e.instantMessagesCustomisation&&(this._instantMessagesEnabled="enabled"===e.instantMessagesCustomisation),void 0!==e.overridePresenceCustomisation&&(this._changePresenceEnabled="enabled"===e.overridePresenceCustomisation),void 0!==e.phoneMeetingCustomisation&&(this.phoneMeetingsEnabled="enabled"===e.phoneMeetingCustomisation),void 0!==e.useChannelCustomisation&&(this._channelsEnabled="enabled"===e.useChannelCustomisation),void 0!==e.useRoomCustomisation&&(this._roomsEnabled="enabled"===e.useRoomCustomisation),void 0!==e.useWebRTCAudioCustomisation&&(this._webrtcAudioEnabled="enabled"===e.useWebRTCAudioCustomisation),void 0!==e.useWebRTCVideoCustomisation&&(this._webrtcVideoEnabled="enabled"===e.useWebRTCVideoCustomisation),void 0!==e.useScreenSharingCustomisation&&(this._webrtcSharingEnabled="enabled"===e.useScreenSharingCustomisation),void 0!==e.userProfileCustomisation&&(this._modifyProfileEnabled="enabled"===e.userProfileCustomisation),void 0!==e.useGifCustomisation&&(this.giphyEnabled="enabled"===e.useGifCustomisation),void 0!==e.changeTelephonyCustomisation&&(this.telephonySettingsEnabled="enabled"===e.changeTelephonyCustomisation),void 0!==e.recordingConversationCustomisation&&(this.recordConversationEnabled="enabled"===e.recordingConversationCustomisation),void 0!==e.changeSettingsCustomisation&&(this.changeSettingsEnabled="enabled"===e.changeSettingsCustomisation),void 0!==e.useDialOutCustomisation&&(this.useDialOutEnabled="enabled"===e.useDialOutCustomisation),void 0!==e.useSpeakingTimeStatistics&&(this.useSpeakingTimeStatistics="enabled"===e.useSpeakingTimeStatistics),void 0!==e.readReceiptsCustomisation&&(this.readReceiptsCustomisation="enabled"===e.readReceiptsCustomisation),void 0!==e.tryNewUiCustomisation&&(this.newUiEnabled="enabled"===e.tryNewUiCustomisation),void 0!==e.eLearningCustomisation&&(this.eLearningCustomisation="enabled"===e.eLearningCustomisation,this.eLearningCustomisation&&void 0!==e.eLearningGamificationCustomisation&&(this.eLearningGamificationCustomisation="enabled"===e.eLearningGamificationCustomisation)),this.attendantConsoleEnabled=config.attendantConsole||this.isAttendantConsole(),this.supervisorConsoleEnabled=(config.supervisorConsole||this.isSupervisor())&&"RVCP Subscriber"===this.systDeviceName,void 0!==e.isAlertNotificationEnabled&&(this.isAlertNotificationEnabled=e.isAlertNotificationEnabled),void 0!==e.forwards&&(this._forwards=e.forwards.map((e=>o.TelephonyForward.createForwardFromUserData(e)))),void 0!==e.personalRoutines&&(this._personalRoutines=e.personalRoutines.map((e=>s.PersonalRoutine.createRoutineFromData(e)))),void 0!==e.emails&&(this.emailPerso="",e.emails.forEach((e=>{switch(e.type){case"work":this.emailPro=e.email;break;case"home":this.emailPerso=e.email}}))),this.customData||(this.customData={}),void 0!==e.phoneNumbers&&(this.phonePro=this.phoneProCan="",this.phonePbx="",this.phoneInternalNumber="",this.pbxId="",this.mobilePro=this.mobileProCan="",this.phonePerso=this.phonePersoCan="",this.mobilePerso=this.mobilePersoCan="",this.voicemailNumber="",this.systemId="",this.phoneNumberId="",this.hasPhoneNumber=false,this.hasPhoneProDdiNumber=false,this.isCCDAgentEnabled=false,e.phoneNumbers.forEach((e=>{const t=e.number,i=e.numberE164,r=e.deviceType;switch(this.hasPhoneNumber=true,e.type){case"work":"landline"===r&&(e.isCloudPbxDDI?(this.phonePro=e.number,this.phoneProCan=e.numberE164,this.hasPhoneProDdiNumber=true):this.hasPhoneProDdiNumber||(this.phonePro=t,this.phoneProCan=i),e.isFromSystem&&(this.phonePbx=e.shortNumber,this.isCCDAgentEnabled="CCD agent"===e.userType,e.internalNumber&&(this.phoneInternalNumber=e.internalNumber,"Remote Extension"===e.deviceName||"Any Device"===e.deviceName||0===e.deviceName.search("UA VIRTUAL")?this.isVirtualTerm=true:this.isVirtualTerm=false),this.systDeviceName=e.deviceName?e.deviceName:null,this.pbxId=e.pbxId,this.voicemailNumber=e.voiceMailNumber,this.systemId=e.systemId,this.phoneNumberId=e.phoneNumberId,e.number&&(this.hasPhoneProDdiNumber=true))),"mobile"===r&&(this.mobilePro=t,this.isMobileProShared=e.isVisibleByOthers,this.mobileProCan=i);break;case"home":"landline"===r&&(this.phonePerso=t,this.isPhonePersoShared=e.isVisibleByOthers,this.phonePersoCan=i),"mobile"===r&&(this.mobilePerso=t,this.isMobilePersoShared=e.isVisibleByOthers,this.mobilePersoCan=i)}})),this.phoneNumbersInitialized=true),void 0!==e.outOfOffice&&(this.outOfOffice=e.outOfOffice),this.computeDisplayName()}containsEmail(e){const t=e.toLowerCase();return!(!this.loginEmail||this.loginEmail.toLowerCase()!==t)||(!(!this.emailPro||this.emailPro.toLowerCase()!==t)||!(!this.emailPerso||this.emailPerso.toLowerCase()!==t))}containsPhoneNumber(e){return!!e&&[this.phonePbx,this.phoneInternalNumber,this.phonePro,this.phoneProCan,this.mobilePro,this.mobileProCan,this.phonePerso,this.phonePersoCan,this.mobilePerso,this.mobilePersoCan].includes(e)}containsDirectoryPhoneNumber(e){if(!e)return false;const t=this.mobilePhones||[],i=this.businessPhones||[],r=this.otherPhoneNumbers||[];return!!t.includes(e)||(!!i.includes(e)||!!r.includes(e))}getGroups(){return this.groups}setGroups(e){this.groups=e}getPersonalAudioRoomOpenInviteId(){return this.personalAudioRoomOpenInviteId}setPersonalAudioRoomOpenInviteId(e){this.personalAudioRoomOpenInviteId=e,this.personalAudioRoomOpenInviteIdSubject.next(this.personalAudioRoomOpenInviteId)}set avatar(e){this._avatar=e}get avatar(){return this._avatar?this._avatar:this.avatarSrc?(this._avatar={src:this.avatarSrc},this.defaultAvatar=null,this.rxSubject.next({name:"avatar"}),this._avatar):this.defaultAvatar}getAvatarInBase64(){return new Promise((e=>{try{if(this.avatar&&this.avatar.src||e(void 0),this.avatar.src&&!this.avatar.src.startsWith("data:image/png")){const t=new Image,i=document.createElement("canvas");i.width=120,i.height=120;const r=i.getContext("2d");r.rect(0,0,120,120),r.fillStyle=this.color,r.fill(),t.onload=()=>{r.drawImage(t,0,0,120,120),e(i.toDataURL("image/png"))},t.src=this.avatar.src}else e(this.avatar.src)}catch(t){e(void 0)}}))}dateEncode(e){return Array.from(e).reduce(((e,t)=>e+=t.charCodeAt(0).toString(16)),"")}getAvatar(e=256,t=false){this.dbId&&this.lastAvatarUpdateDate&&(this.avatarSrc=`${this.avatarServerURL}/api/avatar/${this.dbId}?size=${e}&update=${this.dateEncode(this.lastAvatarUpdateDate)}`),this.createTextAvatarImage(),this.isTv&&(this.defaultAvatar={src:"/assets/skins/rainbow/images/misc/androidtv.svg"}),!t&&this.lastAvatarUpdateDate||(this.avatar=null)}createTextAvatarImage(){const e=new Image,t=document.createElement("canvas");t.width=e.width=225,t.height=e.height=225;const i=t.getContext("2d");i.rect(0,0,225,225),i.fillStyle=this.color,i.fill(),i.font="bold 100px Helvetica",i.textAlign="center",i.fillStyle="white",i.fillText(this.initials,110,150),e.src=t.toDataURL("image/png"),this.defaultAvatar=e}get displayName(){return this._displayName}set displayName(e){this._displayName=e,this.nameForLogs=config&&config.debug?e:e.charAt(0)+e.replace(/[^\s](?=.{1,}$)/g,"*").substr(1),this.name.value=e,this.rxSubject.next({name:"displayName"})}updateName(e,t){this.firstname=e,this.lastname=t,this.computeDisplayName(),this.getAvatar()}computeDisplayName(){const e=this.firstname?this.firstname.charAt(0).toUpperCase()+this.firstname.slice(1):null,t=this.lastname?this.lastname.charAt(0).toUpperCase()+this.lastname.slice(1):null,i=this.nickname?this.nickname.charAt(0).toUpperCase()+this.nickname.slice(1):null;this.isTv?(this.displayName=t,this.initials=this.displayName.charAt(0)):t||e||!this.personalDirectoryFlag&&!this.companyDirectoryFlag?t&&e?"FL"===this.displayOrder?(this.displayName=e+" "+t,this.displayShortName=e+" "+t.charAt(0),this.initials=e.charAt(0)+t.charAt(0)):(this.displayName=t+" "+e,this.displayShortName=t+" "+e.charAt(0),this.initials=t.charAt(0)+e.charAt(0)):t&&!e?(this.displayName=this.displayShortName=t,this.initials=t.charAt(0)):i?(this.displayName=i,this.displayShortName=i,this.initials=i.charAt(0)):this.loginEmail?(this.displayName=this.loginEmail,this.displayShortName=this.loginEmail,this.initials=this.loginEmail.substring(0,2).toUpperCase()):e?(this.displayName=e,this.initials=e.charAt(0)):(this.displayName="Anonymous",this.displayShortName="Anonymous",this.initials="A"):(this.displayName=this.companyName,this.initials=this.displayName.charAt(0));const r=this.displayName.toUpperCase();let n=0;for(let s=0;s<r.length;s++)n+=r.charCodeAt(s);this.colorIndex=n%12,this.color=a.textAvatarColor[this.colorIndex],this.colorName=a.textAvatarName[this.colorIndex]}isCPaaSGuest(){return this.roles.indexOf("guest")>=0}isGuest(){return this.guestMode}isAnonymousGuest(){return!this.isTv&&("A"===this.initials||"Anonymous"===this.displayName)}isBadGuest(){return this.displayName.startsWith("__guest__")||this.displayName.startsWith("__##__guest__##__")}isGuestInitialized(){return null!==this.firstname&&this.firstname.length>0&&null!==this.lastname&&this.lastname.length>0&&"__##__guest__##__"!==this.firstname}hasAdminRights(){return this.isSuperadmin()||this.isBusinessAdmin()||this.isCustomerSuccessAdmin()||this.isAdmin()||this.isBPAdmin()}isSuperadmin(){return this.roles.indexOf("superadmin")>=0}isBusinessAdmin(){return this.roles.indexOf("business_admin")>=0}isCustomerSuccessAdmin(){return this.roles.indexOf("customer_success_admin")>=0}isOrganizationAdmin(){return this.roles.indexOf("admin")>=0&&this.adminType===a.AdminType.ORGANIZATION_ADMIN}isCompanyAdmin(){return this.roles.indexOf("admin")>=0&&this.adminType===a.AdminType.COMPANY_ADMIN}isSiteAdmin(){return this.roles.indexOf("admin")>=0&&this.adminType===a.AdminType.SITE_ADMIN}isAdmin(){return this.roles.indexOf("admin")>=0&&(!this.isOrganizationAdmin()||!this.isBPAdmin())}isECAdmin(){return this.company&&!this.company.isBP&&this.isAdmin()}isBPAdmin(){return this.isBPAdminOperations()||this.isBPAdminFinance()}isBPAdminOperations(){return this.company&&this.company.isBP&&this.roles.indexOf("bp_admin")>=0}isBPAdminFinance(){return this.company&&this.company.isBP&&this.roles.indexOf("bp_finance")>=0}isBPAdminDR(){return this.isBPAdmin()&&this.company.isDR()}isBPAdminVAD(){return this.isBPAdmin()&&this.company.isVAD()}isBPAdminIR(){return this.isBPAdmin()&&this.company.isIR()}isDirectoryAdmin(){return this.roles.indexOf("directory_admin")>=0}isWebinarHost(){return this.roles.indexOf("webinar_host")>=0}isAttendantConsole(){return this.roles&&this.roles.indexOf("attendant")>=0}isSupervisor(){return this.roles&&this.roles.indexOf("supervisor")>=0}getAdminType(){return this.roles.indexOf("admin")>=0?this.adminType:a.AdminType.UNDEFINED}isVoiceSubscriber(){return"RVCP Subscriber"===this.systDeviceName}set fileSharingEnabled(e){this._fileSharingEnabled=e,this.rxSubject.next({name:"fileSharingEnabled"})}get fileSharingEnabled(){return this._fileSharingEnabled}set fileStorageEnabled(e){this._fileStorageEnabled=e,this.fileStorageEnabledSubject.next(this._fileStorageEnabled),this.rxSubject.next({name:"fileStorageEnabled"})}get fileStorageEnabled(){return this._fileStorageEnabled}set instantMessagesEnabled(e){this._instantMessagesEnabled=e,this.rxSubject.next({name:"instantMessagesEnabled"})}get instantMessagesEnabled(){return this._instantMessagesEnabled}set changePresenceEnabled(e){this._changePresenceEnabled=e,this.rxSubject.next({name:"changePresenceEnabled"})}get changePresenceEnabled(){return this._changePresenceEnabled}set phoneMeetingsEnabled(e){this._phoneMeetingsEnabled=e,this.phoneMeetingsEnabledSubject.next(this._phoneMeetingsEnabled),this.rxSubject.next({name:"phoneMeetingsEnabled"})}get phoneMeetingsEnabled(){return this._phoneMeetingsEnabled}set channelsEnabled(e){this._channelsEnabled=e,this.rxSubject.next({name:"channelsEnabled"})}get channelsEnabled(){return this._channelsEnabled}set roomsEnabled(e){this._roomsEnabled=e,this.rxSubject.next({name:"roomsEnabled"})}get roomsEnabled(){return this._roomsEnabled}set webrtcAudioEnabled(e){this._webrtcAudioEnabled=e,this.rxSubject.next({name:"webrtcAudioEnabled"})}get webrtcAudioEnabled(){return this._webrtcAudioEnabled}set webrtcVideoEnabled(e){this._webrtcVideoEnabled=e,this.rxSubject.next({name:"webrtcVideoEnabled"})}get webrtcVideoEnabled(){return this._webrtcVideoEnabled}set webrtcSharingEnabled(e){this._webrtcSharingEnabled=e,this.rxSubject.next({name:"webrtcSharingEnabled"})}get webrtcSharingEnabled(){return this._webrtcSharingEnabled}set modifyProfileEnabled(e){this._modifyProfileEnabled=e,this.rxSubject.next({name:"modifyProfileEnabled"})}get modifyProfileEnabled(){return this._modifyProfileEnabled}set useDialOutEnabled(e){this._useDialOutEnabled=e,this.rxSubject.next({name:"useDialOutEnabled"})}get useDialOutEnabled(){return this._useDialOutEnabled}set useSpeakingTimeStatistics(e){this._useSpeakingTimeStatistics=e,this.rxSubject.next({name:"useSpeakingTimeStatistics"})}get useSpeakingTimeStatistics(){return this._useSpeakingTimeStatistics}set readReceiptsCustomisation(e){this._readReceiptsCustomisation=e,this.rxSubject.next({name:"readReceiptsCustomisation"})}get readReceiptsCustomisation(){return this._readReceiptsCustomisation}set telCapabilities(e){this._telCapabilities=e,this.rxSubject.next({name:"telCapabilities"})}get telCapabilities(){return this._telCapabilities}set supervisionCapabilities(e){this._supervisionCapabilities=e,this.rxSubject.next({name:"supervisionCapabilities"})}get supervisionCapabilities(){return this._supervisionCapabilities}set supervisionState(e){this._supervisionState=e,this.rxSubject.next({name:"supervisionState"})}get supervisionState(){return this._supervisionState}set forwards(e){this._forwards=e,this.rxSubject.next({name:"forwards"})}get forwards(){return this._forwards}set personalRoutines(e){this._personalRoutines=e,this.rxSubject.next({name:"personalRoutines"})}get personalRoutines(){return this._personalRoutines}toString(){return this.nameForLogs}}a.AdminType={ORGANIZATION_ADMIN:"organization_admin",COMPANY_ADMIN:"company_admin",SITE_ADMIN:"site_admin",UNDEFINED:"undefined"},a.NameUpdatePrio={NO_UPDATE_PRIO:0,OUTLOOK_UPDATE_PRIO:1,SERVER_UPDATE_PRIO:2,MAX_UPDATE_PRIO:99},a.textAvatarColor=["#ca8741","#e44647","#c62582","#9b4ce7","#6573ee","#1b70e0","#6ec7d9","#98d1b1","#7fbd40","#b2d334","#dcd232","#f1be00"],a.textAvatarName=["purple-lavender","purple-violet","red-coral","blue-jeanlouisdavid","green-mint","green-yellow","orange-jade","pink-lady","yellow-submarine","blue-teal"],t.Contact=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{constructor(){this.body=void 0,this.date=void 0,this.isRoom=false,this.isSent=false,this.messageId=void 0,this.otherJid=null,this.historyIndex=null}static createSearchTextMsgResult(){return new r}}t.SearchTextMsgResult=r;t.SearchTextResult=class{constructor(e){this.room=null,this.contact=null,this.totalCount=0,this.convRes=[],this.otherJid=e}addMsgItem(e){this.convRes.push(e)}isRoom(){return this.conversation?null!==this.conversation.room:null!==this.room}};t.SearchTextConvResults=class{constructor(){this._searchedText=null,this.normalizedSearchText=null,this.queryIds=[],this.results=[],this.totalCount=0,this.currentMessageId=null,this.isSearching=false}get searchedText(){return this._searchedText}set searchedText(e){this._searchedText=e,this.normalizedSearchText=e?e.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,""):null}isEmpty(){return 0===this.queryIds.length||0===Object.keys(this.results).length}clearAll(){this.searchedText=null,this.queryIds=[],this.partResults=[],this.totalCount=0,this.currentMessageId=null,this.results.splice(0,this.results.length)}isCurrentQuery(e){return this.queryIds.indexOf(e)>-1}getResultByJid(e){return this.results.find((t=>t.otherJid===e))}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7),n=i(18);class s{constructor(e){this.contact=null,this.activeSpeaker=false,this.mute=false,this.onStage=false,this.sharingOnStage=false,this.searchString=null,this.role=null,this.raiseHand=false,this.allowedToTalk=false,this.invitedToTalk=false,this.audioVideoSession=null,this.originalAudioVideoStream=null,this.audioVideoStream=null,this.audioVideoSubStreamLevel=-1,this.audioVideoTemporalLevel=-1,this.audioVideoAudioElement=null,this.sharingSession=null,this.sharingStream=null,this.sharingAudioElement=null,this.medias={audio:false,video:false,sharing:false},this.rxSubject=new r.Subject,this.subStreamLevel=-1,this.temporalLevel=-1,this.id=e}static create(e){return new s(e)}}t.WebinarSessionParticipant=s;class o{constructor(){this.activeSpeakerId=null,this.localParticipant=null,this.speakerParticipants=[],this.attendeeParticipants=[],this.raiseHandAttendeeParticipants=[],this.masterMedia=null,this.showMySharing=true}static create(){return new o}getParticipantById(e){if(this.localParticipant&&this.localParticipant.id===e)return this.localParticipant;const t=this.speakerParticipants.find((t=>t.id===e));if(t)return t;const i=this.attendeeParticipants.find((t=>t.id===e));return i||null}addOrUpdateParticipant(e,t){if(this.localParticipant&&this.localParticipant.id===e.id)return this.localParticipant.mute=e.mute,void this.localParticipant.rxSubject.next(n.RBEvent.create("updateParticipant"));const i="attendee"===e.role?this.attendeeParticipants:this.speakerParticipants,r=i.findIndex((t=>t.id===e.id));if(-1!==r){const t=i[r];t.mute=e.mute,t.rxSubject.next(n.RBEvent.create("updateParticipant"))}else t&&"updateParticipant"===t||i.push(e)}removeParticipant(e){const t=this.speakerParticipants.findIndex((t=>t.id===e));-1!==t&&this.speakerParticipants.splice(t,1),this.localParticipant&&this.localParticipant.id===e&&(this.localParticipant=null)}}t.WebinarSession=o;class a{static create(){return new a}getData(){return JSON.stringify({email:this.email,userId:this.userId,lastName:this.lastName,firstName:this.firstName,company:this.company,jobTitle:this.jobTitle})}}t.WebinarParticipant=a;class c{constructor(){this.okCount=0,this.errorCount=0,this.errorReport=[]}static create(){return new c}}t.WebinarCSVStatus=c;class l{constructor(){this.id=null,this.name="",this.subject="",this.webinarStartDate=null,this.webinarEndDate=null,this.webinarDuration=null,this.waitingRoomStartDate=null,this.timeZone=null,this.roomId=null,this.roomModeratorsChatId=null,this.room=null,this.practiceRoom=null,this.organizers=[],this.speakers=[],this.participants=[],this.profileId=null,this.pendingParticipantNumber=0,this.acceptedParticipantNumber=0,this.rejectedParticipantNumber=0,this.color="",this.creatorId=null,this.creatorCompanyId=null,this.isCreator=false,this.isOrganizer=false,this.isSpeaker=false,this.isAttendee=true,this.isGuestAttendee=true,this.password=null,this.approvalRegistrationMethod="automatic",this.registrationUuid=null,this.published=false,this.moderatorsNotified=false,this.status="upcoming",this.webinarUrl=null,this.rxSubject=new r.Subject,this.rxAskStagingSubject=new r.Subject,this.rxParticipantsSubject=new r.Subject,this.rxInfoSubject=new r.Subject,this.isWebinarSync=true,this.session=null,this.waitingRoomMultimediaURLs=[],this.stageBackground="hop",this.reminderDates=[],this.subtitlesEnable=false,this.blur=false,this.bgReplaceUrl=null,this.chatOption="participant",this.chatOptionExpired=false,this.chatOptionTimer=null,this.isRecorded=false,this.hideRecordInfo=false,this.action=null}static create(){return new l}static createFromData(e){const t=new l;return l.updateFromData(t,e),t}static updateFromData(e,t){if(t.name&&(e.name=t.name),(t.subject||""===t.subject)&&(e.subject=t.subject),t.organizers&&(e.organizers=t.organizers),t.speakers&&(e.speakers=t.speakers),t.creatorId&&(e.creatorId=t.creatorId),t.creatorCompanyId&&(e.creatorCompanyId=t.creatorCompanyId),t.password&&(e.password=t.password),t.approvalRegistrationMethod&&(e.approvalRegistrationMethod=t.approvalRegistrationMethod),t.registrationUuid&&(e.registrationUuid=t.registrationUuid),t.waitingRoomMultimediaURL&&(e.waitingRoomMultimediaURLs=t.waitingRoomMultimediaURL),t.stageBackground&&(e.stageBackground=t.stageBackground),t.timeZone&&(e.timeZone=t.timeZone),t.id&&(e.id=t.id),t.webinarStartDate&&(e.webinarStartDate=t.webinarStartDate),t.webinarEndDate&&(e.webinarEndDate=t.webinarEndDate),t.waitingRoomStartDate&&(e.waitingRoomStartDate=t.waitingRoomStartDate),t.roomId&&(e.roomId=t.roomId),t.roomModeratorsChatId&&(e.roomModeratorsChatId=t.roomModeratorsChatId),t.participants&&(e.participants=t.participants),t.emailNotification&&(e.published=t.emailNotification),t.moderatorsSelectedAnNotified&&(e.moderatorsNotified=t.moderatorsSelectedAnNotified),t.reminderDates&&(e.reminderDates=t.reminderDates),t.profileId&&(e.profileId=t.profileId),t.chatOption&&(e.chatOption=t.chatOption),t.recording&&(e.isRecorded=t.recording),t.isActive&&(e.status="inProgress"),void 0!==t.state)switch(t.state){case"webinar":e.status="inProgress";break;case"waitingRoom":e.status="waitingRoom";break;case"practiceWaitingRoom":e.status="practiceWaitingRoom";break;case"terminated":e.status="terminated";break;default:e.status="upcoming"}return e.organizers.forEach((e=>{e.role="organizer"})),e.speakers.forEach((e=>{e.role="speaker"})),t.guestSpeakers&&t.guestSpeakers.forEach((t=>{e.speakers.push({status:"invited",email:t.email,role:"speaker"})})),e.pendingParticipantNumber=0,e.acceptedParticipantNumber=0,e.rejectedParticipantNumber=0,e.participants.forEach((t=>{switch(t.state){case"pending":e.pendingParticipantNumber++;break;case"approved":e.acceptedParticipantNumber++;break;case"rejected":e.rejectedParticipantNumber++}})),e.name.length&&(e.color=l.computeWebinarColor(e.name)),e.webinarUrl=`${config.webservices.protocol}://webinar.${config.webservices.server.replace(".red",".com")}/${e.registrationUuid}`,-1!==window.location.origin.indexOf("localhost")&&(e.webinarUrl="localhost:8000/#/webinar/"+e.registrationUuid),-1!==window.location.origin.indexOf("demo")&&(e.webinarUrl="https://web-demo.openrainbow.org/#/webinar/"+e.registrationUuid),config.enableAioUrlMode&&(e.webinarUrl=`${config.webservices.protocol}://${config.webservices.server.replace(".red",".com")}/#/webinar/${e.registrationUuid}`),e}static computeWebinarColor(e){const t=e.toUpperCase();let i=0;for(let r=0;r<t.length;r++)i+=t.charCodeAt(r);return["#d3a575","#eb8d8d","#d47ab0","#b38deb","#9aa3ed","#76a6e5","#92d0de","#a7d6bc","#99c86b","#b4d43d","#dcd33b","#eec838"][i%12]}subscribe(e){return this.rxSubject.subscribe(e)}getData(){const e={isOrganizer:true,passwordNeeded:false,recording:this.isRecorded};return this.name&&void 0!==this.name&&(e.name=this.name),null!==this.subject&&void 0!==this.subject&&(e.subject=this.subject),this.webinarStartDate&&void 0!==this.webinarStartDate&&(e.webinarStartDate=this.webinarStartDate),this.webinarEndDate&&void 0!==this.webinarEndDate&&(e.webinarEndDate=this.webinarEndDate),this.waitingRoomStartDate&&void 0!==this.waitingRoomStartDate&&(e.waitingRoomStartDate=this.waitingRoomStartDate),this.timeZone&&void 0!==this.timeZone&&(e.timeZone=this.timeZone),this.approvalRegistrationMethod&&void 0!==this.approvalRegistrationMethod&&(e.approvalRegistrationMethod=this.approvalRegistrationMethod),this.waitingRoomMultimediaURLs&&void 0!==this.waitingRoomMultimediaURLs&&(e.waitingRoomMultimediaURL=this.waitingRoomMultimediaURLs),this.stageBackground&&void 0!==this.stageBackground&&(e.stageBackground=this.stageBackground),this.reminderDates&&this.reminderDates.length>0&&(e.reminderDates=this.reminderDates),this.profileId&&void 0!==this.profileId&&(e.profileId=this.profileId),this.chatOption&&void 0!==this.chatOption&&(e.chatOption=this.chatOption),JSON.stringify(e)}updateRaiseHandParticipants(){this.session&&(this.session.raiseHandAttendeeParticipants=this.session.attendeeParticipants.filter((e=>e.raiseHand)))}getTagInfo(){switch(this.status){case"waitingRoom":return this.isAttendee?{label:"webinarWaitingRoom",class:"waitingRoom"}:this.session?{label:"webinarPractice",class:"practice"}:null;case"practiceWaitingRoom":return this.isAttendee?{label:"webinarWaitingRoom",class:"waitingRoom"}:{label:"webinarPractice",class:"practice"};case"upcoming":return this.session?{label:this.isAttendee?"webinarWaitingRoom":"webinarPractice",class:this.isAttendee?"waitingRoom":"practice"}:null;case"inProgress":return{label:"webinarLive",class:"live"};case"terminated":return this.isRecorded?{label:"webinarRecorded",class:"recorded"}:{label:"webinarTerminated",class:"terminated"};default:return null}}}t.Webinar=l},function(e,t,i){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:true}),t.defaultHostConfig=t.HostConfig=t.FontTypeSet=t.FontTypeDefinition=t.ContainerStyleSet=t.ContainerStyleDefinition=t.ColorSetDefinition=t.ActionsConfig=t.ShowCardActionConfig=t.FactSetConfig=t.FactTitleDefinition=t.FactTextDefinition=t.InputConfig=t.InputLabelConfig=t.RequiredInputLabelTextDefinition=t.TextBlockConfig=t.TextStyleSet=t.TextStyleDefinition=t.BaseTextDefinition=t.TableConfig=t.MediaConfig=t.ImageSetConfig=t.AdaptiveCardConfig=t.TextColorDefinition=t.ColorDefinition=void 0;var s=i(55),o=i(68),a=i(61),c=i(143);function l(e,t,i){if("string"==typeof t){var r=o.parseEnum(e,t,i);return void 0!==r?r:i}return"number"==typeof t?t:i}var d=function(){function e(e,t){this.default="#000000",this.subtle="#666666",e&&(this.default=e),t&&(this.subtle=t)}return e.prototype.parse=function(e){e&&(this.default=e.default||this.default,this.subtle=e.subtle||this.subtle)},e}();t.ColorDefinition=d;var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.highlightColors=new d("#22000000","#11000000"),t}return n(t,e),t.prototype.parse=function(t){e.prototype.parse.call(this,t),t&&this.highlightColors.parse(t.highlightColors)},t}(d);t.TextColorDefinition=u;var h=function(e){this.allowCustomStyle=false,e&&(this.allowCustomStyle=e.allowCustomStyle||this.allowCustomStyle)};t.AdaptiveCardConfig=h;var f=function(){function e(e){this.imageSize=s.Size.Medium,this.maxImageHeight=100,e&&(this.imageSize=null!=e.imageSize?e.imageSize:this.imageSize,this.maxImageHeight=o.parseNumber(e.maxImageHeight,100))}return e.prototype.toJSON=function(){return{imageSize:s.Size[this.imageSize],maxImageHeight:this.maxImageHeight}},e}();t.ImageSetConfig=f;var p=function(){function e(e){this.allowInlinePlayback=true,e&&(this.defaultPoster=e.defaultPoster,this.allowInlinePlayback=e.allowInlinePlayback||this.allowInlinePlayback)}return e.prototype.toJSON=function(){return{defaultPoster:this.defaultPoster,allowInlinePlayback:this.allowInlinePlayback}},e}();t.MediaConfig=p;var g=function(){function e(e){this.cellSpacing=8,e&&(this.cellSpacing=e.cellSpacing&&"number"==typeof e.cellSpacing?e.cellSpacing:this.cellSpacing)}return e.prototype.toJSON=function(){return{cellSpacing:this.cellSpacing}},e}();t.TableConfig=g;var m=function(){function e(e){this.size=s.TextSize.Default,this.color=s.TextColor.Default,this.isSubtle=false,this.weight=s.TextWeight.Default,this.parse(e)}return e.prototype.parse=function(e){e&&(this.size=l(s.TextSize,e.size,this.size),this.color=l(s.TextColor,e.color,this.color),this.isSubtle=void 0!==e.isSubtle&&"boolean"==typeof e.isSubtle?e.isSubtle:this.isSubtle,this.weight=l(s.TextWeight,e.weight,this.getDefaultWeight()))},e.prototype.getDefaultWeight=function(){return s.TextWeight.Default},e.prototype.toJSON=function(){return{size:s.TextSize[this.size],color:s.TextColor[this.color],isSubtle:this.isSubtle,weight:s.TextWeight[this.weight]}},e}();t.BaseTextDefinition=m;var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fontType=s.FontType.Default,t}return n(t,e),t.prototype.parse=function(t){e.prototype.parse.call(this,t),t&&(this.fontType=l(s.FontType,t.fontType,this.fontType))},t}(m);t.TextStyleDefinition=v;var S=function(){function e(e){this.default=new v,this.heading=new v({size:"Large",weight:"Bolder"}),this.columnHeader=new v({weight:"Bolder"}),e&&(this.heading.parse(e.heading),this.columnHeader.parse(e.columnHeader))}return e.prototype.getStyleByName=function(e){switch(e.toLowerCase()){case"heading":return this.heading;case"columnHeader":return this.columnHeader;default:return this.default}},e}();t.TextStyleSet=S;var b=function(e){e&&(this.headingLevel=o.parseNumber(e.headingLevel))};t.TextBlockConfig=b;var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.suffix=" *",t.suffixColor=s.TextColor.Attention,t}return n(t,e),t.prototype.parse=function(t){e.prototype.parse.call(this,t),t&&(this.suffix=t.suffix||this.suffix,this.suffixColor=l(s.TextColor,t.suffixColor,this.suffixColor))},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.suffix=this.suffix,t.suffixColor=s.TextColor[this.suffixColor],t},t}(m);t.RequiredInputLabelTextDefinition=y;var C=function(e){this.inputSpacing=s.Spacing.Small,this.requiredInputs=new y,this.optionalInputs=new m,e&&(this.inputSpacing=l(s.Spacing,e.inputSpacing,this.inputSpacing),this.requiredInputs=new y(e.requiredInputs),this.optionalInputs=new m(e.optionalInputs))};t.InputLabelConfig=C;var w=function(e){this.label=new C,this.errorMessage=new m({color:s.TextColor.Attention}),e&&(this.label=new C(e.label),this.errorMessage=new m(e.errorMessage))};t.InputConfig=w;var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.wrap=true,t}return n(t,e),t.prototype.parse=function(t){e.prototype.parse.call(this,t),t&&(this.wrap=null!=t.wrap?t.wrap:this.wrap)},t.prototype.toJSON=function(){var t=e.prototype.toJSON.call(this);return t.wrap=this.wrap,t},t}(m);t.FactTextDefinition=_;var E=function(e){function t(t){var i=e.call(this,t)||this;return i.maxWidth=150,i.weight=s.TextWeight.Bolder,t&&(i.maxWidth=null!=t.maxWidth?t.maxWidth:i.maxWidth,i.weight=l(s.TextWeight,t.weight,s.TextWeight.Bolder)),i}return n(t,e),t.prototype.getDefaultWeight=function(){return s.TextWeight.Bolder},t}(_);t.FactTitleDefinition=E;var T=function(e){this.title=new E,this.value=new _,this.spacing=10,e&&(this.title=new E(e.title),this.value=new _(e.value),this.spacing=e.spacing&&null!=e.spacing?e.spacing&&e.spacing:this.spacing)};t.FactSetConfig=T;var I=function(){function e(e){this.actionMode=s.ShowCardActionMode.Inline,this.inlineTopMargin=16,this.style=s.ContainerStyle.Emphasis,e&&(this.actionMode=l(s.ShowCardActionMode,e.actionMode,s.ShowCardActionMode.Inline),this.inlineTopMargin=null!=e.inlineTopMargin?e.inlineTopMargin:this.inlineTopMargin,this.style=e.style&&"string"==typeof e.style?e.style:s.ContainerStyle.Emphasis)}return e.prototype.toJSON=function(){return{actionMode:s.ShowCardActionMode[this.actionMode],inlineTopMargin:this.inlineTopMargin,style:this.style}},e}();t.ShowCardActionConfig=I;var P=function(){function e(e){if(this.maxActions=5,this.spacing=s.Spacing.Default,this.buttonSpacing=20,this.showCard=new I,this.preExpandSingleShowCardAction=false,this.actionsOrientation=s.Orientation.Horizontal,this.actionAlignment=s.ActionAlignment.Left,this.iconPlacement=s.ActionIconPlacement.LeftOfTitle,this.allowTitleToWrap=false,this.iconSize=16,e){this.maxActions=null!=e.maxActions?e.maxActions:this.maxActions,this.spacing=l(s.Spacing,e.spacing&&e.spacing,s.Spacing.Default),this.buttonSpacing=null!=e.buttonSpacing?e.buttonSpacing:this.buttonSpacing,this.showCard=new I(e.showCard),this.preExpandSingleShowCardAction=o.parseBool(e.preExpandSingleShowCardAction,false),this.actionsOrientation=l(s.Orientation,e.actionsOrientation,s.Orientation.Horizontal),this.actionAlignment=l(s.ActionAlignment,e.actionAlignment,s.ActionAlignment.Left),this.iconPlacement=l(s.ActionIconPlacement,e.iconPlacement,s.ActionIconPlacement.LeftOfTitle),this.allowTitleToWrap=null!=e.allowTitleToWrap?e.allowTitleToWrap:this.allowTitleToWrap;try{var t=a.SizeAndUnit.parse(e.iconSize);t.unit==s.SizeUnit.Pixel&&(this.iconSize=t.physicalSize)}catch(i){}}}return e.prototype.toJSON=function(){return{maxActions:this.maxActions,spacing:s.Spacing[this.spacing],buttonSpacing:this.buttonSpacing,showCard:this.showCard,preExpandSingleShowCardAction:this.preExpandSingleShowCardAction,actionsOrientation:s.Orientation[this.actionsOrientation],actionAlignment:s.ActionAlignment[this.actionAlignment]}},e}();t.ActionsConfig=P;var A=function(){function e(e){this.default=new u,this.dark=new u,this.light=new u,this.accent=new u,this.good=new u,this.warning=new u,this.attention=new u,this.parse(e)}return e.prototype.parseSingleColor=function(e,t){e&&this[t].parse(e[t])},e.prototype.parse=function(e){e&&(this.parseSingleColor(e,"default"),this.parseSingleColor(e,"dark"),this.parseSingleColor(e,"light"),this.parseSingleColor(e,"accent"),this.parseSingleColor(e,"good"),this.parseSingleColor(e,"warning"),this.parseSingleColor(e,"attention"))},e}();t.ColorSetDefinition=A;var M=function(){function e(e){this.foregroundColors=new A({default:{default:"#333333",subtle:"#EE333333"},dark:{default:"#000000",subtle:"#66000000"},light:{default:"#FFFFFF",subtle:"#33000000"},accent:{default:"#2E89FC",subtle:"#882E89FC"},good:{default:"#028A02",subtle:"#DD027502"},warning:{default:"#E69500",subtle:"#DDE69500"},attention:{default:"#CC3300",subtle:"#DDCC3300"}}),this.parse(e)}return e.prototype.parse=function(e){e&&(this.backgroundColor=e.backgroundColor,this.foregroundColors.parse(e.foregroundColors),this.highlightBackgroundColor=e.highlightBackgroundColor,this.highlightForegroundColor=e.highlightForegroundColor,this.borderColor=e.borderColor)},Object.defineProperty(e.prototype,"isBuiltIn",{get:function(){return false},enumerable:false,configurable:true}),e}();t.ContainerStyleDefinition=M;var D=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),Object.defineProperty(t.prototype,"isBuiltIn",{get:function(){return true},enumerable:false,configurable:true}),t}(M),R=function(){function e(e){if(this._allStyles={},this._allStyles[s.ContainerStyle.Default]=new D,this._allStyles[s.ContainerStyle.Emphasis]=new D,this._allStyles[s.ContainerStyle.Accent]=new D,this._allStyles[s.ContainerStyle.Good]=new D,this._allStyles[s.ContainerStyle.Attention]=new D,this._allStyles[s.ContainerStyle.Warning]=new D,e){this._allStyles[s.ContainerStyle.Default].parse(e[s.ContainerStyle.Default]),this._allStyles[s.ContainerStyle.Emphasis].parse(e[s.ContainerStyle.Emphasis]),this._allStyles[s.ContainerStyle.Accent].parse(e[s.ContainerStyle.Accent]),this._allStyles[s.ContainerStyle.Good].parse(e[s.ContainerStyle.Good]),this._allStyles[s.ContainerStyle.Attention].parse(e[s.ContainerStyle.Attention]),this._allStyles[s.ContainerStyle.Warning].parse(e[s.ContainerStyle.Warning]);var t=e.customStyles;if(t&&Array.isArray(t))for(var i=0,r=t;i<r.length;i++){var n=r[i];if(n){var o=n.name;o&&"string"==typeof o&&(this._allStyles.hasOwnProperty(o)?this._allStyles[o].parse(n.style):this._allStyles[o]=new M(n.style))}}}}return e.prototype.toJSON=function(){var e=this,t=[];Object.keys(this._allStyles).forEach((function(i){e._allStyles[i].isBuiltIn||t.push({name:i,style:e._allStyles[i]})}));var i={default:this.default,emphasis:this.emphasis};return t.length>0&&(i.customStyles=t),i},e.prototype.getStyleByName=function(e,t){return e&&this._allStyles.hasOwnProperty(e)?this._allStyles[e]:t||this._allStyles[s.ContainerStyle.Default]},Object.defineProperty(e.prototype,"default",{get:function(){return this._allStyles[s.ContainerStyle.Default]},enumerable:false,configurable:true}),Object.defineProperty(e.prototype,"emphasis",{get:function(){return this._allStyles[s.ContainerStyle.Emphasis]},enumerable:false,configurable:true}),e}();t.ContainerStyleSet=R;var O=function(){function e(e){this.fontFamily="Segoe UI,Segoe,Segoe WP,Helvetica Neue,Helvetica,sans-serif",this.fontSizes={small:12,default:14,medium:17,large:21,extraLarge:26},this.fontWeights={lighter:200,default:400,bolder:600},e&&(this.fontFamily=e)}return e.prototype.parse=function(e){this.fontFamily=e.fontFamily||this.fontFamily,this.fontSizes={small:e.fontSizes&&e.fontSizes.small||this.fontSizes.small,default:e.fontSizes&&e.fontSizes.default||this.fontSizes.default,medium:e.fontSizes&&e.fontSizes.medium||this.fontSizes.medium,large:e.fontSizes&&e.fontSizes.large||this.fontSizes.large,extraLarge:e.fontSizes&&e.fontSizes.extraLarge||this.fontSizes.extraLarge},this.fontWeights={lighter:e.fontWeights&&e.fontWeights.lighter||this.fontWeights.lighter,default:e.fontWeights&&e.fontWeights.default||this.fontWeights.default,bolder:e.fontWeights&&e.fontWeights.bolder||this.fontWeights.bolder}},e.monospace=new e("'Courier New', Courier, monospace"),e}();t.FontTypeDefinition=O;var N=function(){function e(e){this.default=new O,this.monospace=new O("'Courier New', Courier, monospace"),e&&(this.default.parse(e.default),this.monospace.parse(e.monospace))}return e.prototype.getStyleDefinition=function(e){switch(e){case s.FontType.Monospace:return this.monospace;case s.FontType.Default:default:return this.default}},e}();t.FontTypeSet=N;var x=function(){function e(e){this.hostCapabilities=new c.HostCapabilities,this.choiceSetInputValueSeparator=",",this.supportsInteractivity=true,this.spacing={small:3,default:8,medium:20,large:30,extraLarge:40,padding:15},this.separator={lineThickness:1,lineColor:"#EEEEEE"},this.imageSizes={small:40,medium:80,large:160},this.containerStyles=new R,this.inputs=new w,this.actions=new P,this.adaptiveCard=new h,this.imageSet=new f,this.media=new p,this.factSet=new T,this.table=new g,this.textStyles=new S,this.textBlock=new b,this.alwaysAllowBleed=false,e&&(("string"==typeof e||e instanceof String)&&(e=JSON.parse(e)),this.choiceSetInputValueSeparator=e&&"string"==typeof e.choiceSetInputValueSeparator?e.choiceSetInputValueSeparator:this.choiceSetInputValueSeparator,this.supportsInteractivity=e&&"boolean"==typeof e.supportsInteractivity?e.supportsInteractivity:this.supportsInteractivity,this._legacyFontType=new O,this._legacyFontType.parse(e),e.fontTypes&&(this.fontTypes=new N(e.fontTypes)),e.lineHeights&&(this.lineHeights={small:e.lineHeights.small,default:e.lineHeights.default,medium:e.lineHeights.medium,large:e.lineHeights.large,extraLarge:e.lineHeights.extraLarge}),this.imageSizes={small:e.imageSizes&&e.imageSizes.small||this.imageSizes.small,medium:e.imageSizes&&e.imageSizes.medium||this.imageSizes.medium,large:e.imageSizes&&e.imageSizes.large||this.imageSizes.large},this.containerStyles=new R(e.containerStyles),this.spacing={small:e.spacing&&e.spacing.small||this.spacing.small,default:e.spacing&&e.spacing.default||this.spacing.default,medium:e.spacing&&e.spacing.medium||this.spacing.medium,large:e.spacing&&e.spacing.large||this.spacing.large,extraLarge:e.spacing&&e.spacing.extraLarge||this.spacing.extraLarge,padding:e.spacing&&e.spacing.padding||this.spacing.padding},this.separator={lineThickness:e.separator&&e.separator.lineThickness||this.separator.lineThickness,lineColor:e.separator&&e.separator.lineColor||this.separator.lineColor},this.inputs=new w(e.inputs||this.inputs),this.actions=new P(e.actions||this.actions),this.adaptiveCard=new h(e.adaptiveCard||this.adaptiveCard),this.imageSet=new f(e.imageSet),this.factSet=new T(e.factSet),this.textStyles=new S(e.textStyles),this.textBlock=new b(e.textBlock))}return e.prototype.getFontTypeDefinition=function(e){return this.fontTypes?this.fontTypes.getStyleDefinition(e):e==s.FontType.Monospace?O.monospace:this._legacyFontType},e.prototype.getEffectiveSpacing=function(e){switch(e){case s.Spacing.Small:return this.spacing.small;case s.Spacing.Default:return this.spacing.default;case s.Spacing.Medium:return this.spacing.medium;case s.Spacing.Large:return this.spacing.large;case s.Spacing.ExtraLarge:return this.spacing.extraLarge;case s.Spacing.Padding:return this.spacing.padding;default:return 0}},e.prototype.paddingDefinitionToSpacingDefinition=function(e){return new a.SpacingDefinition(this.getEffectiveSpacing(e.top),this.getEffectiveSpacing(e.right),this.getEffectiveSpacing(e.bottom),this.getEffectiveSpacing(e.left))},e.prototype.makeCssClassNames=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var i=[],r=0,n=e;r<n.length;r++){var s=n[r];i.push((this.cssClassNamePrefix?this.cssClassNamePrefix+"-":"")+s)}return i},e.prototype.makeCssClassName=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=this.makeCssClassNames.apply(this,e).join(" ");return i||""},Object.defineProperty(e.prototype,"fontFamily",{get:function(){return this._legacyFontType.fontFamily},set:function(e){this._legacyFontType.fontFamily=e},enumerable:false,configurable:true}),Object.defineProperty(e.prototype,"fontSizes",{get:function(){return this._legacyFontType.fontSizes},enumerable:false,configurable:true}),Object.defineProperty(e.prototype,"fontWeights",{get:function(){return this._legacyFontType.fontWeights},enumerable:false,configurable:true}),e}();t.HostConfig=x,t.defaultHostConfig=new x({supportsInteractivity:true,spacing:{small:10,default:20,medium:30,large:40,extraLarge:50,padding:20},separator:{lineThickness:1,lineColor:"#EEEEEE"},fontTypes:{default:{fontFamily:"'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",fontSizes:{small:12,default:14,medium:17,large:21,extraLarge:26},fontWeights:{lighter:200,default:400,bolder:600}},monospace:{fontFamily:"'Courier New', Courier, monospace",fontSizes:{small:12,default:14,medium:17,large:21,extraLarge:26},fontWeights:{lighter:200,default:400,bolder:600}}},imageSizes:{small:40,medium:80,large:160},containerStyles:{default:{backgroundColor:"#FFFFFF",foregroundColors:{default:{default:"#333333",subtle:"#EE333333"},dark:{default:"#000000",subtle:"#66000000"},light:{default:"#FFFFFF",subtle:"#33000000"},accent:{default:"#2E89FC",subtle:"#882E89FC"},attention:{default:"#cc3300",subtle:"#DDcc3300"},good:{default:"#028A02",subtle:"#DD027502"},warning:{default:"#e69500",subtle:"#DDe69500"}}},emphasis:{backgroundColor:"#08000000",foregroundColors:{default:{default:"#333333",subtle:"#EE333333"},dark:{default:"#000000",subtle:"#66000000"},light:{default:"#FFFFFF",subtle:"#33000000"},accent:{default:"#2E89FC",subtle:"#882E89FC"},attention:{default:"#cc3300",subtle:"#DDcc3300"},good:{default:"#028A02",subtle:"#DD027502"},warning:{default:"#e69500",subtle:"#DDe69500"}}},accent:{backgroundColor:"#C7DEF9",foregroundColors:{default:{default:"#333333",subtle:"#EE333333"},dark:{default:"#000000",subtle:"#66000000"},light:{default:"#FFFFFF",subtle:"#33000000"},accent:{default:"#2E89FC",subtle:"#882E89FC"},attention:{default:"#cc3300",subtle:"#DDcc3300"},good:{default:"#028A02",subtle:"#DD027502"},warning:{default:"#e69500",subtle:"#DDe69500"}}},good:{backgroundColor:"#CCFFCC",foregroundColors:{default:{default:"#333333",subtle:"#EE333333"},dark:{default:"#000000",subtle:"#66000000"},light:{default:"#FFFFFF",subtle:"#33000000"},accent:{default:"#2E89FC",subtle:"#882E89FC"},attention:{default:"#cc3300",subtle:"#DDcc3300"},good:{default:"#028A02",subtle:"#DD027502"},warning:{default:"#e69500",subtle:"#DDe69500"}}},attention:{backgroundColor:"#FFC5B2",foregroundColors:{default:{default:"#333333",subtle:"#EE333333"},dark:{default:"#000000",subtle:"#66000000"},light:{default:"#FFFFFF",subtle:"#33000000"},accent:{default:"#2E89FC",subtle:"#882E89FC"},attention:{default:"#cc3300",subtle:"#DDcc3300"},good:{default:"#028A02",subtle:"#DD027502"},warning:{default:"#e69500",subtle:"#DDe69500"}}},warning:{backgroundColor:"#FFE2B2",foregroundColors:{default:{default:"#333333",subtle:"#EE333333"},dark:{default:"#000000",subtle:"#66000000"},light:{default:"#FFFFFF",subtle:"#33000000"},accent:{default:"#2E89FC",subtle:"#882E89FC"},attention:{default:"#cc3300",subtle:"#DDcc3300"},good:{default:"#028A02",subtle:"#DD027502"},warning:{default:"#e69500",subtle:"#DDe69500"}}}},inputs:{label:{requiredInputs:{color:s.TextColor.Accent,size:s.TextSize.ExtraLarge,weight:s.TextWeight.Bolder,isSubtle:true,suffix:" (required)",suffixColor:s.TextColor.Good},optionalInputs:{color:s.TextColor.Warning,size:s.TextSize.Medium,weight:s.TextWeight.Lighter,isSubtle:false}},errorMessage:{color:s.TextColor.Accent,size:s.TextSize.Small,weight:s.TextWeight.Bolder}},actions:{maxActions:5,spacing:s.Spacing.Default,buttonSpacing:10,showCard:{actionMode:s.ShowCardActionMode.Inline,inlineTopMargin:16},actionsOrientation:s.Orientation.Horizontal,actionAlignment:s.ActionAlignment.Left},adaptiveCard:{allowCustomStyle:false},imageSet:{imageSize:s.Size.Medium,maxImageHeight:100},factSet:{title:{color:s.TextColor.Default,size:s.TextSize.Default,isSubtle:false,weight:s.TextWeight.Bolder,wrap:true,maxWidth:150},value:{color:s.TextColor.Default,size:s.TextSize.Default,isSubtle:false,weight:s.TextWeight.Default,wrap:true},spacing:10}})},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.utilitiesService||(e.rainbow.utilitiesService=new r),e.rainbow.utilitiesService}constructor(){this.rtlDirCheck=new RegExp("^[^---]*?[---]"),this.usableRandomChars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"}emojiShortnameToImage(e,t=true){let i=this.unescapeQuotes(e),r="";if(t){const e=/((ftp|https?):\/\/|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,{}<>]/,t=config.webappMeetUrl,n=/^mailto:/;let s=null;for(;s=i.match(e);){let e=s[0];s[2]===s[3]&&(e="mailto:"+e);const o=emojione.shortnameToImage(i.substr(0,s.index));t&&e.match(t)?r+=`${o}<span class="publiclink" >${s[0].replace(n,"")}</span>`:r+=`${o}<a target="_blank" href="${e}">${s[0].replace(n,"")}</a>`,i=i.substring(s.index+s[0].length)}}return r+=emojione.unicodeToImage(i),r}unescapeQuotes(e){const t={"&quot;":'"',"&#34;":'"',"&#x22;":'"',"&apos;":"'","&#39;":"'","&#x27;":"'"};return e.replace(/&(?:apos|#39|#x27|quot|#34|#x22);/gi,(e=>t[e]))}async asyncForEach(e,t){for(let i=0;i<e.length;i++)await t(e[i],i,e)}isRTL(e){return this.rtlDirCheck.test(e.charAt(0))}randomString(e=10){let t,i="";for(;e>0;)t=Math.floor(Math.random()*this.usableRandomChars.length),i+=this.usableRandomChars.charAt(t),e--;return i}extractBrowserVersion(e,t,i){const r=e.match(t);return r&&r.length>=i&&parseInt(r[i],10)}addUrlParameter(e,t){return e.includes("?")?e+="&":e+="?",e+=t}isNumeric(e){return"string"==typeof e&&!isNaN(parseFloat(e))}asyncTimeout(e){return new Promise((t=>setTimeout(t,e)))}}t.UtilitiesService=r},function(e,t,i){i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return d}));var r=i(0),n=i(12),s=i(5),o=i(2),a=i(10),c=i(81),l=function(e){function t(t,i){var r=e.call(this)||this;return r.source=t,r.subjectFactory=i,r._refCount=0,r._isComplete=false,r}return r.a(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=false,(e=this._connection=new a.a).add(this.source.subscribe(new u(this.getSubject(),this))),e.closed&&(this._connection=null,e=a.a.EMPTY)),e},t.prototype.refCount=function(){return Object(c.a)()(this)},t}(s.a),d=function(){var e=l.prototype;return{operator:{value:null},_refCount:{value:0,writable:true},_subject:{value:null,writable:true},_connection:{value:null,writable:true},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:true},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}}(),u=function(e){function t(t,i){var r=e.call(this,t)||this;return r.connectable=i,r}return r.a(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=true,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(n.b);o.a},function(e,t,i){i.d(t,"b",(function(){return o})),i.d(t,"a",(function(){return c}));var r=i(0),n=i(2),s=i(33);function o(e,t){return void 0===t&&(t=0),function(i){return i.lift(new a(e,t))}}var a=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.scheduler,this.delay))},e}(),c=function(e){function t(t,i,r){void 0===r&&(r=0);var n=e.call(this,t)||this;return n.scheduler=i,n.delay=r,n}return r.a(t,e),t.dispatch=function(e){var t=e.notification,i=e.destination;t.observe(i),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.destination.add(this.scheduler.schedule(t.dispatch,this.delay,new l(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(s.a.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(s.a.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(s.a.createComplete()),this.unsubscribe()},t}(n.a),l=function(){return function(e,t){this.notification=e,this.destination=t}}()},function(e,t,i){i.d(t,"a",(function(){return r}));var r=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}()},function(e,t,i){i.d(t,"a",(function(){return n}));var r=i(85);function n(){return Object(r.a)(1)}},function(e,t,i){i.d(t,"a",(function(){return a}));var r=i(5),n=i(21),s=i(85),o=i(50);function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=Number.POSITIVE_INFINITY,a=null,c=e[e.length-1];return Object(n.a)(c)?(a=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(i=e.pop())):"number"==typeof c&&(i=e.pop()),null===a&&1===e.length&&e[0]instanceof r.a?e[0]:Object(s.a)(i)(Object(o.a)(e,a))}},function(e,t,i){i.d(t,"a",(function(){return c}));var r=i(0),n=i(16),s=i(50),o=i(31),a=i(25);function c(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){if(!Object(n.a)(e[0]))return e[0];e=e[0]}return Object(s.a)(e,void 0).lift(new l)}var l=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new d(e))},e}(),d=function(e){function t(t){var i=e.call(this,t)||this;return i.hasFirst=false,i.observables=[],i.subscriptions=[],i}return r.a(t,e),t.prototype._next=function(e){this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{for(var i=0;i<t&&!this.hasFirst;i++){var r=e[i],n=Object(a.a)(this,r,void 0,i);this.subscriptions&&this.subscriptions.push(n),this.add(n)}this.observables=null}},t.prototype.notifyNext=function(e,t,i){if(!this.hasFirst){this.hasFirst=true;for(var r=0;r<this.subscriptions.length;r++)if(r!==i){var n=this.subscriptions[r];n.unsubscribe(),this.remove(n)}this.subscriptions=null}this.destination.next(t)},t}(o.a)},function(e,t,i){i.d(t,"a",(function(){return a}));var r=i(5),n=i(15),s=i(54),o=i(21);function a(e,t,i){void 0===e&&(e=0);var a=-1;return Object(s.a)(t)?a=Number(t)<1?1:Number(t):Object(o.a)(t)&&(i=t),Object(o.a)(i)||(i=n.a),new r.a((function(t){var r=Object(s.a)(e)?e:+e-i.now();return i.schedule(c,r,{index:0,period:a,subscriber:t})}))}function c(e){var t=e.index,i=e.period,r=e.subscriber;if(r.next(t),!r.closed){if(-1===i)return r.complete();e.index=t+1,this.schedule(e,i)}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7),n=i(449),s=i(4),o=i(6),a=i(8),c=i(9),l=i(14),d=i(37),u=i(47),h=i(57),f=i(11),p=i(312),g=i(17);class m{constructor(){this.portalURL="",this.sipWisePortalURL="",this.listeners=[],this.voiceMessageMngtRef=null,this.messageHandlerRef=null,this.voiceMessages=[],this.voiceMails=[],this.xmpp_message_handler=null,this.voiceMessagesCounters={total:0,unread:0,voiceMessagePresent:false},this.voiceMailsHuntingGroupCounters={roomJid:null,total:0,unread:0},this.unreadVoiceMessageCounter=0,this.voiceMessagePromises={},this.rxSubject=new r.Subject,this.CALLSERVICE_NS="urn:xmpp:pbxagent:callservice:1",this.CALLSERVICE_NS_SIPWISE="urn:xmpp:pbxagent:telephony:1",this.personalDirSubscriptions=[],this.logger=s.LoggerService.getInstance(),this.authService=a.AuthService.getInstance(),this.xmppService=c.XmppService.getInstance(),this.profileService=l.ProfileService.getInstance(),this.fileStorageService=d.FileStorageService.getInstance(),this.contactService=o.ContactService.getInstance(),this.fileServerService=u.FileServerService.getInstance(),this.telephonyService=h.TelephonyService.getInstance(),this.eventService=f.EventService.getInstance(),this.personalDirectoryService=p.PersonalDirectoryService.getInstance(),this.mainService=g.MainService.getInstance()}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.voiceMessageService||(e.rainbow.voiceMessageService=new m),e.rainbow.voiceMessageService}start(){return this.centralizedService=this.mainService.inject("centralizedService"),this.portalURL=config.restServerUrl+"/api/rainbow/telephony/v1.0/",this.sipWisePortalURL=config.restServerUrl+"/api/rainbow/voice/v1.0/",this.telephonyService.isSipWiseRoot()&&(this.logger.info("[voiceMessageService] starting in sipWise mode "),this.CALLSERVICE_NS=this.CALLSERVICE_NS_SIPWISE),this.voiceMessagesCounters={total:0,unread:0,voiceMessagePresent:false},new Promise((e=>{this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_VOICE_MAIL)?(this.contactService.userContact.isCPaaSGuest()||(this.logger.info("[voiceMessageService] === STARTING ==="),this.attachHandlers(),this.telephonyService.isSipWiseRoot()&&this.getVoiceMessagesCounters().then((()=>{this.eventService.publish("ON_VOICE_MESSAGE_UPDATE_EVENT",this.voiceMessagesCounters)})),this.logger.info("[voiceMessageService] === STARTED  ===")),e()):e()}))}reconnect(){this.attachHandlers()}attachHandlers(){this.logger.info("[voiceMessageService] attachHandlers"),this.voiceMessageMngtRef&&(this.xmppService.connection.deleteHandler(this.voiceMessageMngtRef),this.voiceMessageMngtRef=null),this.voiceMessageMngtRef=this.xmppService.connection.addHandler((e=>this.onVoiceMessageManagement(e)),null,"message","management"),this.messageHandlerRef&&(this.xmppService.deleteHandler(this.messageHandlerRef),this.messageHandlerRef=null),this.messageHandlerRef=this.xmppService.addHandler((e=>this.vmCounterHandler(e)),this.CALLSERVICE_NS,"message"),this.personalDirSubscriptions.push(this.personalDirectoryService.subscribe((e=>{this.onPersonalContactEvent(e)})))}async stop(){this.logger.info("[voiceMessageService] === STOPPING ==="),this.listeners.forEach((e=>{e()})),this.voiceMessagesCounters={total:0,unread:0},this.logger.info("[voiceMessageService] === STOPPED ===")}subscribe(e){return this.rxSubject.subscribe(e)}vmCounterHandler(e){try{if(this.telephonyService.isSipWiseRoot()){const t=$(e).find("telephony"),i=$(e).find("stanza-id"),r=t.find("mwi"),n=t.find("gmwi");if(r&&0!==r.length){const e=r.find("message"),t=e.attr("type"),i=e.attr("new"),n=e.attr("old");t&&"voice"===t&&i&&n?(this.voiceMessagesCounters.unread=Number(i),this.voiceMessagesCounters.total=Number(i)+Number(n),this.voiceMessagesCounters.voiceMessagePresent=false,this.logger.info("[voiceMessageService] vmCounterHandler SipWise -- Messages total : "+this.voiceMessagesCounters.total+" - Messages Unread : "+this.voiceMessagesCounters.unread),this.rxSubject.next({type:"VOICE_MESSAGE_UPDATE",data:this.voiceMessagesCounters}),this.eventService.publish("ON_VOICE_MESSAGE_UPDATE_EVENT",this.voiceMessagesCounters)):this.logger.info("[voiceMessageService] vmCounterHandler SipWise -- anomaly msg attr ")}if(n&&0!==n.length){const e=n.find("message"),t=e.attr("type"),r=e.attr("new"),s=e.attr("old"),o=i.attr("by");t&&"voice"===t&&r&&s&&o?(this.voiceMailsHuntingGroupCounters.roomJid=o,this.voiceMailsHuntingGroupCounters.unread=Number(r),this.voiceMailsHuntingGroupCounters.total=Number(r)+Number(s),this.logger.info("[voiceMessageService] vmHuntingGroupCounterHandler SipWise for room: "+this.voiceMailsHuntingGroupCounters.roomJid+" -- Messages total : "+this.voiceMailsHuntingGroupCounters.total+" - Messages Unread : "+this.voiceMailsHuntingGroupCounters.unread),this.rxSubject.next({type:"VOICE_MAIL_HUNTING_GROUP_UPDATE",data:this.voiceMailsHuntingGroupCounters})):this.logger.info("[voiceMessageService] vmHuntingGroupCounterHandler SipWise -- anomaly msg attr ")}}else{const t=$(e).find("voiceMessages").find("voiceMessagesCounters");if(t&&0!==t.length){const e=t.attr("totalVoiceMessages"),i=t.attr("unreadVoiceMessages"),r=t.attr("voiceMessagePresent");this.voiceMessagesCounters={total:e?parseInt(e,10):0,unread:i?parseInt(i,10):0,voiceMessagePresent:Boolean(r)},this.rxSubject.next({type:"VOICE_MESSAGE_UPDATE",data:this.voiceMessagesCounters}),this.eventService.publish("ON_VOICE_MESSAGE_UPDATE_EVENT",this.voiceMessagesCounters)}}return true}catch(t){return true}}async onVoiceMessageManagement(e){try{const t=$(e).find("visualvoicemail");if(t.length&&"abort"===t.attr("action")){const e=t.attr("msgid"),i=t.find("error");this.voiceMessagePromises[e].reject(new Error(i.attr("errordetailscode"))),delete this.voiceMessagePromises[e],this.logger.info("[voiceMessageService] onVoiceMessageManagement - "+e+" - abort - "+i.attr("errormsg"))}else if(t.length&&"create"===t.attr("action")){const e=t.attr("msgid"),i=t.find("fileid").text();this.logger.info("[voiceMessageService] onVoiceMessageManagement - "+e+" - create FileId - "+i);this.getVoiceMessageById(e)&&(await this.fileStorageService.retrieveVoiceMessageFileDescriptorsListPerOwner(),this.voiceMessagePromises[e].resolve(e),delete this.voiceMessagePromises[e])}return true}catch(t){return true}}getVoiceMessageById(e){return this.voiceMessages.find((t=>e===t.id))}onPersonalContactEvent(e){try{let t=false;switch(e.name){case p.PersonalDirectoryEvent.PERSONAL_DIRECTORY_ADD:if(e.data){const i=e.data;this.logger.debug(`[VoiceMessageService] onPersonalContactEvent PERSONAL_DIRECTORY_ADD: Id = ${i.id} -- Display name = ${i.displayName}`),this.voiceMessages.forEach((e=>{if(!e.directoryContactId&&e.contact.temp){const i=e.contact.id,r=this.personalDirectoryService.getPersonalDirectoryContactFromNumber(i);r&&(this.logger.debug(`[VoiceMessageService] onPersonalContactEvent -- Update display of voice message number '${e.contact.displayName}' to name '${r.displayName}'`),e.contact.displayName=r.displayName,e.directoryContactId=r.id,t=true)}})),t&&this.rxSubject.next({type:"VOICE_MESSAGE_INFOS_UPDATE"})}break;case p.PersonalDirectoryEvent.PERSONAL_DIRECTORY_UPDATE:if(e.data){const i=e.data;this.logger.debug(`[VoiceMessageService] onPersonalContactEvent PERSONAL_DIRECTORY_UPDATE: Id = ${i.id} -- Display name = ${i.displayName}`),this.voiceMessages.forEach((e=>{const i=e.contact.id,r=this.personalDirectoryService.getPersonalDirectoryContactFromNumber(i);r?(this.logger.debug(`[VoiceMessageService] onPersonalContactEvent -- Update display of voice message log name '${e.contact.displayName}' to '${r.displayName}'`),e.contact.displayName=r.displayName,e.directoryContactId=r.id,t=true):e.directoryContactId&&(this.logger.debug(`[VoiceMessageService] onPersonalContactEvent -- Reinit display of voice message log name '${e.contact.displayName}' to number '${e.contact.phoneProCan}'`),e.contact.displayName=e.contact.phoneProCan,e.directoryContactId=null,t=true)})),t&&this.rxSubject.next({type:"VOICE_MESSAGE_INFOS_UPDATE"})}break;case p.PersonalDirectoryEvent.PERSONAL_DIRECTORY_DELETE:if(e.data){const i=e.data;this.logger.debug("[VoiceMessageService] onPersonalContactEvent PERSONAL_DIRECTORY_DELETE: Id =  "+i),this.voiceMessages.forEach((e=>{e.directoryContactId===i&&(this.logger.debug(`[VoiceMessageService] onPersonalContactEvent -- Reinit display of voice message log name '${e.contact.displayName}' to number '${e.contact.phoneProCan}'`),e.contact.displayName=e.contact.phoneProCan,e.directoryContactId=null,t=true)})),t&&this.rxSubject.next({type:"VOICE_MESSAGE_INFOS_UPDATE"})}break;case p.PersonalDirectoryEvent.PERSONAL_DIRECTORY_DELETE_ALL:this.logger.debug("[VoiceMessageService] onPersonalContactEvent PERSONAL_DIRECTORY_DELETE_ALL"),this.voiceMessages.forEach((e=>{e.directoryContactId&&(this.logger.debug(`[VoiceMessageService] onPersonalContactEvent -- Reinit display of voice message log name '${e.contact.displayName}' to number '${e.contact.phoneProCan}'`),e.contact.displayName=e.contact.phoneProCan,e.directoryContactId=null,t=true)})),t&&this.rxSubject.next({type:"VOICE_MESSAGE_INFOS_UPDATE"})}}catch(t){return this.logger.error("[VoiceMessageService] onPersonalContactEvent -- failure with error "+t),true}return true}async getVoiceMessagesList(){if(!this.telephonyService.agentStatus.featureVVM&&!this.telephonyService.isSipWise())return[];try{let e,t,i;if(this.voiceMessages=[],this.telephonyService.isSipWise()){const r=this.sipWisePortalURL+"messages",n=this.authService.getRequestHeader();if(t=await fetch(r,{method:"GET",headers:n}),!t.ok)throw t;e=await t.json(),i=e.data,this.voiceMessages=await Promise.all(i.map((async e=>await this.createVoiceMessageFromSipWiseData(e).catch((()=>{}))))),this.fileStorageService.reinitInternal()}else{const r=this.portalURL+"voicemessages",n=this.authService.getRequestHeader();if(t=await fetch(r,{method:"GET",headers:n}),!t.ok)throw t;e=await t.json(),i=e.data.voicemessages.voiceMessageList,this.voiceMessages=await Promise.all(i.map((async e=>await this.createVoiceMessageFromData(e).catch((()=>{})))))}return this.logger.info("[voiceMessageService] getVoiceMessagesList success - Messages number : "+this.voiceMessages.length),this.voiceMessages.sort(((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime())),this.voiceMessages}catch(e){let t="getVoiceMessagesList failure -- ";throw t+=e.status?e.status:e.message,this.logger.error("[voiceMessageService] "+t),new Error(t)}}getVoiceMessages(){return this.voiceMessages}async getVoiceMessagesCounters(){try{if(this.telephonyService.isSipWiseRoot()){const e=this.sipWisePortalURL+"messages",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=await i.json(),n=Number(r.inbox),s=Number(r.old);this.voiceMessagesCounters.unread=n,this.voiceMessagesCounters.total=n+s,this.logger.info("[voiceMessageService] getVoiceMessagesCounters SipWise success - total : "+this.voiceMessagesCounters.total+" - unread : "+this.voiceMessagesCounters.unread)}else{const e=this.portalURL+"voicemessages/counters",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=(await i.json()).data.voicemessages.counters;this.voiceMessagesCounters.total=parseInt(r.total,10),this.voiceMessagesCounters.unread=parseInt(r.unread,10),this.logger.info("[voiceMessageService] getVoiceMessagesCounters success - total : "+this.voiceMessagesCounters.total+" - unread : "+this.voiceMessagesCounters.unread)}return this.rxSubject.next({type:"VOICE_MESSAGE_UPDATE",data:this.voiceMessagesCounters}),this.voiceMessagesCounters}catch(e){throw this.voiceMessageHandleError("getVoiceMessagesCounters",e)}}getVoiceMessagesUnreadCounter(){return this.voiceMessagesCounters.unread}getVoiceMessagesTotalCounter(){return this.voiceMessagesCounters.total}getVoiceMessagePresent(){return this.voiceMessagesCounters.voiceMessagePresent}async getVoiceMessageAudioFileURL(e){let t;if(t=this.telephonyService.isSipWise()?this.fileStorageService.getFileDescriptorById(e.id):this.fileStorageService.getVoiceMessageFileDescriptorByMsgId(e.id),t&&"deleted"!==t.state){const i=await this.fileServerService.getBlobFromFileDescriptor(t);return e.unread&&this.updateVoiceMessage(e.id,true),URL.createObjectURL(i)}const i=await new Promise(((t,i)=>{this.voiceMessagePromises[e.id]={resolve:t,reject:i},this.getVoiceMessageFromPBX(e)}));if(await this.fileStorageService.retrieveVoiceMessageFileDescriptorsListPerOwner(),t=this.fileStorageService.getVoiceMessageFileDescriptorByMsgId(i),t){const e=await this.fileServerService.getBlobFromFileDescriptor(t);return URL.createObjectURL(e)}}async getVoiceMessageFromPBX(e){try{const t=this.portalURL+"voicemessages/"+encodeURIComponent(e.id)+"?messageDate="+encodeURIComponent(e.dateString)+"&messageFrom="+encodeURIComponent(e.from),i=this.authService.getRequestHeader();await fetch(t,{method:"GET",headers:i}),this.logger.info("[voiceMessageService] getVoiceMessageFromPBX success")}catch(t){throw this.voiceMessageHandleError("getVoiceMessageFromPBX",t)}}async deleteVoiceMessage(e){try{if(this.telephonyService.isSipWise()){const t=this.sipWisePortalURL+"messages/"+e,i=this.authService.getRequestHeader();await fetch(t,{method:"DELETE",headers:i})}else{const t=this.portalURL+"voicemessages/"+e,i=this.authService.getRequestHeader();await fetch(t,{method:"DELETE",headers:i})}this.logger.info("[voiceMessageService] deleteVoiceMessage success")}catch(t){throw this.voiceMessageHandleError("deleteVoiceMessage",t)}}async deleteAllVoiceMessages(){try{if(this.telephonyService.isSipWise()){const e=this.sipWisePortalURL+"messages",t=this.authService.getRequestHeader();await fetch(e,{method:"DELETE",headers:t})}else{const e=this.portalURL+"voicemessages/all",t=this.authService.getRequestHeader();await fetch(e,{method:"DELETE",headers:t})}this.logger.info("[voiceMessageService] deleteAllVoiceMessages success")}catch(e){throw this.voiceMessageHandleError("deleteAllVoiceMessages",e)}}async createVoiceMessageFromData(e){try{if(e){const i=e.foundidentity;let r="",s="";const o=e.jid,a=e.from;if(o||a){const c=await this.contactService.getOrCreateContact(o,a);if(this.logger.info(`[voiceMessageService] createVoiceMessageFromData otherParticipant jid: ${o} - Number: ${a} => contact retrieved (temp:${c.temp}`),!o&&c.temp){if(i&&i.length){const e=i.attr("firstName"),t=i.attr("lastName"),n=i.attr("displayName");r=e||"",s=t||"",""===s&&""===r&&n&&0!==n.length&&n!==a&&(s=n),(r.length||s.length)&&(this.logger.debug("[voiceMessageService] createVoiceMessageFromData  xNames updated from directories for contact "+c.id),c.updateName(r,s))}else try{const e=true;if(this.centralizedService)try{await this.centralizedService.outlook.updateContactFromOutlookInfos(c,a,e)?this.logger.debug("[voiceMessageService] createVoiceMessageFromData  xNames updated from outlook for contact "+c.id):this.logger.debug("[voiceMessageService] createVoiceMessageFromData no update from outlook for contact "+c.id)}catch(t){this.logger.debug("[voiceMessageService] createVoiceMessageFromData -- No Outlook search available")}}catch(t){}let e=false;const n=/^[0-9A-D #\-\+\*\(\)\./]{1,32}$/;if(this.telephonyService.started){e=c.displayName.match(n)&&this.telephonyService.startAsPhoneNumber(c.displayName)}e&&c.phoneProCan&&""!==c.phoneProCan&&(c.displayName=c.phoneProCan)}const l=Number.parseInt(e.length,10);return new n.VoiceMessage(e.id,c,"true"===e.unread,l,e.date,e.from,e.jid)}throw new Error("neither otherParticipantJid nor otherParticipantNumber")}throw new Error("no data")}catch(t){throw this.logger.warn("[voiceMessageService] createVoiceMessageFromData  -- failure --"),t}}async createVoiceMessageFromSipWiseData(e){try{if(e&&e.callerInfo){const i=e.callerInfo.number,r=e.callerInfo.name||"",s=e.callerInfo.firstName||"",o=e.callerInfo.lastName||"",a=e.callerInfo.jid||"";if(a||i){let c=true,l=await this.contactService.getOrCreateContact(a,i);if(this.logger.info(`[voiceMessageService] createVoiceMessageFromSipWiseData caller Jid : ${a} - Number: ${i} => contact retrieved (temp:${l.temp}`),r&&(l.displayName=r,c=false),(s.length||o.length)&&(l.updateName(s,o),c=false),l.temp){const e=this.contactService.getContactByPhoneNumber(i);if(e)l=e,c=false;else try{const e=true;if(this.centralizedService)try{await this.centralizedService.outlook.updateContactFromOutlookInfos(l,i,e)?(this.logger.debug("[voiceMessageService] createVoiceMessageFromSipWiseData  xNames updated from outlook for contact "+l.id),c=false):this.logger.debug("[voiceMessageService] createVoiceMessageFromSipWiseData no update from outlook for contact "+l.id)}catch(t){this.logger.debug("[voiceMessageService] createVoiceMessageFromSipWiseData -- No Outlook search available")}}catch(t){}let r=false;const n=/^[0-9A-D #\-\+\*\(\)\./]{1,32}$/;if(this.telephonyService.started){r=l.displayName.match(n)&&this.telephonyService.startAsPhoneNumber(l.displayName)}r&&l.phoneProCan&&""!==l.phoneProCan&&(l.displayName=l.phoneProCan)}const d=Number.parseInt(e.duration,10),u=new n.VoiceMessage(e.id,l,!e.read,d,e.date,e.callerInfo.number,e.callerInfo.jid);if(c){const e=this.personalDirectoryService.getPersonalDirectoryContactFromNumber(i);e&&(u.contact.displayName=e.displayName,u.directoryContactId=e.id)}return u}throw new Error("neither otherParticipantJid nor otherParticipantNumber")}throw new Error("no data")}catch(t){throw this.logger.warn("[voiceMessageService] createVoiceMessageFromSipWiseData  -- failure --"+t.message),t}}voiceMessageHandleError(e,t){let i=e+" -- failure -- ";return i+=t.data?t.data.errorDetails:"Server failure",this.logger.error("[voiceMessageService] "+i),new Error(i)}voiceMessageErrorHandler(e,t,i){i.data?this.logger.error("[voiceMessageService] "+e+" -- failure -- "+i.data.errorDetails):this.logger.error("[voiceMessageService] "+e+" -- failure -- Server failure"),t(i)}async updateVoiceMessage(e,t){try{if(this.telephonyService.isSipWise()){const i=this.sipWisePortalURL+"messages/"+encodeURIComponent(e),r=this.authService.getPostHeader(),n=JSON.stringify({read:t});await fetch(i,{method:"PUT",headers:r,body:n}),this.logger.info("[voiceMessageService] updateVoiceMessage success")}}catch(i){throw this.voiceMessageHandleError("updateVoiceMessage",i)}}async getVoiceMailsHuntingGroupList(e){try{this.voiceMails=[];const t=this.sipWisePortalURL+"groups/"+e+"/messages?sortOrder=-1",i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;const n=(await r.json()).data;return this.voiceMails=await Promise.all(n.map((async e=>await this.createVoiceMessageFromSipWiseData(e).catch((()=>{}))))),this.fileStorageService.reinitInternal(),this.logger.info("[voiceMessageService] getVoiceMailsHuntingGroupList success - Messages number : "+this.voiceMails.length),this.voiceMails}catch(t){let e="getVoiceMailsList failure -- ";throw e+=t.status?t.status:t.message,this.logger.error("[voiceMessageService] "+e),new Error(e)}}async getVoiceMailsCounters(e){try{const t={unread:0,total:0},i=this.sipWisePortalURL+"groups/"+e+"/messages",r=this.authService.getRequestHeader(),n=await fetch(i,{method:"GET",headers:r});if(!n.ok)throw n;const s=await n.json();return t.unread=s.new,t.total=s.total,this.logger.info("[voiceMessageService] getVoiceMailsCounters success - VM unread : "+this.voiceMailsHuntingGroupCounters.unread+" VM total :"+this.voiceMailsHuntingGroupCounters.total),t}catch(t){let e="getVoiceMailsCounters failure -- ";throw e+=t.status?t.status:t.message,this.logger.error("[voiceMessageService] "+e),new Error(e)}}async deleteVoiceMailHuntingGroup(e,t){try{const i=this.sipWisePortalURL+"groups/"+e+"/messages/"+t,r=this.authService.getRequestHeader(),n=await fetch(i,{method:"DELETE",headers:r});if(!n.ok)throw n;this.logger.info("[voiceMessageService] deleteVoiceMailHuntingGroup success")}catch(i){throw this.voiceMessageHandleError("deleteVoiceMailHuntingGroup",i)}}}t.VoiceMessageService=m},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(8),n=i(17),s=i(6),o=i(4),a=i(11),c=i(13),l=i(14);class d{constructor(){this.id=null,this.name=null,this.jid=null,this.avatarId=null,this.avatarUrl=null,this.lastAvatarUpdateDate=null,this.capabilities=[],this.isRainbowSupportBot=false}static createFromData(e){const t=new d;return t.id=e.id,t.name=e.name,t.jid=e.jid,t.avatarId=e.avatarId||e.id,t.lastAvatarUpdateDate=e.lastAvatarUpdateDate,t.capabilities=e.capabilities,t.isRainbowSupportBot=e.isRainbowSupportBot,t}}t.BotData=d;class u{}t.AbstractBotService=u;class h extends u{constructor(){super(),this.authService=r.AuthService.getInstance(),this.mainService=n.MainService.getInstance(),this.logger=o.LoggerService.getInstance(),this.contactService=s.ContactService.getInstance(),this.eventService=a.EventService.getInstance(),this.errorHelperService=c.ErrorHelperService.getInstance(),this.profileService=l.ProfileService.getInstance(),this.avatarChangeEventHandler=null,this.botsList=[]}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.botService||(e.rainbow.botService=new h),e.rainbow.botService}async start(){try{if(this.logger.info("[botService] === STARTING ==="),this.init(),this.startListeners(),!this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.REPORT_A_PROBLEM)){const e=await this.getEmilyBot();this.storeEmilyBot(e)}this.logger.info("[botService] === STARTED ===")}catch(e){this.logger.error("[botService] === STARTING FAILURE === "+e.message)}}async stop(){this.botsList=[],this.avatarChangeEventHandler&&(this.avatarChangeEventHandler(),this.avatarChangeEventHandler=null),this.logger.info("[botService] === STOPPED ===")}init(){this.portalURL=config.restServerUrl+"/api/rainbow/enduser/v1.0/"}startListeners(){this.avatarChangeEventHandler&&(this.avatarChangeEventHandler(),this.avatarChangeEventHandler=null),this.avatarChangeEventHandler=this.eventService.subscribe("ON_COMPANY_SUPPORT_AVATAR_CHANGE_EVENT",((e,t)=>this.onSupportAvatarChange(e,t)))}async onSupportAvatarChange(e,t){try{if(this.logger.info("[botService] Emily avatar has been changed"),t.companyId===this.contactService.userContact.company.id&&!this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.REPORT_A_PROBLEM)){const e=await this.getEmilyBot();this.storeEmilyBot(e)}}catch(i){this.logger.warn("[botService] Impossible to update Emily - "+i.stack||false)}}async getBots(e=null){try{const t={};e?(e.format&&"string"==typeof e.format&&e.format.length?t.format=e.format:t.format="full",e.limit&&(t.limit=e.limit),e.offset&&(t.offset=e.offset),e.sortField&&(t.sortField=e.sortField),!e.sortOrder||"-1"!==e.sortOrder&&"1"!==e.sortOrder||(t.sortOrder=e.sortOrder)):t.format="full";const i=new URLSearchParams(t).toString(),r=new URL(this.portalURL+"bots"),n=this.authService.getRequestHeader();r.search=i;const s=await fetch(r.toString(),{method:"GET",headers:n});if(!s.ok)throw s;this.logger.info("[botService] getBots: Get the list of bot services -- success from server");return(await s.json()).data}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getBots");throw this.logger.error(`[botService] getBots failure: ${e.error.errorDetails} with status ${e.error.status}`),e.error}}async getBotById(e){try{if(!e)throw new Error("Missing botId in the request");const t=`${this.portalURL}bots/${e}`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;this.logger.info("[botService] getBotById success for "+e);return(await r.json()).data}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getBotById");throw this.logger.error("[botService] getBotById failure: "+e.error.message),e.error}}async getBotContactByJid(e){try{if(!e)throw new Error("Missing bot jid in the request");let t=this.botsList.findIndex((t=>t.jid===e));if(-1!==t){this.logger.info(`[botService] getBotContactByJid - Data for bot jid "${e}" found in cache`);const i=this.botsList[t];return this.contactService.getContactByJid(i.jid)}const i=await this.getBots();if(t=i.findIndex((t=>t.jid===e)),-1!==t){this.logger.info(`[botService] getBotContactByJid - Data for bot jid "${e}" get from server`);const r=i[t];return this.botsList.unshift(r),this.contactService.createBotContact(r.jid,r.name,r.id,r.avatarUrl,r.capabilities,r.isRainbowSupportBot)}throw new Error(`No bot with jid ${e} found in cache or server`)}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getBotContactByJid");throw this.logger.error("[botService] "+e.error.message),e.error}}async getEmilyBot(){try{const e=this.portalURL+"bots/rainbow-support",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;this.logger.info("[botService] Get support bot service (Emily) success from server");return(await i.json()).data}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getEmilyBot");throw this.logger.error(`[botService] getEmilyBot failure: ${t.error.errorDetails} with status ${t.error.status}`),t.error}}storeEmilyBot(e){const t=this.botsList.findIndex((e=>true===e.isRainbowSupportBot));-1!==t&&this.botsList.splice(t,1);const i=d.createFromData(e);return i.avatarUrl=this.getBotAvatarUrl(i.avatarId,i.lastAvatarUpdateDate),this.botsList.unshift(i),this.contactService.createBotContact(i.jid,i.name,i.id,i.avatarUrl,i.capabilities,true),this.logger.info("[botService] storeEmilyBot - Emily bot data stored in cache and contact updated"),i}async getEmily(){if(this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.REPORT_A_PROBLEM))return null;const e=this.botsList.filter((e=>true===e.isRainbowSupportBot));if(0===e.length){this.logger.error("[botService] getEmily failure: Unexpected behaviour -- Emily bot not found in cache !");const e=await this.getEmilyBot();return this.storeEmilyBot(e)}return e[0]}getBotAvatarImage(e,t){return new Promise(((i,r)=>{this.logger.info("[botService] getBotAvatarImage");const n=new Image;let s=0;n.onload=()=>{this.logger.info("[botService] Load bot avatar "+e+" lastAvatarUpdateDate "+t+" success"),i(n)},n.onerror=()=>{s++,this.logger.warn("[botService] Load bot avatar "+e+" lastAvatarUpdateDate "+t+" failure"),1===s?(this.logger.warn("[botService] Fallback to default emily avatar"),n.src="/assets/skins/rainbow/images/conversation/icon_headset.png"):r(new Error("No image found"))},n.src=this.getBotAvatarUrl(e,t)}))}getBotAvatarUrl(e,t){let i=config.webservices.protocol+"://"+config.webservices.currentServer+"/api/avatar/"+e+"?size=120";return i+=t?"&update="+n.MainService.MD5(t):"&update="+Date.now(),i}}t.BotService=h},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(4),n=i(13),s=i(8),o=i(140),a=i(11),c=i(14),l=i(6),d=i(147),u=i(24),h=i(63),f=i(17);var p;!function(e){e.ADMIN_DIRECTORY_CHANGE="ADMIN_DIRECTORY_CHANGE",e.ON_COMPANY_BANNER_UPDATED="ON_COMPANY_BANNER_UPDATED"}(p=t.CompanyDirectoryEvent||(t.CompanyDirectoryEvent={}));class g{constructor(){this.logger=r.LoggerService.getInstance(),this.authService=s.AuthService.getInstance(),this.eventService=a.EventService.getInstance(),this.profileService=c.ProfileService.getInstance(),this.contactService=l.ContactService.getInstance(),this.countryService=d.CountryService.getInstance(),this.userInfoService=h.UserInfoService.getInstance(),this.errorHelperService=n.ErrorHelperService.getInstance(),this.companies=[]}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.companyDirectoryService||(e.rainbow.companyDirectoryService=new g),e.rainbow.companyDirectoryService}async getDirectoryContacts(e,t,i,r,n,s="full"){try{let a=`${config.restServerUrl+"/api/rainbow/directory/v1.0/"}entries?view=company&type=all&format=${s}&companyId=${e}&limit=${i}`;if(t&&(a+="&offset="+i*(t-1)),r)switch(n){case"phoneNumbers":case"tags":a+="&"+n+"="+encodeURIComponent(r);break;case"name":default:a+="&name="+encodeURIComponent(r)}const c=this.authService.getRequestHeader(),l=await fetch(a,{method:"GET",headers:c});if(!l.ok)throw l;const d=await l.json();this.logger.info("[CompanyDirectoryService] getDirectoryContacts success (found "+d.total+" contact(s))");const u=d.data,h=[];return u.forEach((e=>{const t=o.DirectoryContact.createFromData(e);h.push(t)})),{contacts:h,limit:d.limit,offset:d.offset,total:d.total}}catch(a){const e=await this.errorHelperService.getErrorInfo(a,"getDirectoryContacts");throw this.logger.error("[CompanyDirectoryService] "+e.message),e.error}}async createDirectoryContact(e){try{if(!e.companyId)throw new Error("Missing mandatory parameter 'companyId");const t=config.restServerUrl+"/api/rainbow/directory/v1.0/entries",i=this.authService.getPostHeader(),r=await fetch(t,{method:"POST",headers:i,body:JSON.stringify(e)});if(!r.ok)throw r;const n=await r.json(),s=o.DirectoryContact.createFromData(n.data);return this.logger.info("[CompanyDirectoryService] createDirectoryContact success"),this.eventService.publish(p.ADMIN_DIRECTORY_CHANGE,s),s}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"createDirectoryContact");throw this.logger.error("[CompanyDirectoryService] "+e.message),e.error}}async getDirectoryContact(e,t="full"){try{const i=`${config.restServerUrl+"/api/rainbow/directory/v1.0/"}entries/${e}?format=${t}`,r=this.authService.getRequestHeader(),n=await fetch(i,{method:"GET",headers:r});if(!n.ok)throw n;const s=await n.json();this.logger.info("[CompanyDirectoryService] getDirectoryContact success");return o.DirectoryContact.createFromData(s.data)}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"getDirectoryContact");throw this.logger.error("[CompanyDirectoryService] "+e.message),e.error}}async updateDirectoryContact(e){try{const t=`${config.restServerUrl+"/api/rainbow/directory/v1.0/"}entries/${e.id}`,i=this.authService.getPostHeader(),r=await fetch(t,{method:"PUT",headers:i,body:JSON.stringify(e)});if(!r.ok)throw r;const n=await r.json(),s=o.DirectoryContact.createFromData(n.data);return this.logger.info("[CompanyDirectoryService] createDirectoryContact success"),this.eventService.publish(p.ADMIN_DIRECTORY_CHANGE,s),s}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"updateDirectoryContact");throw this.logger.error("[CompanyDirectoryService] "+e.message),e.error}}async deleteDirectoryContact(e){try{const t=`${config.restServerUrl+"/api/rainbow/directory/v1.0/"}entries/${e}`,i=this.authService.getPostHeader(),r=await fetch(t,{method:"DELETE",headers:i});if(!r.ok)throw r;return this.logger.info(`[CompanyDirectoryService] deleteDirectoryContact of ${e} success`),void this.eventService.publish(p.ADMIN_DIRECTORY_CHANGE)}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"deleteDirectoryContact");throw this.logger.error("[CompanyDirectoryService] "+e.message),e.error}}async getTags(e){try{const t=`${config.restServerUrl+"/api/rainbow/directory/v1.0/"}entries/tags${e?"?companyId="+e:""}`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;const n=await r.json();return this.logger.info("[CompanyDirectoryService] getTags success"),n.data}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getTags");throw this.logger.error("[CompanyDirectoryService] "+e.message),e.error}}async getTagsStats(e){try{const t=`${config.restServerUrl+"/api/rainbow/directory/v1.0/"}entries/tags/stats${e?"?companyId="+e:""}`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;const n=(await r.json()).data.stats||[];return this.logger.info("[CompanyDirectoryService] getTagsStats success(find "+n.length+"tags(s))"),n}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getTagsStats");throw this.logger.error("[CompanyDirectoryService] "+e.message),e.error}}async renameTag(e,t,i){try{const r=`${config.restServerUrl+"/api/rainbow/directory/v1.0/"}entries/tags?tag=${encodeURIComponent(e)}${i?"&companyId="+i:""}`,n=this.authService.getPostHeader(),s=await fetch(r,{method:"PUT",headers:n,body:JSON.stringify({newTagName:t})});if(!s.ok)throw s;const o=await s.json();return void this.logger.info("[CompanyDirectoryService] renameTag success => old tag: "+e+" => new tag: "+t+": found "+o.data.found+" occurence(s)")}catch(r){const e=await this.errorHelperService.getErrorInfo(r,"renameTag");throw this.logger.error("[CompanyDirectoryService] "+e.message),e.error}}async deleteTag(e,t){try{const i=`${config.restServerUrl+"/api/rainbow/directory/v1.0/"}entries/tags?tag=${encodeURIComponent(e)}${t?"&companyId="+t:""}`,r=this.authService.getPostHeader(),n=await fetch(i,{method:"DELETE",headers:r});if(!n.ok)throw n;const s=await n.json();return this.logger.info("[CompanyDirectoryService] deleteTag success (tag "+e+": found "+s.data.found+" occurence(s)"),void this.eventService.publish(p.ADMIN_DIRECTORY_CHANGE)}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"deleteTag");throw this.logger.error("[CompanyDirectoryService] "+e.message),e.error}}async search(e,t){try{const i=config.restServerUrl+"/api/rainbow/directory/v1.0/",r=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.SEARCH_BY_TAGS),n=`${i}entries?view=company&type=all&format=full&${r?"search=":"name="}${encodeURIComponent(e)}${t?"&companyId="+t:""}`,s=this.authService.getRequestHeader(),o=await fetch(n,{method:"GET",headers:s});if(!o.ok)throw o;const a=await o.json(),c=a.data.map((e=>this.createAndUpdateContact(e)));return this.logger.info("[CompanyDirectoryService] search success "+c.length),c}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"search");return this.logger.error("[CompanyDirectoryService] "+e.message),[]}}createAndUpdateContact(e){const t=this.contactService.createDirectoryContact(e.id,false);return t.companyDirectoryFlag=true,t.personalDirectoryFlag=false,t.mobilePhones=e.mobilePhoneNumbers,t.businessPhones=e.workPhoneNumbers,t.otherPhoneNumbers=e.otherPhoneNumbers,t.email=e.eMail,t.businessCompanyId=e.companyId,t.companyName=e.companyName,t.department=e.department,t.jobTitle=e.jobTitle,t.updateName(e.firstName,e.lastName),t.getAvatar(),t.note1=e.custom1,t.note2=e.custom2,t.tags=e.tags?e.tags:void 0,t.city=e.city,t.postalCode=e.postalCode,t.street=e.street,t.state=this.countryService.getStateName(e.country,e.state),t.country=this.countryService.getCountryName(e.country),t}async searchCompanies(e,t){try{const i=`${config.restServerUrl+"/api/rainbow/directory/v1.0/"}entries?view=company&format=full&companyName=${encodeURIComponent(e)}${t?"&companyId="+t:""}`,r=this.authService.getRequestHeader(),n=await fetch(i,{method:"GET",headers:r});if(!n.ok)throw n;const s=await n.json(),o=s.data.map((e=>{const t=u.Company.create(e.id,e.companyName);return t.country=e.country,this.getCompanyLogo(t),this.getCompanyBanner(t),this.companies[t.id]=t,t}));return this.logger.info("[CompanyDirectoryService] searchCompanies success"),o}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"searchCompanies");return this.logger.error("[CompanyDirectoryService] "+e.message),[]}}async getCompanyLogo(e){try{const t=this.userInfoService.computeUserColor(e.name),i=e.name.substr(0,1);return e.logo=this.userInfoService.getAvatarImage(e.id,i,t.color,130,e.lastAvatarUpdateDate),this.eventService.publish("ON_COMPANY_LOGO_UPDATED",e.id),this.logger.info("[CompanyDirectoryService] - getCompanyLogo - "+e.getNameForLogs()+" - success"),e.sendChangeEvent("logo"),e}catch(t){throw new Error("getCompanyLogo -- FAILURE -- "+t.message)}}async getCompanyBanner(e){return new Promise((t=>{const i=new Image;i.onload=()=>{e.banner=i,this.eventService.publish(p.ON_COMPANY_BANNER_UPDATED,e.id),this.logger.info("[CompanyDirectoryService] - getCompanyBanner - "+e.getNameForLogs()+" - success"),t(e)},i.onerror=()=>{this.logger.error("[CompanyDirectoryService] Load banner for "+e.getNameForLogs()+" failure"),t(e)};let r=this.authService.fromSDK?null:"/cacheV2/images/company-banner-01.svg";if(e.lastBannerUpdateDate){r=config.webservices.protocol+"://"+config.webservices.currentServer+"/api/banner/"+e.id+"?size=831",r+="&update="+f.MainService.MD5(e.lastBannerUpdateDate)}r?i.src=r:t(e)}))}getCompanyById(e){if(!e)throw new Error("missing companyId");const t=this.companies[e];return this.logger.info("[CompanyDirectoryService] getCompanyById (cache) "+e+" - success"),t}async getAllDirectoryContacts(e){try{const t=1e3,i=await this.getDirectoryContacts(e,1,t),r=i;if(i.total>t){const n=Math.ceil(i.total/t);let s=[...Array(n-1)];s=s.map(((e,t)=>t+2));const o=[];for(;s.length>0;)o.push(s.splice(0,5));await o.reduce(((i,n)=>i.then((()=>{const i=n.map((i=>this.getDirectoryContacts(e,i,t).then((e=>{r.contacts=r.contacts.concat(e.contacts),r.limit+=e.limit}))));return Promise.all(i)}))),Promise.resolve())}return r}catch(t){throw this.logger.error("[CompanyDirectoryService] getAllDirectoryContacts - "+t.message),t}}async buildDirectoryCsvBlob(e){try{this.logger.info("[CompanyDirectoryService] === buildDirectoryCsvBlob ===");const t=await this.getAllDirectoryContacts(e),i=Math.max(1,t.contacts.reduce(((e,t)=>Math.max(e,t.workPhoneNumbers?t.workPhoneNumbers.length:0)),0)),r=Math.max(1,t.contacts.reduce(((e,t)=>Math.max(e,t.mobilePhoneNumbers?t.mobilePhoneNumbers.length:0)),0)),n=Math.max(1,t.contacts.reduce(((e,t)=>Math.max(e,t.otherPhoneNumbers?t.otherPhoneNumbers.length:0)),0)),s=[...new Array(i)].map(((e,t)=>"workPhoneNumber"+t)),o=[...new Array(i)].map((()=>";")),a=[...new Array(r)].map(((e,t)=>"mobilePhoneNumber"+t)),c=[...new Array(r)].map((()=>";")),l=[...new Array(n)].map(((e,t)=>"otherPhoneNumber"+t)),d=[...new Array(n)].map((()=>";")),u=[];u.push("firstName;lastName;companyName;department;street;city;postalCode;state;country;"+s.join(";")+";"+a.join(";")+";"+l.join(";")+";jobTitle;eMail;tag0;tag1;tag2;tag3;tag4;custom1;custom2"),t.contacts.forEach((e=>{let t,i,r="";r+=e.firstName?e.firstName:"",r+=";",r+=e.lastName?e.lastName:"",r+=";",r+=e.companyName?e.companyName:"",r+=";",r+=e.department?e.department:"",r+=";",r+=e.street?e.street:"",r+=";",r+=e.city?e.city:"",r+=";",r+=e.postalCode?e.postalCode:"",r+=";",r+=e.state?e.state:"",r+=";",r+=e.country?e.country:"",t=e.workPhoneNumbers&&e.workPhoneNumbers.length>0?e.workPhoneNumbers:[""],r+=";",r+=t.map((e=>e)).join(";"),i=o.slice(t.length),r+=i.join(""),t=e.mobilePhoneNumbers&&e.mobilePhoneNumbers.length>0?e.mobilePhoneNumbers:[""],r+=";",r+=t.map((e=>e)).join(";"),i=c.slice(t.length),r+=i.join(""),t=e.otherPhoneNumbers&&e.otherPhoneNumbers.length>0?e.otherPhoneNumbers:[""],r+=";",r+=t.map((e=>e)).join(";"),i=d.slice(t.length),r+=i.join(""),r+=";",r+=e.jobTitle?e.jobTitle:"",r+=";",r+=e.eMail?e.eMail:"",r+=";",r+=e.tags&&e.tags.length>0?e.tags[0]:"",r+=";",r+=e.tags&&e.tags.length>1?e.tags[1]:"",r+=";",r+=e.tags&&e.tags.length>2?e.tags[2]:"",r+=";",r+=e.tags&&e.tags.length>3?e.tags[3]:"",r+=";",r+=e.tags&&e.tags.length>4?e.tags[4]:"",r+=";",r+=e.custom1?e.custom1:"",r+=";",r+=e.custom2?e.custom2:"",u.push(r)}));return new Blob([u.join("\r\n")],{type:"text/csv; charset=utf-8"})}catch(t){throw this.logger.error("[CompanyDirectoryService] buildDirectoryCsvBlob - "+t.message),t}}async exportDirectoryCsvFile(e){try{this.logger.info("[CompanyDirectoryService] === exportDirectoryCsvFile ===");const t="directory_"+moment().format("YYYY-MM-DD_HH-mm")+".csv";return{fileBlob:await this.buildDirectoryCsvBlob(e),fileName:t}}catch(t){throw this.logger.error("[CompanyDirectoryService] exportDirectoryCsvFile - "+t.message),t}}async getDirectoryContactById(e,t=false){try{let i=null;if(!t&&(i=this.contactService.contacts[e],i))return i;const r=`${config.restServerUrl+"/api/rainbow/directory/v1.0/"}entries/${e}?format=full`,n=this.authService.getRequestHeader(),s=await fetch(r,{method:"GET",headers:n});if(!s.ok)throw s;const o=await s.json();return this.logger.info("[CompanyDirectoryService] getDirectoryContactById success"),i=this.createAndUpdateDirectoryContact(o.data),i}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"getDirectoryContactById");return this.logger.error("[CompanyDirectoryService] getDirectoryContactById -- "+e.message),null}}createAndUpdateDirectoryContact(e){const t=this.contactService.createDirectoryContact(e.id,false);return"personal"===e.directoryType?(t.companyDirectoryFlag=false,t.personalDirectoryFlag=true):(t.companyDirectoryFlag=true,t.personalDirectoryFlag=false),t.mobilePhones=e.mobilePhoneNumbers,t.businessPhones=e.workPhoneNumbers,t.otherPhoneNumbers=e.otherPhoneNumbers,t.email=e.eMail,"company"===e.directoryType&&(t.businessCompanyId=e.companyId),t.companyName=e.companyName,t.department=e.department,t.jobTitle=e.jobTitle,t.updateName(e.firstName,e.lastName),t.note1=e.custom1,t.note2=e.custom2,t.tags=e.tags?e.tags:[],t.city=e.city,t.postalCode=e.postalCode,t.street=e.street,"personal"===e.directoryType?(t.country=e.country,t.state=e.state):(t.state=this.countryService.getStateName(e.country,e.state),t.country=this.countryService.getCountryName(e.country)),t}}t.CompanyDirectoryService=g},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7),n=i(4),s=i(8),o=i(14),a=i(9),c=i(18),l=i(6),d=i(13),u=i(136),h=i(11);class f{constructor(){this.CCD_AGENT_NAMESPACE="urn:xmpp:pbxagent:ccdfeatures:1",this.ccdAgentHandlerRef=null,this.eventNames=[],this.groupId="",this.password="",this.passwordNeeded=true,this.agentId="",this.passwordPresence=false,this.currentGroupId="",this.logActivated=false,this.wrapUpActivated=false,this.withdrawalActivated=false,this.pauseActivated=false,this.state="",this.reason="",this.value={agentId:this.agentId,passwordPresence:this.passwordPresence,currentGroupId:this.currentGroupId,logActivated:this.logActivated,wrapUpActivated:this.wrapUpActivated,withdrawalActivated:this.withdrawalActivated,pauseActivated:this.pauseActivated,reason:this.reason,state:this.state},this.eventUnregisters=[],this.xmppService=a.XmppService.getInstance(),this.logger=n.LoggerService.getInstance(),this.authService=s.AuthService.getInstance(),this.profileService=o.ProfileService.getInstance(),this.errorHelperService=d.ErrorHelperService.getInstance(),this.contactService=l.ContactService.getInstance(),this.eventService=h.EventService.getInstance(),this.onCCDAgentStatusMessageReceived=async e=>{const t=u.default(e);if(t.find("acdagent").length>0){const e=t.find("status");this.agentId=e.attr("agentId"),this.passwordPresence="true"===e.attr("passwordPresence"),this.currentGroupId=e.attr("currentGroupId"),this.state=e.attr("state"),this.reason=e.attr("reason"),this.value.agentId=this.agentId,this.value.passwordPresence=this.passwordPresence,this.value.currentGroupId=this.currentGroupId,this.value.logActivated=this.logActivated="Null"!==this.state,this.value.wrapUpActivated=this.wrapUpActivated="Work After Call"===this.state||"Not Ready Work After Call"===this.state,this.value.withdrawalActivated=this.withdrawalActivated="Not Ready"===this.state||"Not Ready Work After Call"===this.state,this.value.pauseActivated=this.pauseActivated="Not Ready Pause"===this.state,this.value.state=this.state,this.value.reason=this.reason,this.logger.info("ccdAgentStatus event received  -- state: "+this.state+" agentId: "+this.agentId+" passwordPresence: "+this.passwordPresence+" currentGroupID:  "+this.currentGroupId+" logActivated: "+this.logActivated+" wrapUpActivated: "+this.wrapUpActivated+" withdrawalActivated: "+this.withdrawalActivated+" pauseActivated: "+this.pauseActivated+" reason: "+this.reason),this.rxSubject.next(c.RBEvent.create("ON_CCD_UPDATE_EVENT",this.value))}return true}}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.ccdAgentService||(e.rainbow.ccdAgentService=new f),e.rainbow.ccdAgentService}async start(){this.logger.info("[ccdAgentService] === STARTING ===");const e=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_CCD_AGENT),t=this.contactService.userContact.isCCDAgentEnabled,i=t&&e;this.rxSubject=new r.Subject,this.logger.info("[ccdAgentService] contact is CCDAgent : "+(t?"true":"false")+", ccdAgent service is activated for this user: "+(i?"true":"false")),i?(this.connect(),this.attachHandlers(),this.eventUnregisters.push(this.eventService.subscribe("ON_TELEPHONY_STATUS_CHANGED_EVENT",((e,t)=>{"started"===t&&this.getCCDAgentStatus()}))),this.logger.info("=== STARTED ===")):this.logger.info("[ccdAgentService] === Start skipped - ccdAgent : false")}async connect(){try{await this.getCCDAgentStatus()}catch(e){this.logger.error("[ccdAgentService] connect -- Failure -- "+e.message)}}async reconnect(){try{this.logger.info("[ccdAgentService] reconnect"),this.attachHandlers()}catch(e){this.logger.error("[ccdAgentService] reconnect -- failure -- "+e.message)}}async stop(){this.logger.info("[ccdAgentService] === STOPPING ==="),this.xmppManagementHandler&&(this.xmppService.deleteHandler(this.xmppManagementHandler),this.xmppManagementHandler=null),this.eventUnregisters.forEach((e=>{e()})),this.eventUnregisters=[],this.logger.info("=== STOPPED ===")}subscribe(e){return this.rxSubject.subscribe(e)}async getCCDAgentStatus(){try{const e=config.restServerUrl+"/api/rainbow/telephony/v1.0/acd/status",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=await i.json(),n=r.data;return this.agentId=this.value.agentId=n.agentId,this.passwordPresence=this.value.passwordPresence="true"===n.passwordPresence,this.currentGroupId=this.value.currentGroupId=n.currentGroupId,this.logActivated=this.value.logActivated="Null"!==n.state,this.wrapUpActivated=this.value.wrapUpActivated="Work After Call"===n.state||"Not Ready Work After Call"===n.state,this.withdrawalActivated=this.value.withdrawalActivated="Not Ready"===n.state||"Not Ready Work After Call"===n.state,this.pauseActivated=this.value.pauseActivated="Not Ready Pause"===n.state,this.reason=this.value.reason=n.reason,this.logger.info("[CCDAgentService] ccdAgentStatus -- SUCCESS -- State: "+n.state+" agentId: "+this.agentId+" PasswordPresence: "+this.passwordPresence+" Current Group: "+this.currentGroupId+" logActivated: "+this.logActivated+" wrapUpActivated: "+this.wrapUpActivated+" withdrawalActivated: "+this.withdrawalActivated+" pauseActivated: "+this.pauseActivated+" reason: "+this.reason),this.rxSubject.next(c.RBEvent.create("ON_CCD_UPDATE_EVENT",this.value)),r.result}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getCCDAgentStatus");throw this.logger.error("[CCDAgentService] "+t.message),t.error}}async getCCDGroupStatus(e){try{const t=`${config.restServerUrl}/api/rainbow/telephony/v1.0/acd/status/group/${e}`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;const n=(await r.json()).data;return this.logger.info("[CCDAgentService] getCCDGroupStatus -- SUCCESS -- groupId: "+n.groupId+" reasonsize: "+n.reasonsSize),n}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getCCDGroupStatus");throw this.logger.error("[CCDAgentService] "+e.message),e.error}}async ccdAgentLogOn(e,t,i,r,n,s,o=""){try{const a=config.restServerUrl+"/api/rainbow/telephony/v1.0/acd/logon?analyticsMode="+o,c=this.authService.getPostHeader();this.logger.info("[CCDAgentService] ccdAgentLogOn -- endpointTel : "+e+", nomadic : "+s+", agentId : "+t+", groupId : "+r);const l={endpointTel:e,agentId:t,password:i,groupId:r,nomadicDestination:n,nomadic:s},d=await fetch(a,{method:"POST",headers:c,body:JSON.stringify(l)});if(!d.ok)throw d;const u=await d.json();return this.logger.info("[CCDAgentService] ccdAgentLogOn -- SUCCESS"),this.groupId=r,this.password=i,""===this.password&&(this.passwordNeeded=false),u.result}catch(a){const e=await this.errorHelperService.getErrorInfo(a,"ccdAgentLogOn");throw this.logger.error("[CCDAgentService] "+e.message),e.error}}async ccdAgentLogOff(e,t,i,r){try{const n=config.restServerUrl+"/api/rainbow/telephony/v1.0/acd/logoff",s=this.authService.getPostHeader(),o={endpointTel:e,agentId:t,password:i,groupId:r},a=await fetch(n,{method:"POST",headers:s,body:JSON.stringify(o)});if(!a.ok)throw a;const c=await a.json();return this.logger.info("[CCDAgentService] ccdAgentLogOff -- SUCCESS"),this.groupId="",this.password="",this.passwordNeeded=true,c.result}catch(n){const e=await this.errorHelperService.getErrorInfo(n,"ccdAgentLogOff");throw this.logger.error("[CCDAgentService] "+e.message),e.error}}async ccdAgentWrapup(e,t,i,r){try{const n=config.restServerUrl+"/api/rainbow/telephony/v1.0/acd/wrapup",s=this.authService.getPostHeader(),o={agentId:e,password:i,groupId:t,state:r},a=await fetch(n,{method:"POST",headers:s,body:JSON.stringify(o)});if(!a.ok)throw a;const c=await a.json();return this.logger.info("[CCDAgentService] ccdAgentLogWrapup "+r+" -- SUCCESS"),""===this.password&&(this.passwordNeeded=false),c.result}catch(n){this.CCDAgentStatus();const e=await this.errorHelperService.getErrorInfo(n,"ccdAgentWrapup");throw this.logger.error("[CCDAgentService] "+e.message),e.error}}async ccdAgentWithdrawal(e,t,i,r="1"){try{const n=config.restServerUrl+"/api/rainbow/telephony/v1.0/acd/withdrawal",s=this.authService.getPostHeader(),o={agentId:e,groupId:t,state:i,reason:r},a=await fetch(n,{method:"POST",headers:s,body:JSON.stringify(o)});if(!a.ok)throw a;const c=await a.json();return this.logger.info("[CCDAgentService] ccdAgentLogWithdrawal "+i+" -- SUCCESS"),""===this.password&&(this.passwordNeeded=false),c.result}catch(n){this.CCDAgentStatus();const e=await this.errorHelperService.getErrorInfo(n,"ccdAgentWithdrawal");throw this.logger.error("[CCDAgentService] "+e.message),e.error}}attachHandlers(){this.logger.info("[ccdAgentService] attachHandlers"),this.ccdAgentHandlerRef&&(this.xmppService.deleteHandler(this.ccdAgentHandlerRef),this.ccdAgentHandlerRef=null),this.ccdAgentHandlerRef=this.xmppService.addHandler((e=>this.onCCDAgentStatusMessageReceived(e)),null,"message",null)}getAgentId(){return this.agentId}getCCDAgentGroupId(){return this.groupId}getCCDAgentPasswordPresence(){return this.passwordPresence}isCCDAgentLogActivated(){return this.logActivated}isCCDAgentWrapUpActivated(){return this.wrapUpActivated}isCCDAgentWithdrawalActivated(){return this.withdrawalActivated}isCCDAgentPauseActivated(){return this.pauseActivated}isPasswordNeeded(){return this.passwordNeeded}CCDAgentState(){return this.state}getCurrentCCDAgentStatus(){return this.value}CCDAgentStatus(){this.rxSubject.next(c.RBEvent.create("ON_CCD_UPDATE_EVENT",this.value))}}t.CCDAgentService=f},function(e,t,i){var r=i(5),n=i(10),s=i(40);var o=i(90),a=i(35);var c=i(126),l=i(125);function d(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[s.a]}(e))return function(e,t){return new r.a((function(i){var r=new n.a;return r.add(t.schedule((function(){var n=e[s.a]();r.add(n.subscribe({next:function(e){r.add(t.schedule((function(){return i.next(e)})))},error:function(e){r.add(t.schedule((function(){return i.error(e)})))},complete:function(){r.add(t.schedule((function(){return i.complete()})))}}))}))),r}))}(e,t);if(Object(c.a)(e))return function(e,t){return new r.a((function(i){var r=new n.a;return r.add(t.schedule((function(){return e.then((function(e){r.add(t.schedule((function(){i.next(e),r.add(t.schedule((function(){return i.complete()})))})))}),(function(e){r.add(t.schedule((function(){return i.error(e)})))}))}))),r}))}(e,t);if(Object(l.a)(e))return Object(o.a)(e,t);if(function(e){return e&&"function"==typeof e[a.a]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new r.a((function(i){var r,s=new n.a;return s.add((function(){r&&"function"==typeof r.return&&r.return()})),s.add(t.schedule((function(){r=e[a.a](),s.add(t.schedule((function(){if(!i.closed){var e,t;try{var n=r.next();e=n.value,t=n.done}catch(dp){return void i.error(dp)}t?i.complete():(i.next(e),this.schedule())}})))}))),s}))}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}i.d(t,"a",(function(){return d}))},function(e,t,i){i.d(t,"a",(function(){return n}));var r=i(0),n=function(e){function t(t,i){var r=e.call(this)||this;return r.subject=t,r.subscriber=i,r.closed=false,r}return r.a(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=true;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var i=t.indexOf(this.subscriber);-1!==i&&t.splice(i,1)}}},t}(i(10).a)},function(e,t,i){i.d(t,"a",(function(){return r}));var r=function(e){return function(t){for(var i=0,r=e.length;i<r&&!t.closed;i++)t.next(e[i]);t.complete()}}},function(e,t,i){i.d(t,"a",(function(){return r}));var r=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e}},function(e,t,i){function r(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}i.d(t,"a",(function(){return r}))},function(e,t,i){function r(e,t){function i(){return!i.pred.apply(i.thisArg,arguments)}return i.pred=e,i.thisArg=t,i}i.d(t,"a",(function(){return r}))},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{constructor(e){this.id=e.id,this.name=e.name,this.visibility=e.visibility,this.companies=[]}static createFromData(e){return new r(e)}}t.Organisation=r},function(e,t,i){var r;r=function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:false,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=true,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:true,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:true})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:true,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s="./src/strophe.js")}({"./node_modules/webpack/buildin/global.js":
/*!***********************************!*\
          !*** (webpack)/buildin/global.js ***!
          \***********************************/
/*! no static exports found */function(e,t){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(r){"object"==typeof window&&(i=window)}e.exports=i},"./src/bosh.js":
/*!*********************!*\
          !*** ./src/bosh.js ***!
          \*********************/
/*! no exports provided */function(e,t,i){i.r(t);var r=i(
/*! core */
"./src/core.js"),n=r.default.Strophe,s=r.default.$build;n.Request=function(e,t,i,r){this.id=++n._requestId,this.xmlData=e,this.data=n.serialize(e),this.origFunc=t,this.func=t,this.rid=i,this.date=NaN,this.sends=r||0,this.abort=false,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()},n.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if("parsererror"===(e=this.xhr.responseXML.documentElement).tagName)throw n.error("invalid response received"),n.error("responseText: "+this.xhr.responseText),n.error("responseXML: "+n.serialize(this.xhr.responseXML)),new Error("parsererror")}else if(this.xhr.responseText){if(n.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),!(e=(new DOMParser).parseFromString(this.xhr.responseText,"application/xml").documentElement))throw new Error("Parsing produced null node");if(e.querySelector("parsererror")){n.error("invalid response received: "+e.querySelector("parsererror").textContent),n.error("responseText: "+this.xhr.responseText);var t=new Error;throw t.name=n.ErrorCondition.BAD_FORMAT,t}}return e},_newXHR:function(){var e=null;return window.XMLHttpRequest?(e=new XMLHttpRequest).overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8"):window.ActiveXObject&&(e=new ActiveXObject("Microsoft.XMLHTTP")),e.onreadystatechange=this.func.bind(null,this),e}},n.Bosh=function(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]},n.Bosh.prototype={strip:null,_buildBody:function(){var e=s("body",{rid:this.rid++,xmlns:n.NS.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),e},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(e,t,i){this.wait=e||this.wait,this.hold=t||this.hold,this.errors=0;var r=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":n.NS.BOSH});i&&r.attrs({route:i});var s=this._conn._connect_cb;this._requests.push(new n.Request(r.tree(),this._onRequestStateChange.bind(this,s.bind(this._conn)),r.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,t,i,r,s,o,a){this._conn.jid=e,this.sid=t,this.rid=i,this._conn.connect_callback=r,this._conn.domain=n.getDomainFromJid(this._conn.jid),this._conn.authenticated=true,this._conn.connected=true,this.wait=s||this.wait,this.hold=o||this.hold,this.window=a||this.window,this._conn._changeConnectStatus(n.Status.ATTACHED,null)},_restore:function(e,t,i,r,s){var o=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(null!=o&&o.rid&&o.sid&&o.jid&&(null==e||n.getBareJidFromJid(o.jid)===n.getBareJidFromJid(e)||null===n.getNodeFromJid(e)&&n.getDomainFromJid(o.jid)===e))){var a=new Error("_restore: no restoreable session.");throw a.name="StropheSessionError",a}this._conn.restored=true,this._attach(o.jid,o.sid,o.rid,t,i,r,s)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(e){var t=e.getAttribute("type");if(null!==t&&"terminate"===t){var i=e.getAttribute("condition");n.error("BOSH-Connection failed: "+i);var r=e.getElementsByTagName("conflict");return null!==i?("remote-stream-error"===i&&r.length>0&&(i="conflict"),this._conn._changeConnectStatus(n.Status.CONNFAIL,i)):this._conn._changeConnectStatus(n.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(i),n.Status.CONNFAIL}this.sid||(this.sid=e.getAttribute("sid"));var s=e.getAttribute("requests");s&&(this.window=parseInt(s,10));var o=e.getAttribute("hold");o&&(this.hold=parseInt(o,10));var a=e.getAttribute("wait");a&&(this.wait=parseInt(a,10));var c=e.getAttribute("inactivity");c&&(this.inactivity=parseInt(c,10))},_disconnect:function(e){this._sendTerminate(e)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(e){var t=this._getRequestStatus(e),i=this._conn.protocolErrorHandlers.HTTP[t];i&&i.call(this,t)},_hitError:function(e){this.errors++,n.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(e){n.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);var t=this._buildBody();this._requests.push(new n.Request(t.tree(),this._onRequestStateChange.bind(this,e),t.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(;this._requests.length>0;){var e=this._requests.pop();e.abort=true,e.xhr.abort(),e.xhr.onreadystatechange=function(){}}},_onIdle:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(n.info("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){for(var t=this._buildBody(),i=0;i<e.length;i++)null!==e[i]&&("restart"===e[i]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":n.NS.BOSH}):t.cnode(e[i]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new n.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var r=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(n.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),r>Math.floor(n.TIMEOUT*this.wait)&&(n.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(n.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_getRequestStatus:function(e,t){var i;if(4===e.xhr.readyState)try{i=e.xhr.status}catch(r){n.error("Caught an error while retrieving a request's status, reqStatus: "+i)}return void 0===i&&(i="number"==typeof t?t:0),i},_onRequestStateChange:function(e,t){if(n.debug("request id "+t.id+"."+t.sends+" state changed to "+t.xhr.readyState),t.abort)t.abort=false;else if(4===t.xhr.readyState){var i=this._getRequestStatus(t);if(this.lastResponseHeaders=t.xhr.getAllResponseHeaders(),this.disconnecting&&i>=400)return this._hitError(i),void this._callProtocolErrorHandlers(t);var r=i>0&&i<500,s=t.sends>this._conn.maxRetries;if((r||s)&&(this._removeRequest(t),n.debug("request id "+t.id+" should now be removed")),200===i){var o=this._requests[0]===t;(this._requests[1]===t||o&&this._requests.length>0&&this._requests[0].age()>Math.floor(n.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(t.rid)+1),n.debug("request id "+t.id+"."+t.sends+" got 200"),e(t),this.errors=0}else 0===i||i>=400&&i<600||i>=12e3?(n.error("request id "+t.id+"."+t.sends+" error "+i+" happened"),this._hitError(i),this._callProtocolErrorHandlers(t),i>=400&&i<500&&(this._conn._changeConnectStatus(n.Status.DISCONNECTING,null),this._conn._doDisconnect())):n.error("request id "+t.id+"."+t.sends+" error "+i+" happened");r||s?s&&!this._conn.connected&&this._conn._changeConnectStatus(n.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}},_processRequest:function(e){var t=this,i=this._requests[e],r=this._getRequestStatus(i,-1);if(i.sends>this._conn.maxRetries)this._conn._onDisconnectTimeout();else{var s=i.age(),o=!isNaN(s)&&s>Math.floor(n.TIMEOUT*this.wait),a=null!==i.dead&&i.timeDead()>Math.floor(n.SECONDARY_TIMEOUT*this.wait),c=4===i.xhr.readyState&&(r<1||r>=500);if((o||a||c)&&(a&&n.error("Request ".concat(this._requests[e].id," timed out (secondary), restarting")),i.abort=true,i.xhr.abort(),i.xhr.onreadystatechange=function(){},this._requests[e]=new n.Request(i.xmlData,i.origFunc,i.rid,i.sends),i=this._requests[e]),0===i.xhr.readyState){n.debug("request id "+i.id+"."+i.sends+" posting");try{var l=this._conn.options.contentType||"text/xml; charset=utf-8";i.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==i.xhr.setRequestHeader&&i.xhr.setRequestHeader("Content-Type",l),this._conn.options.withCredentials&&(i.xhr.withCredentials=true)}catch(h){return n.error("XHR open failed: "+h.toString()),this._conn.connected||this._conn._changeConnectStatus(n.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var d=function(){if(i.date=new Date,t._conn.options.customHeaders){var e=t._conn.options.customHeaders;for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&i.xhr.setRequestHeader(r,e[r])}i.xhr.send(i.data)};if(i.sends>1){var u=1e3*Math.min(Math.floor(n.TIMEOUT*this.wait),Math.pow(i.sends,3));setTimeout((function(){d()}),u)}else d();i.sends++,this._conn.xmlOutput!==n.Connection.prototype.xmlOutput&&(i.xmlData.nodeName===this.strip&&i.xmlData.childNodes.length?this._conn.xmlOutput(i.xmlData.childNodes[0]):this._conn.xmlOutput(i.xmlData)),this._conn.rawOutput!==n.Connection.prototype.rawOutput&&this._conn.rawOutput(i.data)}else n.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+i.xhr.readyState)}},_removeRequest:function(e){n.debug("removing request");for(var t=this._requests.length-1;t>=0;t--)e===this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(e){var t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)},_reqToData:function(e){try{return e.getResponse()}catch(t){if("parsererror"!==t.message)throw t;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){n.info("_sendTerminate was called");var t=this._buildBody().attrs({type:"terminate"});e&&t.cnode(e.tree());var i=new n.Request(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),t.tree().getAttribute("rid"));this._requests.push(i),this._throttledRequestHandler()},_send:function(){var e=this;clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout((function(){return e._conn._onIdle()}),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?n.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):n.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}}},"./src/core.js":
/*!*********************!*\
          !*** ./src/core.js ***!
          \*********************/
/*! exports provided: Strophe, $build, $iq, $msg, $pres, SHA1, MD5, default */function(e,t,i){i.r(t),i.d(t,"Strophe",(function(){return h})),i.d(t,"$build",(function(){return c})),i.d(t,"$iq",(function(){return d})),i.d(t,"$msg",(function(){return l})),i.d(t,"$pres",(function(){return u}));var r=i(
/*! md5 */
"./src/md5.js");i.d(t,"MD5",(function(){return r.default}));var n=i(
/*! sha1 */
"./src/sha1.js");i.d(t,"SHA1",(function(){return n.default}));var s=i(
/*! utils */
"./src/utils.js");function o(e){return function(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){return new h.Builder(e,t)}function l(e){return new h.Builder("message",e)}function d(e){return new h.Builder("iq",e)}function u(e){return new h.Builder("presence",e)}var h={VERSION:"1.3.1",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(e){for(var t=0;t<h.XHTML.tags.length;t++)if(e===h.XHTML.tags[t])return true;return false},validAttribute:function(e,t){if(void 0!==h.XHTML.attributes[e]&&h.XHTML.attributes[e].length>0){for(var i=0;i<h.XHTML.attributes[e].length;i++)if(t===h.XHTML.attributes[e][i])return true}return false},validCSS:function(e){for(var t=0;t<h.XHTML.css.length;t++)if(e===h.XHTML.css[t])return true;return false}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(e,t){h.NS[e]=t},forEachChild:function(e,t,i){for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];n.nodeType!==h.ElementType.NORMAL||t&&!this.isTagEqual(n,t)||i(n)}},isTagEqual:function(e,t){return e.tagName===t},_xmlGenerator:null,_makeGenerator:function(){var e;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(e=this._getIEXmlDom()).appendChild(e.createElement("strophe")):e=document.implementation.createDocument("jabber:client","strophe",null),e},xmlGenerator:function(){return h._xmlGenerator||(h._xmlGenerator=h._makeGenerator()),h._xmlGenerator},_getIEXmlDom:function(){for(var e=null,t=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],i=0;i<t.length&&null===e;i++)try{e=new ActiveXObject(t[i])}catch(r){e=null}return e},xmlElement:function(e){if(!e)return null;for(var t=h.xmlGenerator().createElement(e),i=1;i<arguments.length;i++){var r=arguments[i];if(r){if("string"==typeof r||"number"==typeof r)t.appendChild(h.xmlTextNode(r));else if("object"===a(r)&&"function"==typeof r.sort)for(var n=0;n<r.length;n++){var s=r[n];"object"===a(s)&&"function"==typeof s.sort&&void 0!==s[1]&&null!==s[1]&&t.setAttribute(s[0],s[1])}else if("object"===a(r))for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&void 0!==r[o]&&null!==r[o]&&t.setAttribute(o,r[o])}}return t},xmlescape:function(e){return e=(e=(e=(e=(e=e.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")},xmlunescape:function(e){return e=(e=(e=(e=(e=e.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')},xmlTextNode:function(e){return h.xmlGenerator().createTextNode(e)},xmlHtmlNode:function(e){var t;return DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e)),t},getText:function(e){if(!e)return null;var t="";0===e.childNodes.length&&e.nodeType===h.ElementType.TEXT&&(t+=e.nodeValue);for(var i=0;i<e.childNodes.length;i++)e.childNodes[i].nodeType===h.ElementType.TEXT&&(t+=e.childNodes[i].nodeValue);return h.xmlescape(t)},copyElement:function(e){var t;if(e.nodeType===h.ElementType.NORMAL){t=h.xmlElement(e.tagName);for(var i=0;i<e.attributes.length;i++)t.setAttribute(e.attributes[i].nodeName,e.attributes[i].value);for(var r=0;r<e.childNodes.length;r++)t.appendChild(h.copyElement(e.childNodes[r]))}else e.nodeType===h.ElementType.TEXT&&(t=h.xmlGenerator().createTextNode(e.nodeValue));return t},createHtml:function(e){var t;if(e.nodeType===h.ElementType.NORMAL){var i=e.nodeName.toLowerCase();if(h.XHTML.validTag(i))try{t=h.xmlElement(i);for(var r=0;r<h.XHTML.attributes[i].length;r++){var n=h.XHTML.attributes[i][r],s=e.getAttribute(n);if(null!=s&&""!==s&&false!==s&&0!==s)if("style"===n&&"object"===a(s)&&void 0!==s.cssText&&(s=s.cssText),"style"===n){for(var o=[],c=s.split(";"),l=0;l<c.length;l++){var d=c[l].split(":"),u=d[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(h.XHTML.validCSS(u)){var f=d[1].replace(/^\s*/,"").replace(/\s*$/,"");o.push(u+": "+f)}}o.length>0&&(s=o.join("; "),t.setAttribute(n,s))}else t.setAttribute(n,s)}for(var p=0;p<e.childNodes.length;p++)t.appendChild(h.createHtml(e.childNodes[p]))}catch(v){t=h.xmlTextNode("")}else{t=h.xmlGenerator().createDocumentFragment();for(var g=0;g<e.childNodes.length;g++)t.appendChild(h.createHtml(e.childNodes[g]))}}else if(e.nodeType===h.ElementType.FRAGMENT){t=h.xmlGenerator().createDocumentFragment();for(var m=0;m<e.childNodes.length;m++)t.appendChild(h.createHtml(e.childNodes[m]))}else e.nodeType===h.ElementType.TEXT&&(t=h.xmlTextNode(e.nodeValue));return t},escapeNode:function(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(e){return"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(e){return e.indexOf("@")<0?null:e.split("@")[0]},getDomainFromJid:function(e){var t=h.getBareJidFromJid(e);if(t.indexOf("@")<0)return t;var i=t.split("@");return i.splice(0,1),i.join("@")},getResourceFromJid:function(e){var t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))},getBareJidFromJid:function(e){return e?e.split("/")[0]:null},_handleError:function(e){void 0!==e.stack&&h.fatal(e.stack),e.sourceURL?h.fatal("error: "+this.handler+" "+e.sourceURL+":"+e.line+" - "+e.name+": "+e.message):e.fileName?h.fatal("error: "+this.handler+" "+e.fileName+":"+e.lineNumber+" - "+e.name+": "+e.message):h.fatal("error: "+e.message)},log:function(e,t){e===this.LogLevel.FATAL&&"object"===a(window.console)&&"function"==typeof window.console.error&&window.console.error(t)},debug:function(e){this.log(this.LogLevel.DEBUG,e)},info:function(e){this.log(this.LogLevel.INFO,e)},warn:function(e){this.log(this.LogLevel.WARN,e)},error:function(e){this.log(this.LogLevel.ERROR,e)},fatal:function(e){this.log(this.LogLevel.FATAL,e)},serialize:function(e){if(!e)return null;"function"==typeof e.tree&&(e=e.tree());var t=o(Array(e.attributes.length).keys()).map((function(t){return e.attributes[t].nodeName}));t.sort();var i=t.reduce((function(t,i){return"".concat(t," ").concat(i,'="').concat(h.xmlescape(e.attributes.getNamedItem(i).value),'"')}),"<".concat(e.nodeName));if(e.childNodes.length>0){i+=">";for(var r=0;r<e.childNodes.length;r++){var n=e.childNodes[r];switch(n.nodeType){case h.ElementType.NORMAL:i+=h.serialize(n);break;case h.ElementType.TEXT:i+=h.xmlescape(n.nodeValue);break;case h.ElementType.CDATA:i+="<![CDATA["+n.nodeValue+"]]>"}}i+="</"+e.nodeName+">"}else i+="/>";return i},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(e,t){h._connectionPlugins[e]=t},Builder:function(e,t){"presence"!==e&&"message"!==e&&"iq"!==e||(t&&!t.xmlns?t.xmlns=h.NS.CLIENT:t||(t={xmlns:h.NS.CLIENT})),this.nodeTree=h.xmlElement(e,t),this.node=this.nodeTree}};h.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return h.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(void 0===e[t]?this.node.removeAttribute(t):this.node.setAttribute(t,e[t]));return this},c:function(e,t,i){var r=h.xmlElement(e,t,i);return this.node.appendChild(r),"string"!=typeof i&&"number"!=typeof i&&(this.node=r),this},cnode:function(e){var t,i=h.xmlGenerator();try{t=void 0!==i.importNode}catch(n){t=false}var r=t?i.importNode(e,true):h.copyElement(e);return this.node.appendChild(r),this.node=r,this},t:function(e){var t=h.xmlTextNode(e);return this.node.appendChild(t),this},h:function(e){var t=document.createElement("body");t.innerHTML=e;for(var i=h.createHtml(t);i.childNodes.length>0;)this.node.appendChild(i.childNodes[0]);return this}},h.Handler=function(e,t,i,r,n,s,o){this.handler=e,this.ns=t,this.name=i,this.type=r,this.id=n,this.options=o||{matchBareFromJid:false,ignoreNamespaceFragment:false},this.options.matchBare&&(h.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=s?h.getBareJidFromJid(s):null:this.from=s,this.user=true},h.Handler.prototype={getNamespace:function(e){var t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t},namespaceMatch:function(e){var t=this,i=false;return!this.ns||(h.forEachChild(e,null,(function(e){t.getNamespace(e)===t.ns&&(i=true)})),i||this.getNamespace(e)===this.ns)},isMatch:function(e){var t=e.getAttribute("from");this.options.matchBareFromJid&&(t=h.getBareJidFromJid(t));var i=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!h.isTagEqual(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(i):i!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)},run:function(e){var t=null;try{t=this.handler(e)}catch(i){throw h._handleError(i),i}return t},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},h.TimedHandler=function(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=true},h.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},h.Connection=function(e,t){var i=this;this.service=e,this.options=t||{};var r=this.options.protocol||"";for(var n in 0===e.indexOf("ws:")||0===e.indexOf("wss:")||0===r.indexOf("ws")?this._proto=new h.Websocket(this):this._proto=new h.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=false,this.do_bind=false,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=false,this.connected=false,this.disconnecting=false,this.do_authentication=true,this.paused=false,this.restored=false,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout((function(){return i._onIdle()}),100),s.default.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),h._connectionPlugins)if(Object.prototype.hasOwnProperty.call(h._connectionPlugins,n)){var o=function(){};o.prototype=h._connectionPlugins[n],this[n]=new o,this[n].init(this)}},h.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=false,this.do_bind=false,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=false,this.connected=false,this.disconnecting=false,this.restored=false,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=true},resume:function(){this.paused=false},getUniqueId:function(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?t+":"+e:t+""},addProtocolErrorHandler:function(e,t,i){this.protocolErrorHandlers[e][t]=i},connect:function(e,t,i,r,n,s,o){this.jid=e,this.authzid=h.getBareJidFromJid(this.jid),this.authcid=o||h.getNodeFromJid(this.jid),this.pass=t,this.servtype="xmpp",this.connect_callback=i,this.disconnecting=false,this.connected=false,this.authenticated=false,this.restored=false,this.domain=h.getDomainFromJid(this.jid),this._changeConnectStatus(h.Status.CONNECTING,null),this._proto._connect(r,n,s)},attach:function(e,t,i,r,n,s,o){if(!(this._proto instanceof h.Bosh)){var a=new Error('The "attach" method can only be used with a BOSH connection.');throw a.name="StropheSessionError",a}this._proto._attach(e,t,i,r,n,s,o)},restore:function(e,t,i,r,n){if(!this._sessionCachingSupported()){var s=new Error('The "restore" method can only be used with a BOSH connection.');throw s.name="StropheSessionError",s}this._proto._restore(e,t,i,r,n)},_sessionCachingSupported:function(){if(this._proto instanceof h.Bosh){if(!JSON)return false;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return false}return true}return false},xmlInput:function(e){},xmlOutput:function(e){},rawInput:function(e){},rawOutput:function(e){},nextValidRid:function(e){},send:function(e){if(null!==e){if("function"==typeof e.sort)for(var t=0;t<e.length;t++)this._queueData(e[t]);else"function"==typeof e.tree?this._queueData(e.tree()):this._queueData(e);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(e,t,i,r){var n=this,s=null;"function"==typeof e.tree&&(e=e.tree());var o=e.getAttribute("id");if(o||(o=this.getUniqueId("sendPresence"),e.setAttribute("id",o)),"function"==typeof t||"function"==typeof i){var a=this.addHandler((function(e){s&&n.deleteTimedHandler(s),"error"===e.getAttribute("type")?i&&i(e):t&&t(e)}),null,"presence",null,o);r&&(s=this.addTimedHandler(r,(function(){return n.deleteHandler(a),i&&i(null),false})))}return this.send(e),o},sendIQ:function(e,t,i,r){var n=this,s=null;"function"==typeof e.tree&&(e=e.tree());var o=e.getAttribute("id");if(o||(o=this.getUniqueId("sendIQ"),e.setAttribute("id",o)),"function"==typeof t||"function"==typeof i){var a=this.addHandler((function(e){s&&n.deleteTimedHandler(s);var r=e.getAttribute("type");if("result"===r)t&&t(e);else{if("error"!==r){var o=new Error("Got bad IQ type of ".concat(r));throw o.name="StropheError",o}i&&i(e)}}),null,"iq",["error","result"],o);r&&(s=this.addTimedHandler(r,(function(){return n.deleteHandler(a),i&&i(null),false})))}return this.send(e),o},_queueData:function(e){if(null===e||!e.tagName||!e.childNodes){var t=new Error("Cannot queue non-DOMElement.");throw t.name="StropheError",t}this._data.push(e)},_sendRestart:function(){var e=this;this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout((function(){return e._onIdle()}),100)},addTimedHandler:function(e,t){var i=new h.TimedHandler(e,t);return this.addTimeds.push(i),i},deleteTimedHandler:function(e){this.removeTimeds.push(e)},addHandler:function(e,t,i,r,n,s,o){var a=new h.Handler(e,t,i,r,n,s,o);return this.addHandlers.push(a),a},deleteHandler:function(e){this.removeHandlers.push(e);var t=this.addHandlers.indexOf(e);t>=0&&this.addHandlers.splice(t,1)},registerSASLMechanisms:function(e){this.mechanisms={},(e=e||[h.SASLAnonymous,h.SASLExternal,h.SASLMD5,h.SASLOAuthBearer,h.SASLXOAuth2,h.SASLPlain,h.SASLSHA1]).forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(e){this.mechanisms[e.prototype.name]=e},disconnect:function(e){if(this._changeConnectStatus(h.Status.DISCONNECTING,e),h.info("Disconnect was called because: "+e),this.connected){var t=false;this.disconnecting=true,this.authenticated&&(t=u({xmlns:h.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(t)}else h.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()},_changeConnectStatus:function(e,t,i){for(var r in h._connectionPlugins)if(Object.prototype.hasOwnProperty.call(h._connectionPlugins,r)){var n=this[r];if(n.statusChanged)try{n.statusChanged(e,t)}catch(dp){h.error("".concat(r," plugin caused an exception changing status: ").concat(dp))}}if(this.connect_callback)try{this.connect_callback(e,t,i)}catch(s){h._handleError(s),h.error("User connection callback caused an exception: ".concat(s))}},_doDisconnect:function(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),h.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=false,this.disconnecting=false,this.restored=false,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(h.Status.DISCONNECTED,e),this.connected=false},_dataRecv:function(e,t){var i=this;h.info("_dataRecv called");var r=this._proto._reqToData(e);if(null!==r){for(this.xmlInput!==h.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==h.Connection.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(h.serialize(r)));this.removeHandlers.length>0;){var n=this.removeHandlers.pop(),s=this.handlers.indexOf(n);s>=0&&this.handlers.splice(s,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())this._doDisconnect();else{var o=r.getAttribute("type");if(null!==o&&"terminate"===o){if(this.disconnecting)return;var a=r.getAttribute("condition"),c=r.getElementsByTagName("conflict");return null!==a?("remote-stream-error"===a&&c.length>0&&(a="conflict"),this._changeConnectStatus(h.Status.CONNFAIL,a)):this._changeConnectStatus(h.Status.CONNFAIL,h.ErrorCondition.UNKOWN_REASON),void this._doDisconnect(a)}h.forEachChild(r,null,(function(e){var t=i.handlers;i.handlers=[];for(var r=0;r<t.length;r++){var n=t[r];try{(!n.isMatch(e)||!i.authenticated&&n.user||n.run(e))&&i.handlers.push(n)}catch(s){h.warn("Removing Strophe handlers due to uncaught exception: "+s.message)}}}))}}},mechanisms:{},_connect_cb:function(e,t,i){var r;h.info("_connect_cb was called"),this.connected=true;try{r=this._proto._reqToData(e)}catch(c){if(c.name!==h.ErrorCondition.BAD_FORMAT)throw c;this._changeConnectStatus(h.Status.CONNFAIL,h.ErrorCondition.BAD_FORMAT),this._doDisconnect(h.ErrorCondition.BAD_FORMAT)}if(r&&(this.xmlInput!==h.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==h.Connection.prototype.rawInput&&(i?this.rawInput(i):this.rawInput(h.serialize(r))),this._proto._connect_cb(r)!==h.Status.CONNFAIL))if(r.getElementsByTagNameNS?r.getElementsByTagNameNS(h.NS.STREAM,"features").length>0:r.getElementsByTagName("stream:features").length>0||r.getElementsByTagName("features").length>0){var n=[],s=r.getElementsByTagName("mechanism");if(s.length>0)for(var o=0;o<s.length;o++){var a=h.getText(s[o]);this.mechanisms[a]&&n.push(this.mechanisms[a])}0!==n.length||0!==r.getElementsByTagName("auth").length?false!==this.do_authentication&&this.authenticate(n):this._proto._no_auth_received(t)}else this._proto._no_auth_received(t)},sortMechanismsByPriority:function(e){for(var t=0;t<e.length-1;++t){for(var i=t,r=t+1;r<e.length;++r)e[r].prototype.priority>e[i].prototype.priority&&(i=r);if(i!==t){var n=e[t];e[t]=e[i],e[i]=n}}return e},_attemptSASLAuth:function(e){e=this.sortMechanismsByPriority(e||[]);for(var t=false,i=0;i<e.length;++i)if(e[i].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new e[i],this._sasl_mechanism.onStart(this);var r=c("auth",{xmlns:h.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var n=this._sasl_mechanism.onChallenge(this,null);r.t(btoa(n))}this.send(r.tree()),t=true;break}return t},_attemptLegacyAuth:function(){null===h.getNodeFromJid(this.jid)?(this._changeConnectStatus(h.Status.CONNFAIL,h.ErrorCondition.MISSING_JID_NODE),this.disconnect(h.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(h.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(d({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:h.NS.AUTH}).c("username",{}).t(h.getNodeFromJid(this.jid)).tree()))},authenticate:function(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()},_sasl_challenge_cb:function(e){var t=atob(h.getText(e)),i=this._sasl_mechanism.onChallenge(this,t),r=c("response",{xmlns:h.NS.SASL});return""!==i&&r.t(btoa(i)),this.send(r.tree()),true},_auth1_cb:function(e){var t=d({type:"set",id:"_auth_2"}).c("query",{xmlns:h.NS.AUTH}).c("username",{}).t(h.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return h.getResourceFromJid(this.jid)||(this.jid=h.getBareJidFromJid(this.jid)+"/strophe"),t.up().c("resource",{}).t(h.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),false},_sasl_success_cb:function(e){var t=this;if(this._sasl_data["server-signature"]){var i,r=atob(h.getText(e)).match(/([a-z]+)=([^,]+)(,|$)/);if("v"===r[1]&&(i=r[2]),i!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}h.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var n=[],s=function(e,i){for(;e.length;)t.deleteHandler(e.pop());return t._sasl_auth1_cb(i),false};return n.push(this._addSysHandler((function(e){return s(n,e)}),null,"stream:features",null,null)),n.push(this._addSysHandler((function(e){return s(n,e)}),h.NS.STREAM,"features",null,null)),this._sendRestart(),false},_sasl_auth1_cb:function(e){this.features=e;for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];"bind"===i.nodeName&&(this.do_bind=true),"session"===i.nodeName&&(this.do_session=true)}if(!this.do_bind)return this._changeConnectStatus(h.Status.AUTHFAIL,null),false;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var r=h.getResourceFromJid(this.jid);return r?this.send(d({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:h.NS.BIND}).c("resource",{}).t(r).tree()):this.send(d({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:h.NS.BIND}).tree()),false},_sasl_bind_cb:function(e){var t;if("error"===e.getAttribute("type"))return h.info("SASL binding failed."),e.getElementsByTagName("conflict").length>0&&(t=h.ErrorCondition.CONFLICT),this._changeConnectStatus(h.Status.AUTHFAIL,t,e),false;var i=e.getElementsByTagName("bind");if(!(i.length>0))return h.info("SASL binding failed."),this._changeConnectStatus(h.Status.AUTHFAIL,null,e),false;var r=i[0].getElementsByTagName("jid");r.length>0&&(this.jid=h.getText(r[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(d({type:"set",id:"_session_auth_2"}).c("session",{xmlns:h.NS.SESSION}).tree())):(this.authenticated=true,this._changeConnectStatus(h.Status.CONNECTED,null)))},_sasl_session_cb:function(e){if("result"===e.getAttribute("type"))this.authenticated=true,this._changeConnectStatus(h.Status.CONNECTED,null);else if("error"===e.getAttribute("type"))return h.info("Session creation failed."),this._changeConnectStatus(h.Status.AUTHFAIL,null,e),false;return false},_sasl_failure_cb:function(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(h.Status.AUTHFAIL,null,e),false},_auth2_cb:function(e){return"result"===e.getAttribute("type")?(this.authenticated=true,this._changeConnectStatus(h.Status.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus(h.Status.AUTHFAIL,null,e),this.disconnect("authentication failed")),false},_addSysTimedHandler:function(e,t){var i=new h.TimedHandler(e,t);return i.user=false,this.addTimeds.push(i),i},_addSysHandler:function(e,t,i,r,n){var s=new h.Handler(e,t,i,r,n);return s.user=false,this.addHandlers.push(s),s},_onDisconnectTimeout:function(){return h.info("_onDisconnectTimeout was called"),this._changeConnectStatus(h.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),false},_onIdle:function(){for(var e=this;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;){var t=this.removeTimeds.pop(),i=this.timedHandlers.indexOf(t);i>=0&&this.timedHandlers.splice(i,1)}for(var r=(new Date).getTime(),n=[],s=0;s<this.timedHandlers.length;s++){var o=this.timedHandlers[s];!this.authenticated&&o.user||(o.lastCalled+o.period-r<=0?o.run()&&n.push(o):n.push(o))}this.timedHandlers=n,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout((function(){return e._onIdle()}),100))}},h.SASLMechanism=function(e,t,i){this.name=e,this.isClientFirst=t,this.priority=i},h.SASLMechanism.prototype={test:function(e){return true},onStart:function(e){this._connection=e},onChallenge:function(e,t){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},h.SASLAnonymous=function(){},h.SASLAnonymous.prototype=new h.SASLMechanism("ANONYMOUS",false,20),h.SASLAnonymous.prototype.test=function(e){return null===e.authcid},h.SASLPlain=function(){},h.SASLPlain.prototype=new h.SASLMechanism("PLAIN",true,50),h.SASLPlain.prototype.test=function(e){return null!==e.authcid},h.SASLPlain.prototype.onChallenge=function(e){var t=e.authzid;return t+="\0",t+=e.authcid,t+="\0",t+=e.pass,s.default.utf16to8(t)},h.SASLSHA1=function(){},h.SASLSHA1.prototype=new h.SASLMechanism("SCRAM-SHA-1",true,70),h.SASLSHA1.prototype.test=function(e){return null!==e.authcid},h.SASLSHA1.prototype.onChallenge=function(e,t,i){var o=i||r.default.hexdigest(1234567890*Math.random()),a="n="+s.default.utf16to8(e.authcid);return a+=",r=",a+=o,e._sasl_data.cnonce=o,e._sasl_data["client-first-message-bare"]=a,a="n,,"+a,this.onChallenge=function(e,t){for(var i,r,o,a,c,l,d,u,h="c=biws,",f="".concat(e._sasl_data["client-first-message-bare"],",").concat(t,","),p=e._sasl_data.cnonce,g=/([a-z]+)=([^,]+)(,|$)/;t.match(g);){var m=t.match(g);switch(t=t.replace(m[0],""),m[1]){case"r":i=m[2];break;case"s":r=m[2];break;case"i":o=m[2]}}if(i.substr(0,p.length)!==p)return e._sasl_data={},e._sasl_failure_cb();f+=h+="r="+i,r=atob(r),r+="\0\0\0";var v=s.default.utf16to8(e.pass);for(a=l=n.default.core_hmac_sha1(v,r),d=1;d<o;d++){for(c=n.default.core_hmac_sha1(v,n.default.binb2str(l)),u=0;u<5;u++)a[u]^=c[u];l=c}a=n.default.binb2str(a);var S=n.default.core_hmac_sha1(a,"Client Key"),b=n.default.str_hmac_sha1(a,"Server Key"),y=n.default.core_hmac_sha1(n.default.str_sha1(n.default.binb2str(S)),f);for(e._sasl_data["server-signature"]=n.default.b64_hmac_sha1(b,f),u=0;u<5;u++)S[u]^=y[u];return h+=",p="+btoa(n.default.binb2str(S))},a},h.SASLMD5=function(){},h.SASLMD5.prototype=new h.SASLMechanism("DIGEST-MD5",false,60),h.SASLMD5.prototype.test=function(e){return null!==e.authcid},h.SASLMD5.prototype._quote=function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},h.SASLMD5.prototype.onChallenge=function(e,t,i){for(var n=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,o=i||r.default.hexdigest(""+1234567890*Math.random()),a="",c=null,l="";t.match(n);){var d=t.match(n);switch(t=t.replace(d[0],""),d[2]=d[2].replace(/^"(.+)"$/,"$1"),d[1]){case"realm":a=d[2];break;case"nonce":l=d[2];break;case"qop":d[2];break;case"host":c=d[2]}}var u=e.servtype+"/"+e.domain;null!==c&&(u=u+"/"+c);var h=s.default.utf16to8(e.authcid+":"+a+":"+this._connection.pass),f=r.default.hash(h)+":"+l+":"+o,p="AUTHENTICATE:"+u,g="";return g+="charset=utf-8,",g+="username="+this._quote(s.default.utf16to8(e.authcid))+",",g+="realm="+this._quote(a)+",",g+="nonce="+this._quote(l)+",",g+="nc=00000001,",g+="cnonce="+this._quote(o)+",",g+="digest-uri="+this._quote(u)+",",g+="response="+r.default.hexdigest(r.default.hexdigest(f)+":"+l+":00000001:"+o+":auth:"+r.default.hexdigest(p))+",",g+="qop=auth",this.onChallenge=function(){return""},g},h.SASLOAuthBearer=function(){},h.SASLOAuthBearer.prototype=new h.SASLMechanism("OAUTHBEARER",true,40),h.SASLOAuthBearer.prototype.test=function(e){return null!==e.pass},h.SASLOAuthBearer.prototype.onChallenge=function(e){var t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="",t+="auth=Bearer ",t+=e.pass,t+="",t+="",s.default.utf16to8(t)},h.SASLExternal=function(){},h.SASLExternal.prototype=new h.SASLMechanism("EXTERNAL",true,10),h.SASLExternal.prototype.onChallenge=function(e){return e.authcid===e.authzid?"":e.authzid},h.SASLXOAuth2=function(){},h.SASLXOAuth2.prototype=new h.SASLMechanism("X-OAUTH2",true,30),h.SASLXOAuth2.prototype.test=function(e){return null!==e.pass},h.SASLXOAuth2.prototype.onChallenge=function(e){var t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,s.default.utf16to8(t)},t.default={Strophe:h,$build:c,$iq:d,$msg:l,$pres:u,SHA1:n.default,MD5:r.default,b64_hmac_sha1:n.default.b64_hmac_sha1,b64_sha1:n.default.b64_sha1,str_hmac_sha1:n.default.str_hmac_sha1,str_sha1:n.default.str_sha1}},"./src/md5.js":
/*!********************!*\
          !*** ./src/md5.js ***!
          \********************/
/*! exports provided: default */function(e,t,i){i.r(t),i.d(t,"default",(function(){return u}));var r=function(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i},n=function(e){for(var t=[],i=0;i<8*e.length;i+=8)t[i>>5]|=(255&e.charCodeAt(i/8))<<i%32;return t},s=function(e,t,i,n,s,o){return r((a=r(r(t,e),r(n,o)))<<(c=s)|a>>>32-c,i);var a,c},o=function(e,t,i,r,n,o,a){return s(t&i|~t&r,e,t,n,o,a)},a=function(e,t,i,r,n,o,a){return s(t&r|i&~r,e,t,n,o,a)},c=function(e,t,i,r,n,o,a){return s(t^i^r,e,t,n,o,a)},l=function(e,t,i,r,n,o,a){return s(i^(t|~r),e,t,n,o,a)},d=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var i,n,s,d,u=1732584193,h=-271733879,f=-1732584194,p=271733878,g=0;g<e.length;g+=16)i=u,n=h,s=f,d=p,u=o(u,h,f,p,e[g+0],7,-680876936),p=o(p,u,h,f,e[g+1],12,-389564586),f=o(f,p,u,h,e[g+2],17,606105819),h=o(h,f,p,u,e[g+3],22,-1044525330),u=o(u,h,f,p,e[g+4],7,-176418897),p=o(p,u,h,f,e[g+5],12,1200080426),f=o(f,p,u,h,e[g+6],17,-1473231341),h=o(h,f,p,u,e[g+7],22,-45705983),u=o(u,h,f,p,e[g+8],7,1770035416),p=o(p,u,h,f,e[g+9],12,-1958414417),f=o(f,p,u,h,e[g+10],17,-42063),h=o(h,f,p,u,e[g+11],22,-1990404162),u=o(u,h,f,p,e[g+12],7,1804603682),p=o(p,u,h,f,e[g+13],12,-40341101),f=o(f,p,u,h,e[g+14],17,-1502002290),h=o(h,f,p,u,e[g+15],22,1236535329),u=a(u,h,f,p,e[g+1],5,-165796510),p=a(p,u,h,f,e[g+6],9,-1069501632),f=a(f,p,u,h,e[g+11],14,643717713),h=a(h,f,p,u,e[g+0],20,-373897302),u=a(u,h,f,p,e[g+5],5,-701558691),p=a(p,u,h,f,e[g+10],9,38016083),f=a(f,p,u,h,e[g+15],14,-660478335),h=a(h,f,p,u,e[g+4],20,-405537848),u=a(u,h,f,p,e[g+9],5,568446438),p=a(p,u,h,f,e[g+14],9,-1019803690),f=a(f,p,u,h,e[g+3],14,-187363961),h=a(h,f,p,u,e[g+8],20,1163531501),u=a(u,h,f,p,e[g+13],5,-1444681467),p=a(p,u,h,f,e[g+2],9,-51403784),f=a(f,p,u,h,e[g+7],14,1735328473),h=a(h,f,p,u,e[g+12],20,-1926607734),u=c(u,h,f,p,e[g+5],4,-378558),p=c(p,u,h,f,e[g+8],11,-2022574463),f=c(f,p,u,h,e[g+11],16,1839030562),h=c(h,f,p,u,e[g+14],23,-35309556),u=c(u,h,f,p,e[g+1],4,-1530992060),p=c(p,u,h,f,e[g+4],11,1272893353),f=c(f,p,u,h,e[g+7],16,-155497632),h=c(h,f,p,u,e[g+10],23,-1094730640),u=c(u,h,f,p,e[g+13],4,681279174),p=c(p,u,h,f,e[g+0],11,-358537222),f=c(f,p,u,h,e[g+3],16,-722521979),h=c(h,f,p,u,e[g+6],23,76029189),u=c(u,h,f,p,e[g+9],4,-640364487),p=c(p,u,h,f,e[g+12],11,-421815835),f=c(f,p,u,h,e[g+15],16,530742520),h=c(h,f,p,u,e[g+2],23,-995338651),u=l(u,h,f,p,e[g+0],6,-198630844),p=l(p,u,h,f,e[g+7],10,1126891415),f=l(f,p,u,h,e[g+14],15,-1416354905),h=l(h,f,p,u,e[g+5],21,-57434055),u=l(u,h,f,p,e[g+12],6,1700485571),p=l(p,u,h,f,e[g+3],10,-1894986606),f=l(f,p,u,h,e[g+10],15,-1051523),h=l(h,f,p,u,e[g+1],21,-2054922799),u=l(u,h,f,p,e[g+8],6,1873313359),p=l(p,u,h,f,e[g+15],10,-30611744),f=l(f,p,u,h,e[g+6],15,-1560198380),h=l(h,f,p,u,e[g+13],21,1309151649),u=l(u,h,f,p,e[g+4],6,-145523070),p=l(p,u,h,f,e[g+11],10,-1120210379),f=l(f,p,u,h,e[g+2],15,718787259),h=l(h,f,p,u,e[g+9],21,-343485551),u=r(u,i),h=r(h,n),f=r(f,s),p=r(p,d);return[u,h,f,p]},u={hexdigest:function(e){return function(e){for(var t="",i=0;i<4*e.length;i++)t+="0123456789abcdef".charAt(e[i>>2]>>i%4*8+4&15)+"0123456789abcdef".charAt(e[i>>2]>>i%4*8&15);return t}(d(n(e),8*e.length))},hash:function(e){return function(e){for(var t="",i=0;i<32*e.length;i+=8)t+=String.fromCharCode(e[i>>5]>>>i%32&255);return t}(d(n(e),8*e.length))}}},"./src/sha1.js":
/*!*********************!*\
          !*** ./src/sha1.js ***!
          \*********************/
/*! exports provided: default */function(e,t,i){function r(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;var i,r,o,l,d,u,h,f,p=new Array(80),g=1732584193,m=-271733879,v=-1732584194,S=271733878,b=-1009589776;for(i=0;i<e.length;i+=16){for(l=g,d=m,u=v,h=S,f=b,r=0;r<80;r++)p[r]=r<16?e[i+r]:c(p[r-3]^p[r-8]^p[r-14]^p[r-16],1),o=a(a(c(g,5),n(r,m,v,S)),a(a(b,p[r]),s(r))),b=S,S=v,v=c(m,30),m=g,g=o;g=a(g,l),m=a(m,d),v=a(v,u),S=a(S,h),b=a(b,f)}return[g,m,v,S,b]}function n(e,t,i,r){return e<20?t&i|~t&r:e<40?t^i^r:e<60?t&i|t&r|i&r:t^i^r}function s(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function o(e,t){var i=l(e);i.length>16&&(i=r(i,8*e.length));for(var n=new Array(16),s=new Array(16),o=0;o<16;o++)n[o]=909522486^i[o],s[o]=1549556828^i[o];var a=r(n.concat(l(t)),512+8*t.length);return r(s.concat(a),672)}function a(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function c(e,t){return e<<t|e>>>32-t}function l(e){for(var t=[],i=0;i<8*e.length;i+=8)t[i>>5]|=(255&e.charCodeAt(i/8))<<24-i%32;return t}function d(e){for(var t,i,r="",n=0;n<4*e.length;n+=3)for(t=(e[n>>2]>>8*(3-n%4)&255)<<16|(e[n+1>>2]>>8*(3-(n+1)%4)&255)<<8|e[n+2>>2]>>8*(3-(n+2)%4)&255,i=0;i<4;i++)8*n+6*i>32*e.length?r+="=":r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t>>6*(3-i)&63);return r}function u(e){for(var t="",i=0;i<32*e.length;i+=8)t+=String.fromCharCode(e[i>>5]>>>24-i%32&255);return t}i.r(t),i.d(t,"default",(function(){return h}));var h={b64_hmac_sha1:function(e,t){return d(o(e,t))},b64_sha1:function(e){return d(r(l(e),8*e.length))},binb2str:u,core_hmac_sha1:o,str_hmac_sha1:function(e,t){return u(o(e,t))},str_sha1:function(e){return u(r(l(e),8*e.length))}}},"./src/strophe.js":
/*!************************!*\
          !*** ./src/strophe.js ***!
          \************************/
/*! exports provided: default */function(e,t,i){i.r(t),function(e){var r=i(
/*! core */
"./src/core.js");i(
/*! bosh */
"./src/bosh.js"),i(
/*! websocket */
"./src/websocket.js"),i.d(t,"default",(function(){return r.default})),e.Strophe=r.default.Strophe,e.$build=r.default.$build,e.$iq=r.default.$iq,e.$msg=r.default.$msg,e.$pres=r.default.$pres}.call(this,i(
/*! ./../node_modules/webpack/buildin/global.js */
"./node_modules/webpack/buildin/global.js"))},"./src/utils.js":
/*!**********************!*\
          !*** ./src/utils.js ***!
          \**********************/
/*! exports provided: default */function(e,t,i){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}i.r(t),i.d(t,"default",(function(){return n}));var n={utf16to8:function(e){var t,i,r="",n=e.length;for(t=0;t<n;t++)(i=e.charCodeAt(t))>=0&&i<=127?r+=e.charAt(t):i>2047?(r+=String.fromCharCode(224|i>>12&15),r+=String.fromCharCode(128|i>>6&63),r+=String.fromCharCode(128|i>>0&63)):(r+=String.fromCharCode(192|i>>6&31),r+=String.fromCharCode(128|i>>0&63));return r},addCookies:function(e){for(var t in e=e||{})if(Object.prototype.hasOwnProperty.call(e,t)){var i="",n="",s="",o=e[t],a="object"===r(o),c=escape(unescape(a?o.value:o));a&&(i=o.expires?";expires="+o.expires:"",n=o.domain?";domain="+o.domain:"",s=o.path?";path="+o.path:""),document.cookie=t+"="+c+i+n+s}}}},"./src/websocket.js":
/*!**************************!*\
          !*** ./src/websocket.js ***!
          \**************************/
/*! no exports provided */function(e,t,i){i.r(t);var r=i(
/*! core */
"./src/core.js"),n=r.default.Strophe,s=r.default.$build;n.Websocket=function(e){this._conn=e,this.strip="wrapper";var t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){var i="";"ws"===e.options.protocol&&"https:"!==window.location.protocol?i+="ws":i+="wss",i+="://"+window.location.host,0!==t.indexOf("/")?i+=window.location.pathname+t:i+=t,e.service=i}},n.Websocket.prototype={_buildStream:function(){return s("open",{xmlns:n.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(e,t){var i;if(0===(i=e.getElementsByTagNameNS?e.getElementsByTagNameNS(n.NS.STREAM,"error"):e.getElementsByTagName("stream:error")).length)return false;for(var r=i[0],s="",o="",a=0;a<r.childNodes.length;a++){var c=r.childNodes[a];if("urn:ietf:params:xml:ns:xmpp-streams"!==c.getAttribute("xmlns"))break;"text"===c.nodeName?o=c.textContent:s=c.nodeName}var l="WebSocket stream error: ";return l+=s||"unknown",o&&(l+=" - "+o),n.error(l),this._conn._changeConnectStatus(t,s),this._conn._doDisconnect(),true},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(e){if(this._check_streamerror(e,n.Status.CONNFAIL))return n.Status.CONNFAIL},_handleStreamStart:function(e){var t=false,i=e.getAttribute("xmlns");"string"!=typeof i?t="Missing xmlns in <open />":i!==n.NS.FRAMING&&(t="Wrong xmlns in <open />: "+i);var r=e.getAttribute("version");return"string"!=typeof r?t="Missing version in <open />":"1.0"!==r&&(t="Wrong version in <open />: "+r),!t||(this._conn._changeConnectStatus(n.Status.CONNFAIL,t),this._conn._doDisconnect(),false)},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){var t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;var i=(new DOMParser).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(i),this._conn.rawInput(e.data),this._handleStreamStart(i)&&this._connect_cb(i)}else if(0===e.data.indexOf("<close ")){var r=(new DOMParser).parseFromString(e.data,"text/xml").documentElement;this._conn.xmlInput(r),this._conn.rawInput(e.data);var s=r.getAttribute("see-other-uri");if(s){var o=this._conn.service;(o.indexOf("wss:")>=0&&s.indexOf("wss:")>=0||o.indexOf("ws:")>=0)&&(this._conn._changeConnectStatus(n.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=s,this._connect())}else this._conn._changeConnectStatus(n.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{var a=this._streamWrap(e.data),c=(new DOMParser).parseFromString(a,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(c,null,e.data)}},_disconnect:function(e){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){e&&this._conn.send(e);var t=s("close",{xmlns:n.NS.FRAMING});this._conn.xmlOutput(t.tree());var i=n.serialize(t);this._conn.rawOutput(i);try{this.socket.send(i)}catch(r){n.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){n.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(e){return"<wrapper>"+e+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.onerror=null,this.socket.close()}catch(e){n.debug(e.message)}this.socket=null},_emptyQueue:function(){return true},_onClose:function(e){this._conn.connected&&!this._conn.disconnecting?(n.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(n.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(n.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):n.info("Websocket closed")},_no_auth_received:function(e){n.error("Server did not offer a supported authentication mechanism"),this._changeConnectStatus(n.Status.CONNFAIL,n.ErrorCondition.NO_AUTH_MECH),e&&e.call(this._conn),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(e){n.error("Websocket error "+e),this._conn._changeConnectStatus(n.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var e=this._conn._data;if(e.length>0&&!this._conn.paused){for(var t=0;t<e.length;t++)if(null!==e[t]){var i=void 0;i="restart"===e[t]?this._buildStream().tree():e[t];var r=n.serialize(i);this._conn.xmlOutput(i),this._conn.rawOutput(r),this.socket.send(r)}this._conn._data=[]}},_onMessage:function(e){var t,i='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===i)return this._conn.rawInput(i),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(t=(new DOMParser).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else{var r=this._streamWrap(e.data);t=(new DOMParser).parseFromString(r,"text/xml").documentElement}return this._check_streamerror(t,n.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===t.firstChild.nodeName&&"unavailable"===t.firstChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(n.serialize(t))):void this._conn._dataRecv(t,e.data)},_onOpen:function(){n.info("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var t=n.serialize(e);this._conn.rawOutput(t),this.socket.send(t)},_reqToData:function(e){return e},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}}}}).default},e.exports=r()},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(r){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:true});var s=i(132),o=i(135),a=function(e){function t(t){var i=e.call(this)||this;return i._value=t,i}return n(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:true,configurable:true}),t.prototype._subscribe=function(t){var i=e.prototype._subscribe.call(this,t);return i&&!i.closed&&t.next(this._value),i},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new o.ObjectUnsubscribedError;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(s.Subject);t.BehaviorSubject=a},function(e,t,i){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:true});var s=i(93),o=i(94),a=i(77),c=i(135),l=i(158),d=i(134),u=function(e){function t(t){var i=e.call(this,t)||this;return i.destination=t,i}return n(t,e),t}(o.Subscriber);t.SubjectSubscriber=u;var h=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=false,t.isStopped=false,t.hasError=false,t.thrownError=null,t}return n(t,e),t.prototype[d.rxSubscriber]=function(){return new u(this)},t.prototype.lift=function(e){var t=new f(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new c.ObjectUnsubscribedError;if(!this.isStopped)for(var t=this.observers,i=t.length,r=t.slice(),n=0;n<i;n++)r[n].next(e)},t.prototype.error=function(e){if(this.closed)throw new c.ObjectUnsubscribedError;this.hasError=true,this.thrownError=e,this.isStopped=true;for(var t=this.observers,i=t.length,r=t.slice(),n=0;n<i;n++)r[n].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new c.ObjectUnsubscribedError;this.isStopped=true;for(var e=this.observers,t=e.length,i=e.slice(),r=0;r<t;r++)i[r].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=true,this.closed=true,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new c.ObjectUnsubscribedError;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new c.ObjectUnsubscribedError;return this.hasError?(e.error(this.thrownError),a.Subscription.EMPTY):this.isStopped?(e.complete(),a.Subscription.EMPTY):(this.observers.push(e),new l.SubjectSubscription(this,e))},t.prototype.asObservable=function(){var e=new s.Observable;return e.source=this,e},t.create=function(e,t){return new f(e,t)},t}(s.Observable);t.Subject=h;var f=function(e){function t(t,i){var r=e.call(this)||this;return r.destination=t,r.source=i,r}return n(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):a.Subscription.EMPTY},t}(h);t.AnonymousSubject=f},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});var r=false;t.config={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else r&&console.log("RxJS: Back to a better error behavior. Thank you. <3");r=e},get useDeprecatedSynchronousErrorHandling(){return r}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.rxSubscriber="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),t.$$rxSubscriber=t.rxSubscriber},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}();t.ObjectUnsubscribedError=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{constructor(e){this.elem=e}attr(e){return this.elem.getAttribute(e)}text(){return this.elem.textContent}find(e){return new n(Array.from(this.elem.getElementsByTagName(e)).map((e=>new r(e))))}}t.XMLElement=r;class n{constructor(e){this.elems=e}forEach(e){this.elems.forEach(e)}attr(e){return this.elems.length?this.elems[0].attr(e):null}text(){return this.elems.length?this.elems[0].text():null}find(e){return this.elems.length?this.elems[0].find(e):new n([])}first(){return this.elems.length?this.elems[0]:null}get length(){return this.elems.length}}t.XMLElements=n,t.default=e=>{if("string"!=typeof e)return new r(e);const t=new DOMParser;return new r(t.parseFromString(e,"text/xml"))}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),function(e){e.PERSONALROUTINE_ATWORK="At work",e.PERSONALROUTINE_ONBREAK="On break",e.PERSONALROUTINE_OUTOFOFFICE="Out of office",e.PERSONALROUTINE_DND="Do not disturb",e.PERSONALROUTINE_CUSTOM="Custom"}(t.PersonalRoutineType||(t.PersonalRoutineType={}));class r{constructor(e,t,i,r,n,s,o,a,c,l,d,u){this.active=false,this.presence={manage:false,value:"online"},this.cliOptions={manage:false,policy:"company_policy",phoneNumberId:"",anonymous:false},this.deviceMode={manage:false,mode:"computer"},this.immediateCallForward={manage:false,callForwardType:"immediate",activate:false,number:null,name:"",destinationType:"doNotForward"},this.busyCallForward={manage:false,callForwardType:"busy",activate:false,number:null,name:"",destinationType:"doNotForward"},this.noreplyCallForward={manage:false,callForwardType:"noreply",activate:false,number:null,name:"",destinationType:"doNotForward"},this.huntingGroups={manage:false},this.outOfOffice={manage:false,active:false,message:""},this.id=e,this.name=t,this.type=i,this.active=r,this.presence=n,this.deviceMode=s,this.immediateCallForward=o,o&&null===o.destinationType&&(this.immediateCallForward.destinationType="doNotForward"),this.busyCallForward=a,a&&null===a.destinationType&&(this.busyCallForward.destinationType="doNotForward"),this.noreplyCallForward=c,c&&null===c.destinationType&&(this.noreplyCallForward.destinationType="doNotForward"),this.huntingGroups=l,this.cliOptions=d,this.outOfOffice=u}static createRoutineFromData(e){return new r(e.id,e.name,e.type,e.active,e.presence,e.deviceMode,e.immediateCallForward,e.busyCallForward,e.noreplyCallForward,e.huntingGroups,e.cliOptions,e.outOfOffice)}updateRoutineFromData(e){e.active&&(this.active=e.active),e.presence&&(this.presence=e.presence),e.deviceMode&&(this.deviceMode=e.deviceMode),e.huntingGroups&&(this.huntingGroups=e.huntingGroups),e.name&&(this.name=e.name),e.type&&(this.type=e.type),e.immediateCallForward&&(this.immediateCallForward=e.immediateCallForward,null===e.immediateCallForward.destinationType&&(this.immediateCallForward.destinationType="doNotForward")),e.noreplyCallForward&&(this.noreplyCallForward=e.noreplyCallForward,null===e.noreplyCallForward.destinationType&&(this.noreplyCallForward.destinationType="doNotForward")),e.busyCallForward&&(this.busyCallForward=e.busyCallForward,null===e.busyCallForward.destinationType&&(this.busyCallForward.destinationType="doNotForward")),e.cliOptions&&(this.cliOptions=e.cliOptions),e.outOfOffice&&(this.outOfOffice=e.outOfOffice)}}t.PersonalRoutine=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{constructor(e,t,i,r,n,s){this.type=e,this.activate=t,this.destinationType=i,this.name=r,this.number=n,this.userId=s}static createForwardFromUserData(e){return new r(e.type,e.activate,e.destinationType,e.name,e.number,e.userId)}updateFromEventData(e,t,i){return this.activate=e,this.destinationType=t,this.name=i,this.activate&&"voicemail"!==this.destinationType||(this.number=""),this}}t.TelephonyForward=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7);class n{constructor(e,t,i,n,s,o,a,c,l,d,u,h,f,p,g,m,v){this.userRole="none",this.messageRetrieved=false,this.messages=[],this.subscribed=false,this.deleted=false,this.invited=false,this.type="SIMPLE",this.pageIndex=0,this.isLoading=false,this.complete=false,this.users=[],this.publishersRetreived=false,this.loaded=false,this.muted=false,this.name=e,this.id=t,this.visibility=i,this.topic=n,this.creatorId=s,this.companyId=o,this.creationDate=a,this.type=u,this.users_count=c,this.subscribers_count=g,this.category=f,this.mode=p,this.additionDate=void 0!==v?v:a,this.lastAvatarUpdateDate=l;const S=this.lastAvatarUpdateDate?"&ts="+new Date(this.lastAvatarUpdateDate).getTime():"";if(this.avatar=config.restServerUrl+"/api/channel-avatar/"+t+"?size=256"+S,this.subscribed=void 0!==d&&d,void 0!==u&&(this.userRole=u),void 0!==h&&(this.invited=h),!this.mode)switch(this.visibility){case"company":this.mode="company_public";break;case"public":this.mode="all_public";break;case"private":this.mode="company_private"}this.updateSubject=new r.Subject,this.muted=m}static create(e){const t=new n(e.name,e.id,e.visibility,e.topic,e.creatorId,e.companyId,e.creationDate,e.users_count,e.lastAvatarUpdateDate,e.subscribed,e.type,e.invited,e.category,e.mode,e.subscribers_count,e.mute,e.additionDate);return t.category||(t.category="globalnews"),t}isNotMember(){return this.userRole="none"}isOwner(){return"owner"===this.userRole}isPublisher(){return this.subscribed&&("owner"===this.userRole||"publisher"===this.userRole)}isMember(){return"member"===this.userRole}getAvatarSrc(){return this.lastAvatarUpdateDate?this.avatar:"/assets/skins/rainbow/images/channels/default_channel_avatar.png"}}t.Channel=n},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{static createFromData(e){return new r(e.directoryType,e.companyId,e.userId,e.id,e.firstName,e.lastName,e.eMail,e.jobTitle,e.department,e.companyName,e.street,e.city,e.state,e.postalCode,e.country,e.workPhoneNumbers,e.mobilePhoneNumbers,e.otherPhoneNumbers,e.custom1,e.custom2,e.tags)}constructor(e,t,i,r,n,s,o,a,c,l,d,u,h,f,p,g,m,v,S,b,y){e&&(this.directoryType=e),t&&(this.companyId=t),i&&(this.userId=i),r&&(this.id=r),n&&(this.firstName=n),s&&(this.lastName=s),o&&(this.eMail=o),a&&(this.jobTitle=a),c&&(this.department=c),l&&(this.companyName=l),d&&(this.street=d),u&&(this.city=u),h&&(this.state=h),f&&(this.postalCode=f),p&&(this.country=p),g&&(this.workPhoneNumbers=g),m&&(this.mobilePhoneNumbers=m),v&&(this.otherPhoneNumbers=v),S&&(this.custom1=S),b&&(this.custom2=b),y&&(this.tags=y)}toJSON(){return this.companyId&&""!==this.companyId?{companyId:this.companyId,id:this.id,firstName:this.firstName,lastName:this.lastName,eMail:this.eMail,jobTitle:this.jobTitle,department:this.department,companyName:this.companyName,street:this.street,city:this.city,state:this.state,postalCode:this.postalCode,country:this.country,workPhoneNumbers:this.workPhoneNumbers,mobilePhoneNumbers:this.mobilePhoneNumbers,otherPhoneNumbers:this.otherPhoneNumbers,custom1:this.custom1,custom2:this.custom2,tags:this.tags}:{id:this.id,firstName:this.firstName,lastName:this.lastName,eMail:this.eMail,jobTitle:this.jobTitle,department:this.department,companyName:this.companyName,street:this.street,city:this.city,state:this.state,postalCode:this.postalCode,country:this.country,workPhoneNumbers:this.workPhoneNumbers,mobilePhoneNumbers:this.mobilePhoneNumbers,otherPhoneNumbers:this.otherPhoneNumbers,custom1:this.custom1,custom2:this.custom2,tags:this.tags}}}t.DirectoryContact=r},function(e,t,i){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:true});var s=i(94);t.distinctUntilChanged=function(e,t){return function(i){return i.lift(new o(e,t))}};var o=function(){function e(e,t){this.compare=e,this.keySelector=t}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.compare,this.keySelector))},e}(),a=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.keySelector=r,n.hasKey=false,"function"==typeof i&&(n.compare=i),n}return n(t,e),t.prototype.compare=function(e,t){return e===t},t.prototype._next=function(e){var t;try{var i=this.keySelector;t=i?i(e):e}catch(dp){return this.destination.error(dp)}var r=false;if(this.hasKey)try{r=(0,this.compare)(this.key,t)}catch(dp){return this.destination.error(dp)}else this.hasKey=true;r||(this.key=t,this.destination.next(e))},t}(s.Subscriber)},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7),n=i(18);class s{constructor(e,t,i,n,o,a=[],c=s.History.NONE,l={},d=null,u=null,h=false,f=null,p="unlock",g=false,m=[],v="",S="",b=false,y=false,C=[]){this.nameForLogs="",this.users=[],this.ownerContact=null,this.organizers=[],this.members=[],this.avatarContacts=[],this.owner=false,this.isModerator=false,this.status="none",this.rxSubject=new r.Subject,this.initPresPromise=null,this.initPresPromiseResolve=null,this.initPresInterval=null,this.initPresenceAck=false,this.autoAcceptInvitation=false,this.tags=[],this.foundByTag=false,this.filterName=null,this.containerId="",this.containerName="",this.webinarId=null,this.isOwnedByGroup=false,this.isAlertNotificationEnabled=false,this.noNotificationPopUp=false,this.dbId=e,this.jid=t,this.name=i,this.desc=n,this.creationDate=o,this.type=s.Type.PRIVATE,this.history=c,this.customData=l,this.confEndpoints=a,this.conference=d,this.avatar=u,this.isActive=h,this.lastActivityDate=f,this.autoRegister=p,this.autoAcceptInvitation=g,this.tags=m,this.containerId=v||"",this.autoAcceptInvitation=g,this.tags=m,this.containerId=v||"",this.containerName=S||"",this.isOwnedByGroup=b,this.isAlertNotificationEnabled=y}static create(e,t,i,r,n,o,a,c,l,d,u,h=null,f="unlock",p=false,g=[],m="",v="",S=false,b=false){const y=new s(e,t,i,r,n,o,a,c,l,d,u,h,f,p,g,m,v,S,b);return y.lastActivityDate=h,y}toString(){return"Room "+this.dbId+" "+this.name+" "+this.jid}getCreationDate(){return this.creationDate?new Date(this.creationDate):new Date}getLastActivityDate(){return this.lastActivityDate?new Date(this.lastActivityDate):this.getCreationDate()}subscribe(e){return this.rxSubject.subscribe(e)}updateAvatarInfo(){if(this.avatar)return;const e=[],t=this.users.slice();t.sort(((e,t)=>new Date(e.date)>new Date(t.date)?1:new Date(e.date)<new Date(t.date)?-1:0));for(let i=0;i<t.length;i++){const r=t[i].contact,n=t[i].status;if(!(this.ownerContact&&r.dbId===this.ownerContact.dbId||r.isAnonymousGuest()||r.isBadGuest()||r.isTerminated)&&(!this.owner&&!this.isModerator||"accepted"!==n&&"invited"!==n?"accepted"===n&&e.push(r):e.push(r),5===e.length))break}this.avatarContacts=e,this.rxSubject&&this.rxSubject.next(n.RBEvent.create("updateAvatarInfo",this.avatarContacts))}isUserOwner(e){return!!e&&(this.ownerContact&&this.ownerContact.jid===e.jid)}isUserModerator(e){return void 0!==this.getOrganizerFromContactJid(e.jid)}isUserStatusAccepted(e){const t=this.getUserByJid(e.jid);return void 0!==t&&"accepted"===t.status}isUserStatusAcceptedOrInvited(e){const t=this.getUserByJid(e.jid);return void 0!==t&&("accepted"===t.status||"invited"===t.status)}isUserStillBelongToRoom(e){const t=this.getUserByJid(e);return!t||"unsubscribed"!==t.status&&"deleted"!==t.status}getOrganizerFromContactJid(e){let t;return this.organizers.forEach((i=>{i.contact.jid===e&&(t=i)})),t}getUserByJid(e){for(let t=0;t<this.users.length;t++)if(e===this.users[t].contact.jid)return this.users[t];return null}getPstnConfEndpointId(){if(this.confEndpoints&&this.confEndpoints.length){for(let e=0;e<this.confEndpoints.length;e++)if("pstnAudio"===this.confEndpoints[e].mediaType)return this.confEndpoints[e].confEndpointId}return null}getSFUConfEndpointId(){if(this.confEndpoints&&this.confEndpoints.length){for(let e=0;e<this.confEndpoints.length;e++)if("webrtc"===this.confEndpoints[e].mediaType)return this.confEndpoints[e].confEndpointId}return null}getSFUSharingConfEndpointId(){if(this.confEndpoints&&this.confEndpoints.length){for(let e=0;e<this.confEndpoints.length;e++)if("webrtcSharingOnly"===this.confEndpoints[e].mediaType)return this.confEndpoints[e].confEndpointId}return null}isMyPersonalMeetingRoom(){return this.conference&&"pstnAudio"===this.conference.mediaType&&!this.conference.scheduled&&this.conference.personalMeeting&&this.owner}isMeetingRoom(){return this.conference&&"pstnAudio"===this.conference.mediaType}isWebinarRoom(){return this.conference&&this.conference.webinar&&this.conference.webinar.id}isWebConferenceRoom(){return this.conference&&"pstnAudio"!==this.conference.mediaType&&null!==this.getSFUConfEndpointId()}isWebConferenceV2Room(){return this.conference&&"webrtc"===this.conference.mediaType&&this.conference.sessions&&this.conference.sessions.length&&"conference"===this.conference.sessions[0].type}getWebConferenceOwnerId(){return this.conference&&"webrtc"===this.conference.mediaType&&this.conference.sessions&&this.conference.sessions.length&&"conference"===this.conference.sessions[0].type?this.conference.sessions[0].ownerId:null}setWebConferenceOwnerId(e){this.conference&&"webrtc"===this.conference.mediaType&&this.conference.sessions&&this.conference.sessions.length&&"conference"===this.conference.sessions[0].type&&(this.conference.sessions[0].ownerId=e)}getCurrentConferenceSession(){return this.conference&&"webrtc"===this.conference.mediaType&&this.conference.sessions&&this.conference.sessions.length&&"conference"===this.conference.sessions[0].type?this.conference.sessions[0]:null}isMeetingOrWebConferenceRoom(){return this.isMeetingRoom()||null!==this.getSFUConfEndpointId()}getNameForLogs(){if(!this.nameForLogs&&this.name){const e=this.name.replace(/[^\s](?=.{1,}$)/g,"*");this.nameForLogs=this.name.charAt(0)+e.substr(1)}return this.nameForLogs}getAutoRegister(){return this.autoRegister?this.autoRegister:"unlock"}setAutoRegister(e){this.autoRegister=e}getAutoAcceptInvitation(){return this.autoAcceptInvitation}setAutoAcceptInvitation(e){this.autoAcceptInvitation=e}getMuteUponEntry(){return this.conference?this.conference.muteUponEntry:"false"}setMuteUponEntry(e){this.conference&&(this.conference.muteUponEntry=e)}getDisableTimeStats(){return this.conference?this.conference.disableTimeStats:"false"}setDisableTimeStats(e){this.conference&&(this.conference.disableTimeStats=e)}getPlayEntryTone(){return this.conference?this.conference.playEntryTone:"true"}setPlayEntryTone(e){this.conference&&(this.conference.playEntryTone=e)}getAllAcceptedMembers(){return this.members.filter((e=>!e.contact.isBadGuest()&&!e.contact.isAnonymousGuest()&&!e.contact.isTerminated&&"accepted"===e.status))}getAllAcceptedUsers(){return this.users.filter((e=>!e.contact.isBadGuest()&&!e.contact.isAnonymousGuest()&&!e.contact.isTerminated&&"accepted"===e.status))}getTagColor(e){const t=this.tags.findIndex((t=>t.tag===e));return t>-1?this.tags[t].color:"#ff9900"}getDialInCode(){return this.conference?this.conference.dialInCode:""}setDialInCode(e){this.conference&&(this.conference.dialInCode=e,this.rxSubject&&this.rxSubject.next(n.RBEvent.create("updateDialInCode",this.conference.dialInCode)))}getIncludeAllPhoneNumbers(){return!!this.conference&&this.conference.includeAllPhoneNumbers}setIncludeAllPhoneNumbers(e){this.conference&&(this.conference.includeAllPhoneNumbers=e,this.rxSubject&&this.rxSubject.next(n.RBEvent.create("updateIncludeAllPhoneNumbers",this.conference.includeAllPhoneNumbers)))}getPhoneNumbers(){return this.conference?this.conference.phoneNumbers:[]}setPhoneNumbers(e){this.conference&&(this.conference.phoneNumbers=e,this.rxSubject&&this.rxSubject.next(n.RBEvent.create("updateDialInPhoneNumbers",this.conference.phoneNumbers)))}}s.Type={PRIVATE:0,PUBLIC:1},s.Privilege={USER:"user",MODERATOR:"moderator",GUEST:"guest"},s.History={ALL:"all",NONE:"none"},t.Room=s},function(e,t,i){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:true}),t.HostCapabilities=void 0;var s=i(69),o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._capabilities={},t}return n(t,e),t.prototype.getSchemaKey=function(){return"HostCapabilities"},t.prototype.internalParse=function(t,i){if(e.prototype.internalParse.call(this,t,i),t)for(var r in t){var n=t[r];if("string"==typeof n)if("*"==n)this.addCapability(r,"*");else{var o=s.Version.parse(n,i);o&&o.isValid&&this.addCapability(r,o)}}},t.prototype.internalToJSON=function(t,i){for(var r in e.prototype.internalToJSON.call(this,t,i),this._capabilities)t[r]=this._capabilities[r]},t.prototype.addCapability=function(e,t){this._capabilities[e]=t},t.prototype.removeCapability=function(e){delete this._capabilities[e]},t.prototype.clear=function(){this._capabilities={}},t.prototype.hasCapability=function(e,t){return!!this._capabilities.hasOwnProperty(e)&&("*"==t||"*"==this._capabilities[e]||t.compareTo(this._capabilities[e])<=0)},t.prototype.areAllMet=function(e){for(var t in this._capabilities)if(!e.hasCapability(t,this._capabilities[t]))return false;return true},t}(s.SerializableObject);t.HostCapabilities=o},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.GlobalRegistry=t.CardObjectRegistry=void 0;var r=i(69),n=function(){function e(){this._items={}}return e.prototype.findByName=function(e){return this._items.hasOwnProperty(e)?this._items[e]:void 0},e.prototype.clear=function(){this._items={}},e.prototype.copyTo=function(e){for(var t=0,i=Object.keys(this._items);t<i.length;t++){var r=i[t],n=this._items[r];e.register(n.typeName,n.objectType,n.schemaVersion)}},e.prototype.register=function(e,t,i){void 0===i&&(i=r.Versions.v1_0);var n=this.findByName(e);void 0!==n?n.objectType=t:n={typeName:e,objectType:t,schemaVersion:i},this._items[e]=n},e.prototype.unregister=function(e){delete this._items[e]},e.prototype.createInstance=function(e,t){var i=this.findByName(e);return i&&i.schemaVersion.compareTo(t)<=0?new i.objectType:void 0},e.prototype.getItemCount=function(){return Object.keys(this._items).length},e.prototype.getItemAt=function(e){var t=this;return Object.keys(this._items).map((function(e){return t._items[e]}))[e]},e}();t.CardObjectRegistry=n;var s=function(){function e(){}return e.populateWithDefaultElements=function(t){t.clear(),e.defaultElements.copyTo(t)},e.populateWithDefaultActions=function(t){t.clear(),e.defaultActions.copyTo(t)},Object.defineProperty(e,"elements",{get:function(){return e._elements||(e._elements=new n,e.populateWithDefaultElements(e._elements)),e._elements},enumerable:false,configurable:true}),Object.defineProperty(e,"actions",{get:function(){return e._actions||(e._actions=new n,e.populateWithDefaultActions(e._actions)),e._actions},enumerable:false,configurable:true}),e.reset=function(){e._elements=void 0,e._actions=void 0},e.defaultElements=new n,e.defaultActions=new n,e}();t.GlobalRegistry=s},function(e,t,i){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};Object.defineProperty(t,"__esModule",{value:true}),t.SerializationContext=t.AdaptiveCard=t.Authentication=t.TokenExchangeResource=t.AuthCardButton=t.RefreshDefinition=t.RefreshActionProperty=t.ContainerWithActions=t.ColumnSet=t.Column=t.Container=t.BackgroundImage=t.ContainerBase=t.StylableCardElementContainer=t.ContainerStyleProperty=t.ActionSet=t.ShowCardAction=t.HttpAction=t.HttpHeader=t.ToggleVisibilityAction=t.OpenUrlAction=t.ExecuteAction=t.SubmitAction=t.SubmitActionBase=t.Action=t.TimeInput=t.TimeProperty=t.DateInput=t.NumberInput=t.ChoiceSetInput=t.Choice=t.ToggleInput=t.TextInput=t.Input=t.Media=t.MediaSource=t.ImageSet=t.CardElementContainer=t.Image=t.FactSet=t.Fact=t.RichTextBlock=t.TextRun=t.TextBlock=t.BaseTextBlock=t.ActionProperty=t.CardElement=t.renderSeparation=void 0;var o=i(55),a=i(61),c=i(68),l=i(109),d=i(402),u=i(167),h=i(69),f=i(144),p=i(79),g=i(403);function m(e,t,i){if(t.spacing>0||t.lineThickness&&t.lineThickness>0){var r=document.createElement("div");r.className=e.makeCssClassName("ac-"+(i==o.Orientation.Horizontal?"horizontal":"vertical")+"-separator"),r.setAttribute("aria-hidden","true");var n=t.lineColor?c.stringToCssColor(t.lineColor):"";return i==o.Orientation.Horizontal?t.lineThickness?(r.style.paddingTop=t.spacing/2+"px",r.style.marginBottom=t.spacing/2+"px",r.style.borderBottom=t.lineThickness+"px solid "+n):r.style.height=t.spacing+"px":t.lineThickness?(r.style.paddingLeft=t.spacing/2+"px",r.style.marginRight=t.spacing/2+"px",r.style.borderRight=t.lineThickness+"px solid "+n):r.style.width=t.spacing+"px",r.style.overflow="hidden",r.style.flex="0 0 auto",r}}t.renderSeparation=m;var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._truncatedDueToOverflow=false,t}return n(t,e),Object.defineProperty(t.prototype,"lang",{get:function(){var e=this.getValue(t.langProperty);return e||(this.parent?this.parent.lang:void 0)},set:function(e){this.setValue(t.langProperty,e)},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"isVisible",{get:function(){return this.getValue(t.isVisibleProperty)},set:function(e){a.GlobalSettings.useAdvancedCardBottomTruncation&&!e&&this.undoOverflowTruncation(),this.isVisible!==e&&(this.setValue(t.isVisibleProperty,e),this.updateRenderedElementVisibility(),this._renderedElement&&le(this)),this._renderedElement&&this._renderedElement.setAttribute("aria-expanded",e.toString())},enumerable:false,configurable:true}),t.prototype.internalRenderSeparator=function(){var e=m(this.hostConfig,{spacing:this.hostConfig.getEffectiveSpacing(this.spacing),lineThickness:this.separator?this.hostConfig.separator.lineThickness:void 0,lineColor:this.separator?this.hostConfig.separator.lineColor:void 0},this.separatorOrientation);if(a.GlobalSettings.alwaysBleedSeparators&&e&&this.separatorOrientation==o.Orientation.Horizontal){var t=this.getParentContainer();if(t&&t.getEffectivePadding()){var i=this.hostConfig.paddingDefinitionToSpacingDefinition(t.getEffectivePadding());e.style.marginLeft="-"+i.left+"px",e.style.marginRight="-"+i.right+"px"}}return e},t.prototype.updateRenderedElementVisibility=function(){var e=this.isDesignMode()||this.isVisible?this._defaultRenderedElementDisplayMode:"none";this._renderedElement&&(e?this._renderedElement.style.display=e:this._renderedElement.style.removeProperty("display")),this._separatorElement&&(this.parent&&this.parent.isFirstElement(this)?this._separatorElement.style.display="none":e?this._separatorElement.style.display=e:this._separatorElement.style.removeProperty("display"))},t.prototype.hideElementDueToOverflow=function(){this._renderedElement&&this.isVisible&&(this._renderedElement.style.visibility="hidden",this.isVisible=false,le(this,false))},t.prototype.showElementHiddenDueToOverflow=function(){this._renderedElement&&!this.isVisible&&(this._renderedElement.style.removeProperty("visibility"),this.isVisible=true,le(this,false))},t.prototype.handleOverflow=function(e){if(this.isVisible||this.isHiddenDueToOverflow()){var t=this.truncateOverflow(e);this._truncatedDueToOverflow=t||this._truncatedDueToOverflow,t?t&&!this.isVisible&&this.showElementHiddenDueToOverflow():this.hideElementDueToOverflow()}},t.prototype.resetOverflow=function(){var e=false;return this._truncatedDueToOverflow&&(this.undoOverflowTruncation(),this._truncatedDueToOverflow=false,e=true),this.isHiddenDueToOverflow()&&this.showElementHiddenDueToOverflow(),e},t.prototype.getDefaultSerializationContext=function(){return new Se},t.prototype.createPlaceholderElement=function(){var e=this.getEffectiveStyleDefinition(),t=c.stringToCssColor(e.foregroundColors.default.subtle),i=document.createElement("div");return i.style.border="1px dashed "+t,i.style.padding="4px",i.style.minHeight="32px",i.style.fontSize="10px",i.style.color=t,i.innerText="Empty "+this.getJsonTypeName(),i},t.prototype.adjustRenderedElementSize=function(e){"auto"===this.height?e.style.flex="0 0 auto":e.style.flex="1 1 auto"},t.prototype.isDisplayed=function(){return void 0!==this._renderedElement&&this.isVisible&&this._renderedElement.offsetHeight>0},t.prototype.overrideInternalRender=function(){return this.internalRender()},t.prototype.applyPadding=function(){if(this.separatorElement&&this.separatorOrientation===o.Orientation.Horizontal)if(a.GlobalSettings.alwaysBleedSeparators&&!this.isBleeding()){var e=new a.PaddingDefinition;this.getImmediateSurroundingPadding(e);var t=this.hostConfig.paddingDefinitionToSpacingDefinition(e);this.separatorElement.style.marginLeft="-"+t.left+"px",this.separatorElement.style.marginRight="-"+t.right+"px"}else this.separatorElement.style.marginRight="0",this.separatorElement.style.marginLeft="0"},t.prototype.truncateOverflow=function(e){return false},t.prototype.undoOverflowTruncation=function(){},t.prototype.getDefaultPadding=function(){return new a.PaddingDefinition},t.prototype.getHasBackground=function(){return false},t.prototype.getHasBorder=function(){return false},t.prototype.getPadding=function(){return this._padding},t.prototype.setPadding=function(e){this._padding=e},t.prototype.shouldSerialize=function(e){return void 0!==e.elementRegistry.findByName(this.getJsonTypeName())},Object.defineProperty(t.prototype,"useDefaultSizing",{get:function(){return true},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"separatorOrientation",{get:function(){return o.Orientation.Horizontal},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"defaultStyle",{get:function(){return o.ContainerStyle.Default},enumerable:false,configurable:true}),t.prototype.parse=function(t,i){e.prototype.parse.call(this,t,i||new Se)},t.prototype.asString=function(){return""},t.prototype.isBleeding=function(){return false},t.prototype.getEffectiveStyle=function(){return this.parent?this.parent.getEffectiveStyle():this.defaultStyle},t.prototype.getEffectiveStyleDefinition=function(){return this.hostConfig.containerStyles.getStyleByName(this.getEffectiveStyle())},t.prototype.getEffectiveTextStyleDefinition=function(){return this.parent?this.parent.getEffectiveTextStyleDefinition():this.hostConfig.textStyles.default},t.prototype.getForbiddenActionTypes=function(){return[]},t.prototype.getImmediateSurroundingPadding=function(e,t,i,r,n){if(void 0===t&&(t=true),void 0===i&&(i=true),void 0===r&&(r=true),void 0===n&&(n=true),this.parent){var s=t&&this.parent.isTopElement(this),a=i&&this.parent.isRightMostElement(this),c=r&&this.parent.isBottomElement(this),l=n&&this.parent.isLeftMostElement(this),d=this.parent.getEffectivePadding();d&&(s&&d.top!=o.Spacing.None&&(e.top=d.top,s=false),a&&d.right!=o.Spacing.None&&(e.right=d.right,a=false),c&&d.bottom!=o.Spacing.None&&(e.bottom=d.bottom,c=false),l&&d.left!=o.Spacing.None&&(e.left=d.left,l=false)),(s||a||c||l)&&this.parent.getImmediateSurroundingPadding(e,s,a,c,l)}},t.prototype.getActionCount=function(){return 0},t.prototype.getActionAt=function(e){throw new Error(p.Strings.errors.indexOutOfRange(e))},t.prototype.indexOfAction=function(e){for(var t=0;t<this.getActionCount();t++)if(this.getActionAt(t)===e)return t;return-1},t.prototype.remove=function(){return!!(this.parent&&this.parent instanceof P)&&this.parent.removeItem(this)},t.prototype.render=function(){return this._renderedElement=this.overrideInternalRender(),this._separatorElement=this.internalRenderSeparator(),this._renderedElement?(this.id&&(this._renderedElement.id=this.id),this.customCssSelector&&this._renderedElement.classList.add(this.customCssSelector),this._renderedElement.style.boxSizing="border-box",this._defaultRenderedElementDisplayMode=this._renderedElement.style.display?this._renderedElement.style.display:void 0,this.adjustRenderedElementSize(this._renderedElement),this.updateLayout(false)):this.isDesignMode()&&(this._renderedElement=this.createPlaceholderElement()),this._renderedElement},t.prototype.updateLayout=function(e){this.updateRenderedElementVisibility(),this.applyPadding()},t.prototype.indexOf=function(e){return-1},t.prototype.isDesignMode=function(){var e=this.getRootElement();return e instanceof me&&e.designMode},t.prototype.isFirstElement=function(e){return true},t.prototype.isLastElement=function(e){return true},t.prototype.isAtTheVeryLeft=function(){return!this.parent||this.parent.isLeftMostElement(this)&&this.parent.isAtTheVeryLeft()},t.prototype.isAtTheVeryRight=function(){return!this.parent||this.parent.isRightMostElement(this)&&this.parent.isAtTheVeryRight()},t.prototype.isAtTheVeryTop=function(){return!this.parent||this.parent.isFirstElement(this)&&this.parent.isAtTheVeryTop()},t.prototype.isAtTheVeryBottom=function(){return!this.parent||this.parent.isLastElement(this)&&this.parent.isAtTheVeryBottom()},t.prototype.isBleedingAtTop=function(){return false},t.prototype.isBleedingAtBottom=function(){return false},t.prototype.isLeftMostElement=function(e){return true},t.prototype.isRightMostElement=function(e){return true},t.prototype.isTopElement=function(e){return this.isFirstElement(e)},t.prototype.isBottomElement=function(e){return this.isLastElement(e)},t.prototype.isHiddenDueToOverflow=function(){return void 0!==this._renderedElement&&"hidden"==this._renderedElement.style.visibility},t.prototype.getRootElement=function(){return this.getRootObject()},t.prototype.getParentContainer=function(){for(var e=this.parent;e;){if(e instanceof re)return e;e=e.parent}},t.prototype.getAllInputs=function(e){return[]},t.prototype.getResourceInformation=function(){return[]},t.prototype.getElementById=function(e){return this.id===e?this:void 0},t.prototype.getActionById=function(e){},t.prototype.getEffectivePadding=function(){var e=this.getPadding();return e||this.getDefaultPadding()},t.prototype.getEffectiveHorizontalAlignment=function(){return void 0!==this.horizontalAlignment?this.horizontalAlignment:this.parent?this.parent.getEffectiveHorizontalAlignment():o.HorizontalAlignment.Left},Object.defineProperty(t.prototype,"hostConfig",{get:function(){return this._hostConfig?this._hostConfig:this.parent?this.parent.hostConfig:l.defaultHostConfig},set:function(e){this._hostConfig=e},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"index",{get:function(){return this.parent?this.parent.indexOf(this):0},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"isInteractive",{get:function(){return false},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"isStandalone",{get:function(){return true},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"isInline",{get:function(){return false},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"hasVisibleSeparator",{get:function(){return!(!this.parent||!this.separatorElement)&&(!this.parent.isFirstElement(this)&&(this.isVisible||this.isDesignMode()))},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"separatorElement",{get:function(){return this._separatorElement},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:false,configurable:true}),t.langProperty=new h.StringProperty(h.Versions.v1_1,"lang",true,/^[a-z]{2,3}$/gi),t.isVisibleProperty=new h.BoolProperty(h.Versions.v1_2,"isVisible",true),t.separatorProperty=new h.BoolProperty(h.Versions.v1_0,"separator",false),t.heightProperty=new h.ValueSetProperty(h.Versions.v1_1,"height",[{value:"auto"},{value:"stretch"}],"auto"),t.horizontalAlignmentProperty=new h.EnumProperty(h.Versions.v1_0,"horizontalAlignment",o.HorizontalAlignment),t.spacingProperty=new h.EnumProperty(h.Versions.v1_0,"spacing",o.Spacing,o.Spacing.Default),s([h.property(t.horizontalAlignmentProperty)],t.prototype,"horizontalAlignment",void 0),s([h.property(t.spacingProperty)],t.prototype,"spacing",void 0),s([h.property(t.separatorProperty)],t.prototype,"separator",void 0),s([h.property(t.heightProperty)],t.prototype,"height",void 0),s([h.property(t.langProperty)],t.prototype,"lang",null),s([h.property(t.isVisibleProperty)],t.prototype,"isVisible",null),t}(u.CardObject);t.CardElement=v;var S=function(e){function t(t,i,r){void 0===r&&(r=[]);var n=e.call(this,t,i,void 0)||this;return n.targetVersion=t,n.name=i,n.forbiddenActionTypes=r,n}return n(t,e),t.prototype.parse=function(e,t,i){var r=e;return i.parseAction(r,t[this.name],this.forbiddenActionTypes,r.isDesignMode())},t.prototype.toJSON=function(e,t,i,r){r.serializeValue(t,this.name,i?i.toJSON(r):void 0,void 0,true)},t}(h.PropertyDefinition);t.ActionProperty=S;var b=function(e){function t(t){var i=e.call(this)||this;return i.ariaHidden=false,t&&(i.text=t),i}return n(t,e),t.prototype.populateSchema=function(i){e.prototype.populateSchema.call(this,i),i.remove(t.selectActionProperty)},Object.defineProperty(t.prototype,"text",{get:function(){return this.getValue(t.textProperty)},set:function(e){this.setText(e)},enumerable:false,configurable:true}),t.prototype.getFontSize=function(e){switch(this.effectiveSize){case o.TextSize.Small:return e.fontSizes.small;case o.TextSize.Medium:return e.fontSizes.medium;case o.TextSize.Large:return e.fontSizes.large;case o.TextSize.ExtraLarge:return e.fontSizes.extraLarge;default:return e.fontSizes.default}},t.prototype.getColorDefinition=function(e,t){switch(t){case o.TextColor.Accent:return e.accent;case o.TextColor.Dark:return e.dark;case o.TextColor.Light:return e.light;case o.TextColor.Good:return e.good;case o.TextColor.Warning:return e.warning;case o.TextColor.Attention:return e.attention;default:return e.default}},t.prototype.setText=function(e){this.setValue(t.textProperty,e)},t.prototype.init=function(e){this.size=e.size,this.weight=e.weight,this.color=e.color,this.isSubtle=e.isSubtle},t.prototype.asString=function(){return this.text},t.prototype.applyStylesTo=function(e){var t,i=this.hostConfig.getFontTypeDefinition(this.effectiveFontType);switch(i.fontFamily&&(e.style.fontFamily=i.fontFamily),this.effectiveSize){case o.TextSize.Small:t=i.fontSizes.small;break;case o.TextSize.Medium:t=i.fontSizes.medium;break;case o.TextSize.Large:t=i.fontSizes.large;break;case o.TextSize.ExtraLarge:t=i.fontSizes.extraLarge;break;default:t=i.fontSizes.default}e.style.fontSize=t+"px";var r,n=this.getColorDefinition(this.getEffectiveStyleDefinition().foregroundColors,this.effectiveColor);switch(e.style.color=c.stringToCssColor(this.effectiveIsSubtle?n.subtle:n.default),this.effectiveWeight){case o.TextWeight.Lighter:r=i.fontWeights.lighter;break;case o.TextWeight.Bolder:r=i.fontWeights.bolder;break;default:r=i.fontWeights.default}e.style.fontWeight=r.toString(),this.ariaHidden&&e.setAttribute("aria-hidden","true")},Object.defineProperty(t.prototype,"effectiveColor",{get:function(){return void 0!==this.color?this.color:this.getEffectiveTextStyleDefinition().color},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"effectiveFontType",{get:function(){return void 0!==this.fontType?this.fontType:this.getEffectiveTextStyleDefinition().fontType},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"effectiveIsSubtle",{get:function(){return void 0!==this.isSubtle?this.isSubtle:this.getEffectiveTextStyleDefinition().isSubtle},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"effectiveSize",{get:function(){return void 0!==this.size?this.size:this.getEffectiveTextStyleDefinition().size},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"effectiveWeight",{get:function(){return void 0!==this.weight?this.weight:this.getEffectiveTextStyleDefinition().weight},enumerable:false,configurable:true}),t.textProperty=new h.StringProperty(h.Versions.v1_0,"text",true),t.sizeProperty=new h.EnumProperty(h.Versions.v1_0,"size",o.TextSize),t.weightProperty=new h.EnumProperty(h.Versions.v1_0,"weight",o.TextWeight),t.colorProperty=new h.EnumProperty(h.Versions.v1_0,"color",o.TextColor),t.isSubtleProperty=new h.BoolProperty(h.Versions.v1_0,"isSubtle"),t.fontTypeProperty=new h.EnumProperty(h.Versions.v1_2,"fontType",o.FontType),t.selectActionProperty=new S(h.Versions.v1_1,"selectAction",["Action.ShowCard"]),s([h.property(t.sizeProperty)],t.prototype,"size",void 0),s([h.property(t.weightProperty)],t.prototype,"weight",void 0),s([h.property(t.colorProperty)],t.prototype,"color",void 0),s([h.property(t.fontTypeProperty)],t.prototype,"fontType",void 0),s([h.property(t.isSubtleProperty)],t.prototype,"isSubtle",void 0),s([h.property(t.textProperty)],t.prototype,"text",null),s([h.property(t.selectActionProperty)],t.prototype,"selectAction",void 0),t}(v);t.BaseTextBlock=b;var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.wrap=false,t._treatAsPlainText=true,t.useMarkdown=true,t}return n(t,e),t.prototype.restoreOriginalContent=function(){void 0!==this.renderedElement&&(this.maxLines&&this.maxLines>0&&(this.renderedElement.style.maxHeight=this._computedLineHeight*this.maxLines+"px"),this.renderedElement.innerHTML=this._originalInnerHtml)},t.prototype.truncateIfSupported=function(e){if(void 0!==this.renderedElement){var t=this.renderedElement.children,i=!t.length;if(i||1==t.length&&"p"==t[0].tagName.toLowerCase()){var r=i?this.renderedElement:t[0];return c.truncate(r,e,this._computedLineHeight),true}}return false},t.prototype.setText=function(t){e.prototype.setText.call(this,t),this._processedText=void 0},t.prototype.internalRender=function(){var e=this;if(this._processedText=void 0,this.text){var t=this.preProcessPropertyValue(b.textProperty),i=this.hostConfig,r=void 0;if(this.forElementId){var n=document.createElement("label");n.htmlFor=this.forElementId,r=n}else r=document.createElement("div");if(r.classList.add(i.makeCssClassName("ac-textBlock")),r.style.overflow="hidden",this.applyStylesTo(r),"heading"===this.style){r.setAttribute("role","heading");var s=this.hostConfig.textBlock.headingLevel;void 0!==s&&s>0&&r.setAttribute("aria-level",s.toString())}if(this.selectAction&&i.supportsInteractivity&&(r.onclick=function(t){e.selectAction&&e.selectAction.isEnabled&&(t.preventDefault(),t.cancelBubble=true,e.selectAction.execute())},this.selectAction.setupElementForAccessibility(r),this.selectAction.isEnabled&&r.classList.add(i.makeCssClassName("ac-selectable"))),!this._processedText){this._treatAsPlainText=true;var o=d.formatText(this.lang,t);if(this.useMarkdown&&o){a.GlobalSettings.allowMarkForTextHighlighting&&(o=o.replace(/<mark>/g,"===").replace(/<\/mark>/g,"/==/"));var l=me.applyMarkdown(o);if(l.didProcess&&l.outputHtml){if(this._processedText=l.outputHtml,this._treatAsPlainText=false,a.GlobalSettings.allowMarkForTextHighlighting&&this._processedText){var u="",h=this.getEffectiveStyleDefinition();h.highlightBackgroundColor&&(u+="background-color: "+h.highlightBackgroundColor+";"),h.highlightForegroundColor&&(u+="color: "+h.highlightForegroundColor+";"),u&&(u='style="'+u+'"'),this._processedText=this._processedText.replace(/===/g,"<mark "+u+">").replace(/\/==\//g,"</mark>")}}else this._processedText=o,this._treatAsPlainText=true}else this._processedText=o,this._treatAsPlainText=true}if(this._processedText||(this._processedText=""),this._treatAsPlainText?r.innerText=this._processedText:r.innerHTML=this._processedText,r.firstElementChild instanceof HTMLElement){var f=r.firstElementChild;f.style.marginTop="0px",f.style.width="100%",this.wrap||(f.style.overflow="hidden",f.style.textOverflow="ellipsis")}r.lastElementChild instanceof HTMLElement&&(r.lastElementChild.style.marginBottom="0px");for(var p=r.getElementsByTagName("a"),g=0;g<p.length;g++){var m=p[g];m.classList.add(i.makeCssClassName("ac-anchor")),m.target="_blank",m.onclick=function(t){ae(e,t.target,t)&&(t.preventDefault(),t.cancelBubble=true)},m.oncontextmenu=function(t){return!ae(e,t.target,t)||(t.preventDefault(),t.cancelBubble=true,false)}}return this.wrap?(r.style.wordWrap="break-word",this.maxLines&&this.maxLines>0&&(r.style.overflow="hidden",c.isInternetExplorer()||!a.GlobalSettings.useWebkitLineClamp?r.style.maxHeight=this._computedLineHeight*this.maxLines+"px":(r.style.removeProperty("line-height"),r.style.display="-webkit-box",r.style.webkitBoxOrient="vertical",r.style.webkitLineClamp=this.maxLines.toString()))):(r.style.whiteSpace="nowrap",r.style.textOverflow="ellipsis"),(a.GlobalSettings.useAdvancedTextBlockTruncation||a.GlobalSettings.useAdvancedCardBottomTruncation)&&(this._originalInnerHtml=r.innerHTML),r}},t.prototype.truncateOverflow=function(e){return e>=this._computedLineHeight&&this.truncateIfSupported(e)},t.prototype.undoOverflowTruncation=function(){if(this.restoreOriginalContent(),a.GlobalSettings.useAdvancedTextBlockTruncation&&this.maxLines){var e=this._computedLineHeight*this.maxLines;this.truncateIfSupported(e)}},t.prototype.applyStylesTo=function(t){switch(e.prototype.applyStylesTo.call(this,t),this.getEffectiveHorizontalAlignment()){case o.HorizontalAlignment.Center:t.style.textAlign="center";break;case o.HorizontalAlignment.Right:t.style.textAlign="end";break;default:t.style.textAlign="start"}var i=this.hostConfig.lineHeights;if(i)switch(this.effectiveSize){case o.TextSize.Small:this._computedLineHeight=i.small;break;case o.TextSize.Medium:this._computedLineHeight=i.medium;break;case o.TextSize.Large:this._computedLineHeight=i.large;break;case o.TextSize.ExtraLarge:this._computedLineHeight=i.extraLarge;break;default:this._computedLineHeight=i.default}else this._computedLineHeight=1.33*this.getFontSize(this.hostConfig.getFontTypeDefinition(this.effectiveFontType));t.style.lineHeight=this._computedLineHeight+"px"},t.prototype.getJsonTypeName=function(){return"TextBlock"},t.prototype.getEffectiveTextStyleDefinition=function(){return this.style?this.hostConfig.textStyles.getStyleByName(this.style):e.prototype.getEffectiveTextStyleDefinition.call(this)},t.prototype.updateLayout=function(t){void 0===t&&(t=false),e.prototype.updateLayout.call(this,t),a.GlobalSettings.useAdvancedTextBlockTruncation&&this.maxLines&&this.isDisplayed()&&(this.restoreOriginalContent(),this.truncateIfSupported(this._computedLineHeight*this.maxLines))},t.wrapProperty=new h.BoolProperty(h.Versions.v1_0,"wrap",false),t.maxLinesProperty=new h.NumProperty(h.Versions.v1_0,"maxLines"),t.styleProperty=new h.ValueSetProperty(h.Versions.v1_5,"style",[{value:"default"},{value:"columnHeader"},{value:"heading"}]),s([h.property(t.wrapProperty)],t.prototype,"wrap",void 0),s([h.property(t.maxLinesProperty)],t.prototype,"maxLines",void 0),s([h.property(t.styleProperty)],t.prototype,"style",void 0),t}(b);t.TextBlock=y;var C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.italic=false,t.strikethrough=false,t.highlight=false,t.underline=false,t}return n(t,e),t.prototype.populateSchema=function(t){e.prototype.populateSchema.call(this,t),t.add(b.selectActionProperty)},t.prototype.internalRender=function(){var e=this;if(this.text){var t=this.preProcessPropertyValue(b.textProperty),i=this.hostConfig,r=d.formatText(this.lang,t);r||(r="");var n=document.createElement("span");if(n.classList.add(i.makeCssClassName("ac-textRun")),this.applyStylesTo(n),this.selectAction&&i.supportsInteractivity){var s=document.createElement("a");s.classList.add(i.makeCssClassName("ac-anchor"));var o=this.selectAction.getHref();s.href=o||"",s.target="_blank",s.onclick=function(t){e.selectAction&&e.selectAction.isEnabled&&(t.preventDefault(),t.cancelBubble=true,e.selectAction.execute())},this.selectAction.setupElementForAccessibility(s),s.innerText=r,n.appendChild(s)}else n.innerText=r;return n}},t.prototype.applyStylesTo=function(t){if(e.prototype.applyStylesTo.call(this,t),this.italic&&(t.style.fontStyle="italic"),this.strikethrough&&(t.style.textDecoration="line-through"),this.highlight){var i=this.getColorDefinition(this.getEffectiveStyleDefinition().foregroundColors,this.effectiveColor);t.style.backgroundColor=c.stringToCssColor(this.effectiveIsSubtle?i.highlightColors.subtle:i.highlightColors.default)}this.underline&&(t.style.textDecoration="underline")},t.prototype.getJsonTypeName=function(){return"TextRun"},Object.defineProperty(t.prototype,"isStandalone",{get:function(){return false},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"isInline",{get:function(){return true},enumerable:false,configurable:true}),t.italicProperty=new h.BoolProperty(h.Versions.v1_2,"italic",false),t.strikethroughProperty=new h.BoolProperty(h.Versions.v1_2,"strikethrough",false),t.highlightProperty=new h.BoolProperty(h.Versions.v1_2,"highlight",false),t.underlineProperty=new h.BoolProperty(h.Versions.v1_3,"underline",false),s([h.property(t.italicProperty)],t.prototype,"italic",void 0),s([h.property(t.strikethroughProperty)],t.prototype,"strikethrough",void 0),s([h.property(t.highlightProperty)],t.prototype,"highlight",void 0),s([h.property(t.underlineProperty)],t.prototype,"underline",void 0),t}(b);t.TextRun=C;var w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._inlines=[],t}return n(t,e),t.prototype.internalAddInline=function(e,t){if(void 0===t&&(t=false),!e.isInline)throw new Error(p.Strings.errors.elementCannotBeUsedAsInline());if(!(void 0===e.parent||t)&&e.parent!=this)throw new Error(p.Strings.errors.inlineAlreadyParented());e.setParent(this),this._inlines.push(e)},t.prototype.internalParse=function(t,i){if(e.prototype.internalParse.call(this,t,i),this._inlines=[],Array.isArray(t.inlines))for(var r=0,n=t.inlines;r<n.length;r++){var s=n[r],o=void 0;if("string"==typeof s){var a=new C;a.text=s,o=a}else o=i.parseElement(this,s,false);o&&this.internalAddInline(o,true)}},t.prototype.internalToJSON=function(t,i){if(e.prototype.internalToJSON.call(this,t,i),this._inlines.length>0){for(var r=[],n=0,s=this._inlines;n<s.length;n++){var o=s[n];r.push(o.toJSON(i))}i.serializeValue(t,"inlines",r)}},t.prototype.internalRender=function(){if(this._inlines.length>0){var e=void 0;if(this.forElementId){var t=document.createElement("label");t.htmlFor=this.forElementId,e=t}else e=document.createElement("div");switch(e.className=this.hostConfig.makeCssClassName("ac-richTextBlock"),this.getEffectiveHorizontalAlignment()){case o.HorizontalAlignment.Center:e.style.textAlign="center";break;case o.HorizontalAlignment.Right:e.style.textAlign="end";break;default:e.style.textAlign="start"}for(var i=0,r=0,n=this._inlines;r<n.length;r++){var s=n[r].render();s&&(e.appendChild(s),i++)}if(i>0)return e}},t.prototype.asString=function(){for(var e="",t=0,i=this._inlines;t<i.length;t++){e+=i[t].asString()}return e},t.prototype.getJsonTypeName=function(){return"RichTextBlock"},t.prototype.getInlineCount=function(){return this._inlines.length},t.prototype.getInlineAt=function(e){if(e>=0&&e<this._inlines.length)return this._inlines[e];throw new Error(p.Strings.errors.indexOutOfRange(e))},t.prototype.addInline=function(e){"string"==typeof e?this.internalAddInline(new C(e)):this.internalAddInline(e)},t.prototype.removeInline=function(e){var t=this._inlines.indexOf(e);return t>=0&&(this._inlines[t].setParent(void 0),this._inlines.splice(t,1),true)},t}(v);t.RichTextBlock=w;var _=function(e){function t(t,i){var r=e.call(this)||this;return r.name=t,r.value=i,r}return n(t,e),t.prototype.getSchemaKey=function(){return"Fact"},t.titleProperty=new h.StringProperty(h.Versions.v1_0,"title"),t.valueProperty=new h.StringProperty(h.Versions.v1_0,"value"),s([h.property(t.titleProperty)],t.prototype,"name",void 0),s([h.property(t.valueProperty)],t.prototype,"value",void 0),t}(h.SerializableObject);t.Fact=_;var E=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),Object.defineProperty(t.prototype,"useDefaultSizing",{get:function(){return false},enumerable:false,configurable:true}),t.prototype.internalRender=function(){var e=void 0,t=this.hostConfig;if(this.facts.length>0){(e=document.createElement("table")).style.borderWidth="0px",e.style.borderSpacing="0px",e.style.borderStyle="none",e.style.borderCollapse="collapse",e.style.display="block",e.style.overflow="hidden",e.classList.add(t.makeCssClassName("ac-factset")),e.setAttribute("role","presentation");for(var i=0;i<this.facts.length;i++){var r=document.createElement("tr");i>0&&(r.style.marginTop=t.factSet.spacing+"px");var n=document.createElement("td");n.style.padding="0",n.classList.add(t.makeCssClassName("ac-fact-title")),t.factSet.title.maxWidth&&(n.style.maxWidth=t.factSet.title.maxWidth+"px"),n.style.verticalAlign="top";var s=new y;s.setParent(this),s.text=!this.facts[i].name&&this.isDesignMode()?"Title":this.facts[i].name,s.size=t.factSet.title.size,s.color=t.factSet.title.color,s.isSubtle=t.factSet.title.isSubtle,s.weight=t.factSet.title.weight,s.wrap=t.factSet.title.wrap,s.spacing=o.Spacing.None,c.appendChild(n,s.render()),c.appendChild(r,n),(n=document.createElement("td")).style.width="10px",c.appendChild(r,n),(n=document.createElement("td")).style.padding="0",n.style.verticalAlign="top",n.classList.add(t.makeCssClassName("ac-fact-value")),(s=new y).setParent(this),s.text=this.facts[i].value,s.size=t.factSet.value.size,s.color=t.factSet.value.color,s.isSubtle=t.factSet.value.isSubtle,s.weight=t.factSet.value.weight,s.wrap=t.factSet.value.wrap,s.spacing=o.Spacing.None,c.appendChild(n,s.render()),c.appendChild(r,n),c.appendChild(e,r)}}return e},t.prototype.getJsonTypeName=function(){return"FactSet"},t.factsProperty=new h.SerializableObjectCollectionProperty(h.Versions.v1_0,"facts",_),s([h.property(t.factsProperty)],t.prototype,"facts",void 0),t}(v);t.FactSet=E;var T=function(e){function t(t,i,r,n){var s=e.call(this,t,i)||this;return s.targetVersion=t,s.name=i,s.internalName=r,s.fallbackProperty=n,s}return n(t,e),t.prototype.getInternalName=function(){return this.internalName},t.prototype.parse=function(e,t,i){var r=void 0,n=t[this.name];if(void 0===n)return this.defaultValue;var s=false;if("string"==typeof n){try{var c=a.SizeAndUnit.parse(n,true);c.unit==o.SizeUnit.Pixel&&(r=c.physicalSize,s=true)}catch(l){}!s&&this.fallbackProperty&&(s=this.fallbackProperty.isValidValue(n,i))}return s||i.logParseEvent(e,o.ValidationEvent.InvalidPropertyValue,p.Strings.errors.invalidPropertyValue(n,this.name)),r},t.prototype.toJSON=function(e,t,i,r){r.serializeValue(t,this.name,"number"!=typeof i||isNaN(i)?void 0:i+"px")},t}(h.PropertyDefinition),I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.size=o.Size.Auto,t.style=o.ImageStyle.Default,t}return n(t,e),t.prototype.populateSchema=function(t){e.prototype.populateSchema.call(this,t),t.remove(v.heightProperty)},t.prototype.applySize=function(e){if(this.pixelWidth||this.pixelHeight)this.pixelWidth&&(e.style.width=this.pixelWidth+"px"),this.pixelHeight&&(e.style.height=this.pixelHeight+"px");else if(this.maxHeight){switch(this.size){case o.Size.Small:e.style.height=this.hostConfig.imageSizes.small+"px";break;case o.Size.Large:e.style.height=this.hostConfig.imageSizes.large+"px";break;default:e.style.height=this.hostConfig.imageSizes.medium+"px"}e.style.maxHeight=this.maxHeight+"px"}else{switch(this.size){case o.Size.Stretch:e.style.width="100%";break;case o.Size.Auto:e.style.maxWidth="100%";break;case o.Size.Small:e.style.width=this.hostConfig.imageSizes.small+"px";break;case o.Size.Large:e.style.width=this.hostConfig.imageSizes.large+"px";break;case o.Size.Medium:e.style.width=this.hostConfig.imageSizes.medium+"px"}e.style.maxHeight="100%"}},Object.defineProperty(t.prototype,"useDefaultSizing",{get:function(){return false},enumerable:false,configurable:true}),t.prototype.internalRender=function(){var e=this,i=void 0;if(this.url){(i=document.createElement("div")).style.display="flex",i.style.alignItems="flex-start";var r=this.hostConfig;switch(this.getEffectiveHorizontalAlignment()){case o.HorizontalAlignment.Center:i.style.justifyContent="center";break;case o.HorizontalAlignment.Right:i.style.justifyContent="flex-end";break;default:i.style.justifyContent="flex-start"}var n=document.createElement("img");n.onload=function(t){oe(e)},n.onerror=function(t){if(e.renderedElement){var i=e.getRootElement();if(e.renderedElement.innerHTML="",i&&i.designMode){var r=document.createElement("div");r.style.display="flex",r.style.alignItems="center",r.style.justifyContent="center",r.style.backgroundColor="#EEEEEE",r.style.color="black",r.innerText=":-(",r.style.padding="10px",e.applySize(r),e.renderedElement.appendChild(r)}}oe(e)},n.style.minWidth="0",n.classList.add(r.makeCssClassName("ac-image")),this.selectAction&&r.supportsInteractivity&&(n.onkeypress=function(t){e.selectAction&&e.selectAction.isEnabled&&("Enter"==t.code||"Space"==t.code)&&(t.preventDefault(),t.cancelBubble=true,e.selectAction.execute())},n.onclick=function(t){e.selectAction&&e.selectAction.isEnabled&&(t.preventDefault(),t.cancelBubble=true,e.selectAction.execute())},this.selectAction.setupElementForAccessibility(n),this.selectAction.isEnabled&&n.classList.add(r.makeCssClassName("ac-selectable"))),this.applySize(n),this.style===o.ImageStyle.Person&&(n.style.borderRadius="50%",n.style.backgroundPosition="50% 50%",n.style.backgroundRepeat="no-repeat"),n.style.backgroundColor=c.stringToCssColor(this.backgroundColor),n.src=this.preProcessPropertyValue(t.urlProperty);var s=this.preProcessPropertyValue(t.altTextProperty);s&&(n.alt=s),i.appendChild(n)}return i},t.prototype.getJsonTypeName=function(){return"Image"},t.prototype.getActionById=function(t){var i=e.prototype.getActionById.call(this,t);return!i&&this.selectAction&&(i=this.selectAction.getActionById(t)),i},t.prototype.getResourceInformation=function(){return this.url?[{url:this.url,mimeType:"image"}]:[]},t.urlProperty=new h.StringProperty(h.Versions.v1_0,"url"),t.altTextProperty=new h.StringProperty(h.Versions.v1_0,"altText"),t.backgroundColorProperty=new h.StringProperty(h.Versions.v1_1,"backgroundColor"),t.styleProperty=new h.EnumProperty(h.Versions.v1_0,"style",o.ImageStyle,o.ImageStyle.Default),t.sizeProperty=new h.EnumProperty(h.Versions.v1_0,"size",o.Size,o.Size.Auto),t.pixelWidthProperty=new T(h.Versions.v1_1,"width","pixelWidth"),t.pixelHeightProperty=new T(h.Versions.v1_1,"height","pixelHeight",v.heightProperty),t.selectActionProperty=new S(h.Versions.v1_1,"selectAction",["Action.ShowCard"]),s([h.property(t.urlProperty)],t.prototype,"url",void 0),s([h.property(t.altTextProperty)],t.prototype,"altText",void 0),s([h.property(t.backgroundColorProperty)],t.prototype,"backgroundColor",void 0),s([h.property(t.sizeProperty)],t.prototype,"size",void 0),s([h.property(t.styleProperty)],t.prototype,"style",void 0),s([h.property(t.pixelWidthProperty)],t.prototype,"pixelWidth",void 0),s([h.property(t.pixelHeightProperty)],t.prototype,"pixelHeight",void 0),s([h.property(t.selectActionProperty)],t.prototype,"selectAction",void 0),t}(v);t.Image=I;var P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allowVerticalOverflow=false,t}return n(t,e),t.prototype.populateSchema=function(i){e.prototype.populateSchema.call(this,i),this.isSelectable||i.remove(t.selectActionProperty)},t.prototype.isElementAllowed=function(e){return this.hostConfig.supportsInteractivity||!e.isInteractive},t.prototype.applyPadding=function(){if(e.prototype.applyPadding.call(this),this.renderedElement){var t=new a.SpacingDefinition;this.getEffectivePadding()&&(t=this.hostConfig.paddingDefinitionToSpacingDefinition(this.getEffectivePadding())),this.renderedElement.style.paddingTop=t.top+"px",this.renderedElement.style.paddingRight=t.right+"px",this.renderedElement.style.paddingBottom=t.bottom+"px",this.renderedElement.style.paddingLeft=t.left+"px",this.renderedElement.style.marginRight="0",this.renderedElement.style.marginLeft="0"}},Object.defineProperty(t.prototype,"isSelectable",{get:function(){return false},enumerable:false,configurable:true}),t.prototype.internalValidateProperties=function(t){e.prototype.internalValidateProperties.call(this,t);for(var i=0;i<this.getItemCount();i++){var r=this.getItemAt(i);!this.hostConfig.supportsInteractivity&&r.isInteractive&&t.addFailure(this,o.ValidationEvent.InteractivityNotAllowed,p.Strings.errors.interactivityNotAllowed()),this.isElementAllowed(r)||t.addFailure(this,o.ValidationEvent.InteractivityNotAllowed,p.Strings.errors.elementTypeNotAllowed(r.getJsonTypeName())),r.internalValidateProperties(t)}this._selectAction&&this._selectAction.internalValidateProperties(t)},t.prototype.render=function(){var t=this,i=e.prototype.render.call(this);if(i){var r=this.hostConfig;this.allowVerticalOverflow&&(i.style.overflowX="hidden",i.style.overflowY="auto"),i&&this.isSelectable&&this._selectAction&&r.supportsInteractivity&&(i.onclick=function(e){t._selectAction&&t._selectAction.isEnabled&&(e.preventDefault(),e.cancelBubble=true,t._selectAction.execute())},i.onkeypress=function(e){t._selectAction&&t._selectAction.isEnabled&&("Enter"==e.code||"Space"==e.code)&&(e.preventDefault(),e.cancelBubble=true,t._selectAction.execute())},this._selectAction.setupElementForAccessibility(i),this._selectAction.isEnabled&&i.classList.add(r.makeCssClassName("ac-selectable")))}return i},t.prototype.updateLayout=function(t){if(void 0===t&&(t=true),e.prototype.updateLayout.call(this,t),t)for(var i=0;i<this.getItemCount();i++)this.getItemAt(i).updateLayout()},t.prototype.getAllInputs=function(e){void 0===e&&(e=true);for(var t=[],i=0;i<this.getItemCount();i++)t=t.concat(this.getItemAt(i).getAllInputs(e));return t},t.prototype.getResourceInformation=function(){for(var e=[],t=0;t<this.getItemCount();t++)e=e.concat(this.getItemAt(t).getResourceInformation());return e},t.prototype.getElementById=function(t){var i=e.prototype.getElementById.call(this,t);if(!i)for(var r=0;r<this.getItemCount()&&!(i=this.getItemAt(r).getElementById(t));r++);return i},t.prototype.findDOMNodeOwner=function(t){for(var i=void 0,r=0;r<this.getItemCount();r++)if(i=this.getItemAt(r).findDOMNodeOwner(t))return i;return e.prototype.findDOMNodeOwner.call(this,t)},t.selectActionProperty=new S(h.Versions.v1_1,"selectAction",["Action.ShowCard"]),s([h.property(t.selectActionProperty)],t.prototype,"_selectAction",void 0),t}(v);t.CardElementContainer=P;var A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._images=[],t.imageSize=o.ImageSize.Medium,t}return n(t,e),t.prototype.internalRender=function(){var e=void 0;if(this._images.length>0){(e=document.createElement("div")).style.display="flex",e.style.flexWrap="wrap";for(var t=0,i=this._images;t<i.length;t++){var r=i[t];switch(this.imageSize){case o.ImageSize.Small:r.size=o.Size.Small;break;case o.ImageSize.Large:r.size=o.Size.Large;break;default:r.size=o.Size.Medium}r.maxHeight=this.hostConfig.imageSet.maxImageHeight;var n=r.render();n&&(n.style.display="inline-flex",n.style.margin="0px",n.style.marginRight="10px",c.appendChild(e,n))}}return e},t.prototype.getItemCount=function(){return this._images.length},t.prototype.getItemAt=function(e){return this._images[e]},t.prototype.getFirstVisibleRenderedItem=function(){return this._images&&this._images.length>0?this._images[0]:void 0},t.prototype.getLastVisibleRenderedItem=function(){return this._images&&this._images.length>0?this._images[this._images.length-1]:void 0},t.prototype.removeItem=function(e){if(e instanceof I){var t=this._images.indexOf(e);if(t>=0)return this._images.splice(t,1),e.setParent(void 0),this.updateLayout(),true}return false},t.prototype.getJsonTypeName=function(){return"ImageSet"},t.prototype.addImage=function(e){if(e.parent)throw new Error("This image already belongs to another ImageSet");this._images.push(e),e.setParent(this)},t.prototype.indexOf=function(e){return e instanceof I?this._images.indexOf(e):-1},t.imagesProperty=new h.SerializableObjectCollectionProperty(h.Versions.v1_0,"images",I,(function(e,t){t.setParent(e)})),t.imageSizeProperty=new h.EnumProperty(h.Versions.v1_0,"imageSize",o.ImageSize,o.ImageSize.Medium),s([h.property(t.imagesProperty)],t.prototype,"_images",void 0),s([h.property(t.imageSizeProperty)],t.prototype,"imageSize",void 0),t}(P);t.ImageSet=A;var M=function(e){function t(t,i){var r=e.call(this)||this;return r.url=t,r.mimeType=i,r}return n(t,e),t.prototype.getSchemaKey=function(){return"MediaSource"},t.prototype.isValid=function(){return!(!this.mimeType||!this.url)},t.prototype.render=function(){var e=void 0;return this.isValid()&&((e=document.createElement("source")).src=this.url,e.type=this.mimeType),e},t.mimeTypeProperty=new h.StringProperty(h.Versions.v1_1,"mimeType"),t.urlProperty=new h.StringProperty(h.Versions.v1_1,"url"),s([h.property(t.mimeTypeProperty)],t.prototype,"mimeType",void 0),s([h.property(t.urlProperty)],t.prototype,"url",void 0),t}(h.SerializableObject);t.MediaSource=M;var D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sources=[],t}return n(t,e),t.prototype.getPosterUrl=function(){return this.poster?this.poster:this.hostConfig.media.defaultPoster},t.prototype.processSources=function(){this._selectedSources=[],this._selectedMediaType=void 0;for(var e=0,i=this.sources;e<i.length;e++){var r=i[e],n=r.mimeType?r.mimeType.split("/"):[];if(2==n.length){if(!this._selectedMediaType){var s=t.supportedMediaTypes.indexOf(n[0]);s>=0&&(this._selectedMediaType=t.supportedMediaTypes[s])}n[0]==this._selectedMediaType&&this._selectedSources.push(r)}}},t.prototype.handlePlayButtonInvoke=function(e){if(this.hostConfig.media.allowInlinePlayback){if(e.preventDefault(),e.cancelBubble=true,this.renderedElement){var i=this.renderMediaPlayer();this.renderedElement.innerHTML="",this.renderedElement.appendChild(i),i.play(),i.focus()}}else t.onPlay&&(e.preventDefault(),e.cancelBubble=true,t.onPlay(this))},t.prototype.renderPoster=function(){var e=this,t=document.createElement("div");t.className=this.hostConfig.makeCssClassName("ac-media-poster"),t.setAttribute("role","contentinfo"),t.setAttribute("aria-label",this.altText?this.altText:p.Strings.defaults.mediaPlayerAriaLabel()),t.style.position="relative",t.style.display="flex";var i=this.getPosterUrl();if(i){var r=document.createElement("img");r.style.width="100%",r.style.height="100%",r.setAttribute("role","presentation"),r.onerror=function(e){r.parentNode&&r.parentNode.removeChild(r),t.classList.add("empty"),t.style.minHeight="150px"},r.src=i,t.appendChild(r)}else t.classList.add("empty"),t.style.minHeight="150px";if(this.hostConfig.supportsInteractivity&&this._selectedSources.length>0){var n=document.createElement("div");n.tabIndex=0,n.setAttribute("role","button"),n.setAttribute("aria-label",p.Strings.defaults.mediaPlayerPlayMedia()),n.className=this.hostConfig.makeCssClassName("ac-media-playButton"),n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.onclick=function(t){e.handlePlayButtonInvoke(t)},n.onkeypress=function(t){"Enter"!=t.code&&"Space"!=t.code||e.handlePlayButtonInvoke(t)};var s=document.createElement("div");s.className=this.hostConfig.makeCssClassName("ac-media-playButton-arrow"),s.style.width="12px",s.style.height="15px",s.style.borderTopWidth="7.5px",s.style.borderBottomWidth="7.5px",s.style.borderLeftWidth="12px",s.style.borderRightWidth="0",s.style.borderStyle="solid",s.style.borderTopColor="transparent",s.style.borderRightColor="transparent",s.style.borderBottomColor="transparent",s.style.transform="translate(1.2px,0px)",n.appendChild(s);var o=document.createElement("div");o.style.position="absolute",o.style.left="0",o.style.top="0",o.style.width="100%",o.style.height="100%",o.style.display="flex",o.style.justifyContent="center",o.style.alignItems="center",o.appendChild(n),t.appendChild(o)}return t},t.prototype.renderMediaPlayer=function(){var e;if("video"==this._selectedMediaType){var t=document.createElement("video"),i=this.getPosterUrl();i&&(t.poster=i),e=t}else e=document.createElement("audio");e.setAttribute("aria-label",this.altText?this.altText:p.Strings.defaults.mediaPlayerAriaLabel()),e.setAttribute("webkit-playsinline",""),e.setAttribute("playsinline",""),e.autoplay=true,e.controls=true,c.isMobileOS()&&(e.muted=true),e.preload="none",e.style.width="100%";for(var r=0,n=this.sources;r<n.length;r++){var s=n[r].render();c.appendChild(e,s)}return e},t.prototype.internalRender=function(){var e=document.createElement("div");return e.className=this.hostConfig.makeCssClassName("ac-media"),this.processSources(),e.appendChild(this.renderPoster()),e},t.prototype.getJsonTypeName=function(){return"Media"},t.prototype.getResourceInformation=function(){var e=[],t=this.getPosterUrl();t&&e.push({url:t,mimeType:"image"});for(var i=0,r=this.sources;i<r.length;i++){var n=r[i];n.isValid()&&e.push({url:n.url,mimeType:n.mimeType})}return e},Object.defineProperty(t.prototype,"selectedMediaType",{get:function(){return this._selectedMediaType},enumerable:false,configurable:true}),t.sourcesProperty=new h.SerializableObjectCollectionProperty(h.Versions.v1_1,"sources",M),t.posterProperty=new h.StringProperty(h.Versions.v1_1,"poster"),t.altTextProperty=new h.StringProperty(h.Versions.v1_1,"altText"),t.supportedMediaTypes=["audio","video"],s([h.property(t.sourcesProperty)],t.prototype,"sources",void 0),s([h.property(t.posterProperty)],t.prototype,"poster",void 0),s([h.property(t.altTextProperty)],t.prototype,"altText",void 0),t}(v);t.Media=D;var R=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getAllLabelIds=function(){var e=[];return this.labelledBy&&e.push(this.labelledBy),this._renderedLabelElement&&e.push(this._renderedLabelElement.id),this._renderedErrorMessageElement&&e.push(this._renderedErrorMessageElement.id),e},t.prototype.updateInputControlAriaLabelledBy=function(){if(this._renderedInputControlElement){var e=this.getAllLabelIds();e.length>0?this._renderedInputControlElement.setAttribute("aria-labelledby",e.join(" ")):this._renderedInputControlElement.removeAttribute("aria-labelledby")}},Object.defineProperty(t.prototype,"isNullable",{get:function(){return true},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"renderedInputControlElement",{get:function(){return this._renderedInputControlElement},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"inputControlContainerElement",{get:function(){return this._inputControlContainerElement},enumerable:false,configurable:true}),t.prototype.overrideInternalRender=function(){var e=this.hostConfig;this._outerContainerElement=document.createElement("div"),this._outerContainerElement.style.display="flex",this._outerContainerElement.style.flexDirection="column";var t=c.generateUniqueId();if(this.label){var i=new w;i.setParent(this),i.forElementId=t;var r=new C(this.label);if(i.addInline(r),this.isRequired){r.init(e.inputs.label.requiredInputs);var n=new C(e.inputs.label.requiredInputs.suffix);n.color=e.inputs.label.requiredInputs.suffixColor,n.ariaHidden=true,i.addInline(n)}else r.init(e.inputs.label.optionalInputs);this._renderedLabelElement=i.render(),this._renderedLabelElement&&(this._renderedLabelElement.id=c.generateUniqueId(),this._renderedLabelElement.style.marginBottom=e.getEffectiveSpacing(e.inputs.label.inputSpacing)+"px",this._outerContainerElement.appendChild(this._renderedLabelElement))}if(this._inputControlContainerElement=document.createElement("div"),this._inputControlContainerElement.className=e.makeCssClassName("ac-input-container"),this._inputControlContainerElement.style.display="flex","stretch"===this.height&&(this._inputControlContainerElement.style.alignItems="stretch",this._inputControlContainerElement.style.flex="1 1 auto"),this._renderedInputControlElement=this.internalRender(),this._renderedInputControlElement)return this._renderedInputControlElement.id=t,this._renderedInputControlElement.style.minWidth="0px",this.isNullable&&this.isRequired&&(this._renderedInputControlElement.setAttribute("aria-required","true"),this._renderedInputControlElement.classList.add(e.makeCssClassName("ac-input-required"))),this._inputControlContainerElement.appendChild(this._renderedInputControlElement),this._outerContainerElement.appendChild(this._inputControlContainerElement),this.updateInputControlAriaLabelledBy(),this._outerContainerElement},t.prototype.valueChanged=function(){var e,t,i;this.isValid()&&this.resetValidationFailureCue(),this.onValueChanged&&this.onValueChanged(this),t=(e=this).getRootElement(),(i=t&&t.onInputValueChanged?t.onInputValueChanged:me.onInputValueChanged)&&i(e)},t.prototype.resetValidationFailureCue=function(){this.renderedInputControlElement&&(this.renderedInputControlElement.classList.remove(this.hostConfig.makeCssClassName("ac-input-validation-failed")),this.updateInputControlAriaLabelledBy(),this._renderedErrorMessageElement&&(this._outerContainerElement.removeChild(this._renderedErrorMessageElement),this._renderedErrorMessageElement=void 0))},t.prototype.showValidationErrorMessage=function(){if(this.renderedElement&&this.errorMessage&&a.GlobalSettings.displayInputValidationErrors){var e=new y;e.setParent(this),e.text=this.errorMessage,e.wrap=true,e.init(this.hostConfig.inputs.errorMessage),this._renderedErrorMessageElement=e.render(),this._renderedErrorMessageElement&&(this._renderedErrorMessageElement.id=c.generateUniqueId(),this._outerContainerElement.appendChild(this._renderedErrorMessageElement),this.updateInputControlAriaLabelledBy())}},t.prototype.focus=function(){this._renderedInputControlElement&&this._renderedInputControlElement.focus()},t.prototype.isValid=function(){return true},t.prototype.internalValidateProperties=function(t){e.prototype.internalValidateProperties.call(this,t),this.id||t.addFailure(this,o.ValidationEvent.PropertyCantBeNull,p.Strings.errors.inputsMustHaveUniqueId()),this.isRequired&&(this.label||t.addFailure(this,o.ValidationEvent.RequiredInputsShouldHaveLabel,"Required inputs should have a label"),this.errorMessage||t.addFailure(this,o.ValidationEvent.RequiredInputsShouldHaveErrorMessage,"Required inputs should have an error message"))},t.prototype.validateValue=function(){this.resetValidationFailureCue();var e=this.isRequired?this.isSet()&&this.isValid():this.isValid();return!e&&this.renderedInputControlElement&&(this.renderedInputControlElement.classList.add(this.hostConfig.makeCssClassName("ac-input-validation-failed")),this.showValidationErrorMessage()),e},t.prototype.getAllInputs=function(e){return[this]},Object.defineProperty(t.prototype,"isInteractive",{get:function(){return true},enumerable:false,configurable:true}),t.labelProperty=new h.StringProperty(h.Versions.v1_3,"label",true),t.isRequiredProperty=new h.BoolProperty(h.Versions.v1_3,"isRequired",false),t.errorMessageProperty=new h.StringProperty(h.Versions.v1_3,"errorMessage",true),s([h.property(t.labelProperty)],t.prototype,"label",void 0),s([h.property(t.isRequiredProperty)],t.prototype,"isRequired",void 0),s([h.property(t.errorMessageProperty)],t.prototype,"errorMessage",void 0),t}(v);t.Input=R;var O=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isMultiline=false,t.style=o.InputTextStyle.Text,t}return n(t,e),t.prototype.setupInput=function(e){var t=this;e.style.flex="1 1 auto",e.tabIndex=0,this.placeholder&&(e.placeholder=this.placeholder,e.setAttribute("aria-label",this.placeholder)),this.defaultValue&&(e.value=this.defaultValue),this.maxLength&&this.maxLength>0&&(e.maxLength=this.maxLength),e.oninput=function(){t.valueChanged()},e.onkeypress=function(e){e.ctrlKey&&"Enter"===e.code&&t.inlineAction&&t.inlineAction.isEnabled&&t.inlineAction.execute()}},t.prototype.internalRender=function(){var e;return this.isMultiline&&this.style!==o.InputTextStyle.Password?((e=document.createElement("textarea")).className=this.hostConfig.makeCssClassName("ac-input","ac-textInput","ac-multiline"),"stretch"===this.height&&(e.style.height="initial")):((e=document.createElement("input")).className=this.hostConfig.makeCssClassName("ac-input","ac-textInput"),e.type=o.InputTextStyle[this.style].toLowerCase()),this.setupInput(e),e},t.prototype.overrideInternalRender=function(){var t=this,i=e.prototype.overrideInternalRender.call(this);if(this.inlineAction){var r=document.createElement("button");if(r.className=this.hostConfig.makeCssClassName(this.inlineAction.isEnabled?"ac-inlineActionButton":"ac-inlineActionButton-disabled"),r.onclick=function(e){t.inlineAction&&t.inlineAction.isEnabled&&(e.preventDefault(),e.cancelBubble=true,t.inlineAction.execute())},this.inlineAction.iconUrl){r.classList.add("iconOnly");var n=document.createElement("img");n.style.height="100%",n.setAttribute("role","presentation"),n.style.display="none",n.onload=function(){n.style.removeProperty("display")},n.onerror=function(){r.removeChild(n),r.classList.remove("iconOnly"),r.classList.add("textOnly"),r.textContent=t.inlineAction&&t.inlineAction.title?t.inlineAction.title:p.Strings.defaults.inlineActionTitle()},n.src=this.inlineAction.iconUrl,r.appendChild(n),r.title=this.inlineAction.title?this.inlineAction.title:p.Strings.defaults.inlineActionTitle()}else r.classList.add("textOnly"),r.textContent=this.inlineAction.title?this.inlineAction.title:p.Strings.defaults.inlineActionTitle();this.inlineAction.setupElementForAccessibility(r,true),r.style.marginLeft="8px",this.inputControlContainerElement.appendChild(r)}return i},t.prototype.getJsonTypeName=function(){return"Input.Text"},t.prototype.getActionById=function(t){var i=e.prototype.getActionById.call(this,t);return!i&&this.inlineAction&&(i=this.inlineAction.getActionById(t)),i},t.prototype.isSet=function(){return!!this.value},t.prototype.isValid=function(){return!this.value||(!this.regex||new RegExp(this.regex,"g").test(this.value))},Object.defineProperty(t.prototype,"value",{get:function(){return this.renderedInputControlElement?(this.isMultiline,this.renderedInputControlElement.value):void 0},enumerable:false,configurable:true}),t.valueProperty=new h.StringProperty(h.Versions.v1_0,"value"),t.maxLengthProperty=new h.NumProperty(h.Versions.v1_0,"maxLength"),t.isMultilineProperty=new h.BoolProperty(h.Versions.v1_0,"isMultiline",false),t.placeholderProperty=new h.StringProperty(h.Versions.v1_0,"placeholder"),t.styleProperty=new h.EnumProperty(h.Versions.v1_0,"style",o.InputTextStyle,o.InputTextStyle.Text,[{value:o.InputTextStyle.Text},{value:o.InputTextStyle.Tel},{value:o.InputTextStyle.Url},{value:o.InputTextStyle.Email},{value:o.InputTextStyle.Password,targetVersion:h.Versions.v1_5}]),t.inlineActionProperty=new S(h.Versions.v1_0,"inlineAction",["Action.ShowCard"]),t.regexProperty=new h.StringProperty(h.Versions.v1_3,"regex",true),s([h.property(t.valueProperty)],t.prototype,"defaultValue",void 0),s([h.property(t.maxLengthProperty)],t.prototype,"maxLength",void 0),s([h.property(t.isMultilineProperty)],t.prototype,"isMultiline",void 0),s([h.property(t.placeholderProperty)],t.prototype,"placeholder",void 0),s([h.property(t.styleProperty)],t.prototype,"style",void 0),s([h.property(t.inlineActionProperty)],t.prototype,"inlineAction",void 0),s([h.property(t.regexProperty)],t.prototype,"regex",void 0),t}(R);t.TextInput=O;var N=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.valueOn="true",t.valueOff="false",t.wrap=false,t}return n(t,e),t.prototype.updateInputControlAriaLabelledBy=function(){if(this._checkboxInputElement){var e=this.getAllLabelIds().join(" ");this._checkboxInputLabelElement&&this._checkboxInputLabelElement.id&&(e+=" "+this._checkboxInputLabelElement.id),e?this._checkboxInputElement.setAttribute("aria-labelledby",e):this._checkboxInputElement.removeAttribute("aria-labelledby")}},t.prototype.internalRender=function(){var e=this,t=document.createElement("div");if(t.className=this.hostConfig.makeCssClassName("ac-input","ac-toggleInput"),t.style.width="100%",t.style.display="flex",t.style.alignItems="center",this._checkboxInputElement=document.createElement("input"),this._checkboxInputElement.id=c.generateUniqueId(),this._checkboxInputElement.type="checkbox",this._checkboxInputElement.style.display="inline-block",this._checkboxInputElement.style.verticalAlign="middle",this._checkboxInputElement.style.margin="0",this._checkboxInputElement.style.flex="0 0 auto",this.title&&this._checkboxInputElement.setAttribute("aria-label",this.title),this.isRequired&&this._checkboxInputElement.setAttribute("aria-required","true"),this._checkboxInputElement.tabIndex=0,this.defaultValue==this.valueOn&&(this._checkboxInputElement.checked=true),this._checkboxInputElement.onchange=function(){e.valueChanged()},c.appendChild(t,this._checkboxInputElement),this.title||this.isDesignMode()){var i=new y;if(i.setParent(this),i.forElementId=this._checkboxInputElement.id,i.hostConfig=this.hostConfig,i.text=this.title?this.title:this.getJsonTypeName(),i.useMarkdown=a.GlobalSettings.useMarkdownInRadioButtonAndCheckbox,i.wrap=this.wrap,this._checkboxInputLabelElement=i.render(),this._checkboxInputLabelElement){this._checkboxInputLabelElement.id=c.generateUniqueId(),this._checkboxInputLabelElement.style.display="inline-block",this._checkboxInputLabelElement.style.flex="1 1 auto",this._checkboxInputLabelElement.style.marginLeft="6px",this._checkboxInputLabelElement.style.verticalAlign="middle";var r=document.createElement("div");r.style.width="6px",c.appendChild(t,r),c.appendChild(t,this._checkboxInputLabelElement)}}return t},Object.defineProperty(t.prototype,"isNullable",{get:function(){return false},enumerable:false,configurable:true}),t.prototype.getJsonTypeName=function(){return"Input.Toggle"},t.prototype.focus=function(){this._checkboxInputElement&&this._checkboxInputElement.focus()},t.prototype.isSet=function(){return this.isRequired?this.value===this.valueOn:!!this.value},Object.defineProperty(t.prototype,"value",{get:function(){return this._checkboxInputElement?this._checkboxInputElement.checked?this.valueOn:this.valueOff:void 0},enumerable:false,configurable:true}),t.valueProperty=new h.StringProperty(h.Versions.v1_0,"value"),t.titleProperty=new h.StringProperty(h.Versions.v1_0,"title"),t.valueOnProperty=new h.StringProperty(h.Versions.v1_0,"valueOn",true,void 0,"true",(function(e){return"true"})),t.valueOffProperty=new h.StringProperty(h.Versions.v1_0,"valueOff",true,void 0,"false",(function(e){return"false"})),t.wrapProperty=new h.BoolProperty(h.Versions.v1_2,"wrap",false),s([h.property(t.valueProperty)],t.prototype,"defaultValue",void 0),s([h.property(t.titleProperty)],t.prototype,"title",void 0),s([h.property(t.valueOnProperty)],t.prototype,"valueOn",void 0),s([h.property(t.valueOffProperty)],t.prototype,"valueOff",void 0),s([h.property(t.wrapProperty)],t.prototype,"wrap",void 0),t}(R);t.ToggleInput=N;var x=function(e){function t(t,i){var r=e.call(this)||this;return r.title=t,r.value=i,r}return n(t,e),t.prototype.getSchemaKey=function(){return"Choice"},t.titleProperty=new h.StringProperty(h.Versions.v1_0,"title"),t.valueProperty=new h.StringProperty(h.Versions.v1_0,"value"),s([h.property(t.titleProperty)],t.prototype,"title",void 0),s([h.property(t.valueProperty)],t.prototype,"value",void 0),t}(h.SerializableObject);t.Choice=x;var L=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isMultiSelect=false,t.wrap=false,t.choices=[],t}return n(t,e),Object.defineProperty(t.prototype,"isCompact",{get:function(){return!this.style||"compact"===this.style},set:function(e){this.style=e?void 0:"expanded"},enumerable:false,configurable:true}),t.getUniqueCategoryName=function(){var e="__ac-category"+t.uniqueCategoryCounter;return t.uniqueCategoryCounter++,e},t.prototype.internalApplyAriaCurrent=function(){if(this._selectElement){var e=this._selectElement.options;if(e)for(var t=0;t<e.length;t++)e[t].selected?e[t].setAttribute("aria-current","true"):e[t].removeAttribute("aria-current")}},t.prototype.renderCompoundInput=function(e,t,i){var r=this,n=document.createElement("div");n.className=this.hostConfig.makeCssClassName("ac-input",e),n.style.width="100%",this._toggleInputs=[],this._labels=[];for(var s=0,o=this.choices;s<o.length;s++){var l=o[s],d=document.createElement("input");d.id=c.generateUniqueId(),d.type=t,d.style.margin="0",d.style.display="inline-block",d.style.verticalAlign="middle",d.style.flex="0 0 auto",d.name=this.id?this.id:this._uniqueCategoryName,this.isRequired&&d.setAttribute("aria-required","true"),l.value&&(d.value=l.value),l.title&&d.setAttribute("aria-label",l.title),i&&l.value&&i.indexOf(l.value)>=0&&(d.checked=true),d.onchange=function(){r.valueChanged()},this._toggleInputs.push(d);var u=document.createElement("div");u.style.display="flex",u.style.alignItems="center",c.appendChild(u,d);var h=new y;h.setParent(this),h.forElementId=d.id,h.hostConfig=this.hostConfig,h.text=l.title?l.title:"Choice "+this._toggleInputs.length,h.useMarkdown=a.GlobalSettings.useMarkdownInRadioButtonAndCheckbox,h.wrap=this.wrap;var f=h.render();if(this._labels.push(f),f){f.id=c.generateUniqueId(),f.style.display="inline-block",f.style.flex="1 1 auto",f.style.marginLeft="6px",f.style.verticalAlign="middle";var p=document.createElement("div");p.style.width="6px",c.appendChild(u,p),c.appendChild(u,f)}c.appendChild(n,u)}return n},t.prototype.updateInputControlAriaLabelledBy=function(){if((this.isMultiSelect||"expanded"===this.style)&&this._toggleInputs&&this._labels)for(var t=this.getAllLabelIds(),i=0;i<this._toggleInputs.length;i++){var r=t.join(" "),n=this._labels[i];n&&n.id&&(r+=" "+n.id),r?this._toggleInputs[i].setAttribute("aria-labelledby",r):this._toggleInputs[i].removeAttribute("aria-labelledby")}else e.prototype.updateInputControlAriaLabelledBy.call(this)},t.prototype.internalRender=function(){var e=this;if(this._uniqueCategoryName=t.getUniqueCategoryName(),this.isMultiSelect)return this.renderCompoundInput("ac-choiceSetInput-multiSelect","checkbox",this.defaultValue?this.defaultValue.split(this.hostConfig.choiceSetInputValueSeparator):void 0);if("expanded"===this.style)return this.renderCompoundInput("ac-choiceSetInput-expanded","radio",this.defaultValue?[this.defaultValue]:void 0);if("filtered"===this.style){var i=document.createElement("div");i.style.width="100%",this._textInput=document.createElement("input"),this._textInput.className=this.hostConfig.makeCssClassName("ac-input","ac-multichoiceInput","ac-choiceSetInput-filtered"),this._textInput.type="text",this._textInput.style.width="100%",this._textInput.oninput=function(){e.valueChanged(),e._textInput&&(e.value?(e._textInput.removeAttribute("placeholder"),e._textInput.removeAttribute("aria-label")):e.placeholder&&(e._textInput.placeholder=e.placeholder,e._textInput.setAttribute("aria-label",e.placeholder)))},this.defaultValue&&(this._textInput.value=this.defaultValue),this.placeholder&&!this._textInput.value&&(this._textInput.placeholder=this.placeholder,this._textInput.setAttribute("aria-label",this.placeholder));var r=document.createElement("datalist");r.id=c.generateUniqueId();for(var n=0,s=this.choices;n<s.length;n++){var o,a=s[n];(o=document.createElement("option")).value=a.title,o.setAttribute("aria-label",a.title),r.appendChild(o)}return this._textInput.setAttribute("list",r.id),i.append(this._textInput,r),i}this._selectElement=document.createElement("select"),this._selectElement.className=this.hostConfig.makeCssClassName("ac-input","ac-multichoiceInput","ac-choiceSetInput-compact"),this._selectElement.style.width="100%",(o=document.createElement("option")).selected=true,o.disabled=true,o.hidden=true,o.value="",this.placeholder&&(o.text=this.placeholder),c.appendChild(this._selectElement,o);for(var l=0,d=this.choices;l<d.length;l++){a=d[l];var u=document.createElement("option");u.value=a.value,u.text=a.title,u.setAttribute("aria-label",a.title),a.value==this.defaultValue&&(u.selected=true),c.appendChild(this._selectElement,u)}return this._selectElement.onchange=function(){e.internalApplyAriaCurrent(),e.valueChanged()},this.internalApplyAriaCurrent(),this._selectElement},t.prototype.getJsonTypeName=function(){return"Input.ChoiceSet"},t.prototype.focus=function(){this._toggleInputs&&(this.isMultiSelect||"expanded"===this.style)?this._toggleInputs.length>0&&this._toggleInputs[0].focus():this._textInput?this._textInput.focus():e.prototype.focus.call(this)},t.prototype.internalValidateProperties=function(t){e.prototype.internalValidateProperties.call(this,t),0==this.choices.length&&t.addFailure(this,o.ValidationEvent.CollectionCantBeEmpty,p.Strings.errors.choiceSetMustHaveAtLeastOneChoice());for(var i=0,r=this.choices;i<r.length;i++){var n=r[i];n.title&&n.value||t.addFailure(this,o.ValidationEvent.PropertyCantBeNull,p.Strings.errors.choiceSetChoicesMustHaveTitleAndValue())}},t.prototype.isSet=function(){return!!this.value},t.prototype.isValid=function(){if(this._textInput){if(""===this.value||this.value===this.placeholder)return true;for(var t=0,i=this.choices;t<i.length;t++){var r=i[t];if(this.value===r.value)return true}return false}return e.prototype.isValid.call(this)},Object.defineProperty(t.prototype,"value",{get:function(){if(this.isMultiSelect){if(!this._toggleInputs||0==this._toggleInputs.length)return;for(var e="",t=0,i=this._toggleInputs;t<i.length;t++){(c=i[t]).checked&&(""!=e&&(e+=this.hostConfig.choiceSetInputValueSeparator),e+=c.value)}return e||void 0}if(this._selectElement)return this._selectElement.selectedIndex>0?this._selectElement.value:void 0;if(this._textInput){for(var r=0,n=this.choices;r<n.length;r++){var s=n[r];if(s.title&&this._textInput.value===s.title)return s.value}return this._textInput.value}if(this._toggleInputs&&this._toggleInputs.length>0)for(var o=0,a=this._toggleInputs;o<a.length;o++){var c;if((c=a[o]).checked)return c.value}},enumerable:false,configurable:true}),t.valueProperty=new h.StringProperty(h.Versions.v1_0,"value"),t.choicesProperty=new h.SerializableObjectCollectionProperty(h.Versions.v1_0,"choices",x),t.styleProperty=new h.ValueSetProperty(h.Versions.v1_0,"style",[{value:"compact"},{value:"expanded"},{value:"filtered",targetVersion:h.Versions.v1_5}],"compact"),t.isMultiSelectProperty=new h.BoolProperty(h.Versions.v1_0,"isMultiSelect",false),t.placeholderProperty=new h.StringProperty(h.Versions.v1_0,"placeholder"),t.wrapProperty=new h.BoolProperty(h.Versions.v1_2,"wrap",false),t.uniqueCategoryCounter=0,s([h.property(t.valueProperty)],t.prototype,"defaultValue",void 0),s([h.property(t.styleProperty)],t.prototype,"style",void 0),s([h.property(t.isMultiSelectProperty)],t.prototype,"isMultiSelect",void 0),s([h.property(t.placeholderProperty)],t.prototype,"placeholder",void 0),s([h.property(t.wrapProperty)],t.prototype,"wrap",void 0),s([h.property(t.choicesProperty)],t.prototype,"choices",void 0),t}(R);t.ChoiceSetInput=L;var k=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.internalRender=function(){var e=this;return this._numberInputElement=document.createElement("input"),this._numberInputElement.setAttribute("type","number"),void 0!==this.min&&this._numberInputElement.setAttribute("min",this.min.toString()),void 0!==this.max&&this._numberInputElement.setAttribute("max",this.max.toString()),this._numberInputElement.className=this.hostConfig.makeCssClassName("ac-input","ac-numberInput"),this._numberInputElement.style.width="100%",this._numberInputElement.tabIndex=0,void 0!==this.defaultValue&&(this._numberInputElement.valueAsNumber=this.defaultValue),this.placeholder&&(this._numberInputElement.placeholder=this.placeholder,this._numberInputElement.setAttribute("aria-label",this.placeholder)),this._numberInputElement.oninput=function(){e.valueChanged()},this._numberInputElement},t.prototype.getJsonTypeName=function(){return"Input.Number"},t.prototype.isSet=function(){return void 0!==this.value&&!isNaN(this.value)},t.prototype.isValid=function(){if(void 0===this.value)return!this.isRequired;var e=true;return void 0!==this.min&&(e=e&&this.value>=this.min),void 0!==this.max&&(e=e&&this.value<=this.max),e},Object.defineProperty(t.prototype,"value",{get:function(){return this._numberInputElement?this._numberInputElement.valueAsNumber:void 0},enumerable:false,configurable:true}),t.valueProperty=new h.NumProperty(h.Versions.v1_0,"value"),t.placeholderProperty=new h.StringProperty(h.Versions.v1_0,"placeholder"),t.minProperty=new h.NumProperty(h.Versions.v1_0,"min"),t.maxProperty=new h.NumProperty(h.Versions.v1_0,"max"),s([h.property(t.valueProperty)],t.prototype,"defaultValue",void 0),s([h.property(t.minProperty)],t.prototype,"min",void 0),s([h.property(t.maxProperty)],t.prototype,"max",void 0),s([h.property(t.placeholderProperty)],t.prototype,"placeholder",void 0),t}(R);t.NumberInput=k;var F=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.internalRender=function(){var e=this;return this._dateInputElement=document.createElement("input"),this._dateInputElement.setAttribute("type","date"),this.min&&this._dateInputElement.setAttribute("min",this.min),this.max&&this._dateInputElement.setAttribute("max",this.max),this.placeholder&&(this._dateInputElement.placeholder=this.placeholder,this._dateInputElement.setAttribute("aria-label",this.placeholder)),this._dateInputElement.className=this.hostConfig.makeCssClassName("ac-input","ac-dateInput"),this._dateInputElement.style.width="100%",this._dateInputElement.oninput=function(){e.valueChanged()},this.defaultValue&&(this._dateInputElement.value=this.defaultValue),this._dateInputElement},t.prototype.getJsonTypeName=function(){return"Input.Date"},t.prototype.isSet=function(){return!!this.value},t.prototype.isValid=function(){if(!this.value)return!this.isRequired;var e=new Date(this.value),t=true;if(this.min){var i=new Date(this.min);t=t&&e>=i}if(this.max){var r=new Date(this.max);t=t&&e<=r}return t},Object.defineProperty(t.prototype,"value",{get:function(){return this._dateInputElement?this._dateInputElement.value:void 0},enumerable:false,configurable:true}),t.valueProperty=new h.StringProperty(h.Versions.v1_0,"value"),t.placeholderProperty=new h.StringProperty(h.Versions.v1_0,"placeholder"),t.minProperty=new h.StringProperty(h.Versions.v1_0,"min"),t.maxProperty=new h.StringProperty(h.Versions.v1_0,"max"),s([h.property(t.valueProperty)],t.prototype,"defaultValue",void 0),s([h.property(t.minProperty)],t.prototype,"min",void 0),s([h.property(t.maxProperty)],t.prototype,"max",void 0),s([h.property(t.placeholderProperty)],t.prototype,"placeholder",void 0),t}(R);t.DateInput=F;var U=function(e){function t(t,i){var r=e.call(this,t,i,(function(e,t,i,r){var n=i[t.name];if("string"==typeof n&&n&&/^[0-9]{2}:[0-9]{2}$/.test(n))return n}),(function(e,t,i,r,n){n.serializeValue(i,t.name,r)}))||this;return r.targetVersion=t,r.name=i,r}return n(t,e),t}(h.CustomProperty);t.TimeProperty=U;var j=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.convertTimeStringToDate=function(e){return new Date("1973-09-04T"+e+":00Z")},t.prototype.internalRender=function(){var e=this;return this._timeInputElement=document.createElement("input"),this._timeInputElement.setAttribute("type","time"),this._timeInputElement.setAttribute("min",this.min),this._timeInputElement.setAttribute("max",this.max),this._timeInputElement.className=this.hostConfig.makeCssClassName("ac-input","ac-timeInput"),this._timeInputElement.style.width="100%",this._timeInputElement.oninput=function(){e.valueChanged()},this.placeholder&&(this._timeInputElement.placeholder=this.placeholder,this._timeInputElement.setAttribute("aria-label",this.placeholder)),this.defaultValue&&(this._timeInputElement.value=this.defaultValue),this._timeInputElement},t.prototype.getJsonTypeName=function(){return"Input.Time"},t.prototype.isSet=function(){return!!this.value},t.prototype.isValid=function(){if(!this.value)return!this.isRequired;var e=t.convertTimeStringToDate(this.value),i=true;if(this.min){var r=t.convertTimeStringToDate(this.min);i=i&&e>=r}if(this.max){var n=t.convertTimeStringToDate(this.max);i=i&&e<=n}return i},Object.defineProperty(t.prototype,"value",{get:function(){return this._timeInputElement?this._timeInputElement.value:void 0},enumerable:false,configurable:true}),t.valueProperty=new U(h.Versions.v1_0,"value"),t.placeholderProperty=new h.StringProperty(h.Versions.v1_0,"placeholder"),t.minProperty=new U(h.Versions.v1_0,"min"),t.maxProperty=new U(h.Versions.v1_0,"max"),s([h.property(t.valueProperty)],t.prototype,"defaultValue",void 0),s([h.property(t.minProperty)],t.prototype,"min",void 0),s([h.property(t.maxProperty)],t.prototype,"max",void 0),s([h.property(t.placeholderProperty)],t.prototype,"placeholder",void 0),t}(R);t.TimeInput=j;var W=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.style=o.ActionStyle.Default,t.mode=o.ActionMode.Primary,t._state=0,t._isFocusable=true,t}return n(t,e),t.prototype.renderButtonContent=function(){if(this.renderedElement){var e=this.hostConfig,t=document.createElement("div");if(t.style.overflow="hidden",t.style.textOverflow="ellipsis",e.actions.iconPlacement==o.ActionIconPlacement.AboveTitle||e.actions.allowTitleToWrap||(t.style.whiteSpace="nowrap"),this.title&&(t.innerText=this.title),this.iconUrl){var i=document.createElement("img");i.src=this.iconUrl,i.style.width=e.actions.iconSize+"px",i.style.height=e.actions.iconSize+"px",i.style.flex="0 0 auto",e.actions.iconPlacement==o.ActionIconPlacement.AboveTitle?(this.renderedElement.classList.add("iconAbove"),this.renderedElement.style.flexDirection="column",this.title&&(i.style.marginBottom="6px")):(this.renderedElement.classList.add("iconLeft"),i.style.maxHeight="100%",this.title&&(i.style.marginRight="6px")),this.renderedElement.appendChild(i),this.renderedElement.appendChild(t)}else this.renderedElement.classList.add("noIcon"),this.renderedElement.appendChild(t)}},t.prototype.getParentContainer=function(){return this.parent instanceof re?this.parent:this.parent?this.parent.getParentContainer():void 0},t.prototype.updateCssClasses=function(){var e,t;if(this.parent&&this.renderedElement){var i=this.parent.hostConfig;this.renderedElement.className=i.makeCssClassName(this.isEnabled?"ac-pushButton":"ac-pushButton-disabled");var r=this.getParentContainer();if(r){var n=r.getEffectiveStyle();n&&this.renderedElement.classList.add("style-"+n)}switch(this.renderedElement.tabIndex=this.isFocusable?0:-1,this._state){case 1:this.renderedElement.classList.add(i.makeCssClassName("expanded"));break;case 2:this.renderedElement.classList.add(i.makeCssClassName("subdued"))}this.style&&this.isEnabled&&(this.style===o.ActionStyle.Positive?(e=this.renderedElement.classList).add.apply(e,i.makeCssClassNames("primary","style-positive")):(t=this.renderedElement.classList).add.apply(t,i.makeCssClassNames("style-"+this.style.toLowerCase())))}},t.prototype.getDefaultSerializationContext=function(){return new Se},t.prototype.internalGetReferencedInputs=function(){return{}},t.prototype.internalPrepareForExecution=function(e){},t.prototype.internalValidateInputs=function(e){var t=[];if(e)for(var i=0,r=Object.keys(e);i<r.length;i++){var n=e[r[i]];n.validateValue()||t.push(n)}return t},t.prototype.shouldSerialize=function(e){return void 0!==e.actionRegistry.findByName(this.getJsonTypeName())},t.prototype.raiseExecuteActionEvent=function(){var e,t,i;this.onExecute&&this.onExecute(this),t=(e=this).parent?e.parent.getRootElement():void 0,i=t&&t.onExecuteAction?t.onExecuteAction:me.onExecuteAction,e.prepareForExecution()&&i&&i(e)},t.prototype.getHref=function(){return""},t.prototype.getAriaRole=function(){return"button"},t.prototype.setupElementForAccessibility=function(e,t){if(void 0===t&&(t=false),e.tabIndex=this.isEnabled?0:-1,e.setAttribute("role",this.getAriaRole()),e instanceof HTMLButtonElement&&(e.disabled=!this.isEnabled),this.isEnabled?e.classList.add(this.hostConfig.makeCssClassName("ac-selectable")):e.setAttribute("aria-disabled","true"),this.title&&(e.setAttribute("aria-label",this.title),e.title=this.title),this.tooltip){var i=t?this.title?"aria-description":"aria-label":"aria-description";e.setAttribute(i,this.tooltip),e.title=this.tooltip}},t.prototype.parse=function(t,i){return e.prototype.parse.call(this,t,i||new Se)},t.prototype.render=function(){var e=this,t=document.createElement("button");t.type="button",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.onclick=function(t){e.isEnabled&&(t.preventDefault(),t.cancelBubble=true,e.execute())},this._renderedElement=t,this.renderButtonContent(),this.updateCssClasses(),this.setupElementForAccessibility(t)},t.prototype.execute=function(){this._actionCollection&&this._actionCollection.actionExecuted(this),this.raiseExecuteActionEvent()},t.prototype.prepareForExecution=function(){var e=this.getReferencedInputs(),t=this.internalValidateInputs(e);return t.length>0?(t[0].focus(),false):(this.internalPrepareForExecution(e),true)},t.prototype.remove=function(){return!!this._actionCollection&&this._actionCollection.removeAction(this)},t.prototype.getAllInputs=function(e){return[]},t.prototype.getResourceInformation=function(){return this.iconUrl?[{url:this.iconUrl,mimeType:"image"}]:[]},t.prototype.getActionById=function(e){return this.id===e?this:void 0},t.prototype.getReferencedInputs=function(){return this.internalGetReferencedInputs()},t.prototype.validateInputs=function(){return this.internalValidateInputs(this.getReferencedInputs())},Object.defineProperty(t.prototype,"isPrimary",{get:function(){return this.style==o.ActionStyle.Positive},set:function(e){e?this.style=o.ActionStyle.Positive:this.style==o.ActionStyle.Positive&&(this.style=o.ActionStyle.Default)},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"hostConfig",{get:function(){return this.parent?this.parent.hostConfig:l.defaultHostConfig},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(e){this._state!==e&&(this._state=e,this.updateCssClasses())},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"isFocusable",{get:function(){return this._isFocusable},set:function(e){this._isFocusable!==e&&(this._isFocusable=e,this.updateCssClasses())},enumerable:false,configurable:true}),t.titleProperty=new h.StringProperty(h.Versions.v1_0,"title"),t.iconUrlProperty=new h.StringProperty(h.Versions.v1_1,"iconUrl"),t.styleProperty=new h.ValueSetProperty(h.Versions.v1_2,"style",[{value:o.ActionStyle.Default},{value:o.ActionStyle.Positive},{value:o.ActionStyle.Destructive}],o.ActionStyle.Default),t.modeProperty=new h.ValueSetProperty(h.Versions.v1_5,"mode",[{value:o.ActionMode.Primary},{value:o.ActionMode.Secondary}],o.ActionMode.Primary),t.tooltipProperty=new h.StringProperty(h.Versions.v1_5,"tooltip"),t.isEnabledProperty=new h.BoolProperty(h.Versions.v1_5,"isEnabled",true),s([h.property(t.titleProperty)],t.prototype,"title",void 0),s([h.property(t.iconUrlProperty)],t.prototype,"iconUrl",void 0),s([h.property(t.styleProperty)],t.prototype,"style",void 0),s([h.property(t.modeProperty)],t.prototype,"mode",void 0),s([h.property(t.tooltipProperty)],t.prototype,"tooltip",void 0),s([h.property(t.isEnabledProperty)],t.prototype,"isEnabled",void 0),t}(u.CardObject);t.Action=W;var B=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isPrepared=false,t}return n(t,e),t.prototype.internalGetReferencedInputs=function(){var e={};if("none"!==this.associatedInputs){for(var t=this.parent,i=[];t;)i=i.concat(t.getAllInputs(false)),t=t.parent;for(var r=0,n=i;r<n.length;r++){var s=n[r];s.id&&(e[s.id]=s)}}return e},t.prototype.internalPrepareForExecution=function(e){if(this._originalData?this._processedData=JSON.parse(JSON.stringify(this._originalData)):this._processedData={},this._processedData&&e)for(var t=0,i=Object.keys(e);t<i.length;t++){var r=e[i[t]];r.id&&r.isSet()&&(this._processedData[r.id]="string"==typeof r.value?r.value:r.value.toString())}this._isPrepared=true},Object.defineProperty(t.prototype,"data",{get:function(){return this._isPrepared?this._processedData:this._originalData},set:function(e){this._originalData=e,this._isPrepared=false},enumerable:false,configurable:true}),t.dataProperty=new h.PropertyDefinition(h.Versions.v1_0,"data"),t.associatedInputsProperty=new h.CustomProperty(h.Versions.v1_3,"associatedInputs",(function(e,t,i,r){var n=i[t.name];if(void 0!==n&&"string"==typeof n)return"none"===n.toLowerCase()?"none":"auto"}),(function(e,t,i,r,n){n.serializeValue(i,t.name,r)})),s([h.property(t.dataProperty)],t.prototype,"_originalData",void 0),s([h.property(t.associatedInputsProperty)],t.prototype,"associatedInputs",void 0),t}(W);t.SubmitActionBase=B;var H=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getJsonTypeName=function(){return t.JsonTypeName},t.JsonTypeName="Action.Submit",t}(B);t.SubmitAction=H;var V=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getJsonTypeName=function(){return t.JsonTypeName},t.JsonTypeName="Action.Execute",t.verbProperty=new h.StringProperty(h.Versions.v1_4,"verb"),s([h.property(t.verbProperty)],t.prototype,"verb",void 0),t}(B);t.ExecuteAction=V;var Y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getJsonTypeName=function(){return t.JsonTypeName},t.prototype.getAriaRole=function(){return"link"},t.prototype.internalValidateProperties=function(t){e.prototype.internalValidateProperties.call(this,t),this.url||t.addFailure(this,o.ValidationEvent.PropertyCantBeNull,p.Strings.errors.propertyMustBeSet("url"))},t.prototype.getHref=function(){return this.url},t.urlProperty=new h.StringProperty(h.Versions.v1_0,"url"),t.JsonTypeName="Action.OpenUrl",s([h.property(t.urlProperty)],t.prototype,"url",void 0),t}(W);t.OpenUrlAction=Y;var G=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.targetElements={},t}return n(t,e),t.prototype.updateAriaControlsAttribute=function(){if(this.targetElements){var e=Object.keys(this.targetElements);this._renderedElement&&(e.length>0?this._renderedElement.setAttribute("aria-controls",e.join(" ")):this._renderedElement.removeAttribute("aria-controls"))}},t.prototype.internalValidateProperties=function(t){e.prototype.internalValidateProperties.call(this,t),this.targetElements||t.addFailure(this,o.ValidationEvent.PropertyCantBeNull,p.Strings.errors.propertyMustBeSet("targetElements"))},t.prototype.getJsonTypeName=function(){return t.JsonTypeName},t.prototype.render=function(){e.prototype.render.call(this),this.updateAriaControlsAttribute()},t.prototype.execute=function(){if(this.parent)for(var e=0,t=Object.keys(this.targetElements);e<t.length;e++){var i=t[e],r=this.parent.getRootElement().getElementById(i);r&&("boolean"==typeof this.targetElements[i]?r.isVisible=this.targetElements[i]:r.isVisible=!r.isVisible)}},t.prototype.addTargetElement=function(e,t){void 0===t&&(t=void 0),this.targetElements[e]=t,this.updateAriaControlsAttribute()},t.prototype.removeTargetElement=function(e){delete this.targetElements[e],this.updateAriaControlsAttribute()},t.targetElementsProperty=new h.CustomProperty(h.Versions.v1_2,"targetElements",(function(e,t,i,r){var n={};if(Array.isArray(i[t.name]))for(var s=0,o=i[t.name];s<o.length;s++){var a=o[s];if("string"==typeof a)n[a]=void 0;else if("object"==typeof a){var l=a.elementId;"string"==typeof l&&(n[l]=c.parseBool(a.isVisible))}}return n}),(function(e,t,i,r,n){for(var s=[],o=0,a=Object.keys(r);o<a.length;o++){var c=a[o];"boolean"==typeof r[c]?s.push({elementId:c,isVisible:r[c]}):s.push(c)}n.serializeArray(i,t.name,s)}),{},(function(e){return{}})),t.JsonTypeName="Action.ToggleVisibility",s([h.property(t.targetElementsProperty)],t.prototype,"targetElements",void 0),t}(W);t.ToggleVisibilityAction=G;var $=function(e){function t(t,i){var r=e.call(this,t,i,void 0,(function(){return new a.StringWithSubstitutions}))||this;return r.targetVersion=t,r.name=i,r}return n(t,e),t.prototype.parse=function(e,t,i){var r=new a.StringWithSubstitutions;return r.set(c.parseString(t[this.name])),r},t.prototype.toJSON=function(e,t,i,r){r.serializeValue(t,this.name,i.getOriginal())},t}(h.PropertyDefinition),z=function(e){function t(t,i){void 0===t&&(t=""),void 0===i&&(i="");var r=e.call(this)||this;return r.name=t,r.value=i,r}return n(t,e),t.prototype.getSchemaKey=function(){return"HttpHeader"},t.prototype.getReferencedInputs=function(e,t){this._value.getReferencedInputs(e,t)},t.prototype.prepareForExecution=function(e){this._value.substituteInputValues(e,a.ContentTypes.applicationXWwwFormUrlencoded)},Object.defineProperty(t.prototype,"value",{get:function(){return this._value.get()},set:function(e){this._value.set(e)},enumerable:false,configurable:true}),t.nameProperty=new h.StringProperty(h.Versions.v1_0,"name"),t.valueProperty=new $(h.Versions.v1_0,"value"),s([h.property(t.nameProperty)],t.prototype,"name",void 0),s([h.property(t.valueProperty)],t.prototype,"_value",void 0),t}(h.SerializableObject);t.HttpHeader=z;var J=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._ignoreInputValidation=false,t}return n(t,e),t.prototype.internalGetReferencedInputs=function(){var e=this.parent?this.parent.getRootElement().getAllInputs():[],t={};this._url.getReferencedInputs(e,t);for(var i=0,r=this.headers;i<r.length;i++){r[i].getReferencedInputs(e,t)}return this._body.getReferencedInputs(e,t),t},t.prototype.internalPrepareForExecution=function(e){if(e){this._url.substituteInputValues(e,a.ContentTypes.applicationXWwwFormUrlencoded);for(var t=a.ContentTypes.applicationJson,i=0,r=this.headers;i<r.length;i++){var n=r[i];n.prepareForExecution(e),n.name&&"content-type"==n.name.toLowerCase()&&(t=n.value)}this._body.substituteInputValues(e,t)}},t.prototype.getJsonTypeName=function(){return t.JsonTypeName},t.prototype.internalValidateProperties=function(t){if(e.prototype.internalValidateProperties.call(this,t),this.url||t.addFailure(this,o.ValidationEvent.PropertyCantBeNull,p.Strings.errors.propertyMustBeSet("url")),this.headers.length>0)for(var i=0,r=this.headers;i<r.length;i++){r[i].name||t.addFailure(this,o.ValidationEvent.PropertyCantBeNull,p.Strings.errors.actionHttpHeadersMustHaveNameAndValue())}},Object.defineProperty(t.prototype,"ignoreInputValidation",{get:function(){return this._ignoreInputValidation},set:function(e){this._ignoreInputValidation=e},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"url",{get:function(){return this._url.get()},set:function(e){this._url.set(e)},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"body",{get:function(){return this._body.get()},set:function(e){this._body.set(e)},enumerable:false,configurable:true}),t.urlProperty=new $(h.Versions.v1_0,"url"),t.bodyProperty=new $(h.Versions.v1_0,"body"),t.methodProperty=new h.StringProperty(h.Versions.v1_0,"method"),t.headersProperty=new h.SerializableObjectCollectionProperty(h.Versions.v1_0,"headers",z),t.ignoreInputValidationProperty=new h.BoolProperty(h.Versions.v1_3,"ignoreInputValidation",false),t.JsonTypeName="Action.Http",s([h.property(t.urlProperty)],t.prototype,"_url",void 0),s([h.property(t.bodyProperty)],t.prototype,"_body",void 0),s([h.property(t.methodProperty)],t.prototype,"method",void 0),s([h.property(t.headersProperty)],t.prototype,"headers",void 0),s([h.property(t.ignoreInputValidationProperty)],t.prototype,"_ignoreInputValidation",void 0),t}(W);t.HttpAction=J;var q=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.card=new ve,t}return n(t,e),t.prototype.updateCssClasses=function(){if(e.prototype.updateCssClasses.call(this),this.renderedElement){var t=this.parent?this.parent.hostConfig:l.defaultHostConfig;this.renderedElement.classList.add(t.makeCssClassName("expandable")),this.renderedElement.setAttribute("aria-expanded",(1===this.state).toString())}},t.prototype.internalParse=function(t,i){e.prototype.internalParse.call(this,t,i);var r=t.card;r?this.card.parse(r,i):i.logParseEvent(this,o.ValidationEvent.PropertyCantBeNull,p.Strings.errors.showCardMustHaveCard())},t.prototype.internalToJSON=function(t,i){e.prototype.internalToJSON.call(this,t,i),this.card&&i.serializeValue(t,"card",this.card.toJSON(i))},t.prototype.raiseExecuteActionEvent=function(){this.hostConfig.actions.showCard.actionMode===o.ShowCardActionMode.Popup&&e.prototype.raiseExecuteActionEvent.call(this)},t.prototype.getJsonTypeName=function(){return t.JsonTypeName},t.prototype.internalValidateProperties=function(t){e.prototype.internalValidateProperties.call(this,t),this.card.internalValidateProperties(t)},t.prototype.setParent=function(t){e.prototype.setParent.call(this,t),this.card.setParent(t)},t.prototype.getAllInputs=function(e){return void 0===e&&(e=true),this.card.getAllInputs(e)},t.prototype.getResourceInformation=function(){return e.prototype.getResourceInformation.call(this).concat(this.card.getResourceInformation())},t.prototype.getActionById=function(t){var i=e.prototype.getActionById.call(this,t);return i||(i=this.card.getActionById(t)),i},t.JsonTypeName="Action.ShowCard",t}(W);t.ShowCardAction=q;var K=function(e){function t(t){var i=e.call(this)||this;return i.actions=t,i.title=p.Strings.defaults.overflowButtonText(),i}return n(t,e),t.prototype.getActions=function(){return this.actions},t.prototype.getJsonTypeName=function(){return q.JsonTypeName},t.prototype.execute=function(){var e,t,i,r,n,s=this;if((t=this,i=this.renderedElement,r=t.parent?t.parent.getRootElement():void 0,!(void 0!==(n=r&&r.onDisplayOverflowActionMenu?r.onDisplayOverflowActionMenu:me.onDisplayOverflowActionMenu)&&n(t.getActions(),i)))&&this.renderedElement){var o=new g.PopupMenu;o.hostConfig=this.hostConfig;for(var a=function(t){var i=new g.MenuItem(t.toString(),null!==(e=c.actions[t].title)&&void 0!==e?e:"");i.isEnabled=c.actions[t].isEnabled,i.onClick=function(){var e=s.actions[t];o.closePopup(false),e.isEnabled&&e.execute()},o.items.add(i)},c=this,l=0;l<this.actions.length;l++)a(l);o.popup(this.renderedElement)}},t.JsonTypeName="Action.Overflow",t}(W),X=function(){function e(e){this._items=[],this._renderedActions=[],this._owner=e}return e.prototype.isActionAllowed=function(e){var t=this._owner.getForbiddenActionTypes();if(t)for(var i=0,r=t;i<r.length;i++){var n=r[i];if(e.constructor===n)return false}return true},e.prototype.refreshContainer=function(){if(this._actionCardContainer.innerHTML="",this._actionCard){this._actionCardContainer.style.marginTop=this.renderedActionCount>0?this._owner.hostConfig.actions.showCard.inlineTopMargin+"px":"0px";var e=this._owner.getEffectivePadding();this._owner.getImmediateSurroundingPadding(e);var t=this._owner.hostConfig.paddingDefinitionToSpacingDefinition(e);this._actionCard&&(this._actionCard.style.paddingLeft=t.left+"px",this._actionCard.style.paddingRight=t.right+"px",this._actionCard.style.marginLeft="-"+t.left+"px",this._actionCard.style.marginRight="-"+t.right+"px",0==t.bottom||this._owner.isDesignMode()||(this._actionCard.style.paddingBottom=t.bottom+"px",this._actionCard.style.marginBottom="-"+t.bottom+"px"),c.appendChild(this._actionCardContainer,this._actionCard))}else this._actionCardContainer.style.marginTop="0px"},e.prototype.layoutChanged=function(){this._owner.getRootElement().updateLayout()},e.prototype.showActionCard=function(e,t,i){void 0===t&&(t=false),void 0===i&&(i=true),e.card.suppressStyle=t;var r=e.card.renderedElement&&!this._owner.isDesignMode()?e.card.renderedElement:e.card.render();this._actionCard=r,this._expandedAction=e,this.refreshContainer(),i&&(this.layoutChanged(),ce(e,true))},e.prototype.collapseExpandedAction=function(){for(var e=0,t=this._renderedActions;e<t.length;e++){t[e].state=0}var i=this._expandedAction;this._expandedAction=void 0,this._actionCard=void 0,this.refreshContainer(),i&&(this.layoutChanged(),ce(i,false))},e.prototype.expandShowCardAction=function(e,t){for(var i=this,r=false,n=0,s=this._renderedActions;n<s.length;n++){var o=s[n];r&&(o.isFocusable=false),o!==e?o.state=2:(o.state=1,r=true,o.renderedElement&&(o.renderedElement.onblur=function(e){for(var t=0,r=i._renderedActions;t<r.length;t++){r[t].isFocusable=true}}))}this.showActionCard(e,!(this._owner.isAtTheVeryLeft()&&this._owner.isAtTheVeryRight()),t)},e.prototype.actionExecuted=function(e){e instanceof q?e===this._expandedAction?this.collapseExpandedAction():this._owner.hostConfig.actions.showCard.actionMode===o.ShowCardActionMode.Inline&&this.expandShowCardAction(e,true):this.collapseExpandedAction()},e.prototype.parse=function(e,t){if(this.clear(),Array.isArray(e))for(var i=0,r=e;i<r.length;i++){var n=r[i],s=t.parseAction(this._owner,n,[],!this._owner.isDesignMode());s&&this.addAction(s)}},e.prototype.toJSON=function(e,t,i){i.serializeArray(e,t,this._items)},e.prototype.getActionAt=function(e){return this._items[e]},e.prototype.getActionCount=function(){return this._items.length},e.prototype.getActionById=function(e){for(var t=void 0,i=0,r=this._items;i<r.length;i++){if(t=r[i].getActionById(e))break}return t},e.prototype.validateProperties=function(e){this._owner.hostConfig.actions.maxActions&&this._items.length>this._owner.hostConfig.actions.maxActions&&e.addFailure(this._owner,o.ValidationEvent.TooManyActions,p.Strings.errors.tooManyActions(this._owner.hostConfig.actions.maxActions)),this._items.length>0&&!this._owner.hostConfig.supportsInteractivity&&e.addFailure(this._owner,o.ValidationEvent.InteractivityNotAllowed,p.Strings.errors.interactivityNotAllowed());for(var t=0,i=this._items;t<i.length;t++){var r=i[t];this.isActionAllowed(r)||e.addFailure(this._owner,o.ValidationEvent.ActionTypeNotAllowed,p.Strings.errors.actionTypeNotAllowed(r.getJsonTypeName())),r.internalValidateProperties(e)}},e.prototype.render=function(e,t){var i=this._owner.hostConfig;if(i.supportsInteractivity){var r=document.createElement("div"),n=i.actions.maxActions?Math.min(i.actions.maxActions,this._items.length):this._items.length;if(this._actionCardContainer=document.createElement("div"),this._renderedActions=[],i.actions.preExpandSingleShowCardAction&&1==n&&this._items[0]instanceof q&&this.isActionAllowed(this._items[0]))this.showActionCard(this._items[0],true),this._renderedActions.push(this._items[0]);else{var s=document.createElement("div");if(s.className=i.makeCssClassName("ac-actionSet"),s.style.display="flex",s.setAttribute("role","menubar"),e==o.Orientation.Horizontal)if(s.style.flexDirection="row",this._owner.horizontalAlignment&&i.actions.actionAlignment!=o.ActionAlignment.Stretch)switch(this._owner.horizontalAlignment){case o.HorizontalAlignment.Center:s.style.justifyContent="center";break;case o.HorizontalAlignment.Right:s.style.justifyContent="flex-end";break;default:s.style.justifyContent="flex-start"}else switch(i.actions.actionAlignment){case o.ActionAlignment.Center:s.style.justifyContent="center";break;case o.ActionAlignment.Right:s.style.justifyContent="flex-end";break;default:s.style.justifyContent="flex-start"}else if(s.style.flexDirection="column",this._owner.horizontalAlignment&&i.actions.actionAlignment!=o.ActionAlignment.Stretch)switch(this._owner.horizontalAlignment){case o.HorizontalAlignment.Center:s.style.alignItems="center";break;case o.HorizontalAlignment.Right:s.style.alignItems="flex-end";break;default:s.style.alignItems="flex-start"}else switch(i.actions.actionAlignment){case o.ActionAlignment.Center:s.style.alignItems="center";break;case o.ActionAlignment.Right:s.style.alignItems="flex-end";break;case o.ActionAlignment.Stretch:s.style.alignItems="stretch";break;default:s.style.alignItems="flex-start"}var l=this._items.filter(this.isActionAllowed.bind(this)),d=[],u=[];if(this._owner.isDesignMode())d=l;else{l.forEach((function(e){return e.mode===o.ActionMode.Secondary?u.push(e):d.push(e)}));var h=d.splice(i.actions.maxActions);a.GlobalSettings.allowMoreThanMaxActionsInOverflowMenu&&u.push.apply(u,h);var f=true;if(u.length>0){this._overflowAction||(this._overflowAction=new K(u),this._overflowAction.setParent(this._owner),this._overflowAction._actionCollection=this);var p=this._owner instanceof me&&!this._owner.parent;f=!function(e,t){var i=e.parent?e.parent.getRootElement():void 0,r=i&&i.onRenderOverflowActions?i.onRenderOverflowActions:me.onRenderOverflowActions;return void 0!==r&&r(e.getActions(),t)}(this._overflowAction,p)}this._overflowAction&&f&&d.push(this._overflowAction)}for(var g=0;g<d.length;g++){var m=d[g];if(m.render(),m.renderedElement&&(d.length>1&&(m.renderedElement.setAttribute("aria-posinset",(g+1).toString()),m.renderedElement.setAttribute("aria-setsize",d.length.toString()),m.renderedElement.setAttribute("role","menuitem")),i.actions.actionsOrientation==o.Orientation.Horizontal&&i.actions.actionAlignment==o.ActionAlignment.Stretch?m.renderedElement.style.flex="0 1 100%":m.renderedElement.style.flex="0 1 auto",s.appendChild(m.renderedElement),this._renderedActions.push(m),g<d.length-1&&i.actions.buttonSpacing>0)){var v=document.createElement("div");e===o.Orientation.Horizontal?(v.style.flex="0 0 auto",v.style.width=i.actions.buttonSpacing+"px"):v.style.height=i.actions.buttonSpacing+"px",c.appendChild(s,v)}}var S=document.createElement("div");S.style.overflow="hidden",S.appendChild(s),c.appendChild(r,S)}c.appendChild(r,this._actionCardContainer);for(var b=0,y=this._renderedActions;b<y.length;b++){var C=y[b];if(1==C.state){this.expandShowCardAction(C,false);break}}return this._renderedActions.length>0?r:void 0}},e.prototype.addAction=function(e){if(!e)throw new Error("The action parameter cannot be null.");if(e.parent&&e.parent!==this._owner||!(this._items.indexOf(e)<0))throw new Error(p.Strings.errors.actionAlreadyParented());this._items.push(e),e.parent||e.setParent(this._owner),e._actionCollection=this},e.prototype.removeAction=function(e){this.expandedAction&&this._expandedAction==e&&this.collapseExpandedAction();var t=this._items.indexOf(e);if(t>=0){this._items.splice(t,1),e.setParent(void 0),e._actionCollection=void 0;for(var i=0;i<this._renderedActions.length;i++)if(this._renderedActions[i]==e){this._renderedActions.splice(i,1);break}return true}return false},e.prototype.clear=function(){this._items=[],this._renderedActions=[],this._expandedAction=void 0},e.prototype.getAllInputs=function(e){void 0===e&&(e=true);var t=[];if(e)for(var i=0,r=this._items;i<r.length;i++){var n=r[i];t=t.concat(n.getAllInputs())}return t},e.prototype.getResourceInformation=function(){for(var e=[],t=0,i=this._items;t<i.length;t++){var r=i[t];e=e.concat(r.getResourceInformation())}return e},Object.defineProperty(e.prototype,"renderedActionCount",{get:function(){return this._renderedActions.length},enumerable:false,configurable:true}),Object.defineProperty(e.prototype,"expandedAction",{get:function(){return this._expandedAction},enumerable:false,configurable:true}),e}(),Q=function(e){function t(){var t=e.call(this)||this;return t._actionCollection=new X(t),t}return n(t,e),t.prototype.internalParse=function(t,i){e.prototype.internalParse.call(this,t,i),this._actionCollection.parse(t.actions,i)},t.prototype.internalToJSON=function(t,i){e.prototype.internalToJSON.call(this,t,i),this._actionCollection.toJSON(t,"actions",i)},t.prototype.internalRender=function(){return this._actionCollection.render(void 0!==this.orientation?this.orientation:this.hostConfig.actions.actionsOrientation,this.isDesignMode())},t.prototype.isBleedingAtBottom=function(){return 0==this._actionCollection.renderedActionCount?e.prototype.isBleedingAtBottom.call(this):1==this._actionCollection.getActionCount()?void 0!==this._actionCollection.expandedAction&&!this.hostConfig.actions.preExpandSingleShowCardAction:void 0!==this._actionCollection.expandedAction},t.prototype.getJsonTypeName=function(){return"ActionSet"},t.prototype.getActionCount=function(){return this._actionCollection.getActionCount()},t.prototype.getActionAt=function(t){return t>=0&&t<this.getActionCount()?this._actionCollection.getActionAt(t):e.prototype.getActionAt.call(this,t)},t.prototype.getActionById=function(t){var i=this._actionCollection.getActionById(t);return i||e.prototype.getActionById.call(this,t)},t.prototype.internalValidateProperties=function(t){e.prototype.internalValidateProperties.call(this,t),this._actionCollection.validateProperties(t)},t.prototype.addAction=function(e){this._actionCollection.addAction(e)},t.prototype.getAllInputs=function(e){return void 0===e&&(e=true),e?this._actionCollection.getAllInputs():[]},t.prototype.getResourceInformation=function(){return this._actionCollection.getResourceInformation()},t.prototype.findDOMNodeOwner=function(t){for(var i=void 0,r=0;r<this.getActionCount();r++){var n=this.getActionAt(r);if(n&&(i=n.findDOMNodeOwner(t)))return i}return e.prototype.findDOMNodeOwner.call(this,t)},Object.defineProperty(t.prototype,"isInteractive",{get:function(){return true},enumerable:false,configurable:true}),t.orientationProperty=new h.EnumProperty(h.Versions.v1_1,"orientation",o.Orientation),s([h.property(t.orientationProperty)],t.prototype,"orientation",void 0),t}(v);t.ActionSet=Q;var Z=function(e){function t(t,i,r,n){var s=e.call(this,t,i,[{value:o.ContainerStyle.Default},{value:o.ContainerStyle.Emphasis},{targetVersion:h.Versions.v1_2,value:o.ContainerStyle.Accent},{targetVersion:h.Versions.v1_2,value:o.ContainerStyle.Good},{targetVersion:h.Versions.v1_2,value:o.ContainerStyle.Attention},{targetVersion:h.Versions.v1_2,value:o.ContainerStyle.Warning}],r,n)||this;return s.targetVersion=t,s.name=i,s.defaultValue=r,s.onGetInitialValue=n,s}return n(t,e),t}(h.ValueSetProperty);t.ContainerStyleProperty=Z;var ee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),Object.defineProperty(t.prototype,"style",{get:function(){if(this.allowCustomStyle){var e=this.getValue(t.styleProperty);if(e&&this.hostConfig.containerStyles.getStyleByName(e))return e}},set:function(e){this.setValue(t.styleProperty,e)},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"allowCustomStyle",{get:function(){return true},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"hasExplicitStyle",{get:function(){return void 0!==this.getValue(t.styleProperty)},enumerable:false,configurable:true}),t.prototype.applyBorder=function(){},t.prototype.applyBackground=function(){if(this.renderedElement){var e=this.hostConfig.containerStyles.getStyleByName(this.style,this.hostConfig.containerStyles.getStyleByName(this.defaultStyle));if(e.backgroundColor){var t=c.stringToCssColor(e.backgroundColor);this.renderedElement.style.backgroundColor=t}}},t.prototype.applyPadding=function(){if(e.prototype.applyPadding.call(this),this.renderedElement){var t=new a.SpacingDefinition;if(this.getEffectivePadding()&&(t=this.hostConfig.paddingDefinitionToSpacingDefinition(this.getEffectivePadding())),this.renderedElement.style.paddingTop=t.top+"px",this.renderedElement.style.paddingRight=t.right+"px",this.renderedElement.style.paddingBottom=t.bottom+"px",this.renderedElement.style.paddingLeft=t.left+"px",this.isBleeding()){var i=new a.PaddingDefinition;this.getImmediateSurroundingPadding(i);var r=this.hostConfig.paddingDefinitionToSpacingDefinition(i);this.renderedElement.style.marginRight="-"+r.right+"px",this.renderedElement.style.marginLeft="-"+r.left+"px",this.isDesignMode()||(this.renderedElement.style.marginTop="-"+r.top+"px",this.renderedElement.style.marginBottom="-"+r.bottom+"px"),this.separatorElement&&this.separatorOrientation==o.Orientation.Horizontal&&(this.separatorElement.style.marginLeft="-"+r.left+"px",this.separatorElement.style.marginRight="-"+r.right+"px")}else this.renderedElement.style.marginRight="0",this.renderedElement.style.marginLeft="0",this.renderedElement.style.marginTop="0",this.renderedElement.style.marginBottom="0",this.separatorElement&&this.separatorOrientation===o.Orientation.Horizontal&&(this.separatorElement.style.marginRight="0",this.separatorElement.style.marginLeft="0")}},t.prototype.getHasBackground=function(){for(var e=this.parent;e;){var i=e instanceof re&&e.backgroundImage.isValid();if(e instanceof t&&this.hasExplicitStyle&&(e.getEffectiveStyle()!=this.getEffectiveStyle()||i))return true;e=e.parent}return false},t.prototype.getDefaultPadding=function(){return this.getHasBackground()||this.getHasBorder()?new a.PaddingDefinition(o.Spacing.Padding,o.Spacing.Padding,o.Spacing.Padding,o.Spacing.Padding):e.prototype.getDefaultPadding.call(this)},t.prototype.internalValidateProperties=function(i){e.prototype.internalValidateProperties.call(this,i);var r=this.getValue(t.styleProperty);void 0!==r&&(this.hostConfig.containerStyles.getStyleByName(r)||i.addFailure(this,o.ValidationEvent.InvalidPropertyValue,p.Strings.errors.invalidPropertyValue(r,"style")))},t.prototype.render=function(){var t=e.prototype.render.call(this);return t&&this.getHasBackground()&&this.applyBackground(),this.applyBorder(),t},t.prototype.getEffectiveStyle=function(){var t=this.style;return t||e.prototype.getEffectiveStyle.call(this)},t.styleProperty=new Z(h.Versions.v1_0,"style"),s([h.property(t.styleProperty)],t.prototype,"style",null),t}(P);t.StylableCardElementContainer=ee;var te=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._bleed=false,t}return n(t,e),t.prototype.adjustRenderedElementSize=function(t){e.prototype.adjustRenderedElementSize.call(this,t),this.minPixelHeight&&(t.style.minHeight=this.minPixelHeight+"px")},t.prototype.getHasExpandedAction=function(){return false},t.prototype.getBleed=function(){return this._bleed},t.prototype.setBleed=function(e){this._bleed=e},Object.defineProperty(t.prototype,"renderedActionCount",{get:function(){return 0},enumerable:false,configurable:true}),t.prototype.isBleeding=function(){return(this.getHasBackground()||this.hostConfig.alwaysAllowBleed)&&this.getBleed()},t.bleedProperty=new h.BoolProperty(h.Versions.v1_2,"bleed",false),t.minHeightProperty=new h.PixelSizeProperty(h.Versions.v1_2,"minHeight"),s([h.property(t.bleedProperty)],t.prototype,"_bleed",void 0),s([h.property(t.minHeightProperty)],t.prototype,"minPixelHeight",void 0),t}(ee);t.ContainerBase=te;var ie=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getSchemaKey=function(){return"BackgroundImage"},t.prototype.internalParse=function(t,i){if("string"!=typeof t)return e.prototype.internalParse.call(this,t,i);this.resetDefaultValues(),this.url=t},t.prototype.apply=function(e){if(this.url&&e.renderedElement){switch(e.renderedElement.style.backgroundImage="url('"+e.preProcessPropertyValue(t.urlProperty,this.url)+"')",this.fillMode){case o.FillMode.Repeat:e.renderedElement.style.backgroundRepeat="repeat";break;case o.FillMode.RepeatHorizontally:e.renderedElement.style.backgroundRepeat="repeat-x";break;case o.FillMode.RepeatVertically:e.renderedElement.style.backgroundRepeat="repeat-y";break;case o.FillMode.Cover:default:e.renderedElement.style.backgroundRepeat="no-repeat",e.renderedElement.style.backgroundSize="cover"}switch(this.horizontalAlignment){case o.HorizontalAlignment.Center:e.renderedElement.style.backgroundPositionX="center";break;case o.HorizontalAlignment.Right:e.renderedElement.style.backgroundPositionX="right"}switch(this.verticalAlignment){case o.VerticalAlignment.Center:e.renderedElement.style.backgroundPositionY="center";break;case o.VerticalAlignment.Bottom:e.renderedElement.style.backgroundPositionY="bottom"}}},t.prototype.isValid=function(){return!!this.url},t.urlProperty=new h.StringProperty(h.Versions.v1_0,"url"),t.fillModeProperty=new h.EnumProperty(h.Versions.v1_2,"fillMode",o.FillMode,o.FillMode.Cover),t.horizontalAlignmentProperty=new h.EnumProperty(h.Versions.v1_2,"horizontalAlignment",o.HorizontalAlignment,o.HorizontalAlignment.Left),t.verticalAlignmentProperty=new h.EnumProperty(h.Versions.v1_2,"verticalAlignment",o.VerticalAlignment,o.VerticalAlignment.Top),s([h.property(t.urlProperty)],t.prototype,"url",void 0),s([h.property(t.fillModeProperty)],t.prototype,"fillMode",void 0),s([h.property(t.horizontalAlignmentProperty)],t.prototype,"horizontalAlignment",void 0),s([h.property(t.verticalAlignmentProperty)],t.prototype,"verticalAlignment",void 0),t}(h.SerializableObject);t.BackgroundImage=ie;var re=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._items=[],t._renderedItems=[],t}return n(t,e),Object.defineProperty(t.prototype,"backgroundImage",{get:function(){return this.getValue(t.backgroundImageProperty)},enumerable:false,configurable:true}),t.prototype.insertItemAt=function(e,t,i){if(e.parent&&!i)throw new Error(p.Strings.errors.elementAlreadyParented());if(!e.isStandalone)throw new Error(p.Strings.errors.elementTypeNotStandalone(e.getJsonTypeName()));t<0||t>=this._items.length?this._items.push(e):this._items.splice(t,0,e),e.setParent(this)},t.prototype.getItemsCollectionPropertyName=function(){return"items"},t.prototype.applyBackground=function(){this.backgroundImage.isValid()&&this.renderedElement&&this.backgroundImage.apply(this),e.prototype.applyBackground.call(this)},t.prototype.internalRender=function(){this._renderedItems=[];var e=this.hostConfig,t=document.createElement("div");switch(void 0!==this.rtl&&(t.dir=this.rtl?"rtl":"ltr"),t.classList.add(e.makeCssClassName("ac-container")),t.style.display="flex",t.style.flexDirection="column",a.GlobalSettings.useAdvancedCardBottomTruncation&&(t.style.minHeight="-webkit-min-content"),this.getEffectiveVerticalContentAlignment()){case o.VerticalAlignment.Center:t.style.justifyContent="center";break;case o.VerticalAlignment.Bottom:t.style.justifyContent="flex-end";break;default:t.style.justifyContent="flex-start"}if(this._items.length>0)for(var i=0,r=this._items;i<r.length;i++){var n=r[i],s=this.isElementAllowed(n)?n.render():void 0;s&&(this._renderedItems.length>0&&n.separatorElement&&(n.separatorElement.style.flex="0 0 auto",c.appendChild(t,n.separatorElement)),c.appendChild(t,s),this._renderedItems.push(n))}else if(this.isDesignMode()){var l=this.createPlaceholderElement();l.style.width="100%",l.style.height="100%",t.appendChild(l)}return t},t.prototype.truncateOverflow=function(e){if(this.renderedElement){for(var t=this.renderedElement.offsetTop+e+1,i=function(e){var r=e.renderedElement;if(r)switch(c.getFitStatus(r,t)){case o.ContainerFitStatus.FullyInContainer:e.resetOverflow()&&i(e);break;case o.ContainerFitStatus.Overflowing:var n=t-r.offsetTop;e.handleOverflow(n);break;case o.ContainerFitStatus.FullyOutOfContainer:e.handleOverflow(0)}},r=0,n=this._items;r<n.length;r++){var s=n[r];i(s)}return true}return false},t.prototype.undoOverflowTruncation=function(){for(var e=0,t=this._items;e<t.length;e++){t[e].resetOverflow()}},t.prototype.getHasBackground=function(){return this.backgroundImage.isValid()||e.prototype.getHasBackground.call(this)},t.prototype.internalParse=function(t,i){e.prototype.internalParse.call(this,t,i),this.clear(),this.setShouldFallback(false);var r=t[this.getItemsCollectionPropertyName()];if(Array.isArray(r))for(var n=0,s=r;n<s.length;n++){var o=s[n],a=i.parseElement(this,o,!this.isDesignMode());a&&this.insertItemAt(a,-1,true)}},t.prototype.internalToJSON=function(t,i){e.prototype.internalToJSON.call(this,t,i),i.serializeArray(t,this.getItemsCollectionPropertyName(),this._items)},Object.defineProperty(t.prototype,"isSelectable",{get:function(){return true},enumerable:false,configurable:true}),t.prototype.getEffectiveVerticalContentAlignment=function(){if(void 0!==this.verticalContentAlignment)return this.verticalContentAlignment;var e=this.getParentContainer();return e?e.getEffectiveVerticalContentAlignment():o.VerticalAlignment.Top},t.prototype.getItemCount=function(){return this._items.length},t.prototype.getItemAt=function(e){return this._items[e]},t.prototype.getFirstVisibleRenderedItem=function(){if(this.renderedElement&&this._renderedItems&&this._renderedItems.length>0)for(var e=0,t=this._renderedItems;e<t.length;e++){var i=t[e];if(i.isVisible)return i}},t.prototype.getLastVisibleRenderedItem=function(){if(this.renderedElement&&this._renderedItems&&this._renderedItems.length>0){for(var e=this._renderedItems.length-1;e>=0;e--)if(this._renderedItems[e].isVisible)return this._renderedItems[e]}},t.prototype.getJsonTypeName=function(){return"Container"},t.prototype.isFirstElement=function(e){for(var t=this.isDesignMode(),i=0,r=this._items;i<r.length;i++){var n=r[i];if(n.isVisible||t)return n==e}return false},t.prototype.isLastElement=function(e){for(var t=this.isDesignMode(),i=this._items.length-1;i>=0;i--)if(this._items[i].isVisible||t)return this._items[i]==e;return false},t.prototype.isRtl=function(){if(void 0!==this.rtl)return this.rtl;var e=this.getParentContainer();return!!e&&e.isRtl()},t.prototype.isBleedingAtTop=function(){var e=this.getFirstVisibleRenderedItem();return this.isBleeding()||!!e&&e.isBleedingAtTop()},t.prototype.isBleedingAtBottom=function(){var e=this.getLastVisibleRenderedItem();return this.isBleeding()||!!e&&(e.isBleedingAtBottom()&&e.getEffectiveStyle()==this.getEffectiveStyle())},t.prototype.indexOf=function(e){return this._items.indexOf(e)},t.prototype.addItem=function(e){this.insertItemAt(e,-1,false)},t.prototype.insertItemBefore=function(e,t){this.insertItemAt(e,this._items.indexOf(t),false)},t.prototype.insertItemAfter=function(e,t){this.insertItemAt(e,this._items.indexOf(t)+1,false)},t.prototype.removeItem=function(e){var t=this._items.indexOf(e);return t>=0&&(this._items.splice(t,1),e.setParent(void 0),this.updateLayout(),true)},t.prototype.clear=function(){this._items=[],this._renderedItems=[]},t.prototype.getResourceInformation=function(){var t=e.prototype.getResourceInformation.call(this);return this.backgroundImage.isValid()&&t.push({url:this.backgroundImage.url,mimeType:"image"}),t},t.prototype.getActionById=function(t){var i=e.prototype.getActionById.call(this,t);if(!i&&(this.selectAction&&(i=this.selectAction.getActionById(t)),!i))for(var r=0,n=this._items;r<n.length;r++){if(i=n[r].getActionById(t))break}return i},Object.defineProperty(t.prototype,"padding",{get:function(){return this.getPadding()},set:function(e){this.setPadding(e)},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"selectAction",{get:function(){return this._selectAction},set:function(e){this._selectAction=e},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"bleed",{get:function(){return this.getBleed()},set:function(e){this.setBleed(e)},enumerable:false,configurable:true}),t.backgroundImageProperty=new h.SerializableObjectProperty(h.Versions.v1_0,"backgroundImage",ie),t.verticalContentAlignmentProperty=new h.EnumProperty(h.Versions.v1_1,"verticalContentAlignment",o.VerticalAlignment),t.rtlProperty=new h.BoolProperty(h.Versions.v1_0,"rtl"),s([h.property(t.backgroundImageProperty)],t.prototype,"backgroundImage",null),s([h.property(t.verticalContentAlignmentProperty)],t.prototype,"verticalContentAlignment",void 0),s([h.property(t.rtlProperty)],t.prototype,"rtl",void 0),t}(te);t.Container=re;var ne=function(e){function t(t){void 0===t&&(t="stretch");var i=e.call(this)||this;return i.width="stretch",i._computedWeight=0,i.width=t,i}return n(t,e),t.prototype.adjustRenderedElementSize=function(e){this.isDesignMode()?(e.style.minWidth="20px",e.style.minHeight=(this.minPixelHeight?Math.max(this.minPixelHeight,20):20)+"px"):(e.style.minWidth="0",this.minPixelHeight&&(e.style.minHeight=this.minPixelHeight+"px")),"auto"===this.width?e.style.flex="0 1 auto":"stretch"===this.width?e.style.flex="1 1 50px":this.width instanceof a.SizeAndUnit&&(this.width.unit==o.SizeUnit.Pixel?(e.style.flex="0 0 auto",e.style.width=this.width.physicalSize+"px"):e.style.flex="1 1 "+(this._computedWeight>0?this._computedWeight:this.width.physicalSize)+"%")},t.prototype.shouldSerialize=function(e){return true},Object.defineProperty(t.prototype,"separatorOrientation",{get:function(){return o.Orientation.Vertical},enumerable:false,configurable:true}),t.prototype.getJsonTypeName=function(){return"Column"},Object.defineProperty(t.prototype,"hasVisibleSeparator",{get:function(){return!!(this.parent&&this.parent instanceof se)&&(void 0!==this.separatorElement&&!this.parent.isLeftMostElement(this))},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"isStandalone",{get:function(){return false},enumerable:false,configurable:true}),t.widthProperty=new h.CustomProperty(h.Versions.v1_0,"width",(function(e,t,i,r){var n=t.defaultValue,s=i[t.name],c=false;if("number"!=typeof s||isNaN(s))if("auto"===s||"stretch"===s)n=s;else if("string"==typeof s)try{(n=a.SizeAndUnit.parse(s)).unit===o.SizeUnit.Pixel&&t.targetVersion.compareTo(r.targetVersion)>0&&(c=true)}catch(l){c=true}else c=true;else n=new a.SizeAndUnit(s,o.SizeUnit.Weight);return c&&(r.logParseEvent(e,o.ValidationEvent.InvalidPropertyValue,p.Strings.errors.invalidColumnWidth(s)),n="auto"),n}),(function(e,t,i,r,n){r instanceof a.SizeAndUnit?r.unit===o.SizeUnit.Pixel?n.serializeValue(i,"width",r.physicalSize+"px"):n.serializeNumber(i,"width",r.physicalSize):n.serializeValue(i,"width",r)}),"stretch"),s([h.property(t.widthProperty)],t.prototype,"width",void 0),t}(re);t.Column=ne;var se=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._columns=[],t}return n(t,e),t.prototype.createColumnInstance=function(e,t){return t.parseCardObject(this,e,[],!this.isDesignMode(),(function(e){return e&&"Column"!==e?void 0:new ne}),(function(e,i){t.logParseEvent(void 0,o.ValidationEvent.ElementTypeNotAllowed,p.Strings.errors.elementTypeNotAllowed(e))}))},t.prototype.internalRender=function(){if(this._renderedColumns=[],this._columns.length>0){var e=this.hostConfig,t=document.createElement("div");switch(t.className=e.makeCssClassName("ac-columnSet"),t.style.display="flex",a.GlobalSettings.useAdvancedCardBottomTruncation&&(t.style.minHeight="-webkit-min-content"),this.getEffectiveHorizontalAlignment()){case o.HorizontalAlignment.Center:t.style.justifyContent="center";break;case o.HorizontalAlignment.Right:t.style.justifyContent="flex-end";break;default:t.style.justifyContent="flex-start"}for(var i=0,r=0,n=this._columns;r<n.length;r++){(d=n[r]).width instanceof a.SizeAndUnit&&d.width.unit==o.SizeUnit.Weight&&(i+=d.width.physicalSize)}for(var s=0,l=this._columns;s<l.length;s++){var d;if((d=l[s]).width instanceof a.SizeAndUnit&&d.width.unit==o.SizeUnit.Weight&&i>0){var u=100/i*d.width.physicalSize;d._computedWeight=u}var h=d.render();h&&(this._renderedColumns.length>0&&d.separatorElement&&(d.separatorElement.style.flex="0 0 auto",c.appendChild(t,d.separatorElement)),c.appendChild(t,h),this._renderedColumns.push(d))}return this._renderedColumns.length>0?t:void 0}},t.prototype.truncateOverflow=function(e){for(var t=0,i=this._columns;t<i.length;t++){i[t].handleOverflow(e)}return true},t.prototype.undoOverflowTruncation=function(){for(var e=0,t=this._columns;e<t.length;e++){t[e].resetOverflow()}},Object.defineProperty(t.prototype,"isSelectable",{get:function(){return true},enumerable:false,configurable:true}),t.prototype.internalParse=function(t,i){e.prototype.internalParse.call(this,t,i),this._columns=[],this._renderedColumns=[];var r=t.columns;if(Array.isArray(r))for(var n=0,s=r;n<s.length;n++){var o=s[n],a=this.createColumnInstance(o,i);a&&this._columns.push(a)}},t.prototype.internalToJSON=function(t,i){e.prototype.internalToJSON.call(this,t,i),i.serializeArray(t,"columns",this._columns)},t.prototype.isFirstElement=function(e){for(var t=0,i=this._columns;t<i.length;t++){var r=i[t];if(r.isVisible)return r==e}return false},t.prototype.isBleedingAtTop=function(){if(this.isBleeding())return true;if(this._renderedColumns&&this._renderedColumns.length>0)for(var e=0,t=this._columns;e<t.length;e++){if(t[e].isBleedingAtTop())return true}return false},t.prototype.isBleedingAtBottom=function(){if(this.isBleeding())return true;if(this._renderedColumns&&this._renderedColumns.length>0)for(var e=0,t=this._columns;e<t.length;e++){if(t[e].isBleedingAtBottom())return true}return false},t.prototype.getItemCount=function(){return this._columns.length},t.prototype.getFirstVisibleRenderedItem=function(){return this.renderedElement&&this._renderedColumns&&this._renderedColumns.length>0?this._renderedColumns[0]:void 0},t.prototype.getLastVisibleRenderedItem=function(){return this.renderedElement&&this._renderedColumns&&this._renderedColumns.length>0?this._renderedColumns[this._renderedColumns.length-1]:void 0},t.prototype.getColumnAt=function(e){return this._columns[e]},t.prototype.getItemAt=function(e){return this.getColumnAt(e)},t.prototype.getJsonTypeName=function(){return"ColumnSet"},t.prototype.internalValidateProperties=function(t){e.prototype.internalValidateProperties.call(this,t);for(var i=0,r=0,n=0,s=this._columns;n<s.length;n++){var a=s[n];"number"==typeof a.width?i++:"stretch"===a.width&&r++}i>0&&r>0&&t.addFailure(this,o.ValidationEvent.Hint,p.Strings.hints.dontUseWeightedAndStrecthedColumnsInSameSet())},t.prototype.addColumn=function(e){if(e.parent)throw new Error(p.Strings.errors.columnAlreadyBelongsToAnotherSet());this._columns.push(e),e.setParent(this)},t.prototype.removeItem=function(e){if(e instanceof ne){var t=this._columns.indexOf(e);if(t>=0)return this._columns.splice(t,1),e.setParent(void 0),this.updateLayout(),true}return false},t.prototype.indexOf=function(e){return e instanceof ne?this._columns.indexOf(e):-1},t.prototype.isLeftMostElement=function(e){return 0==this._columns.indexOf(e)},t.prototype.isRightMostElement=function(e){return this._columns.indexOf(e)==this._columns.length-1},t.prototype.isTopElement=function(e){return this._columns.indexOf(e)>=0},t.prototype.isBottomElement=function(e){return this._columns.indexOf(e)>=0},t.prototype.getActionById=function(e){for(var t=void 0,i=0,r=this._columns;i<r.length;i++){if(t=r[i].getActionById(e))break}return t},Object.defineProperty(t.prototype,"bleed",{get:function(){return this.getBleed()},set:function(e){this.setBleed(e)},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"padding",{get:function(){return this.getPadding()},set:function(e){this.setPadding(e)},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"selectAction",{get:function(){return this._selectAction},set:function(e){this._selectAction=e},enumerable:false,configurable:true}),t}(te);function oe(e){var t=e.getRootElement(),i=t&&t.onImageLoaded?t.onImageLoaded:me.onImageLoaded;i&&i(e)}function ae(e,t,i){var r=e.getRootElement(),n=r&&r.onAnchorClicked?r.onAnchorClicked:me.onAnchorClicked;return void 0!==n&&n(e,t,i)}function ce(e,t){var i=e.parent?e.parent.getRootElement():void 0,r=i&&i.onInlineCardExpanded?i.onInlineCardExpanded:me.onInlineCardExpanded;r&&r(e,t)}function le(e,t){void 0===t&&(t=true);var i=e.getRootElement();t&&i.updateLayout();var r=i,n=r&&r.onElementVisibilityChanged?r.onElementVisibilityChanged:me.onElementVisibilityChanged;void 0!==n&&n(e)}t.ColumnSet=se;var de=function(e){function t(){var t=e.call(this)||this;return t._actionCollection=new X(t),t}return n(t,e),t.prototype.internalParse=function(t,i){e.prototype.internalParse.call(this,t,i),this._actionCollection.parse(t.actions,i)},t.prototype.internalToJSON=function(t,i){e.prototype.internalToJSON.call(this,t,i),this._actionCollection.toJSON(t,"actions",i)},t.prototype.internalRender=function(){var t=e.prototype.internalRender.call(this);if(t){var i=this._actionCollection.render(this.hostConfig.actions.actionsOrientation,false);return i&&(c.appendChild(t,m(this.hostConfig,{spacing:this.hostConfig.getEffectiveSpacing(this.hostConfig.actions.spacing)},o.Orientation.Horizontal)),c.appendChild(t,i)),this.renderIfEmpty||t.children.length>0?t:void 0}},t.prototype.getHasExpandedAction=function(){return 0!=this.renderedActionCount&&(1==this.renderedActionCount?void 0!==this._actionCollection.expandedAction&&!this.hostConfig.actions.preExpandSingleShowCardAction:void 0!==this._actionCollection.expandedAction)},Object.defineProperty(t.prototype,"renderedActionCount",{get:function(){return this._actionCollection.renderedActionCount},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"renderIfEmpty",{get:function(){return false},enumerable:false,configurable:true}),t.prototype.getActionCount=function(){return this._actionCollection.getActionCount()},t.prototype.getActionAt=function(t){return t>=0&&t<this.getActionCount()?this._actionCollection.getActionAt(t):e.prototype.getActionAt.call(this,t)},t.prototype.getActionById=function(t){var i=this._actionCollection.getActionById(t);return i||e.prototype.getActionById.call(this,t)},t.prototype.internalValidateProperties=function(t){e.prototype.internalValidateProperties.call(this,t),this._actionCollection&&this._actionCollection.validateProperties(t)},t.prototype.isLastElement=function(t){return e.prototype.isLastElement.call(this,t)&&0==this._actionCollection.getActionCount()},t.prototype.addAction=function(e){this._actionCollection.addAction(e)},t.prototype.clear=function(){e.prototype.clear.call(this),this._actionCollection.clear()},t.prototype.getAllInputs=function(t){void 0===t&&(t=true);var i=e.prototype.getAllInputs.call(this,t);return t&&(i=i.concat(this._actionCollection.getAllInputs(t))),i},t.prototype.getResourceInformation=function(){return e.prototype.getResourceInformation.call(this).concat(this._actionCollection.getResourceInformation())},t.prototype.isBleedingAtBottom=function(){return 0==this._actionCollection.renderedActionCount?e.prototype.isBleedingAtBottom.call(this):1==this._actionCollection.getActionCount()?void 0!==this._actionCollection.expandedAction&&!this.hostConfig.actions.preExpandSingleShowCardAction:void 0!==this._actionCollection.expandedAction},Object.defineProperty(t.prototype,"isStandalone",{get:function(){return false},enumerable:false,configurable:true}),t}(re);t.ContainerWithActions=de;var ue=function(e){function t(t,i){var r=e.call(this,t,i,void 0)||this;return r.targetVersion=t,r.name=i,r}return n(t,e),t.prototype.parse=function(e,t,i){var r=i.parseAction(e.parent,t[this.name],[],false);if(void 0!==r){if(r instanceof V)return r;i.logParseEvent(e,o.ValidationEvent.ActionTypeNotAllowed,p.Strings.errors.actionTypeNotAllowed(r.getJsonTypeName()))}i.logParseEvent(e,o.ValidationEvent.PropertyCantBeNull,p.Strings.errors.propertyMustBeSet("action"))},t.prototype.toJSON=function(e,t,i,r){r.serializeValue(t,this.name,i?i.toJSON(r):void 0,void 0,true)},t}(h.PropertyDefinition);t.RefreshActionProperty=ue;var he=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),Object.defineProperty(t.prototype,"action",{get:function(){return this.getValue(t.actionProperty)},set:function(e){this.setValue(t.actionProperty,e),e&&e.setParent(this.parent)},enumerable:false,configurable:true}),t.prototype.getSchemaKey=function(){return"RefreshDefinition"},t.actionProperty=new ue(h.Versions.v1_4,"action"),t.userIdsProperty=new h.StringArrayProperty(h.Versions.v1_4,"userIds"),s([h.property(t.actionProperty)],t.prototype,"action",null),s([h.property(t.userIdsProperty)],t.prototype,"userIds",void 0),t}(h.SerializableObject);t.RefreshDefinition=he;var fe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getSchemaKey=function(){return"AuthCardButton"},t.typeProperty=new h.StringProperty(h.Versions.v1_4,"type"),t.titleProperty=new h.StringProperty(h.Versions.v1_4,"title"),t.imageProperty=new h.StringProperty(h.Versions.v1_4,"image"),t.valueProperty=new h.StringProperty(h.Versions.v1_4,"value"),s([h.property(t.typeProperty)],t.prototype,"type",void 0),s([h.property(t.titleProperty)],t.prototype,"title",void 0),s([h.property(t.imageProperty)],t.prototype,"image",void 0),s([h.property(t.valueProperty)],t.prototype,"value",void 0),t}(h.SerializableObject);t.AuthCardButton=fe;var pe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getSchemaKey=function(){return"TokenExchangeResource"},t.idProperty=new h.StringProperty(h.Versions.v1_4,"id"),t.uriProperty=new h.StringProperty(h.Versions.v1_4,"uri"),t.providerIdProperty=new h.StringProperty(h.Versions.v1_4,"providerId"),s([h.property(t.idProperty)],t.prototype,"id",void 0),s([h.property(t.uriProperty)],t.prototype,"uri",void 0),s([h.property(t.providerIdProperty)],t.prototype,"providerId",void 0),t}(h.SerializableObject);t.TokenExchangeResource=pe;var ge=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getSchemaKey=function(){return"Authentication"},t.textProperty=new h.StringProperty(h.Versions.v1_4,"text"),t.connectionNameProperty=new h.StringProperty(h.Versions.v1_4,"connectionName"),t.buttonsProperty=new h.SerializableObjectCollectionProperty(h.Versions.v1_4,"buttons",fe),t.tokenExchangeResourceProperty=new h.SerializableObjectProperty(h.Versions.v1_4,"tokenExchangeResource",pe,true),s([h.property(t.textProperty)],t.prototype,"text",void 0),s([h.property(t.connectionNameProperty)],t.prototype,"connectionName",void 0),s([h.property(t.buttonsProperty)],t.prototype,"buttons",void 0),s([h.property(t.tokenExchangeResourceProperty)],t.prototype,"tokenExchangeResource",void 0),t}(h.SerializableObject);t.Authentication=ge;var me=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.designMode=false,t}return n(t,e),Object.defineProperty(t.prototype,"refresh",{get:function(){return this.getValue(t.refreshProperty)},set:function(e){this.setValue(t.refreshProperty,e),e&&(e.parent=this)},enumerable:false,configurable:true}),Object.defineProperty(t,"processMarkdown",{get:function(){throw new Error(p.Strings.errors.processMarkdownEventRemoved())},set:function(e){throw new Error(p.Strings.errors.processMarkdownEventRemoved())},enumerable:false,configurable:true}),t.applyMarkdown=function(e){var i={didProcess:false};if(t.onProcessMarkdown)t.onProcessMarkdown(e,i);else if(window.markdownit){var r=window.markdownit;i.outputHtml=r().render(e),i.didProcess=true}else console.warn(p.Strings.errors.markdownProcessingNotEnabled);return i},t.prototype.isVersionSupported=function(){return!!this.bypassVersionCheck||!(!this.version||!this.version.isValid||this.maxVersion.major<this.version.major||this.maxVersion.major==this.version.major&&this.maxVersion.minor<this.version.minor)},t.prototype.getDefaultSerializationContext=function(){return new Se(this.version)},t.prototype.getItemsCollectionPropertyName=function(){return"body"},t.prototype.internalParse=function(i,r){this._fallbackCard=void 0;var n=r.parseElement(void 0,i.fallback,!this.isDesignMode());n&&(this._fallbackCard=new t,this._fallbackCard.addItem(n)),e.prototype.internalParse.call(this,i,r)},t.prototype.internalToJSON=function(i,r){this.setValue(t.versionProperty,r.targetVersion),e.prototype.internalToJSON.call(this,i,r)},t.prototype.internalRender=function(){var t=e.prototype.internalRender.call(this);return a.GlobalSettings.useAdvancedCardBottomTruncation&&t&&t.style.removeProperty("minHeight"),t},t.prototype.getHasBackground=function(){return true},t.prototype.getDefaultPadding=function(){return new a.PaddingDefinition(o.Spacing.Padding,o.Spacing.Padding,o.Spacing.Padding,o.Spacing.Padding)},t.prototype.shouldSerialize=function(e){return true},Object.defineProperty(t.prototype,"renderIfEmpty",{get:function(){return true},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"bypassVersionCheck",{get:function(){return false},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"allowCustomStyle",{get:function(){return this.hostConfig.adaptiveCard&&this.hostConfig.adaptiveCard.allowCustomStyle},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"hasBackground",{get:function(){return true},enumerable:false,configurable:true}),t.prototype.getJsonTypeName=function(){return"AdaptiveCard"},t.prototype.internalValidateProperties=function(t){e.prototype.internalValidateProperties.call(this,t),"AdaptiveCard"!==this.getValue(v.typeNameProperty)&&t.addFailure(this,o.ValidationEvent.MissingCardType,p.Strings.errors.invalidCardType()),this.bypassVersionCheck||this.version?this.isVersionSupported()||t.addFailure(this,o.ValidationEvent.UnsupportedCardVersion,p.Strings.errors.unsupportedCardVersion(this.version.toString(),this.maxVersion.toString())):t.addFailure(this,o.ValidationEvent.PropertyCantBeNull,p.Strings.errors.propertyMustBeSet("version"))},t.prototype.render=function(t){var i;return this.shouldFallback()&&this._fallbackCard?(this._fallbackCard.hostConfig=this.hostConfig,i=this._fallbackCard.render()):(i=e.prototype.render.call(this))&&(i.classList.add(this.hostConfig.makeCssClassName("ac-adaptiveCard")),a.GlobalSettings.setTabIndexAtCardRoot&&(i.tabIndex=0),this.speak&&i.setAttribute("aria-label",this.speak)),t&&(c.appendChild(t,i),this.updateLayout()),i},t.prototype.updateLayout=function(t){if(void 0===t&&(t=true),e.prototype.updateLayout.call(this,t),a.GlobalSettings.useAdvancedCardBottomTruncation&&this.isDisplayed()){var i=this.hostConfig.getEffectiveSpacing(o.Spacing.Default);this.handleOverflow(this.renderedElement.offsetHeight-i)}},t.prototype.shouldFallback=function(){return e.prototype.shouldFallback.call(this)||!this.isVersionSupported()},Object.defineProperty(t.prototype,"hasVisibleSeparator",{get:function(){return false},enumerable:false,configurable:true}),t.schemaUrl="http://adaptivecards.io/schemas/adaptive-card.json",t.$schemaProperty=new h.CustomProperty(h.Versions.v1_0,"$schema",(function(e,i,r,n){return t.schemaUrl}),(function(e,i,r,n,s){s.serializeValue(r,i.name,t.schemaUrl)})),t.versionProperty=new h.CustomProperty(h.Versions.v1_0,"version",(function(e,t,i,r){var n=h.Version.parse(i[t.name],r);return void 0===n&&(n=h.Versions.latest,r.logParseEvent(e,o.ValidationEvent.InvalidPropertyValue,p.Strings.errors.invalidCardVersion(n.toString()))),n}),(function(e,t,i,r,n){void 0!==r&&n.serializeValue(i,t.name,r.toString())}),h.Versions.v1_0),t.fallbackTextProperty=new h.StringProperty(h.Versions.v1_0,"fallbackText"),t.speakProperty=new h.StringProperty(h.Versions.v1_0,"speak"),t.refreshProperty=new h.SerializableObjectProperty(h.Versions.v1_4,"refresh",he,true),t.authenticationProperty=new h.SerializableObjectProperty(h.Versions.v1_4,"authentication",ge,true),s([h.property(t.versionProperty)],t.prototype,"version",void 0),s([h.property(t.fallbackTextProperty)],t.prototype,"fallbackText",void 0),s([h.property(t.speakProperty)],t.prototype,"speak",void 0),s([h.property(t.refreshProperty)],t.prototype,"refresh",null),s([h.property(t.authenticationProperty)],t.prototype,"authentication",void 0),t}(de);t.AdaptiveCard=me;var ve=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.suppressStyle=false,t}return n(t,e),t.prototype.getSchemaKey=function(){return"InlineAdaptiveCard"},t.prototype.populateSchema=function(t){e.prototype.populateSchema.call(this,t),t.remove(me.$schemaProperty,me.versionProperty)},t.prototype.getDefaultPadding=function(){return new a.PaddingDefinition(this.suppressStyle?o.Spacing.None:o.Spacing.Padding,o.Spacing.Padding,this.suppressStyle?o.Spacing.None:o.Spacing.Padding,o.Spacing.Padding)},Object.defineProperty(t.prototype,"bypassVersionCheck",{get:function(){return true},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"defaultStyle",{get:function(){return this.suppressStyle?o.ContainerStyle.Default:this.hostConfig.actions.showCard.style?this.hostConfig.actions.showCard.style:o.ContainerStyle.Emphasis},enumerable:false,configurable:true}),t.prototype.render=function(t){var i=e.prototype.render.call(this,t);return i&&(i.setAttribute("aria-live","polite"),i.removeAttribute("tabindex")),i},t}(me),Se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.internalParseCardObject=function(e,t,i,r,n,s){var l=void 0;if(t&&"object"==typeof t){var d=c.parseString(t.type);if(d&&i.indexOf(d)>=0)s(d,o.TypeErrorType.ForbiddenType);else{var u=false;if((l=n(d))?(l.setParent(e),l.parse(t,this),u=a.GlobalSettings.enableFallback&&r&&l.shouldFallback()):(u=a.GlobalSettings.enableFallback&&r,s(d,o.TypeErrorType.UnknownType)),u){var h=t.fallback;!h&&e&&e.setShouldFallback(true),"string"==typeof h&&"drop"===h.toLowerCase()?l=void 0:"object"==typeof h&&(l=this.internalParseCardObject(e,h,i,true,n,s))}}}return l},t.prototype.cardObjectParsed=function(e,t){e instanceof W&&this.onParseAction?this.onParseAction(e,t,this):e instanceof v&&this.onParseElement&&this.onParseElement(e,t,this)},t.prototype.shouldSerialize=function(e){return e instanceof W?void 0!==this.actionRegistry.findByName(e.getJsonTypeName()):!(e instanceof v)||void 0!==this.elementRegistry.findByName(e.getJsonTypeName())},t.prototype.parseCardObject=function(e,t,i,r,n,s){var o=this.internalParseCardObject(e,t,i,r,n,s);return void 0!==o&&this.cardObjectParsed(o,t),o},t.prototype.parseElement=function(e,t,i){var r=this;return this.parseCardObject(e,t,[],i,(function(e){return r.elementRegistry.createInstance(e,r.targetVersion)}),(function(e,t){t===o.TypeErrorType.UnknownType?r.logParseEvent(void 0,o.ValidationEvent.UnknownElementType,p.Strings.errors.unknownElementType(e)):r.logParseEvent(void 0,o.ValidationEvent.ElementTypeNotAllowed,p.Strings.errors.elementTypeNotAllowed(e))}))},t.prototype.parseAction=function(e,t,i,r){var n=this;return this.parseCardObject(e,t,i,r,(function(e){return n.actionRegistry.createInstance(e,n.targetVersion)}),(function(e,t){t==o.TypeErrorType.UnknownType?n.logParseEvent(void 0,o.ValidationEvent.UnknownActionType,p.Strings.errors.unknownActionType(e)):n.logParseEvent(void 0,o.ValidationEvent.ActionTypeNotAllowed,p.Strings.errors.actionTypeNotAllowed(e))}))},Object.defineProperty(t.prototype,"elementRegistry",{get:function(){return this._elementRegistry?this._elementRegistry:f.GlobalRegistry.elements},enumerable:false,configurable:true}),t.prototype.setElementRegistry=function(e){this._elementRegistry=e},Object.defineProperty(t.prototype,"actionRegistry",{get:function(){return this._actionRegistry?this._actionRegistry:f.GlobalRegistry.actions},enumerable:false,configurable:true}),t.prototype.setActionRegistry=function(e){this._actionRegistry=e},t}(h.BaseSerializationContext);t.SerializationContext=Se,f.GlobalRegistry.defaultElements.register("Container",re),f.GlobalRegistry.defaultElements.register("TextBlock",y),f.GlobalRegistry.defaultElements.register("RichTextBlock",w,h.Versions.v1_2),f.GlobalRegistry.defaultElements.register("TextRun",C,h.Versions.v1_2),f.GlobalRegistry.defaultElements.register("Image",I),f.GlobalRegistry.defaultElements.register("ImageSet",A),f.GlobalRegistry.defaultElements.register("Media",D,h.Versions.v1_1),f.GlobalRegistry.defaultElements.register("FactSet",E),f.GlobalRegistry.defaultElements.register("ColumnSet",se),f.GlobalRegistry.defaultElements.register("ActionSet",Q,h.Versions.v1_2),f.GlobalRegistry.defaultElements.register("Input.Text",O),f.GlobalRegistry.defaultElements.register("Input.Date",F),f.GlobalRegistry.defaultElements.register("Input.Time",j),f.GlobalRegistry.defaultElements.register("Input.Number",k),f.GlobalRegistry.defaultElements.register("Input.ChoiceSet",L),f.GlobalRegistry.defaultElements.register("Input.Toggle",N),f.GlobalRegistry.defaultActions.register(Y.JsonTypeName,Y),f.GlobalRegistry.defaultActions.register(H.JsonTypeName,H),f.GlobalRegistry.defaultActions.register(q.JsonTypeName,q),f.GlobalRegistry.defaultActions.register(G.JsonTypeName,G,h.Versions.v1_2),f.GlobalRegistry.defaultActions.register(V.JsonTypeName,V,h.Versions.v1_4)},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.Constants=void 0;var r=function(){function e(){}return e.keys={tab:"Tab",enter:"Enter",escape:"Escape",space:" ",up:"ArrowUp",down:"ArrowDown",delete:"Delete"},e}();t.Constants=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(8),n=i(4),s=i(46),o=i(13);class a{constructor(){this.portalURL=null,this.errorHelperService=o.ErrorHelperService.getInstance(),this.authService=r.AuthService.getInstance(),this.logger=n.LoggerService.getInstance(),this.i18n=s.I18nService.getInstance(),this.datacenters=[{name:"France","alpha-3":"FRA","alpha-2":"FR",region:"Europe"},{name:"Germany","alpha-3":"DEU","alpha-2":"DE",region:"Europe"},{name:"Canada","alpha-3":"CAN","alpha-2":"CA",region:"America"},{name:"Singapore","alpha-3":"SGP","alpha-2":"SG",region:"Asia-Pacific"}],this.countries=[{name:"Australia","alpha-3":"AUS","country-code":"036","alpha-2":"AU"},{name:"Austria","alpha-3":"AUT","country-code":"040","alpha-2":"AT"},{name:"Belgium","alpha-3":"BEL","country-code":"056","alpha-2":"BE"},{name:"Brazil","alpha-3":"BRA","country-code":"076","alpha-2":"BR"},{name:"Canada","alpha-3":"CAN","country-code":"124","alpha-2":"CA"},{name:"China","alpha-3":"CHN","country-code":"156","alpha-2":"CN"},{name:"Czech Republic","alpha-3":"CZE","country-code":"203","alpha-2":"CZ"},{name:"Denmark","alpha-3":"DNK","country-code":"208","alpha-2":"DK"},{name:"Finland","alpha-3":"FIN","country-code":"246","alpha-2":"FI"},{name:"France","alpha-3":"FRA","country-code":"250",default:true,"alpha-2":"FR"},{name:"Germany","alpha-3":"DEU","country-code":"276","alpha-2":"DE"},{name:"Hong Kong","alpha-3":"HKG","country-code":"344","alpha-2":"HK"},{name:"Ireland","alpha-3":"IRL","country-code":"372","alpha-2":"IE"},{name:"Israel","alpha-3":"ISR","country-code":"376","alpha-2":"IL"},{name:"Italy","alpha-3":"ITA","country-code":"380","alpha-2":"IT"},{name:"Mexico","alpha-3":"MEX","country-code":"484","alpha-2":"MX"},{name:"Netherlands","alpha-3":"NLD","country-code":"528","alpha-2":"NL"},{name:"Norway","alpha-3":"NOR","country-code":"578","alpha-2":"NO"},{name:"Poland","alpha-3":"POL","country-code":"616","alpha-2":"PL"},{name:"Portugal","alpha-3":"PRT","country-code":"620","alpha-2":"PT"},{name:"Russia","alpha-3":"RUS","country-code":"643","alpha-2":"RU"},{name:"South Africa","alpha-3":"ZAF","country-code":"710","alpha-2":"ZA"},{name:"South Korea","alpha-3":"KOR","country-code":"410","alpha-2":"KR"},{name:"Spain","alpha-3":"ESP","country-code":"724","alpha-2":"ES"},{name:"Sweden","alpha-3":"SWE","country-code":"752","alpha-2":"SE"},{name:"Switzerland","alpha-3":"CHE","country-code":"756","alpha-2":"CH"},{name:"Taiwan","alpha-3":"TWN","country-code":"158","alpha-2":"TW"},{name:"Turkey","alpha-3":"TUR","country-code":"792","alpha-2":"TR"},{name:"United Kingdom","alpha-3":"GBR","country-code":"826","alpha-2":"GB"},{name:"United States of America","alpha-3":"USA","country-code":"840","alpha-2":"US"},{name:"Afghanistan","alpha-3":"AFG","country-code":"004","alpha-2":"AF"},{name:"Albania","alpha-3":"ALB","country-code":"008","alpha-2":"AL"},{name:"Algeria","alpha-3":"DZA","country-code":"012","alpha-2":"DZ"},{name:"Andorra","alpha-3":"AND","country-code":"020","alpha-2":"AD"},{name:"Angola","alpha-3":"AGO","country-code":"024","alpha-2":"AO"},{name:"Anguilla","alpha-3":"AIA","country-code":"660","alpha-2":"AI"},{name:"Antigua and Barbuda","alpha-3":"ATG","country-code":"028","alpha-2":"AG"},{name:"Argentina","alpha-3":"ARG","country-code":"032","alpha-2":"AR"},{name:"Armenia","alpha-3":"ARM","country-code":"051","alpha-2":"AM"},{name:"Aruba","alpha-3":"ABW","country-code":"533","alpha-2":"AW"},{name:"Azerbaijan","alpha-3":"AZE","country-code":"031","alpha-2":"AZ"},{name:"Bahamas","alpha-3":"BHS","country-code":"044","alpha-2":"BS"},{name:"Bahrain","alpha-3":"BHR","country-code":"048","alpha-2":"BH"},{name:"Bangladesh","alpha-3":"BGD","country-code":"050","alpha-2":"BD"},{name:"Barbados","alpha-3":"BRB","country-code":"052","alpha-2":"BB"},{name:"Belarus","alpha-3":"BLR","country-code":"112","alpha-2":"BY"},{name:"Belize","alpha-3":"BLZ","country-code":"084","alpha-2":"BZ"},{name:"Benin","alpha-3":"BEN","country-code":"204","alpha-2":"BJ"},{name:"Bermuda","alpha-3":"BMU","country-code":"060","alpha-2":"BM"},{name:"Bhutan","alpha-3":"BTN","country-code":"064","alpha-2":"BT"},{name:"Bolivia","alpha-3":"BOL","country-code":"068","alpha-2":"BO"},{name:"Bosnia and Herzegovina","alpha-3":"BIH","country-code":"070","alpha-2":"BA"},{name:"Botswana","alpha-3":"BWA","country-code":"072","alpha-2":"BW"},{name:"British Virgin Islands","alpha-3":"VGB","country-code":"092","alpha-2":"VG"},{name:"Brunei Darussalam","alpha-3":"BRN","country-code":"096","alpha-2":"BN"},{name:"Bulgaria","alpha-3":"BGR","country-code":"100","alpha-2":"BG"},{name:"Burkina Faso","alpha-3":"BFA","country-code":"854","alpha-2":"BF"},{name:"Burundi","alpha-3":"BDI","country-code":"108","alpha-2":"BI"},{name:"Cambodia","alpha-3":"KHM","country-code":"116","alpha-2":"KH"},{name:"Cameroon","alpha-3":"CMR","country-code":"120","alpha-2":"CM"},{name:"Cape Verde","alpha-3":"CPV","country-code":"132","alpha-2":"CV"},{name:"Cayman Islands","alpha-3":"CYM","country-code":"136","alpha-2":"KY"},{name:"Central African Republic","alpha-3":"CAF","country-code":"140","alpha-2":"CF"},{name:"Chad","alpha-3":"TCD","country-code":"148","alpha-2":"TD"},{name:"Chile","alpha-3":"CHL","country-code":"152","alpha-2":"CL"},{name:"Colombia","alpha-3":"COL","country-code":"170","alpha-2":"CO"},{name:"Comoros","alpha-3":"COM","country-code":"174","alpha-2":"KM"},{name:"Congo","alpha-3":"COG","country-code":"178","alpha-2":"CG"},{name:"Congo, Democratic Republic of","alpha-3":"COD","country-code":"180","alpha-2":"CD"},{name:"Costa Rica","alpha-3":"CRI","country-code":"188","alpha-2":"CR"},{name:"Ivory Coast","alpha-3":"CIV","country-code":"384","alpha-2":"CI"},{name:"Croatia","alpha-3":"HRV","country-code":"191","alpha-2":"HR"},{name:"Cyprus","alpha-3":"CYP","country-code":"196","alpha-2":"CY"},{name:"Djibouti","alpha-3":"DJI","country-code":"262","alpha-2":"DJ"},{name:"Dominica","alpha-3":"DMA","country-code":"212","alpha-2":"DM"},{name:"Dominican Republic","alpha-3":"DOM","country-code":"214","alpha-2":"DO"},{name:"Ecuador","alpha-3":"ECU","country-code":"218","alpha-2":"EC"},{name:"El Salvador","alpha-3":"SLV","country-code":"222","alpha-2":"SV"},{name:"Egypt","alpha-3":"EGY","country-code":"818","alpha-2":"EG"},{name:"Eritrea","alpha-3":"ERI","country-code":"232","alpha-2":"ER"},{name:"Estonia","alpha-3":"EST","country-code":"233","alpha-2":"EE"},{name:"Ethiopia","alpha-3":"ETH","country-code":"231","alpha-2":"ET"},{name:"Fiji","alpha-3":"FJI","country-code":"242","alpha-2":"FJ"},{name:"French Guiana","alpha-3":"GUF","country-code":"254","alpha-2":"GF"},{name:"French Polynesia","alpha-3":"PYF","country-code":"258","alpha-2":"PF"},{name:"Gabon","alpha-3":"GAB","country-code":"266","alpha-2":"GA"},{name:"Gambia","alpha-3":"GMB","country-code":"270","alpha-2":"GM"},{name:"Georgia","alpha-3":"GEO","country-code":"268","alpha-2":"GE"},{name:"Ghana","alpha-3":"GHA","country-code":"288","alpha-2":"GH"},{name:"Greece","alpha-3":"GRC","country-code":"300","alpha-2":"GR"},{name:"Grenada","alpha-3":"GRD","country-code":"308","alpha-2":"GD"},{name:"Guadeloupe","alpha-3":"GLP","country-code":"312","alpha-2":"GP"},{name:"Guatemala","alpha-3":"GTM","country-code":"320","alpha-2":"GT"},{name:"Guinea","alpha-3":"GIN","country-code":"324","alpha-2":"GN"},{name:"Guyana","alpha-3":"GUY","country-code":"328","alpha-2":"GY"},{name:"Haiti","alpha-3":"HTI","country-code":"332","alpha-2":"HT"},{name:"Honduras","alpha-3":"HND","country-code":"340","alpha-2":"HN"},{name:"Hungary","alpha-3":"HUN","country-code":"348","alpha-2":"HU"},{name:"Iceland","alpha-3":"ISL","country-code":"352","alpha-2":"IS"},{name:"India","alpha-3":"IND","country-code":"356","alpha-2":"IN"},{name:"Indonesia","alpha-3":"IDN","country-code":"360","alpha-2":"ID"},{name:"Iraq","alpha-3":"IRQ","country-code":"368","alpha-2":"IQ"},{name:"Jamaica","alpha-3":"JAM","country-code":"388","alpha-2":"JM"},{name:"Japan","alpha-3":"JPN","country-code":"392","alpha-2":"JP"},{name:"Jordan","alpha-3":"JOR","country-code":"400","alpha-2":"JO"},{name:"Kazakhstan","alpha-3":"KAZ","country-code":"398","alpha-2":"KZ"},{name:"Kenya","alpha-3":"KEN","country-code":"404","alpha-2":"KE"},{name:"Kuwait","alpha-3":"KWT","country-code":"414","alpha-2":"KW"},{name:"Kyrgyzstan","alpha-3":"KGZ","country-code":"417","alpha-2":"KG"},{name:"Latvia","alpha-3":"LVA","country-code":"428","alpha-2":"LV"},{name:"Lebanon","alpha-3":"LBN","country-code":"422","alpha-2":"LB"},{name:"Lesotho","alpha-3":"LSO","country-code":"426","alpha-2":"LS"},{name:"Liberia","alpha-3":"LBR","country-code":"430","alpha-2":"LR"},{name:"Libya","alpha-3":"LBY","country-code":"434","alpha-2":"LY"},{name:"Liechtenstein","alpha-3":"LIE","country-code":"438","alpha-2":"LI"},{name:"Lithuania","alpha-3":"LTU","country-code":"440","alpha-2":"LT"},{name:"Luxembourg","alpha-3":"LUX","country-code":"442","alpha-2":"LU"},{name:"Macao","alpha-3":"MAC","country-code":"446","alpha-2":"MO"},{name:"Macedonia","alpha-3":"MKD","country-code":"807","alpha-2":"MK"},{name:"Madagascar","alpha-3":"MDG","country-code":"450","alpha-2":"MG"},{name:"Malawi","alpha-3":"MWI","country-code":"454","alpha-2":"MW"},{name:"Malaysia","alpha-3":"MYS","country-code":"458","alpha-2":"MY"},{name:"Maldives","alpha-3":"MDV","country-code":"462","alpha-2":"MV"},{name:"Mali","alpha-3":"MLI","country-code":"466","alpha-2":"ML"},{name:"Malta","alpha-3":"MLT","country-code":"470","alpha-2":"MT"},{name:"Mauritius","alpha-3":"MUS","country-code":"480","alpha-2":"MU"},{name:"Mayotte","alpha-3":"MYT","country-code":"175","alpha-2":"YT"},{name:"Moldova","alpha-3":"MDA","country-code":"498","alpha-2":"MD"},{name:"Monaco","alpha-3":"MCO","country-code":"492","alpha-2":"MC"},{name:"Mongolia","alpha-3":"MNG","country-code":"496","alpha-2":"MN"},{name:"Montenegro","alpha-3":"MNE","country-code":"499","alpha-2":"ME"},{name:"Montserrat","alpha-3":"MSR","country-code":"500","alpha-2":"MS"},{name:"Morocco","alpha-3":"MAR","country-code":"504","alpha-2":"MA"},{name:"Mozambique","alpha-3":"MOZ","country-code":"508","alpha-2":"MZ"},{name:"Myanmar","alpha-3":"MMR","country-code":"104","alpha-2":"MM"},{name:"Namibia","alpha-3":"NAM","country-code":"516","alpha-2":"NA"},{name:"Nepal","alpha-3":"NPL","country-code":"524","alpha-2":"NP"},{name:"New Zealand","alpha-3":"NZL","country-code":"554","alpha-2":"NZ"},{name:"Nicaragua","alpha-3":"NIC","country-code":"558","alpha-2":"NI"},{name:"Niger","alpha-3":"NER","country-code":"562","alpha-2":"NE"},{name:"Nigeria","alpha-3":"NGA","country-code":"566","alpha-2":"NG"},{name:"Oman","alpha-3":"OMN","country-code":"512","alpha-2":"OM"},{name:"Pakistan","alpha-3":"PAK","country-code":"586","alpha-2":"PK"},{name:"Palestine","alpha-3":"PSE","country-code":"275","alpha-2":"PS"},{name:"Panama","alpha-3":"PAN","country-code":"591","alpha-2":"PA"},{name:"Paraguay","alpha-3":"PRY","country-code":"600","alpha-2":"PY"},{name:"Peru","alpha-3":"PER","country-code":"604","alpha-2":"PE"},{name:"Philippines","alpha-3":"PHL","country-code":"608","alpha-2":"PH"},{name:"Puerto Rico","alpha-3":"PRI","country-code":"630","alpha-2":"PR"},{name:"Qatar","alpha-3":"QAT","country-code":"634","alpha-2":"QA"},{name:"Romania","alpha-3":"ROU","country-code":"642","alpha-2":"RO"},{name:"Rwanda","alpha-3":"RWA","country-code":"646","alpha-2":"RW"},{name:"Saint Kitts and Nevis","alpha-3":"KNA","country-code":"659","alpha-2":"KN"},{name:"Saint Lucia","alpha-3":"LCA","country-code":"662","alpha-2":"LC"},{name:"Saint Vincent and the Grenadines","alpha-3":"VCT","country-code":"670","alpha-2":"VC"},{name:"Saudi Arabia","alpha-3":"SAU","country-code":"682","alpha-2":"SA"},{name:"Senegal","alpha-3":"SEN","country-code":"686","alpha-2":"SN"},{name:"Serbia","alpha-3":"SRB","country-code":"688","alpha-2":"RS"},{name:"Sierra Leone","alpha-3":"SLE","country-code":"694","alpha-2":"SL"},{name:"Singapore","alpha-3":"SGP","country-code":"702","alpha-2":"SG"},{name:"Slovakia","alpha-3":"SVK","country-code":"703","alpha-2":"SK"},{name:"Slovenia","alpha-3":"SVN","country-code":"705","alpha-2":"SI"},{name:"South Sudan","alpha-3":"SSD","country-code":"728","alpha-2":"SS"},{name:"Sri Lanka","alpha-3":"LKA","country-code":"144","alpha-2":"LK"},{name:"Sudan","alpha-3":"SDN","country-code":"729","alpha-2":"SD"},{name:"Swaziland","alpha-3":"SWZ","country-code":"748","alpha-2":"SZ"},{name:"Tajikistan","alpha-3":"TJK","country-code":"762","alpha-2":"TJ"},{name:"Tanzania","alpha-3":"TZA","country-code":"834","alpha-2":"TZ"},{name:"Thailand","alpha-3":"THA","country-code":"764","alpha-2":"TH"},{name:"Togo","alpha-3":"TGO","country-code":"768","alpha-2":"TG"},{name:"Trinidad and Tobago","alpha-3":"TTO","country-code":"780","alpha-2":"TT"},{name:"Tunisia","alpha-3":"TUN","country-code":"788","alpha-2":"TN"},{name:"Turkmenistan","alpha-3":"TKM","country-code":"795","alpha-2":"TM"},{name:"Turks and Caicos Islands","alpha-3":"TCA","country-code":"796","alpha-2":"TC"},{name:"Uganda","alpha-3":"UGA","country-code":"800","alpha-2":"UG"},{name:"Ukraine","alpha-3":"UKR","country-code":"804","alpha-2":"UA"},{name:"United Arab Emirates","alpha-3":"ARE","country-code":"784","alpha-2":"AE"},{name:"Virgin Islands, US","alpha-3":"VIR","country-code":"850","alpha-2":"VI"},{name:"Uruguay","alpha-3":"URY","country-code":"858","alpha-2":"UY"},{name:"Uzbekistan","alpha-3":"UZB","country-code":"860","alpha-2":"UZ"},{name:"Venezuela","alpha-3":"VEN","country-code":"862","alpha-2":"VE"},{name:"Vietnam","alpha-3":"VNM","country-code":"704","alpha-2":"VN"},{name:"Zambia","alpha-3":"ZMB","country-code":"894","alpha-2":"ZM"},{name:"Zimbabwe","alpha-3":"ZWE","country-code":"716","alpha-2":"ZW"}],this.statesOfCanada={AB:"Alberta",BC:"British Columbia",MB:"Manitoba",NB:"New Brunswick",NL:"Newfoundland and Labrador",NS:"Nova Scotia",NT:"Northwest Territories",NU:"Nunavut",ON:"Ontario",PE:"Prince Edward Island",QC:"Quebec",SK:"Saskatchewan",YT:"Yukon"},this.statesOfAmerica={AL:"Alabama",AK:"Alaska",AZ:"Arizona",AR:"Arkansas",AA:"Armed Forces America",AE:"Armed Forces",AP:"Armed Forces Pacific",CA:"California",CO:"Colorado",CT:"Connecticut",DE:"Delaware",FL:"Florida",GA:"Georgia",GU:"Guam",HI:"Hawaii",ID:"Idaho",IL:"Illinois",IN:"Indiana",IA:"Iowa",KS:"Kansas",KY:"Kentucky",LA:"Louisiana",ME:"Maine",MD:"Maryland",MA:"Massachusetts",MI:"Michigan",MN:"Minnesota",MS:"Mississippi",MO:"Missouri",MT:"Montana",NE:"Nebraska",NV:"Nevada",NH:"New Hampshire",NJ:"New Jersey",NM:"New Mexico",NY:"New York",NC:"North Carolina",ND:"North Dakota",OH:"Ohio",OK:"Oklahoma",OR:"Oregon",PA:"Pennsylvania",PR:"Puerto Rico",RI:"Rhode Island",SC:"South Carolina",SD:"South Dakota",TN:"Tennessee",TX:"Texas",UT:"Utah",VT:"Vermont",VI:"Virgin Islands",VA:"Virginia",WA:"Washington",DC:"Washington DC",WV:"West Virginia",WI:"Wisconsin",WY:"Wyoming"},this.countryToInternationalCallingCodeMapping={AD:"376",AE:"971",AF:"93",AG:"1268",AI:"1264",AL:"355",AM:"374",AN:"599",AO:"244",AQ:"672",AR:"54",AS:"1684",AT:"43",AU:"61",AW:"297",AZ:"994",BA:"387",BB:"1246",BD:"880",BE:"32",BF:"226",BG:"359",BH:"973",BI:"257",BJ:"229",BL:"590",BM:"1441",BN:"673",BO:"591",BR:"55",BS:"1242",BT:"975",BW:"267",BY:"375",BZ:"501",CA:"1",CC:"61",CD:"243",CF:"236",CG:"242",CH:"41",CI:"225",CK:"682",CL:"56",CM:"237",CN:"86",CO:"57",CR:"506",CU:"53",CV:"238",CX:"61",CY:"357",CZ:"420",DE:"49",DJ:"253",DK:"45",DM:"1767",DO:"1809",DZ:"213",EC:"593",EE:"372",EG:"20",ER:"291",ES:"34",ET:"251",FI:"358",FJ:"679",FK:"500",FM:"691",FO:"298",FR:"33",GA:"241",GB:"44",GD:"1473",GE:"995",GH:"233",GI:"350",GL:"299",GM:"220",GN:"224",GQ:"240",GR:"30",GT:"502",GU:"1671",GW:"245",GY:"592",HK:"852",HN:"504",HR:"385",HT:"509",HU:"36",ID:"62",IE:"353",IL:"972",IM:"44",IN:"91",IQ:"964",IR:"98",IS:"354",IT:"39",JM:"1876",JO:"962",JP:"81",KE:"254",KG:"996",KH:"855",KI:"686",KM:"269",KN:"1869",KP:"850",KR:"82",KW:"965",KY:"1345",KZ:"7",LA:"856",LB:"961",LC:"1758",LI:"423",LK:"94",LR:"231",LS:"266",LT:"370",LU:"352",LV:"371",LY:"218",MA:"212",MC:"377",MD:"373",ME:"382",MF:"1599",MG:"261",MH:"692",MK:"389",ML:"223",MM:"95",MN:"976",MO:"853",MP:"1670",MR:"222",MS:"1664",MT:"356",MU:"230",MV:"960",MW:"265",MX:"52",MY:"60",MZ:"258",NA:"264",NC:"687",NE:"227",NG:"234",NI:"505",NL:"31",NO:"47",NP:"977",NR:"674",NU:"683",NZ:"64",OM:"968",PA:"507",PE:"51",PF:"689",PG:"675",PH:"63",PK:"92",PL:"48",PM:"508",PN:"870",PR:"1",PT:"351",PW:"680",PY:"595",QA:"974",RO:"40",RS:"381",RU:"7",RW:"250",SA:"966",SB:"677",SC:"248",SD:"249",SE:"46",SG:"65",SH:"290",SI:"386",SK:"421",SL:"232",SM:"378",SN:"221",SO:"252",SR:"597",ST:"239",SV:"503",SY:"963",SZ:"268",TC:"1649",TD:"235",TG:"228",TH:"66",TJ:"992",TK:"690",TL:"670",TM:"993",TN:"216",TO:"676",TR:"90",TT:"1868",TV:"688",TW:"886",TZ:"255",UA:"380",UG:"256",US:"1",UY:"598",UZ:"998",VA:"39",VC:"1784",VE:"58",VG:"1284",VI:"1340",VN:"84",VU:"678",WF:"681",WS:"685",XK:"381",YE:"967",YT:"262",ZA:"27",ZM:"260",ZW:"263"},this.countryToLanguageMapping={ad:"ca",ae:"ar",af:"fa,ps",ag:"en",ai:"en",al:"sq",am:"hy",an:"nl,en",ao:"pt",ar:"es",as:"en,sm",at:"de",au:"en",aw:"nl,pap",ax:"sv",ba:"bs,hr,sr",bb:"en",bd:"bn",be:"nl,fr,de",bf:"fr",bh:"ar",bi:"fr",bj:"fr",bl:"fr",bm:"en",bn:"ms",bo:"es,qu,ay",br:"pt",bs:"en",bt:"dz",bv:"no",bw:"en,tn",by:"be,ru",bz:"en",ca:"en,fr",cc:"en",cd:"fr",cf:"fr",cg:"fr",ch:"de,fr,it,rm",ci:"fr",ck:"en,rar",cl:"es",cm:"fr,en",cn:"zh",co:"es",cr:"es",cu:"es",cv:"pt",cx:"en",cy:"el,tr",cz:"cs","// de":"de",dj:"fr,ar,so",dk:"da",dm:"en",do:"es",dz:"ar",ec:"es",ee:"et",eg:"ar",eh:"ar,es,fr",er:"ti,ar,en",es:"ast,ca,es,eu,gl",et:"am,om",fi:"fi,sv,se",fj:"en",fk:"en",fm:"en",ga:"fr",gb:"en,ga,cy,gd,kw",gd:"en",ge:"ka",gf:"fr",gg:"en",gh:"en",gi:"en",gl:"kl,da",gm:"en",gn:"fr",gp:"fr",gq:"es,fr,pt",gr:"el",gs:"en",gt:"es",gu:"en,ch",gw:"pt",gy:"en",hk:"zh,en",hm:"en",hn:"es",ht:"fr,ht",ie:"en,ga",il:"he",im:"en",in:"hi,en",io:"en",iq:"ar,ku",ir:"fa",it:"it,de,fr",je:"en",jm:"en",jo:"ar",jp:"ja",ke:"sw,en",kg:"ky,ru",kh:"km",ki:"en",km:"ar,fr",kn:"en",kp:"ko",kr:"ko,en",kw:"ar",ky:"en",kz:"kk,ru",la:"lo",lb:"ar,fr",lc:"en",li:"de",lk:"si,ta",lr:"en",ls:"en,st",lu:"lb,fr,de",ly:"ar",ma:"ar",mc:"fr",md:"ru,uk,ro",me:"srp,sq,bs,hr,sr",mf:"fr",mg:"mg,fr",mh:"en,mh",ml:"fr",mm:"my",mo:"zh,pt",mp:"ch",mq:"fr",mr:"ar,fr",ms:"en",mt:"mt,en",mu:"mfe,fr,en",mv:"dv",mw:"en,ny",mx:"es",my:"ms",mz:"pt",na:"en,sf,de",nc:"fr",ne:"fr",nf:"en,pih",ng:"en",ni:"es",no:"nb,nn,no,se",np:"ne",nr:"na,en",nu:"niu,en",nz:"mi,en",om:"ar",pa:"es",pe:"es",pf:"fr",pg:"en,tpi,ho",ph:"en,tl",pk:"en,ur",pm:"fr",pn:"en,pih",pr:"es,en",ps:"ar,he",pw:"en,pau,ja,sov,tox",py:"es,gn",qa:"ar",re:"fr",rs:"sr",rw:"rw,fr,en",sa:"ar",sb:"en",sc:"fr,en,crs",sd:"ar,en",se:"sv",sg:"en,ms,zh,ta",sh:"en",si:"sl",sj:"no",sl:"en",sm:"it",sn:"fr",so:"so,ar",sr:"nl",st:"pt",ss:"en",sv:"es",sy:"ar",sz:"en,ss",tc:"en",td:"fr,ar",tf:"fr",tg:"fr",tj:"tg,ru",tk:"tkl,en,sm",tl:"pt,tet",tm:"tk",tn:"ar",to:"en",tt:"en",tv:"en",tw:"zh",tz:"sw,en",ua:"uk",ug:"en,sw",um:"en",us:"en",uy:"es",uz:"uz,kaa",va:"it",vc:"en",ve:"es",vg:"en",vi:"en",vn:"vi",vu:"bi,en,fr",wf:"fr",ws:"sm,en",ye:"ar",yt:"fr",za:"zu,xh,af,st,tn,en",zm:"en",zw:"en,sn,nd "}}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.countryService||(e.rainbow.countryService=new a),e.rainbow.countryService}async start(){this.logger.info(""),this.logger.info("[countryService] === STARTING ==="),this.portalURL=config.restServerUrl+"/api/rainbow/enduser/v1.0/";try{const e=await this.getAvailableCountries();this.countries=e.map((e=>{const t={name:e.fullname,"alpha-3":e.isoAlpha3Code,"alpha-2":e.isoAlpha2Code};return"FRA"===e.isoAlpha3Code&&(t.default=true),t}))}catch(e){this.logger.info("[countryService] === warning === "+e.message)}this.logger.info("[countryService] === STARTED  === "+this.countries.length+" countries"),this.logger.info("")}async stop(){this.logger.info("[countryService] STOPPED")}getCountries(){const e=this.countries.map((e=>{const t=this.getCountryLabel(e["alpha-2"]);if(t){const i=this.i18n.translate(t);i&&i!==t&&(e.name=i)}return e}));return e.sort(((e,t)=>e.name.localeCompare(t.name,this.i18n.getCurrentLanguage()))),e}getCountryStates(e){return e&&"USA"===e["alpha-3"]?this.statesOfAmerica:e&&"CAN"===e["alpha-3"]?this.statesOfCanada:{}}getCountry(e,t=null){if(!e)return t?this.getDefaultCountry():null;const i=this.countries.filter((t=>t["alpha-3"]===e));return i.length>0?i[0]:null}getDefaultCountry(){const e=this.countries.filter((e=>true===e.default));return e.length>0?e[0]:this.countries[0]}getCountryName(e){return this.getCountry(e)?this.getCountry(e).name:null}getCountryCode(e){return e?e["alpha-3"]:null}getCountryDataFromName(e){if(!e)return null;const t=this.countries.filter((t=>t.name===e));return t.length>0?t[0]:null}getCountryCodeFromName(e){const t=this.getCountryDataFromName(e);return t?t["alpha-3"]:null}getStateCodeFromName(e,t){const i=this.getCountryDataFromName(e);if(i&&"USA"===i["alpha-3"]){for(const[e,i]of Object.entries(this.statesOfAmerica))if(t===i)return e}if(i&&"CAN"===i["alpha-3"]){for(const[e,i]of Object.entries(this.statesOfCanada))if(t===i)return e}return null}getStateName(e,t){return e&&t?"USA"===e?this.statesOfAmerica[t]:"CAN"===e?this.statesOfCanada[t]:"":""}getDefaultState(e){return e&&"USA"===e["alpha-3"]?"AL":e&&"CAN"===e["alpha-3"]?"AB":null}getAlpha2Code(e){if(!e)return null;const t=this.countries.filter((t=>t["alpha-3"]===e));return t.length>0?t[0]["alpha-2"]:null}getCountryLabel(e){let t=null;return t=3===e.length?this.getAlpha2Code(e):e,t?"country"+t:null}getDataCenterLabel(e,t){let i=this.getRegionLabel(e.name);if(e.country===t)i=this.getCountryLabel(e.country);else{const t=this.datacenters.find((t=>t["alpha-3"]===e.country));t&&(i=this.getRegionLabel(t.region))}return i}getRegionLabel(e){return e}getInternationalCallingCode(e){if(!e)return;const t=e.toUpperCase();return this.countryToInternationalCallingCodeMapping[t]}mapCountryToLanguages(e){if(!e)return;const t=e.toLowerCase();return void 0!==this.countryToLanguageMapping[t]?this.countryToLanguageMapping[t].split(","):[t]}async getAvailableCountries(){try{const e=await fetch(this.portalURL+"/countries",{method:"GET",headers:this.authService.getRequestHeader()});if(!e.ok)throw e;return(await e.json()).data}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getAvailableCountries");throw this.logger.error("[countryService] "+t.message),t.error}}}t.CountryService=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(450),n=i(7),s=i(6),o=i(8),a=i(9),c=i(4),l=i(30),d=i(62),u=i(120),h=i(314);class f{constructor(){this.favorites=[],this.eventNames=[],this.rxSubject=new n.Subject,this.authService=o.AuthService.getInstance(),this.xmppService=a.XmppService.getInstance(),this.contactService=s.ContactService.getInstance(),this.logger=c.LoggerService.getInstance(),this.roomService=l.RoomService.getInstance(),this.conversationService=d.ConversationService.getInstance(),this.companyDirectoryService=u.CompanyDirectoryService.getInstance(),this.office365AdService=h.Office365AdService.getInstance()}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.favoriteService||(e.rainbow.favoriteService=new f),e.rainbow.favoriteService}async start(){this.logger.info("[FavoriteService] === STARTING ==="),this.connect(),this.eventNames=["ON_FAVORITE_CREATED","ON_FAVORITE_DELETED","ON_FAVORITE_UPDATED"],this.logger.info("[FavoriteService] === STARTED ===")}async connect(){try{await this.getServerFavorites(),this.conversationService.favoriteService=this,this.attachHandlers(),this.rxSubject.next({name:"update"})}catch(e){this.logger.error("[FavoriteService] connect -- Failure -- "+e.message)}}async stop(){this.logger.info("[FavoriteService] === STOPPING ==="),this.xmppManagementHandler&&(this.xmppService.deleteHandler(this.xmppManagementHandler),this.xmppManagementHandler=null),this.logger.info("[FavoriteService] === STOPPED ===")}subscribe(e){return this.rxSubject.subscribe(e)}async getServerFavorites(){try{const e=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.contactService.userContact.dbId}/favorites`,t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw this.logger.debug(`[FavoriteService] Request ${i.headers.get("x-rainbow-request-id")} failed with status ${i.status}`),new Error(i.statusText);const r=(await i.json()).data.map((async e=>this.createFavorite(e.id,e.peerId,e.type))),n=await Promise.all(r);return this.favorites=n.filter((e=>null!==e)),this.logger.info(`[FavoriteService] getServerFavorites -- SUCCESS -- found ${this.favorites.length} favorites`),this.favorites}catch(e){const t="[FavoriteService] getServerFavorites -- FAILURE -- "+e.message;throw this.logger.error(t),new Error(t)}}async addServerFavorite(e,t){try{const i=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.contactService.userContact.dbId}/favorites?type=${t}`,r=this.authService.getPostHeader(),n={peerId:e,type:t},s=await fetch(i,{method:"POST",headers:r,body:JSON.stringify(n)}),o=await s.json();if(o.errorDetails&&"FAVORITE_CONVERSATIONS_COUNT"===o.errorDetails.feature)throw new Error("Reach FAVORITE_CONVERSATIONS_COUNT");this.logger.info(`[FavoriteService] addServerFavorite(${e}, ${t}) -- SUCCESS`)}catch(i){const r=`[FavoriteService] addServerFavorite(${e}, ${t}) -- FAILURE -- ${i.message}`;throw this.logger.error(r),new Error(r)}}async removeServerFavorite(e){try{const t=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.contactService.userContact.dbId}/favorites/${e}`,i=this.authService.getRequestHeader();await fetch(t,{method:"DELETE",headers:i}),this.logger.info(`[FavoriteService] removeServerFavorite(${e}) -- SUCCESS`)}catch(t){const i=`[FavoriteService] removeServerFavorite(${e}) -- FAILURE -- ${t.statusText}`;throw this.logger.error(i),new Error(i)}}async toggleFavorite(e){try{const t=e.contact?e.contact.dbId:e.room.dbId,i=e.contact?e.contact.isBot?"bot":"user":"room",r=this.favorites.find((e=>e.peerId===t));r?await this.removeServerFavorite(r.id):await this.addServerFavorite(t,i)}catch(t){throw new Error(t.message)}}async getFavoriteConversation(e){const t=this.favorites.find((t=>t.peerId===e)),i=t.contact?this.conversationService.getOrCreateConversation(t.contact.jid,"contact"):this.conversationService.getOrCreateConversation(t.room.jid,"room");return await i}isFavoriteConversation(e){return this.favorites.find((t=>t.peerId===e))}moveFavoritePosition(e,t){try{const i=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.contactService.userContact.dbId}/favorites/${e}?position=${t}`,r=this.authService.getRequestHeader();fetch(i,{method:"PUT",headers:r}),this.logger.info(`[FavoriteService] moveFavoritePosition(${e}, ${t}) -- SUCCESS`)}catch(i){const r=`[FavoriteService] moveFavoritePosition(${e}, ${t}) -- FAILURE -- ${i.statusText}`;throw this.logger.error(r),new Error(r)}}async createFavorite(e,t,i){try{const n=new r.Favorite(e,t,i);if("room"===i?n.room=this.roomService.getRoomById(t):n.contact="directory"===i?await this.companyDirectoryService.getDirectoryContactById(t):"office365"===i?await this.office365AdService.getO365DirectoryContactById(t):await this.contactService.getContactByDBId(t),"room"!==i&&"directory"!==i&&"office365"!==i&&!n.contact)return this.removeServerFavorite(e),null;if("directory"!==i&&"office365"!==i){const e=n.room?n.room.jid:n.contact.jid,t=this.conversationService.getConversation(e);t&&(t.isFavorite=true,n.conv=t)}return n}catch(n){return this.logger.warn(`[FavoriteService] createFavorite(${e}, ${t}, ${i}) -- FAILURE -- ${n.message}`),null}}updateFavoriteConversations(e){const t=e.contact?e.contact.dbId:e.room.dbId,i=this.favorites.find((e=>e.peerId===t));i&&(e.isFavorite=true,i.conv=e)}async onXmppEvent(e){try{const t=$(e).find("favorite");if(t){const e=t.attr("id"),i=t.attr("type"),r=t.attr("peer_id"),n=t.attr("action");if("create"===n){let t=this.favorites.find((e=>e.peerId===r));t||(t=await this.createFavorite(e,r,i),t&&(this.favorites.push(t),this.logger.info(`[FavoriteService] onXmppEvent -- createFavorite(${e}, ${r}, ${i})`),this.sendEvent("ON_FAVORITE_CREATED",{favorite:t})))}else if("delete"===n){const e=this.favorites.findIndex((e=>e.peerId===r));if(-1!==e){const t=this.favorites[e];t.conv&&(t.conv.isFavorite=false),this.favorites.splice(e,1),this.logger.info(`[FavoriteService] onXmppEvent -- deleteFavorite(${t.id})`),this.sendEvent("ON_FAVORITE_DELETED",{favoriteId:t.id})}}else if("update"===n){const i=parseInt(t.attr("position"),10),r=this.favorites.findIndex((t=>t.id===e));-1!==r&&(this.favorites.splice(i,0,this.favorites.splice(r,1)[0]),this.logger.info(`[FavoriteService] onXmppEvent -- deleteFavorite(${e})`),this.sendEvent("ON_FAVORITE_UPDATED",{favoriteId:e,position:i}))}}return true}catch(t){return true}}updateFavoriteContact(e,t){e&&(e.updateContact(t),this.sendEvent("ON_FAVORITE_CONTACT_UPDATED",e))}searchAndUpdateFavoriteContact(e){const t=this.favorites.find((t=>t.peerId===e.id));t&&(t.updateContact(e),this.sendEvent("ON_FAVORITE_CONTACT_UPDATED",t))}sendEvent(e,t){const i=new CustomEvent(e,{detail:t});window.dispatchEvent(i),this.rxSubject.next({name:e,data:t})}attachHandlers(){this.xmppManagementHandler&&this.xmppService.deleteHandler(this.xmppManagementHandler),this.xmppManagementHandler=this.xmppService.addHandler((e=>(this.onXmppEvent(e),true)),null,"message","management")}}t.FavoriteService=f},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7),n=i(18),s=i(65),o=i(13),a=i(4),c=i(6),l=i(8),d=i(14),u=i(62),h=i(17);class f{constructor(e=null,t=null,i=null,r=null,n=null){this.search=e,this.searchUserByLogin=t,this.searchUserByJid=i,this.searchUserByPhoneNumber=r,this.searchAllContacts=n}}class p{constructor(){this.centralizedService=null,this.authService=l.AuthService.getInstance(),this.profileService=d.ProfileService.getInstance(),this.contactService=c.ContactService.getInstance(),this.conversationService=u.ConversationService.getInstance(),this.logger=a.LoggerService.getInstance(),this.errorHelperService=o.ErrorHelperService.getInstance(),this.mainService=h.MainService.getInstance(),this._sdkApis=Object.keys(new f),this.companyContactsNumber=0,this.otherCompanyContactsNumber=0,this.rxSubject=new r.Subject}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.directoryService||(e.rainbow.directoryService=new p),e.rainbow.directoryService}async start(){try{this.logger.info("[DirectoryService] === STARTING ==="),this.centralizedService=this.mainService.inject("centralizedService"),this.logger.info("[DirectoryService] === STARTED ===")}catch(e){this.logger.error("[DirectoryService] === STARTING FAILURE === "+e.message)}}async stop(){this.logger.info("[DirectoryService] === STOPPING ==="),this.logger.info("[DirectoryService] === STOPPED ===")}subscribe(e){return this.rxSubject.subscribe(e)}async search(e,t=false,i=20,r="",o=null){this.logger.info("[DirectoryService] search -- search Contact with text "+s.default(e));try{const n=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.SEARCH_BY_TAGS)?"search=":"displayName=";let s=config.restServerUrl+"/api/rainbow/search/v1.0/users?limit="+i+"&"+n+encodeURIComponent(e);r&&(s+="&companyId="+encodeURIComponent(r)),o&&(s+="&excludeCompanyId="+encodeURIComponent(o));const a=this.authService.getRequestHeader(),c=await fetch(s,{method:"GET",headers:a});if(!c.ok)throw c;const l=(await c.json()).data;this.logger.info(`[DirectoryService] search -- search on server find ${l.length} contact(s)`),o?this.otherCompanyContactsNumber=l.length:this.companyContactsNumber=l.length;let d=[];if(l.forEach((e=>{if(this.contactService.isUserContactJid(e.jid_im))return void this.logger.info(`[DirectoryService] search -- contact ${e.jid_im} ignored`);let t=this.contactService.getContact(e.jid_im);t?t.updateFromUserData(e):(t=this.contactService.createBasicContact(e.jid_im),t.updateFromUserData(e),t.getAvatar(),this.contactService.dbContacts[e.id]=t,this.contactService.jtelContacts[t.jidtel]=t),t.tags=e.tags,t.dbId=e.id,this.contactService.updateContactRichStatus(t),this.conversationService.computeCapabilitiesForContact(t,false),d.push(t)})),t){const t=this.contactService.searchContacts(e);d=d.concat(t.filter((e=>e.roster&&d.indexOf(e)<0)))}return d.sort((function(e,t){return e._displayName<t._displayName?-1:1})),this.logger.info(`[DirectoryService] search -- Sorted contacts contains ${d.length} contact(s)`),d}catch(a){const e=await this.errorHelperService.getErrorInfo(a,"search");throw this.logger.error("[DirectoryService] search failure -- "+e.error.message),a.data&&401===a.data.errorCode&&this.rxSubject.next(n.RBEvent.create("ON_SESSION_EXPIRED_NOTIFICATION_EVENT")),e.error}}getCompanyContactsNumber(){return this.companyContactsNumber}getOtherCompanyContactsNumber(){return this.otherCompanyContactsNumber}async searchUserByLogin(e){this.logger.info(`[DirectoryService] searchUserByLogin with "${s.default(e)}"`);try{const t=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/loginEmails",i=this.authService.getPostHeader(),r=JSON.stringify({loginEmail:[e]}),n=await fetch(t,{method:"POST",headers:i,body:r});if(!n.ok)throw n;const s=(await n.json()).data;if(this.logger.info(`[DirectoryService] searchUserByLogin -- Search found ${s.length} contact(s)`),1===s.length){const t=await this.contactService.getOrCreateContact(s[0].jid_im);return t.loginEmail=e,t}return null}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"searchUserByLogin");throw this.logger.error("[DirectoryService] searchUserByLogin failure -- "+e.error.message),t.data&&401===t.data.errorCode&&this.rxSubject.next(n.RBEvent.create("ON_SESSION_EXPIRED_NOTIFICATION_EVENT")),e.error}}async searchUserByJid(e){this.logger.info(`[DirectoryService] searchUserByJid with "${s.default(e)}"`);try{const t=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/jids/"+encodeURIComponent(e),i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;const n=(await r.json()).data;if(n){this.logger.info("[DirectoryService] searchUserByJid -- Search found 1 user");const t=await this.contactService.getOrCreateContact(e);return t.updateFromUserData(n),t}return this.logger.info("[DirectoryService] searchUserByJid -- Search found 0 user"),null}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"searchUserByJid");throw this.logger.error("[DirectoryService] searchUserByJid failure -- "+e.error.message),t.data&&401===t.data.errorCode&&this.rxSubject.next(n.RBEvent.create("ON_SESSION_EXPIRED_NOTIFICATION_EVENT")),e.error}}async searchUserByPhoneNumber(e){this.logger.info(`[DirectoryService] searchUserByPhoneNumber with "${e}"`);try{const t=config.restServerUrl+"/api/rainbow/search/v1.0/phone-numbers/"+e+"/users",i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;const n=(await r.json()).data;if(n){this.logger.info("[DirectoryService] searchUserByPhoneNumber -- Search found 1 user");return await this.contactService.getOrCreateContact(n.jid_im)}return this.logger.info("[DirectoryService] searchUserByPhoneNumber -- Search found 0 user"),null}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"searchUserByPhoneNumber");throw this.logger.error("[DirectoryService] searchUserByPhoneNumber failure -- "+e.error.message),t.data&&401===t.data.errorCode&&this.rxSubject.next(n.RBEvent.create("ON_SESSION_EXPIRED_NOTIFICATION_EVENT")),e.error}}async searchAllContacts(e,t=20,i="",r=true,n=true,s=null){this.logger.info(`[DirectoryService] searchAllContacts with text "${e}"`);try{let o=[];r&&(o=this.contactService.searchContacts(e));const a=await this.search(e,false,t,i,s);if(o=o.concat(a.filter((e=>!e.roster||o.indexOf(e)<0))),this.logger.info(`[DirectoryService] searchAllContacts with text "${e}" - Found contacts = ${o.length}`),n&&this.centralizedService&&this.centralizedService.outlook){const[t,i]=await Promise.all([this.searchOutlookUsersByEmail(e),this.searchOutlookUsersByName(e)]);let r=this.centralizedService.outlook.mergeOutlookContact(t,i);r=this.adaptOutlookContacts(r),o=o.concat(r),this.logger.info(`[DirectoryService] searchAllContacts with text "${e}" including outlook contacts - Found contacts = ${o.length}`)}return o}catch(o){const e=await this.errorHelperService.getErrorInfo(o,"searchAllContacts");throw this.logger.error("[DirectoryService] searchAllContacts failure -- "+e.error.message),e.error}}adaptOutlookContacts(e){return e&&e.length&&e.forEach((e=>{e.photo&&e.photo.src?e.avatar=e.photo:e.photo&&(e.avatar=new Image,e.avatar.src=e.photo),e.businessPhones=[],e.businessPhone&&e.businessPhones.push(e.businessPhone),e.mobilePhone&&(e.mobilePhones=[],e.mobilePhones.push(e.mobilePhone)),e.homePhone&&(e.otherPhoneNumbers=e.homePhone),e.emailAddress&&(e.email=e.emailAddress),e.outlookFlag=true})),e}async searchOutlookUsersByName(e){if(this.centralizedService&&this.centralizedService.outlook)try{return await this.centralizedService.outlook.searchByNameWithAvatar(e,2)}catch{return this.logger.warn("[DirectoryService] searchOutlookUsersByName - Outlook service unavailable"),[]}return[]}async searchOutlookUsersByEmail(e){if(this.centralizedService&&this.centralizedService.outlook)try{return await this.centralizedService.outlook.searchByEmailWithAvatar(e,2)}catch{return this.logger.warn("[DirectoryService] searchOutlookUsersByEmail - Outlook service unavailable"),[]}return[]}}t.DirectoryService=p},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});t.ContactSDK=class{constructor(e){this.id=e.dbId||e.id,this.status=e.status,this.loginEmail=e.loginEmail,this.email=e.email,this.lastname=e.lastname,this.firstname=e.firstname,this.fullname=e._displayName,this.nickname=e.nickname,this.initials=e.initials,this.title=e.title,this.jobTitle=e.jobTitle,this.language=e.language,this.country=e.country,this.tags=e.tags,this.internalPhoneNumber=e.phoneInternalNumber,this.professionalPhoneNumber=e.phonePro,this.personalPhoneNumber=e.phonePerso,this.personalMobilePhoneNumber=e.mobilePerso,this.professionalMobileNumber=e.mobilePro,this.professionalMobileNumberCan=e.mobileProCan,this.voicemailNumber=e.voiceMailNumber,this.roles=e.roles,this.customData=e.customData,this.pbxId=e.pbxId,this.displayOrder=e.displayOrder,this.avatar=e.avatarSrc,this.userInfo1=e.userInfo1,this.userInfo2=e.userInfo2,this.company=e.company,this.businessPhones=e.businessPhones,this.mobilePhones=e.mobilePhones,this.isAlertNotificationEnabled=e.isAlertNotificationEnabled,this.calendarInformation=e.calendarState,this.fileSharingEnabled=e.fileSharingEnabled,this.fileStorageEnabled=e.fileStorageEnabled,this.instantMessagesEnabled=e.instantMessagesEnabled,this.bubblesEnabled=e.roomsEnabled,this.webrtcAudioEnabled=e.webrtcAudioEnabled,this.webrtcVideoEnabled=e.webrtcVideoEnabled,this.webrtcSharingEnabled=e.webrtcSharingEnabled,this.modifyProfileEnabled=e.modifyProfileEnabled}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(11),n=i(24),s=i(4),o=i(8),a=i(63),c=i(13),l=i(9),d=i(17);class u{constructor(){this.eventService=r.EventService.getInstance(),this.logger=s.LoggerService.getInstance(),this.authService=o.AuthService.getInstance(),this.userInfoService=a.UserInfoService.getInstance(),this.xmppService=l.XmppService.getInstance(),this.errorHelperService=c.ErrorHelperService.getInstance(),this.companies={},this.xmppService.subscribeToConnectionEvents((e=>{"ON_XMPP_DISCONNECTED"===e.name&&"LOGOUT"===e.data.reason&&(this.companies={})})),setTimeout((()=>{this.configure()}),500)}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.companyService||(e.rainbow.companyService=new u),e.rainbow.companyService}configure(){this.eventService.subscribe("ON_COMPANY_CHANGE_EVENT",((e,t)=>{this.getCompanyById(t,true)}))}async getCompanyById(e,t=false){try{if(!e)throw new Error("missing companyId");let i=this.companies[e];if(i&&!t)return this.logger.info("[companyService] getCompanyById (cache) "+e+" - success"),i;const r=this.authService.getRequestHeader();let s=`${config.restServerUrl}/api/rainbow/enduser/v1.0/companies/${e}`;s+="?selectedThemeObj=true";const o=await fetch(s,{method:"GET",headers:r});if(!o.ok)throw new Error(o.statusText);const a=await o.json();return i?(i.updateFromData(a.data),this.logger.info(`getCompanyById (update) ${e} - success`)):(i=n.Company.createFromData(a.data),this.companies[i.id]=i,this.logger.info(`getCompanyById ${e} - success`)),this.getCompanyLogo(i),this.getCompanyBanner(i),i}catch(i){const e="getCompanyById -- FAILURE -- "+i.message;throw this.logger.error(e),new Error(e)}}async searchCompanies(e,t=null,i=null,r=null){try{let s=`${config.restServerUrl}/api/rainbow/enduser/v1.0/companies?name=${encodeURIComponent(e)}&format=full`;null!=t&&(s+="&hasBP="+t),null!=i&&(s+="&isBP="+i),r&&(s+="&bpType="+r);const o=this.authService.getRequestHeader(),a=await fetch(s,{method:"GET",headers:o});if(!a.ok)throw new Error(a.statusText);const c=await a.json(),l=c.data.reduce(((e,t)=>{if("Default"!==t.name&&"Rainbow"!==t.name&&"active"===t.status){let i=this.companies[t.id];i||(i=n.Company.createFromData(t),this.companies[i.id]=i,this.getCompanyLogo(i)),e.push(i)}return e}),[]);return this.logger.info("searchCompanies with criteria '"+e+"' - success - found "+c.length+" companies : returns "+l.length+" companies"),l}catch(s){const e="searchCompanies -- FAILURE -- "+s.message;throw this.logger.error(e),new Error(e)}}async getCompanyAdminsData(e){try{let t=`${config.restServerUrl}/api/rainbow/enduser/v1.0/companies/${e}/administrators`;t+="?selectedThemeObj=true";const i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw new Error(r.statusText);return(await r.json()).data}catch(t){const e="getCompanyAdminsData -- FAILURE -- "+t.message;throw this.logger.error(e),new Error(e)}}async getCompanyUsers(e,t){try{const i=`${config.restServerUrl}/api/rainbow/search/v1.0/users?companyId=${e}&limit=${t}`,r=this.authService.getRequestHeader(),n=await fetch(i,{method:"GET",headers:r});if(!n.ok)throw new Error(n.statusText)}catch(i){const e="getCompanyUsers -- FAILURE -- "+i.message;throw this.logger.error(e),new Error(e)}}async getCompanyLogo(e){try{const t=this.userInfoService.computeUserColor(e.name),i=e.name.substr(0,1);return e.logo=this.userInfoService.getAvatarImage(e.id,i,t.color,130,e.lastAvatarUpdateDate),this.eventService.publish("ON_COMPANY_LOGO_UPDATED",e.id),this.logger.info("[getCompanyLogo] - "+e.getNameForLogs()+" - success"),e.sendChangeEvent("logo"),e}catch(t){throw new Error("getCompanyLogo -- FAILURE -- "+t.message)}}async getCompanyBanner(e){return new Promise((t=>{const i=new Image;i.onload=()=>{e.banner=i,this.eventService.publish("ON_COMPANY_BANNER_UPDATED",e.id),this.logger.info("[getCompanyBanner] - "+e.getNameForLogs()+" - success"),t(e)},i.onerror=()=>{this.logger.error("[companyService] Load banner for "+e.getNameForLogs()+" failure"),t(e)};let r=this.authService.fromSDK?null:"/cacheV2/images/company-banner-01.svg";if(e.lastBannerUpdateDate){r=config.webservices.protocol+"://"+config.webservices.currentServer+"/api/banner/"+e.id+"?size=831",r+="&update="+d.MainService.MD5(e.lastBannerUpdateDate)}r?i.src=r:t(e)}))}async getImageMimeType(e){try{if(!e)return null;const t=await fetch(e);if(!t.ok)throw new Error(t.statusText);return(await t.blob()).type}catch(t){const e="getImageMimeType -- FAILURE -- "+t.message;return this.logger.error(e),null}}async getCompanyFeatures(e){try{const t={alertNotifAllowed:false,webinarAccess:false},i=`${config.restServerUrl}/api/rainbow/subscription/v1.0/companies/${e.id}/subscriptions/features`,r=this.authService.getRequestHeader(),n=await fetch(i,{method:"GET",headers:r});if(!n.ok)throw new Error(n.statusText);const s=(await n.json()).data,o=s.find((e=>"ALERT_NOTIFICATIONS_ALLOWED"===e.featureUniqueRef));o&&(t.alertNotifAllowed=o.isEnabled);const a=s.find((e=>"WEBINAR_ACCESS"===e.featureUniqueRef));return a&&(t.webinarAccess=a.isEnabled),t}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getCompanyFeatures");return this.logger.warn("[companyService] "+e.message),{}}}}t.CompanyService=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(6),n=i(8),s=i(14),o=i(4);class a{constructor(){this.authService=n.AuthService.getInstance(),this.contactService=r.ContactService.getInstance(),this.profileService=s.ProfileService.getInstance(),this.logger=o.LoggerService.getInstance()}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.phonebookService||(e.rainbow.phonebookService=new a),e.rainbow.phonebookService}async search(e){if(!this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_PHONE_BOOK))return[];this.logger.info("search PBXContact from phonebook with pattern "+e);try{const t=`${config.restServerUrl}/api/rainbow/search/v1.0/phonebooks?limit=20&name=${encodeURIComponent(e)}`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",mode:"cors",headers:i}),n=(await r.json()).phoneBooks;return n.map((e=>{const t=this.contactService.createBasicContact("",e.number);return t.updateName(e.firstName,e.lastName),t.getAvatar(),t}))}catch(t){return this.logger.info(`search PBXContact from phonebook with pattern ${e} --- FAILURE --- ${t.message}`),[]}}async searchByNumber(e){if(!this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_PHONE_BOOK))return null;this.logger.info("searchByNumber PBXContact from phonebook with pattern "+e);try{const t=`${config.restServerUrl}/api/rainbow/search/v1.0/phonebooks?number=${encodeURIComponent(e)}`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",mode:"cors",headers:i}),n=(await r.json()).phoneBooks[0],s=this.contactService.createBasicContact("",e);return n?s.updateName(n.firstName,n.lastName):s.updateName("",e),s.getAvatar(),s}catch(t){return this.logger.info(`searchByNumber PBXContact from phonebook with pattern ${e} --- FAILURE --- ${t.message}`),null}}}t.PhonebookService=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(6),n=i(9),s=i(4),o=i(11),a=i(28),c=i(452),l=i(18),d=i(43),u=i(34),h=i(19),f=i(17);class p{constructor(){this.xmppService=n.XmppService.getInstance(),this.logger=s.LoggerService.getInstance(),this.contactService=r.ContactService.getInstance(),this.eventService=o.EventService.getInstance(),this.webrtcConfigAndUtils=d.WebrtcConfigAndUtils.getInstance(),this.webrtcP2PService=u.WebrtcP2PService.getInstance(),this.settingsService=h.SettingsService.getInstance(),this.mainService=f.MainService.getInstance(),this.webConferenceServiceV2=null,this.telephonyService=null,this.roomService=null,this.nameSpaceJingle="urn:xmpp:jingle-message:0",this.messageHandlerRef=null,this.nameSpaceRbVoice="urn:xmpp:jingle:apps:rtp:info:1",this.messageHandlerRbVoiceRef=null,this.xmppServiceSubscription=null,this.xmppConnectionSubscription=null,this.started=false}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.webrtcGlobalEventHandlerService||(e.rainbow.webrtcGlobalEventHandlerService=new p),e.rainbow.webrtcGlobalEventHandlerService}start(){this.webConferenceServiceV2=this.mainService.inject("webConferenceServiceV2"),this.telephonyService=this.mainService.inject("telephonyService"),this.roomService=this.mainService.inject("roomService"),this.started=true,this.xmppConnectionSubscription=this.xmppService.subscribeToConnectionEvents((e=>{this.onConnectionStateChangeEvent(e)})),this.xmppService.started&&(this.xmppServiceSubscription&&(this.xmppServiceSubscription.unsubscribe(),this.xmppServiceSubscription=null),this.xmppServiceSubscription=this.xmppService.connection.jingle.rxSubject.subscribe((e=>{this.onJingleMessage(e)}))),this.attachHandlers()}stop(){this.started=false,this.removeHandlers(),this.xmppServiceSubscription&&this.xmppServiceSubscription.unsubscribe(),this.xmppConnectionSubscription&&this.xmppConnectionSubscription.unsubscribe()}reconnect(){}attachHandlers(){this.removeHandlers(),this.logger.info("[WebrtcGlobalEventHandlerService] attachHandlers"),this.messageHandlerRef||(this.messageHandlerRef=this.xmppService.addHandler((e=>{try{return this.onMessageReceived(e),true}catch(dp){return this.logger.error("[WebrtcGlobalEventHandlerService] caught error "+dp),true}}),this.nameSpaceJingle,"message")),this.messageHandlerRbVoiceRef||(this.messageHandlerRbVoiceRef=this.xmppService.addHandler((e=>{try{return this.onMessageReceivedRef2(e),true}catch(dp){return this.logger.error("[WebrtcGlobalEventHandlerService] caught error HandlerRef 2 : "+dp),true}}),this.nameSpaceRbVoice,"message"))}onConnectionStateChangeEvent(e){"ON_XMPP_CONNECTED"===e.name&&(this.logger.log("[WebrtcGlobalEventHandlerService] onConnectionStateChangeEvent : connected"),this.xmppServiceSubscription&&(this.xmppServiceSubscription.unsubscribe(),this.xmppServiceSubscription=null),this.xmppServiceSubscription=this.xmppService.connection.jingle.rxSubject.subscribe((e=>{this.onJingleMessage(e)})),this.attachHandlers())}removeHandlers(){this.logger.info("[WebrtcGlobalEventHandlerService] removeHandlers"),this.messageHandlerRef&&(this.xmppService.deleteHandler(this.messageHandlerRef),this.messageHandlerRef=null),this.messageHandlerRbVoiceRef&&(this.xmppService.deleteHandler(this.messageHandlerRbVoiceRef),this.messageHandlerRbVoiceRef=null)}onJingleMessage(e){try{switch(e.name){case"jingleSessionInvitation":this.onJingleSessionInvite(e.data.sid);break;case"iceconnectionstatechange.jingle":this.onJingleConnectionStateChange(e.data.sid,e.data.session);break;case"callterminated.jingle":this.onSessionTerminated(e.data.sid,e.data.reason);break;case"webrtcSessionStatsSimplyfied.jingle":this.onJingleSessionStatsSimplified(e.data.sid,e.data.data);break;case"webrtcFirefoxStats.jingle":this.onJingleFirefoxSessionStats(e.data.sid,e.data.data);break;case"webrtcSessionStats.jingle":this.onJingleChromeSessionStats(e.data.sid,e.data.stats);break;case"webrtcConnectionType.jingle":this.webrtcConnectionTypeStats(e.data.sid,e.data.data);break;case"jingleP2PUpdateStream":this.jingleP2PUpdateStream(e.data.sid);break;case"error.jingle":this.onJingleError(e.data.sid,e.data.error);break;case"transportreplace.jingle":this.onJingleTransportReplace(e.data.sid);break;case"ringing.jingle":this.onJingleRingingEvent(e.data.sid);break;case"callaccepted.jingle":this.onJingleCallAccepted(e.data.sid);break;case"hold.jingle":this.onJingleHoldEvent(e.data.sid);break;case"unhold.jingle":this.onJingleUnholdEvent(e.data.sid);break;case"remotestreamremoved.jingle":this.onJingleRemoteStreamsRemoved(e.data.sid);break;case"remotestreamadded.jingle":this.onJingleRemoteStreamAddedEvent(e.data.sid,e.data.nbAudioTracks);break;case"mediamodified.jingle":this.onJingleMediaModifiedEvent(e.data.sid,e.data.mediaType);break;case"refer.jingle":this.onJingleSessionRefer(e.data.sid,e.data.status,e.data.confEndpointId,e.data.referTo,e.data.method,e.data.otherSid)}}catch(t){this.logger.info("[WebrtcGlobalEventHandlerService] onJingleMessage -- failure -- "+e.name)}}onMessageReceived(e){const t=c(e).attr("from"),i=this.xmppService.getBareJidFromJid(t),r=c(e).find("propose").find("conference").attr("id"),n=this.webConferenceServiceV2?this.webConferenceServiceV2.getActiveWebConferenceSession():null;if(n&&n.id===r)try{this.logger.info("[WebrtcGlobalEventHandlerService]   | onMessageReceived");if(c(e).find("propose").length>0){const t=c(e).find("propose").attr("id"),r=$msg({from:this.contactService.userContact.fullJid,to:this.contactService.userContact.jid}).c("accept",{xmlns:this.nameSpaceJingle,id:t});this.xmppService.send(r);const n=$msg({from:this.contactService.userContact.fullJid,to:i}).c("proceed",{xmlns:this.nameSpaceJingle,id:t});return this.xmppService.send(n),true}}catch(s){return this.webrtcP2PService.webrtcP2PEventHandler.onMessageReceived(e)}return!!r||this.webrtcP2PService.webrtcP2PEventHandler.onMessageReceived(e)}async onMessageReceivedRef2(e){this.logger.info("[WebrtcGlobalEventHandlerService]   | onMessageReceivedRef2");const t=c(e).find("refer"),i=c(e).find("error");if(i&&i.length)this.logger.info("[WebrtcGlobalEventHandlerService]   | onMessageReceivedRef2 -- error stanza received, do nothing");else if(t){const t=c(e).find("refer").attr("confEndpointId"),i=c(e).find("refer").attr("referTo"),r=c(e).find("refer").attr("status"),n=c(e).attr("from"),s=c(e).find("refer").attr("telCallId")?c(e).find("refer").attr("telCallId"):null;let o=null,d=null;const u=false,h=this.webrtcP2PService.getMediaPillarAudioCalls();if(s){if(!this.telephonyService)return void this.logger.info("[WebrtcGlobalEventHandlerService] | missing telephony service !!!");if(d=this.telephonyService.calls[s],!(h&&h.length&&d))return void this.logger.info("[WebrtcGlobalEventHandlerService] | onMessageReceivedRef2 : Not my callId then Ignore");o=this.telephonyService.calls[s]}else{if(d=h&&h.length?h[0]:void 0,!d||!d.contact||d.contact.jid!==this.xmppService.getBareJidFromJid(n))return void this.logger.info("[WebrtcGlobalEventHandlerService] | onMessageReceivedRef2 : Not my call then Ignore");if(!this.telephonyService)return void this.logger.info("[WebrtcGlobalEventHandlerService] | missing telephony service !!!");o=this.telephonyService.getActiveCall()}if(t&&i&&"complete"!==r){if(this.roomService){let e=this.roomService.getRoomById(t);if(!e)try{e=await this.roomService.getServerRoom(t)}catch{this.logger.warn("[WebrtcGlobalEventHandlerService] | adhoc conference v1 type")}if(e&&e.isWebConferenceV2Room()){e.rxSubject.next(l.RBEvent.create("ROOM_CONFERENCE_START_EVENT")),await this.webConferenceServiceV2.transferP2pCallToConference(null,i,e,false,u);const t="urn:xmpp:jingle:apps:rtp:info:1";return this.xmppService.send($msg({from:this.contactService.userContact.fullJid,to:n}).c("refer",{xmlns:t,status:"complete",telCallId:s})),void this.eventService.publish("ON_WEBCONF_ADD_HOC_COMPLETED",e)}}}else"complete"===r&&(this.logger.info("[WebrtcGlobalEventHandlerService]   | onMessageReceivedRef2 : refer complete received"),!o||o.status!==a.Call.Status.ACTIVE&&o.status!==a.Call.Status.HOLD||(this.logger.info("[WebrtcGlobalEventHandlerService]   | onMessageReceivedRef2 : callId to release : "+s),this.telephonyService.releaseCall(o)))}}checkSessionAudioReceivedHealthStatus(e){this.logger.info("[WebrtcGlobalEventHandlerService]   | checkSessionAudioReceivedHealthStatus --- user hears nothing !");const t=this.webrtcP2PService.calls[e];t&&!t.isInCallWithMediaPillar()&&t.status.key===a.Call.Status.ACTIVE.key&&t.remoteMedia&a.Call.Media.AUDIO&&(this.webrtcConfigAndUtils.callsStatsSimplified[e].errorAudioReceived=1,this.logger.info("[WebrtcGlobalEventHandlerService]   | checkSessionAudioReceivedHealthStatus --- reset output device"),this.webrtcP2PService.resetAudioOutputElement())}onJingleSessionInvite(e){this.logger.info("[WebrtcGlobalEventHandlerService]  | callincoming.jingle "+e);const t=this.xmppService.connection.jingle.sessions[e];if(t&&t.confId);else if(t.replaceSid){this.logger.info("[WebrtcGlobalEventHandlerService]  | callincoming.jingle -- webrtc to webrtc transfer call case");const i=this.webrtcP2PService.calls[t.replaceSid];i&&this.webrtcP2PService.terminateAndRemoveCall(i),this.webrtcP2PService.webrtcP2PEventHandler.onIncomingTrasferredCall(e)}else this.webrtcP2PService.webrtcP2PEventHandler.incomingCall(e)}onSessionTerminated(e,t=""){const i=t||"";if(this.logger.info("[WebrtcGlobalEventHandlerService]  | callterminated "+e+" reason: "+i),"multi-device"===t);else{this.webrtcP2PService.calls[e]&&this.webrtcP2PService.webrtcP2PEventHandler.terminatedCall(e,i,false)}}onJingleConnectionStateChange(e,t){if(!t.peerconnection)return void this.logger.info("[WebrtcGlobalEventHandlerService]  | iceconnectionstatechange - peerConnection does not exist anymore !!!");this.webrtcP2PService.calls[e]&&this.webrtcP2PService.webrtcP2PEventHandler.iceConnectionStateChange(e,t)}onJingleError(e,t){if(this.logger.error("[WebrtcGlobalEventHandlerService]  | on jingle callerror"),t&&this.logger.error(JSON.stringify(t)),e){this.webrtcP2PService.calls[e]&&this.webrtcP2PService.webrtcP2PEventHandler.onJingleError(e)}}onJingleSessionStatsSimplified(e,t){if(this.webrtcConfigAndUtils.callsStatsSimplified[e]||(this.webrtcConfigAndUtils.callsStatsSimplified[e]={},this.webrtcConfigAndUtils.callsStatsSimplified[e].errorAudioReceived=0),t.errorAudioReceived=this.webrtcConfigAndUtils.callsStatsSimplified[e].errorAudioReceived,t.networkQualityIteration=this.webrtcConfigAndUtils.callsStatsSimplified[e].networkQualityIteration,t.conferenceId){if(t.publisherId&&t.conferenceId)if(this.webrtcConfigAndUtils.callsStatsSimplified[e].publisherJidIm)t.publisherJidIm=this.webrtcConfigAndUtils.callsStatsSimplified[e].publisherJidIm;else{if(this.webConferenceServiceV2?this.webConferenceServiceV2.webConferenceSessions[t.conferenceId]:null){const i=this.contactService.getContactById(t.publisherId);t.publisherJidIm=i?i.jid:"",this.webrtcConfigAndUtils.callsStatsSimplified[e].publisherJidIm=t.publisherJidIm}}this.logger.info("[WebrtcGlobalEventHandlerService] on webrtcSessionStatsSimplyfied for session "+e+" related to conferenceID "+t.conferenceId+" : "+JSON.stringify(t))}else this.logger.info("[WebrtcGlobalEventHandlerService] on webrtcSessionStatsSimplyfied for session "+e+" : "+JSON.stringify(t));this.webrtcConfigAndUtils.callsStatsSimplified[e]=t,t.packetsAudioReceived&&0===t.audioOutputLevel&&0===t.errorAudioReceived&&this.checkSessionAudioReceivedHealthStatus(e);const i=this.webrtcP2PService.calls[e];i&&(this.webrtcConfigAndUtils.callsStatsSimplified[e].networkQualityFlag===i.networkQuality?(this.webrtcConfigAndUtils.callsStatsSimplified[e].networkQualityIteration=this.webrtcConfigAndUtils.callsStatsSimplified[e].networkQualityIteration?this.webrtcConfigAndUtils.callsStatsSimplified[e].networkQualityIteration+1:1,0===i.networkQuality&&this.webrtcConfigAndUtils.callsStatsSimplified[e].networkQualityIteration>=3&&i.publish("badNetworkQuality",i.networkQuality)):this.webrtcConfigAndUtils.callsStatsSimplified[e].networkQualityIteration=1,i.networkQuality=t.networkQualityFlag,i.publish("networkQuality",i.networkQuality))}webrtcConnectionTypeStats(e,t){t&&(this.logger.info("[WebrtcGlobalEventHandlerService] Local candidate ("+t.localAddress+") type is "+t.localCandidateType+" for session: "+e),this.logger.info("[WebrtcGlobalEventHandlerService] Remote candidate  ("+t.remoteAddress+") type is "+t.remoteCandidateType+" for session: "+e),t.networkType&&this.logger.info("[WebrtcGlobalEventHandlerService] Network type is "+t.networkType+" for session: "+e))}onJingleFirefoxSessionStats(e,t){this.webrtcConfigAndUtils.callsStats[e]||(this.webrtcConfigAndUtils.callsStats[e]={}),this.webrtcConfigAndUtils.callsStats[e]||(this.webrtcConfigAndUtils.callsStats[e]={});if(this.webrtcP2PService.calls[e]){const i=this.webrtcConfigAndUtils.callsStats[e];i&&(t.videoReceived?i.video=t:i.audio=t,this.webrtcConfigAndUtils.callsStats[e]=i)}}onJingleChromeSessionStats(e,t){this.webrtcConfigAndUtils.callsStats[e]||(this.webrtcConfigAndUtils.callsStats[e]={}),this.webrtcConfigAndUtils.callsStats[e]||(this.webrtcConfigAndUtils.callsStats[e]={});const i=this.webrtcConfigAndUtils.callsStats[e].id;this.webrtcConfigAndUtils.callsStats[e]=t,this.webrtcConfigAndUtils.callsStats[e].id=i}async onJingleSessionRefer(e,t,i,r,n,s){this.logger.info("[WebrtcGlobalEventHandlerService]  | refer: "+e+" - status: "+t+" - confEndpointId: "+i+" - referTo: "+r+" - method: "+n);const o=this.xmppService.connection.jingle.sessions[e];if("complete"===t){const t=this.webrtcP2PService.calls[e];this.webrtcP2PService.onCallTransferred(t)}else if(o){const t=this.webrtcP2PService.calls[e];if(i){const n=t&&t.isMuted;if(this.roomService){let t=this.roomService.getRoomById(i);if(!t)try{t=await this.roomService.getServerRoom(i)}catch{this.logger.warn("[WebrtcGlobalEventHandlerService] | adhoc conference v1 type")}if(t&&t.isWebConferenceV2Room())return t.rxSubject.next(l.RBEvent.create("ROOM_CONFERENCE_START_EVENT")),await this.webConferenceServiceV2.transferP2pCallToConference(o,r,t,false,n),this.webrtcP2PService.sendReferStatus(e,"complete"),void this.eventService.publish("ON_WEBCONF_ADD_HOC_COMPLETED",t)}}else r&&s?(this.logger.debug(`[WebrtcGlobalEventHandlerService]  | refer.jingle -- transfer call is requested for session ${e} to contact ${r}`),await this.webrtcP2PService.webrtcP2PEventHandler.onTrasferCallEvent(r,s),this.webrtcP2PService.onCallTransferred(t),this.webrtcP2PService.sendReferStatus(e,"complete")):n&&r?this.onCallBlindTransfer(t,{method:n,referTo:r}):this.logger.error("[WebrtcGlobalEventHandlerService]  | refer.jingle -- wrong parameters ")}else this.logger.error("[WebrtcGlobalEventHandlerService]  | refer.jingle -- no session ")}onCallBlindTransfer(e,t){if(t)if(this.webrtcP2PService.releaseCall(e),"webrtc"===t.method){this.logger.info("[WebrtcGlobalEventHandlerService] | onCallBlindTransfer webrtc");const e=this.contactService.getContactByJid(t.referTo);e?this.webrtcP2PService.makeCall(e,"WebRTCAudio"):(this.logger.info("[WebrtcGlobalEventHandlerService] | onCallBlindTransfer ERROR"),this.logger.error("unknow contact"))}else if("pbx"===t.method){if(this.logger.info("[WebrtcGlobalEventHandlerService] | onCallBlindTransfer sip"),!this.telephonyService)return void this.logger.error("[WebrtcGlobalEventHandlerService] -- missing telephony service !");this.telephonyService.makeCallByPhoneNumber(t.referTo)}else this.logger.info("[WebrtcGlobalEventHandlerService] | onCallBlindTransfer ERROR"),this.logger.error("wrong transfer Data");else this.logger.info("[WebrtcGlobalEventHandlerService] | onCallBlindTransfer ERROR"),this.logger.error("no transfer Data")}onJingleTransportReplace(e){const t=this.xmppService.connection.jingle.sessions[e];t?(this.logger.info("[WebrtcGlobalEventHandlerService]  | transportreplace.jingle "+e),t.sendAnswer(void 0,"transport-accept")):this.logger.warn("[WebrtcGlobalEventHandlerService]  | transportreplace.jingle no such session !")}onJingleRingingEvent(e){this.logger.info("[WebrtcGlobalEventHandlerService]  | callremoteringing "+e)}onJingleMediaModifiedEvent(e,t){this.logger.info("[WebrtcGlobalEventHandlerService]  | mediamodified "+e),this.webrtcP2PService.webrtcP2PEventHandler.mediaModified(e,t)}onJingleRemoteStreamAddedEvent(e,t=0){const i=this.xmppService.connection.jingle.sessions[e];if(i&&i.remoteStreams&&!i.confId){this.logger.info("[WebrtcGlobalEventHandlerService]  | remoteStreamadded "+e);const t=this.webrtcP2PService.calls[e];t&&this.webrtcP2PService.attachDistantMediaStreams(true,t),this.eventService.publish("ON_WEBRTC_REMOTE_STREAM_ADDED",i.remoteStreams)}t&&this.webrtcP2PService.resetAudioOutputElement()}onJingleRemoteStreamsRemoved(e){const t=this.webrtcP2PService.calls[e],i=this.xmppService.connection.jingle.sessions[e];t&&i&&(this.logger.info("[WebrtcGlobalEventHandlerService] | remotestreamremoved "+e),this.webrtcP2PService.attachDistantMediaStreams(true,t))}onJingleCallAccepted(e){const t=this.webrtcP2PService.calls[e],i=this.xmppService.connection.jingle.sessions[e];t&&i&&(this.logger.info("[WebrtcGlobalEventHandlerService] | callaccepted "+e),t.statsInterval&&(this.logger.info("[WebrtcGlobalEventHandlerService] | remove getStats interval"),window.clearInterval(t.statsInterval),t.statsInterval=null),this.webrtcConfigAndUtils.createOrUpdateStatisticsForCall(t),this.logger.info("[WebrtcGlobalEventHandlerService] | start getStats interval"),t.statsInterval=i.getStats(3e3))}onJingleHoldEvent(e){const t=this.xmppService.connection.jingle.sessions[e];if(!t)return void this.logger.info("[WebrtcGlobalEventHandlerService] | hold - received on a non existing session !");this.logger.info("[WebrtcGlobalEventHandlerService] | hold "+e);const i=this.webrtcP2PService.calls[e];if(i&&i.isMediaPillarCall()){const e={iceRestart:false};this.settingsService.getBooleanSetting("enableIceRestartOnHold")&&(e.iceRestart=true),t.peerconnection.getTransceivers&&t.peerconnection.getTransceivers().length?t.peerconnection.getTransceivers().forEach((function(e){e.direction="sendonly"})):(e.offerToReceiveAudio=false,t.reconnectionOptions={iceRestart:true,offerToReceiveAudio:false}),t.contentModify("audio",e)}else t.muteAudio(true),this.eventService.publish("ON_HOLD_TONE_EVENT","hold"),i&&(i.putOnHold=true,i.setStatus(a.Call.Status.PUT_ON_HOLD),this.eventService.publish("ON_CALL_UPDATED_EVENT",i))}onJingleUnholdEvent(e){const t=this.xmppService.connection.jingle.sessions[e];if(!t)return void this.logger.info("[WebrtcGlobalEventHandlerService] | unhold - received on a non existing session !");this.logger.info("[WebrtcGlobalEventHandlerService] | unhold "+e);const i=this.webrtcP2PService.calls[e];if(i&&i.isMediaPillarCall()){const e={iceRestart:false};this.settingsService.getBooleanSetting("enableIceRestartOnUnhold")&&(e.iceRestart=true),t.peerconnection.getTransceivers&&t.peerconnection.getTransceivers().length?t.peerconnection.getTransceivers().forEach((function(e){e.direction="sendrecv"})):(e.offerToReceiveAudio=true,t.reconnectionOptions=null),t.contentModify("audio",e)}else t.muteAudio(false),this.eventService.publish("ON_HOLD_TONE_EVENT","unhold"),i&&(i.putOnHold=false,t.muteAudio(i.isMuted),i.setStatus(a.Call.Status.ACTIVE),this.eventService.publish("ON_CALL_UPDATED_EVENT",i),this.webrtcP2PService.attachDistantMediaStreams(true,i))}jingleP2PUpdateStream(e){const t=this.webrtcP2PService.calls[e];t&&this.webConferenceServiceV2&&!this.webConferenceServiceV2.hasActiveWebConferenceSession()&&(this.logger.info("[WebrtcGlobalEventHandlerService] | jingleP2PUpdateStream for session "+e),this.webrtcP2PService.attachDistantMediaStreams(true,t))}}t.WebrtcGlobalEventHandlerService=p},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r extends Error{constructor(e=null,t=null,i=null,r=null){super(),this.name="RainbowError",this.message=e,this.details=t,this.detailsCode=i,this.detailsData=r}}t.RBError=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.isFunction=function(e){return"function"==typeof e}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});var r=i(133),n=i(157);t.empty={closed:true,next:function(e){},error:function(e){if(r.config.useDeprecatedSynchronousErrorHandling)throw e;n.hostReportError(e)},complete:function(){}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.hostReportError=function(e){setTimeout((function(){throw e}),0)}},function(e,t,i){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:true});var s=function(e){function t(t,i){var r=e.call(this)||this;return r.subject=t,r.subscriber=i,r.closed=false,r}return n(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=true;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var i=t.indexOf(this.subscriber);-1!==i&&t.splice(i,1)}}},t}(i(77).Subscription);t.SubjectSubscription=s},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{constructor(e){if(this.type=null,this.loginUrl=null,this.logoutUrl=null,this.safetyUrl=null,this.userId=null,e.length>0){let t={};t=1===e.length?e[0]:e.reduce(((e,t)=>"RAINBOW"===t.type&&"RAINBOW"!==e.type?(e.safetyUrl=t.url||t.loginUrl,e):(t.safetyUrl=e.url||e.loginUrl,t))),this.type=t.type,this.loginUrl=t.url||t.loginUrl,this.logoutUrl=t.logoutUrl,this.safetyUrl=t.safetyUrl}}static createFromData(e){return new r(e)}setParameter(e,t){switch(e){case"uid":this.userId=t();break;case"x-rainbow-app-auth":if("RAINBOW"!==this.type&&this.loginUrl){const i=new URL(this.loginUrl),r=t(i.searchParams.get("challenge"));i.searchParams.append(e,r),this.loginUrl=i.href}break;case"token":if("RAINBOW"!==this.type&&this.logoutUrl){const i=new URL(this.logoutUrl),r=t();i.searchParams.append(e,r),this.logoutUrl=i.href}break;case"safetyUrl":"RAINBOW"===this.type||this.safetyUrl||(this.safetyUrl=t())}}}t.AuthSettings=r},function(e,t,i){function r(e){this.message=e}i.r(t),i.d(t,"InvalidTokenError",(function(){return o})),r.prototype=new Error,r.prototype.name="InvalidCharacterError";var n="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new r("'atob' failed: The string to be decoded is not correctly encoded.");for(var i,n,s=0,o=0,a="";n=t.charAt(o++);~n&&(i=s%4?64*i+n:n,s++%4)?a+=String.fromCharCode(255&i>>(-2*s&6)):0)n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(n);return a};function s(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(n(e).replace(/(.)/g,(function(e,t){var i=t.charCodeAt(0).toString(16).toUpperCase();return i.length<2&&(i="0"+i),"%"+i})))}(t)}catch(i){return n(t)}}function o(e){this.message=e}o.prototype=new Error,o.prototype.name="InvalidTokenError",t.default=function(e,t){if("string"!=typeof e)throw new o("Invalid token specified");var i=true===(t=t||{}).header?0:1;try{return JSON.parse(s(e.split(".")[i]))}catch(r){throw new o("Invalid token specified: "+r.message)}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.default=(e=10)=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=t.length;let r="";for(let n=0;n<e;n++)r+=t.charAt(Math.floor(Math.random()*i));return r}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{static create(e,t){return new r(e,t)}constructor(e,t){this.id=e,this.body=t}}t.ReplaceMsg=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{constructor(e,t,i,r,n,s,o){this.id=null,this.name=null,this.isDefault=false,this.isExclusive=false,this.hasConference=false,this.isPrepaid=false,this.isDemo=false,this.id=e,this.name=t||"",this.isDefault=i,this.isExclusive=r,this.isPrepaid=n,this.hasConference=s,this.isDemo=o}static createFromProfileData(e){return new r(e.offerId,e.offerName,e.isDefault,e.isExclusive,e.isPrepaid,e.hasConference,e.isDemo)}static offerComparator(e,t){const i=["Essential","Business","Enterprise","Voice","Room","Conference"];if(e.isEssential())return-1;if(t.isEssential())return 1;if(e.isDemo&&!t.isDemo)return-1;if(!e.isDemo&&t.isDemo)return 1;if(e.hasConference&&!t.hasConference)return 1;if(!e.hasConference&&t.hasConference)return-1;let r=i.findIndex((t=>e.name.startsWith(t))),n=i.findIndex((e=>t.name.startsWith(e)));return r=-1===r?i.length:r,n=-1===n?i.length:n,r<n?-1:r>n?1:e.isDemo?-1:t.isDemo||e.isPrepaid&&!t.isPrepaid?1:!e.isPrepaid&&t.isPrepaid||e.name<t.name?-1:e.name>t.name?1:0}isEnterprise(){return this.name.toLowerCase().includes("enterprise")}isBusiness(){return this.name.toLowerCase().includes("business")}isEssential(){return this.isDefault}}t.Offer=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(66),n=i(95),s=i(17),o=i(9),a=i(37),c=i(6),l=i(4),d=i(30),u=i(19),h=i(14),f=i(166),p=i(11),g=i(47),m=i(70),v=i(310);class S{constructor(e,t){this.conversationService=e,this.webConferenceServiceV2=t,this.xmppService=o.XmppService.getInstance(),this.fileStorageService=a.FileStorageService.getInstance(),this.logger=l.LoggerService.getInstance(),this.roomService=d.RoomService.getInstance(),this.settingsService=u.SettingsService.getInstance(),this.profileService=h.ProfileService.getInstance(),this.mainService=s.MainService.getInstance(),this.contactService=c.ContactService.getInstance(),this.webinarService=f.WebinarService.getInstance(),this.eventService=p.EventService.getInstance(),this.fileServerService=g.FileServerService.getInstance(),this.webrtcGatewayService=m.WebrtcGatewayService.getInstance()}static create(e,t){return new S(e,t)}onChatMessageReceived(e){try{const t=$(e);return t.find("event").length>0||t.find("propose").length>0||t.find("received").length>0?(this.logger.info("[ConversationServiceEventHandler] onChatMessageReceived ignore the message"),true):(t.find("recording").length>0?(this.logger.info("[ConversationServiceEventHandler] onChatMessageReceived : recording msg case"),this.onRecordingMessageReceived(e)):t.find("record").length>0||this.extractStanzaData(e).then((t=>{t&&(t.body||t.additionalContent||t.oob||t.conference||t.replace||t.modified?(this.logger.info("[ConversationServiceEventHandler] onChatMessageReceived"),this.handleChatMessage(t)):t.outgoingMessage||this.contactService.isUserContact(t.participant)||!t.status||this.handleStatusMessage(t.conversation,t.participant,e))})),true)}catch(t){return this.logger.error("[ConversationServiceEventHandler] onChatMessageReceived ERROR "+t),true}}async onErrorMessageReceived(e){try{const t=await this.extractStanzaData(e),i=t.conversation.getMessageById(t.messageId);i.sendStatus=r.Message.SendStatus.ERROR,i.sendUpdateEvent(),this.logger.info("[ConversationServiceEventHandler] onErrorMessageReceived")}catch(t){this.logger.error("[ConversationServiceEventHandler] onErrorMessageReceived ERROR "+t)}}onConferenceMessageReceived(e){this.logger.info("[ConversationServiceEventHandler] onConferenceMessageReceived");try{return 0===$(e).find("event").length?this.logger.info("[ConversationServiceEventHandler] onConferenceMessageReceived ignore the message"):this.extractStanzaData(e).then((e=>{e.conference&&this.handleChatMessage(e)})),true}catch(t){return this.logger.error("[ConversationServiceEventHandler] onConferenceMessageReceived ERROR "+t),true}}onRoomAdminMessageReceived(e,t,i,r,s){if("StageUpdate"===i)return;this.logger.info("[ConversationServiceEventHandler] onRoomAdminMessageReceived");const o=this.conversationService.addAdminBubbleMessage(e,t,new Date,i,r,s);this.conversationService.setStatusMessage(e,t,n.Conversation.Status.ACTIVE),this.conversationService.sendAckReceivedMessage(e,o),e===this.conversationService.activeConversation&&this.mainService.appVisible.getValue()||e.setMissedCounter(e.missedCounter+1),this.eventService.publish("ON_CONVERSATION_MESSAGE_RECEIVED",o,e,false),this.eventService.publish("ON_CONVERSATIONS_UPDATED_EVENT",e,n.Conversation.EventType.IM)}onFileMessageReceived(e){this.logger.info("[ConversationServiceEventHandler] onFileMessageReceived");try{return this.extractStanzaData(e).then((e=>{if(e.body){const t=e.conversation;this.conversationService.addFileMessage(t,e.participant,e.date,e.body,e.messageId,e.urgency),this.conversationService.setStatusMessage(t,e.participant,n.Conversation.Status.ACTIVE),this.eventService.publish("ON_CONVERSATIONS_UPDATED_EVENT",t,n.Conversation.EventType.FILE)}})),true}catch(t){return this.logger.error("[ConversationServiceEventHandler] onFileMessageReceived ERROR "+t),true}}onWebRTCMessageReceived(e){this.logger.info("[ConversationServiceEventHandler] onWebRTCMessageReceived");try{return $(e).find("call_log").length>0?this.extractWebrtcStanzaData(e).then((e=>{if(e&&e.body){const t=e.conversation,i=this.conversationService.addWebRTCMessage(t,e.participant,e.date,e.body,e.messageId);this.conversationService.setStatusMessage(t,e.participant,n.Conversation.Status.ACTIVE),this.conversationService.sendAckReceivedMessage(t,i),"R"===i.side||e.state&&"answered"===e.state?this.conversationService.sendAckReadMessage(t,i):t===this.conversationService.activeConversation&&this.mainService.appVisible.getValue()||t.setMissedCounter(t.missedCounter+1),this.eventService.publish("ON_CONVERSATIONS_UPDATED_EVENT",t)}})):this.extractStanzaData(e).then((e=>{if(e&&e.body){const t=e.conversation;this.conversationService.addWebRTCMessage(t,e.participant,e.date,e.body,e.messageId),this.conversationService.setStatusMessage(t,e.participant,n.Conversation.Status.ACTIVE),this.eventService.publish("ON_CONVERSATIONS_UPDATED_EVENT",t)}})),true}catch(t){return this.logger.error("[ConversationServiceEventHandler] onWebRTCMessageReceived error "+t),true}}onPBXMessageReceived(e){this.logger.info("[ConversationServiceEventHandler] onWebRTCMessageReceived");try{return $(e).find("call_log").length>0&&this.extractWebrtcStanzaData(e).then((e=>{if(e&&e.body){const t=e.conversation,i=this.conversationService.addWebRTCMessage(t,e.participant,e.date,e.body,e.messageId);this.conversationService.setStatusMessage(t,e.participant,n.Conversation.Status.ACTIVE),this.conversationService.sendAckReceivedMessage(t,i),"R"===i.side||e.state&&"answered"===e.state?this.conversationService.sendAckReadMessage(t,i):t===this.conversationService.activeConversation&&this.mainService.appVisible.getValue()||t.setMissedCounter(t.missedCounter+1),this.eventService.publish("ON_CONVERSATIONS_UPDATED_EVENT",t)}})),true}catch(t){return this.logger.error("[ConversationServiceEventHandler] onWebRTCMessageReceived error "+t),true}}onManagementMessageReceived(e){try{const t=$(e),i=t.find("conversation");if(i){const e=i.attr("action");let t=null;if("create"===e){const e=this.xmppService.getBareJidFromJid(i.find("peer").text()),r=i.find("type").text(),n=i.attr("id");t=this.conversationService["room"===r?"getRoomConversationInternal":"getOrCreateOneToOneConversationInternal"](e,n)}else t=Promise.resolve(this.conversationService.getConversation(i.attr("id")));t.then((t=>{if(this.logger.info("[ConversationServiceEventHandler] onManagementMessageReceived ("+e+" conversation)"),t)switch(e){case"create":{t.dbId=i.attr("id");const e=i.find("lastMessageDate").text();e&&e.length>0&&(t.lastModification=new Date(e)),t.missedCounter=parseInt(i.find("unreadMessageNumber").text(),10)||0,t.muted="true"===i.find("mute").text();const r=i.find("lastMessageText").text(),n=i.find("lastMessageSender").text();t.lastMessageText=r,t.lastMessageSender=n,this.conversationService.favoriteService&&this.conversationService.favoriteService.updateFavoriteConversations(t),this.conversationService.orderConversations(),this.eventService.publish("ON_CONVERSATIONS_UPDATED_EVENT",t)}break;case"delete":this.conversationService.removeConversation(t);break;case"update":{const e=i.find("bookmark");if(e&&e.length){const i=e.find("messageId").text();if(i){const r=Number(e.find("timestamp").text()),n=Number(e.find("unreadMessageNumber").text());t.bookmark={messageId:i,timestamp:r},t.missedCounter=n,this.logger.info(`[ConversationServiceEventHandler] onManagementMessageReceived - Bookmarked ${i} on ${r} with ${n} unread`)}else t.bookmark=null,this.logger.info("[ConversationServiceEventHandler] onManagementMessageReceived - Bookmark removed")}break}}else if("create"===e){const e=this.xmppService.getBareJidFromJid(i.find("peer").text()),t=i.attr("id"),r=new Date(i.find("lastMessageDate").text()),s=i.find("lastMessageText").text(),o=i.find("lastMessageSender").text(),a=parseInt(i.find("unreadMessageNumber").text(),10)||0,c="true"===i.find("mute").text(),l=i.find("type").text();this.conversationService.getOrCreateConversation(e,l).then((e=>{this.logger.info("[ConversationServiceEventHandler] onManagementMessageReceived update conversation ("+e.id+")"),e.dbId=t,e.lastModification=r?new Date(r):void 0,e.lastMessageText=s,e.lastMessageSender=o,e.muted=c,e.preload=true,e.setMissedCounter(a),"bot"===l&&(e.type=n.Conversation.Type.ONE_TO_ONE),this.conversationService.favoriteService&&this.conversationService.favoriteService.updateFavoriteConversations(e),this.eventService.publish("ON_CONVERSATIONS_UPDATED_EVENT",e)}))}}))}if(t.find("mute")||t.find("unmute")){const e=t.find("mute");let i=false;e.length&&(i=!e.text().length||"true"===e.text());const r=t.find("mute").attr("conversation")||t.find("unmute").attr("conversation"),n=this.conversationService.getConversation(r);n&&(this.logger.info("[ConversationServiceEventHandler] onManagementMessageReceived : mute is changed to "+i),n.muted=i)}return true}catch(t){return this.logger.error("[ConversationServiceEventHandler] onManagementMessageReceived error "+t),true}}onReceiptMessageReceived(e){try{let t=$(e);const i=this.xmppService.getBareJidFromJid(t.attr("from")),n=t.find("message");this.contactService.isUserContactJid(i)&&n.length>0&&(t=$(n));const s=t.find("received");if(s.length&&s.length>0){this.logger.info("[ConversationServiceEventHandler] onReceiptMessageReceived");const t=$(s).attr("id"),i=$(s).attr("entity"),n=$(s).attr("event");if("server"===i&&"received"===n){const e=this.conversationService.pendingMessages[t];if(e&&e.message){const i=e.message,n=e.conversation;this.logger.info("[conversationService] Receive server ack ("+n.id+", "+i.id+")"),i.setReceiptStatus(r.Message.ReceiptStatus.SENT),i.sendUpdateEvent(),delete this.conversationService.pendingMessages[t],this.eventService.publish("ON_CONVERSATION_RECEIPT_RECEIVED",i,n,"server")}}else"client"===i&&this.extractStanzaData(e).then((t=>{this.handleReceiptReceiveMessage(t.conversation,e)}))}else if(t.find("mark_as_read").length){this.logger.info("[ConversationServiceEventHandler] onReceiptMessageReceived -- mark_as_read");const e=t.find("mark_as_read").attr("with"),i=this.conversationService.getConversation(e);if(i){const e="true"===t.find("mark_as_read").attr("maskread");switch(t.find("mark_as_read").attr("id")){case"all-received":i.setMissedCounter(0),this.conversationService.updateMissedCounters();break;case"all-sent":e?i.ackReceivedAllSentMessages():i.ackReadAllSentMessages();break;default:this.logger.error("[ConversationServiceEventHandler] onReceiptMessageReceived error - unknown read type")}}}else t.find("voicemessage").length&&this.logger.debug("[ConversationServiceEventHandler] onReceiptMessageReceived VoiceMessage detected");return true}catch(t){return this.logger.error("[ConversationServiceEventHandler] onReceiptMessageReceived error "+t),true}}extractStanzaData(e){return new Promise(((t,i)=>{let r=$(e);const n=r.attr("from"),s=this.xmppService.getBareJidFromJid(n),o={};let a=null;const c=r.find("message");if(c.length>0&&this.contactService.isUserContactJid(s)){const e=$(r).find("sent forwarded message forwarded message");if(e&&e.length){const t=$(r).find("sent forwarded message").attr("id");r=$(e).find("forwarded message"),o.isForwarded=true,a=this.handleCarbonMsg(c,o,r,t)}else a=this.handleCarbonMsg(c,o,r,null)}else{const e=$(r).find("forwarded[xmlns='urn:xmpp:forward:0']");if(e&&e.length){const i=r.attr("id");r=$(e).find("forwarded message"),o.isForwarded=true,a=this.handleStandardMsg(o,r,n,i,t)}else a=this.handleStandardMsg(o,r,n,null,t)}a&&this.handleCommonData(e,o,r,a.conversationId,a.delay,a.resource,t,i)}))}handleCommonData(e,t,i,r,n,s,o,a){const c="push"===i.find("retransmission").attr("source");if(t.date=new Date,t.offline=false,"Offline Storage"===n.text()&&(t.date=new Date(n.attr("stamp")),t.offline=true),c){let e=this.conversationService.getConversation(r);return void(e?a():this.conversationService.getOrCreateConversation(r,r.startsWith("room_")?"room":"contact").then((t=>{e=t,a()})))}const l=this.conversationService.getConversation(r);if(t.convReady=l&&null!==l.dbId,t.body||l||t.oob||t.conference)if(0===r.indexOf("room_")){const e=this.roomService.getRoomByJid(r),n=i.find("subject"),c=n.length&&""===n.text();e&&"accepted"!==e.status||c?this.logger.info("[conversationServiceEvent] extractStanzaData -- ignore this stanza message"):this.conversationService.getOrCreateConversation(r,"room").then((e=>(t.conversation=e,t.conference&&t.conference.ownerjid?this.contactService.getOrCreateContact(t.conference.ownerjid):(s&&-1!==s.indexOf("/")&&(s=s.split("/")[0]),s?this.contactService.getOrCreateContact(s):null)))).then((e=>{t.participant=e,o(t)})).catch((e=>{this.logger.error("[conversationServiceEventHandler] impossible to fetch conversation "+e.message),a()}))}else this.conversationService.getOrCreateConversation(r,"contact").then((e=>{t.conversation=e,t.participant||(t.participant=e.contact),o(t)})).catch((e=>{this.logger.error("[conversationServiceEventHandler] impossible to fetch conversation "+e.message),a()}));else if($(e).find("deleted")){const t=$(e).find("deleted")[0];if(t&&"all"===t.getAttribute("id")){const e=this.conversationService.getConversation(t.getAttribute("with"));e&&(this.logger.info("[conversationServiceEventHandler] Remove all messages for conversation "+e.id),e.reset())}o()}else this.logger.debug("[conversationServiceEventHandler] ignored message stanza"),a()}handleStandardMsg(e,t,i,n,s){this.logger.debug("[conversationServiceEventHandler] > handleStandardMsg "+n),e.outgoingMessage=false,e.body=t.find("body").text(),e.messageId=n||t.attr("id"),e.carbon=false,e.answeredMsg=t.find("answeredMsg"),e.attention=t.find("attention");let o=this.xmppService.getBareJidFromJid(i);const a=this.xmppService.getResourceFromJid(i),c=t.find("delay");e.urgency="std";const l=t.find("headers[xmlns='http://jabber.org/protocol/shim']");if(l&&l.length){const t=$(l).find("header[name='Urgency']");t&&t.length&&(e.urgency=t.text()),"undefined"===e.urgency&&(e.urgency="std")}const d=t.find("x[xmlns='jabber:x:oob']");if(d&&d.length){const t=$(d),i=t.find("url").text(),r=t.find("mime").text(),n=t.find("filename").text(),s=t.find("size").text();e.oob={url:i,mime:r,filename:n,filesize:s}}const u=t.find("geoloc");if(u&&u.length){const t=$(u),i=t.find("lon").text(),r=t.find("lat").text();e.geoloc={lon:i,lat:r}}const h=t.find("voicemessage");h&&h.length&&(e.voiceMessage=true);const f=t.find("x[xmlns='jabber:x:audioconference']");if(f&&f.length){const t=$(f),i=t.attr("message"),r=t.attr("confendpointid"),n=f.attr("jid"),a=f.attr("type");if(e.conference={type:a,message:i,confendpointid:r,roomjid:n,ownerjid:o},"reminder"!==a)return this.logger.debug("[conversationServiceEventHandler] ignored message stanza for conference"),s(e),null;o=n}const p=t.find("url-metadata");e.urlMetadata=[],p&&p.each(((t,i)=>{const r=$(i);e.urlMetadata.push(v.UrlMetaData.create({title:r.attr("title"),url:r.attr("url"),description:r.attr("description"),image:r.attr("image")}))}));const g=t.find("replace");g&&g.length&&(e.replace={id:g.attr("id")});const m=t.find("modified"),S=t.find("deleted");e.modified=m&&m.length>0||S&&S.length>0;const b=t.find("mention[xmlns='urn:xmpp:attention:0']");if(b.length){e.mentions=[];b.find("jid").each(((t,i)=>{const r={};r.jid=$(i).text(),r.pos=parseInt($(i).attr("pos"),10),r.size=parseInt($(i).attr("size"),10),r.jid&&e.mentions.push(r)}))}e.additionalContent=null;const y=t.find("content[xmlns='urn:xmpp:content']");if(y&&y.length>0){const t=$(y[0]);e.additionalContent=r.MessageAdditionalContent.create(t.attr("type"),t.text())}const C=t.find("subject");C&&""!==C.text()&&(e.subject=C.text()),e.status=null;const w=t.find("composing"),_=t.find("paused"),E=t.find("active"),T=t.find("inactive");return w.length?e.status="composing":_.length?e.status="paused":E.length?e.status="active":T.length&&(e.status="inactive"),{conversationId:o,resource:a,delay:c}}handleCarbonMsg(e,t,i,n){const s=$(e),o=this.xmppService.getBareJidFromJid(s.attr("from")),a=this.xmppService.getResourceFromJid(s.attr("from")),c=this.xmppService.getBareJidFromJid(s.attr("to")),l=this.xmppService.getResourceFromJid(s.attr("to"));t.outgoingMessage=this.contactService.isUserContactJid(o),t.body=s.find("body").text(),t.participant=t.outgoingMessage?this.contactService.userContact:null,t.messageId=n||s.attr("id"),t.carbon=true,t.answeredMsg=s.find("answeredMsg");const d=t.outgoingMessage?c:o,u=t.outgoingMessage?l:a,h=s.find("delay");t.urgency="std";const f=s.find("headers[xmlns='http://jabber.org/protocol/shim']");if(f&&f.length){const e=$(f).find("header[name='Urgency']");e&&e.length&&(t.urgency=e.text())}const p=s.find("x[xmlns='jabber:x:oob']");if(p&&p.length){const e=$(p),i=e.find("url").text(),r=e.find("mime").text(),n=e.find("filename").text(),s=e.find("size").text();t.oob={url:i,mime:r,filename:n,filesize:s}}const g=i.find("x[xmlns='jabber:x:audioconference']");if(g&&g.length){const e=$(g),i=e.attr("subject"),r=e.attr("confendpointid"),n=g.attr("jid"),s=g.attr("type");t.conference={type:s,subject:i,confendpointid:r,roomjid:n,ownerjid:d}}const m=i.find("url-metadata");t.urlMetadata=[],m&&m.each(((e,i)=>{const r=$(i);t.urlMetadata.push(v.UrlMetaData.create({title:r.attr("title"),url:r.attr("url"),description:r.attr("description"),image:r.attr("image")}))}));const S=e.find("replace");S&&S.length&&(t.replace={id:S.attr("id")});const b=i.find("modified"),y=i.find("deleted");t.modified=b&&b.length>0||y&&y.length>0;const C=e.find("mention[xmlns='urn:xmpp:attention:0']");if(C.length){t.mentions=[];C.find("jid").each(((e,i)=>{const r={};r.jid=$(i).text(),r.pos=parseInt($(i).attr("pos"),10),r.size=parseInt($(i).attr("size"),10),r.jid&&t.mentions.push(r)}))}t.additionalContent=null;const w=i.find("content[xmlns='urn:xmpp:content']");if(w&&w.length>0){const e=$(w[0]);t.additionalContent=r.MessageAdditionalContent.create(e.attr("type"),e.text())}t.status=null;const _=i.find("composing"),E=i.find("paused"),T=i.find("active"),I=i.find("inactive");_.length?t.status="composing":E.length?t.status="paused":T.length?t.status="active":I.length&&(t.status="inactive");const P=s.find("geoloc");if(P&&P.length){const e=$(P),i=e.find("lon").text(),r=e.find("lat").text();t.geoloc={lon:i,lat:r}}const A=s.find("voicemessage");return A&&A.length&&(t.voiceMessage=true),{conversationId:d,resource:u,delay:h}}extractWebrtcStanzaData(e){return new Promise(((t,i)=>{this.logger.debug("[conversationServiceEventHandler] extractWebrtcStanzaData");const r={};r.messageId=$(e).attr("id"),r.callerJid=$(e).find("caller").text(),r.calleeJid=$(e).find("callee").text(),r.state=$(e).find("state").text();let n=null;if(this.contactService.isUserContactJid(r.callerJid)?(n=r.calleeJid,r.participant=this.contactService.userContact):n=r.callerJid,-1!==n.indexOf("janusgateway"))return this.logger.debug("[conversationServiceEventHandler] extractWebrtcStanzaData -- ignore Janus message"),void i();if(this.webrtcGatewayService.isMediaPillarJid(r.callerJid))return this.logger.debug("[conversationServiceEventHandler] extractWebrtcStanzaData -- ignore MediaPillar message"),void t(null);let s=0;$(e).find("duration")&&(s=parseInt($(e).find("duration").text(),10)),r.duration=s>0?"("+moment.duration(s,"ms").format("h[H] mm[m] ss[s]")+")":0;const o=$(e).find("date").text();o&&(r.date=new Date(o)),r.body="","missed"===r.state?r.body="missedCall||"+r.date:"answered"===r.state&&(r.body="activeCallMsg||"+r.date+"||"+r.duration),this.conversationService.getOrCreateConversation(n,"contact").then((e=>{r.conversation=e,r.participant||(r.participant=e.contact),t(r)})).catch((e=>{this.logger.error("[conversationServiceEventHandler] impossible to fetch conversation "+e.message),i()}))}))}handleChatMessage(e){this.logger.info("[ConversationServiceEventHandler] handleChatMessage");const t=e.body;let i=null,r=e.conversation;if(r&&r.room&&(r.room.lastActivityDate=new Date),e.oob){const t=e.oob.url,n=e.oob.filename,s=this.fileStorageService.extractFileIdFromUrl(t),o=e.attention&&e.attention.length;i=this.conversationService.addFileSharingMessage(r,e.participant,e.date,e.body,e.messageId,s,n,e.geoloc,e.urgency,e.isForwarded,o);let a=false;const c=this.fileStorageService.getFileDescriptorById(s);c&&!c.isAlreadyFileViewer(r.id)&&(a=true),this.fileStorageService.retrieveAndStoreOneFileDescriptor(s,a).then((e=>{this.fileServerService.getBlobThumbnailFromFileDescriptor(e).then((t=>{let i=e;e.recordingFile||(i=this.fileStorageService.getFileDescriptorById(e.id)),i.previewBlob=t,i.previewBlobSubject.next(i.previewBlob),this.eventService.publish("ON_FILE_DESCRIPTOR_RECEIVED_EVENT",{fileId:i.id})})),this.eventService.publish("ON_FILE_DESCRIPTOR_RECEIVED_EVENT",{fileId:e.id})})).catch((e=>{this.logger.info("[ConversationServiceEventHandler] handleChatMessage error "+e)}))}else if(e.conference){const t={type:e.conference.type,message:e.conference.subject,confendpointid:e.conference.confendpointid,roomjid:e.conference.roomjid};if(r=this.conversationService.getConversation(t.roomjid),this.eventService.publish("ROOM_UPDATE_CONFID"),!r)return;i=this.conversationService.addConferenceMessage(r,e.participant,e.date,e.messageId,t)}else if(e.replace)i=r.getMessageById(e.replace.id),i&&e.participant.jid!==i.from.jid?(this.logger.warn("[ConversationServiceEventHandler] handleChatMessage : message Replaced by somebody else - Skip"),i=null):(i||(i=this.conversationService.addChatMessage(r,e.participant,e.date,"",e.replace.id,null,e.subject,null,null,e.additionalContent,null,null,null,e.isForwarded)),i.addReplaceMsg(e.messageId,t),i.mentions=e.mentions,r.updateAfterReplaceEvent(i));else if(e.modified)i=r.getMessageById(e.messageId),i.modify(e),r.updateAfterReplaceEvent(i);else if(t.length>0||null!==e.additionalContent){const t=e.answeredMsg?e.answeredMsg.text():null,n=e.answeredMsg?e.answeredMsg.attr("stamp"):null;if(i=this.conversationService.addChatMessage(r,e.participant,e.date,e.body,e.messageId,null,e.subject,t,n,e.additionalContent,e.mentions,e.urgency,e.isForwarded),t){const i=r.getMessageById(t),n=this.contactService.isUserContact(e.participant);i&&n?(i.urgencyAck=true,i.urgencyHandler&&i.urgencyHandler()):this.logger.error("[ConversationServiceEventHandler] Not possible to handle answeredMsg because replied msg not found")}}i&&(this.logger.info("[ConversationServiceEventHandler] handleChatMessage : message body="+i.getLastTextModified()),i.isForwarded=!!e.isForwarded&&e.isForwarded,i.urlMetadata=e.urlMetadata.length>0?e.urlMetadata[0]:null,this.acknowledgeHandledChatMessage(e,r,i))}acknowledgeHandledChatMessage(e,t,i){if(this.logger.info("[ConversationServiceEventHandler] acknowledgeHandledChatMessage"),!i)return i=t.getMessageById(e.messageId),void(t.room&&i&&i.side===r.Message.Side.RIGHT&&this.conversationService.sendAckReceivedMessage(t,i));if(i.side===r.Message.Side.LEFT){let n=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_UI_3_0)&&t.webConferenceSession&&t.webConferenceSession.haveJoined&&!t.webConferenceSession.isInExternalWindow&&(!t.infoVisible||t.infoVisible&&"chat"!==t.selectedTabName);if(this.webConferenceServiceV2&&t.room){const e=this.webConferenceServiceV2.getWebConferenceSessionById(t.room.dbId);n=n||e&&e.haveJoined&&!e.isInExternalWindow&&(!t.infoVisible||t.infoVisible&&"chat"!==t.selectedTabName)}if(n=n||this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_UI_3_0)&&t.videoCall&&0!==t.videoCall.status.key&&!t.infoVisible,t.room&&t.room.isWebinarRoom()){n=!t.infoVisible||t.infoVisible&&"chat"!==t.selectedTabName;const e=t.room.conference.webinar.id,r=this.webinarService.conference.activeWebinar;r&&r.id===e||this.conversationService.sendAckReadMessage(t,i)}this.conversationService.activeConversation&&t.dbId===this.conversationService.activeConversation.dbId&&"away"!==this.contactService.userContact.status&&this.mainService.appVisible.getValue()&&!t.isFullScreenNoChat&&!n?this.conversationService.sendAckReadMessage(t,i):(this.conversationService.sendAckReceivedMessage(t,i),e.offline||!e.convReady||i.isTextModified()||t.setMissedCounter(t.missedCounter+1)),i.isTextModified()&&(i.receiptStatus===r.Message.ReceiptStatus.READ&&this.conversationService.sendAckReadOrReceivedMessage(t,e.messageId,"read"),i.sendUpdateEvent())}else e.carbon?i.setReceiptStatus(r.Message.ReceiptStatus.SENT):i.setReceiptStatus(r.Message.ReceiptStatus.IN_PROGRESS);this.conversationService.setStatusMessage(t,e.participant,n.Conversation.Status.ACTIVE),this.eventService.publish("ON_CONVERSATION_MESSAGE_RECEIVED",i,t,e.carbon),this.eventService.publish("ON_CONVERSATIONS_UPDATED_EVENT",t)}handleReceiptReceiveMessage(e,t){this.logger.info("[ConversationServiceEventHandler] handleReceiptReceiveMessage");const i=$(t).find("received[xmlns='urn:xmpp:receipts']");if(i.length){const n=$(i).attr("id"),s=e.getMessageById(n);if(s){let n=$(t).attr("from").split("/")[1];n||(n=$(t).attr("from"));const o=$(i).attr("event"),a="true"===$(i).attr("maskread");(e.room&&this.contactService.isUserContactJid(n)||!e.room)&&("received"===o?s.setReceiptStatus(r.Message.ReceiptStatus.UNREAD):"read"===o&&(a||s.setReceiptStatus(r.Message.ReceiptStatus.READ),e.setMissedCounter(0))),this.contactService.isUserContactJid(n)&&"read"===o&&"L"===s.side&&e.setMissedCounter(0),s.sendUpdateEvent(),this.eventService.publish("ON_CONVERSATION_RECEIPT_RECEIVED",s,e,o),this.eventService.publish("ON_CONVERSATIONS_UPDATED_EVENT",e)}else{const r=$(t).attr("from"),n=$(i).attr("event");let s="";r&&(s=r.split("/")[1]),s||(s=r),this.contactService.isUserContactJid(s)&&"read"===n&&(e.setMissedCounter(0),this.eventService.publish("ON_CONVERSATIONS_UPDATED_EVENT",e))}}}handleStatusMessage(e,t,i){this.logger.info("[conversationServiceEventHandler] handleStatusMessage ");let r="";r="thread"===$(i).children().prop("tagName")?n.Conversation.stringToStatus($($(i).children()[1]).prop("tagName")):n.Conversation.stringToStatus($(i).children().prop("tagName")),this.conversationService.setStatusMessage(e,t,r),this.eventService.publish("ON_CONVERSATIONS_STATUS_MESSAGE_EVENT",e,t,r)}onRecordingMessageReceived(e){this.logger.info("[ConversationServiceEventHandler] onRecordingMessageReceived");try{const t=e.textContent;return this.extractStanzaData(e).then((e=>{if("start"===t){const i=e.conversation;this.conversationService.addRecordingMessage(i,e.participant,e.date,t,e.messageId),this.conversationService.setStatusMessage(i,e.participant,n.Conversation.Status.ACTIVE),i.videoCall&&(i.videoCall.isRecorded=true),this.eventService.publish("ON_CONVERSATIONS_UPDATED_EVENT",i),this.eventService.publish("ON_RECORDING_START_MSG_RECEIVED")}else if("stop"===t){const i=e.conversation;i&&(this.conversationService.addRecordingMessage(i,e.participant,e.date,t,e.messageId),i.videoCall&&(i.videoCall.isRecorded=false)),this.eventService.publish("ON_RECORDING_STOP_MSG_RECEIVED")}else"remoteStopVideo"===t?this.eventService.publish("ON_RECORDING_REMOTESTOPVIDEO_MSG_RECEIVED"):"remoteChangeMediaVideo"===t?this.eventService.publish("ON_RECORDING_REMOTECHANGEMEDIAVIDEO_MSG_RECEIVED"):"remoteStopSharing"===t?this.eventService.publish("ON_RECORDING_REMOTESTOPSHARING_MSG_RECEIVED"):"remoteChangeMediaSharing"===t&&this.eventService.publish("ON_RECORDING_REMOTECHANGEMEDIASHARING_MSG_RECEIVED")})),true}catch(t){return this.logger.error("[ConversationServiceEventHandler] onRecordingMessageReceived error "+t),true}}}t.ConversationServiceEventHandler=S},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7);class n{static create(e,t,i,r,s){return new n(e,t,i,r,s)}constructor(e=null,t=null,i=null,n=null,s=null){this.url=e,this.fileName=t,this.totalBytes=i,this.receivedBytes=n,this.savePath=s,this.isCanceled=false,this.openFolderOnceDownloadFinished=false,this.progressSubject=new r.Subject}isDownloadFinished(){return this.receivedBytes===this.totalBytes}askCancel(){this.isCanceled=true,this.progressSubject.next(void 0)}}t.FilePublicDownload=n},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(108),n=i(390),s=i(418),o=i(419),a=i(8),c=i(4),l=i(30),d=i(6),u=i(9),h=i(19),f=i(13),p=i(34),g=i(7),m=i(18),v=i(17);class S{constructor(){this.logger=c.LoggerService.getInstance(),this.authService=a.AuthService.getInstance(),this.contactService=d.ContactService.getInstance(),this.xmppService=u.XmppService.getInstance(),this.settingsService=h.SettingsService.getInstance(),this.errorHelperService=f.ErrorHelperService.getInstance(),this.mainService=v.MainService.getInstance(),this.webrtcP2PService=p.WebrtcP2PService.getInstance(),this.roomService=l.RoomService.getInstance(),this.subject=new g.Subject,this.webinars=[],this.webinarsMap={},this.subscription=null,this.xmppHandlers=[],this.createInProgress=false,this.getWebinarPromise=[],this.centralizedService=null,this.conversationService=null,this.userContact=null,this.guestMode=true,this.speakers=o.WebinarSpeakersService.create(this),this.participants=s.WebinarParticipantsService.create(this),this.conference=n.WebinarConferenceService.create(this)}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.webinarService||(e.rainbow.webinarService=new S),e.rainbow.webinarService}async start(e){try{this.userContact=this.contactService.userContact,this.centralizedService=this.mainService.inject("centralizedService"),this.conversationService=e,config.enableAioUrlMode="true"===this.settingsService.getSetting("enableAioUrlMode"),await this.getServerWebinars(),this.handleRoomEvents(),this.conference.attachListeners(),this.logger.info("[WebinarService] start -- success")}catch(t){}}async stop(e=false){this.conference.activeWebinar&&this.conference.activeWebinar.session&&this.conference.leave(this.conference.activeWebinar,false,e),this.subscription&&this.subscription.unsubscribe(),this.logger.info("[WebinarService] stop -- success")}async reconnect(){this.webinars=[],this.webinarsMap={},this.handleRoomEvents(),await this.getServerWebinars(),await this.conference.reconnect(),this.submitEvent(S.WEBINARS_UPDATE),this.logger.info("[WebinarService] reconnect -- success")}subscribe(e){return this.subject.subscribe(e)}submitEvent(e,t){this.subject.next(m.RBEvent.create(e,t))}async createWebinar(e,t=true){try{this.createInProgress=true;const i=config.restServerUrl+"/api/rainbow/webinar/v1.0/webinars",n=this.authService.getPostHeader(),s=e.getData(),o=await fetch(i,{method:"POST",headers:n,body:s});if(!o.ok)throw o;const a=(await o.json()).data;return r.Webinar.updateFromData(e,a),e.isCreator=true,this.updateRoles(e),await this.getWebinarRooms(e),t&&this.addWebinarToCache(e),this.createInProgress=false,this.logger.info(`[WebinarService] createWebinar -- ${e.id} -- success`),e}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"createWebinar");throw this.logger.error("[WebinarService] "+e.message),this.createInProgress=false,e.error}}async updateWebinar(e){try{const t=`${config.restServerUrl}/api/rainbow/webinar/v1.0/webinars/${e.id}`,i=this.authService.getPostHeader(),n=e.getData(),s=await fetch(t,{method:"PUT",headers:i,body:n});if(!s.ok)throw s;const o=(await s.json()).data,a=this.webinarsMap[e.id];return r.Webinar.updateFromData(a,o),a.published&&this.submitEvent(S.WEBINARS_UPDATE),a.rxSubject.next(),this.logger.info(`[WebinarService] updateWebinar -- ${a.id} -- success`),a}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"updateWebinar");throw this.logger.error("[WebinarService] "+e.message),e.error}}async updateWebinarAvatar(e,t){try{return t?await this.roomService.setAvatarRoom({id:e.roomId},t,1200,600):await this.roomService.deleteAvatarRoom(e.roomId),e.room.avatar=t,e.room.rxSubject.next(),e.rxSubject.next(),this.logger.info(`[WebinarService] updateWebinarAvatar -- ${e.id} -- success`),e}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"updateWebinarAvatar");throw this.logger.error("[WebinarService] "+e.message),e.error}}async updateWebinarLogo(e,t){try{return t?await this.roomService.setAvatarRoom({id:e.roomModeratorsChatId},t,1200,600):await this.roomService.deleteAvatarRoom(e.roomId),e.practiceRoom.avatar=t,e.practiceRoom.rxSubject.next(),e.rxSubject.next(),this.logger.info(`[WebinarService] updateWebinarLogo -- ${e.id} -- success`),e}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"updateWebinarLogo");throw this.logger.error("[WebinarService] "+e.message),e.error}}getWebinars(e=null){if(e)switch(e){case"name":this.webinars.sort(((e,t)=>e.name.localeCompare(t.name)));break;default:this.webinars.sort(((e,t)=>{const i=moment(e.webinarStartDate),r=moment(t.webinarStartDate);return i.isSame(r)?0:i.isBefore(r)?-1:1}))}return this.webinars.filter((e=>e.isAttendee||"accepted"===e.room.status))}async getServerWebinars(){try{const e=config.restServerUrl+"/api/rainbow/webinar/v1.0/webinars?limit=100&offset=0",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const n=(await i.json()).data;return this.webinars=n.reduce(((e,t)=>{if(!t.moderatorsSelectedAnNotified)return this.deleteWebinar(t.id),this.logger.error("[WebinarService] getServerWebinars -- remove non finalized webinar -- "+t.id),e;const i=r.Webinar.createFromData(t);return i.isCreator=i.creatorId===this.contactService.userContact.dbId,i.room=this.roomService.getRoomById(i.roomId),i.practiceRoom=this.roomService.getRoomById(i.roomModeratorsChatId),this.updateRoles(i),i.room&&this.createWebinarSession(i,"getServerWebinars"),i.isAttendee||i.room?(this.webinarsMap[i.id]=i,e.push(i),e):(this.logger.error(`[WebinarService] getServerWebinars -- no room found for webinar ${t.id} roomId ${i.roomId}`),e)}),[]),this.logger.info(`[WebinarService] getServerWebinars -- ${this.webinars.length} webinar(s) found -- success`),this.webinars}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getServerWebinars");return this.logger.error("[WebinarService] "+t.message),[]}}getWebinar(e){return this.webinarsMap[e]?(this.logger.info(`[WebinarService] getWebinar (from cache) -- ${e} -- success`),Promise.resolve(this.webinarsMap[e])):(this.getWebinarPromise[e]||(this.getWebinarPromise[e]=new Promise(((t,i)=>{const n=r.Webinar.create();n.id=e,this.updateWebinarFromServer(n).then((()=>{this.webinars.push(n),this.webinarsMap[e]=n,this.logger.info(`[WebinarService] getWebinar (from server) -- ${e} -- success`),delete this.getWebinarPromise[e],this.updateRoles(n),this.createWebinarSession(n,"getWebinar"),t(n)})).catch((t=>{this.logger.error("[WebinarService] "+t.message),delete this.getWebinarPromise[e],i(t)}))}))),this.getWebinarPromise[e])}getWebinarBySessionId(e,t=null){let i=t;if(!i){const t=this.xmppService.connection.jingle.sessions[e];if(!t)return null;i=t.conference_id}return this.webinars.find((e=>e.roomId===i))}getWebinarByRoomId(e){return this.webinars.find((t=>t.roomId===e))}async getPublicWebinarInfo(e,t=null,i){try{let r=config.restServerUrl+"/api/rainbow/webinar/v1.0/webinars/public";i&&(r+="?registrationClickCount=true");const n={Accept:"application/json","Content-Type":"application/json"},s={};t||(s.registrationId=e),t&&(s.openInviteId=e,s.joinUuid=t);const o=JSON.stringify(s),a=await fetch(r,{method:"POST",headers:n,body:o});if(!a.ok)throw a;const c=(await a.json()).data;return c.errorDetailsCode=null,c.publicWebinarId=e,c.joinUuid=t,this.logger.info("[WebinarService] -- getPublicWebinarInfo -- success"),c}catch(r){const e=await this.errorHelperService.getErrorInfo(r,"getWebinar");if(this.logger.error("[WebinarService] -- getPublicWebinarInfo -- failure -- "+e.message),403621===e.error.errorDetailsCode){const t=e.error.errorDetailsData;return t.errorDetailsCode=403621,t}return{errorStatus:e.error.status,errorDetailsCode:e.error.errorDetailsCode,errorMessage:e.error.message,linkType:""}}}async updateWebinarFromServer(e){try{const i=`${config.restServerUrl}/api/rainbow/webinar/v1.0/webinars/${e.id}`,n=this.authService.getRequestHeader(),s=await fetch(i,{method:"GET",headers:n});if(!s.ok)throw s;const o=(await s.json()).data;if(r.Webinar.updateFromData(e,o),this.updateRoles(e),e.room||(e.room=this.roomService.getRoomById(e.roomId)),!e.room)try{e.room=await this.roomService.getServerRoom(e.roomId)}catch(t){}if((e.isOrganizer||e.isSpeaker)&&e.room&&"accepted"===e.room.status&&(e.practiceRoom||(e.practiceRoom=this.roomService.getRoomById(e.roomModeratorsChatId)),!e.practiceRoom))try{e.practiceRoom=await this.roomService.getServerRoom(e.roomModeratorsChatId)}catch(t){}return e.session||this.createWebinarSession(e,"updateWebinarFromServer"),this.submitEvent(S.WEBINARS_UPDATE),e}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"updateWebinarFromServer");throw this.logger.error("[WebinarService] "+e.message),e.error}}async deleteWebinar(e){try{const t=this.webinarsMap[e];if(!t||t.isOrganizer||t.isCreator){const t=`${config.restServerUrl}/api/rainbow/webinar/v1.0/webinars/${e}`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"DELETE",headers:i});if(!r.ok)throw r}else{const t=`${config.restServerUrl}/api/rainbow/webinar/v1.0/webinars/${e}/unsubscribe`,i=this.authService.getPostHeader(),r=await fetch(t,{method:"PUT",headers:i});if(!r.ok)throw r}t&&this.removeWebinar(t)}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"deleteWebinar");throw this.logger.error("[WebinarService] "+e.message),e.error}}updateRoles(e){e.isOrganizer=void 0!==e.organizers.find((e=>e.userId===this.contactService.userContact.dbId)),e.isSpeaker=void 0!==e.speakers.find((e=>e.userId&&e.userId===this.contactService.userContact.dbId||e.alternativeUserId&&e.alternativeUserId===this.contactService.userContact.dbId)),e.isAttendee=!e.isOrganizer&&!e.isSpeaker,e.isGuestAttendee=e.isAttendee&&this.contactService.userContact.isGuest()}async hasWebinarLicence(e){try{const t=config.restServerUrl+"/api/rainbow/webinar/v1.0/webinars/invitations/check-license",i=this.authService.getPostHeader(),r=JSON.stringify({users:[e]}),n=await fetch(t,{method:"POST",headers:i,body:r});if(!n.ok)throw n;return(await n.json()).status.accepted.users[0]===e}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getSpeakerStatus");throw this.logger.error("[WebinarService] "+e.message),e.error}}async getAvailableLicences(e,t,i=null){try{let r=`${config.restServerUrl}/api/rainbow/webinar/v1.0/licenses?webinarStartDate=${e}&webinarEndDate=${t}`;i&&(r+="&excludeWebinarId="+i);const n=this.authService.getPostHeader(),s=await fetch(r,{method:"GET",headers:n});if(!s.ok)throw s;return(await s.json()).data}catch(r){const e=await this.errorHelperService.getErrorInfo(r,"getAvailableLicences");throw this.logger.error("[WebinarService] "+e.message),e.error}}async notifyModerators(e){if(e.moderatorsNotified)return e;try{const t=`${config.restServerUrl}/api/rainbow/webinar/v1.0/webinars/${e.id}/warn-moderators`,i=this.authService.getPostHeader(),n=await fetch(t,{method:"PUT",headers:i});if(!n.ok)throw n;const s=(await n.json()).data;return r.Webinar.updateFromData(e,s),this.submitEvent(S.WEBINAR_PUBLISHED,e),e}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"warnModerators");throw this.logger.error("[WebinarService] "+e.message),e.error}}async publishWebinar(e){if(e.published)return e;try{const t=`${config.restServerUrl}/api/rainbow/webinar/v1.0/webinars/${e.id}/publish`,i=this.authService.getPostHeader(),n=await fetch(t,{method:"PUT",headers:i});if(!n.ok)throw n;const s=(await n.json()).data;return r.Webinar.updateFromData(e,s),e.rxSubject.next(),e}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"publishWebinar");throw this.logger.error("[WebinarService] "+e.message),e.error}}handleRoomEvents(){this.subscription&&this.subscription.unsubscribe(),this.subscription=this.roomService.subscribe((async e=>{try{switch(e.type){case"ROOM_USER_UPDATE_EVENT":{const t=e.value.room;if(t&&t.isWebinarRoom()){const e=this.webinarsMap[t.conference.webinar.id];e&&(this.logger.info(`[webinarService] handleRoomEvents -- ${e.id} -- update`),await this.updateWebinarFromServer(e),e.rxSubject.next())}}break;case"ROOM_UPDATE_EVENT":{const t=e.value;if(t&&t.isWebinarRoom()&&"unsubscribed"===t.status){const e=this.webinarsMap[t.conference.webinar.id];e&&(this.logger.info(`[webinarService] handleRoomEvents -- ${e.id} -- delete`),this.removeWebinar(e))}}}}catch(t){}})),this.xmppHandlers.forEach((e=>{this.xmppService.connection.deleteHandler(e)})),this.xmppHandlers=[],this.xmppHandlers.push(this.xmppService.connection.addHandler((e=>this.onManagementMessage(e)),null,"message","management"))}async onManagementMessage(e){try{const t=$(e),i=t.find("webinar");if(i.length>0){const e=i.attr("webinarid");let n=this.webinarsMap[e];const s=i.attr("action");if(s){switch(s){case"create":n||this.createInProgress||(n=await this.getWebinar(e),this.logger.info(`[webinarService] onManagementMessage -- ${e} -- create`));break;case"update":if(n){const t=i.find("name"),s=i.find("subject"),o=i.find("approvalRegistrationMethod"),a=i.find("moderatorsSelectedAnNotified"),c=i.find("emailNotification"),l=i.find("chat"),d=i.find("waitingRoomStartDate"),u=i.find("webinarStartDate"),h=i.find("webinarEndDate"),f=i.find("timeZone");t.length&&(n.name=t.text()),s.length&&(n.subject=s.text()),o.length&&(n.approvalRegistrationMethod=o.text()),a.length&&(n.moderatorsNotified="true"===a.text()),c.length&&(n.published="true"===c.text()),l.length&&l.attr("option")&&(n.chatOption=l.attr("option")),d.length&&(n.waitingRoomStartDate=d.text()),u.length&&(n.webinarStartDate=u.text()),h.length&&(n.webinarEndDate=h.text()),f.length&&(n.timeZone=f.text());const p=i.find("moderators");if(p.length>0){n.organizers=[];p.find("organizer").each(((e,t)=>{const i=$(t);n.organizers.push({userId:i.attr("userid"),status:i.attr("status"),hightlighted:"true"===i.attr("hightlighted"),role:"organizer"})})),n.speakers=n.speakers.filter((e=>null===e.userId));p.find("speaker").each(((e,t)=>{const i=$(t),r=i.attr("userid");n.speakers.push({userId:r,status:i.attr("status"),company:i.attr("company"),jobTitle:i.attr("jobTitle"),hightlighted:"true"===i.attr("hightlighted"),role:"speaker"}),this.contactService.getContactByDBId(r)}));p.find("guestspeaker").each(((e,t)=>{const i=$(t);n.speakers.push({email:i.attr("email"),status:i.attr("status"),role:"speaker"})})),this.updateRoles(n)}const g=i.find("participants");g.length>0&&(g.find("participant").each(((e,t)=>{const i=$(t),s=i.attr("email"),o=i.attr("state");let a=n.participants.find((e=>e.email===s));a?a.state=o:(a=r.WebinarParticipant.create(),a.email=s,a.state=o,a.firstName=i.attr("firstName"),a.lastName=i.attr("lastName"),a.company=i.attr("company"),a.jobTitle=i.attr("jobTitle"),a.userId=i.attr("userId"),a.lastAvatarUpdateDate=i.attr("lastAvatarUpdateDate"),n.participants.push(a))})),n.pendingParticipantNumber=parseInt(g.attr("pending"),10),n.acceptedParticipantNumber=parseInt(g.attr("accepted"),10),n.rejectedParticipantNumber=parseInt(g.attr("rejected"),10)),n.rxSubject.next(),this.logger.info(`[webinarService] onManagementMessage -- ${e} -- update`)}break;case"delete":n&&(this.logger.info(`[webinarService] onManagementMessage -- ${e} -- delete`),this.removeWebinar(n));break;case"invitation":if(!n){n=await this.getWebinar(e);const i=t.attr("from");this.submitEvent("WEBINAR_NOTIFICATION",{webinar:n,from:i,action:"invite"}),this.logger.info(`[webinarService] onManagementMessage -- ${e} -- invitation`)}}this.submitEvent(S.WEBINARS_UPDATE)}}return true}catch(t){return this.logger.error("[webinarService] onWebinarManagement -- failure -- "+t.message),true}}async getWebinarRooms(e,t=true){e.room=await this.roomService.getServerRoom(e.roomId),t&&(e.practiceRoom=await this.roomService.getServerRoom(e.roomModeratorsChatId))}hasActiveOrFutureWebinar(){return this.webinars.some((e=>e.isOrganizer||"terminated"!==e.status))}removeWebinar(e){const t=this.webinars.findIndex((t=>t.id===e.id));-1!==t&&(this.webinars.splice(t,1),delete this.webinarsMap[e.id]),this.conference.removeActiveWebinar(e),e.session=null,e.status="terminated",e.rxSubject.next(),this.submitEvent(S.WEBINARS_UPDATE)}async getWebinarTextConversation(e){try{const t=await this.conversationService.getOrCreateConversation(e.room.jid,"room"),i=`${config.restServerUrl}/api/rainbow/webinar/v1.0/webinars/${e.id}/conversations/${t.dbId}/downloads`,r=await fetch(i,{method:"GET",headers:this.authService.getRequestHeader()});if(!r.ok)throw r;this.logger.info(`[webinarService] getWebinarTextConversation -- ${e.id} -- success`);return(await r.json()).data}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getWebinarTextConversation");throw this.logger.error("[webinarService] "+e.message),e.error}}async getGlobalAnalytics(e){try{const t=`${config.restServerUrl}/api/rainbow/analytics/v1.0/webinars/${e.id}`,i=await fetch(t,{method:"GET",headers:this.authService.getRequestHeader()});if(!i.ok)throw i;this.logger.info(`[webinarService] getAnalytics -- ${e.id} -- success`);const r=(await i.json()).data;return r.participation=r.registered>0?Math.floor(100*r.participants/r.registered)+" %":"0 %",r}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getAnalytics");throw this.logger.error("[webinarService] "+e.message),e.error}}async getParticipantsAnalytics(e){try{const t=`${config.restServerUrl}/api/rainbow/analytics/v1.0/webinars/${e.id}/participants`,i=await fetch(t,{method:"GET",headers:this.authService.getRequestHeader()});if(!i.ok)throw i;this.logger.info(`[webinarService] getParticipantsAnalytics -- ${e.id} -- success`);const r=(await i.json()).data;return r.forEach((e=>{e.date=moment(e.date).format("LT")})),r}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getParticipantsAnalytics");throw this.logger.error("[webinarService] "+e.message),e.error}}async getAttendeesAnalytics(e){try{const t=`${config.restServerUrl}/api/rainbow/analytics/v1.0/webinars/${e.id}/attendance`,i=await fetch(t,{method:"GET",headers:this.authService.getRequestHeader()});if(!i.ok)throw i;this.logger.info(`[webinarService] getAttendeesAnalytics -- ${e.id} -- success`);return(await i.json()).data}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getAttendeesAnalytics");throw this.logger.error("[webinarService] "+e.message),e.error}}addWebinarToCache(e){this.webinars.push(e),this.webinarsMap[e.id]=e}createWebinarSession(e,t){if(e.room&&e.room.conference&&e.room.conference.sessions.length){const i=`[webinarService] createWebinarSession -- ${e.room.conference.sessions[0].type} -- ${t}`;switch(e.room.conference.sessions[0].type){case"practiceWaitingRoom":e.session=r.WebinarSession.create(),this.logger.info(i);break;case"practiceRoom":e.isAttendee||(e.session=r.WebinarSession.create(),this.logger.info(i));break;case"waitingRoom":e.isAttendee&&(e.session=r.WebinarSession.create(),this.logger.info(i));break;case"webinar":e.session=r.WebinarSession.create(),this.logger.info(i)}}else this.logger.info(`[webinarService] createWebinarSession -- ${t} -- no room conference session`)}}S.WEBINARS_UPDATE="WEBINARS_UPDATE",S.WEBINAR_PUBLISHED="WEBINAR_PUBLISHED",S.WEBINAR_TERMINATED="WEBINAR_TERMINATED",t.WebinarService=S},function(e,t,i){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};Object.defineProperty(t,"__esModule",{value:true}),t.CardObject=t.ValidationResults=void 0;var o=i(55),a=i(79),c=i(61),l=i(143),d=i(69),u=function(){function e(){this.allIds={},this.validationEvents=[]}return e.prototype.addFailure=function(e,t,i){this.validationEvents.push({phase:o.ValidationPhase.Validation,source:e,event:t,message:i})},e}();t.ValidationResults=u;var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._shouldFallback=false,t}return n(t,e),t.prototype.getSchemaKey=function(){return this.getJsonTypeName()},Object.defineProperty(t.prototype,"requires",{get:function(){return this.getValue(t.requiresProperty)},enumerable:false,configurable:true}),t.prototype.contains=function(e){return!!this._renderedElement&&this._renderedElement.contains(e)},t.prototype.preProcessPropertyValue=function(e,t){var i=void 0===t?this.getValue(e):t;if(c.GlobalSettings.allowPreProcessingPropertyValues){for(var r=this;r&&!r.onPreProcessPropertyValue;)r=r.parent;if(r&&r.onPreProcessPropertyValue)return r.onPreProcessPropertyValue(this,e,i)}return i},t.prototype.setParent=function(e){this._parent=e},t.prototype.setShouldFallback=function(e){this._shouldFallback=e},t.prototype.shouldFallback=function(){return this._shouldFallback||!this.requires.areAllMet(this.hostConfig.hostCapabilities)},t.prototype.getRootObject=function(){for(var e=this;e.parent;)e=e.parent;return e},t.prototype.internalValidateProperties=function(e){this.id&&(e.allIds.hasOwnProperty(this.id)?(1==e.allIds[this.id]&&e.addFailure(this,o.ValidationEvent.DuplicateId,a.Strings.errors.duplicateId(this.id)),e.allIds[this.id]+=1):e.allIds[this.id]=1)},t.prototype.validateProperties=function(){var e=new u;return this.internalValidateProperties(e),e},t.prototype.findDOMNodeOwner=function(e){return this.contains(e)?this:void 0},Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"renderedElement",{get:function(){return this._renderedElement},enumerable:false,configurable:true}),t.typeNameProperty=new d.StringProperty(d.Versions.v1_0,"type",void 0,void 0,void 0,(function(e){return e.getJsonTypeName()})),t.idProperty=new d.StringProperty(d.Versions.v1_0,"id"),t.requiresProperty=new d.SerializableObjectProperty(d.Versions.v1_2,"requires",l.HostCapabilities,false,new l.HostCapabilities),s([d.property(t.idProperty)],t.prototype,"id",void 0),s([d.property(t.requiresProperty)],t.prototype,"requires",null),t}(d.SerializableObject);t.CardObject=h},function(e,t,i){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:true}),t.LoginRequestResponse=t.ErrorResponse=t.SuccessResponse=t.ActivityResponse=t.ActivityRequestError=t.ActivityRequestTrigger=void 0,function(e){e.Automatic="automatic",e.Manual="manual"}(t.ActivityRequestTrigger||(t.ActivityRequestTrigger={}));var s=function(e,t){this.code=e,this.message=t};t.ActivityRequestError=s;var o=function(e){this.request=e};t.ActivityResponse=o;var a=function(e){function t(t,i){var r=e.call(this,t)||this;return r.request=t,r.rawContent=i,r}return n(t,e),t}(o);t.SuccessResponse=a;var c=function(e){function t(t,i){var r=e.call(this,t)||this;return r.request=t,r.error=i,r}return n(t,e),t}(o);t.ErrorResponse=c;var l=function(e){function t(t,i){var r=e.call(this,t)||this;r.request=t,r._auth=i;for(var n=0,s=r._auth.buttons;n<s.length;n++){var o=s[n];if("signin"===o.type&&void 0!==o.value)try{new URL(o.value),r.signinButton=o;break}catch(a){}}return r}return n(t,e),Object.defineProperty(t.prototype,"tokenExchangeResource",{get:function(){return this._auth.tokenExchangeResource},enumerable:false,configurable:true}),t}(o);t.LoginRequestResponse=l},function(e,t,i){var r=i(413),n=i(414),s=n;s.v1=r,s.v4=n,e.exports=s},function(e,t){var i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(i){var r=new Uint8Array(16);e.exports=function(){return i(r),r}}else{var n=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n}}},function(e,t){for(var i=[],r=0;r<256;++r)i[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,n=i;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")}},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("af",{months:"Januarie_Februarie_Maart_April_Mei_Junie_Julie_Augustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mrt_Apr_Mei_Jun_Jul_Aug_Sep_Okt_Nov_Des".split("_"),weekdays:"Sondag_Maandag_Dinsdag_Woensdag_Donderdag_Vrydag_Saterdag".split("_"),weekdaysShort:"Son_Maa_Din_Woe_Don_Vry_Sat".split("_"),weekdaysMin:"So_Ma_Di_Wo_Do_Vr_Sa".split("_"),meridiemParse:/vm|nm/i,isPM:function(e){return/^nm$/i.test(e)},meridiem:function(e,t,i){return e<12?i?"vm":"VM":i?"nm":"NM"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Vandag om] LT",nextDay:"[Mre om] LT",nextWeek:"dddd [om] LT",lastDay:"[Gister om] LT",lastWeek:"[Laas] dddd [om] LT",sameElse:"L"},relativeTime:{future:"oor %s",past:"%s gelede",s:"'n paar sekondes",ss:"%d sekondes",m:"'n minuut",mm:"%d minute",h:"'n uur",hh:"%d ure",d:"'n dag",dd:"%d dae",M:"'n maand",MM:"%d maande",y:"'n jaar",yy:"%d jaar"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(e){return e+(1===e||8===e||e>=20?"ste":"de")},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},i={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"},r=function(e){return 0===e?0:1===e?1:2===e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5},n={s:["  "," ",["",""],"%d ","%d ","%d "],m:["  "," ",["",""],"%d ","%d ","%d "],h:["  "," ",["",""],"%d ","%d ","%d "],d:["  "," ",["",""],"%d ","%d ","%d "],M:["  "," ",["",""],"%d ","%d ","%d "],y:["  "," ",["",""],"%d ","%d ","%d "]},s=function(e){return function(t,i,s,o){var a=r(t),c=n[e][r(t)];return 2===a&&(c=c[i?0:1]),c.replace(/%d/i,t)}},o=["","","","","","","","","","","",""];e.defineLocale("ar",{months:o,monthsShort:o,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/M/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(e){return""===e},meridiem:function(e,t,i){return e<12?"":""},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:s("s"),ss:s("s"),m:s("m"),mm:s("m"),h:s("h"),hh:s("h"),d:s("d"),dd:s("d"),M:s("M"),MM:s("M"),y:s("y"),yy:s("y")},preparse:function(e){return e.replace(/[]/g,(function(e){return i[e]})).replace(//g,",")},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]})).replace(/,/g,"")},week:{dow:6,doy:12}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t=function(e){return 0===e?0:1===e?1:2===e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5},i={s:["  "," ",["",""],"%d ","%d ","%d "],m:["  "," ",["",""],"%d ","%d ","%d "],h:["  "," ",["",""],"%d ","%d ","%d "],d:["  "," ",["",""],"%d ","%d ","%d "],M:["  "," ",["",""],"%d ","%d ","%d "],y:["  "," ",["",""],"%d ","%d ","%d "]},r=function(e){return function(r,n,s,o){var a=t(r),c=i[e][t(r)];return 2===a&&(c=c[n?0:1]),c.replace(/%d/i,r)}},n=["","","","","","","","","","","",""];e.defineLocale("ar-dz",{months:n,monthsShort:n,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/M/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(e){return""===e},meridiem:function(e,t,i){return e<12?"":""},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:r("s"),ss:r("s"),m:r("m"),mm:r("m"),h:r("h"),hh:r("h"),d:r("d"),dd:r("d"),M:r("M"),MM:r("M"),y:r("y"),yy:r("y")},postformat:function(e){return e.replace(/,/g,"")},week:{dow:0,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("ar-kw",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},week:{dow:0,doy:12}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",0:"0"},i=function(e){return 0===e?0:1===e?1:2===e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5},r={s:["  "," ",["",""],"%d ","%d ","%d "],m:["  "," ",["",""],"%d ","%d ","%d "],h:["  "," ",["",""],"%d ","%d ","%d "],d:["  "," ",["",""],"%d ","%d ","%d "],M:["  "," ",["",""],"%d ","%d ","%d "],y:["  "," ",["",""],"%d ","%d ","%d "]},n=function(e){return function(t,n,s,o){var a=i(t),c=r[e][i(t)];return 2===a&&(c=c[n?0:1]),c.replace(/%d/i,t)}},s=["","","","","","","","","","","",""];e.defineLocale("ar-ly",{months:s,monthsShort:s,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/M/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(e){return""===e},meridiem:function(e,t,i){return e<12?"":""},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:n("s"),ss:n("s"),m:n("m"),mm:n("m"),h:n("h"),hh:n("h"),d:n("d"),dd:n("d"),M:n("M"),MM:n("M"),y:n("y"),yy:n("y")},preparse:function(e){return e.replace(//g,",")},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]})).replace(/,/g,"")},week:{dow:6,doy:12}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("ar-ma",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},i={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};e.defineLocale("ar-sa",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(e){return""===e},meridiem:function(e,t,i){return e<12?"":""},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},preparse:function(e){return e.replace(/[]/g,(function(e){return i[e]})).replace(//g,",")},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]})).replace(/,/g,"")},week:{dow:0,doy:6}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("ar-tn",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[  ] LT",nextDay:"[  ] LT",nextWeek:"dddd [ ] LT",lastDay:"[  ] LT",lastWeek:"dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={1:"-inci",5:"-inci",8:"-inci",70:"-inci",80:"-inci",2:"-nci",7:"-nci",20:"-nci",50:"-nci",3:"-nc",4:"-nc",100:"-nc",6:"-nc",9:"-uncu",10:"-uncu",30:"-uncu",60:"-nc",90:"-nc"};e.defineLocale("az",{months:"yanvar_fevral_mart_aprel_may_iyun_iyul_avqust_sentyabr_oktyabr_noyabr_dekabr".split("_"),monthsShort:"yan_fev_mar_apr_may_iyn_iyl_avq_sen_okt_noy_dek".split("_"),weekdays:"Bazar_Bazar ertsi_rnb axam_rnb_Cm axam_Cm_nb".split("_"),weekdaysShort:"Baz_BzE_Ax_r_CAx_Cm_n".split("_"),weekdaysMin:"Bz_BE_A__CA_C_".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[bugn saat] LT",nextDay:"[sabah saat] LT",nextWeek:"[gln hft] dddd [saat] LT",lastDay:"[dnn] LT",lastWeek:"[ken hft] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s vvl",s:"bir ne saniy",ss:"%d saniy",m:"bir dqiq",mm:"%d dqiq",h:"bir saat",hh:"%d saat",d:"bir gn",dd:"%d gn",M:"bir ay",MM:"%d ay",y:"bir il",yy:"%d il"},meridiemParse:/gec|shr|gndz|axam/,isPM:function(e){return/^(gndz|axam)$/.test(e)},meridiem:function(e,t,i){return e<4?"gec":e<12?"shr":e<17?"gndz":"axam"},dayOfMonthOrdinalParse:/\d{1,2}-(nc|inci|nci|nc|nc|uncu)/,ordinal:function(e){if(0===e)return e+"-nc";var i=e%10;return e+(t[i]||t[e%100-i]||t[e>=100?100:null])},week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
function t(e,t,i){var r,n;return"m"===i?t?"":"":"h"===i?t?"":"":e+" "+(r=+e,n={ss:t?"__":"__",mm:t?"__":"__",hh:t?"__":"__",dd:"__",MM:"__",yy:"__"}[i].split("_"),r%10==1&&r%100!=11?n[0]:r%10>=2&&r%10<=4&&(r%100<10||r%100>=20)?n[1]:n[2])}e.defineLocale("be",{months:{format:"___________".split("_"),standalone:"___________".split("_")},monthsShort:"___________".split("_"),weekdays:{format:"______".split("_"),standalone:"______".split("_"),isFormat:/\[ ?[] ?(?:|)? ?\] ?dddd/},weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., HH:mm",LLLL:"dddd, D MMMM YYYY ., HH:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",lastDay:"[ ] LT",nextWeek:function(){return"[] dddd [] LT"},lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return"[ ] dddd [] LT";case 1:case 2:case 4:return"[ ] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:t,mm:t,h:t,hh:t,d:"",dd:t,M:"",MM:t,y:"",yy:t},meridiemParse:/|||/,isPM:function(e){return/^(|)$/.test(e)},meridiem:function(e,t,i){return e<4?"":e<12?"":e<17?"":""},dayOfMonthOrdinalParse:/\d{1,2}-(||)/,ordinal:function(e,t){switch(t){case"M":case"d":case"DDD":case"w":case"W":return e%10!=2&&e%10!=3||e%100==12||e%100==13?e+"-":e+"-";case"D":return e+"-";default:return e}},week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("bg",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"D.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[] dddd [] LT";case 1:case 2:case 4:case 5:return"[] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",w:"",ww:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}-(|||||)/,ordinal:function(e){var t=e%10,i=e%100;return 0===e?e+"-":0===i?e+"-":i>10&&i<20?e+"-":1===t?e+"-":2===t?e+"-":7===t||8===t?e+"-":e+"-"},week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("bm",{months:"Zanwuyekalo_Fewuruyekalo_Marisikalo_Awirilikalo_Mkalo_Zuwnkalo_Zuluyekalo_Utikalo_Stanburukalo_kutburukalo_Nowanburukalo_Desanburukalo".split("_"),monthsShort:"Zan_Few_Mar_Awi_M_Zuw_Zul_Uti_St_ku_Now_Des".split("_"),weekdays:"Kari_Ntnn_Tarata_Araba_Alamisa_Juma_Sibiri".split("_"),weekdaysShort:"Kar_Nt_Tar_Ara_Ala_Jum_Sib".split("_"),weekdaysMin:"Ka_Nt_Ta_Ar_Al_Ju_Si".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"MMMM [tile] D [san] YYYY",LLL:"MMMM [tile] D [san] YYYY [lr] HH:mm",LLLL:"dddd MMMM [tile] D [san] YYYY [lr] HH:mm"},calendar:{sameDay:"[Bi lr] LT",nextDay:"[Sini lr] LT",nextWeek:"dddd [don lr] LT",lastDay:"[Kunu lr] LT",lastWeek:"dddd [tmnen lr] LT",sameElse:"L"},relativeTime:{future:"%s kn",past:"a b %s b",s:"sanga dama dama",ss:"sekondi %d",m:"miniti kelen",mm:"miniti %d",h:"lr kelen",hh:"lr %d",d:"tile kelen",dd:"tile %d",M:"kalo kelen",MM:"kalo %d",y:"san kelen",yy:"san %d"},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},i={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};e.defineLocale("bn",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm ",LLLL:"dddd, D MMMM YYYY, A h:mm "},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(e){return e.replace(/[]/g,(function(e){return i[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/||||/,meridiemHour:function(e,t){return 12===e&&(e=0),""===t&&e>=4||""===t&&e<5||""===t?e+12:e},meridiem:function(e,t,i){return e<4?"":e<10?"":e<17?"":e<20?"":""},week:{dow:0,doy:6}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},i={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};e.defineLocale("bn-bd",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm ",LLLL:"dddd, D MMMM YYYY, A h:mm "},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(e){return e.replace(/[]/g,(function(e){return i[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/||||||/,meridiemHour:function(e,t){return 12===e&&(e=0),""===t?e<4?e:e+12:""===t||""===t?e:""===t?e>=3?e:e+12:""===t||""===t?e+12:void 0},meridiem:function(e,t,i){return e<4?"":e<6?"":e<12?"":e<15?"":e<18?"":e<20?"":""},week:{dow:0,doy:6}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},i={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};e.defineLocale("bo",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),monthsShortRegex:/^(\d{1,2})/,monthsParseExact:true,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm",LLLL:"dddd, D MMMM YYYY, A h:mm"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[], LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},preparse:function(e){return e.replace(/[]/g,(function(e){return i[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/||||/,meridiemHour:function(e,t){return 12===e&&(e=0),""===t&&e>=4||""===t&&e<5||""===t?e+12:e},meridiem:function(e,t,i){return e<4?"":e<10?"":e<17?"":e<20?"":""},week:{dow:0,doy:6}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
function t(e,t,i){return e+" "+function(e,t){return 2===t?function(e){var t={m:"v",b:"v",d:"z"};return void 0===t[e.charAt(0)]?e:t[e.charAt(0)]+e.substring(1)}(e):e}({mm:"munutenn",MM:"miz",dd:"devezh"}[i],e)}var i=[/^gen/i,/^c[\']hwe/i,/^meu/i,/^ebr/i,/^mae/i,/^(mez|eve)/i,/^gou/i,/^eos/i,/^gwe/i,/^her/i,/^du/i,/^ker/i],r=/^(genver|c[\']hwevrer|meurzh|ebrel|mae|mezheven|gouere|eost|gwengolo|here|du|kerzu|gen|c[\']hwe|meu|ebr|mae|eve|gou|eos|gwe|her|du|ker)/i,n=[/^Su/i,/^Lu/i,/^Me([^r]|$)/i,/^Mer/i,/^Ya/i,/^Gw/i,/^Sa/i];e.defineLocale("br",{months:"Genver_Chwevrer_Meurzh_Ebrel_Mae_Mezheven_Gouere_Eost_Gwengolo_Here_Du_Kerzu".split("_"),monthsShort:"Gen_Chwe_Meu_Ebr_Mae_Eve_Gou_Eos_Gwe_Her_Du_Ker".split("_"),weekdays:"Sul_Lun_Meurzh_Mercher_Yaou_Gwener_Sadorn".split("_"),weekdaysShort:"Sul_Lun_Meu_Mer_Yao_Gwe_Sad".split("_"),weekdaysMin:"Su_Lu_Me_Mer_Ya_Gw_Sa".split("_"),weekdaysParse:n,fullWeekdaysParse:[/^sul/i,/^lun/i,/^meurzh/i,/^merc[\']her/i,/^yaou/i,/^gwener/i,/^sadorn/i],shortWeekdaysParse:[/^Sul/i,/^Lun/i,/^Meu/i,/^Mer/i,/^Yao/i,/^Gwe/i,/^Sad/i],minWeekdaysParse:n,monthsRegex:r,monthsShortRegex:r,monthsStrictRegex:/^(genver|c[\']hwevrer|meurzh|ebrel|mae|mezheven|gouere|eost|gwengolo|here|du|kerzu)/i,monthsShortStrictRegex:/^(gen|c[\']hwe|meu|ebr|mae|eve|gou|eos|gwe|her|du|ker)/i,monthsParse:i,longMonthsParse:i,shortMonthsParse:i,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [a viz] MMMM YYYY",LLL:"D [a viz] MMMM YYYY HH:mm",LLLL:"dddd, D [a viz] MMMM YYYY HH:mm"},calendar:{sameDay:"[Hiziv da] LT",nextDay:"[Warchoazh da] LT",nextWeek:"dddd [da] LT",lastDay:"[Dech da] LT",lastWeek:"dddd [paset da] LT",sameElse:"L"},relativeTime:{future:"a-benn %s",past:"%s zo",s:"un nebeud segondenno",ss:"%d eilenn",m:"ur vunutenn",mm:t,h:"un eur",hh:"%d eur",d:"un devezh",dd:t,M:"ur miz",MM:t,y:"ur bloaz",yy:function(e){switch(function e(t){return t>9?e(t%10):t}(e)){case 1:case 3:case 4:case 5:case 9:return e+" bloaz";default:return e+" vloaz"}}},dayOfMonthOrdinalParse:/\d{1,2}(a|vet)/,ordinal:function(e){return e+(1===e?"a":"vet")},week:{dow:1,doy:4},meridiemParse:/a.m.|g.m./,isPM:function(e){return"g.m."===e},meridiem:function(e,t,i){return e<12?"a.m.":"g.m."}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
function t(e,t,i){var r=e+" ";switch(i){case"ss":return r+=1===e?"sekunda":2===e||3===e||4===e?"sekunde":"sekundi";case"m":return t?"jedna minuta":"jedne minute";case"mm":return r+=1===e?"minuta":2===e||3===e||4===e?"minute":"minuta";case"h":return t?"jedan sat":"jednog sata";case"hh":return r+=1===e?"sat":2===e||3===e||4===e?"sata":"sati";case"dd":return r+=1===e?"dan":"dana";case"MM":return r+=1===e?"mjesec":2===e||3===e||4===e?"mjeseca":"mjeseci";case"yy":return r+=1===e?"godina":2===e||3===e||4===e?"godine":"godina"}}e.defineLocale("bs",{months:"januar_februar_mart_april_maj_juni_juli_august_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._aug._sep._okt._nov._dec.".split("_"),monthsParseExact:true,weekdays:"nedjelja_ponedjeljak_utorak_srijeda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[juer u] LT",lastWeek:function(){switch(this.day()){case 0:case 3:return"[prolu] dddd [u] LT";case 6:return"[prole] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[proli] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",ss:t,m:t,mm:t,h:t,hh:t,d:"dan",dd:t,M:"mjesec",MM:t,y:"godinu",yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("ca",{months:{standalone:"gener_febrer_mar_abril_maig_juny_juliol_agost_setembre_octubre_novembre_desembre".split("_"),format:"de gener_de febrer_de mar_d'abril_de maig_de juny_de juliol_d'agost_de setembre_d'octubre_de novembre_de desembre".split("_"),isFormat:/D[oD]?(\s)+MMMM/},monthsShort:"gen._febr._mar_abr._maig_juny_jul._ag._set._oct._nov._des.".split("_"),monthsParseExact:true,weekdays:"diumenge_dilluns_dimarts_dimecres_dijous_divendres_dissabte".split("_"),weekdaysShort:"dg._dl._dt._dc._dj._dv._ds.".split("_"),weekdaysMin:"dg_dl_dt_dc_dj_dv_ds".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM [de] YYYY",ll:"D MMM YYYY",LLL:"D MMMM [de] YYYY [a les] H:mm",lll:"D MMM YYYY, H:mm",LLLL:"dddd D MMMM [de] YYYY [a les] H:mm",llll:"ddd D MMM YYYY, H:mm"},calendar:{sameDay:function(){return"[avui a "+(1!==this.hours()?"les":"la")+"] LT"},nextDay:function(){return"[dem a "+(1!==this.hours()?"les":"la")+"] LT"},nextWeek:function(){return"dddd [a "+(1!==this.hours()?"les":"la")+"] LT"},lastDay:function(){return"[ahir a "+(1!==this.hours()?"les":"la")+"] LT"},lastWeek:function(){return"[el] dddd [passat a "+(1!==this.hours()?"les":"la")+"] LT"},sameElse:"L"},relativeTime:{future:"d'aqu %s",past:"fa %s",s:"uns segons",ss:"%d segons",m:"un minut",mm:"%d minuts",h:"una hora",hh:"%d hores",d:"un dia",dd:"%d dies",M:"un mes",MM:"%d mesos",y:"un any",yy:"%d anys"},dayOfMonthOrdinalParse:/\d{1,2}(r|n|t||a)/,ordinal:function(e,t){var i=1===e?"r":2===e?"n":3===e?"r":4===e?"t":"";return"w"!==t&&"W"!==t||(i="a"),e+i},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={format:"leden_nor_bezen_duben_kvten_erven_ervenec_srpen_z_jen_listopad_prosinec".split("_"),standalone:"ledna_nora_bezna_dubna_kvtna_ervna_ervence_srpna_z_jna_listopadu_prosince".split("_")},i="led_no_be_dub_kv_vn_vc_srp_z_j_lis_pro".split("_"),r=[/^led/i,/^no/i,/^be/i,/^dub/i,/^kv/i,/^(vn|erven$|ervna)/i,/^(vc|ervenec|ervence)/i,/^srp/i,/^z/i,/^j/i,/^lis/i,/^pro/i],n=/^(leden|nor|bezen|duben|kvten|ervenec|ervence|erven|ervna|srpen|z|jen|listopad|prosinec|led|no|be|dub|kv|vn|vc|srp|z|j|lis|pro)/i;function s(e){return e>1&&e<5&&1!=~~(e/10)}function o(e,t,i,r){var n=e+" ";switch(i){case"s":return t||r?"pr sekund":"pr sekundami";case"ss":return t||r?n+(s(e)?"sekundy":"sekund"):n+"sekundami";case"m":return t?"minuta":r?"minutu":"minutou";case"mm":return t||r?n+(s(e)?"minuty":"minut"):n+"minutami";case"h":return t?"hodina":r?"hodinu":"hodinou";case"hh":return t||r?n+(s(e)?"hodiny":"hodin"):n+"hodinami";case"d":return t||r?"den":"dnem";case"dd":return t||r?n+(s(e)?"dny":"dn"):n+"dny";case"M":return t||r?"msc":"mscem";case"MM":return t||r?n+(s(e)?"msce":"msc"):n+"msci";case"y":return t||r?"rok":"rokem";case"yy":return t||r?n+(s(e)?"roky":"let"):n+"lety"}}e.defineLocale("cs",{months:t,monthsShort:i,monthsRegex:n,monthsShortRegex:n,monthsStrictRegex:/^(leden|ledna|nora|nor|bezen|bezna|duben|dubna|kvten|kvtna|ervenec|ervence|erven|ervna|srpen|srpna|z|jen|jna|listopadu|listopad|prosinec|prosince)/i,monthsShortStrictRegex:/^(led|no|be|dub|kv|vn|vc|srp|z|j|lis|pro)/i,monthsParse:r,longMonthsParse:r,shortMonthsParse:r,weekdays:"nedle_pondl_ter_steda_tvrtek_ptek_sobota".split("_"),weekdaysShort:"ne_po_t_st_t_p_so".split("_"),weekdaysMin:"ne_po_t_st_t_p_so".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd D. MMMM YYYY H:mm",l:"D. M. YYYY"},calendar:{sameDay:"[dnes v] LT",nextDay:"[ztra v] LT",nextWeek:function(){switch(this.day()){case 0:return"[v nedli v] LT";case 1:case 2:return"[v] dddd [v] LT";case 3:return"[ve stedu v] LT";case 4:return"[ve tvrtek v] LT";case 5:return"[v ptek v] LT";case 6:return"[v sobotu v] LT"}},lastDay:"[vera v] LT",lastWeek:function(){switch(this.day()){case 0:return"[minulou nedli v] LT";case 1:case 2:return"[minul] dddd [v] LT";case 3:return"[minulou stedu v] LT";case 4:case 5:return"[minul] dddd [v] LT";case 6:return"[minulou sobotu v] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"ped %s",s:o,ss:o,m:o,mm:o,h:o,hh:o,d:o,dd:o,M:o,MM:o,y:o,yy:o},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("cv",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD-MM-YYYY",LL:"YYYY [] MMMM [] D[-]",LLL:"YYYY [] MMMM [] D[-], HH:mm",LLLL:"dddd, YYYY [] MMMM [] D[-], HH:mm"},calendar:{sameDay:"[] LT []",nextDay:"[] LT []",lastDay:"[] LT []",nextWeek:"[] dddd LT []",lastWeek:"[] dddd LT []",sameElse:"L"},relativeTime:{future:function(e){return e+(/$/i.exec(e)?"":/$/i.exec(e)?"":"")},past:"%s ",s:"- ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}-/,ordinal:"%d-",week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("cy",{months:"Ionawr_Chwefror_Mawrth_Ebrill_Mai_Mehefin_Gorffennaf_Awst_Medi_Hydref_Tachwedd_Rhagfyr".split("_"),monthsShort:"Ion_Chwe_Maw_Ebr_Mai_Meh_Gor_Aws_Med_Hyd_Tach_Rhag".split("_"),weekdays:"Dydd Sul_Dydd Llun_Dydd Mawrth_Dydd Mercher_Dydd Iau_Dydd Gwener_Dydd Sadwrn".split("_"),weekdaysShort:"Sul_Llun_Maw_Mer_Iau_Gwe_Sad".split("_"),weekdaysMin:"Su_Ll_Ma_Me_Ia_Gw_Sa".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Heddiw am] LT",nextDay:"[Yfory am] LT",nextWeek:"dddd [am] LT",lastDay:"[Ddoe am] LT",lastWeek:"dddd [diwethaf am] LT",sameElse:"L"},relativeTime:{future:"mewn %s",past:"%s yn l",s:"ychydig eiliadau",ss:"%d eiliad",m:"munud",mm:"%d munud",h:"awr",hh:"%d awr",d:"diwrnod",dd:"%d diwrnod",M:"mis",MM:"%d mis",y:"blwyddyn",yy:"%d flynedd"},dayOfMonthOrdinalParse:/\d{1,2}(fed|ain|af|il|ydd|ed|eg)/,ordinal:function(e){var t="";return e>20?t=40===e||50===e||60===e||80===e||100===e?"fed":"ain":e>0&&(t=["","af","il","ydd","ydd","ed","ed","ed","fed","fed","fed","eg","fed","eg","eg","fed","eg","eg","fed","eg","fed"][e]),e+t},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("da",{months:"januar_februar_marts_april_maj_juni_juli_august_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"sndag_mandag_tirsdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"sn_man_tir_ons_tor_fre_lr".split("_"),weekdaysMin:"s_ma_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd [d.] D. MMMM YYYY [kl.] HH:mm"},calendar:{sameDay:"[i dag kl.] LT",nextDay:"[i morgen kl.] LT",nextWeek:"p dddd [kl.] LT",lastDay:"[i gr kl.] LT",lastWeek:"[i] dddd[s kl.] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s siden",s:"f sekunder",ss:"%d sekunder",m:"et minut",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dage",M:"en mned",MM:"%d mneder",y:"et r",yy:"%d r"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
function t(e,t,i,r){var n={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[e+" Tage",e+" Tagen"],w:["eine Woche","einer Woche"],M:["ein Monat","einem Monat"],MM:[e+" Monate",e+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[e+" Jahre",e+" Jahren"]};return t?n[i][0]:n[i][1]}e.defineLocale("de",{months:"Januar_Februar_Mrz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Feb._Mrz_Apr._Mai_Juni_Juli_Aug._Sep._Okt._Nov._Dez.".split("_"),monthsParseExact:true,weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd, D. MMMM YYYY HH:mm"},calendar:{sameDay:"[heute um] LT [Uhr]",sameElse:"L",nextDay:"[morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",ss:"%d Sekunden",m:t,mm:"%d Minuten",h:t,hh:"%d Stunden",d:t,dd:t,w:t,ww:"%d Wochen",M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
function t(e,t,i,r){var n={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[e+" Tage",e+" Tagen"],w:["eine Woche","einer Woche"],M:["ein Monat","einem Monat"],MM:[e+" Monate",e+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[e+" Jahre",e+" Jahren"]};return t?n[i][0]:n[i][1]}e.defineLocale("de-at",{months:"Jnner_Februar_Mrz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jn._Feb._Mrz_Apr._Mai_Juni_Juli_Aug._Sep._Okt._Nov._Dez.".split("_"),monthsParseExact:true,weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd, D. MMMM YYYY HH:mm"},calendar:{sameDay:"[heute um] LT [Uhr]",sameElse:"L",nextDay:"[morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",ss:"%d Sekunden",m:t,mm:"%d Minuten",h:t,hh:"%d Stunden",d:t,dd:t,w:t,ww:"%d Wochen",M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
function t(e,t,i,r){var n={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[e+" Tage",e+" Tagen"],w:["eine Woche","einer Woche"],M:["ein Monat","einem Monat"],MM:[e+" Monate",e+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[e+" Jahre",e+" Jahren"]};return t?n[i][0]:n[i][1]}e.defineLocale("de-ch",{months:"Januar_Februar_Mrz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Feb._Mrz_Apr._Mai_Juni_Juli_Aug._Sep._Okt._Nov._Dez.".split("_"),monthsParseExact:true,weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd, D. MMMM YYYY HH:mm"},calendar:{sameDay:"[heute um] LT [Uhr]",sameElse:"L",nextDay:"[morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",ss:"%d Sekunden",m:t,mm:"%d Minuten",h:t,hh:"%d Stunden",d:t,dd:t,w:t,ww:"%d Wochen",M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t=["","","","","","","","","","","",""],i=["","","","","","",""];e.defineLocale("dv",{months:t,monthsShort:t,weekdays:i,weekdaysShort:i,weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"D/M/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(e){return""===e},meridiem:function(e,t,i){return e<12?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd LT",lastDay:"[] LT",lastWeek:"[] dddd LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:"",ss:"d% ",m:"",mm:" %d",h:"",hh:" %d",d:"",dd:" %d",M:"",MM:" %d",y:"",yy:" %d"},preparse:function(e){return e.replace(//g,",")},postformat:function(e){return e.replace(/,/g,"")},week:{dow:7,doy:12}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("el",{monthsNominativeEl:"___________".split("_"),monthsGenitiveEl:"___________".split("_"),months:function(e,t){return e?"string"==typeof t&&/D/.test(t.substring(0,t.indexOf("MMMM")))?this._monthsGenitiveEl[e.month()]:this._monthsNominativeEl[e.month()]:this._monthsNominativeEl},monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),meridiem:function(e,t,i){return e>11?i?"":"":i?"":""},isPM:function(e){return""===(e+"").toLowerCase()[0]},meridiemParse:/[]\.??\.?/i,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendarEl:{sameDay:"[ {}] LT",nextDay:"[ {}] LT",nextWeek:"dddd [{}] LT",lastDay:"[ {}] LT",lastWeek:function(){switch(this.day()){case 6:return"[ ] dddd [{}] LT";default:return"[ ] dddd [{}] LT"}},sameElse:"L"},calendar:function(e,t){var i,r=this._calendarEl[e],n=t&&t.hours();return i=r,("undefined"!=typeof Function&&i instanceof Function||"[object Function]"===Object.prototype.toString.call(i))&&(r=r.apply(t)),r.replace("{}",n%12==1?"":"")},relativeTime:{future:" %s",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("en-au",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:0,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("en-ca",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"YYYY-MM-DD",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("en-gb",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("en-ie",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("en-il",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("en-in",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:0,doy:6}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("en-nz",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("en-sg",{months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("eo",{months:"januaro_februaro_marto_aprilo_majo_junio_julio_agusto_septembro_oktobro_novembro_decembro".split("_"),monthsShort:"jan_feb_mart_apr_maj_jun_jul_ag_sept_okt_nov_dec".split("_"),weekdays:"dimano_lundo_mardo_merkredo_ado_vendredo_sabato".split("_"),weekdaysShort:"dim_lun_mard_merk_a_ven_sab".split("_"),weekdaysMin:"di_lu_ma_me_a_ve_sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"[la] D[-an de] MMMM, YYYY",LLL:"[la] D[-an de] MMMM, YYYY HH:mm",LLLL:"dddd[n], [la] D[-an de] MMMM, YYYY HH:mm",llll:"ddd, [la] D[-an de] MMM, YYYY HH:mm"},meridiemParse:/[ap]\.t\.m/i,isPM:function(e){return"p"===e.charAt(0).toLowerCase()},meridiem:function(e,t,i){return e>11?i?"p.t.m.":"P.T.M.":i?"a.t.m.":"A.T.M."},calendar:{sameDay:"[Hodia je] LT",nextDay:"[Morga je] LT",nextWeek:"dddd[n je] LT",lastDay:"[Hiera je] LT",lastWeek:"[pasintan] dddd[n je] LT",sameElse:"L"},relativeTime:{future:"post %s",past:"anta %s",s:"kelkaj sekundoj",ss:"%d sekundoj",m:"unu minuto",mm:"%d minutoj",h:"unu horo",hh:"%d horoj",d:"unu tago",dd:"%d tagoj",M:"unu monato",MM:"%d monatoj",y:"unu jaro",yy:"%d jaroj"},dayOfMonthOrdinalParse:/\d{1,2}a/,ordinal:"%da",week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),i="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),r=[/^ene/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i],n=/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i;e.defineLocale("es",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(e,r){return e?/-MMM-/.test(r)?i[e.month()]:t[e.month()]:t},monthsRegex:n,monthsShortRegex:n,monthsStrictRegex:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,monthsShortStrictRegex:/^(ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i,monthsParse:r,longMonthsParse:r,shortMonthsParse:r,weekdays:"domingo_lunes_martes_mircoles_jueves_viernes_sbado".split("_"),weekdaysShort:"dom._lun._mar._mi._jue._vie._sb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_s".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[maana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un da",dd:"%d das",w:"una semana",ww:"%d semanas",M:"un mes",MM:"%d meses",y:"un ao",yy:"%d aos"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4},invalidDate:"Fecha invlida"})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),i="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),r=[/^ene/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i],n=/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i;e.defineLocale("es-do",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(e,r){return e?/-MMM-/.test(r)?i[e.month()]:t[e.month()]:t},monthsRegex:n,monthsShortRegex:n,monthsStrictRegex:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,monthsShortStrictRegex:/^(ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i,monthsParse:r,longMonthsParse:r,shortMonthsParse:r,weekdays:"domingo_lunes_martes_mircoles_jueves_viernes_sbado".split("_"),weekdaysShort:"dom._lun._mar._mi._jue._vie._sb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_s".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY h:mm A",LLLL:"dddd, D [de] MMMM [de] YYYY h:mm A"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[maana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un da",dd:"%d das",w:"una semana",ww:"%d semanas",M:"un mes",MM:"%d meses",y:"un ao",yy:"%d aos"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),i="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),r=[/^ene/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i],n=/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i;e.defineLocale("es-mx",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(e,r){return e?/-MMM-/.test(r)?i[e.month()]:t[e.month()]:t},monthsRegex:n,monthsShortRegex:n,monthsStrictRegex:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,monthsShortStrictRegex:/^(ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i,monthsParse:r,longMonthsParse:r,shortMonthsParse:r,weekdays:"domingo_lunes_martes_mircoles_jueves_viernes_sbado".split("_"),weekdaysShort:"dom._lun._mar._mi._jue._vie._sb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_s".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[maana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un da",dd:"%d das",w:"una semana",ww:"%d semanas",M:"un mes",MM:"%d meses",y:"un ao",yy:"%d aos"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:0,doy:4},invalidDate:"Fecha invlida"})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),i="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),r=[/^ene/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i],n=/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i;e.defineLocale("es-us",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(e,r){return e?/-MMM-/.test(r)?i[e.month()]:t[e.month()]:t},monthsRegex:n,monthsShortRegex:n,monthsStrictRegex:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i,monthsShortStrictRegex:/^(ene\.?|feb\.?|mar\.?|abr\.?|may\.?|jun\.?|jul\.?|ago\.?|sep\.?|oct\.?|nov\.?|dic\.?)/i,monthsParse:r,longMonthsParse:r,shortMonthsParse:r,weekdays:"domingo_lunes_martes_mircoles_jueves_viernes_sbado".split("_"),weekdaysShort:"dom._lun._mar._mi._jue._vie._sb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_s".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"MM/DD/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY h:mm A",LLLL:"dddd, D [de] MMMM [de] YYYY h:mm A"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[maana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un da",dd:"%d das",w:"una semana",ww:"%d semanas",M:"un mes",MM:"%d meses",y:"un ao",yy:"%d aos"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:0,doy:6}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
function t(e,t,i,r){var n={s:["mne sekundi","mni sekund","paar sekundit"],ss:[e+"sekundi",e+"sekundit"],m:["he minuti","ks minut"],mm:[e+" minuti",e+" minutit"],h:["he tunni","tund aega","ks tund"],hh:[e+" tunni",e+" tundi"],d:["he peva","ks pev"],M:["kuu aja","kuu aega","ks kuu"],MM:[e+" kuu",e+" kuud"],y:["he aasta","aasta","ks aasta"],yy:[e+" aasta",e+" aastat"]};return t?n[i][2]?n[i][2]:n[i][1]:r?n[i][0]:n[i][1]}e.defineLocale("et",{months:"jaanuar_veebruar_mrts_aprill_mai_juuni_juuli_august_september_oktoober_november_detsember".split("_"),monthsShort:"jaan_veebr_mrts_apr_mai_juuni_juuli_aug_sept_okt_nov_dets".split("_"),weekdays:"phapev_esmaspev_teisipev_kolmapev_neljapev_reede_laupev".split("_"),weekdaysShort:"P_E_T_K_N_R_L".split("_"),weekdaysMin:"P_E_T_K_N_R_L".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[Tna,] LT",nextDay:"[Homme,] LT",nextWeek:"[Jrgmine] dddd LT",lastDay:"[Eile,] LT",lastWeek:"[Eelmine] dddd LT",sameElse:"L"},relativeTime:{future:"%s prast",past:"%s tagasi",s:t,ss:t,m:t,mm:t,h:t,hh:t,d:t,dd:"%d peva",M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("eu",{months:"urtarrila_otsaila_martxoa_apirila_maiatza_ekaina_uztaila_abuztua_iraila_urria_azaroa_abendua".split("_"),monthsShort:"urt._ots._mar._api._mai._eka._uzt._abu._ira._urr._aza._abe.".split("_"),monthsParseExact:true,weekdays:"igandea_astelehena_asteartea_asteazkena_osteguna_ostirala_larunbata".split("_"),weekdaysShort:"ig._al._ar._az._og._ol._lr.".split("_"),weekdaysMin:"ig_al_ar_az_og_ol_lr".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY[ko] MMMM[ren] D[a]",LLL:"YYYY[ko] MMMM[ren] D[a] HH:mm",LLLL:"dddd, YYYY[ko] MMMM[ren] D[a] HH:mm",l:"YYYY-M-D",ll:"YYYY[ko] MMM D[a]",lll:"YYYY[ko] MMM D[a] HH:mm",llll:"ddd, YYYY[ko] MMM D[a] HH:mm"},calendar:{sameDay:"[gaur] LT[etan]",nextDay:"[bihar] LT[etan]",nextWeek:"dddd LT[etan]",lastDay:"[atzo] LT[etan]",lastWeek:"[aurreko] dddd LT[etan]",sameElse:"L"},relativeTime:{future:"%s barru",past:"duela %s",s:"segundo batzuk",ss:"%d segundo",m:"minutu bat",mm:"%d minutu",h:"ordu bat",hh:"%d ordu",d:"egun bat",dd:"%d egun",M:"hilabete bat",MM:"%d hilabete",y:"urte bat",yy:"%d urte"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},i={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};e.defineLocale("fa",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},meridiemParse:/  |  /,isPM:function(e){return/  /.test(e)},meridiem:function(e,t,i){return e<12?"  ":"  "},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] [] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(e){return e.replace(/[-]/g,(function(e){return i[e]})).replace(//g,",")},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]})).replace(/,/g,"")},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:6,doy:12}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t="nolla yksi kaksi kolme nelj viisi kuusi seitsemn kahdeksan yhdeksn".split(" "),i=["nolla","yhden","kahden","kolmen","neljn","viiden","kuuden",t[7],t[8],t[9]];function r(e,r,n,s){var o="";switch(n){case"s":return s?"muutaman sekunnin":"muutama sekunti";case"ss":o=s?"sekunnin":"sekuntia";break;case"m":return s?"minuutin":"minuutti";case"mm":o=s?"minuutin":"minuuttia";break;case"h":return s?"tunnin":"tunti";case"hh":o=s?"tunnin":"tuntia";break;case"d":return s?"pivn":"piv";case"dd":o=s?"pivn":"piv";break;case"M":return s?"kuukauden":"kuukausi";case"MM":o=s?"kuukauden":"kuukautta";break;case"y":return s?"vuoden":"vuosi";case"yy":o=s?"vuoden":"vuotta"}return o=function(e,r){return e<10?r?i[e]:t[e]:e}(e,s)+" "+o}e.defineLocale("fi",{months:"tammikuu_helmikuu_maaliskuu_huhtikuu_toukokuu_keskuu_heinkuu_elokuu_syyskuu_lokakuu_marraskuu_joulukuu".split("_"),monthsShort:"tammi_helmi_maalis_huhti_touko_kes_hein_elo_syys_loka_marras_joulu".split("_"),weekdays:"sunnuntai_maanantai_tiistai_keskiviikko_torstai_perjantai_lauantai".split("_"),weekdaysShort:"su_ma_ti_ke_to_pe_la".split("_"),weekdaysMin:"su_ma_ti_ke_to_pe_la".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD.MM.YYYY",LL:"Do MMMM[ta] YYYY",LLL:"Do MMMM[ta] YYYY, [klo] HH.mm",LLLL:"dddd, Do MMMM[ta] YYYY, [klo] HH.mm",l:"D.M.YYYY",ll:"Do MMM YYYY",lll:"Do MMM YYYY, [klo] HH.mm",llll:"ddd, Do MMM YYYY, [klo] HH.mm"},calendar:{sameDay:"[tnn] [klo] LT",nextDay:"[huomenna] [klo] LT",nextWeek:"dddd [klo] LT",lastDay:"[eilen] [klo] LT",lastWeek:"[viime] dddd[na] [klo] LT",sameElse:"L"},relativeTime:{future:"%s pst",past:"%s sitten",s:r,ss:r,m:r,mm:r,h:r,hh:r,d:r,dd:r,M:r,MM:r,y:r,yy:r},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("fil",{months:"Enero_Pebrero_Marso_Abril_Mayo_Hunyo_Hulyo_Agosto_Setyembre_Oktubre_Nobyembre_Disyembre".split("_"),monthsShort:"Ene_Peb_Mar_Abr_May_Hun_Hul_Ago_Set_Okt_Nob_Dis".split("_"),weekdays:"Linggo_Lunes_Martes_Miyerkules_Huwebes_Biyernes_Sabado".split("_"),weekdaysShort:"Lin_Lun_Mar_Miy_Huw_Biy_Sab".split("_"),weekdaysMin:"Li_Lu_Ma_Mi_Hu_Bi_Sab".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"MM/D/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY HH:mm",LLLL:"dddd, MMMM DD, YYYY HH:mm"},calendar:{sameDay:"LT [ngayong araw]",nextDay:"[Bukas ng] LT",nextWeek:"LT [sa susunod na] dddd",lastDay:"LT [kahapon]",lastWeek:"LT [noong nakaraang] dddd",sameElse:"L"},relativeTime:{future:"sa loob ng %s",past:"%s ang nakalipas",s:"ilang segundo",ss:"%d segundo",m:"isang minuto",mm:"%d minuto",h:"isang oras",hh:"%d oras",d:"isang araw",dd:"%d araw",M:"isang buwan",MM:"%d buwan",y:"isang taon",yy:"%d taon"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(e){return e},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("fo",{months:"januar_februar_mars_aprl_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),weekdays:"sunnudagur_mnadagur_tsdagur_mikudagur_hsdagur_frggjadagur_leygardagur".split("_"),weekdaysShort:"sun_mn_ts_mik_hs_fr_ley".split("_"),weekdaysMin:"su_m_t_mi_h_fr_le".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D. MMMM, YYYY HH:mm"},calendar:{sameDay:"[ dag kl.] LT",nextDay:"[ morgin kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[ gjr kl.] LT",lastWeek:"[sstu] dddd [kl] LT",sameElse:"L"},relativeTime:{future:"um %s",past:"%s sani",s:"f sekund",ss:"%d sekundir",m:"ein minuttur",mm:"%d minuttir",h:"ein tmi",hh:"%d tmar",d:"ein dagur",dd:"%d dagar",M:"ein mnaur",MM:"%d mnair",y:"eitt r",yy:"%d r"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t=/(janv\.?|fvr\.?|mars|avr\.?|mai|juin|juil\.?|aot|sept\.?|oct\.?|nov\.?|dc\.?|janvier|fvrier|mars|avril|mai|juin|juillet|aot|septembre|octobre|novembre|dcembre)/i,i=[/^janv/i,/^fvr/i,/^mars/i,/^avr/i,/^mai/i,/^juin/i,/^juil/i,/^aot/i,/^sept/i,/^oct/i,/^nov/i,/^dc/i];e.defineLocale("fr",{months:"janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),monthsShort:"janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),monthsRegex:t,monthsShortRegex:t,monthsStrictRegex:/^(janvier|fvrier|mars|avril|mai|juin|juillet|aot|septembre|octobre|novembre|dcembre)/i,monthsShortStrictRegex:/(janv\.?|fvr\.?|mars|avr\.?|mai|juin|juil\.?|aot|sept\.?|oct\.?|nov\.?|dc\.?)/i,monthsParse:i,longMonthsParse:i,shortMonthsParse:i,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"di_lu_ma_me_je_ve_sa".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourdhui ] LT",nextDay:"[Demain ] LT",nextWeek:"dddd [] LT",lastDay:"[Hier ] LT",lastWeek:"dddd [dernier ] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",ss:"%d secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",w:"une semaine",ww:"%d semaines",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|)/,ordinal:function(e,t){switch(t){case"D":return e+(1===e?"er":"");default:case"M":case"Q":case"DDD":case"d":return e+(1===e?"er":"e");case"w":case"W":return e+(1===e?"re":"e")}},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("fr-ca",{months:"janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),monthsShort:"janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),monthsParseExact:true,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"di_lu_ma_me_je_ve_sa".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourdhui ] LT",nextDay:"[Demain ] LT",nextWeek:"dddd [] LT",lastDay:"[Hier ] LT",lastWeek:"dddd [dernier ] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",ss:"%d secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|e)/,ordinal:function(e,t){switch(t){default:case"M":case"Q":case"D":case"DDD":case"d":return e+(1===e?"er":"e");case"w":case"W":return e+(1===e?"re":"e")}}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("fr-ch",{months:"janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),monthsShort:"janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),monthsParseExact:true,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"di_lu_ma_me_je_ve_sa".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourdhui ] LT",nextDay:"[Demain ] LT",nextWeek:"dddd [] LT",lastDay:"[Hier ] LT",lastWeek:"dddd [dernier ] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",ss:"%d secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(er|e)/,ordinal:function(e,t){switch(t){default:case"M":case"Q":case"D":case"DDD":case"d":return e+(1===e?"er":"e");case"w":case"W":return e+(1===e?"re":"e")}},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t="jan._feb._mrt._apr._mai_jun._jul._aug._sep._okt._nov._des.".split("_"),i="jan_feb_mrt_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_");e.defineLocale("fy",{months:"jannewaris_febrewaris_maart_april_maaie_juny_july_augustus_septimber_oktober_novimber_desimber".split("_"),monthsShort:function(e,r){return e?/-MMM-/.test(r)?i[e.month()]:t[e.month()]:t},monthsParseExact:true,weekdays:"snein_moandei_tiisdei_woansdei_tongersdei_freed_sneon".split("_"),weekdaysShort:"si._mo._ti._wo._to._fr._so.".split("_"),weekdaysMin:"Si_Mo_Ti_Wo_To_Fr_So".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[hjoed om] LT",nextDay:"[moarn om] LT",nextWeek:"dddd [om] LT",lastDay:"[juster om] LT",lastWeek:"[frne] dddd [om] LT",sameElse:"L"},relativeTime:{future:"oer %s",past:"%s lyn",s:"in pear sekonden",ss:"%d sekonden",m:"ien mint",mm:"%d minuten",h:"ien oere",hh:"%d oeren",d:"ien dei",dd:"%d dagen",M:"ien moanne",MM:"%d moannen",y:"ien jier",yy:"%d jierren"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(e){return e+(1===e||8===e||e>=20?"ste":"de")},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("ga",{months:["Eanir","Feabhra","Mrta","Aibren","Bealtaine","Meitheamh","Iil","Lnasa","Men Fmhair","Deireadh Fmhair","Samhain","Nollaig"],monthsShort:["Ean","Feabh","Mrt","Aib","Beal","Meith","Iil","Ln","M.F.","D.F.","Samh","Noll"],monthsParseExact:true,weekdays:["D Domhnaigh","D Luain","D Mirt","D Cadaoin","Dardaoin","D hAoine","D Sathairn"],weekdaysShort:["Domh","Luan","Mirt","Cad","Dar","Aoine","Sath"],weekdaysMin:["Do","Lu","M","C","D","A","Sa"],longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Inniu ag] LT",nextDay:"[Amrach ag] LT",nextWeek:"dddd [ag] LT",lastDay:"[Inn ag] LT",lastWeek:"dddd [seo caite] [ag] LT",sameElse:"L"},relativeTime:{future:"i %s",past:"%s  shin",s:"cpla soicind",ss:"%d soicind",m:"nimad",mm:"%d nimad",h:"uair an chloig",hh:"%d uair an chloig",d:"l",dd:"%d l",M:"m",MM:"%d monna",y:"bliain",yy:"%d bliain"},dayOfMonthOrdinalParse:/\d{1,2}(d|na|mh)/,ordinal:function(e){return e+(1===e?"d":e%10==2?"na":"mh")},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("gd",{months:["Am Faoilleach","An Gearran","Am Mrt","An Giblean","An Citean","An t-gmhios","An t-Iuchar","An Lnastal","An t-Sultain","An Dmhair","An t-Samhain","An Dbhlachd"],monthsShort:["Faoi","Gear","Mrt","Gibl","Cit","gmh","Iuch","Ln","Sult","Dmh","Samh","Dbh"],monthsParseExact:true,weekdays:["Didmhnaich","Diluain","Dimirt","Diciadain","Diardaoin","Dihaoine","Disathairne"],weekdaysShort:["Did","Dil","Dim","Dic","Dia","Dih","Dis"],weekdaysMin:["D","Lu","M","Ci","Ar","Ha","Sa"],longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[An-diugh aig] LT",nextDay:"[A-mireach aig] LT",nextWeek:"dddd [aig] LT",lastDay:"[An-d aig] LT",lastWeek:"dddd [seo chaidh] [aig] LT",sameElse:"L"},relativeTime:{future:"ann an %s",past:"bho chionn %s",s:"beagan diogan",ss:"%d diogan",m:"mionaid",mm:"%d mionaidean",h:"uair",hh:"%d uairean",d:"latha",dd:"%d latha",M:"mos",MM:"%d mosan",y:"bliadhna",yy:"%d bliadhna"},dayOfMonthOrdinalParse:/\d{1,2}(d|na|mh)/,ordinal:function(e){return e+(1===e?"d":e%10==2?"na":"mh")},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("gl",{months:"xaneiro_febreiro_marzo_abril_maio_xuo_xullo_agosto_setembro_outubro_novembro_decembro".split("_"),monthsShort:"xan._feb._mar._abr._mai._xu._xul._ago._set._out._nov._dec.".split("_"),monthsParseExact:true,weekdays:"domingo_luns_martes_mrcores_xoves_venres_sbado".split("_"),weekdaysShort:"dom._lun._mar._mr._xov._ven._sb.".split("_"),weekdaysMin:"do_lu_ma_m_xo_ve_s".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},calendar:{sameDay:function(){return"[hoxe "+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[ma "+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd ["+(1!==this.hours()?"s":"a")+"] LT"},lastDay:function(){return"[onte "+(1!==this.hours()?"":"a")+"] LT"},lastWeek:function(){return"[o] dddd [pasado "+(1!==this.hours()?"s":"a")+"] LT"},sameElse:"L"},relativeTime:{future:function(e){return 0===e.indexOf("un")?"n"+e:"en "+e},past:"hai %s",s:"uns segundos",ss:"%d segundos",m:"un minuto",mm:"%d minutos",h:"unha hora",hh:"%d horas",d:"un da",dd:"%d das",M:"un mes",MM:"%d meses",y:"un ano",yy:"%d anos"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
function t(e,t,i,r){var n={s:[" "," "],ss:[e+" ",e+" "],m:[" "," "],mm:[e+" ",e+" "],h:[" "," "],hh:[e+" ",e+" "],d:[" "," "],dd:[e+" ",e+" "],M:[" "," "],MM:[e+" ",e+" "],y:[" "," "],yy:[e+" ",e+" "]};return r?n[i][0]:n[i][1]}e.defineLocale("gom-deva",{months:{standalone:"___________".split("_"),format:"___________".split("_"),isFormat:/MMMM(\s)+D[oD]?/},monthsShort:"._.__.___._._._._._.".split("_"),monthsParseExact:true,weekdays:"______".split("_"),weekdaysShort:"._._._._._._.".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"A h:mm []",LTS:"A h:mm:ss []",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY A h:mm []",LLLL:"dddd, MMMM Do, YYYY, A h:mm []",llll:"ddd, D MMM YYYY, A h:mm []"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[] dddd[,] LT",lastDay:"[] LT",lastWeek:"[] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s ",s:t,ss:t,m:t,mm:t,h:t,hh:t,d:t,dd:t,M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}()/,ordinal:function(e,t){switch(t){case"D":return e+"";default:case"M":case"Q":case"DDD":case"d":case"w":case"W":return e}},week:{dow:0,doy:3},meridiemParse:/|||/,meridiemHour:function(e,t){return 12===e&&(e=0),""===t?e<4?e:e+12:""===t?e:""===t?e>12?e:e+12:""===t?e+12:void 0},meridiem:function(e,t,i){return e<4?"":e<12?"":e<16?"":e<20?"":""}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
function t(e,t,i,r){var n={s:["thoddea sekondamni","thodde sekond"],ss:[e+" sekondamni",e+" sekond"],m:["eka mintan","ek minut"],mm:[e+" mintamni",e+" mintam"],h:["eka voran","ek vor"],hh:[e+" voramni",e+" voram"],d:["eka disan","ek dis"],dd:[e+" disamni",e+" dis"],M:["eka mhoinean","ek mhoino"],MM:[e+" mhoineamni",e+" mhoine"],y:["eka vorsan","ek voros"],yy:[e+" vorsamni",e+" vorsam"]};return r?n[i][0]:n[i][1]}e.defineLocale("gom-latn",{months:{standalone:"Janer_Febrer_Mars_Abril_Mai_Jun_Julai_Agost_Setembr_Otubr_Novembr_Dezembr".split("_"),format:"Janerachea_Febrerachea_Marsachea_Abrilachea_Maiachea_Junachea_Julaiachea_Agostachea_Setembrachea_Otubrachea_Novembrachea_Dezembrachea".split("_"),isFormat:/MMMM(\s)+D[oD]?/},monthsShort:"Jan._Feb._Mars_Abr._Mai_Jun_Jul._Ago._Set._Otu._Nov._Dez.".split("_"),monthsParseExact:true,weekdays:"Aitar_Somar_Mongllar_Budhvar_Birestar_Sukrar_Son'var".split("_"),weekdaysShort:"Ait._Som._Mon._Bud._Bre._Suk._Son.".split("_"),weekdaysMin:"Ai_Sm_Mo_Bu_Br_Su_Sn".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"A h:mm [vazta]",LTS:"A h:mm:ss [vazta]",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY A h:mm [vazta]",LLLL:"dddd, MMMM Do, YYYY, A h:mm [vazta]",llll:"ddd, D MMM YYYY, A h:mm [vazta]"},calendar:{sameDay:"[Aiz] LT",nextDay:"[Faleam] LT",nextWeek:"[Fuddlo] dddd[,] LT",lastDay:"[Kal] LT",lastWeek:"[Fattlo] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s adim",s:t,ss:t,m:t,mm:t,h:t,hh:t,d:t,dd:t,M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}(er)/,ordinal:function(e,t){switch(t){case"D":return e+"er";default:case"M":case"Q":case"DDD":case"d":case"w":case"W":return e}},week:{dow:0,doy:3},meridiemParse:/rati|sokallim|donparam|sanje/,meridiemHour:function(e,t){return 12===e&&(e=0),"rati"===t?e<4?e:e+12:"sokallim"===t?e:"donparam"===t?e>12?e:e+12:"sanje"===t?e+12:void 0},meridiem:function(e,t,i){return e<4?"rati":e<12?"sokallim":e<16?"donparam":e<20?"sanje":"rati"}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},i={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};e.defineLocale("gu",{months:"___________".split("_"),monthsShort:"._.__.___._._._._._.".split("_"),monthsParseExact:true,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm ",LLLL:"dddd, D MMMM YYYY, A h:mm "},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(e){return e.replace(/[]/g,(function(e){return i[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/|||/,meridiemHour:function(e,t){return 12===e&&(e=0),""===t?e<4?e:e+12:""===t?e:""===t?e>=10?e:e+12:""===t?e+12:void 0},meridiem:function(e,t,i){return e<4?"":e<10?"":e<17?"":e<20?"":""},week:{dow:0,doy:6}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("he",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D []MMMM YYYY",LLL:"D []MMMM YYYY HH:mm",LLLL:"dddd, D []MMMM YYYY HH:mm",l:"D/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY HH:mm",llll:"ddd, D MMM YYYY HH:mm"},calendar:{sameDay:"[ ]LT",nextDay:"[ ]LT",nextWeek:"dddd [] LT",lastDay:"[ ]LT",lastWeek:"[] dddd [ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",ss:"%d ",m:"",mm:"%d ",h:"",hh:function(e){return 2===e?"":e+" "},d:"",dd:function(e){return 2===e?"":e+" "},M:"",MM:function(e){return 2===e?"":e+" "},y:"",yy:function(e){return 2===e?"":e%10==0&&10!==e?e+" ":e+" "}},meridiemParse:/"|"| | | ||/i,isPM:function(e){return/^("| |)$/.test(e)},meridiem:function(e,t,i){return e<5?" ":e<10?"":e<12?i?'"':" ":e<18?i?'"':" ":""}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},i={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"},r=[/^/i,/^|/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^|/i,/^/i,/^|/i,/^|/i];e.defineLocale("hi",{months:{format:"___________".split("_"),standalone:"___________".split("_")},monthsShort:"._.__.___._._._._._.".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm ",LLLL:"dddd, D MMMM YYYY, A h:mm "},monthsParse:r,longMonthsParse:r,shortMonthsParse:[/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i],monthsRegex:/^(|\.?|||\.?|?||\.?|?|?||\.?||\.?|||\.?||\.?|||\.?|||\.?)/i,monthsShortRegex:/^(|\.?|||\.?|?||\.?|?|?||\.?||\.?|||\.?||\.?|||\.?|||\.?)/i,monthsStrictRegex:/^(?||?|?|?|?|?|?|?|||?\.?||\.?||?||?)/i,monthsShortStrictRegex:/^(\.?|\.?|?|\.?|?|?|\.?|\.?|\.?|\.?|\.?|\.?)/i,calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"  ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(e){return e.replace(/[]/g,(function(e){return i[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/|||/,meridiemHour:function(e,t){return 12===e&&(e=0),""===t?e<4?e:e+12:""===t?e:""===t?e>=10?e:e+12:""===t?e+12:void 0},meridiem:function(e,t,i){return e<4?"":e<10?"":e<17?"":e<20?"":""},week:{dow:0,doy:6}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
function t(e,t,i){var r=e+" ";switch(i){case"ss":return r+=1===e?"sekunda":2===e||3===e||4===e?"sekunde":"sekundi";case"m":return t?"jedna minuta":"jedne minute";case"mm":return r+=1===e?"minuta":2===e||3===e||4===e?"minute":"minuta";case"h":return t?"jedan sat":"jednog sata";case"hh":return r+=1===e?"sat":2===e||3===e||4===e?"sata":"sati";case"dd":return r+=1===e?"dan":"dana";case"MM":return r+=1===e?"mjesec":2===e||3===e||4===e?"mjeseca":"mjeseci";case"yy":return r+=1===e?"godina":2===e||3===e||4===e?"godine":"godina"}}e.defineLocale("hr",{months:{format:"sijenja_veljae_oujka_travnja_svibnja_lipnja_srpnja_kolovoza_rujna_listopada_studenoga_prosinca".split("_"),standalone:"sijeanj_veljaa_oujak_travanj_svibanj_lipanj_srpanj_kolovoz_rujan_listopad_studeni_prosinac".split("_")},monthsShort:"sij._velj._ou._tra._svi._lip._srp._kol._ruj._lis._stu._pro.".split("_"),monthsParseExact:true,weekdays:"nedjelja_ponedjeljak_utorak_srijeda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"Do MMMM YYYY",LLL:"Do MMMM YYYY H:mm",LLLL:"dddd, Do MMMM YYYY H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[juer u] LT",lastWeek:function(){switch(this.day()){case 0:return"[prolu] [nedjelju] [u] LT";case 3:return"[prolu] [srijedu] [u] LT";case 6:return"[prole] [subote] [u] LT";case 1:case 2:case 4:case 5:return"[proli] dddd [u] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"par sekundi",ss:t,m:t,mm:t,h:t,hh:t,d:"dan",dd:t,M:"mjesec",MM:t,y:"godinu",yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t="vasrnap htfn kedden szerdn cstrtkn pnteken szombaton".split(" ");function i(e,t,i,r){var n=e;switch(i){case"s":return r||t?"nhny msodperc":"nhny msodperce";case"ss":return n+(r||t)?" msodperc":" msodperce";case"m":return"egy"+(r||t?" perc":" perce");case"mm":return n+(r||t?" perc":" perce");case"h":return"egy"+(r||t?" ra":" rja");case"hh":return n+(r||t?" ra":" rja");case"d":return"egy"+(r||t?" nap":" napja");case"dd":return n+(r||t?" nap":" napja");case"M":return"egy"+(r||t?" hnap":" hnapja");case"MM":return n+(r||t?" hnap":" hnapja");case"y":return"egy"+(r||t?" v":" ve");case"yy":return n+(r||t?" v":" ve")}return""}function r(e){return(e?"":"[mlt] ")+"["+t[this.day()]+"] LT[-kor]"}e.defineLocale("hu",{months:"janur_februr_mrcius_prilis_mjus_jnius_jlius_augusztus_szeptember_oktber_november_december".split("_"),monthsShort:"jan._feb._mrc._pr._mj._jn._jl._aug._szept._okt._nov._dec.".split("_"),monthsParseExact:true,weekdays:"vasrnap_htf_kedd_szerda_cstrtk_pntek_szombat".split("_"),weekdaysShort:"vas_ht_kedd_sze_cst_pn_szo".split("_"),weekdaysMin:"v_h_k_sze_cs_p_szo".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"YYYY.MM.DD.",LL:"YYYY. MMMM D.",LLL:"YYYY. MMMM D. H:mm",LLLL:"YYYY. MMMM D., dddd H:mm"},meridiemParse:/de|du/i,isPM:function(e){return"u"===e.charAt(1).toLowerCase()},meridiem:function(e,t,i){return e<12?true===i?"de":"DE":true===i?"du":"DU"},calendar:{sameDay:"[ma] LT[-kor]",nextDay:"[holnap] LT[-kor]",nextWeek:function(){return r.call(this,true)},lastDay:"[tegnap] LT[-kor]",lastWeek:function(){return r.call(this,false)},sameElse:"L"},relativeTime:{future:"%s mlva",past:"%s",s:i,ss:i,m:i,mm:i,h:i,hh:i,d:i,dd:i,M:i,MM:i,y:i,yy:i},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("hy-am",{months:{format:"___________".split("_"),standalone:"___________".split("_")},monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., HH:mm",LLLL:"dddd, D MMMM YYYY ., HH:mm"},calendar:{sameDay:"[] LT",nextDay:"[] LT",lastDay:"[] LT",nextWeek:function(){return"dddd [ ] LT"},lastWeek:function(){return"[] dddd [ ] LT"},sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"  ",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},meridiemParse:/|||/,isPM:function(e){return/^(|)$/.test(e)},meridiem:function(e){return e<4?"":e<12?"":e<17?"":""},dayOfMonthOrdinalParse:/\d{1,2}|\d{1,2}-(|)/,ordinal:function(e,t){switch(t){case"DDD":case"w":case"W":case"DDDo":return 1===e?e+"-":e+"-";default:return e}},week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("id",{months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Agt_Sep_Okt_Nov_Des".split("_"),weekdays:"Minggu_Senin_Selasa_Rabu_Kamis_Jumat_Sabtu".split("_"),weekdaysShort:"Min_Sen_Sel_Rab_Kam_Jum_Sab".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/pagi|siang|sore|malam/,meridiemHour:function(e,t){return 12===e&&(e=0),"pagi"===t?e:"siang"===t?e>=11?e:e+12:"sore"===t||"malam"===t?e+12:void 0},meridiem:function(e,t,i){return e<11?"pagi":e<15?"siang":e<19?"sore":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Besok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kemarin pukul] LT",lastWeek:"dddd [lalu pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lalu",s:"beberapa detik",ss:"%d detik",m:"semenit",mm:"%d menit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:0,doy:6}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
function t(e){return e%100==11||e%10!=1}function i(e,i,r,n){var s=e+" ";switch(r){case"s":return i||n?"nokkrar sekndur":"nokkrum sekndum";case"ss":return t(e)?s+(i||n?"sekndur":"sekndum"):s+"seknda";case"m":return i?"mnta":"mntu";case"mm":return t(e)?s+(i||n?"mntur":"mntum"):i?s+"mnta":s+"mntu";case"hh":return t(e)?s+(i||n?"klukkustundir":"klukkustundum"):s+"klukkustund";case"d":return i?"dagur":n?"dag":"degi";case"dd":return t(e)?i?s+"dagar":s+(n?"daga":"dgum"):i?s+"dagur":s+(n?"dag":"degi");case"M":return i?"mnuur":n?"mnu":"mnui";case"MM":return t(e)?i?s+"mnuir":s+(n?"mnui":"mnuum"):i?s+"mnuur":s+(n?"mnu":"mnui");case"y":return i||n?"r":"ri";case"yy":return t(e)?s+(i||n?"r":"rum"):s+(i||n?"r":"ri")}}e.defineLocale("is",{months:"janar_febrar_mars_aprl_ma_jn_jl_gst_september_oktber_nvember_desember".split("_"),monthsShort:"jan_feb_mar_apr_ma_jn_jl_g_sep_okt_nv_des".split("_"),weekdays:"sunnudagur_mnudagur_rijudagur_mivikudagur_fimmtudagur_fstudagur_laugardagur".split("_"),weekdaysShort:"sun_mn_ri_mi_fim_fs_lau".split("_"),weekdaysMin:"Su_M_r_Mi_Fi_F_La".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] H:mm",LLLL:"dddd, D. MMMM YYYY [kl.] H:mm"},calendar:{sameDay:"[ dag kl.] LT",nextDay:"[ morgun kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[ gr kl.] LT",lastWeek:"[sasta] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"eftir %s",past:"fyrir %s san",s:i,ss:i,m:i,mm:i,h:"klukkustund",hh:i,d:i,dd:i,M:i,MM:i,y:i,yy:i},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("it",{months:"gennaio_febbraio_marzo_aprile_maggio_giugno_luglio_agosto_settembre_ottobre_novembre_dicembre".split("_"),monthsShort:"gen_feb_mar_apr_mag_giu_lug_ago_set_ott_nov_dic".split("_"),weekdays:"domenica_luned_marted_mercoled_gioved_venerd_sabato".split("_"),weekdaysShort:"dom_lun_mar_mer_gio_ven_sab".split("_"),weekdaysMin:"do_lu_ma_me_gi_ve_sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:function(){return"[Oggi a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"},nextDay:function(){return"[Domani a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"},nextWeek:function(){return"dddd [a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"},lastDay:function(){return"[Ieri a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"},lastWeek:function(){switch(this.day()){case 0:return"[La scorsa] dddd [a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT";default:return"[Lo scorso] dddd [a"+(this.hours()>1?"lle ":0===this.hours()?" ":"ll'")+"]LT"}},sameElse:"L"},relativeTime:{future:"tra %s",past:"%s fa",s:"alcuni secondi",ss:"%d secondi",m:"un minuto",mm:"%d minuti",h:"un'ora",hh:"%d ore",d:"un giorno",dd:"%d giorni",w:"una settimana",ww:"%d settimane",M:"un mese",MM:"%d mesi",y:"un anno",yy:"%d anni"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("it-ch",{months:"gennaio_febbraio_marzo_aprile_maggio_giugno_luglio_agosto_settembre_ottobre_novembre_dicembre".split("_"),monthsShort:"gen_feb_mar_apr_mag_giu_lug_ago_set_ott_nov_dic".split("_"),weekdays:"domenica_luned_marted_mercoled_gioved_venerd_sabato".split("_"),weekdaysShort:"dom_lun_mar_mer_gio_ven_sab".split("_"),weekdaysMin:"do_lu_ma_me_gi_ve_sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Oggi alle] LT",nextDay:"[Domani alle] LT",nextWeek:"dddd [alle] LT",lastDay:"[Ieri alle] LT",lastWeek:function(){switch(this.day()){case 0:return"[la scorsa] dddd [alle] LT";default:return"[lo scorso] dddd [alle] LT"}},sameElse:"L"},relativeTime:{future:function(e){return(/^[0-9].+$/.test(e)?"tra":"in")+" "+e},past:"%s fa",s:"alcuni secondi",ss:"%d secondi",m:"un minuto",mm:"%d minuti",h:"un'ora",hh:"%d ore",d:"un giorno",dd:"%d giorni",M:"un mese",MM:"%d mesi",y:"un anno",yy:"%d anni"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("ja",{eras:[{since:"2019-05-01",offset:1,name:"",narrow:"",abbr:"R"},{since:"1989-01-08",until:"2019-04-30",offset:1,name:"",narrow:"",abbr:"H"},{since:"1926-12-25",until:"1989-01-07",offset:1,name:"",narrow:"",abbr:"S"},{since:"1912-07-30",until:"1926-12-24",offset:1,name:"",narrow:"",abbr:"T"},{since:"1873-01-01",until:"1912-07-29",offset:6,name:"",narrow:"",abbr:"M"},{since:"0001-01-01",until:"1873-12-31",offset:1,name:"",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"",narrow:"BC",abbr:"BC"}],eraYearOrdinalRegex:/(|\d+)/,eraYearOrdinalParse:function(e,t){return""===t[1]?1:parseInt(t[1]||e,10)},months:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYYMD",LLL:"YYYYMD HH:mm",LLLL:"YYYYMD dddd HH:mm",l:"YYYY/MM/DD",ll:"YYYYMD",lll:"YYYYMD HH:mm",llll:"YYYYMD(ddd) HH:mm"},meridiemParse:/|/i,isPM:function(e){return""===e},meridiem:function(e,t,i){return e<12?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:function(e){return e.week()!==this.week()?"[]dddd LT":"dddd LT"},lastDay:"[] LT",lastWeek:function(e){return this.week()!==e.week()?"[]dddd LT":"dddd LT"},sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(e,t){switch(t){case"y":return 1===e?"":e+"";case"d":case"D":case"DDD":return e+"";default:return e}},relativeTime:{future:"%s",past:"%s",s:"",ss:"%d",m:"1",mm:"%d",h:"1",hh:"%d",d:"1",dd:"%d",M:"1",MM:"%d",y:"1",yy:"%d"}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("jv",{months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_Nopember_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Ags_Sep_Okt_Nop_Des".split("_"),weekdays:"Minggu_Senen_Seloso_Rebu_Kemis_Jemuwah_Septu".split("_"),weekdaysShort:"Min_Sen_Sel_Reb_Kem_Jem_Sep".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sp".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/enjing|siyang|sonten|ndalu/,meridiemHour:function(e,t){return 12===e&&(e=0),"enjing"===t?e:"siyang"===t?e>=11?e:e+12:"sonten"===t||"ndalu"===t?e+12:void 0},meridiem:function(e,t,i){return e<11?"enjing":e<15?"siyang":e<19?"sonten":"ndalu"},calendar:{sameDay:"[Dinten puniko pukul] LT",nextDay:"[Mbenjang pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kala wingi pukul] LT",lastWeek:"dddd [kepengker pukul] LT",sameElse:"L"},relativeTime:{future:"wonten ing %s",past:"%s ingkang kepengker",s:"sawetawis detik",ss:"%d detik",m:"setunggal menit",mm:"%d menit",h:"setunggal jam",hh:"%d jam",d:"sedinten",dd:"%d dinten",M:"sewulan",MM:"%d wulan",y:"setaun",yy:"%d taun"},week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("ka",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:{standalone:"______".split("_"),format:"______".split("_"),isFormat:/(|)/},weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[] LT[-]",nextDay:"[] LT[-]",lastDay:"[] LT[-]",nextWeek:"[] dddd LT[-]",lastWeek:"[] dddd LT-",sameElse:"L"},relativeTime:{future:function(e){return e.replace(/(|||||)(|)/,(function(e,t,i){return""===i?t+"":t+i+""}))},past:function(e){return/(||||)/.test(e)?e.replace(/(|)$/," ")://.test(e)?e.replace(/$/," "):e},s:" ",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},dayOfMonthOrdinalParse:/0|1-|-\d{1,2}|\d{1,2}-/,ordinal:function(e){return 0===e?e:1===e?e+"-":e<20||e<=100&&e%20==0||e%100==0?"-"+e:e+"-"},week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={0:"-",1:"-",2:"-",3:"-",4:"-",5:"-",6:"-",7:"-",8:"-",9:"-",10:"-",20:"-",30:"-",40:"-",50:"-",60:"-",70:"-",80:"-",90:"-",100:"-"};e.defineLocale("kk",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"[ ] dddd [] LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}-(|)/,ordinal:function(e){return e+(t[e]||t[e%10]||t[e>=100?100:null])},week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},i={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};e.defineLocale("km",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(e){return""===e},meridiem:function(e,t,i){return e<12?"":""},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] [] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s",s:"",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",preparse:function(e){return e.replace(/[]/g,(function(e){return i[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},i={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};e.defineLocale("kn",{months:"___________".split("_"),monthsShort:"___________".split("_"),monthsParseExact:true,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm",LLLL:"dddd, D MMMM YYYY, A h:mm"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(e){return e.replace(/[]/g,(function(e){return i[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/|||/,meridiemHour:function(e,t){return 12===e&&(e=0),""===t?e<4?e:e+12:""===t?e:""===t?e>=10?e:e+12:""===t?e+12:void 0},meridiem:function(e,t,i){return e<4?"":e<10?"":e<17?"":e<20?"":""},dayOfMonthOrdinalParse:/\d{1,2}()/,ordinal:function(e){return e+""},week:{dow:0,doy:6}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("ko",{months:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"YYYY.MM.DD.",LL:"YYYY MMMM D",LLL:"YYYY MMMM D A h:mm",LLLL:"YYYY MMMM D dddd A h:mm",l:"YYYY.MM.DD.",ll:"YYYY MMMM D",lll:"YYYY MMMM D A h:mm",llll:"YYYY MMMM D dddd A h:mm"},calendar:{sameDay:" LT",nextDay:" LT",nextWeek:"dddd LT",lastDay:" LT",lastWeek:" dddd LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d",m:"1",mm:"%d",h:" ",hh:"%d",d:"",dd:"%d",M:" ",MM:"%d",y:" ",yy:"%d"},dayOfMonthOrdinalParse:/\d{1,2}(||)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"";case"M":return e+"";case"w":case"W":return e+"";default:return e}},meridiemParse:/|/,isPM:function(e){return""===e},meridiem:function(e,t,i){return e<12?"":""}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},i={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"},r=[" ","","","","","","","",""," "," "," "];e.defineLocale("ku",{months:r,monthsShort:r,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(e){return//.test(e)},meridiem:function(e,t,i){return e<12?"":""},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s",s:" ",ss:" %d",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(e){return e.replace(/[]/g,(function(e){return i[e]})).replace(//g,",")},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]})).replace(/,/g,"")},week:{dow:6,doy:12}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={0:"-",1:"-",2:"-",3:"-",4:"-",5:"-",6:"-",7:"-",8:"-",9:"-",10:"-",20:"-",30:"-",40:"-",50:"-",60:"-",70:"-",80:"-",90:"-",100:"-"};e.defineLocale("ky",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"[ ] dddd [] [] LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}-(|||)/,ordinal:function(e){return e+(t[e]||t[e%10]||t[e>=100?100:null])},week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
function t(e,t,i,r){var n={m:["eng Minutt","enger Minutt"],h:["eng Stonn","enger Stonn"],d:["een Dag","engem Dag"],M:["ee Mount","engem Mount"],y:["ee Joer","engem Joer"]};return t?n[i][0]:n[i][1]}function i(e){if(e=parseInt(e,10),isNaN(e))return false;if(e<0)return true;if(e<10)return 4<=e&&e<=7;if(e<100){var t=e%10;return i(0===t?e/10:t)}if(e<1e4){for(;e>=10;)e/=10;return i(e)}return i(e/=1e3)}e.defineLocale("lb",{months:"Januar_Februar_Merz_Abrll_Mee_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Febr._Mrz._Abr._Mee_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),monthsParseExact:true,weekdays:"Sonndeg_Mindeg_Dnschdeg_Mttwoch_Donneschdeg_Freideg_Samschdeg".split("_"),weekdaysShort:"So._M._D._M._Do._Fr._Sa.".split("_"),weekdaysMin:"So_M_D_M_Do_Fr_Sa".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"H:mm [Auer]",LTS:"H:mm:ss [Auer]",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm [Auer]",LLLL:"dddd, D. MMMM YYYY H:mm [Auer]"},calendar:{sameDay:"[Haut um] LT",sameElse:"L",nextDay:"[Muer um] LT",nextWeek:"dddd [um] LT",lastDay:"[Gschter um] LT",lastWeek:function(){switch(this.day()){case 2:case 4:return"[Leschten] dddd [um] LT";default:return"[Leschte] dddd [um] LT"}}},relativeTime:{future:function(e){return i(e.substr(0,e.indexOf(" ")))?"a "+e:"an "+e},past:function(e){return i(e.substr(0,e.indexOf(" ")))?"viru "+e:"virun "+e},s:"e puer Sekonnen",ss:"%d Sekonnen",m:t,mm:"%d Minutten",h:t,hh:"%d Stonnen",d:t,dd:"%d Deeg",M:t,MM:"%d Mint",y:t,yy:"%d Joer"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("lo",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(e){return""===e},meridiem:function(e,t,i){return e<12?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[]dddd[] LT",lastDay:"[] LT",lastWeek:"[]dddd[] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s",s:"",ss:"%d ",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "},dayOfMonthOrdinalParse:/()\d{1,2}/,ordinal:function(e){return""+e}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={ss:"sekund_sekundi_sekundes",m:"minut_minuts_minut",mm:"minuts_minui_minutes",h:"valanda_valandos_valand",hh:"valandos_valand_valandas",d:"diena_dienos_dien",dd:"dienos_dien_dienas",M:"mnuo_mnesio_mnes",MM:"mnesiai_mnesi_mnesius",y:"metai_met_metus",yy:"metai_met_metus"};function i(e,t,i,r){return t?n(i)[0]:r?n(i)[1]:n(i)[2]}function r(e){return e%10==0||e>10&&e<20}function n(e){return t[e].split("_")}function s(e,t,s,o){var a=e+" ";return 1===e?a+i(0,t,s[0],o):t?a+(r(e)?n(s)[1]:n(s)[0]):o?a+n(s)[1]:a+(r(e)?n(s)[1]:n(s)[2])}e.defineLocale("lt",{months:{format:"sausio_vasario_kovo_balandio_gegus_birelio_liepos_rugpjio_rugsjo_spalio_lapkriio_gruodio".split("_"),standalone:"sausis_vasaris_kovas_balandis_gegu_birelis_liepa_rugpjtis_rugsjis_spalis_lapkritis_gruodis".split("_"),isFormat:/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?|MMMM?(\[[^\[\]]*\]|\s)+D[oD]?/},monthsShort:"sau_vas_kov_bal_geg_bir_lie_rgp_rgs_spa_lap_grd".split("_"),weekdays:{format:"sekmadien_pirmadien_antradien_treiadien_ketvirtadien_penktadien_etadien".split("_"),standalone:"sekmadienis_pirmadienis_antradienis_treiadienis_ketvirtadienis_penktadienis_etadienis".split("_"),isFormat:/dddd HH:mm/},weekdaysShort:"Sek_Pir_Ant_Tre_Ket_Pen_e".split("_"),weekdaysMin:"S_P_A_T_K_Pn_".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY [m.] MMMM D [d.]",LLL:"YYYY [m.] MMMM D [d.], HH:mm [val.]",LLLL:"YYYY [m.] MMMM D [d.], dddd, HH:mm [val.]",l:"YYYY-MM-DD",ll:"YYYY [m.] MMMM D [d.]",lll:"YYYY [m.] MMMM D [d.], HH:mm [val.]",llll:"YYYY [m.] MMMM D [d.], ddd, HH:mm [val.]"},calendar:{sameDay:"[iandien] LT",nextDay:"[Rytoj] LT",nextWeek:"dddd LT",lastDay:"[Vakar] LT",lastWeek:"[Prajus] dddd LT",sameElse:"L"},relativeTime:{future:"po %s",past:"prie %s",s:function(e,t,i,r){return t?"kelios sekunds":r?"keli sekundi":"kelias sekundes"},ss:s,m:i,mm:s,h:i,hh:s,d:i,dd:s,M:i,MM:s,y:i,yy:s},dayOfMonthOrdinalParse:/\d{1,2}-oji/,ordinal:function(e){return e+"-oji"},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={ss:"sekundes_sekundm_sekunde_sekundes".split("_"),m:"mintes_mintm_minte_mintes".split("_"),mm:"mintes_mintm_minte_mintes".split("_"),h:"stundas_stundm_stunda_stundas".split("_"),hh:"stundas_stundm_stunda_stundas".split("_"),d:"dienas_dienm_diena_dienas".split("_"),dd:"dienas_dienm_diena_dienas".split("_"),M:"mnea_mneiem_mnesis_mnei".split("_"),MM:"mnea_mneiem_mnesis_mnei".split("_"),y:"gada_gadiem_gads_gadi".split("_"),yy:"gada_gadiem_gads_gadi".split("_")};function i(e,t,i){return i?t%10==1&&t%100!=11?e[2]:e[3]:t%10==1&&t%100!=11?e[0]:e[1]}function r(e,r,n){return e+" "+i(t[n],e,r)}function n(e,r,n){return i(t[n],e,r)}e.defineLocale("lv",{months:"janvris_februris_marts_aprlis_maijs_jnijs_jlijs_augusts_septembris_oktobris_novembris_decembris".split("_"),monthsShort:"jan_feb_mar_apr_mai_jn_jl_aug_sep_okt_nov_dec".split("_"),weekdays:"svtdiena_pirmdiena_otrdiena_trediena_ceturtdiena_piektdiena_sestdiena".split("_"),weekdaysShort:"Sv_P_O_T_C_Pk_S".split("_"),weekdaysMin:"Sv_P_O_T_C_Pk_S".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY.",LL:"YYYY. [gada] D. MMMM",LLL:"YYYY. [gada] D. MMMM, HH:mm",LLLL:"YYYY. [gada] D. MMMM, dddd, HH:mm"},calendar:{sameDay:"[odien pulksten] LT",nextDay:"[Rt pulksten] LT",nextWeek:"dddd [pulksten] LT",lastDay:"[Vakar pulksten] LT",lastWeek:"[Pagju] dddd [pulksten] LT",sameElse:"L"},relativeTime:{future:"pc %s",past:"pirms %s",s:function(e,t){return t?"daas sekundes":"dam sekundm"},ss:r,m:n,mm:r,h:n,hh:r,d:n,dd:r,M:n,MM:r,y:n,yy:r},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={words:{ss:["sekund","sekunda","sekundi"],m:["jedan minut","jednog minuta"],mm:["minut","minuta","minuta"],h:["jedan sat","jednog sata"],hh:["sat","sata","sati"],dd:["dan","dana","dana"],MM:["mjesec","mjeseca","mjeseci"],yy:["godina","godine","godina"]},correctGrammaticalCase:function(e,t){return 1===e?t[0]:e>=2&&e<=4?t[1]:t[2]},translate:function(e,i,r){var n=t.words[r];return 1===r.length?i?n[0]:n[1]:e+" "+t.correctGrammaticalCase(e,n)}};e.defineLocale("me",{months:"januar_februar_mart_april_maj_jun_jul_avgust_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj_jun_jul_avg._sep._okt._nov._dec.".split("_"),monthsParseExact:true,weekdays:"nedjelja_ponedjeljak_utorak_srijeda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sri._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sjutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedjelju] [u] LT";case 3:return"[u] [srijedu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[jue u] LT",lastWeek:function(){return["[prole] [nedjelje] [u] LT","[prolog] [ponedjeljka] [u] LT","[prolog] [utorka] [u] LT","[prole] [srijede] [u] LT","[prolog] [etvrtka] [u] LT","[prolog] [petka] [u] LT","[prole] [subote] [u] LT"][this.day()]},sameElse:"L"},relativeTime:{future:"za %s",past:"prije %s",s:"nekoliko sekundi",ss:t.translate,m:t.translate,mm:t.translate,h:t.translate,hh:t.translate,d:"dan",dd:t.translate,M:"mjesec",MM:t.translate,y:"godinu",yy:t.translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("mi",{months:"Kohi-tte_Hui-tanguru_Pout-te-rangi_Paenga-whwh_Haratua_Pipiri_Hngoingoi_Here-turi-kk_Mahuru_Whiringa--nuku_Whiringa--rangi_Hakihea".split("_"),monthsShort:"Kohi_Hui_Pou_Pae_Hara_Pipi_Hngoi_Here_Mahu_Whi-nu_Whi-ra_Haki".split("_"),monthsRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,3}/i,monthsStrictRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,3}/i,monthsShortRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,3}/i,monthsShortStrictRegex:/(?:['a-z\u0101\u014D\u016B]+\-?){1,2}/i,weekdays:"Rtapu_Mane_Trei_Wenerei_Tite_Paraire_Htarei".split("_"),weekdaysShort:"Ta_Ma_T_We_Ti_Pa_H".split("_"),weekdaysMin:"Ta_Ma_T_We_Ti_Pa_H".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [i] HH:mm",LLLL:"dddd, D MMMM YYYY [i] HH:mm"},calendar:{sameDay:"[i teie mahana, i] LT",nextDay:"[apopo i] LT",nextWeek:"dddd [i] LT",lastDay:"[inanahi i] LT",lastWeek:"dddd [whakamutunga i] LT",sameElse:"L"},relativeTime:{future:"i roto i %s",past:"%s i mua",s:"te hkona ruarua",ss:"%d hkona",m:"he meneti",mm:"%d meneti",h:"te haora",hh:"%d haora",d:"he ra",dd:"%d ra",M:"he marama",MM:"%d marama",y:"he tau",yy:"%d tau"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("mk",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"e_o_____a".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"D.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"[] dddd [] LT",lastDay:"[ ] LT",lastWeek:function(){switch(this.day()){case 0:case 3:case 6:return"[] dddd [] LT";case 1:case 2:case 4:case 5:return"[] dddd [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}-(|||||)/,ordinal:function(e){var t=e%10,i=e%100;return 0===e?e+"-":0===i?e+"-":i>10&&i<20?e+"-":1===t?e+"-":2===t?e+"-":7===t||8===t?e+"-":e+"-"},week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("ml",{months:"___________".split("_"),monthsShort:"._._._.___._._._._._.".split("_"),monthsParseExact:true,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm -",LTS:"A h:mm:ss -",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm -",LLLL:"dddd, D MMMM YYYY, A h:mm -"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},meridiemParse:/|| ||/i,meridiemHour:function(e,t){return 12===e&&(e=0),""===t&&e>=4||" "===t||""===t?e+12:e},meridiem:function(e,t,i){return e<4?"":e<12?"":e<17?" ":e<20?"":""}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
function t(e,t,i,r){switch(i){case"s":return t?" ":" ";case"ss":return e+(t?" ":" ");case"m":case"mm":return e+(t?" ":" ");case"h":case"hh":return e+(t?" ":" ");case"d":case"dd":return e+(t?" ":" ");case"M":case"MM":return e+(t?" ":" ");case"y":case"yy":return e+(t?" ":" ");default:return e}}e.defineLocale("mn",{months:" _ _ _ _ _ _ _ _ _ _  _  ".split("_"),monthsShort:"1 _2 _3 _4 _5 _6 _7 _8 _9 _10 _11 _12 ".split("_"),monthsParseExact:true,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY  MMMM D",LLL:"YYYY  MMMM D HH:mm",LLLL:"dddd, YYYY  MMMM D HH:mm"},meridiemParse:/|/i,isPM:function(e){return""===e},meridiem:function(e,t,i){return e<12?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[] dddd LT",lastDay:"[] LT",lastWeek:"[] dddd LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:t,ss:t,m:t,mm:t,h:t,hh:t,d:t,dd:t,M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2} /,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+" ";default:return e}}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},i={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};function r(e,t,i,r){var n="";if(t)switch(i){case"s":n=" ";break;case"ss":n="%d ";break;case"m":n=" ";break;case"mm":n="%d ";break;case"h":n=" ";break;case"hh":n="%d ";break;case"d":n=" ";break;case"dd":n="%d ";break;case"M":n=" ";break;case"MM":n="%d ";break;case"y":n=" ";break;case"yy":n="%d "}else switch(i){case"s":n=" ";break;case"ss":n="%d ";break;case"m":n=" ";break;case"mm":n="%d ";break;case"h":n=" ";break;case"hh":n="%d ";break;case"d":n=" ";break;case"dd":n="%d ";break;case"M":n=" ";break;case"MM":n="%d ";break;case"y":n=" ";break;case"yy":n="%d "}return n.replace(/%d/i,e)}e.defineLocale("mr",{months:"___________".split("_"),monthsShort:"._._._._._._._._._._._.".split("_"),monthsParseExact:true,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm ",LLLL:"dddd, D MMMM YYYY, A h:mm "},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s",s:r,ss:r,m:r,mm:r,h:r,hh:r,d:r,dd:r,M:r,MM:r,y:r,yy:r},preparse:function(e){return e.replace(/[]/g,(function(e){return i[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/||||/,meridiemHour:function(e,t){return 12===e&&(e=0),""===t||""===t?e:""===t||""===t||""===t?e>=12?e:e+12:void 0},meridiem:function(e,t,i){return e>=0&&e<6?"":e<12?"":e<17?"":e<20?"":""},week:{dow:0,doy:6}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("ms",{months:"Januari_Februari_Mac_April_Mei_Jun_Julai_Ogos_September_Oktober_November_Disember".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ogs_Sep_Okt_Nov_Dis".split("_"),weekdays:"Ahad_Isnin_Selasa_Rabu_Khamis_Jumaat_Sabtu".split("_"),weekdaysShort:"Ahd_Isn_Sel_Rab_Kha_Jum_Sab".split("_"),weekdaysMin:"Ah_Is_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/pagi|tengahari|petang|malam/,meridiemHour:function(e,t){return 12===e&&(e=0),"pagi"===t?e:"tengahari"===t?e>=11?e:e+12:"petang"===t||"malam"===t?e+12:void 0},meridiem:function(e,t,i){return e<11?"pagi":e<15?"tengahari":e<19?"petang":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Esok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kelmarin pukul] LT",lastWeek:"dddd [lepas pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lepas",s:"beberapa saat",ss:"%d saat",m:"seminit",mm:"%d minit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("ms-my",{months:"Januari_Februari_Mac_April_Mei_Jun_Julai_Ogos_September_Oktober_November_Disember".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ogs_Sep_Okt_Nov_Dis".split("_"),weekdays:"Ahad_Isnin_Selasa_Rabu_Khamis_Jumaat_Sabtu".split("_"),weekdaysShort:"Ahd_Isn_Sel_Rab_Kha_Jum_Sab".split("_"),weekdaysMin:"Ah_Is_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/pagi|tengahari|petang|malam/,meridiemHour:function(e,t){return 12===e&&(e=0),"pagi"===t?e:"tengahari"===t?e>=11?e:e+12:"petang"===t||"malam"===t?e+12:void 0},meridiem:function(e,t,i){return e<11?"pagi":e<15?"tengahari":e<19?"petang":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Esok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kelmarin pukul] LT",lastWeek:"dddd [lepas pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lepas",s:"beberapa saat",ss:"%d saat",m:"seminit",mm:"%d minit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("mt",{months:"Jannar_Frar_Marzu_April_Mejju_unju_Lulju_Awwissu_Settembru_Ottubru_Novembru_Diembru".split("_"),monthsShort:"Jan_Fra_Mar_Apr_Mej_un_Lul_Aww_Set_Ott_Nov_Di".split("_"),weekdays:"Il-add_It-Tnejn_It-Tlieta_L-Erbga_Il-amis_Il-imga_Is-Sibt".split("_"),weekdaysShort:"ad_Tne_Tli_Erb_am_im_Sib".split("_"),weekdaysMin:"a_Tn_Tl_Er_a_i_Si".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Illum fil-]LT",nextDay:"[Gada fil-]LT",nextWeek:"dddd [fil-]LT",lastDay:"[Il-biera fil-]LT",lastWeek:"dddd [li gadda] [fil-]LT",sameElse:"L"},relativeTime:{future:"f %s",past:"%s ilu",s:"ftit sekondi",ss:"%d sekondi",m:"minuta",mm:"%d minuti",h:"siega",hh:"%d siegat",d:"urnata",dd:"%d ranet",M:"xahar",MM:"%d xhur",y:"sena",yy:"%d sni"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},i={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};e.defineLocale("my",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[.] LT []",nextDay:"[] LT []",nextWeek:"dddd LT []",lastDay:"[.] LT []",lastWeek:"[] dddd LT []",sameElse:"L"},relativeTime:{future:" %s ",past:" %s ",s:".",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d ",M:"",MM:"%d ",y:"",yy:"%d "},preparse:function(e){return e.replace(/[]/g,(function(e){return i[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("nb",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan._feb._mars_apr._mai_juni_juli_aug._sep._okt._nov._des.".split("_"),monthsParseExact:true,weekdays:"sndag_mandag_tirsdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"s._ma._ti._on._to._fr._l.".split("_"),weekdaysMin:"s_ma_ti_on_to_fr_l".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] HH:mm",LLLL:"dddd D. MMMM YYYY [kl.] HH:mm"},calendar:{sameDay:"[i dag kl.] LT",nextDay:"[i morgen kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[i gr kl.] LT",lastWeek:"[forrige] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s siden",s:"noen sekunder",ss:"%d sekunder",m:"ett minutt",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dager",w:"en uke",ww:"%d uker",M:"en mned",MM:"%d mneder",y:"ett r",yy:"%d r"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},i={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};e.defineLocale("ne",{months:"___________".split("_"),monthsShort:"._.__.___._._._._._.".split("_"),monthsParseExact:true,weekdays:"______".split("_"),weekdaysShort:"._._._._._._.".split("_"),weekdaysMin:"._._._._._._.".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm ",LLLL:"dddd, D MMMM YYYY, A h:mm "},preparse:function(e){return e.replace(/[]/g,(function(e){return i[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/|||/,meridiemHour:function(e,t){return 12===e&&(e=0),""===t?e<4?e:e+12:""===t?e:""===t?e>=10?e:e+12:""===t?e+12:void 0},meridiem:function(e,t,i){return e<3?"":e<12?"":e<16?"":e<20?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[] dddd[,] LT",lastDay:"[] LT",lastWeek:"[] dddd[,] LT",sameElse:"L"},relativeTime:{future:"%s",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},week:{dow:0,doy:6}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t="jan._feb._mrt._apr._mei_jun._jul._aug._sep._okt._nov._dec.".split("_"),i="jan_feb_mrt_apr_mei_jun_jul_aug_sep_okt_nov_dec".split("_"),r=[/^jan/i,/^feb/i,/^maart|mrt.?$/i,/^apr/i,/^mei$/i,/^jun[i.]?$/i,/^jul[i.]?$/i,/^aug/i,/^sep/i,/^okt/i,/^nov/i,/^dec/i],n=/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december|jan\.?|feb\.?|mrt\.?|apr\.?|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i;e.defineLocale("nl",{months:"januari_februari_maart_april_mei_juni_juli_augustus_september_oktober_november_december".split("_"),monthsShort:function(e,r){return e?/-MMM-/.test(r)?i[e.month()]:t[e.month()]:t},monthsRegex:n,monthsShortRegex:n,monthsStrictRegex:/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december)/i,monthsShortStrictRegex:/^(jan\.?|feb\.?|mrt\.?|apr\.?|mei|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i,monthsParse:r,longMonthsParse:r,shortMonthsParse:r,weekdays:"zondag_maandag_dinsdag_woensdag_donderdag_vrijdag_zaterdag".split("_"),weekdaysShort:"zo._ma._di._wo._do._vr._za.".split("_"),weekdaysMin:"zo_ma_di_wo_do_vr_za".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[vandaag om] LT",nextDay:"[morgen om] LT",nextWeek:"dddd [om] LT",lastDay:"[gisteren om] LT",lastWeek:"[afgelopen] dddd [om] LT",sameElse:"L"},relativeTime:{future:"over %s",past:"%s geleden",s:"een paar seconden",ss:"%d seconden",m:"n minuut",mm:"%d minuten",h:"n uur",hh:"%d uur",d:"n dag",dd:"%d dagen",w:"n week",ww:"%d weken",M:"n maand",MM:"%d maanden",y:"n jaar",yy:"%d jaar"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(e){return e+(1===e||8===e||e>=20?"ste":"de")},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t="jan._feb._mrt._apr._mei_jun._jul._aug._sep._okt._nov._dec.".split("_"),i="jan_feb_mrt_apr_mei_jun_jul_aug_sep_okt_nov_dec".split("_"),r=[/^jan/i,/^feb/i,/^maart|mrt.?$/i,/^apr/i,/^mei$/i,/^jun[i.]?$/i,/^jul[i.]?$/i,/^aug/i,/^sep/i,/^okt/i,/^nov/i,/^dec/i],n=/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december|jan\.?|feb\.?|mrt\.?|apr\.?|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i;e.defineLocale("nl-be",{months:"januari_februari_maart_april_mei_juni_juli_augustus_september_oktober_november_december".split("_"),monthsShort:function(e,r){return e?/-MMM-/.test(r)?i[e.month()]:t[e.month()]:t},monthsRegex:n,monthsShortRegex:n,monthsStrictRegex:/^(januari|februari|maart|april|mei|ju[nl]i|augustus|september|oktober|november|december)/i,monthsShortStrictRegex:/^(jan\.?|feb\.?|mrt\.?|apr\.?|mei|ju[nl]\.?|aug\.?|sep\.?|okt\.?|nov\.?|dec\.?)/i,monthsParse:r,longMonthsParse:r,shortMonthsParse:r,weekdays:"zondag_maandag_dinsdag_woensdag_donderdag_vrijdag_zaterdag".split("_"),weekdaysShort:"zo._ma._di._wo._do._vr._za.".split("_"),weekdaysMin:"zo_ma_di_wo_do_vr_za".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[vandaag om] LT",nextDay:"[morgen om] LT",nextWeek:"dddd [om] LT",lastDay:"[gisteren om] LT",lastWeek:"[afgelopen] dddd [om] LT",sameElse:"L"},relativeTime:{future:"over %s",past:"%s geleden",s:"een paar seconden",ss:"%d seconden",m:"n minuut",mm:"%d minuten",h:"n uur",hh:"%d uur",d:"n dag",dd:"%d dagen",M:"n maand",MM:"%d maanden",y:"n jaar",yy:"%d jaar"},dayOfMonthOrdinalParse:/\d{1,2}(ste|de)/,ordinal:function(e){return e+(1===e||8===e||e>=20?"ste":"de")},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("nn",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan._feb._mars_apr._mai_juni_juli_aug._sep._okt._nov._des.".split("_"),monthsParseExact:true,weekdays:"sundag_mndag_tysdag_onsdag_torsdag_fredag_laurdag".split("_"),weekdaysShort:"su._m._ty._on._to._fr._lau.".split("_"),weekdaysMin:"su_m_ty_on_to_fr_la".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] H:mm",LLLL:"dddd D. MMMM YYYY [kl.] HH:mm"},calendar:{sameDay:"[I dag klokka] LT",nextDay:"[I morgon klokka] LT",nextWeek:"dddd [klokka] LT",lastDay:"[I gr klokka] LT",lastWeek:"[Fregande] dddd [klokka] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s sidan",s:"nokre sekund",ss:"%d sekund",m:"eit minutt",mm:"%d minutt",h:"ein time",hh:"%d timar",d:"ein dag",dd:"%d dagar",w:"ei veke",ww:"%d veker",M:"ein mnad",MM:"%d mnader",y:"eit r",yy:"%d r"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("oc-lnc",{months:{standalone:"genir_febrir_mar_abril_mai_junh_julhet_agost_setembre_octbre_novembre_decembre".split("_"),format:"de genir_de febrir_de mar_d'abril_de mai_de junh_de julhet_d'agost_de setembre_d'octbre_de novembre_de decembre".split("_"),isFormat:/D[oD]?(\s)+MMMM/},monthsShort:"gen._febr._mar_abr._mai_junh_julh._ago._set._oct._nov._dec.".split("_"),monthsParseExact:true,weekdays:"dimenge_diluns_dimars_dimcres_dijus_divendres_dissabte".split("_"),weekdaysShort:"dg._dl._dm._dc._dj._dv._ds.".split("_"),weekdaysMin:"dg_dl_dm_dc_dj_dv_ds".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM [de] YYYY",ll:"D MMM YYYY",LLL:"D MMMM [de] YYYY [a] H:mm",lll:"D MMM YYYY, H:mm",LLLL:"dddd D MMMM [de] YYYY [a] H:mm",llll:"ddd D MMM YYYY, H:mm"},calendar:{sameDay:"[ui a] LT",nextDay:"[deman a] LT",nextWeek:"dddd [a] LT",lastDay:"[ir a] LT",lastWeek:"dddd [passat a] LT",sameElse:"L"},relativeTime:{future:"d'aqu %s",past:"fa %s",s:"unas segondas",ss:"%d segondas",m:"una minuta",mm:"%d minutas",h:"una ora",hh:"%d oras",d:"un jorn",dd:"%d jorns",M:"un mes",MM:"%d meses",y:"un an",yy:"%d ans"},dayOfMonthOrdinalParse:/\d{1,2}(r|n|t||a)/,ordinal:function(e,t){var i=1===e?"r":2===e?"n":3===e?"r":4===e?"t":"";return"w"!==t&&"W"!==t||(i="a"),e+i},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},i={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};e.defineLocale("pa-in",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm ",LTS:"A h:mm:ss ",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm ",LLLL:"dddd, D MMMM YYYY, A h:mm "},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[] dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(e){return e.replace(/[]/g,(function(e){return i[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/|||/,meridiemHour:function(e,t){return 12===e&&(e=0),""===t?e<4?e:e+12:""===t?e:""===t?e>=10?e:e+12:""===t?e+12:void 0},meridiem:function(e,t,i){return e<4?"":e<10?"":e<17?"":e<20?"":""},week:{dow:0,doy:6}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t="stycze_luty_marzec_kwiecie_maj_czerwiec_lipiec_sierpie_wrzesie_padziernik_listopad_grudzie".split("_"),i="stycznia_lutego_marca_kwietnia_maja_czerwca_lipca_sierpnia_wrzenia_padziernika_listopada_grudnia".split("_"),r=[/^sty/i,/^lut/i,/^mar/i,/^kwi/i,/^maj/i,/^cze/i,/^lip/i,/^sie/i,/^wrz/i,/^pa/i,/^lis/i,/^gru/i];function n(e){return e%10<5&&e%10>1&&~~(e/10)%10!=1}function s(e,t,i){var r=e+" ";switch(i){case"ss":return r+(n(e)?"sekundy":"sekund");case"m":return t?"minuta":"minut";case"mm":return r+(n(e)?"minuty":"minut");case"h":return t?"godzina":"godzin";case"hh":return r+(n(e)?"godziny":"godzin");case"ww":return r+(n(e)?"tygodnie":"tygodni");case"MM":return r+(n(e)?"miesice":"miesicy");case"yy":return r+(n(e)?"lata":"lat")}}e.defineLocale("pl",{months:function(e,r){return e?/D MMMM/.test(r)?i[e.month()]:t[e.month()]:t},monthsShort:"sty_lut_mar_kwi_maj_cze_lip_sie_wrz_pa_lis_gru".split("_"),monthsParse:r,longMonthsParse:r,shortMonthsParse:r,weekdays:"niedziela_poniedziaek_wtorek_roda_czwartek_pitek_sobota".split("_"),weekdaysShort:"ndz_pon_wt_r_czw_pt_sob".split("_"),weekdaysMin:"Nd_Pn_Wt_r_Cz_Pt_So".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Dzi o] LT",nextDay:"[Jutro o] LT",nextWeek:function(){switch(this.day()){case 0:return"[W niedziel o] LT";case 2:return"[We wtorek o] LT";case 3:return"[W rod o] LT";case 6:return"[W sobot o] LT";default:return"[W] dddd [o] LT"}},lastDay:"[Wczoraj o] LT",lastWeek:function(){switch(this.day()){case 0:return"[W zesz niedziel o] LT";case 3:return"[W zesz rod o] LT";case 6:return"[W zesz sobot o] LT";default:return"[W zeszy] dddd [o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"%s temu",s:"kilka sekund",ss:s,m:s,mm:s,h:s,hh:s,d:"1 dzie",dd:"%d dni",w:"tydzie",ww:s,M:"miesic",MM:s,y:"rok",yy:s},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("pt",{months:"janeiro_fevereiro_maro_abril_maio_junho_julho_agosto_setembro_outubro_novembro_dezembro".split("_"),monthsShort:"jan_fev_mar_abr_mai_jun_jul_ago_set_out_nov_dez".split("_"),weekdays:"Domingo_Segunda-feira_Tera-feira_Quarta-feira_Quinta-feira_Sexta-feira_Sbado".split("_"),weekdaysShort:"Dom_Seg_Ter_Qua_Qui_Sex_Sb".split("_"),weekdaysMin:"Do_2_3_4_5_6_S".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY HH:mm",LLLL:"dddd, D [de] MMMM [de] YYYY HH:mm"},calendar:{sameDay:"[Hoje s] LT",nextDay:"[Amanh s] LT",nextWeek:"dddd [s] LT",lastDay:"[Ontem s] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[ltimo] dddd [s] LT":"[ltima] dddd [s] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"h %s",s:"segundos",ss:"%d segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",w:"uma semana",ww:"%d semanas",M:"um ms",MM:"%d meses",y:"um ano",yy:"%d anos"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("pt-br",{months:"janeiro_fevereiro_maro_abril_maio_junho_julho_agosto_setembro_outubro_novembro_dezembro".split("_"),monthsShort:"jan_fev_mar_abr_mai_jun_jul_ago_set_out_nov_dez".split("_"),weekdays:"domingo_segunda-feira_tera-feira_quarta-feira_quinta-feira_sexta-feira_sbado".split("_"),weekdaysShort:"dom_seg_ter_qua_qui_sex_sb".split("_"),weekdaysMin:"do_2_3_4_5_6_s".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY [s] HH:mm",LLLL:"dddd, D [de] MMMM [de] YYYY [s] HH:mm"},calendar:{sameDay:"[Hoje s] LT",nextDay:"[Amanh s] LT",nextWeek:"dddd [s] LT",lastDay:"[Ontem s] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[ltimo] dddd [s] LT":"[ltima] dddd [s] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"h %s",s:"poucos segundos",ss:"%d segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um ms",MM:"%d meses",y:"um ano",yy:"%d anos"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",invalidDate:"Data invlida"})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
function t(e,t,i){var r=" ";return(e%100>=20||e>=100&&e%100==0)&&(r=" de "),e+r+{ss:"secunde",mm:"minute",hh:"ore",dd:"zile",ww:"sptmni",MM:"luni",yy:"ani"}[i]}e.defineLocale("ro",{months:"ianuarie_februarie_martie_aprilie_mai_iunie_iulie_august_septembrie_octombrie_noiembrie_decembrie".split("_"),monthsShort:"ian._feb._mart._apr._mai_iun._iul._aug._sept._oct._nov._dec.".split("_"),monthsParseExact:true,weekdays:"duminic_luni_mari_miercuri_joi_vineri_smbt".split("_"),weekdaysShort:"Dum_Lun_Mar_Mie_Joi_Vin_Sm".split("_"),weekdaysMin:"Du_Lu_Ma_Mi_Jo_Vi_S".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY H:mm",LLLL:"dddd, D MMMM YYYY H:mm"},calendar:{sameDay:"[azi la] LT",nextDay:"[mine la] LT",nextWeek:"dddd [la] LT",lastDay:"[ieri la] LT",lastWeek:"[fosta] dddd [la] LT",sameElse:"L"},relativeTime:{future:"peste %s",past:"%s n urm",s:"cteva secunde",ss:t,m:"un minut",mm:t,h:"o or",hh:t,d:"o zi",dd:t,w:"o sptmn",ww:t,M:"o lun",MM:t,y:"un an",yy:t},week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
function t(e,t,i){var r,n;return"m"===i?t?"":"":e+" "+(r=+e,n={ss:t?"__":"__",mm:t?"__":"__",hh:"__",dd:"__",ww:"__",MM:"__",yy:"__"}[i].split("_"),r%10==1&&r%100!=11?n[0]:r%10>=2&&r%10<=4&&(r%100<10||r%100>=20)?n[1]:n[2])}var i=[/^/i,/^/i,/^/i,/^/i,/^[]/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i,/^/i];e.defineLocale("ru",{months:{format:"___________".split("_"),standalone:"___________".split("_")},monthsShort:{format:"._._._.____._._._._.".split("_"),standalone:"._.__.____._._._._.".split("_")},weekdays:{standalone:"______".split("_"),format:"______".split("_"),isFormat:/\[ ?[] ?(?:||)? ?] ?dddd/},weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),monthsParse:i,longMonthsParse:i,shortMonthsParse:i,monthsRegex:/^([]|\.?|[]|?\.?|?|\.?|[]|\.?|[]|[]|\.?|[]|\.?|?|\.?|[]|?\.?|[]|\.?|[]|?\.?|[]|\.?)/i,monthsShortRegex:/^([]|\.?|[]|?\.?|?|\.?|[]|\.?|[]|[]|\.?|[]|\.?|?|\.?|[]|?\.?|[]|\.?|[]|?\.?|[]|\.?)/i,monthsStrictRegex:/^([]|[]|?|[]|[]|[]|[]|?|[]|[]|[]|[])/i,monthsShortStrictRegex:/^(\.|?\.|[.]|\.|[]|[.]|[.]|\.|?\.|\.|?\.|\.)/i,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., H:mm",LLLL:"dddd, D MMMM YYYY ., H:mm"},calendar:{sameDay:"[, ] LT",nextDay:"[, ] LT",lastDay:"[, ] LT",nextWeek:function(e){if(e.week()===this.week())return 2===this.day()?"[] dddd, [] LT":"[] dddd, [] LT";switch(this.day()){case 0:return"[ ] dddd, [] LT";case 1:case 2:case 4:return"[ ] dddd, [] LT";case 3:case 5:case 6:return"[ ] dddd, [] LT"}},lastWeek:function(e){if(e.week()===this.week())return 2===this.day()?"[] dddd, [] LT":"[] dddd, [] LT";switch(this.day()){case 0:return"[ ] dddd, [] LT";case 1:case 2:case 4:return"[ ] dddd, [] LT";case 3:case 5:case 6:return"[ ] dddd, [] LT"}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",ss:t,m:t,mm:t,h:"",hh:t,d:"",dd:t,w:"",ww:t,M:"",MM:t,y:"",yy:t},meridiemParse:/|||/i,isPM:function(e){return/^(|)$/.test(e)},meridiem:function(e,t,i){return e<4?"":e<12?"":e<17?"":""},dayOfMonthOrdinalParse:/\d{1,2}-(||)/,ordinal:function(e,t){switch(t){case"M":case"d":case"DDD":return e+"-";case"D":return e+"-";case"w":case"W":return e+"-";default:return e}},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t=["","","","","","","","","","","",""],i=["","","","","","",""];e.defineLocale("sd",{months:t,monthsShort:t,weekdays:i,weekdaysShort:i,weekdaysMin:i,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(e){return""===e},meridiem:function(e,t,i){return e<12?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd [  ] LT",lastDay:"[] LT",lastWeek:"[ ] dddd [] LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(e){return e.replace(//g,",")},postformat:function(e){return e.replace(/,/g,"")},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("se",{months:"oajagemnnu_guovvamnnu_njukamnnu_cuoomnnu_miessemnnu_geassemnnu_suoidnemnnu_borgemnnu_akamnnu_golggotmnnu_skbmamnnu_juovlamnnu".split("_"),monthsShort:"oj_guov_njuk_cuo_mies_geas_suoi_borg_ak_golg_skb_juov".split("_"),weekdays:"sotnabeaivi_vuossrga_maebrga_gaskavahkku_duorastat_bearjadat_lvvardat".split("_"),weekdaysShort:"sotn_vuos_ma_gask_duor_bear_lv".split("_"),weekdaysMin:"s_v_m_g_d_b_L".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"MMMM D. [b.] YYYY",LLL:"MMMM D. [b.] YYYY [ti.] HH:mm",LLLL:"dddd, MMMM D. [b.] YYYY [ti.] HH:mm"},calendar:{sameDay:"[otne ti] LT",nextDay:"[ihttin ti] LT",nextWeek:"dddd [ti] LT",lastDay:"[ikte ti] LT",lastWeek:"[ovddit] dddd [ti] LT",sameElse:"L"},relativeTime:{future:"%s geaes",past:"mait %s",s:"moadde sekunddat",ss:"%d sekunddat",m:"okta minuhta",mm:"%d minuhtat",h:"okta diimmu",hh:"%d diimmut",d:"okta beaivi",dd:"%d beaivvit",M:"okta mnnu",MM:"%d mnut",y:"okta jahki",yy:"%d jagit"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("si",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"a h:mm",LTS:"a h:mm:ss",L:"YYYY/MM/DD",LL:"YYYY MMMM D",LLL:"YYYY MMMM D, a h:mm",LLLL:"YYYY MMMM D [] dddd, a h:mm:ss"},calendar:{sameDay:"[] LT[]",nextDay:"[] LT[]",nextWeek:"dddd LT[]",lastDay:"[] LT[]",lastWeek:"[] dddd LT[]",sameElse:"L"},relativeTime:{future:"%s",past:"%s ",s:" ",ss:" %d",m:"",mm:" %d",h:"",hh:" %d",d:"",dd:" %d",M:"",MM:" %d",y:"",yy:" %d"},dayOfMonthOrdinalParse:/\d{1,2} /,ordinal:function(e){return e+" "},meridiemParse:/ | |.|../,isPM:function(e){return".."===e||" "===e},meridiem:function(e,t,i){return e>11?i?"..":" ":i?"..":" "}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t="janur_februr_marec_aprl_mj_jn_jl_august_september_oktber_november_december".split("_"),i="jan_feb_mar_apr_mj_jn_jl_aug_sep_okt_nov_dec".split("_");function r(e){return e>1&&e<5}function n(e,t,i,n){var s=e+" ";switch(i){case"s":return t||n?"pr seknd":"pr sekundami";case"ss":return t||n?s+(r(e)?"sekundy":"seknd"):s+"sekundami";case"m":return t?"minta":n?"mintu":"mintou";case"mm":return t||n?s+(r(e)?"minty":"mint"):s+"mintami";case"h":return t?"hodina":n?"hodinu":"hodinou";case"hh":return t||n?s+(r(e)?"hodiny":"hodn"):s+"hodinami";case"d":return t||n?"de":"dom";case"dd":return t||n?s+(r(e)?"dni":"dn"):s+"dami";case"M":return t||n?"mesiac":"mesiacom";case"MM":return t||n?s+(r(e)?"mesiace":"mesiacov"):s+"mesiacmi";case"y":return t||n?"rok":"rokom";case"yy":return t||n?s+(r(e)?"roky":"rokov"):s+"rokmi"}}e.defineLocale("sk",{months:t,monthsShort:i,weekdays:"nedea_pondelok_utorok_streda_tvrtok_piatok_sobota".split("_"),weekdaysShort:"ne_po_ut_st_t_pi_so".split("_"),weekdaysMin:"ne_po_ut_st_t_pi_so".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd D. MMMM YYYY H:mm"},calendar:{sameDay:"[dnes o] LT",nextDay:"[zajtra o] LT",nextWeek:function(){switch(this.day()){case 0:return"[v nedeu o] LT";case 1:case 2:return"[v] dddd [o] LT";case 3:return"[v stredu o] LT";case 4:return"[vo tvrtok o] LT";case 5:return"[v piatok o] LT";case 6:return"[v sobotu o] LT"}},lastDay:"[vera o] LT",lastWeek:function(){switch(this.day()){case 0:return"[minul nedeu o] LT";case 1:case 2:return"[minul] dddd [o] LT";case 3:return"[minul stredu o] LT";case 4:case 5:return"[minul] dddd [o] LT";case 6:return"[minul sobotu o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"pred %s",s:n,ss:n,m:n,mm:n,h:n,hh:n,d:n,dd:n,M:n,MM:n,y:n,yy:n},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
function t(e,t,i,r){var n=e+" ";switch(i){case"s":return t||r?"nekaj sekund":"nekaj sekundami";case"ss":return n+=1===e?t?"sekundo":"sekundi":2===e?t||r?"sekundi":"sekundah":e<5?t||r?"sekunde":"sekundah":"sekund";case"m":return t?"ena minuta":"eno minuto";case"mm":return n+=1===e?t?"minuta":"minuto":2===e?t||r?"minuti":"minutama":e<5?t||r?"minute":"minutami":t||r?"minut":"minutami";case"h":return t?"ena ura":"eno uro";case"hh":return n+=1===e?t?"ura":"uro":2===e?t||r?"uri":"urama":e<5?t||r?"ure":"urami":t||r?"ur":"urami";case"d":return t||r?"en dan":"enim dnem";case"dd":return n+=1===e?t||r?"dan":"dnem":2===e?t||r?"dni":"dnevoma":t||r?"dni":"dnevi";case"M":return t||r?"en mesec":"enim mesecem";case"MM":return n+=1===e?t||r?"mesec":"mesecem":2===e?t||r?"meseca":"mesecema":e<5?t||r?"mesece":"meseci":t||r?"mesecev":"meseci";case"y":return t||r?"eno leto":"enim letom";case"yy":return n+=1===e?t||r?"leto":"letom":2===e?t||r?"leti":"letoma":e<5?t||r?"leta":"leti":t||r?"let":"leti"}}e.defineLocale("sl",{months:"januar_februar_marec_april_maj_junij_julij_avgust_september_oktober_november_december".split("_"),monthsShort:"jan._feb._mar._apr._maj._jun._jul._avg._sep._okt._nov._dec.".split("_"),monthsParseExact:true,weekdays:"nedelja_ponedeljek_torek_sreda_etrtek_petek_sobota".split("_"),weekdaysShort:"ned._pon._tor._sre._et._pet._sob.".split("_"),weekdaysMin:"ne_po_to_sr_e_pe_so".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD. MM. YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY H:mm",LLLL:"dddd, D. MMMM YYYY H:mm"},calendar:{sameDay:"[danes ob] LT",nextDay:"[jutri ob] LT",nextWeek:function(){switch(this.day()){case 0:return"[v] [nedeljo] [ob] LT";case 3:return"[v] [sredo] [ob] LT";case 6:return"[v] [soboto] [ob] LT";case 1:case 2:case 4:case 5:return"[v] dddd [ob] LT"}},lastDay:"[veraj ob] LT",lastWeek:function(){switch(this.day()){case 0:return"[prejnjo] [nedeljo] [ob] LT";case 3:return"[prejnjo] [sredo] [ob] LT";case 6:return"[prejnjo] [soboto] [ob] LT";case 1:case 2:case 4:case 5:return"[prejnji] dddd [ob] LT"}},sameElse:"L"},relativeTime:{future:"ez %s",past:"pred %s",s:t,ss:t,m:t,mm:t,h:t,hh:t,d:t,dd:t,M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("sq",{months:"Janar_Shkurt_Mars_Prill_Maj_Qershor_Korrik_Gusht_Shtator_Tetor_Nntor_Dhjetor".split("_"),monthsShort:"Jan_Shk_Mar_Pri_Maj_Qer_Kor_Gus_Sht_Tet_Nn_Dhj".split("_"),weekdays:"E Diel_E Hn_E Mart_E Mrkur_E Enjte_E Premte_E Shtun".split("_"),weekdaysShort:"Die_Hn_Mar_Mr_Enj_Pre_Sht".split("_"),weekdaysMin:"D_H_Ma_M_E_P_Sh".split("_"),weekdaysParseExact:true,meridiemParse:/PD|MD/,isPM:function(e){return"M"===e.charAt(0)},meridiem:function(e,t,i){return e<12?"PD":"MD"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Sot n] LT",nextDay:"[Nesr n] LT",nextWeek:"dddd [n] LT",lastDay:"[Dje n] LT",lastWeek:"dddd [e kaluar n] LT",sameElse:"L"},relativeTime:{future:"n %s",past:"%s m par",s:"disa sekonda",ss:"%d sekonda",m:"nj minut",mm:"%d minuta",h:"nj or",hh:"%d or",d:"nj dit",dd:"%d dit",M:"nj muaj",MM:"%d muaj",y:"nj vit",yy:"%d vite"},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={words:{ss:["sekunda","sekunde","sekundi"],m:["jedan minut","jednog minuta"],mm:["minut","minuta","minuta"],h:["jedan sat","jednog sata"],hh:["sat","sata","sati"],d:["jedan dan","jednog dana"],dd:["dan","dana","dana"],M:["jedan mesec","jednog meseca"],MM:["mesec","meseca","meseci"],y:["jednu godinu","jedne godine"],yy:["godinu","godine","godina"]},correctGrammaticalCase:function(e,t){return e%10>=1&&e%10<=4&&(e%100<10||e%100>=20)?e%10==1?t[0]:t[1]:t[2]},translate:function(e,i,r,n){var s,o=t.words[r];return 1===r.length?"y"===r&&i?"jedna godina":n||i?o[0]:o[1]:(s=t.correctGrammaticalCase(e,o),"yy"===r&&i&&"godinu"===s?e+" godina":e+" "+s)}};e.defineLocale("sr",{months:"januar_februar_mart_april_maj_jun_jul_avgust_septembar_oktobar_novembar_decembar".split("_"),monthsShort:"jan._feb._mar._apr._maj_jun_jul_avg._sep._okt._nov._dec.".split("_"),monthsParseExact:true,weekdays:"nedelja_ponedeljak_utorak_sreda_etvrtak_petak_subota".split("_"),weekdaysShort:"ned._pon._uto._sre._et._pet._sub.".split("_"),weekdaysMin:"ne_po_ut_sr_e_pe_su".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"D. M. YYYY.",LL:"D. MMMM YYYY.",LLL:"D. MMMM YYYY. H:mm",LLLL:"dddd, D. MMMM YYYY. H:mm"},calendar:{sameDay:"[danas u] LT",nextDay:"[sutra u] LT",nextWeek:function(){switch(this.day()){case 0:return"[u] [nedelju] [u] LT";case 3:return"[u] [sredu] [u] LT";case 6:return"[u] [subotu] [u] LT";case 1:case 2:case 4:case 5:return"[u] dddd [u] LT"}},lastDay:"[jue u] LT",lastWeek:function(){return["[prole] [nedelje] [u] LT","[prolog] [ponedeljka] [u] LT","[prolog] [utorka] [u] LT","[prole] [srede] [u] LT","[prolog] [etvrtka] [u] LT","[prolog] [petka] [u] LT","[prole] [subote] [u] LT"][this.day()]},sameElse:"L"},relativeTime:{future:"za %s",past:"pre %s",s:"nekoliko sekundi",ss:t.translate,m:t.translate,mm:t.translate,h:t.translate,hh:t.translate,d:t.translate,dd:t.translate,M:t.translate,MM:t.translate,y:t.translate,yy:t.translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={words:{ss:["","",""],m:[" "," "],mm:["","",""],h:[" "," "],hh:["","",""],d:[" "," "],dd:["","",""],M:[" "," "],MM:["","",""],y:[" "," "],yy:["","",""]},correctGrammaticalCase:function(e,t){return e%10>=1&&e%10<=4&&(e%100<10||e%100>=20)?e%10==1?t[0]:t[1]:t[2]},translate:function(e,i,r,n){var s,o=t.words[r];return 1===r.length?"y"===r&&i?" ":n||i?o[0]:o[1]:(s=t.correctGrammaticalCase(e,o),"yy"===r&&i&&""===s?e+" ":e+" "+s)}};e.defineLocale("sr-cyrl",{months:"___________".split("_"),monthsShort:"._._._.____._._._._.".split("_"),monthsParseExact:true,weekdays:"______".split("_"),weekdaysShort:"._._._._._._.".split("_"),weekdaysMin:"______".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"D. M. YYYY.",LL:"D. MMMM YYYY.",LLL:"D. MMMM YYYY. H:mm",LLLL:"dddd, D. MMMM YYYY. H:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:function(){switch(this.day()){case 0:return"[] [] [] LT";case 3:return"[] [] [] LT";case 6:return"[] [] [] LT";case 1:case 2:case 4:case 5:return"[] dddd [] LT"}},lastDay:"[ ] LT",lastWeek:function(){return["[] [] [] LT","[] [] [] LT","[] [] [] LT","[] [] [] LT","[] [] [] LT","[] [] [] LT","[] [] [] LT"][this.day()]},sameElse:"L"},relativeTime:{future:" %s",past:" %s",s:" ",ss:t.translate,m:t.translate,mm:t.translate,h:t.translate,hh:t.translate,d:t.translate,dd:t.translate,M:t.translate,MM:t.translate,y:t.translate,yy:t.translate},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("ss",{months:"Bhimbidvwane_Indlovana_Indlov'lenkhulu_Mabasa_Inkhwekhweti_Inhlaba_Kholwane_Ingci_Inyoni_Imphala_Lweti_Ingongoni".split("_"),monthsShort:"Bhi_Ina_Inu_Mab_Ink_Inh_Kho_Igc_Iny_Imp_Lwe_Igo".split("_"),weekdays:"Lisontfo_Umsombuluko_Lesibili_Lesitsatfu_Lesine_Lesihlanu_Umgcibelo".split("_"),weekdaysShort:"Lis_Umb_Lsb_Les_Lsi_Lsh_Umg".split("_"),weekdaysMin:"Li_Us_Lb_Lt_Ls_Lh_Ug".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Namuhla nga] LT",nextDay:"[Kusasa nga] LT",nextWeek:"dddd [nga] LT",lastDay:"[Itolo nga] LT",lastWeek:"dddd [leliphelile] [nga] LT",sameElse:"L"},relativeTime:{future:"nga %s",past:"wenteka nga %s",s:"emizuzwana lomcane",ss:"%d mzuzwana",m:"umzuzu",mm:"%d emizuzu",h:"lihora",hh:"%d emahora",d:"lilanga",dd:"%d emalanga",M:"inyanga",MM:"%d tinyanga",y:"umnyaka",yy:"%d iminyaka"},meridiemParse:/ekuseni|emini|entsambama|ebusuku/,meridiem:function(e,t,i){return e<11?"ekuseni":e<15?"emini":e<19?"entsambama":"ebusuku"},meridiemHour:function(e,t){return 12===e&&(e=0),"ekuseni"===t?e:"emini"===t?e>=11?e:e+12:"entsambama"===t||"ebusuku"===t?0===e?0:e+12:void 0},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("sv",{months:"januari_februari_mars_april_maj_juni_juli_augusti_september_oktober_november_december".split("_"),monthsShort:"jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),weekdays:"sndag_mndag_tisdag_onsdag_torsdag_fredag_lrdag".split("_"),weekdaysShort:"sn_mn_tis_ons_tor_fre_lr".split("_"),weekdaysMin:"s_m_ti_on_to_fr_l".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [kl.] HH:mm",LLLL:"dddd D MMMM YYYY [kl.] HH:mm",lll:"D MMM YYYY HH:mm",llll:"ddd D MMM YYYY HH:mm"},calendar:{sameDay:"[Idag] LT",nextDay:"[Imorgon] LT",lastDay:"[Igr] LT",nextWeek:"[P] dddd LT",lastWeek:"[I] dddd[s] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"fr %s sedan",s:"ngra sekunder",ss:"%d sekunder",m:"en minut",mm:"%d minuter",h:"en timme",hh:"%d timmar",d:"en dag",dd:"%d dagar",M:"en mnad",MM:"%d mnader",y:"ett r",yy:"%d r"},dayOfMonthOrdinalParse:/\d{1,2}(\:e|\:a)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?":e":1===t||2===t?":a":":e")},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("sw",{months:"Januari_Februari_Machi_Aprili_Mei_Juni_Julai_Agosti_Septemba_Oktoba_Novemba_Desemba".split("_"),monthsShort:"Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ago_Sep_Okt_Nov_Des".split("_"),weekdays:"Jumapili_Jumatatu_Jumanne_Jumatano_Alhamisi_Ijumaa_Jumamosi".split("_"),weekdaysShort:"Jpl_Jtat_Jnne_Jtan_Alh_Ijm_Jmos".split("_"),weekdaysMin:"J2_J3_J4_J5_Al_Ij_J1".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"hh:mm A",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[leo saa] LT",nextDay:"[kesho saa] LT",nextWeek:"[wiki ijayo] dddd [saat] LT",lastDay:"[jana] LT",lastWeek:"[wiki iliyopita] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s baadaye",past:"tokea %s",s:"hivi punde",ss:"sekunde %d",m:"dakika moja",mm:"dakika %d",h:"saa limoja",hh:"masaa %d",d:"siku moja",dd:"siku %d",M:"mwezi mmoja",MM:"miezi %d",y:"mwaka mmoja",yy:"miaka %d"},week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={1:"",2:"",3:"",4:"",5:"",6:"",7:"",8:"",9:"",0:""},i={"":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"0"};e.defineLocale("ta",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, HH:mm",LLLL:"dddd, D MMMM YYYY, HH:mm"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[ ] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:"  ",ss:"%d ",m:" ",mm:"%d ",h:"  ",hh:"%d  ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(e){return e+""},preparse:function(e){return e.replace(/[]/g,(function(e){return i[e]}))},postformat:function(e){return e.replace(/\d/g,(function(e){return t[e]}))},meridiemParse:/|||||/,meridiem:function(e,t,i){return e<2?" ":e<6?" ":e<10?" ":e<14?" ":e<18?" ":e<22?" ":" "},meridiemHour:function(e,t){return 12===e&&(e=0),""===t?e<2?e:e+12:""===t||""===t||""===t&&e>=10?e:e+12},week:{dow:0,doy:6}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("te",{months:"___________".split("_"),monthsShort:"._.__.____._._._._.".split("_"),monthsParseExact:true,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"A h:mm",LTS:"A h:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY, A h:mm",LLLL:"dddd, D MMMM YYYY, A h:mm"},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"dddd, LT",lastDay:"[] LT",lastWeek:"[] dddd, LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:"%d",meridiemParse:/|||/,meridiemHour:function(e,t){return 12===e&&(e=0),""===t?e<4?e:e+12:""===t?e:""===t?e>=10?e:e+12:""===t?e+12:void 0},meridiem:function(e,t,i){return e<4?"":e<10?"":e<17?"":e<20?"":""},week:{dow:0,doy:6}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("tet",{months:"Janeiru_Fevereiru_Marsu_Abril_Maiu_Juu_Jullu_Agustu_Setembru_Outubru_Novembru_Dezembru".split("_"),monthsShort:"Jan_Fev_Mar_Abr_Mai_Jun_Jul_Ago_Set_Out_Nov_Dez".split("_"),weekdays:"Domingu_Segunda_Tersa_Kuarta_Kinta_Sesta_Sabadu".split("_"),weekdaysShort:"Dom_Seg_Ters_Kua_Kint_Sest_Sab".split("_"),weekdaysMin:"Do_Seg_Te_Ku_Ki_Ses_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Ohin iha] LT",nextDay:"[Aban iha] LT",nextWeek:"dddd [iha] LT",lastDay:"[Horiseik iha] LT",lastWeek:"dddd [semana kotuk] [iha] LT",sameElse:"L"},relativeTime:{future:"iha %s",past:"%s liuba",s:"segundu balun",ss:"segundu %d",m:"minutu ida",mm:"minutu %d",h:"oras ida",hh:"oras %d",d:"loron ida",dd:"loron %d",M:"fulan ida",MM:"fulan %d",y:"tinan ida",yy:"tinan %d"},dayOfMonthOrdinalParse:/\d{1,2}(st|nd|rd|th)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={0:"-",1:"-",2:"-",3:"-",4:"-",5:"-",6:"-",7:"-",8:"-",9:"-",10:"-",12:"-",13:"-",20:"-",30:"-",40:"-",50:"-",60:"-",70:"-",80:"-",90:"-",100:"-"};e.defineLocale("tg",{months:{format:"___________".split("_"),standalone:"___________".split("_")},monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",lastDay:"[ ] LT",nextWeek:"dddd[] [  ] LT",lastWeek:"dddd[] [  ] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},meridiemParse:/|||/,meridiemHour:function(e,t){return 12===e&&(e=0),""===t?e<4?e:e+12:""===t?e:""===t?e>=11?e:e+12:""===t?e+12:void 0},meridiem:function(e,t,i){return e<4?"":e<11?"":e<16?"":e<19?"":""},dayOfMonthOrdinalParse:/\d{1,2}-(|)/,ordinal:function(e){return e+(t[e]||t[e%10]||t[e>=100?100:null])},week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("th",{months:"___________".split("_"),monthsShort:".._.._.._.._.._.._.._.._.._.._.._..".split("_"),monthsParseExact:true,weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"._._._._._._.".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY  H:mm",LLLL:"dddd D MMMM YYYY  H:mm"},meridiemParse:/|/,isPM:function(e){return""===e},meridiem:function(e,t,i){return e<12?"":""},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd[ ] LT",lastDay:"[ ] LT",lastWeek:"[]dddd[ ] LT",sameElse:"L"},relativeTime:{future:" %s",past:"%s",s:"",ss:"%d ",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",w:"1 ",ww:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={1:"'inji",5:"'inji",8:"'inji",70:"'inji",80:"'inji",2:"'nji",7:"'nji",20:"'nji",50:"'nji",3:"'nji",4:"'nji",100:"'nji",6:"'njy",9:"'unjy",10:"'unjy",30:"'unjy",60:"'ynjy",90:"'ynjy"};e.defineLocale("tk",{months:"anwar_Fewral_Mart_Aprel_Ma_Iun_Iul_Awgust_Sentabr_Oktabr_Noabr_Dekabr".split("_"),monthsShort:"an_Few_Mar_Apr_Ma_In_Il_Awg_Sen_Okt_No_Dek".split("_"),weekdays:"ekenbe_Duenbe_Sienbe_arenbe_Penenbe_Anna_enbe".split("_"),weekdaysShort:"ek_Du_Si_ar_Pen_Ann_en".split("_"),weekdaysMin:"k_D_S_r_Pn_An_n".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[bugn sagat] LT",nextDay:"[ertir sagat] LT",nextWeek:"[indiki] dddd [sagat] LT",lastDay:"[dn] LT",lastWeek:"[geen] dddd [sagat] LT",sameElse:"L"},relativeTime:{future:"%s so",past:"%s ",s:"birne sekunt",m:"bir minut",mm:"%d minut",h:"bir sagat",hh:"%d sagat",d:"bir gn",dd:"%d gn",M:"bir a",MM:"%d a",y:"bir yl",yy:"%d yl"},ordinal:function(e,i){switch(i){case"d":case"D":case"Do":case"DD":return e;default:if(0===e)return e+"'unjy";var r=e%10;return e+(t[r]||t[e%100-r]||t[e>=100?100:null])}},week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("tl-ph",{months:"Enero_Pebrero_Marso_Abril_Mayo_Hunyo_Hulyo_Agosto_Setyembre_Oktubre_Nobyembre_Disyembre".split("_"),monthsShort:"Ene_Peb_Mar_Abr_May_Hun_Hul_Ago_Set_Okt_Nob_Dis".split("_"),weekdays:"Linggo_Lunes_Martes_Miyerkules_Huwebes_Biyernes_Sabado".split("_"),weekdaysShort:"Lin_Lun_Mar_Miy_Huw_Biy_Sab".split("_"),weekdaysMin:"Li_Lu_Ma_Mi_Hu_Bi_Sab".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"MM/D/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY HH:mm",LLLL:"dddd, MMMM DD, YYYY HH:mm"},calendar:{sameDay:"LT [ngayong araw]",nextDay:"[Bukas ng] LT",nextWeek:"LT [sa susunod na] dddd",lastDay:"LT [kahapon]",lastWeek:"LT [noong nakaraang] dddd",sameElse:"L"},relativeTime:{future:"sa loob ng %s",past:"%s ang nakalipas",s:"ilang segundo",ss:"%d segundo",m:"isang minuto",mm:"%d minuto",h:"isang oras",hh:"%d oras",d:"isang araw",dd:"%d araw",M:"isang buwan",MM:"%d buwan",y:"isang taon",yy:"%d taon"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(e){return e},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t="pagh_wa_cha_wej_loS_vagh_jav_Soch_chorgh_Hut".split("_");function i(e,i,r,n){var s=function(e){var i=Math.floor(e%1e3/100),r=Math.floor(e%100/10),n=e%10,s="";return i>0&&(s+=t[i]+"vatlh"),r>0&&(s+=(""!==s?" ":"")+t[r]+"maH"),n>0&&(s+=(""!==s?" ":"")+t[n]),""===s?"pagh":s}(e);switch(r){case"ss":return s+" lup";case"mm":return s+" tup";case"hh":return s+" rep";case"dd":return s+" jaj";case"MM":return s+" jar";case"yy":return s+" DIS"}}e.defineLocale("tlh",{months:"tera jar wa_tera jar cha_tera jar wej_tera jar loS_tera jar vagh_tera jar jav_tera jar Soch_tera jar chorgh_tera jar Hut_tera jar wamaH_tera jar wamaH wa_tera jar wamaH cha".split("_"),monthsShort:"jar wa_jar cha_jar wej_jar loS_jar vagh_jar jav_jar Soch_jar chorgh_jar Hut_jar wamaH_jar wamaH wa_jar wamaH cha".split("_"),monthsParseExact:true,weekdays:"lojmItjaj_DaSjaj_povjaj_ghItlhjaj_loghjaj_buqjaj_ghInjaj".split("_"),weekdaysShort:"lojmItjaj_DaSjaj_povjaj_ghItlhjaj_loghjaj_buqjaj_ghInjaj".split("_"),weekdaysMin:"lojmItjaj_DaSjaj_povjaj_ghItlhjaj_loghjaj_buqjaj_ghInjaj".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[DaHjaj] LT",nextDay:"[waleS] LT",nextWeek:"LLL",lastDay:"[waHu] LT",lastWeek:"LLL",sameElse:"L"},relativeTime:{future:function(e){var t=e;return t=-1!==e.indexOf("jaj")?t.slice(0,-3)+"leS":-1!==e.indexOf("jar")?t.slice(0,-3)+"waQ":-1!==e.indexOf("DIS")?t.slice(0,-3)+"nem":t+" pIq"},past:function(e){var t=e;return t=-1!==e.indexOf("jaj")?t.slice(0,-3)+"Hu":-1!==e.indexOf("jar")?t.slice(0,-3)+"wen":-1!==e.indexOf("DIS")?t.slice(0,-3)+"ben":t+" ret"},s:"puS lup",ss:i,m:"wa tup",mm:i,h:"wa rep",hh:i,d:"wa jaj",dd:i,M:"wa jar",MM:i,y:"wa DIS",yy:i},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t={1:"'inci",5:"'inci",8:"'inci",70:"'inci",80:"'inci",2:"'nci",7:"'nci",20:"'nci",50:"'nci",3:"'nc",4:"'nc",100:"'nc",6:"'nc",9:"'uncu",10:"'uncu",30:"'uncu",60:"'nc",90:"'nc"};e.defineLocale("tr",{months:"Ocak_ubat_Mart_Nisan_Mays_Haziran_Temmuz_Austos_Eyll_Ekim_Kasm_Aralk".split("_"),monthsShort:"Oca_ub_Mar_Nis_May_Haz_Tem_Au_Eyl_Eki_Kas_Ara".split("_"),weekdays:"Pazar_Pazartesi_Sal_aramba_Perembe_Cuma_Cumartesi".split("_"),weekdaysShort:"Paz_Pzt_Sal_ar_Per_Cum_Cmt".split("_"),weekdaysMin:"Pz_Pt_Sa_a_Pe_Cu_Ct".split("_"),meridiem:function(e,t,i){return e<12?i?"":"":i?"s":"S"},meridiemParse:/||s|S/,isPM:function(e){return"s"===e||"S"===e},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[bugn saat] LT",nextDay:"[yarn saat] LT",nextWeek:"[gelecek] dddd [saat] LT",lastDay:"[dn] LT",lastWeek:"[geen] dddd [saat] LT",sameElse:"L"},relativeTime:{future:"%s sonra",past:"%s nce",s:"birka saniye",ss:"%d saniye",m:"bir dakika",mm:"%d dakika",h:"bir saat",hh:"%d saat",d:"bir gn",dd:"%d gn",w:"bir hafta",ww:"%d hafta",M:"bir ay",MM:"%d ay",y:"bir yl",yy:"%d yl"},ordinal:function(e,i){switch(i){case"d":case"D":case"Do":case"DD":return e;default:if(0===e)return e+"'nc";var r=e%10;return e+(t[r]||t[e%100-r]||t[e>=100?100:null])}},week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
function t(e,t,i,r){var n={s:["viensas secunds","'iensas secunds"],ss:[e+" secunds",e+" secunds"],m:["'n mut","'iens mut"],mm:[e+" muts",e+" muts"],h:["'n ora","'iensa ora"],hh:[e+" oras",e+" oras"],d:["'n ziua","'iensa ziua"],dd:[e+" ziuas",e+" ziuas"],M:["'n mes","'iens mes"],MM:[e+" mesen",e+" mesen"],y:["'n ar","'iens ar"],yy:[e+" ars",e+" ars"]};return r||t?n[i][0]:n[i][1]}e.defineLocale("tzl",{months:"Januar_Fevraglh_Mar_Avru_Mai_Gn_Julia_Guscht_Setemvar_Listopts_Noemvar_Zecemvar".split("_"),monthsShort:"Jan_Fev_Mar_Avr_Mai_Gn_Jul_Gus_Set_Lis_Noe_Zec".split("_"),weekdays:"Sladi_Lnei_Maitzi_Mrcuri_Xhadi_Vineri_Sturi".split("_"),weekdaysShort:"Sl_Ln_Mai_Mr_Xh_Vi_St".split("_"),weekdaysMin:"S_L_Ma_M_Xh_Vi_S".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD.MM.YYYY",LL:"D. MMMM [dallas] YYYY",LLL:"D. MMMM [dallas] YYYY HH.mm",LLLL:"dddd, [li] D. MMMM [dallas] YYYY HH.mm"},meridiemParse:/d\'o|d\'a/i,isPM:function(e){return"d'o"===e.toLowerCase()},meridiem:function(e,t,i){return e>11?i?"d'o":"D'O":i?"d'a":"D'A"},calendar:{sameDay:"[oxhi ] LT",nextDay:"[dem ] LT",nextWeek:"dddd [] LT",lastDay:"[ieiri ] LT",lastWeek:"[sr el] dddd [lasteu ] LT",sameElse:"L"},relativeTime:{future:"osprei %s",past:"ja%s",s:t,ss:t,m:t,mm:t,h:t,hh:t,d:t,dd:t,M:t,MM:t,y:t,yy:t},dayOfMonthOrdinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("tzm",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[ ] LT",lastWeek:"dddd [] LT",sameElse:"L"},relativeTime:{future:"   %s",past:" %s",s:"",ss:"%d ",m:"",mm:"%d ",h:"",hh:"%d ",d:"",dd:"%d o",M:"o",MM:"%d ",y:"",yy:"%d "},week:{dow:6,doy:12}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("tzm-latn",{months:"innayr_brayr_mars_ibrir_mayyw_ywnyw_ywlywz_wt_wtanbir_ktwbr_nwwanbir_dwjnbir".split("_"),monthsShort:"innayr_brayr_mars_ibrir_mayyw_ywnyw_ywlywz_wt_wtanbir_ktwbr_nwwanbir_dwjnbir".split("_"),weekdays:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),weekdaysShort:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),weekdaysMin:"asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[asdkh g] LT",nextDay:"[aska g] LT",nextWeek:"dddd [g] LT",lastDay:"[assant g] LT",lastWeek:"dddd [g] LT",sameElse:"L"},relativeTime:{future:"dadkh s yan %s",past:"yan %s",s:"imik",ss:"%d imik",m:"minu",mm:"%d minu",h:"saa",hh:"%d tassain",d:"ass",dd:"%d ossan",M:"ayowr",MM:"%d iyyirn",y:"asgas",yy:"%d isgasn"},week:{dow:6,doy:12}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("ug-cn",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY-MM-DD",LL:"YYYY-M-D-",LLL:"YYYY-M-D- HH:mm",LLLL:"dddd YYYY-M-D- HH:mm"},meridiemParse:/ || || |/,meridiemHour:function(e,t){return 12===e&&(e=0)," "===t||""===t||" "===t?e:" "===t||""===t?e+12:e>=11?e:e+12},meridiem:function(e,t,i){var r=100*e+t;return r<600?" ":r<900?"":r<1130?" ":r<1230?"":r<1800?" ":""},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"[] dddd [] LT",lastDay:"[] LT",lastWeek:"[] dddd [] LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},dayOfMonthOrdinalParse:/\d{1,2}(-|-|-)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"-";case"w":case"W":return e+"-";default:return e}},preparse:function(e){return e.replace(//g,",")},postformat:function(e){return e.replace(/,/g,"")},week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
function t(e,t,i){var r,n;return"m"===i?t?"":"":"h"===i?t?"":"":e+" "+(r=+e,n={ss:t?"__":"__",mm:t?"__":"__",hh:t?"__":"__",dd:"__",MM:"__",yy:"__"}[i].split("_"),r%10==1&&r%100!=11?n[0]:r%10>=2&&r%10<=4&&(r%100<10||r%100>=20)?n[1]:n[2])}function i(e){return function(){return e+""+(11===this.hours()?"":"")+"] LT"}}e.defineLocale("uk",{months:{format:"___________".split("_"),standalone:"___________".split("_")},monthsShort:"___________".split("_"),weekdays:function(e,t){var i={nominative:"______".split("_"),accusative:"______".split("_"),genitive:"______".split("_")};return true===e?i.nominative.slice(1,7).concat(i.nominative.slice(0,1)):e?i[/(\[[]\]) ?dddd/.test(t)?"accusative":/\[?(?:|)? ?\] ?dddd/.test(t)?"genitive":"nominative"][e.day()]:i.nominative},weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY .",LLL:"D MMMM YYYY ., HH:mm",LLLL:"dddd, D MMMM YYYY ., HH:mm"},calendar:{sameDay:i("[ "),nextDay:i("[ "),lastDay:i("[ "),nextWeek:i("[] dddd ["),lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return i("[] dddd [").call(this);case 1:case 2:case 4:return i("[] dddd [").call(this)}},sameElse:"L"},relativeTime:{future:" %s",past:"%s ",s:" ",ss:t,m:t,mm:t,h:"",hh:t,d:"",dd:t,M:"",MM:t,y:"",yy:t},meridiemParse:/|||/,isPM:function(e){return/^(|)$/.test(e)},meridiem:function(e,t,i){return e<4?"":e<12?"":e<17?"":""},dayOfMonthOrdinalParse:/\d{1,2}-(|)/,ordinal:function(e,t){switch(t){case"M":case"d":case"DDD":case"w":case"W":return e+"-";case"D":return e+"-";default:return e}},week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
var t=["","","","","","","","","","","",""],i=["","","","","","",""];e.defineLocale("ur",{months:t,monthsShort:t,weekdays:i,weekdaysShort:i,weekdaysMin:i,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},meridiemParse:/|/,isPM:function(e){return""===e},meridiem:function(e,t,i){return e<12?"":""},calendar:{sameDay:"[ ] LT",nextDay:"[ ] LT",nextWeek:"dddd [] LT",lastDay:"[  ] LT",lastWeek:"[] dddd [] LT",sameElse:"L"},relativeTime:{future:"%s ",past:"%s ",s:" ",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},preparse:function(e){return e.replace(//g,",")},postformat:function(e){return e.replace(/,/g,"")},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("uz",{months:"___________".split("_"),monthsShort:"___________".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"D MMMM YYYY, dddd HH:mm"},calendar:{sameDay:"[ ] LT []",nextDay:"[] LT []",nextWeek:"dddd [ ] LT []",lastDay:"[ ] LT []",lastWeek:"[] dddd [ ] LT []",sameElse:"L"},relativeTime:{future:" %s ",past:"  %s ",s:"",ss:"%d ",m:" ",mm:"%d ",h:" ",hh:"%d ",d:" ",dd:"%d ",M:" ",MM:"%d ",y:" ",yy:"%d "},week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("uz-latn",{months:"Yanvar_Fevral_Mart_Aprel_May_Iyun_Iyul_Avgust_Sentabr_Oktabr_Noyabr_Dekabr".split("_"),monthsShort:"Yan_Fev_Mar_Apr_May_Iyun_Iyul_Avg_Sen_Okt_Noy_Dek".split("_"),weekdays:"Yakshanba_Dushanba_Seshanba_Chorshanba_Payshanba_Juma_Shanba".split("_"),weekdaysShort:"Yak_Dush_Sesh_Chor_Pay_Jum_Shan".split("_"),weekdaysMin:"Ya_Du_Se_Cho_Pa_Ju_Sha".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"D MMMM YYYY, dddd HH:mm"},calendar:{sameDay:"[Bugun soat] LT [da]",nextDay:"[Ertaga] LT [da]",nextWeek:"dddd [kuni soat] LT [da]",lastDay:"[Kecha soat] LT [da]",lastWeek:"[O'tgan] dddd [kuni soat] LT [da]",sameElse:"L"},relativeTime:{future:"Yaqin %s ichida",past:"Bir necha %s oldin",s:"soniya",ss:"%d soniya",m:"bir daqiqa",mm:"%d daqiqa",h:"bir soat",hh:"%d soat",d:"bir kun",dd:"%d kun",M:"bir oy",MM:"%d oy",y:"bir yil",yy:"%d yil"},week:{dow:1,doy:7}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("vi",{months:"thng 1_thng 2_thng 3_thng 4_thng 5_thng 6_thng 7_thng 8_thng 9_thng 10_thng 11_thng 12".split("_"),monthsShort:"Thg 01_Thg 02_Thg 03_Thg 04_Thg 05_Thg 06_Thg 07_Thg 08_Thg 09_Thg 10_Thg 11_Thg 12".split("_"),monthsParseExact:true,weekdays:"ch nht_th hai_th ba_th t_th nm_th su_th by".split("_"),weekdaysShort:"CN_T2_T3_T4_T5_T6_T7".split("_"),weekdaysMin:"CN_T2_T3_T4_T5_T6_T7".split("_"),weekdaysParseExact:true,meridiemParse:/sa|ch/i,isPM:function(e){return/^ch$/i.test(e)},meridiem:function(e,t,i){return e<12?i?"sa":"SA":i?"ch":"CH"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM [nm] YYYY",LLL:"D MMMM [nm] YYYY HH:mm",LLLL:"dddd, D MMMM [nm] YYYY HH:mm",l:"DD/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY HH:mm",llll:"ddd, D MMM YYYY HH:mm"},calendar:{sameDay:"[Hm nay lc] LT",nextDay:"[Ngy mai lc] LT",nextWeek:"dddd [tun ti lc] LT",lastDay:"[Hm qua lc] LT",lastWeek:"dddd [tun trc lc] LT",sameElse:"L"},relativeTime:{future:"%s ti",past:"%s trc",s:"vi giy",ss:"%d giy",m:"mt pht",mm:"%d pht",h:"mt gi",hh:"%d gi",d:"mt ngy",dd:"%d ngy",w:"mt tun",ww:"%d tun",M:"mt thng",MM:"%d thng",y:"mt nm",yy:"%d nm"},dayOfMonthOrdinalParse:/\d{1,2}/,ordinal:function(e){return e},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("x-pseudo",{months:"J~~r_F~br~r_~Mrc~h_p~rl_~M_~J~_Jl~_~gst~_Sp~tmb~r_~ctb~r_~vm~br_~Dc~mbr".split("_"),monthsShort:"J~_~Fb_~Mr_~pr_~M_~J_~Jl_~g_~Sp_~ct_~v_~Dc".split("_"),monthsParseExact:true,weekdays:"S~d~_M~d~_T~sd~_Wd~sd~_T~hrs~d_~Frd~_S~tr~d".split("_"),weekdaysShort:"S~_~M_~T_~Wd_~Th_~Fr_~St".split("_"),weekdaysMin:"S~_M~_T_~W_T~h_Fr~_S".split("_"),weekdaysParseExact:true,longDateFormat:{LT:"HH:mm",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[T~d~ t] LT",nextDay:"[T~m~rr~w t] LT",nextWeek:"dddd [t] LT",lastDay:"[~st~rd~ t] LT",lastWeek:"[L~st] dddd [t] LT",sameElse:"L"},relativeTime:{future:"~ %s",past:"%s ~g",s:" ~fw ~sc~ds",ss:"%d s~c~ds",m:" ~m~t",mm:"%d m~~ts",h:"~ h~r",hh:"%d h~rs",d:" ~d",dd:"%d d~s",M:" ~m~th",MM:"%d m~t~hs",y:" ~r",yy:"%d ~rs"},dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("yo",{months:"Sr_Erele_rna_Igbe_Ebibi_Okudu_Agmo_Ogun_Owewe_wara_Belu_p".split("_"),monthsShort:"Sr_Erl_rn_Igb_Ebi_Oku_Ag_Ogu_Owe_wa_Bel_p".split("_"),weekdays:"Aiku_Aje_Isgun_jru_jb_ti_Abamta".split("_"),weekdaysShort:"Aik_Aje_Is_jr_jb_ti_Aba".split("_"),weekdaysMin:"Ai_Aj_Is_r_b_t_Ab".split("_"),longDateFormat:{LT:"h:mm A",LTS:"h:mm:ss A",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY h:mm A",LLLL:"dddd, D MMMM YYYY h:mm A"},calendar:{sameDay:"[Oni ni] LT",nextDay:"[la ni] LT",nextWeek:"dddd [s ton'b] [ni] LT",lastDay:"[Ana ni] LT",lastWeek:"dddd [s tol] [ni] LT",sameElse:"L"},relativeTime:{future:"ni %s",past:"%s kja",s:"isju aaya die",ss:"aaya %d",m:"isju kan",mm:"isju %d",h:"wakati kan",hh:"wakati %d",d:"j kan",dd:"j %d",M:"osu kan",MM:"osu %d",y:"dun kan",yy:"dun %d"},dayOfMonthOrdinalParse:/j\s\d{1,2}/,ordinal:"j %d",week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("zh-cn",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYYMD",LLL:"YYYYMDAhmm",LLLL:"YYYYMDddddAhmm",l:"YYYY/M/D",ll:"YYYYMD",lll:"YYYYMD HH:mm",llll:"YYYYMDdddd HH:mm"},meridiemParse:/|||||/,meridiemHour:function(e,t){return 12===e&&(e=0),""===t||""===t||""===t?e:""===t||""===t?e+12:e>=11?e:e+12},meridiem:function(e,t,i){var r=100*e+t;return r<600?"":r<900?"":r<1130?"":r<1230?"":r<1800?"":""},calendar:{sameDay:"[]LT",nextDay:"[]LT",nextWeek:function(e){return e.week()!==this.week()?"[]dddLT":"[]dddLT"},lastDay:"[]LT",lastWeek:function(e){return this.week()!==e.week()?"[]dddLT":"[]dddLT"},sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(||)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"";case"M":return e+"";case"w":case"W":return e+"";default:return e}},relativeTime:{future:"%s",past:"%s",s:"",ss:"%d ",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",w:"1 ",ww:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "},week:{dow:1,doy:4}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("zh-hk",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYYMD",LLL:"YYYYMD HH:mm",LLLL:"YYYYMDdddd HH:mm",l:"YYYY/M/D",ll:"YYYYMD",lll:"YYYYMD HH:mm",llll:"YYYYMDdddd HH:mm"},meridiemParse:/|||||/,meridiemHour:function(e,t){return 12===e&&(e=0),""===t||""===t||""===t?e:""===t?e>=11?e:e+12:""===t||""===t?e+12:void 0},meridiem:function(e,t,i){var r=100*e+t;return r<600?"":r<900?"":r<1200?"":1200===r?"":r<1800?"":""},calendar:{sameDay:"[]LT",nextDay:"[]LT",nextWeek:"[]ddddLT",lastDay:"[]LT",lastWeek:"[]ddddLT",sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(||)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"";case"M":return e+"";case"w":case"W":return e+"";default:return e}},relativeTime:{future:"%s",past:"%s",s:"",ss:"%d ",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("zh-mo",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"YYYYMD",LLL:"YYYYMD HH:mm",LLLL:"YYYYMDdddd HH:mm",l:"D/M/YYYY",ll:"YYYYMD",lll:"YYYYMD HH:mm",llll:"YYYYMDdddd HH:mm"},meridiemParse:/|||||/,meridiemHour:function(e,t){return 12===e&&(e=0),""===t||""===t||""===t?e:""===t?e>=11?e:e+12:""===t||""===t?e+12:void 0},meridiem:function(e,t,i){var r=100*e+t;return r<600?"":r<900?"":r<1130?"":r<1230?"":r<1800?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[]dddd LT",lastDay:"[] LT",lastWeek:"[]dddd LT",sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(||)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"";case"M":return e+"";case"w":case"W":return e+"";default:return e}},relativeTime:{future:"%s",past:"%s",s:"",ss:"%d ",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "}})}(i(1))},function(e,t,i){!function(e){
//! moment.js locale configuration
e.defineLocale("zh-tw",{months:"___________".split("_"),monthsShort:"1_2_3_4_5_6_7_8_9_10_11_12".split("_"),weekdays:"______".split("_"),weekdaysShort:"______".split("_"),weekdaysMin:"______".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYYMD",LLL:"YYYYMD HH:mm",LLLL:"YYYYMDdddd HH:mm",l:"YYYY/M/D",ll:"YYYYMD",lll:"YYYYMD HH:mm",llll:"YYYYMDdddd HH:mm"},meridiemParse:/|||||/,meridiemHour:function(e,t){return 12===e&&(e=0),""===t||""===t||""===t?e:""===t?e>=11?e:e+12:""===t||""===t?e+12:void 0},meridiem:function(e,t,i){var r=100*e+t;return r<600?"":r<900?"":r<1130?"":r<1230?"":r<1800?"":""},calendar:{sameDay:"[] LT",nextDay:"[] LT",nextWeek:"[]dddd LT",lastDay:"[] LT",lastWeek:"[]dddd LT",sameElse:"L"},dayOfMonthOrdinalParse:/\d{1,2}(||)/,ordinal:function(e,t){switch(t){case"d":case"D":case"DDD":return e+"";case"M":return e+"";case"w":case"W":return e+"";default:return e}},relativeTime:{future:"%s",past:"%s",s:"",ss:"%d ",m:"1 ",mm:"%d ",h:"1 ",hh:"%d ",d:"1 ",dd:"%d ",M:"1 ",MM:"%d ",y:"1 ",yy:"%d "}})}(i(1))},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(429),n=i(141),s=i(6);class o extends r.NgPgiConferenceService{constructor(){super(),this.contactService=s.ContactService.getInstance()}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.pgiConferenceService||(e.rainbow.pgiConferenceService=new o),e.rainbow.pgiConferenceService}start(){this.contactService.userContact.phoneMeetingsEnabledSubject.pipe(n.distinctUntilChanged()).subscribe((e=>e?super.start():(this.logger.info("start skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null)))}async makeSnapshotForConfId(e){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("makeSnapshotForConfId skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):await super.makeSnapshotForConfId(e)}removeConferenceSession(e){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("removeConferenceSession skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):super.removeConferenceSession(e)}updateOrCreateConferenceSession(e,t){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("updateOrCreateConferenceSession skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):super.updateOrCreateConferenceSession(e,t)}async updateConference(e,t){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("updateConference skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):await super.updateConference(e,t)}getPstnInstantConferenceEndpoint(){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("getPstnInstantConferenceEndpoint skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):super.getPstnInstantConferenceEndpoint()}getPstnInstantConferenceEndpointId(){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("getPstnInstantConferenceEndpointId skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):super.getPstnInstantConferenceEndpointId()}async retrievePstnConferences(){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("retrievePstnConferences skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):await super.retrievePstnConferences()}async retrieveConference(e,t=false){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("retrieveConference skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):await super.retrieveConference(e,t)}updateOrCreatePstnConferenceEndpoint(e){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("updateOrCreatePstnConferenceEndpoint skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):super.updateOrCreatePstnConferenceEndpoint(e)}getConferenceSessionWithConnId(e){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("getConferenceSessionWithConnId skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):super.getConferenceSessionWithConnId(e)}getConferenceSessionById(e){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("getConferenceSessionById skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):super.getConferenceSessionById(e)}async subscribeToPstnSession(e){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("subscribeToPstnSession skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):super.subscribeToPstnSession(e)}async unSubscribeParticipantFromPstnSession(e,t){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("unSubscribeParticipantFromPstnSession skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):super.unSubscribeParticipantFromPstnSession(e,t)}async startPstnConference(e){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("startPstnConference skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):super.startPstnConference(e)}async stopPstnConference(e){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("stopPstnConference skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):super.stopPstnConference(e)}async joinPstnConference(e,t,i,r){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("joinPstnConference skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):super.joinPstnConference(e,t,i,r)}async disconnectParticipant(e,t){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("disconnectParticipant skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):super.disconnectParticipant(e,t)}async retrievePstnPhoneNumbers(e=false){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("retrievePstnPhoneNumbers skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):super.retrievePstnPhoneNumbers(e)}async resetPersonalMeetingRoom(){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("resetPersonalMeetingRoom skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):super.resetPersonalMeetingRoom()}subscribeToMyConferenceSessions(e){return this.contactService&&this.contactService.userContact&&!this.contactService.userContact.phoneMeetingsEnabled?(this.logger.info("subscribeToMyConferenceSessions skipped - phoneMeetingsEnabled : "+this.contactService.userContact.phoneMeetingsEnabled),null):super.subscribeToMyConferenceSessions(e)}}t.PgiConferenceService=o},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{constructor(e,t,i,r,n,s,o,a,c,l,d,u){this.participantId=e,this.userId=t,this.jid_im=i,this.jid_tel=r,this.participantRole=n,this.mute=s,this.held=o,this.confStartDate=a,this.startDate=c,this.phoneNumber=l,this.participantState=d,this.delegateCapability=u}static createFromData(e){return new r(e.participantId,e.userId,e.jid_im,e.jid_tel,e.participantRole,e.mute,e.held,e.confStartDate,e.startDate,e.phoneNumber,e.participantState,e.delegateCapability)}updateFromData(e){e.participantId&&(this.participantId=e.participantId),e.userId&&(this.userId=e.userId),this.jid_im=e.jid_im,e.jid_tel&&(this.jid_tel=e.jid_tel),this.participantRole=e.participantRole,this.mute=e.mute,this.held=e.held,this.confStartDate=e.confStartDate,this.startDate=e.startDate,this.phoneNumber=e.phoneNumber,this.participantState=e.participantState,this.delegateCapability=e.delegateCapability}}t.ConferenceParticipant=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});var r=i(93),n=i(77);t.scheduleArray=function(e,t){return new r.Observable((function(i){var r=new n.Subscription,s=0;return r.add(t.schedule((function(){s!==e.length?(i.next(e[s++]),i.closed||r.add(this.schedule())):i.complete()}))),r}))}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(4),n=i(8);class s{static create(e){if(!e.image||!e.image)return null;const t=new s;return t.title=e.title,t.url=e.url,t.description=e.description,e.image.startsWith("/")&&(t.image=t.url+e.image),e.image.startsWith("./")||e.image.startsWith("../")?t.image=t.url+"/"+e.image:t.image=e.image,t}}t.UrlMetaData=s;class o{constructor(){this.logger=r.LoggerService.getInstance(),this.authService=n.AuthService.getInstance(),this.linkRegex=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.urlMetadataService||(e.rainbow.urlMetadataService=new o),e.rainbow.urlMetadataService}getUrlFromString(e){const t=e.match(this.linkRegex);return t?t[0]:void 0}async getUrlMetadata(e,t=4e3){try{this.abortController?this.abortController.abort():this.abortController=new AbortController,setTimeout((()=>{this.abortController.abort()}),t);const i=config.restServerUrl+"/api/rainbow/urlmetadata/v1.0/url",r=this.authService.getPostHeader(),n=await fetch(i,{method:"POST",headers:r,body:JSON.stringify({url:e}),signal:this.abortController.signal});if(!n.ok)throw n;const o=(await n.json()).data;return this.abortController=null,this.logger.info("[urlMetadataService] getUrlMetadata -- success"),s.create(o)}catch(i){return this.abortController=null,this.logger.info("[urlMetadataService] getUrlMetadata -- failure"),null}}abortUrlMetadataRequest(){this.logger.info("[urlMetadataService] abortUrlMetadataRequest"),this.abortController&&(this.abortController.abort(),this.abortController=null)}}t.UrlMetadataService=o},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(4),n=i(107),s=i(110),o=i(66),a=i(6),c=i(9);class l{constructor(e){this.conversationService=e,this.SEARCHTEXT_INALLCONVERSATIONS_LIMIT=100,this.SEARCHTEXT_INROOM_LIMIT=100,this.logger=r.LoggerService.getInstance(),this.contactService=a.ContactService.getInstance(),this.xmppService=c.XmppService.getInstance(),this.utilitiesService=s.UtilitiesService.getInstance()}static create(e){return new l(e)}onHistoryMessageReceived(e){try{this.logger.debug("[ConversationServiceHistoryHandler] onHistoryMessageReceived: "+e);let t=null;const i=$(e),r=i.find("result").attr("queryid");if(r&&r.startsWith("cache_")){this.logger.info("[ConversationServiceHistoryHandler] onHistoryMessageReceived : Query Id for Cached Message");let e=r.substring(6);if(e=e.substring(0,e.length-5),t=this.conversationService.getConversation(e),t){let e;this.logger.info("[ConversationServiceHistoryHandler] onHistoryMessageReceived : Conversation Found");const r=i.find("forwarded message").attr("from");if(e=r&&0===r.indexOf("room_")?r.split("/")[1]:this.xmppService.getBareJidFromJid(i.find("forwarded message").attr("from")),!e&&i.find("event").length){const r=i.find("event").attr("name");e=i.find("event").attr("jid"),"welcome"===r&&t.room&&t.room.ownerContact&&(e=t.room.ownerContact.jid)}if(!e)return this.logger.warn("[ConversationServiceHistoryHandler] onHistoryMessageReceived - Receive message without valid fromJid information"),true;let n=this.contactService.getContactByJid(e);const s=i.find("forwarded message").attr("id"),a=new Date(i.find("forwarded delay").attr("stamp")),c=i.find("forwarded message body").text(),l=this.contactService.isUserContact(n)?o.Message.Side.RIGHT:o.Message.Side.LEFT;n||(this.logger.warn("[ConversationServiceHistoryHandler] onHistoryMessageReceived missing contact for jid : "+e+", ignore message"),n=this.contactService.createEmptyContact(e));const d=o.Message.create(s,a,n,l,c,false);d&&t.addMessageInCacheMessages(d)}}return true}catch(t){return this.logger.error("[ConversationServiceHistoryHandler] onHistoryMessageReceived error -- "+t),true}}onSearchTextMessageReceived(e){this.logger.info("[ConversationServiceHistoryHandler] onSearchTextMessageReceived");try{const t=$(e);let i;const r=t.find("forwarded message").attr("from"),s=t.find("forwarded message").attr("to");let o=false,a=false;if(this.contactService.isUserContactJid(r)?(this.logger.info("[ConversationServiceHistoryHandler] sent message"),o=true,i=s):(this.logger.info("[ConversationServiceHistoryHandler] received message"),o=false,i=r),i&&0===i.indexOf("room_")?(i=i.split("/")[0],a=true):i=this.xmppService.getBareJidFromJid(i),!i)return void this.logger.warn("[ConversationServiceHistoryHandler] onSearchTextMessageReceived - Receive message without valid otherJid information");const c=t.find("forwarded message").attr("id"),l=new Date(t.find("forwarded delay").attr("stamp")),d=t.find("forwarded message body").text(),u=t.find("result").attr("id"),h=n.SearchTextMsgResult.createSearchTextMsgResult();return h.body=d,h.date=l,h.isRoom=a,h.isSent=o,h.messageId=c,h.otherJid=i,h.historyIndex=u,h}catch(t){return void this.logger.error("[ConversationServiceHistoryHandler] onSearchTextMessageReceived error : "+t)}}retrieveMsgByDate(e,t){return new Promise(((i,r)=>{this.contactService.isUserContact(e.contact)&&r();const n=`cache_${e.id}${this.utilitiesService.randomString(5)}`;this.getCommonHistoryPageAroundMsg(n,e,1,t,"after",(()=>{this.logger.info("[ConversationServiceHistoryHandler] retrieveMsgByDate finished"),this.getCommonHistoryPageAroundMsg(n,e,1,t,"before",(()=>{this.logger.info("[ConversationServiceHistoryHandler] retrieveMsgByDate finished"),i()}))}))}))}getCommonHistoryPageAroundMsg(e,t,i,r,n,s){if(this.logger.info("[ConversationServiceHistoryHandler] getCommonHistoryPageAroundMsg("+e+", "+i+", "+t.historyIndex+")"),t.room){const o={queryid:e,with:this.contactService.userContact.jid,max:i,onComplete:s};o[n]=r,this.xmppService.connection.mam.querymuc(e,t.room.jid,o)}else{const o={queryid:e,with:t.id,max:i,onComplete:s};o[n]=r,this.xmppService.connection.mam.query(e,o)}}async searchTextInConversations(e,t){this.logger.info("[ConversationServiceHistoryHandler] searchTextInConversations("+t+")");const i=this.SEARCHTEXT_INALLCONVERSATIONS_LIMIT,r=this.xmppService.connection.getUniqueId(),n=$iq({id:r,type:"get"}).c("query",{queryid:e,xmlns:"urn:xmpp:mam:tmp"}).c("set",{xmlns:"http://jabber.org/protocol/rsm"}).c("max").t(i).up().c("before").up().up().c("x",{xmlns:"jabber:x:data",type:"form"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("urn:xmpp:mam:1").up().up().c("field",{var:"withtext",type:"text-single"}).c("value").t(t).up().up(),s=await this.xmppService.sendIQ(n);this.logger.info("[ConversationServiceHistoryHandler] sendIq Success: "+t);const o=$(s).find("query").find("set").find("count").text();return this.logger.info("[ConversationServiceHistoryHandler] >searchTextInConversations: count= "+o),parseInt(o,10)}async searchTextResultsInConversation(e,t,i){this.logger.info("[ConversationServiceHistoryHandler] searchTextResultsInConversation("+t+")");const r=this.SEARCHTEXT_INALLCONVERSATIONS_LIMIT,n=this.xmppService.connection.getUniqueId(),s=$iq({id:n,type:"get"}).c("query",{queryid:e,xmlns:"urn:xmpp:mam:tmp"}).c("set",{xmlns:"http://jabber.org/protocol/rsm"}).c("max").t(r).up().c("before").up().up().c("x",{xmlns:"jabber:x:data",type:"form"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("urn:xmpp:mam:1").up().up().c("field",{var:"withtext",type:"text-single"}).c("value").t(t).up().up().c("field",{var:"with",type:"text-single"}).c("value").t(i).up().up(),o=await this.xmppService.sendIQ(s);this.logger.info("[ConversationServiceHistoryHandler] sendIq Success: "+t);const a=$(o).find("query").find("set").find("count").text();return this.logger.info("[ConversationServiceHistoryHandler] >getConversationTextCount: count= "+a),parseInt(a,10)}async searchTextResultsInRoom(e,t,i){this.logger.info("[ConversationServiceHistoryHandler] searchTextInRoom("+t+")");const r=this.contactService.userContact.jid,n=this.xmppService.connection.getUniqueId(),s=$iq({to:i,id:n,type:"get"}).c("query",{queryid:e,xmlns:"urn:xmpp:mam:tmp"}).c("set",{xmlns:"http://jabber.org/protocol/rsm"}).c("max").t(this.SEARCHTEXT_INROOM_LIMIT).up().c("before").up().up().c("x",{xmlns:"jabber:x:data",type:"form"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("urn:xmpp:mam:1").up().up().c("field",{var:"with",type:"text-single"}).c("value").t(r).up().up().c("field",{var:"withtext",type:"text-single"}).c("value").t(t).up().up(),o=await this.xmppService.sendIQ(s);this.logger.info("[ConversationServiceHistoryHandler] sendIq Success: "+t);const a=$(o).find("query").find("set").find("count").text();return this.logger.info("[ConversationServiceHistoryHandler] >searchTextInRoom: count= "+a),parseInt(a,10)}}t.ConversationServiceHistoryHandler=l},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7),n=i(18),s=i(4),o=i(13),a=i(8),c=i(140),l=i(11),d=i(148),u=i(14),h=i(6),f=i(147),p=i(63);var g;!function(e){e.PERSONAL_DIRECTORY_ADD="PERSONAL_DIRECTORY_ADD",e.PERSONAL_DIRECTORY_DELETE="PERSONAL_DIRECTORY_DELETE",e.PERSONAL_DIRECTORY_UPDATE="PERSONAL_DIRECTORY_UPDATE",e.PERSONAL_DIRECTORY_DELETE_ALL="PERSONAL_DIRECTORY_DELETE_ALL",e.PERSONAL_DIRECTORY_TAG_DELETE="PERSONAL_DIRECTORY_TAG_DELETE",e.PERSONAL_DIRECTORY_TAG_RENAME="PERSONAL_DIRECTORY_TAG_RENAME"}(g=t.PersonalDirectoryEvent||(t.PersonalDirectoryEvent={}));class m{constructor(){this.logger=s.LoggerService.getInstance(),this.authService=a.AuthService.getInstance(),this.eventService=l.EventService.getInstance(),this.profileService=u.ProfileService.getInstance(),this.contactService=h.ContactService.getInstance(),this.countryService=f.CountryService.getInstance(),this.userInfoService=p.UserInfoService.getInstance(),this.errorHelperService=o.ErrorHelperService.getInstance(),this.favoriteService=d.FavoriteService.getInstance(),this.listeners=[],this.rxSubject=new r.Subject,this.personalDirectoryEnabled=false,this.deleteAllInProgress=false}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.personalDirectoryService||(e.rainbow.personalDirectoryService=new m),e.rainbow.personalDirectoryService}async start(){try{if(this.logger.info("[PersonalDirectoryService] === STARTING ==="),this.init(),this.personalDirectoryEnabled){this.attachXMPPListeners();const e=await this.getPersonalContacts();this.logger.debug("[PersonalDirectoryService] Nb Contact found = "+e.total)}else this.logger.warn("[PersonalDirectoryService] User does not have the profile feature PERSONAL_DIRECTORY");this.logger.info("[PersonalDirectoryService] === STARTED ===")}catch(e){this.logger.error("[PersonalDirectoryService] === STARTING FAILURE === "+e.message)}}async stop(){this.logger.info(""),this.logger.info("[PersonalDirectoryService] === STOPPING ==="),this.removeXMPPListeners(),this.logger.info("[PersonalDirectoryService] === STOPPED ===")}init(){this.directoryPortalURL=config.restServerUrl+"/api/rainbow/directory/v1.0",this.personalDirectoryEnabled=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.PERSONAL_DIRECTORY),this.logger.info("[PersonalDirectoryService] Personal Directory status from profileService: "+this.personalDirectoryEnabled)}attachXMPPListeners(){this.logger.info("[PersonalDirectoryService] attachXMPPListeners"),this.removeXMPPListeners()}removeXMPPListeners(){}subscribe(e){return this.rxSubject.subscribe(e)}async createPersonalContact(e){try{if(!this.personalDirectoryEnabled)throw Error("[PersonalDirectoryService] createPersonalContact -- User does not have the profile feature PERSONAL_DIRECTORY");e.companyId&&(e.companyId=void 0);const t=this.directoryPortalURL+"/entries?analyticsEntryType=personal",i=this.authService.getPostHeader(),r=await fetch(t,{method:"POST",headers:i,body:JSON.stringify(e)});if(!r.ok)throw r;const s=await r.json(),o=c.DirectoryContact.createFromData(s.data);this.logger.info(`[PersonalDirectoryService] createPersonalContact success from server for user ${o.userId} -- Id = ${o.id}`);const a=this.createContactFromPersonalDirectoryData(o);return this.rxSubject.next(n.RBEvent.create(g.PERSONAL_DIRECTORY_ADD,a)),a.rxSubject.next({name:"update"}),a}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"createPersonalContact");throw this.logger.error("[PersonalDirectoryService] createPersonalContact failure: "+e.message),e.error}}async deletePersonalContact(e){try{if(!this.personalDirectoryEnabled)throw Error("[PersonalDirectoryService] deletePersonalContact -- User does not have the profile feature PERSONAL_DIRECTORY");const t=`${this.directoryPortalURL}/entries/${e.id}`,i=this.authService.getPostHeader(),r=await fetch(t,{method:"DELETE",headers:i});if(!r.ok)throw r;return this.logger.info(`[PersonalDirectoryService] Delete of Personal Contact ${e.id} success from server for user ${e.userId}`),e.directoryObsolete=true,e.businessPhones=[],e.mobilePhones=[],e.otherPhoneNumbers=[],e.phoneProCan="",e.phonePro="",void this.rxSubject.next(n.RBEvent.create(g.PERSONAL_DIRECTORY_DELETE,e.id))}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"deletePersonalContact");throw this.logger.error("[PersonalDirectoryService] deletePersonalContact failure: "+e.message),e.error}}async deletePersonalContactById(e){try{if(!this.personalDirectoryEnabled)throw Error("[PersonalDirectoryService] deletePersonalContactById -- User does not have the profile feature PERSONAL_DIRECTORY");const t=`${this.directoryPortalURL}/entries/${e}`,i=this.authService.getPostHeader(),r=await fetch(t,{method:"DELETE",headers:i});if(!r.ok)throw r;this.logger.info(`[PersonalDirectoryService] Delete of Personal Contact of ${e} success from server`);const s=this.contactService.getContact(e);return s&&(s.directoryObsolete=true,s.businessPhones=[],s.mobilePhones=[],s.otherPhoneNumbers=[],s.phoneProCan="",s.phonePro=""),void(this.deleteAllInProgress||this.rxSubject.next(n.RBEvent.create(g.PERSONAL_DIRECTORY_DELETE,e)))}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"deletePersonalContactById");throw this.logger.error("[PersonalDirectoryService] deletePersonalContactById failure: "+e.message),e.error}}async deleteAllPersonalContacts(){try{const e=[];if(!this.personalDirectoryEnabled)throw Error("[PersonalDirectoryService] deleteAllPersonalContacts -- User does not have the profile feature PERSONAL_DIRECTORY");const t=await this.getPersonalContacts();return this.deleteAllInProgress=true,t.contacts.forEach((t=>{e.push(this.deletePersonalContactById(t.id))})),await Promise.all(e),this.deleteAllInProgress=false,this.logger.info("[PersonalDirectoryService] Delete of all Personal Contacts success from server"),void this.rxSubject.next(n.RBEvent.create(g.PERSONAL_DIRECTORY_DELETE_ALL))}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"deleteAllPersonalContacts");throw this.logger.error("[PersonalDirectoryService] deleteAllPersonalContacts failure: "+t.message),t.error}}async updatePersonalContactFromUserData(e){try{const t=`${this.directoryPortalURL}/entries/${e.id}`,i=this.authService.getPostHeader();if(!this.personalDirectoryEnabled)throw Error("[PersonalDirectoryService] updatePersonalContactFromUserData -- User does not have the profile feature PERSONAL_DIRECTORY");const r=this.createPersonalDirectoryDataFromContact(e),s=await fetch(t,{method:"PUT",headers:i,body:JSON.stringify(r)});if(!s.ok)throw s;const o=await s.json(),a=c.DirectoryContact.createFromData(o.data),l=this.updateContactFromPersonalDirectoryData(a);return this.logger.info(`[PersonalDirectoryService] Update Personal Contact ${e.id} success from server for user ${e.userId}`),this.rxSubject.next(n.RBEvent.create(g.PERSONAL_DIRECTORY_UPDATE,l)),l.rxSubject.next({name:"update"}),l}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"updatePersonalContactFromUserData");throw this.logger.error("[PersonalDirectoryService] updatePersonalContactFromUserData failure: "+e.message),e.error}}async updatePersonalContact(e){try{if(!this.personalDirectoryEnabled)throw Error("[PersonalDirectoryService] updatePersonalContact -- User does not have the profile feature PERSONAL_DIRECTORY");if(!e.id)throw new Error("Can not update  Personal Contact, missing Id");const t=`${this.directoryPortalURL}/entries/${e.id}`,i=this.authService.getPostHeader(),r=await fetch(t,{method:"PUT",headers:i,body:JSON.stringify(e)});if(!r.ok)throw r;const s=await r.json(),o=c.DirectoryContact.createFromData(s.data),a=this.updateContactFromPersonalDirectoryData(o);return this.logger.info(`[PersonalDirectoryService] Update Personal Contact ${e.id} success from server for user ${e.userId}`),this.rxSubject.next(n.RBEvent.create(g.PERSONAL_DIRECTORY_UPDATE,a)),this.favoriteService.searchAndUpdateFavoriteContact(a),a.rxSubject.next({name:"update"}),a}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"updatePersonalContact");throw this.logger.error("[PersonalDirectoryService] updatePersonalContact failure: "+e.message),e.error}}async getPersonalContacts(e="full"){try{if(!this.personalDirectoryEnabled)throw Error("[PersonalDirectoryService] getPersonalContacts -- User does not have the profile feature PERSONAL_DIRECTORY");const t="personal",i="all",r=1e3,n=`${this.directoryPortalURL}/entries?view=${t}&type=${i}&limit=${r}&format=${e}`,s=this.authService.getRequestHeader(),o=await fetch(n,{method:"GET",headers:s});if(!o.ok)throw o;const a=await o.json();this.logger.info(`[PersonalDirectoryService] getPersonalContacts success -- Found ${a.total} contact(s)`);const l=a.data,d=[];return l.forEach((e=>{const t=c.DirectoryContact.createFromData(e);this.createOrUpdateContact(t),d.push(t)})),{contacts:d,limit:a.limit,offset:a.offset,total:a.total}}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getPersonalContacts");throw this.logger.error("[PersonalDirectoryService] getPersonalContacts failure: "+e.message),e.error}}async getPersonalContactsByCriteria(e=null){try{const t={};if(!this.personalDirectoryEnabled)throw Error("[PersonalDirectoryService] getPersonalContactsByCriteria -- User does not have the profile feature PERSONAL_DIRECTORY");if(e){if(e.format&&"string"==typeof e.format&&e.format.length?t.format=e.format:t.format="full",e.limit&&(t.limit=e.limit),e.offset&&(t.offset=e.offset),e.searchPattern)switch(e.searchBy){case"phoneNumbers":t.phoneNumbers=encodeURIComponent(e.searchPattern);break;case"name":default:t.name=encodeURIComponent(e.searchPattern)}}else t.format="full";const i="personal",r=new URL(`${this.directoryPortalURL}/entries?view=${i}`),n=new URLSearchParams(t).toString();r.search=n;const s=this.authService.getRequestHeader(),o=await fetch(r.toString(),{method:"GET",headers:s});if(!o.ok)throw o;const a=await o.json();this.logger.info(`[PersonalDirectoryService] getPersonalContactsByCriteria success -- Found ${a.total} contact(s)`);const l=a.data,d=[];return l.forEach((e=>{const t=c.DirectoryContact.createFromData(e);this.createOrUpdateContact(t),d.push(t)})),{contacts:d,limit:a.limit,offset:a.offset,total:a.total}}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getPersonalContactsByCriteria");throw this.logger.error("[PersonalDirectoryService] getPersonalContactsByCriteria failure: "+e.message),e.error}}async getPersonalContactCardById(e,t="full"){try{if(!this.personalDirectoryEnabled)throw Error("[PersonalDirectoryService] getPersonalContactCardById -- User does not have the profile feature PERSONAL_DIRECTORY");const i=`${this.directoryPortalURL}/entries/${e}?format=${t}`,r=this.authService.getRequestHeader(),n=await fetch(i,{method:"GET",headers:r});if(!n.ok)throw n;const s=await n.json();this.logger.info(`[PersonalDirectoryService] getPersonalContactCardById for ${e} success from server`);const o=c.DirectoryContact.createFromData(s.data);return this.createOrUpdateContact(o),o}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"getPersonalContactCardById");throw this.logger.error("[PersonalDirectoryService] getPersonalContactCardById failure: "+e.message),e.error}}async getPersonalContactById(e,t="full"){try{if(!this.personalDirectoryEnabled)throw Error("[PersonalDirectoryService] getPersonalContactById -- User does not have the profile feature PERSONAL_DIRECTORY");const i=`${this.directoryPortalURL}/entries/${e}?format=${t}`,r=this.authService.getRequestHeader(),n=await fetch(i,{method:"GET",headers:r});if(!n.ok)throw n;const s=await n.json();this.logger.info(`[PersonalDirectoryService] getPersonalContactById for ${e} success from server`);const o=c.DirectoryContact.createFromData(s.data);return this.createOrUpdateContact(o)}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"getPersonalContactById");throw this.logger.error("[PersonalDirectoryService] failure: "+e.message),e.error}}async searchPersonalContacts(e){try{if(!this.personalDirectoryEnabled)return this.logger.debug("[PersonalDirectoryService] searchPersonalContacts -- User does not have the profile feature PERSONAL_DIRECTORY"),[];const t="personal",i="full",r=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.SEARCH_BY_TAGS)?"search":"name",n="all",s=`${this.directoryPortalURL}/entries?view=${t}&format=${i}&${r}=${encodeURIComponent(e)}&type=${n}`,o=this.authService.getRequestHeader(),a=await fetch(s,{method:"GET",headers:o});if(!a.ok)throw a;const l=await a.json(),d=l.data;this.logger.info(`[PersonalDirectoryService] search success -- Found ${l.total} contact(s)`);const u=d.map((e=>{const t=c.DirectoryContact.createFromData(e);return this.createOrUpdateContact(t)}));return this.logger.info(`[PersonalDirectoryService] searchPersonalContacts -- Return ${u.length} contact(s)`),u}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"search");return this.logger.error("[PersonalDirectoryService] "+e.message),[]}}getPersonalDirectoryContactFromNumber(e){if(!this.personalDirectoryEnabled)return null;const t=this.contactService.getDirectoryContactByPhoneNumber(e);return t&&t.personalDirectoryFlag?t.directoryObsolete?null:t:null}async getPersonalDirectoryTags(){try{if(!this.personalDirectoryEnabled)throw Error("[PersonalDirectoryService] getPersonalDirectoryTags -- User does not have the profile feature PERSONAL_DIRECTORY");const e=this.directoryPortalURL+"/entries/personal/tags",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=(await i.json()).data.tags||[];return this.logger.info(`[PersonalDirectoryService] Get personal directory tags success from server -- Found ${r.length} occurence(s)`),r}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getPersonalDirectoryTags");throw this.logger.error("[PersonalDirectoryService] getPersonalDirectoryTags failure: "+t.message),t.error}}async deletePersonalDirectoryTag(e){try{if(!this.personalDirectoryEnabled)throw Error("[PersonalDirectoryService] deletePersonalDirectoryTag -- User does not have the profile feature PERSONAL_DIRECTORY");const t=`${this.directoryPortalURL}/entries/personal/tags?tag=${encodeURIComponent(e)}`,i=this.authService.getPostHeader(),r=await fetch(t,{method:"DELETE",headers:i});if(!r.ok)throw r;const s=await r.json();return this.logger.info(`[PersonalDirectoryService] Deletion of tag "${e}" success -- Found ${s.data.found} occurence(s)`),void this.rxSubject.next(n.RBEvent.create(g.PERSONAL_DIRECTORY_TAG_DELETE,e))}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"deletePersonalDirectoryTag");throw this.logger.error("[PersonalDirectoryService] deletePersonalDirectoryTag failure: "+e.message),e.error}}async renamePersonalDirectoryTag(e,t){try{if(!this.personalDirectoryEnabled)throw Error("[PersonalDirectoryService] renamePersonalDirectoryTag -- User does not have the profile feature PERSONAL_DIRECTORY");const i=`${this.directoryPortalURL}/entries/personal/tags?tag=${encodeURIComponent(e)}`,r=this.authService.getPostHeader(),s=await fetch(i,{method:"PUT",headers:r,body:JSON.stringify({newTagName:t})});if(!s.ok)throw s;const o=await s.json();return this.logger.info(`[PersonalDirectoryService] Renaming of tag from "${e}" to "${t}" success -- Found ${o.data.found} occurence(s)`),void this.rxSubject.next(n.RBEvent.create(g.PERSONAL_DIRECTORY_TAG_RENAME,{oldTagName:e,newTagName:t}))}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"renamePersonalDirectoryTag");throw this.logger.error("[PersonalDirectoryService] renamePersonalDirectoryTag failure: "+e.message),e.error}}async getPersonalDirectoryTagsStats(){try{if(!this.personalDirectoryEnabled)throw Error("[PersonalDirectoryService] getPersonalDirectoryTagsStats -- User does not have the profile feature PERSONAL_DIRECTORY");const e=this.directoryPortalURL+"/entries/personal/tags/stats",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=(await i.json()).data.stats||[];return this.logger.info(`[PersonalDirectoryService] getPersonalDirectoryTagsStats success -- Found ${r.length} tags(s)`),r}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getPersonalDirectoryTagsStats");throw this.logger.error("[PersonalDirectoryService] getPersonalDirectoryTagsStats failure: "+t.message),t.error}}createContactFromPersonalDirectoryData(e){const t=this.contactService.createDirectoryContact(e.id,true);return t?(t.companyDirectoryFlag=false,t.personalDirectoryFlag=true,t.userId=e.userId,t.email=e.eMail,t.jobTitle=e.jobTitle,t.department=e.department,t.companyName=e.companyName,t.updateName(e.firstName,e.lastName),t.street=e.street,t.city=e.city,t.postalCode=e.postalCode,t.country=e.country,t.state=e.state,t.businessPhones=e.workPhoneNumbers,t.mobilePhones=e.mobilePhoneNumbers,t.otherPhoneNumbers=e.otherPhoneNumbers,t.note1=e.custom1,t.note2=e.custom2,t.tags=e.tags?e.tags:[],t):(this.logger.error("[PersonalDirectoryService] createContactFromPersonalDirectoryData -- Contact creation failed for "+e.id),null)}updateContactFromPersonalDirectoryData(e){const t=this.contactService.getContact(e.id);return t?(t.companyDirectoryFlag=false,t.personalDirectoryFlag=true,t.userId=e.userId,t.email=e.eMail,t.jobTitle=e.jobTitle,t.department=e.department,t.companyName=e.companyName,t.updateName(e.firstName,e.lastName),t.street=e.street,t.city=e.city,t.postalCode=e.postalCode,t.country=e.country,t.state=e.state,t.businessPhones=e.workPhoneNumbers,t.mobilePhones=e.mobilePhoneNumbers,t.otherPhoneNumbers=e.otherPhoneNumbers,t.note1=e.custom1,t.note2=e.custom2,t.tags=e.tags?e.tags:[],t):(this.logger.error(`[PersonalDirectoryService] updateContactFromData -- Unable to find contact for ${e.id} for update`),null)}createOrUpdateContact(e){if(this.contactService.getContact(e.id)){return this.updateContactFromPersonalDirectoryData(e)}return this.createContactFromPersonalDirectoryData(e)}createPersonalDirectoryDataFromContact(e){const t=new c.DirectoryContact("personal");return t.firstName=e.firstname,t.lastName=e.lastname,t.eMail=e.email,t.jobTitle=e.jobTitle,t.department=e.department,t.companyName=e.companyName,t.street=e.street,t.city=e.city,t.postalCode=e.postalCode,t.country=e.country,t.state=this.countryService.getStateCodeFromName(e.country,e.state),t.workPhoneNumbers=e.businessPhones,t.mobilePhoneNumbers=e.mobilePhones,t.otherPhoneNumbers=e.otherPhoneNumbers,t.custom1=e.note1,t.custom2=e.note2,t.tags=e.tags,t}}t.PersonalDirectoryService=m},function(e,t,i){var r,n,s,o,a;
/*! Moment Duration Format v2.2.2
     *  https://github.com/jsmreese/moment-duration-format
     *  Date: 2018-02-16
     *
     *  Duration format plugin function for the Moment.js library
     *  http://momentjs.com/
     *
     *  Copyright 2018 John Madhavan-Reese
     *  Released under the MIT license
     */o=this,a=function(e){var t=false,i=false,r=false,n=false,s="escape years months weeks days hours minutes seconds milliseconds general".split(" "),o=[{type:"seconds",targets:[{type:"minutes",value:60},{type:"hours",value:3600},{type:"days",value:86400},{type:"weeks",value:604800},{type:"months",value:2678400},{type:"years",value:31536e3}]},{type:"minutes",targets:[{type:"hours",value:60},{type:"days",value:1440},{type:"weeks",value:10080},{type:"months",value:44640},{type:"years",value:525600}]},{type:"hours",targets:[{type:"days",value:24},{type:"weeks",value:168},{type:"months",value:744},{type:"years",value:8760}]},{type:"days",targets:[{type:"weeks",value:7},{type:"months",value:31},{type:"years",value:365}]},{type:"months",targets:[{type:"years",value:12}]}];function a(e,t){return!(t.length>e.length)&&-1!==e.indexOf(t)}function c(e){for(var t="";e;)t+="0",e-=1;return t}function l(e,t){var i=e+"+"+S(I(t).sort(),(function(e){return e+":"+t[e]})).join(",");return l.cache[i]||(l.cache[i]=Intl.NumberFormat(e,t)),l.cache[i]}function d(e,t,s){var o,a,u,h=t.useToLocaleString,f=t.useGrouping,p=f&&t.grouping.slice(),g=t.maximumSignificantDigits,m=t.minimumIntegerDigits||1,v=t.fractionDigits||0,S=t.groupingSeparator,b=t.decimalSeparator;if(h&&s){var y,C={minimumIntegerDigits:m,useGrouping:f};return v&&(C.maximumFractionDigits=v,C.minimumFractionDigits=v),g&&e>0&&(C.maximumSignificantDigits=g),r?(n||((y=T({},t)).useGrouping=false,y.decimalSeparator=".",e=parseFloat(d(e,y),10)),l(s,C).format(e)):(i||((y=T({},t)).useGrouping=false,y.decimalSeparator=".",e=parseFloat(d(e,y),10)),e.toLocaleString(s,C))}var w=(g?e.toPrecision(g+1):e.toFixed(v+1)).split("e");u=w[1]||"",a=(w=w[0].split("."))[1]||"";var _=(o=w[0]||"").length,E=a.length,I=_+E,P=o+a;(g&&I===g+1||!g&&E===v+1)&&((P=function(e){for(var t=e.split("").reverse(),i=0,r=true;r&&i<t.length;)i?"9"===t[i]?t[i]="0":(t[i]=(parseInt(t[i],10)+1).toString(),r=false):(parseInt(t[i],10)<5&&(r=false),t[i]="0"),i+=1;return r&&t.push("1"),t.reverse().join("")}(P)).length===I+1&&(_+=1),E&&(P=P.slice(0,-1)),o=P.slice(0,_),a=P.slice(_)),g&&(a=a.replace(/0*$/,""));var A=parseInt(u,10);A>0?a.length<=A?(o+=a+=c(A-a.length),a=""):(o+=a.slice(0,A),a=a.slice(A)):A<0&&(a=c(Math.abs(A)-o.length)+o+a,o="0"),g||((a=a.slice(0,v)).length<v&&(a+=c(v-a.length)),o.length<m&&(o=c(m-o.length)+o));var M,D="";if(f)for(w=o;w.length;)p.length&&(M=p.shift()),D&&(D=S+D),D=w.slice(-M)+D,w=w.slice(0,-M);else D=o;return a&&(D=D+b+a),D}function u(e,t){return e.label.length>t.label.length?-1:e.label.length<t.label.length?1:0}function h(e,t){var i=[];return v(I(t),(function(r){if("_durationLabels"===r.slice(0,15)){var n=r.slice(15).toLowerCase();v(I(t[r]),(function(s){s.slice(0,1)===e&&i.push({type:n,key:s,label:t[r][s]})}))}})),i}l.cache={};var f={durationLabelsStandard:{S:"millisecond",SS:"milliseconds",s:"second",ss:"seconds",m:"minute",mm:"minutes",h:"hour",hh:"hours",d:"day",dd:"days",w:"week",ww:"weeks",M:"month",MM:"months",y:"year",yy:"years"},durationLabelsShort:{S:"msec",SS:"msecs",s:"sec",ss:"secs",m:"min",mm:"mins",h:"hr",hh:"hrs",d:"dy",dd:"dys",w:"wk",ww:"wks",M:"mo",MM:"mos",y:"yr",yy:"yrs"},durationTimeTemplates:{HMS:"h:mm:ss",HM:"h:mm",MS:"m:ss"},durationLabelTypes:[{type:"standard",string:"__"},{type:"short",string:"_"}],durationPluralKey:function(e,t,i){return 1===t&&null===i?e:e+e}};function p(e){return"[object Array]"===Object.prototype.toString.call(e)}function g(e){return"[object Object]"===Object.prototype.toString.call(e)}function m(e,t){var i,r=0,n=e&&e.length||0;for("function"!=typeof t&&(i=t,t=function(e){return e===i});r<n;){if(t(e[r]))return e[r];r+=1}}function v(e,t){var i=0,r=e.length;if(e&&r)for(;i<r;){if(false===t(e[i],i))return;i+=1}}function S(e,t){var i=0,r=e.length,n=[];if(!e||!r)return n;for(;i<r;)n[i]=t(e[i],i),i+=1;return n}function b(e,t){return S(e,(function(e){return e[t]}))}function y(e){var t=[];return v(e,(function(e){e&&t.push(e)})),t}function C(e){var t=[];return v(e,(function(e){m(t,e)||t.push(e)})),t}function w(e,t){var i=[];return v(e,(function(e){v(t,(function(t){e===t&&i.push(e)}))})),C(i)}function _(e,t){var i=[];return v(e,(function(r,n){if(!t(r))return i=e.slice(n),false})),i}function E(e,t){return _(e.slice().reverse(),t).reverse()}function T(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function I(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(i);return t}function P(e,t){var i=0,r=e.length;if(!e||!r)return false;for(;i<r;){if(true===t(e[i],i))return true;i+=1}return false}function A(e){var t=[];return v(e,(function(e){t=t.concat(e)})),t}function M(e){return"3.6"===e(3.55,"en",{useGrouping:false,minimumIntegerDigits:1,minimumFractionDigits:1,maximumFractionDigits:1})}function D(e){var t=true;return!!((t=(t=(t=t&&"1"===e(1,"en",{minimumIntegerDigits:1}))&&"01"===e(1,"en",{minimumIntegerDigits:2}))&&"001"===e(1,"en",{minimumIntegerDigits:3}))&&(t=(t=(t=(t=t&&"100"===e(99.99,"en",{maximumFractionDigits:0,minimumFractionDigits:0}))&&"100.0"===e(99.99,"en",{maximumFractionDigits:1,minimumFractionDigits:1}))&&"99.99"===e(99.99,"en",{maximumFractionDigits:2,minimumFractionDigits:2}))&&"99.990"===e(99.99,"en",{maximumFractionDigits:3,minimumFractionDigits:3}))&&(t=(t=(t=(t=(t=t&&"100"===e(99.99,"en",{maximumSignificantDigits:1}))&&"100"===e(99.99,"en",{maximumSignificantDigits:2}))&&"100"===e(99.99,"en",{maximumSignificantDigits:3}))&&"99.99"===e(99.99,"en",{maximumSignificantDigits:4}))&&"99.99"===e(99.99,"en",{maximumSignificantDigits:5}))&&(t=(t=t&&"1,000"===e(1e3,"en",{useGrouping:true}))&&"1000"===e(1e3,"en",{useGrouping:false})))}function R(){var e,t=[].slice.call(arguments),i={};if(v(t,(function(t,r){if(!r){if(!p(t))throw"Expected array as the first argument to durationsFormat.";e=t}"string"!=typeof t&&"function"!=typeof t?"number"!=typeof t?g(t)&&T(i,t):i.precision=t:i.template=t})),!e||!e.length)return[];i.returnMomentTypes=true;var r=S(e,(function(e){return e.format(i)})),n=w(s,C(b(A(r),"type"))),o=i.largest;return o&&(n=n.slice(0,o)),i.returnMomentTypes=false,i.outputTypes=n,S(e,(function(e){return e.format(i)}))}function O(){var i=[].slice.call(arguments),n=T({},this.format.defaults),c=this.asMilliseconds(),l=this.asMonths();"function"==typeof this.isValid&&false===this.isValid()&&(c=0,l=0);var A=c<0,M=e.duration(Math.abs(c),"milliseconds"),D=e.duration(Math.abs(l),"months");v(i,(function(e){"string"!=typeof e&&"function"!=typeof e?"number"!=typeof e?g(e)&&T(n,e):n.precision=e:n.template=e}));var R={years:"y",months:"M",weeks:"w",days:"d",hours:"h",minutes:"m",seconds:"s",milliseconds:"S"},O={escape:/\[(.+?)\]/,years:/\*?[Yy]+/,months:/\*?M+/,weeks:/\*?[Ww]+/,days:/\*?[Dd]+/,hours:/\*?[Hh]+/,minutes:/\*?m+/,seconds:/\*?s+/,milliseconds:/\*?S+/,general:/.+?/};n.types=s;var N=function(e){return m(s,(function(t){return O[t].test(e)}))},x=new RegExp(S(s,(function(e){return O[e].source})).join("|"),"g");n.duration=this;var L="function"==typeof n.template?n.template.apply(n):n.template,k=n.outputTypes,F=n.returnMomentTypes,U=n.largest,j=[];k||(p(n.stopTrim)&&(n.stopTrim=n.stopTrim.join("")),n.stopTrim&&v(n.stopTrim.match(x),(function(e){var t=N(e);"escape"!==t&&"general"!==t&&j.push(t)})));var W=e.localeData();W||(W={}),v(I(f),(function(e){"function"!=typeof f[e]?W["_"+e]||(W["_"+e]=f[e]):W[e]||(W[e]=f[e])})),v(I(W._durationTimeTemplates),(function(e){L=L.replace("_"+e+"_",W._durationTimeTemplates[e])}));var B=n.userLocale||e.locale(),H=n.useLeftUnits,V=n.usePlural,Y=n.precision,G=n.forceLength,$=n.useGrouping,z=n.trunc,J=n.useSignificantDigits&&Y>0,q=J?n.precision:0,K=q,X=n.minValue,Q=false,Z=n.maxValue,ee=false,te=n.useToLocaleString,ie=n.groupingSeparator,re=n.decimalSeparator,ne=n.grouping;te=te&&(t||r);var se=n.trim;p(se)&&(se=se.join(" ")),null===se&&(U||Z||J)&&(se="all"),null!==se&&true!==se&&"left"!==se&&"right"!==se||(se="large"),false===se&&(se="");var oe=function(e){return e.test(se)},ae=/large/,ce=/small/,le=/both/,de=/mid/,ue=/^all|[^sm]all/,he=/final/,fe=U>0||P([ae,le,ue],oe),pe=P([ce,le,ue],oe),ge=P([de,ue],oe),me=P([he,ue],oe),ve=S(L.match(x),(function(e,t){var i=N(e);return"*"===e.slice(0,1)&&(e=e.slice(1),"escape"!==i&&"general"!==i&&j.push(i)),{index:t,length:e.length,text:"",token:"escape"===i?e.replace(O.escape,"$1"):e,type:"escape"===i||"general"===i?null:i}})),Se={index:0,length:0,token:"",text:"",type:null},be=[];H&&ve.reverse(),v(ve,(function(e){if(e.type)return(Se.type||Se.text)&&be.push(Se),void(Se=e);H?Se.text=e.token+Se.text:Se.text+=e.token})),(Se.type||Se.text)&&be.push(Se),H&&be.reverse();var ye=w(s,C(y(b(be,"type"))));if(!ye.length)return b(be,"text").join("");ye=S(ye,(function(e,t){var i,r=t+1===ye.length,s=!t;i="years"===e||"months"===e?D.as(e):M.as(e);var o=Math.floor(i),a=i-o,c=m(be,(function(t){return e===t.type}));return s&&Z&&i>Z&&(ee=true),r&&X&&Math.abs(n.duration.as(e))<X&&(Q=true),s&&null===G&&c.length>1&&(G=true),M.subtract(o,e),D.subtract(o,e),{rawValue:i,wholeValue:o,decimalValue:r?a:0,isSmallest:r,isLargest:s,type:e,tokenLength:c.length}}));var Ce=z?Math.floor:Math.round,we=function(e,t){var i=Math.pow(10,t);return Ce(e*i)/i},_e=false,Ee=false,Te=function(e,t){var i={useGrouping:$,groupingSeparator:ie,decimalSeparator:re,grouping:ne,useToLocaleString:te};return J&&(q<=0?(e.rawValue=0,e.wholeValue=0,e.decimalValue=0):(i.maximumSignificantDigits=q,e.significantDigits=q)),ee&&!Ee&&(e.isLargest?(e.wholeValue=Z,e.decimalValue=0):(e.wholeValue=0,e.decimalValue=0)),Q&&!Ee&&(e.isSmallest?(e.wholeValue=X,e.decimalValue=0):(e.wholeValue=0,e.decimalValue=0)),e.isSmallest||e.significantDigits&&e.significantDigits-e.wholeValue.toString().length<=0?Y<0?e.value=we(e.wholeValue,Y):0===Y?e.value=Ce(e.wholeValue+e.decimalValue):J?(e.value=z?we(e.rawValue,q-e.wholeValue.toString().length):e.rawValue,e.wholeValue&&(q-=e.wholeValue.toString().length)):(i.fractionDigits=Y,e.value=z?e.wholeValue+we(e.decimalValue,Y):e.wholeValue+e.decimalValue):J&&e.wholeValue?(e.value=Math.round(we(e.wholeValue,e.significantDigits-e.wholeValue.toString().length)),q-=e.wholeValue.toString().length):e.value=e.wholeValue,e.tokenLength>1&&(G||_e)&&(i.minimumIntegerDigits=e.tokenLength,Ee&&i.maximumSignificantDigits<e.tokenLength&&delete i.maximumSignificantDigits),!_e&&(e.value>0||""===se||m(j,e.type)||m(k,e.type))&&(_e=true),e.formattedValue=d(e.value,i,B),i.useGrouping=false,i.decimalSeparator=".",e.formattedValueEn=d(e.value,i,"en"),2===e.tokenLength&&"milliseconds"===e.type&&(e.formattedValueMS=d(e.value,{minimumIntegerDigits:3,useGrouping:false},"en").slice(0,2)),e};if((ye=y(ye=S(ye,Te))).length>1){var Ie=function(e){return m(ye,(function(t){return t.type===e}))},Pe=function(e){var t=Ie(e.type);t&&v(e.targets,(function(e){var i=Ie(e.type);i&&parseInt(t.formattedValueEn,10)===e.value&&(t.rawValue=0,t.wholeValue=0,t.decimalValue=0,i.rawValue+=1,i.wholeValue+=1,i.decimalValue=0,i.formattedValueEn=i.wholeValue.toString(),Ee=true)}))};v(o,Pe)}return Ee&&(_e=false,q=K,ye=y(ye=S(ye,Te))),!k||ee&&!n.trim?(fe&&(ye=_(ye,(function(e){return!e.isSmallest&&!e.wholeValue&&!m(j,e.type)}))),U&&ye.length&&(ye=ye.slice(0,U)),pe&&ye.length>1&&(ye=E(ye,(function(e){return!e.wholeValue&&!m(j,e.type)&&!e.isLargest}))),ge&&(ye=y(ye=S(ye,(function(e,t){return t>0&&t<ye.length-1&&!e.wholeValue?null:e})))),!me||1!==ye.length||ye[0].wholeValue||!z&&ye[0].isSmallest&&ye[0].rawValue<X||(ye=[])):ye=y(ye=S(ye,(function(e){return m(k,(function(t){return e.type===t}))?e:null}))),F?ye:(v(be,(function(e){var t=R[e.type],i=m(ye,(function(t){return t.type===e.type}));if(t&&i){var r=i.formattedValueEn.split(".");r[0]=parseInt(r[0],10),r[1]?r[1]=parseFloat("0."+r[1],10):r[1]=null;var n=W.durationPluralKey(t,r[0],r[1]),s=h(t,W),o=false,c={};v(W._durationLabelTypes,(function(t){var i=m(s,(function(e){return e.type===t.type&&e.key===n}));i&&(c[i.type]=i.label,a(e.text,t.string)&&(e.text=e.text.replace(t.string,i.label),o=true))})),V&&!o&&(s.sort(u),v(s,(function(t){return c[t.type]===t.label?!a(e.text,t.label)&&void 0:a(e.text,t.label)?(e.text=e.text.replace(t.label,c[t.type]),false):void 0})))}})),(be=S(be,(function(e){if(!e.type)return e.text;var t=m(ye,(function(t){return t.type===e.type}));if(!t)return"";var i="";return H&&(i+=e.text),(A&&ee||!A&&Q)&&(i+="< ",ee=false,Q=false),(A&&Q||!A&&ee)&&(i+="> ",ee=false,Q=false),A&&(t.value>0||""===se||m(j,t.type)||m(k,t.type))&&(i+="-",A=false),"milliseconds"===e.type&&t.formattedValueMS?i+=t.formattedValueMS:i+=t.formattedValue,H||(i+=e.text),i}))).join("").replace(/(,| |:|\.)*$/,"").replace(/^(,| |:|\.)*/,""))}function N(){var e=this.duration,t=function(t){return e._data[t]},i=m(this.types,t),r=function(e,t){for(var i=e.length;i-=1;)if(t(e[i]))return e[i]}(this.types,t);switch(i){case"milliseconds":return"S __";case"seconds":case"minutes":return"*_MS_";case"hours":return"_HMS_";case"days":if(i===r)return"d __";case"weeks":return i===r?"w __":(null===this.trim&&(this.trim="both"),"w __, d __, h __");case"months":if(i===r)return"M __";case"years":return i===r?"y __":(null===this.trim&&(this.trim="both"),"y __, M __, d __");default:return null===this.trim&&(this.trim="both"),"y __, d __, h __, m __, s __"}}function x(e){if(!e)throw"Moment Duration Format init cannot find moment instance.";e.duration.format=R,e.duration.fn.format=O,e.duration.fn.format.defaults={trim:null,stopTrim:null,largest:null,maxValue:null,minValue:null,precision:0,trunc:false,forceLength:null,userLocale:null,usePlural:true,useLeftUnits:false,useGrouping:true,useSignificantDigits:false,template:N,useToLocaleString:true,groupingSeparator:",",decimalSeparator:".",grouping:[3]},e.updateLocale("en",f)}var L=function(e,t,i){return e.toLocaleString(t,i)};t=function(){try{(0).toLocaleString("i")}catch(e){return"RangeError"===e.name}return false}()&&D(L),i=t&&M(L);var k=function(e,t,i){if("undefined"!=typeof window&&window&&window.Intl&&window.Intl.NumberFormat)return window.Intl.NumberFormat(t,i).format(e)};return r=D(k),n=r&&M(k),x(e),x},n=[i(1)],void 0===(s="function"==typeof(r=a)?r.apply(t,n):r)||(e.exports=s),o&&(o.momentDurationFormatSetup=o.moment?a(o.moment):a)},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(4),n=i(8),s=i(14),o=i(6);class a{constructor(){this.logger=r.LoggerService.getInstance(),this.authService=n.AuthService.getInstance(),this.profileService=s.ProfileService.getInstance(),this.contactService=o.ContactService.getInstance()}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.office365AdService||(e.rainbow.office365AdService=new a),e.rainbow.office365AdService}async search(e){if(!this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.MSO365_DIRECTORY_SEARCH))return[];this.logger.info("search office365 Contact from Ad with pattern "+e);const t=config.restServerUrl+"/api/rainbow/office365/v1.0/users";try{const i=this.authService.getPostHeader();let r;r=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.SEARCH_BY_TAGS)?await fetch(t+"/search",{method:"POST",mode:"cors",headers:i,body:JSON.stringify({search:e,includeContacts:true})}):await fetch(t+"/search",{method:"POST",mode:"cors",headers:i,body:JSON.stringify({name:e,includeContacts:true})});const n=(await r.json()).data;return n.map((e=>{const t=this.contactService.createDirectoryContact(e.oid,false);return this.updateContactWithData(t,e),t}))}catch(i){return this.logger.error(`search office365 Contact from Ad with pattern ${e} --- FAILURE --- ${i.message}`),[]}}async getUserDetails(e){if(this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.MSO365_DIRECTORY_SEARCH)&&e.o365Flag){this.logger.info("getUserDetails for "+e.oid);try{const t=this.authService.getRequestHeader(),i=`${config.restServerUrl}/api/rainbow/office365/v1.0/users/details/${encodeURIComponent(e.id)}?picture=true`,r=await fetch(i,{method:"GET",mode:"cors",headers:t});if(!r.ok)throw this.logger.debug(`Request ${r.headers.get("x-rainbow-request-id")} failed with status ${r.status}`),new Error(r.statusText);const n=await r.json();this.updateContactWithOffice365Data(e,n)}catch(t){this.logger.error("getUserDetails -- FAILURE -- "+t.message)}}}async getO365ContactFromServer(e){if(this.logger.info("[Office365AdService] getO365ContactFromServer for "+e),!this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.MSO365_DIRECTORY_SEARCH))return this.logger.info("[Office365AdService] getO365ContactFromServer -- User does not have the profile feature MSO365_DIRECTORY_SEARCH"),null;try{const t=this.authService.getRequestHeader(),i=`${config.restServerUrl}/api/rainbow/office365/v1.0/users/details/${encodeURIComponent(e)}`,r=await fetch(i,{method:"GET",mode:"cors",headers:t});if(!r.ok)throw this.logger.error(`[Office365AdService] Request ${r.headers.get("x-rainbow-request-id")} failed -- status ${r.status} - statusText ${r.statusText}`),new Error(r.statusText);const n=await r.json(),s=this.contactService.createDirectoryContact(n.oid,false);return s?(this.updateContactWithOffice365Details(s,n),s):(this.logger.error("[Office365AdService] getO365ContactFromServer -- Contact creation failed for "+n.oid),null)}catch(t){return this.logger.error("[Office365AdService] getO365ContactFromServer -- FAILURE -- "+t.message),null}}async getO365DirectoryContactById(e){const t=await this.getO365ContactFromServer(e);return t?this.logger.info(`[Office365AdService] getO365DirectoryContactById Success -- Contact ${e} retrieved from server and created in cache`):this.logger.error(`[Office365AdService] getO365DirectoryContactById Failure -- Contact ${e} unknown from server or problem when retrieving it`),t}updateContactWithData(e,t){e.o365Flag=true,e.updateName(t.firstName,t.lastName),e.companyName=this.contactService.userContact.company.name,e.jobTitle=t.jobTitle,e.department=t.department,e.webAddress=t.mySite,e.mobilePhones=t.mobilePhonesE164,e.businessPhones=t.businessPhonesE164,e.email=t.mail,e.isContact=t.isContact}updateContactWithOffice365Data(e,t){if(e.o365Flag=true,e.updateName(t.givenName,t.surname),e.companyName=this.contactService.userContact.company.name,e.jobTitle=t.jobTitle,e.department=t.department,e.webAddress=t.mySite,e.email=t.mail,e.isContact?(e.street=t.addresses[0]&&t.addresses[0].street?t.addresses[0].street:"",e.city=t.addresses[0]&&t.addresses[0].city?t.addresses[0].city:"",e.country=t.addresses[0]&&t.addresses[0].countryOrRegion?t.addresses[0].countryOrRegion:"",e.postCode=t.addresses[0]&&t.addresses[0].postalCode?t.addresses[0].postalCode:"",e.state=t.addresses[0]&&t.addresses[0].state?t.addresses[0].state:""):(e.street=t.streetAddress,e.city=t.city,e.country=t.country,e.postCode=t.postalCode,e.state=t.state),e.businessPhones=t.businessPhones,e.mobilePhones=[],t.mobilePhone&&""!==t.mobilePhone&&e.mobilePhones.push(t.mobilePhone),t.picture){let i=null;t.picture.startsWith("/9j")?i="data:image/jpeg;base64,":t.picture.startsWith("iVB")&&(i="data:image/png;base64,"),i&&(e.avatar=new Image,e.avatar.src=i+t.picture)}}updateContactWithOffice365Details(e,t){if(e.o365Flag=true,e.updateName(t.givenName,t.surname),e.companyName=this.contactService.userContact.company.name,e.jobTitle=t.jobTitle,e.department=t.department,e.email=t.mail,t.isContact?(e.street=t.addresses[0]&&t.addresses[0].street?t.addresses[0].street:"",e.city=t.addresses[0]&&t.addresses[0].city?t.addresses[0].city:"",e.country=t.addresses[0]&&t.addresses[0].countryOrRegion?t.addresses[0].countryOrRegion:"",e.postalCode=t.addresses[0]&&t.addresses[0].postalCode?t.addresses[0].postalCode:"",e.state=t.addresses[0]&&t.addresses[0].state?t.addresses[0].state:""):(e.street=t.streetAddress,e.city=t.city,e.country=t.country,e.postalCode=t.postalCode,e.state=t.state),e.businessPhones=t.businessPhones,e.mobilePhones=[],t.mobilePhone&&""!==t.mobilePhone&&e.mobilePhones.push(t.mobilePhone),t.picture){let i=null;t.picture.startsWith("/9j")?i="data:image/jpeg;base64,":t.picture.startsWith("iVB")&&(i="data:image/png;base64,"),i&&(e.avatar=new Image,e.avatar.src=i+t.picture)}}}t.Office365AdService=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(19),n=i(8),s=i(9),o=i(6),a=i(4),c=i(13),l=i(11),d=i(316),u=i(7);class h{constructor(){this.logger=a.LoggerService.getInstance(),this.authService=n.AuthService.getInstance(),this.xmppService=s.XmppService.getInstance(),this.contactService=o.ContactService.getInstance(),this.settingsService=r.SettingsService.getInstance(),this.errorHelperService=c.ErrorHelperService.getInstance(),this.eventService=l.EventService.getInstance(),this.subscription=null,this.xmppHandler=null,this.rxSubject=new u.Subject,this.portalURL=null,this.receivedInvitations={},this.sentInvitations={},this.acceptedInvitationsArray=[],this.sentInvitationsArray=[],this.receivedInvitationsArray=[],this.innerTimeout=null}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.invitationService||(e.rainbow.invitationService=new h),e.rainbow.invitationService}async start(){this.logger.info(""),this.logger.info("[invitationService] === STARTING ==="),this.portalURL=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/",this.attachHandlers(),this.getAllSentInvitations(),this.getAllReceivedInvitations(),this.logger.info("[invitationService] === STARTED ==="),this.subscription=this.xmppService.subscribeToContactEvents((e=>{"ON_ROSTER_CHANGED_EVENT"===e.name&&(this.innerTimeout||(this.innerTimeout=setTimeout((()=>{this.getAllSentInvitations(),this.innerTimeout=null}),1e3)))}))}async stop(){this.logger.info(""),this.logger.info("[invitationService] === STOPPING ==="),this.subscription&&this.subscription.unsubscribe(),this.logger.info("[invitationService] === STOPPED ===")}reconnect(){this.attachHandlers()}subscribe(e){return this.rxSubject.subscribe(e)}sendEvent(e,t=null){this.rxSubject.next({type:e,value:t}),this.eventService.publish(e,t)}attachHandlers(){this.logger.info("[invitationService] attachHandlers"),this.xmppHandler&&(this.xmppService.connection.deleteHandler(this.xmppHandler),this.xmppHandler=null),this.xmppHandler=this.xmppService.connection.addHandler((e=>this.onInvitationsUpdate(e)),null,"message","management")}onInvitationsUpdate(e){const t=$(e).find("userinvite");if(t.length){const e=t.attr("id"),i=t.attr("type"),r=t.attr("action");switch(i){case"received":this.handleReceivedInvitation(e,r);break;case"sent":this.handleSentInvitation(e,r);break;default:this.logger.warn("[invitationService] onInvitationsUpdate - received unexpected type - "+i)}}return true}async handleReceivedInvitation(e,t){if(this.logger.info("[invitationService] handleReceivedInvitation"),"delete"===t)return delete this.receivedInvitations[e],void this.updateReceivedInvitationsArray();const i=await this.getServerInvitation(e);let r=null,n="none";switch(i.status){case"pending":if(this.receivedInvitations[i.id]=i,r=i,n="ask",i.invitingUserId){const e=await this.contactService.getContactByDBId(i.invitingUserId,true);this.sendEvent("ON_INVITATION_RECEIVED",e)}break;case"accepted":case"auto-accepted":if(this.receivedInvitations[i.id]=i,this.sendEvent("ON_INVITATION_ACCEPTED",i.invitingUserId),i.invitingUserId){const e=await this.contactService.getContactByDBId(i.invitingUserId,true);this.eventService.publish("ON_CONTACT_UPDATED_EVENT",e)}break;default:delete this.receivedInvitations[i.id],n="unknown"}i.invitingUserId&&await this.updateContactInvitationStatus(i.invitingUserId,n,r),this.updateReceivedInvitationsArray(),this.sendEvent("ON_INVITATION_CHANGED",i)}async handleSentInvitation(e,t){if(this.logger.info("[invitationService] handleSentInvitation"),"delete"===t)return delete this.sentInvitations[e],void this.updateReceivedInvitationsArray();const i=await this.getServerInvitation(e);let r=null;switch(i.status){case"pending":this.sentInvitations[i.id]=i,r="wait";break;case"accepted":case"auto-accepted":if(this.sendEvent("ON_INVITATION_ACCEPTED",i.invitedUserId),i.invitedUserId){const e=await this.contactService.getContactByDBId(i.invitedUserId,true);this.eventService.publish("ON_CONTACT_UPDATED_EVENT",e)}break;default:delete this.sentInvitations[i.id],r="unknown"}i.invitedUserId&&await this.updateContactInvitationStatus(i.invitedUserId,r,i),this.updateSentInvitationsArray(),"resend"===t&&this.sendEvent("ON_INVITATIONS_RE_SEND",e)}updateReceivedInvitationsArray(){this.receivedInvitationsArray=[],this.acceptedInvitationsArray=[];for(const e in this.receivedInvitations)if(this.receivedInvitations.hasOwnProperty(e)){const t=this.receivedInvitations[e];switch(t.status){case"pending":this.receivedInvitationsArray.push(t);break;case"accepted":case"auto-accepted":this.acceptedInvitationsArray.push(t)}}this.receivedInvitationsArray.sort(this.sortInvitationArray),this.acceptedInvitationsArray=this.acceptedInvitationsArray.filter((function(e){const t=moment(e.lastNotificationDate);return moment.duration(moment().diff(t)).asHours()<168})),this.acceptedInvitationsArray.sort(this.sortInvitationArray),this.sendEvent("ON_INVITATIONS_NUMBER_UPDATED")}updateSentInvitationsArray(){this.sentInvitationsArray=[];for(const e in this.sentInvitations)this.sentInvitations.hasOwnProperty(e)&&this.sentInvitationsArray.push(this.sentInvitations[e]);this.sentInvitationsArray.sort(this.sortInvitationArray),this.sendEvent("ON_INVITATIONS_NUMBER_UPDATED")}async getServerInvitation(e){try{const t=`${this.portalURL}${this.contactService.userContact.dbId}/invitations/${e}`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;const n=(await r.json()).data;return this.logger.info("[invitationService] getServerInvitation success"),d.Invitation.createFromData(n)}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getServerInvitation");throw this.logger.error("[invitationService] "+e.message),e.error}}getReceivedInvitations(){return this.receivedInvitationsArray}getAcceptedInvitations(){return this.acceptedInvitationsArray}getSentInvitations(){return this.sentInvitationsArray}getInvitationsNumberForCounter(){return this.receivedInvitationsArray.length}getAllInvitationsNumber(){return this.receivedInvitationsArray.length+this.sentInvitationsArray.length+this.acceptedInvitationsArray.length}getInvitation(e){let t=this.receivedInvitations[e];return t||(t=this.acceptedInvitationsArray[e]),t||(t=this.sentInvitations[e]),t}async joinContactInvitation(e,t=""){try{this.logger.info(`[invitationService] joinContactInvitation contact (${e.jid})`);const i=`${this.portalURL}${this.contactService.userContact.dbId}/invitations`,r=this.authService.getPostHeader(),n={invitedUserId:e.dbId,customMessage:t},s=await fetch(i,{method:"POST",headers:r,body:JSON.stringify(n)});if(!s.ok)throw s;this.logger.info(`[invitationService] joinContactInvitation - success (${e.jid})`),"unknown"===e.status&&this.updateContactInvitationStatus(e.dbId,"wait")}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"joinContactInvitation");throw this.logger.error("[invitationService] "+e.message),e.error}}async sendInvitationByEmail(e,t=""){if(!e||!e.length){this.logger.error("[invitationService] sendInvitationByEmail: no email provided");const e=new Error("missing email");throw this.errorHelperService.getErrorInfo(e,"sendInvitationByEmail")}try{this.logger.info("[invitationService] sendInvitationByEmail");const i=this.settingsService.getAppliLanguageCodeForServer(),r=`${this.portalURL}${this.contactService.userContact.dbId}/invitations`,n=this.authService.getPostHeader(),s={email:e,lang:i,customMessage:t},o=await fetch(r,{method:"POST",headers:n,body:JSON.stringify(s)});if(!o.ok)throw o;this.logger.info("[invitationService] sendInvitationByEmail - success")}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"sendInvitationByEmail");throw this.logger.error("[invitationService] "+e.message),e.error}}async cancelOneSendInvitation(e){try{const t=`${this.portalURL}${e.invitingUserId}/invitations/${e.id}/cancel`,i=this.authService.getPostHeader(),r=await fetch(t,{method:"POST",headers:i});if(!r.ok)throw r;this.logger.info("[invitationService] cancelOneSendInvitation success")}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"cancelOneSendInvitation");throw this.logger.error("[invitationService] "+e.message),e.error}}async reSendInvitation(e){try{const t=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.contactService.userContact.dbId}/invitations/${e}/re-send`,i=this.authService.getPostHeader(),r=await fetch(t,{method:"POST",headers:i});if(!r.ok)throw r;this.logger.info(`[invitationService] reSendInvitation ${e} success`)}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"reSendInvitation");throw this.logger.error("[invitationService] "+e.message),e.error}}async sendInvitationsParBulk(e){if(!e.length||e.length>100)throw this.logger.error("[invitationService] sendInvitationsParBulk mail list length not correct"),new Error("sendInvitationsParBulk mail list length not correct");try{const t=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.contactService.userContact.dbId}/invitations/bulk`,i=this.authService.getPostHeader(),r=await fetch(t,{method:"POST",headers:i,body:JSON.stringify({emails:e})});if(!r.ok)throw r;this.logger.info("[invitationService] sendInvitationsParBulk - success")}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"sendInvitationsParBulk");throw this.logger.error("[invitationService] "+e.message),e.error}}async acceptInvitation(e){try{const t=`${this.portalURL}${e.invitedUserId}/invitations/${e.id}/accept`,i=this.authService.getPostHeader(),r=await fetch(t,{method:"POST",headers:i});if(!r.ok)throw r;this.logger.info("[invitationService] acceptInvitation success")}catch(t){const i=await this.errorHelperService.getErrorInfo(t,"acceptInvitation");if(!i.error.errorDetailsCode||409605!==i.error.errorDetailsCode)throw this.logger.error("[invitationService] "+i.message),i.error;{const t=await this.contactService.getContactByDBId(e.invitingUserId,true);this.eventService.publish("ON_CONTACT_UPDATED_EVENT",t)}}}async declineInvitation(e){try{const t=`${this.portalURL}${e.invitedUserId}/invitations/${e.id}/decline`,i=this.authService.getPostHeader(),r=await fetch(t,{method:"POST",headers:i});if(!r.ok)throw r;this.logger.info("[invitationService] declineInvitation success")}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"declineInvitation");throw this.logger.error("[invitationService] "+e.message),e.error}}async updateContactInvitationStatus(e,t,i=null){const r=await this.contactService.getContactByDBId(e);switch(t){case"ask":r.status="unknown",r.ask="ask",r.invitation=i;break;case"wait":r.status="wait",r.ask="subscribe",r.invitation=i;break;default:r.ask="none",r.invitation=null}this.contactService.updateContactRichStatus(r),r.rxSubject.next({name:"update",data:r})}sortInvitationArray(e,t){return new Date(t.lastNotificationDate).getTime()-new Date(e.lastNotificationDate).getTime()}async getAllReceivedInvitations(){try{const e=`${this.portalURL}${this.contactService.userContact.dbId}/invitations/received?format=full&status=pending&limit=500`,t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=(await i.json()).data;return this.logger.info(`[invitationService] getAllReceivedInvitations success (find ${r.length} invitations)`),this.receivedInvitations={},r.forEach((e=>{if("pending"===e.status&&"registration"!==e.type){const t=d.Invitation.createFromData(e);this.receivedInvitations[e.id]=t,e.invitingUserId&&this.updateContactInvitationStatus(e.invitingUserId,"ask",t)}else"accepted"!==e.status&&"auto-accepted"!==e.status||(this.receivedInvitations[e.id]=d.Invitation.createFromData(e))})),this.updateReceivedInvitationsArray(),this.receivedInvitations}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getAllReceivedInvitations");throw this.logger.error("[invitationService] "+t.message),t.error}}async getAllSentInvitations(){try{const e=`${this.portalURL}${this.contactService.userContact.dbId}/invitations/sent?format=full&status=pending&limit=500`,t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=(await i.json()).data;return this.logger.info("[invitationService] getAllSentInvitations success (find "+r.length+" invitations)"),this.sentInvitations={},r.forEach((e=>{if("pending"===e.status&&!e.inviteToJoinMeeting){const t=d.Invitation.createFromData(e);this.sentInvitations[e.id]=t,void 0!==t.invitedUserId&&this.updateContactInvitationStatus(t.invitedUserId,"wait",t)}})),this.updateSentInvitationsArray(),this.sentInvitations}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getAllSentInvitations");throw this.logger.error("[invitationService] "+t.message),t.error}}}t.InvitationService=h},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(63);class n{static create(e,t,i,r,s,o,a,c,l,d,u){return new n(e,t,i,r,s,o,a,c,l,d,u)}static createFromData(e){const t=new n(e.id,e.invitedUserId,e.invitedUserEmail,e.invitingUserId,e.invitingUserEmail,e.requestNotificationLanguage,e.invitingDate,e.lastNotificationDate,e.status,e.type,e.inviteToJoinMeeting,e.invitedPhoneNumber);return t.createDefaultAvatar(),t}constructor(e,t,i,r,n,s,o,a,c,l,d,u=null){this.id=e,this.invitedUserId=t,this.invitedUserEmail=i,this.invitedPhoneNumber=u,this.invitingUserId=r,this.invitingUserEmail=n,this.requestNotificationLanguage=s,this.invitingDate=o,this.lastNotificationDate=a,this.status=c,this.type=l,this.defaultAvatar=null,this.inviteToJoinMeeting=d}createDefaultAvatar(){if(!this.defaultAvatar&&this.invitedUserEmail){const e=r.UserInfoService.getInstance(),t=e.computeUserColor(this.invitedUserEmail),i=this.invitedUserEmail.substring(0,2).toUpperCase();this.defaultAvatar=e.createDefaultAvatarImage(i,t)}}}t.Invitation=n},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(4),n=i(8),s=i(13),o=i(7),a=i(18),c=i(9);class l{constructor(e=null,t=null,i=null,r=null,n=null,s=null){this.getKeys=e,this.createFeatureCodeKey=t,this.createSpeedDialKey=i,this.updateKey=r,this.updateKeyPosition=n,this.deleteKey=s}}class d{constructor(){this.xmppService=c.XmppService.getInstance(),this.logger=r.LoggerService.getInstance(),this.authService=n.AuthService.getInstance(),this.errorHelperService=s.ErrorHelperService.getInstance(),this.portalURL="",this.xmppHandlers=[],this._sdkApis=Object.keys(new l),this.telephonyKeysSubject=new o.Subject}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.telephonyKeysService||(e.rainbow.telephonyKeysService=new d),e.rainbow.telephonyKeysService}async start(){this.logger.info("[userTelephonyKeysService] === STARTING ==="),this.portalURL=config.restServerUrl+"/api/rainbow/enduser/v1.0/users/"+this.authService.userId,this.attachListeners(),this.logger.info("=== STARTED ===")}async stop(){this.logger.info("[userTelephonyKeysService] === STOPPING ==="),this.logger.info("=== STOPPED ===")}async reconnect(){this.attachListeners(),this.logger.info("[userTelephonyKeysService] reconnect -- success")}attachListeners(){this.xmppHandlers.forEach((e=>{this.xmppService.connection.deleteHandler(e)})),this.xmppHandlers=[],this.xmppHandlers.push(this.xmppService.connection.addHandler((e=>this.onManagementMessage(e)),null,"message","management"))}async onManagementMessage(e){try{const t=$(e);return t.find("telephony-key").length>0&&this.submitEvent("TELEPHONYKEYS_UPDATE"),true}catch(t){return this.logger.error("[telephonyKeysService] onManagementMessage  -- failure -- "+t.message),true}}submitEvent(e,t){this.telephonyKeysSubject.next(a.RBEvent.create(e,t))}async getKeys(){try{const e=this.portalURL+"/telephony-keys",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=await i.json();return r.data.telephonyKeys}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getKeys");throw this.logger.error("[TelephonyKeysService] "+t.message),t.error}}async createFeatureCodeKey(e,t){try{const i={name:e,number:t,type:"featureCode",featureCodeSubType:"dtmf"},r=this.portalURL+"/telephony-keys",n=this.authService.getPostHeader(),s=await fetch(r,{method:"POST",headers:n,body:JSON.stringify(i)});if(!s.ok)throw s;const o=(await s.json()).data;return this.telephonyKeysSubject.next({op:"create",telephonyKeys:o.telephonyKeys}),o.telephonyKeys}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"createFeatureCodeKey");throw this.logger.error("[TelephonyKeysService] "+e.message),e.error}}async createSpeedDialKey(e,t){try{const i={name:e,number:t,type:"speedDialing"},r=this.portalURL+"/telephony-keys",n=this.authService.getPostHeader(),s=await fetch(r,{method:"POST",headers:n,body:JSON.stringify(i)});if(!s.ok)throw s;const o=(await s.json()).data;return this.telephonyKeysSubject.next({op:"create",telephonyKeys:o.telephonyKeys}),o.telephonyKeys}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"createSpeedDialKey");throw this.logger.error("[TelephonyKeysService] "+e.message),e.error}}async updateKey(e,t){try{const i=new URL(`${this.portalURL}/telephony-keys/${e}`),r=this.authService.getPostHeader(),n=await fetch(i.toString(),{method:"PUT",headers:r,body:JSON.stringify(t)});if(!n.ok)throw n;const s=(await n.json()).data;return this.telephonyKeysSubject.next({op:"update",telephonyKeys:s.telephonyKeys}),s.telephonyKeys}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"updateKey");throw this.logger.error("[TelephonyKeysService] "+e.message),e.error}}async updateKeyPosition(e,t){try{const i=new URL(`${this.portalURL}/telephony-keys/${e}`);i.searchParams.set("position",String(t));const r=this.authService.getPostHeader(),n=await fetch(i.toString(),{method:"PUT",headers:r});if(!n.ok)throw n;const s=(await n.json()).data;return this.telephonyKeysSubject.next({op:"update",telephonyKeys:s.telephonyKeys}),s.telephonyKeys}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"updateFeatureCodeKeyPosition");throw this.logger.error("[TelephonyKeysService] "+e.message),e.error}}async deleteKey(e){try{const t=new URL(`${this.portalURL}/telephony-keys/${e}`),i=this.authService.getRequestHeader(),r=await fetch(t.toString(),{method:"DELETE",headers:i});if(!r.ok)throw r;const n=(await r.json()).data;return this.telephonyKeysSubject.next({op:"delete",telephonyKeys:n.telephonyKeys}),n.telephonyKeys}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"deleteKey");throw this.logger.error("[TelephonyKeysService] "+e.message),e.error}}async getSharedKeys(){try{const e=this.portalURL+"/telephony-keys/shareable",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=await i.json();return r.data.sharedTelephonyKeys}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getSharedKeys");throw this.logger.error("[TelephonyKeysService] "+t.message),t.error}}async selectSharedKey(e){try{const t=`${this.portalURL}/telephony-keys/shareable/${e}`,i=this.authService.getPostHeader(),r=await fetch(t,{method:"POST",headers:i});if(!r.ok)throw r;const n=await r.json();return n.data.telephonyKeys}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"selectSharedKey");throw this.logger.error("[TelephonyKeysService] "+e.message),e.error}}}t.TelephonyKeysService=d},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(319),n=i(8),s=i(9),o=i(6),a=i(4),c=i(11),l=i(13);class d{}t.AbstractGroupService=d;class u extends d{constructor(){super(),this.portalURL=null,this.groups=null,this.groupMessageHandlerRef=null,this.authService=n.AuthService.getInstance(),this.xmppService=s.XmppService.getInstance(),this.contactService=o.ContactService.getInstance(),this.errorHelperService=l.ErrorHelperService.getInstance(),this.eventService=c.EventService.getInstance(),this.logger=a.LoggerService.getInstance(),this.ON_REMOVE_GROUP_USER_EVENT="ON_REMOVE_GROUP_USER_EVENT",this.ON_ADD_GROUP_USER_EVENT="ON_ADD_GROUP_USER_EVENT",this.ON_GROUP_USERS_UPDATE_EVENT="ON_GROUP_USERS_UPDATE_EVENT",this.ON_CREATED_GROUP_EVENT="ON_CREATED_GROUP_EVENT",this.ON_UPDATE_GROUP_EVENT="ON_UPDATE_GROUP_EVENT",this.ON_REMOVED_GROUP_EVENT="ON_REMOVED_GROUP_EVENT"}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.groupService||(e.rainbow.groupService=new u),e.rainbow.groupService}async start(){this.logger.info(""),this.logger.info("[groupService] === STARTING ==="),this.portalURL=`${config.restServerUrl}/api/rainbow/enduser/v1.0/users/${this.authService.userId}/`,this.contactService.userContact.isCPaaSGuest()||(this.attachHandlers(),this.getRemoteGroups(),this.logger.info("[groupService] === STARTED ==="))}async stop(){this.logger.info("[groupService] === STOPPING ==="),this.groups=null,this.groupMessageHandlerRef&&(this.xmppService.deleteHandler(this.groupMessageHandlerRef),this.groupMessageHandlerRef=null),this.logger.info("[groupService] === STOPPED ===")}reconnect(){this.attachHandlers()}async addGroup(e){try{this.logger.info("[groupService] addGroup : "+e.name);const t=this.authService.getPostHeader(),i=JSON.stringify({name:e.name,comment:e.comment,isFavorite:e.isFavorite}),n=await fetch(this.portalURL+"groups",{method:"POST",headers:t,body:i});if(!n.ok)throw n;const s=await n.json();return this.logger.info("[groupService] addGroup success for : "+e.name),r.Group.createFromData(s.data)}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"addGroup");throw this.logger.error(e.message),e.error.details=409===t.status?"conflict":"unknown",e.error}}async removeGroup(e){try{this.logger.info("[groupService] removeGroup : "+e);const t=this.authService.getRequestHeader(),i=await fetch(`${this.portalURL}groups/${e}`,{method:"DELETE",headers:t});if(!i.ok)throw i;this.removeGroupAct(e),this.logger.info("[groupService] removeGroup success for : "+e)}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"removeGroup");throw this.logger.error(e.message),e.error}}async updateGroup(e){try{this.logger.info("[groupService] updateGroup for : "+e.name);const t=this.authService.getPostHeader(),i=JSON.stringify({name:e.name,comment:e.comment,isFavorite:e.isFavorite}),r=await fetch(`${this.portalURL}groups/${e.id}`,{method:"PUT",headers:t,body:i});if(!r.ok)throw r;return this.logger.info("[groupService] updateGroup success for : "+e.name),e}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"updateGroup");throw this.logger.error(e.message),e.error}}async addGroupUser(e,t){try{this.logger.info("[groupService] addGroupUser");if(e.users.some((e=>t.dbId===e.dbId)))return this.logger.info("[groupService] addGroupUser - user: "+t.id+" already exist in group: "+e.name+" - no remote action"),e;const i=this.authService.getPostHeader(),r=await fetch(`${this.portalURL}groups/${e.id}/users/${t.dbId}`,{method:"POST",headers:i});if(!r.ok)throw r;const n=await this.addGroupUserAct(e.id,t.dbId);return this.eventService.publish(this.ON_GROUP_USERS_UPDATE_EVENT),this.logger.info("[groupService] addGroupUser success: "+t.id+"/"+n.name),n}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"addGroupUser");throw this.logger.error(e.message),e.error}}async removeGroupUser(e,t){try{this.logger.info("[groupService] removeGroupUser : "+e+"/"+t.id);const i=this.authService.getRequestHeader(),r=await fetch(`${this.portalURL}groups/${e}/users/${t.dbId}`,{method:"DELETE",headers:i});if(!r.ok)throw r;this.removeGroupUserAct(e,t.dbId);const n=this.getGroupById(e);return this.logger.info("[groupService] removeGroupUser success : "+e+"/"+t.id),this.eventService.publish(this.ON_GROUP_USERS_UPDATE_EVENT),n}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"removeGroupUser");throw this.logger.error(e.message),e.error}}getGroups(){return this.groups}getGroupById(e){return this.groups.find((t=>t.id===e))}async getGroup(e){try{this.logger.info("[groupService] getGroup  for "+e);const t=this.authService.getRequestHeader(),i=await fetch(`${this.portalURL}groups/${e}`,{method:"GET",headers:t});if(!i.ok)throw i;const n=(await i.json()).data,s=[],o=r.Group.createFromData(n);return this.groups.some(((e,t)=>e.id===n.id&&(this.groups[t]=o,n.users.forEach((e=>{s.push(this.contactService.getContactByDBId(e.id).then((e=>{e&&this.groups[t].users.push(e)})))})),true)))||(this.groups.push(o),n.users.forEach((e=>{s.push(this.contactService.getContactByDBId(e.id).then((function(e){if(e){o.users.push(e);const t=[o];e.getGroups()?e.getGroups().push(o):e.setGroups(t)}})))}))),await Promise.all(s),this.logger.info("[groupService] getGroup success for "+o.name+" : "+o.id),o}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getGroup");throw this.logger.error(e.message),e.error}}attachHandlers(){this.groupMessageHandlerRef&&(this.xmppService.deleteHandler(this.groupMessageHandlerRef),this.groupMessageHandlerRef=null),this.groupMessageHandlerRef=this.xmppService.addHandler((e=>(this.onGroupMessageReceived(e),true)),null,"message","management")}async onGroupMessageReceived(e){try{const t={outgoingMessage:false};if(t.body=$(e)[0].firstChild,t.messageId=$(e).attr("id"),t.body&&"group"===t.body.tagName){const e=t.body.getAttribute("action"),i=t.body.getAttribute("scope"),r=t.body.getAttribute("id");switch(i){case"group":switch(e){case"create":await this.getGroup(r),this.eventService.publish(this.ON_CREATED_GROUP_EVENT,r);break;case"update":{const e=t.body.getAttribute("name"),i=t.body.getAttribute("comment"),n="true"===t.body.getAttribute("isFavorite");this.eventService.publish(this.ON_UPDATE_GROUP_EVENT,r,e,i,n)}break;case"delete":this.removeGroupAct(r),this.eventService.publish(this.ON_REMOVED_GROUP_EVENT,r)}break;case"user":{const i=t.body.getAttribute("userId");switch(e){case"create":this.addGroupUserAct(r,i);break;case"delete":this.removeGroupUserAct(r,i),this.eventService.publish(this.ON_REMOVE_GROUP_USER_EVENT,r,i)}}}}}catch(t){}}async getRemoteGroups(){try{this.logger.info("[groupService] getRemoteGroups");const e=this.authService.getRequestHeader(),t=await fetch(this.portalURL+"groups?format=full",{method:"GET",headers:e});if(!t.ok)throw t;const i=(await t.json()).data;this.logger.info("[groupService] getRemoteGroups success (find "+i.total+" group(s))"),this.groups=[];const n=[];return i.forEach((e=>{const t=r.Group.createFromData(e);this.groups.push(t),e.users.forEach((e=>{n.push(this.contactService.getContactByDBId(e).then((e=>{e&&t.users.push(e)})))})),this.logGroupUsers(t)})),await Promise.all(n),this.groups}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getRemoteGroups");throw this.logger.error(t.message),t.error}}removeGroupAct(e){const t=this.groups.findIndex((t=>t.id===e));-1!==t&&this.groups.splice(t,1)}async addGroupUserAct(e,t){try{const i=this.groups.find((t=>t.id===e));if(!i)throw new Error(`Group ${e} not found`);let r=i.users.find((e=>t===e.dbId));if(r)return i;r=await this.contactService.getContactByDBId(t),i.users.push(r);const n=[i];return r.getGroups()?r.getGroups().push(i):r.setGroups(n),this.eventService.publish(this.ON_ADD_GROUP_USER_EVENT,e,t),i}catch(i){return this.logger.error("[GroupService] addGroupUserAct - "+i.message),null}}removeGroupUserAct(e,t){this.groups.forEach((i=>{i.id===e&&i.users.forEach(((r,n)=>{r.dbId===t&&(i.users.splice(n,1),r.getGroups()&&r.getGroups().forEach(((t,i)=>{t.id===e&&r.getGroups().splice(i,1)})))}))}))}logGroupUsers(e){let t="";e&&e.users&&0!==e.users.length&&(t=e.users.map((function(e){return e.nameForLog})).join(" / "),this.logger.info("[groupService] logGroupUsers for "+e.name+": "+t))}logUserGroups(e,t){let i="";t&&0!==t.length&&(t.forEach((e=>{e.name&&(i+=" "+e.name)})),this.logger.info("[groupService] logUserGroups for "+e+":"+i))}}t.GroupService=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{constructor(e,t,i="",r=false){this.isFavorite=false,this.users=[],this.sortedUserList=[],this.id=e,this.name=t,this.comment=i,this.isFavorite=r}static createFromData(e){return new r(e.id,e.name,e.comment,e.isFavorite)}}t.Group=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7),n=i(139),s=i(461),o=i(8),a=i(9),c=i(14),l=i(4),d=i(46),u=i(6),h=i(18),f=i(103),p=i(71),g=i(11),m=i(462);class v{constructor(){this.messages=[],this.complete=false,this.pageIndex=0,this.isLoading=false,this.type="AGGREGATE"}}class S{}t.AbstractChannelService=S;class b extends S{constructor(){super(),this.logger=l.LoggerService.getInstance(),this.authService=o.AuthService.getInstance(),this.xmppService=a.XmppService.getInstance(),this.profileService=c.ProfileService.getInstance(),this.i18n=d.I18nService.getInstance(),this.contactService=u.ContactService.getInstance(),this.eventService=g.EventService.getInstance(),this.listeners=[],this.isStarted=false,this.channels={},this.channelsList=[],this.serviceStatusSubject=new r.Subject,this.rxSubject=new r.Subject,this.LIST_EVENT_TYPE={ADD:0,UPDATE:1,REMOVE:2,DELETE:3,SUBSCRIBE:4,UNSUBSCRIBE:5,CREATE:6},this.USER_ROLE={NONE:"none",OWNER:"owner",PUBLISHER:"publisher",MEMBER:"member"},this.MESSAGE_ACTION={ADD:0,RETRACT:1,UPDATED:2},this.xmppMessageHandler=null,this.xmppManagementHandler=null,this.notificationCounter=0,this.messageCounter=0,this.invitationCounter=0,this.CHANNEL_UPDATE_EVENT="CHANNEL_UPDATE_EVENT",this.CHANNEL_NOTIFICATION_NUMBER_UPDATED="CHANNEL_NOTIFICATION_NUMBER_UPDATED",this.CHANNEL_USER_SUBSCRIPTION_EVENT="CHANNEL_USER_SUBSCRIPTION_EVENT"}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.channelService||(e.rainbow.channelService=new b),e.rainbow.channelService}async start(){try{if(!this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CHANNEL_ACTIVATED))return;if(this.contactService.userContact.isCPaaSGuest())return;if(!this.contactService.userContact.channelsEnabled)return;this.logger.info("[channelService] === STARTING ==="),this.feedChannel=new v,this.portalURL=config.restServerUrl+"/api/rainbow/channels/v1.0/channels",this.getMyChannels()}catch(e){this.logger.error("[channelService] === STARTING FAILURE === "+e.message)}}async reconnect(){try{this.logger.info("[channelService] reconnect"),await this.stop(),await this.start()}catch(e){this.logger.error("[channelService] reconnect -- failure -- "+e.message)}}async stop(){this.logger.info("[channelService] === STOPPING ==="),this.listeners.forEach((e=>{e()})),this.xmppMessageHandler&&(this.xmppService.connection.deleteHandler(this.xmppMessageHandler),this.xmppMessageHandler=null),this.xmppManagementHandler&&(this.xmppService.connection.deleteHandler(this.xmppManagementHandler),this.xmppManagementHandler=null),this.channels={},this.channelsList=[],this.feedChannel=null,this.notificationCounter=0,this.messageCounter=0,this.eventService.publish(this.CHANNEL_NOTIFICATION_NUMBER_UPDATED,this.notificationCounter),this.logger.info("[channelService] === STOPPED ===")}attachHandlers(){this.xmppMessageHandler=this.xmppService.connection.addHandler((e=>this.onChannelMessageReceived(e)),"","message","headline"),this.xmppManagementHandler=this.xmppService.connection.addHandler((e=>this.onChannelManagementReceived(e)),null,"message","management")}subscribe(e){return this.rxSubject.subscribe(e)}channelErrorHandler(e,t){let i=null;return t.data?(this.logger.error("[channelService] "+e+" -- failure -- "+t.data.errorDetails),i=new m.RBError(t.data.errorMsg,t.data.errorDetails,t.data.errorDetailsCode)):(this.logger.error("[channelService] "+e+" -- failure -- Server failure"),i=new m.RBError("Server failure")),i}onChannelMessageReceived(e){try{const t=$(e).find("event");if(t&&"http://jabber.org/protocol/pubsub#event"===t.attr("xmlns")){const e=t.find("items"),i=e.find("item"),r=e.find("retract"),n=t.find("update");if(1===n.length)this.updateMessage(n);else if(1===i.length)this.onNewMessage(i);else if(1===r.length){const t=r.attr("id"),i=e.attr("node").split(":")[0];this.onRetractMessage(i,t)}}return true}catch(dp){return this.logger.error("onChannelMessageReceived -- failure -- "+dp.message),true}}onNewMessage(e){const t=e.find("entry"),i=e.attr("id"),r=t.attr("channelId"),n=this.getChannelFromCache(r),o=n.messages.findIndex((e=>e.id===i)),a=this.feedChannel.messages.findIndex((e=>e.id===i));let c=t.attr("creation")?"modify":"new";-1===o&&-1===a||(c="modify"),this.logger.info("[channelService] onNewMessage -- "+c+" message "+i+" on channel "+r);const l={id:i,channelId:r,from:t.attr("from"),fromDetails:null,new:false,entry:{type:t.find("type").length?t.find("type")[0].textContent:"",message:t.find("message").length?t.find("message")[0].textContent:"",title:t.find("title").length?t.find("title")[0].textContent:"",url:t.find("url").length?t.find("url")[0].textContent:"",images:[],attachments:[],video:null},modified:"modify"===c,timestamp:t.attr("timestamp")},d=e.find("images");0!==d.length&&d.find("id").each(((e,t)=>{l.entry.images.push({id:t.textContent})}));const u=e.find("attachments");0!==u.length&&u.find("id").each(((e,t)=>{l.entry.attachments.push({id:t.textContent})}));const f=e.find("video");if(0!==f.length&&(l.entry.video={provider:f.find("provider")[0].textContent,id:f.find("id")[0].textContent}),"new"===c){const e=s.ChannelMessage.createFromData(n,l);n.loaded&&n.messages.unshift(e),this.feedChannel.messages.unshift(e),this.contactService.userContact.jid!==l.from&&(e.isNew=true,this.incrementMessagesCounter()),n.messagesCount+=1,this.rxSubject.next(h.RBEvent.create("CHANNEL_MESSAGE_RECEIVED",{action:this.MESSAGE_ACTION.ADD,message:l})),n.updateSubject.next()}else{let e=null;if(-1!==o){const t=n.messages[o];e=s.ChannelMessage.updateFromData(n,t,l),n.messages[o]=e}if(-1!==a){const t=this.feedChannel.messages[a];e=s.ChannelMessage.updateFromData(n,t,l),this.feedChannel.messages[a]=e}e&&this.rxSubject.next(h.RBEvent.create("CHANNEL_MESSAGE_RECEIVED",{action:this.MESSAGE_ACTION.UPDATED,channelMessage:e}))}}getChannelMessage(e,t){const i=this.getChannelFromCache(e);if(i){return-1!==i.messages.findIndex((e=>e.id===t))?i.messages.find((e=>e.id===t)):null}return null}getFeedChannelMessage(e){let t=null;return-1!==this.feedChannel.messages.findIndex((t=>t.id===e))&&(t=this.feedChannel.messages.find((t=>t.id===e))),t}updateMessage(e){const t=e.attr("id"),i=e.attr("channel_id"),r=[],n=this.getChannelMessage(i,t),s=this.getFeedChannelMessage(t);n&&r.push(n),s&&r.push(s),r.forEach((t=>{const i=e.find("my_appreciation");t.myLike=1===i.length?i.attr("appreciation"):"none";const r=e.find("appreciations"),n=["like","happy","applause","fantastic","doubt"];1===r.length&&(t.likeCounters=n.reduce(((e,t)=>(e[t]=parseInt(r.attr(t)||0,10),e)),{})),t.rxSubject.next(h.RBEvent.create("updateLikes"))}))}onRetractMessage(e,t){this.logger.info("[channelService] onRetractMessage -- retract message "+t+" on channel "+e);const i=this.getChannelFromCache(e);let r=null;if(i.loaded){const e=i.messages.findIndex((e=>e.id===t));-1!==e&&(r=i.messages[e],i.messages.splice(e,1))}const n=this.feedChannel.messages.findIndex((e=>e.id===t));-1!==n&&(r=this.feedChannel.messages[n],this.feedChannel.messages.splice(n,1)),r&&r.isNew&&this.decrementMessagesCounter(),i.messagesCount-=1,this.rxSubject.next(h.RBEvent.create("CHANNEL_MESSAGE_RECEIVED",{action:this.MESSAGE_ACTION.RETRACT})),i.updateSubject.next()}onChannelManagementReceived(e){try{const t=$(e).find("mute");if(t&&t.length>0&&"channel"===t.attr("type")){const e=t.attr("peer_id"),i=this.getChannelFromCache(e);this.muteChannel(i)}const i=$(e).find("unmute");if(i&&i.length>0&&"channel"===i.attr("type")){const e=i.attr("peer_id"),t=this.getChannelFromCache(e);this.unmuteChannel(t)}const r=$(e).find("channel");if(r&&r.length>0){const e=r.attr("channelid"),t=this.getChannelFromCache(e);if(t){const i=r.find("avatar"),n=r.find("name"),s=r.find("topic"),o=r.find("category"),a=r.find("type");i&&i.length>0&&this.onAvatarChange(e,i),n&&n.length>0&&(t.name=n.text()),s&&s.length>0&&(t.topic=s.text()),o&&o.length>0&&(t.category=o.text()),a&&a.length>0&&(t.userRole=a.text(),this.eventService.publish("ON_CHANNEL_ROLE_UPDATED_EVENT",e)),this.updateDisplayInfo(t)}const i=r.attr("action");switch(this.logger.info("[channelService] onChannelManagementReceived -- "+i+" event received on channel "+e),i){case"add":this.onAddToChannel(e);break;case"update":this.onUpdateToChannel(e);break;case"remove":this.onRemovedFromChannel(e);break;case"subscribe":this.onSubscribeToChannel(e,r.attr("subscribers"));break;case"unsubscribe":this.onUnsubscribeToChannel(e,r.attr("subscribers"));break;case"delete":this.onDeleteChannel(e)}}const n=$(e).find("channel-subscription");if(n&&n.length>0){const e=n.attr("channelid"),t=n.attr("action"),i=n.attr("id"),r=n.attr("subscribers"),s=this.getChannelFromCache(e);switch(s.subscribers_count=Number.parseInt(r,10),this.logger.info("[channelService] onChannelManagementReceived -- subscription-"+t+" event received on channel "+e),t){case"subscribe":this.onUserSubscribeEvent(e,i);break;case"unsubscribe":this.onUserUnsubscribeEvent(e,i)}s.updateSubject.next()}return true}catch(dp){return this.logger.error("[channels] onChannelManagementReceived -- failure -- "+dp.message),true}}async muteChannel(e){try{const t=`${this.portalURL}/${e.id}/mute`,i=await fetch(t,{method:"POST",headers:this.authService.getPostHeader()});if(!i.ok)throw new Error(i.statusText);e.muted=true,e.updateSubject.next()}catch(t){throw this.channelErrorHandler("muteChannel",t)}}async unmuteChannel(e){try{const t=`${this.portalURL}/${e.id}/mute`,i=await fetch(t,{method:"DELETE",headers:this.authService.getPostHeader()});if(!i.ok)throw new Error(i.statusText);e.muted=false,e.updateSubject.next()}catch(t){throw this.channelErrorHandler("unmuteChannel",t)}}onAddToChannel(e){const t=this.getChannelFromCache(e);this.getChannel(e).then((i=>{t||i.invited?!t&&i.invited?(this.addChannelToCache(i),this.incrementInvitationCounter(),this.eventService.publish(this.CHANNEL_UPDATE_EVENT,this.LIST_EVENT_TYPE.SUBSCRIBE,i.id),this.rxSubject.next(h.RBEvent.create(this.CHANNEL_UPDATE_EVENT,{action:this.LIST_EVENT_TYPE.SUBSCRIBE,channelId:i.id}))):t&&i.userRole!==this.USER_ROLE.NONE&&(t.userRole=i.userRole,this.feedChannel.messages=[],this.retrieveLatests().then((()=>{this.eventService.publish(this.CHANNEL_UPDATE_EVENT,this.LIST_EVENT_TYPE.SUBSCRIBE,e)}))):(this.addChannelToCache(i),this.eventService.publish(this.CHANNEL_UPDATE_EVENT,this.LIST_EVENT_TYPE.ADD,i.id))}))}onUpdateToChannel(e){this.getChannel(e).then((e=>{e.invited&&(this.addChannelToCache(e),this.eventService.publish(this.CHANNEL_UPDATE_EVENT,this.LIST_EVENT_TYPE.ADD,e.id))}))}onRemovedFromChannel(e){this.removeChannelFromCache(e).then((()=>{this.eventService.publish(this.CHANNEL_UPDATE_EVENT,this.LIST_EVENT_TYPE.DELETE,e)}))}onAvatarChange(e,t){const i=t.attr("action"),r=t.attr("lastAvatarUpdateDate")?new Date(t.attr("lastAvatarUpdateDate")):null;if(this.logger.info("[channelService] onChannelManagementReceived -- "+i+" avatar for "+e),"delete"===i||"update"===i){const t=this.getChannelFromCache(e);t.lastAvatarUpdateDate=r,null!==r&&(t.avatar=config.restServerUrl+"/api/channel-avatar/"+e+"?size=256&ts="+new Date(r).getTime())}}onSubscribeToChannel(e,t){this.logger.info(`[onSubscribeToChannel] channelId = ${e} - subsInfo = ${t}`);const i=this.getChannelFromCache(e),r=Number.parseInt(t,10);i?(i.invited=false,i.subscribed=true,i.subscribers_count=r,i.messages=[],i.complete=false,i.pageIndex=0,i.isLoading=false,this.feedChannel.messages=[],this.retrieveLatests().then((()=>{this.eventService.publish("CURRENT_CHANNEL_UPDATE_EVENT",e),this.eventService.publish(this.CHANNEL_UPDATE_EVENT,this.LIST_EVENT_TYPE.SUBSCRIBE,e)}))):this.getChannel(e).then((e=>(this.addChannelToCache(e),this.feedChannel.messages=[],this.retrieveLatests()))).then((()=>{this.eventService.publish(this.CHANNEL_UPDATE_EVENT,this.LIST_EVENT_TYPE.SUBSCRIBE,e)}))}onUnsubscribeToChannel(e,t){const i=Number.parseInt(t,10),r=this.getChannelFromCache(e);r.subscribers_count=i,r.subscribed=false,this.feedChannel.messages=[],this.retrieveLatests().then((()=>{this.eventService.publish(this.CHANNEL_UPDATE_EVENT,this.LIST_EVENT_TYPE.UNSUBSCRIBE,e)}))}onDeleteChannel(e){this.removeChannelFromCache(e).then((()=>{this.eventService.publish(this.CHANNEL_UPDATE_EVENT,this.LIST_EVENT_TYPE.DELETE,e)}))}onUserSubscribeEvent(e,t){this.eventService.publish(this.CHANNEL_USER_SUBSCRIPTION_EVENT,this.LIST_EVENT_TYPE.SUBSCRIBE,e,t)}onUserUnsubscribeEvent(e,t){this.eventService.publish(this.CHANNEL_USER_SUBSCRIPTION_EVENT,this.LIST_EVENT_TYPE.UNSUBSCRIBE,e,t)}getChannelPublishers(e){return new Promise(((t,i)=>{if(e.publishersRetreived)return t();this.getChannelUsers(e.id,{format:"full",types:"owner publisher"}).then((i=>{i.data.forEach((t=>{let i=this.contactService.getContactByJid(t.jid_im);i||(i=this.contactService.createContact(),i.updateFromUserData(t),this.contactService.updateContactRichStatus(i),this.contactService.contacts[i.id]=i,this.contactService.dbContacts[i.dbId]=i,this.contactService.jtelContacts[i.jidtel]=i),e.users.push(i)})),e.publishersRetreived=true,this.logger.info("[channelService] getChannelPublishers ("+e.id+") -- success -- find "+i.length+" publisher(s)"),t()})).catch((t=>{i(this.channelErrorHandler("getChannelPublishers ("+e.id+")",t))}))}))}retrieveLatests(e=null){return this.getLatestMessages(10,e,null).then((e=>{const t=e.reduce(((e,t)=>(this.feedChannel.messages.find((e=>e.id===t.id))||e.push(s.ChannelMessage.createFromData(this.getChannelFromCache(t.channelId),t)),e)),[]);return this.feedChannel.messages.push.apply(this.feedChannel.messages,t),t.length}))}async getChannelMessages(e,t){try{let i=null;i="AGGREGATE"===e.type?this.getLatestMessages(10,t):this.getChannelItems(e.id,b.PAGE_SIZE,t);const r=await i,n=r.reduce(((t,i)=>(e.messages.find((e=>e.id===i.id))||t.push(s.ChannelMessage.createFromData(this.getChannelFromCache(i.channelId),i)),t)),[]);return e.messages.push.apply(e.messages,n),{nbMessagesLoaded:r.length,nbMessagesAdded:n.length}}catch(i){throw this.channelErrorHandler("getChannelMessages ("+e.id+")",i)}}async getChannelNextPage(e,t,i=false){const r="AGGREGATE"===e.type?"feedChannel":e.id;try{if(e.isLoading)return this.logger.info("-- getChannelNextPage("+r+", "+e.pageIndex+") -- ignored (isLoading)"),{};e.isLoading=true,i&&(e.pageIndex=0,t=-1);const n=(e.pageIndex+1)*b.PAGE_SIZE;if(n<=e.messages.length)return this.logger.info("-- getChannelNextPage("+r+", "+e.pageIndex+") -- success from cache"),e.pageIndex+=1,e.isLoading=false,t+=b.PAGE_SIZE,{messages:e.messages,nbMessages:n,deferLoadNextPageIndex:t};if(e.complete)return this.logger.info("-- getChannelNextPage("+r+", "+e.pageIndex+") -- success from cache (complete)"),e.isLoading=false,t=-1,{messages:e.messages,nbMessages:e.messages.length,deferLoadNextPageIndex:t};const s=e.messages,o=s.length?s[s.length-1].timestamp:null,a=await this.getChannelMessages(e,o);t+=a.nbMessagesAdded,a.nbMessagesLoaded<b.PAGE_SIZE&&(e.complete=true,t=-1);const c=e.complete?"(Complete)":"(Not complete)";return this.logger.info(`[channelService] getChannelNextPage(${r}, ${e.pageIndex}) -- success from server ${c}`),this.logger.info(`[channelService] getChannelNextPage(${r}, ${e.pageIndex}) -- Message(s):  retrieved ${a.nbMessagesLoaded} - added ${a.nbMessagesAdded} - DeferLoadIndex ${t}`),e.pageIndex+=1,e.loaded=true,e.isLoading=false,{messages:e.messages,nbMessages:e.messages.length,deferLoadNextPageIndex:t}}catch(n){throw e.isLoading=false,this.channelErrorHandler("getChannelNextPage("+r+", "+e.pageIndex+")",n)}}async getMyChannels(){try{const e=this.portalURL+"?format=full",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw this.logger.debug(`Request ${i.headers.get("x-rainbow-request-id")} failed with status ${i.status}`),new Error(i.statusText);return(await i.json()).data.forEach((e=>{const t=n.Channel.create(e);this.updateDisplayInfo(t),t.invited&&this.incrementInvitationCounter(),(t.subscribed||t.invited)&&(this.channels[t.id]=t)})),this.updateChannelsList(),this.attachHandlers(),this.isStarted=true,this.serviceStatusSubject.next(h.RBEvent.create("CHANNEL_SERVICE_STARTED")),this.channelsList}catch(e){throw this.channelErrorHandler("getMyChannels",e)}}async getChannel(e){try{const t=this.portalURL+"/"+e,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw new Error(r.statusText);this.logger.info("[channelService] getChannel -- "+e+" -- success");const s=await r.json(),o=n.Channel.create(s.data);return this.updateDisplayInfo(o),o}catch(t){throw this.channelErrorHandler("getChannel ("+e+")",t)}}getChannelFromCache(e){const t=this.channels[e];return void 0!==t?t:null}async createChannel(e,t,i="",r="globalnews",s=false,o=100){try{const a=this.portalURL+(s?"?auto_provisioning=true":""),c=JSON.stringify({name:e,mode:t,topic:i,category:r,max_items:o}),l=this.authService.getPostHeader(),d=await fetch(a,{method:"POST",headers:l,body:c});if(!d.ok)throw new Error(d.statusText);this.logger.info("[channelService] createChannel -- "+e+" -- "+t+" -- success");const u=await d.json(),h=n.Channel.create(u.data);return this.updateDisplayInfo(h),h}catch(a){throw this.channelErrorHandler("createChannel -- "+e+" -- "+t,a)}}async deleteChannel(e){try{const t=this.portalURL+"/"+e,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"DELETE",headers:i});if(!r.ok)throw new Error(r.statusText);return this.logger.info("[channelService] deleteChannel -- "+e+" -- success"),r}catch(t){throw this.channelErrorHandler("deleteChannel ("+e+")",t)}}async findChannels(e){const t={};e.sortOrder&&1===e.sortOrder?t.sortOrder="1":t.sortOrder="-1",void 0!==e.subscribed&&(t.subscribed=e.subscribed),e.name&&(t.name=e.name),e.topic&&(t.topic=e.topic),e.limit&&(t.limit=e.limit),e.offset&&(t.offset=e.offset),e.sortField&&(t.sortField=e.sortField),e.category&&(t.category=e.category);const i=new URLSearchParams(t).toString();try{const e=new URL(this.portalURL+"/search"),t=this.authService.getRequestHeader();e.search=i;const r=await fetch(e.toString(),{method:"GET",headers:t});if(!r.ok)throw new Error(r.statusText);this.logger.info("[channelService] findChannels ("+i+") -- success");const s=await r.json(),o=[];return s.data.forEach((e=>{const t=n.Channel.create(e);this.updateDisplayInfo(t),o.push(t)})),o}catch(r){throw this.channelErrorHandler("findChannels ("+i+")",r)}}async browseChannels(e){const t={};e.sortOrder&&1===e.sortOrder?t.sortOrder="1":t.sortOrder="-1",e.category&&(t.category=e.category),e.excluded_category&&(t.excluded_category=e.excluded_category),void 0!==e.subscribed&&(t.subscribed=e.subscribed),e.limit&&(t.limit=e.limit),e.offset&&(t.offset=e.offset),e.sortField&&(t.sortField=e.sortField);const i=new URLSearchParams(t).toString();try{const e=new URL(this.portalURL+"/browse"),t=this.authService.getRequestHeader();e.search=i;const r=await fetch(e.toString(),{method:"GET",headers:t});if(!r.ok)throw new Error(r.statusText);this.logger.info("[channelService] browseChannels ("+i+") -- success");const s=await r.json(),o=[];return s.data.forEach((e=>{const t=n.Channel.create(e);this.updateDisplayInfo(t),o.push(t)})),o}catch(r){throw this.channelErrorHandler("browseChannels ("+i+")",r)}}async publishToChannel(e,t,i,r,n,s,o,a){try{const c=this.authService.getPostHeader(),l=t?"?itemId="+t:"",d=this.portalURL+"/"+e+"/publish"+l,u={type:i,title:n||"",message:r||"",images:s||[],attachments:a||[]};o&&(u.video=o);const h=await fetch(d,{method:"POST",headers:c,body:JSON.stringify(u)});if(!h.ok)throw new Error(h.statusText);return this.logger.info("[channelService] publishToChannel -- "+e+" -- "+i+" -- success"),h}catch(c){throw this.channelErrorHandler("publishToChannel ("+e+")",c)}}async subscribeToChannel(e){try{const t=this.portalURL+"/"+e.id+"/subscribe",i=this.authService.getPostHeader(),r=await fetch(t,{method:"POST",headers:i});if(!r.ok)throw new Error(r.statusText);return this.logger.info("[channelService] subscribeToChannel -- "+e.id+" -- success"),e.subscribed=true,e.users_count+=1,e.updateSubject.next(),r}catch(t){throw this.channelErrorHandler("subscribeToChannel ("+e.id+")",t)}}async unsubscribeToChannel(e){try{const t=this.portalURL+"/"+e.id+"/subscribe",i=this.authService.getRequestHeader(),r=await fetch(t,{method:"DELETE",headers:i});if(!r.ok)throw new Error(r.statusText);return this.logger.info("[channelService] unsubscribeToChannel -- success"),e.subscribed=false,e.users_count-=1,e.userRole=this.USER_ROLE.NONE,e.updateSubject.next(),r}catch(t){throw this.channelErrorHandler("unsubscribeToChannel",t)}}async updateChannel(e,t){try{const i=this.portalURL+"/"+e,r=this.authService.getPostHeader(),n=await fetch(i,{method:"PUT",headers:r,body:JSON.stringify(t)});if(!n.ok)throw new Error(n.statusText);const s=await n.json(),o=this.getChannelFromCache(e);return o.name=s.data.name,o.topic=s.data.topic,o.category=s.data.category,this.updateDisplayInfo(o),this.logger.info("[channelService] updateChannel ( "+e+") -- success"),this.eventService.publish(this.CHANNEL_UPDATE_EVENT,this.LIST_EVENT_TYPE.UPDATE,o.id),o.updateSubject.next(),o}catch(i){throw this.channelErrorHandler("updateChannel ("+e+")",i)}}async getChannelItems(e,t,i=null,r=null){try{const n=new URL(`${this.portalURL}/${e}/items`),s=this.authService.getRequestHeader(),o={};o.max=t,i&&null!==i&&(o.before=i),r&&null!==r&&(o.after=r);const a=new URLSearchParams(o).toString();n.search=a;const c=await fetch(n.toString(),{method:"GET",headers:s});if(!c.ok)throw new Error(c.statusText);this.logger.info("[channelService] getChannelItems -- success");const l=await c.json(),d=this.getChannelFromCache(e);return d.messagesCount=l.data.status.count,d.updateSubject.next(),this.chewReceivedItems(l.data.items),l.data.items}catch(n){throw this.channelErrorHandler("getChannelItems ("+e+")",n)}}async deleteChannelItem(e,t){try{const i=this.portalURL+"/"+e+"/items/"+t,r=this.authService.getRequestHeader(),n=await fetch(i,{method:"DELETE",headers:r});if(!n.ok)throw new Error(n.statusText);return void this.logger.info("[channelService] deleteChannelItem ("+e+") -- success")}catch(i){throw this.channelErrorHandler("deleteChannel ("+e+")",i)}}async getChannelUsers(e,t){const i={};t&&(t.format&&"string"==typeof t.format&&t.format.length&&(i.format=t.format),t.limit&&"number"==typeof t.limit&&t.limit>0&&(i.limit=t.limit),t.offset&&"number"==typeof t.offset&&t.offset>0&&(i.offset=t.offset),t.sortField&&"string"==typeof t.sortField&&t.sortField.length&&(i.sortField=t.sortField),!t.sortOrder||"-1"!==t.sortOrder&&"1"!==t.sortOrder||(i.sortOrder=t.sortOrder),t.types&&"string"==typeof t.types&&t.types.length&&(i.types=t.types),t.invited&&"boolean"==typeof t.invited&&(i.invited=t.invited));const r=new URLSearchParams(i).toString();try{const t=new URL(`${this.portalURL}/${e}/users`),i=this.authService.getRequestHeader();t.search=r;const n=await fetch(t.toString(),{method:"GET",headers:i});if(!n.ok)throw new Error(n.statusText);this.logger.info("[channelService] getChannelUsers ("+e+") -- success");return await n.json()}catch(n){throw this.channelErrorHandler("getChannelUsers ("+e+")",n)}}async searchUsersByName(e,t,i){i.displayName=t;try{const t=new URL(`${this.portalURL}/${e}//users/search`),r=this.authService.getRequestHeader(),n=new URLSearchParams(i).toString();t.search=n;const s=await fetch(t.toString(),{method:"GET",headers:r});if(!s.ok)throw new Error(s.statusText);this.logger.info("[channelService] searchUsersByName ("+e+" -- success");return(await s.json()).data}catch(r){throw this.channelErrorHandler("searchUsersByName ("+e+")",r)}}async deleteChannelAvatar(e){try{const t=this.portalURL+"/"+e.id+"/avatar",i=this.authService.getRequestHeader(),r=await fetch(t,{method:"DELETE",headers:i});if(!r.ok)throw new Error(r.statusText);return e.avatar=null,e.lastAvatarUpdateDate=null,e.updateSubject.next(),r}catch(t){throw this.channelErrorHandler("deleteChannelAvatar "+e.id,t)}}async uploadChannelAvatar(e,t,i){try{const r=await p.resizeImage(t,i,i),n=p.getBinaryData(r),s=this.portalURL+"/"+e.id+"/avatar",o=this.authService.getPostHeader("image/"+n.type),a=n.data,c=await fetch(s,{method:"POST",headers:o,body:a});if(!c.ok)throw new Error(c.statusText);const l=await c.json();return this.logger.info("[channelService] uploadChannelAvatar "+e.id+" -- success"),e.avatar=r.src,e.lastAvatarUpdateDate=new Date,e.updateSubject.next(),l}catch(r){throw this.channelErrorHandler("uploadChannelAvatar",r)}}async updateChannelUsers(e,t,i){const r=t.map((e=>({id:e.dbId,type:i})));try{const t=this.portalURL+"/"+e+"/users",i=this.authService.getPostHeader(),n=JSON.stringify({data:r}),s=await fetch(t,{method:"PUT",headers:i,body:n});if(!s.ok)throw new Error(s.statusText);this.logger.info("[channelService] updateChannelUsers -- success");const o=(await s.json()).data;return this.usersUpdateHandler(null,e,o),o}catch(n){throw this.channelErrorHandler("updateChannelUsers",n)}}usersUpdateHandler(e,t,i){const r=this.getChannelFromCache(t);if(null!==i){if(r.users_count+=i.added.length-i.removed.length,r.users.length){for(let e=0;e<i.added.length;e++)this.contactService.getContactByDBId(i.added[e]).then((e=>{r.users.push(e)}));for(let e=0;e<i.removed.length;e++)for(let t=r.users.length-1;t>=0;t--)if(r.users[t].dbId===i.removed[e]){r.users.splice(t,1);break}}if(i.invalidUsers&&i.invalidUsers.length&&"409005"===i.invalidUsers[0].errorDetailsCode){const e=this.i18n.translate("inviteUsersError");this.eventService.publish("GLOBAL_NOTIFY_MESSAGE_EVENT",e)}}this.rxSubject.next(new h.RBEvent("CHANNEL_USERS_UPDATE_EVENT",{channelId:t,users:i}))}async removeAllUsersFromChannel(e){try{const t=this.portalURL+"/"+e+"/users",i=this.authService.getRequestHeader(),r=await fetch(t,{method:"DELETE",headers:i});if(!r.ok)throw new Error(r.statusText);return this.logger.info("[channelService] Removed all users from channel -- success"),this.usersUpdateHandler(null,e,null),r}catch(t){throw this.channelErrorHandler("removeAllUsersFromChannel",t)}}async getPortalInfos(){try{const e=config.restServerUrl+"/api/rainbow/channels/v1.0/about",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw new Error(i.statusText);this.logger.info("[channelService] successfully retrieved portal infos -- success");return await i.json()}catch(e){throw this.channelErrorHandler("getPortalInfos",e)}}async getLatestMessages(e,t=null,i=null){try{const r=new URL(this.portalURL+"/latest-items"),n=this.authService.getRequestHeader(),s={};s.max=e,t&&null!==t&&(s.before=t),i&&null!==i&&(s.after=i);const o=new URLSearchParams(s).toString();r.search=o;const a=await fetch(r.toString(),{method:"GET",headers:n});if(!a.ok)throw new Error(a.statusText);const c=await a.json();return this.chewReceivedItems(c.data.items),c.data.items}catch(r){throw this.channelErrorHandler("getLatestMessages",r)}}async acceptInvitation(e){try{const t=this.portalURL+"/"+e+"/accept",i=this.authService.getRequestHeader(),r=await fetch(t,{method:"PUT",headers:i});if(!r.ok)throw new Error(r.statusText);const n=await r.json();return this.logger.info("[channelService] acceptInvitation ("+e+") -- success"),this.decrementInvitationCounter(),n}catch(t){throw this.channelErrorHandler("acceptInvitation",t)}}async declineInvitation(e){try{const t=this.portalURL+"/"+e+"/decline",i=this.authService.getRequestHeader(),r=await fetch(t,{method:"PUT",headers:i});if(!r.ok)throw new Error(r.statusText);const n=await r.json();return this.logger.info("[channelService] declineInvitation ("+e+") -- success"),n}catch(t){throw this.channelErrorHandler("declineInvitation",t)}}addChannelToCache(e){this.logger.debug("[channelService] addChannelToCache: channelId = "+e.id),this.channels[e.id]=e,this.updateChannelsList()}async removeChannelFromCache(e){const t=this.getChannelFromCache(e);if(t){this.logger.debug(`[channelService] removeChannelFromCache: channelId ${e} found in cache`);const i=t.name;return t.invited&&this.decrementInvitationCounter(),delete this.channels[e],this.updateChannelsList(),this.feedChannel.messages=[],await this.retrieveLatests(),i}return null}removeUnsubscribedChannelFromCache(e){const t=this.getChannelFromCache(e);t?(this.logger.debug(`[channelService]  removeUnsubscribedChannelFromCache: channel ${e} found in cache, subscribed = ${t.subscribed}`),t.subscribed||(delete this.channels[e],this.updateChannelsList())):this.logger.debug(`[channelService]  removeUnsubscribedChannelFromCache: channel ${e} not found in cache`)}async likeChannelItem(e,t,i){try{const r=`${this.portalURL}/${e.id}/items/${t.id}/like`,n=JSON.stringify({appreciation:i}),s=await fetch(r,{method:"POST",headers:this.authService.getPostHeader(),body:n});if(!s.ok)throw new Error(s.statusText);this.logger.info(`[channelService] likeChannelItem ${e.id} ${t.id} -- success`);return(await s.json()).data}catch(r){const e="getChannelItemReactions -- FAILURE -- "+r.message;throw this.logger.error(e),new Error(e)}}async getChannelMessageReactions(e,t){try{let i=`${this.portalURL}/${e.channel.id}/items/${e.id}/likes?limit=400`;t&&(i+="&appreciation="+t);const r=this.authService.getRequestHeader(),n=await fetch(i,{method:"GET",headers:r});if(!n.ok)throw new Error(n.statusText);return(await n.json()).data.items.map((e=>{let t=this.contactService.getContactById(e.id);t||(t=this.contactService.createContact(e.id,e.firstName,e.lastName),t.createTextAvatarImage());let i=e.companyName;return t.jobTitle&&(i=t.jobTitle+" - "+i),{reaction:e.appreciation,contact:t,info:i}}))}catch(i){const e="getChannelItemReactions -- FAILURE -- "+i.message;throw this.logger.error(e),new Error(e)}}incrementMessagesCounter(){this.messageCounter+=1,this.updateNotificationCounter()}decrementMessagesCounter(){this.messageCounter-=1,this.messageCounter<0&&(this.messageCounter=0),this.updateNotificationCounter()}incrementInvitationCounter(){this.invitationCounter+=1,this.updateNotificationCounter()}decrementInvitationCounter(){this.invitationCounter-=1,this.invitationCounter<0&&(this.invitationCounter=0),this.updateNotificationCounter()}ackMessages(){this.messageCounter=0,this.updateNotificationCounter(),this.feedChannel.messages.forEach((e=>{e.isNew=false}))}ackMessage(e){this.feedChannel.messages.forEach((t=>{t.id===e&&(t.isNew=false)})),this.decrementMessagesCounter()}updateNotificationCounter(){this.notificationCounter=this.messageCounter+this.invitationCounter,this.notificationCounter<0&&(this.notificationCounter=0),this.eventService.publish(this.CHANNEL_NOTIFICATION_NUMBER_UPDATED,this.notificationCounter)}getChannelInvitations(){return this.channelsList.filter((e=>!e.deleted&&e.invited))}chewReceivedItems(e){e.forEach((e=>{"urn:xmpp:channels:simple"===e.type&&(e.entry={message:e.message},delete e.message),e.modified=void 0!==e.creation}))}updateChannelsList(){this.channelsList=Object.keys(this.channels).map((e=>this.channels[e]))}updateDisplayInfo(e){e.displayName=f.default(e.name),e.displayTopic=f.default(e.topic)}}b.PAGE_SIZE=10,t.ChannelService=b},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{static create(e,t,i,n){return new r(e,t,i,n)}static createFromThemeColor(e){return new r(e.displayName,e.cssVariableName,e.cssValue,e.configurable)}constructor(e,t,i,r){this.displayName=e,this.cssVariableName=t,this.cssValue=i,this.configurable=r}}t.ThemeColor=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7),n=i(19),s=i(8),o=i(9),a=i(14),c=i(11),l=i(6),d=i(4),u=i(13);class h{static create(){return new h}}t.CalendarRegistrationData=h;class f{}t.AbstractCalendarService=f;class p extends f{constructor(){super(),this.settingsService=n.SettingsService.getInstance(),this.authService=s.AuthService.getInstance(),this.xmppService=o.XmppService.getInstance(),this.profileService=a.ProfileService.getInstance(),this.eventService=c.EventService.getInstance(),this.contactService=l.ContactService.getInstance(),this.logger=d.LoggerService.getInstance(),this.errorHelperService=u.ErrorHelperService.getInstance(),this.eventSubject=new r.Subject,this.subscriptions=[],this.xmppConnectionSubscription=null,this.messageHandlerRef=null,this.calendarPresenceStateListener=null,this.intervalID=null,this.msTeamsSyncFeatureEnabled=false,this.serviceActivated=false,this.msTeamsSyncPresenceActivated=false,this.serviceState=null,this.calendarState={},this.calendarPresenceEnabled=false,this.officeCalendarPresenceEnabled=false,this.googleCalendarPresenceEnabled=false,this.disableCalendarPresencePrompt=false}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.calendarService||(e.rainbow.calendarService=new p),e.rainbow.calendarService}async start(e=null){try{if(this.logger.info(""),this.logger.info("[calendarService] === STARTING ==="),this.conversationService=e,this.logger.info("[calendarService] listen 'out of office' status for roster contacts"),setTimeout((()=>{this.getMailAutoReplyForConversationContacts()}),15e3),this.intervalID=setInterval((()=>{this.updateMailAutoReplyForEachContact()}),9e5),this.officeCalendarPresenceEnabled=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.MSO365_CALENDAR_PRESENCE),this.googleCalendarPresenceEnabled=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.GOOGLE_CALENDAR_PRESENCE),this.msTeamsSyncFeatureEnabled=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.MSO365_TEAMS_PRESENCE),this.calendarPresenceEnabled=this.officeCalendarPresenceEnabled||this.googleCalendarPresenceEnabled,this.logger.info("[calendarService] calendar presence status from profileService: "+this.calendarPresenceEnabled),this.disableCalendarPresencePrompt="true"===this.settingsService.getSetting("disableCalendarPresence"),this.logger.info("[calendarService] calendar presence prompt status from userSettings: "+!this.disableCalendarPresencePrompt),this.logger.info("[calendarService] === STARTED ==="),this.attachHandlers(),this.subscriptions.push(this.xmppService.subscribeToContactEvents((e=>{"ON_CONTACT_PRESENCE_EVENT"===e.name&&this.onCalendarPresenceChange(e.data)}))),this.calendarPresenceEnabled&&!this.contactService.userContact.guestMode){this.xmppConnectionSubscription=this.xmppService.subscribeToConnectionEvents((e=>{this.onConnectionStateChange(e)}));try{await this.getCalendarState(this.contactService.userContact.dbId),"enabled"===this.serviceState&&this.handleEnableState()}catch(t){this.serviceActivated=false,this.serviceState="failed",this.logger.error("[calendarService] === STARTING FAILURE ===  "+t.message)}}this.calendarPresenceStateListener&&this.calendarPresenceStateListener(),this.calendarPresenceStateListener=this.eventService.subscribe("EXIT_CALENDAR_PRESENCE_STATE",(()=>{this.exitCalendarPresenceState()}))}catch(t){this.logger.error("[calendarService] === STARTING FAILURE === "+t.message)}}async stop(){this.logger.info("[calendarService] === STOPPING ==="),this.serviceActivated=false,this.msTeamsSyncPresenceActivated=false,this.calendarState={},this.serviceState=null,this.subscriptions&&this.subscriptions.forEach((e=>{e.unsubscribe()})),this.xmppConnectionSubscription&&this.xmppConnectionSubscription.unsubscribe(),this.messageHandlerRef&&(this.xmppService.deleteHandler(this.messageHandlerRef),this.messageHandlerRef=null),this.intervalID&&clearTimeout(this.intervalID),this.calendarPresenceStateListener&&this.calendarPresenceStateListener(),this.logger.info("[calendarService] === STOPPED ===")}async reconnect(){this.attachHandlers(),this.logger.info("[calendarService] reconnect -- success")}attachHandlers(){this.logger.info("[calendarService] attachHandlers"),this.messageHandlerRef&&(this.xmppService.deleteHandler(this.messageHandlerRef),this.messageHandlerRef=null),this.messageHandlerRef=this.xmppService.addHandler((e=>(this.onUpdateMessageReceived(e),true)),"jabber:iq:configuration","message",null)}async onConnectionStateChange(e){if("ON_XMPP_CONNECTED"===e.name){if(e.data&&"PRESENCE"===e.data.reason)return;this.logger.info("[calendarService] onConnectionStateChange state: "+e.name);try{await this.getCalendarState(),"enabled"===this.serviceState&&this.handleEnableState(),"consent_required"===this.serviceState&&this.handleConsentRequiredState()}catch(t){this.serviceActivated=false,this.serviceState="failed",this.logger.error(`[calendarService] onConnectionStateChange failure on event ${e.name}: ${t.message}`)}}}handleEnableState(){const e=this.calendarState.since?new Date(this.calendarState.since):null,t=this.calendarState.until?new Date(this.calendarState.until):null,i=this.calendarState.busy?"dnd":"online",r=this.calendarState.busy?"busy":"";this.updateContactCalendarPresence(this.contactService.userContact.jid,i,e,t,r,this.contactService.userContact.calendarState.applyCalendarPresence)}async handleConsentRequiredState(){const e=await this.getRegistrationParams(false);this.eventService.publish("ON_OPEN_POPUP","calendar",e)}onUpdateMessageReceived(e){const t=$(e).find("calendar");if(t.length){this.serviceState=t.attr("status");const e=t.attr("provider");this.serviceActivated="enabled"===this.serviceState,this.eventSubject.next({action:"ON_CALENDAR_STATUS_CHANGE",data:this.serviceActivated}),this.logger.info("[calendarService] onUpdateMessageReceived with state: "+this.serviceState),"consent_required"===this.serviceState&&this.handleConsentRequiredState(),this.calendarState||(this.calendarState={}),this.calendarState.provider=e,this.eventSubject.next({action:"ON_CALENDAR_PROVIDER_UPDATE"})}const i=$(e).find("presence");if(i.length&&-1!==$(e).attr("from").indexOf("/presence")){const e=i.attr("status");this.msTeamsSyncPresenceActivated="enabled"===e,this.calendarState||(this.calendarState={}),this.calendarState.provider="office365",this.eventSubject.next({action:"ON_CALENDAR_MSTEAMS_STATUS_CHANGE",data:this.msTeamsSyncPresenceActivated})}}onCalendarPresenceChange(e){if(this.contactService.isTelJid(e.jid)){const t=this.contactService.getImJid(e.jid);t&&"calendar"===this.contactService.getResourceFromJid(e.jid)?(this.logger.info(`[calendarService] onCalendarPresenceChange -- status: ${e.status} -- until: ${e.until} -- message: ${e.message} -- auto dnd: ${e.applyCalendarPresence}`),this.updateContactCalendarPresence(t,e.status,e.since,e.until,e.message,e.applyCalendarPresence)):t&&"presence"===this.contactService.getResourceFromJid(e.jid)&&this.msTeamsSyncFeatureEnabled&&(this.logger.info(`[calendarService] onCalendarPresenceChange MS Teams presence status update for ${t} -- ${e.status} -- ${e.message}`),this.eventService.publish("ON_CONTACT_MSTEAMS_STATUS_CHANGE",t,e.status,e.message))}}async exitCalendarPresenceState(){try{const e=config.restServerUrl+"/api/rainbow/calendar/v1.0/control?ignore=current",t=this.authService.getPostHeader(),i=await fetch(e,{method:"PUT",headers:t});if(!i.ok)throw i;this.logger.info("[calendarService] exitCalendarPresenceState success")}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"exitCalendarPresenceState");throw this.logger.error("[calendarService] exitCalendarPresenceState failure: "+t.error.message),t.error}}getCurrentProvider(){return this.calendarState&&this.calendarState.provider?this.calendarState.provider:""}isCalendarSharingActivated(){return this.logger.info("[calendarService] isCalendarSharingActivated --  "+this.serviceActivated),this.serviceActivated}async getRegistrationParams(e){const t=[];let i=null,r=null;this.logger.info("[calendarService] getRegistrationParams"),this.officeCalendarPresenceEnabled&&t.push(this.getCalendarRegistrationInfo("office365").then((e=>{r=e}))),this.googleCalendarPresenceEnabled&&t.push(this.getCalendarRegistrationInfo("googleCalendar").then((e=>{i=e})));try{await Promise.all(t);const n=h.create();return i||r?(this.logger.info("[calendarService] getRegistrationParams -- At least one calendar is available, show registration popup or tooltip"),n.authentMicrosoftUrl=r,n.authentGoogleUrl=i):this.logger.error("[calendarService] getRegistrationParams -- no reponse from calendar provider "),null!==e&&(n.fromSettings=e),n}catch(n){const e=await this.errorHelperService.getErrorInfo(n,"getRegistrationParams");throw this.logger.error("[calendarService] getRegistrationParams failure -- "+e.error.message),e.error}}async deactivateCalendarSharing(){this.logger.info("[calendarService] deactivateCalendarSharing");try{const e=this.calendarState&&"office365"===this.calendarState.provider,t=config.restServerUrl+"/api/rainbow/calendar/v1.0",i=await fetch(t,{method:"DELETE",headers:this.authService.getRequestHeader()});if(!i.ok)throw i;if(this.logger.info("[calendarService] deactivateCalendarSharing success for user "+this.contactService.userContact.jid),e&&this.msTeamsSyncFeatureEnabled){const e=config.restServerUrl+"/api/rainbow/msteamspresence/v1.0";await fetch(e,{method:"DELETE",headers:this.authService.getRequestHeader()}),this.msTeamsSyncPresenceActivated=false}this.serviceActivated=false,this.eventSubject.next({action:"ON_CALENDAR_STATUS_CHANGE",data:this.serviceActivated})}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"deactivateCalendarSharing");throw this.logger.error("[calendarService] deactivateCalendarSharing failure -- "+t.error.message),t.error}}calendarCancelCallback(){this.logger.info("[calendarService] calendarCancelCallback for user "+this.contactService.userContact.jid),this.serviceActivated=false,this.settingsService.setSetting("disableCalendarPresence","true"),this.contactService.setUserSettings({promptForCalendarPresence:false}),this.eventSubject.next({action:"ON_CALENDAR_STATUS_CHANGE",data:this.serviceActivated})}calendarLaterCallback(){this.logger.info("[calendarService] calendarLaterCallback for user "+this.contactService.userContact.jid),this.serviceActivated=false,this.eventSubject.next({action:"ON_CALENDAR_STATUS_CHANGE",data:false})}async getCalendarState(e=null){this.logger.info("[calendarService] getCalendarState");try{this.msTeamsSyncFeatureEnabled&&this.getMsTeamsStateFromServer()}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getMsTeamsStateFromServer");this.logger.error("[calendarService] getMsTeamsStateFromServer failure -- CalendarService portal not responding: "+e.error.message)}try{const t=await this.getCalendarStateFromServer(e);"busy"===t.status||"free"===t.status||"out_of_office"===t.status?(this.serviceState="enabled",this.calendarState=t,this.logger.info(`[calendarService] getCalendarState success -- Service state: ${this.serviceState}  Calendar status: ${this.calendarState.status}`)):(this.serviceState=t.status,this.calendarState=null,this.logger.info("[calendarService] getCalendarState success -- Service state: "+this.serviceState))}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getCalendarState");throw this.logger.error("[calendarService] getCalendarState failure -- CalendarService portal not responding: "+e.error.message),e.error}}async getMsTeamsStateFromServer(){this.logger.info("[calendarService] getMsTeamsStateFromServer");try{const e=config.restServerUrl+"/api/rainbow/msteamspresence/v1.0",t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=await i.json();return this.logger.info("[calendarService] getMsTeamsStateFromServer success -- Calendar status: "+r.status),this.msTeamsSyncPresenceActivated="disabled"!==r.status&&"none"!==r.status&&"consent_required"!==r.status&&"subscription_error"!==r.status,this.msTeamsSyncPresenceActivated&&(this.calendarState||(this.calendarState={}),this.calendarState.provider="office365"),this.msTeamsSyncPresenceActivated}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getCalendarStateFromServer");throw this.logger.error("[calendarService] getCalendarStateFromServer failure -- CalendarService portal not responding: "+t.error.message),t.error}}async getCalendarStateFromServer(e=null){this.logger.info("[calendarService] getCalendarStateFromServer");try{let t=config.restServerUrl+"/api/rainbow/calendar/v1.0";null!==e&&(t=t+"?userid="+e);const i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;const n=await r.json();return this.logger.info("[calendarService] getCalendarStateFromServer success -- Calendar status: "+n.status),n}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getCalendarStateFromServer");throw this.logger.error("[calendarService] getCalendarStateFromServer failure -- CalendarService portal not responding: "+e.error.message),e.error}}async getCalendarRegistrationInfo(e){let t="o365",i="office365";"googleCalendar"===e&&(t="gcal",i="google");try{const r=this.settingsService.getAppliLanguage().code;let n=config.restServerUrl+"/api/rainbow/calendar/v1.0/register";"office365"===i&&this.msTeamsSyncFeatureEnabled&&(n=config.restServerUrl+"/api/rainbow/office365/v1.0/register");const s=this.authService.getPostHeader(),o=JSON.stringify({type:i,callback:window.location.origin+"/redirectO365.html?provider="+t+"&lang="+r}),a=await fetch(n,{method:"POST",headers:s,body:o});if(!a.ok)throw a;const c=await a.json();return this.logger.info(`[calendarService] getCalendarRegistrationInfo for ${e} -- success`),c.url}catch(r){const e=await this.errorHelperService.getErrorInfo(r,"getCalendarRegistrationInfo");throw this.logger.error("[calendarService] getCalendarRegistrationInfo failure -- "+e.error.message),e.error}}async updateContactCalendarPresence(e,t,i,r,n,s){const o=await this.contactService.getOrCreateContact(e);try{o.calendarState.status=t,o.calendarState.message=n,o.calendarState.applyCalendarPresence=s;let a=null;"online"===t||r||(r=new Date),r&&(a=moment(r)),o.calendarState.mdate=a,a?a.isSame(moment(),"d")?(o.calendarState.until=a.format("LT"),o.calendarState.untilDate=false):(o.calendarState.until=a.format("ll"),o.calendarState.untilDate=true):(r||(r=new Date),o.calendarState.until=r,o.calendarState.untilDate=false),this.contactService.isUserContact(o)?(this.logger.info(`[calendarService] updateContactCalendarPresence for my user with: ${t} until ${r} auto dnd ${s}`),this.serviceActivated||"offline"===t||(this.serviceActivated=true,this.eventSubject.next({action:"ON_CALENDAR_STATUS_CHANGE",data:this.serviceActivated})),this.getContactMailAutoReply(this.contactService.userContact)):this.logger.info(`[calendarService] updateContactCalendarPresence for user ${e} with: ${t} until ${r} auto dnd ${s}`),o.calendarStateRaw.status=t,o.calendarStateRaw.message=n,o.calendarStateRaw.calendarPresenceDND=s,r&&(o.calendarStateRaw.untilDate=r),i&&(o.calendarStateRaw.sinceDate=i),this.eventService.publish("ON_CONTACT_CALENDAR_STATUS_CHANGE",o)}catch(a){this.logger.error(`[calendarService] updateContactCalendarPresence failure for user ${e} with error ${a}`)}}getMailAutoReplyForConversationContacts(){this.logger.info("[calendarService] getMailAutoReplyForConversationContacts"),this.conversationService.getConversations().forEach((e=>{null!==e.contact&&this.getContactMailAutoReply(e.contact)}))}updateMailAutoReplyForEachContact(){this.logger.info("[calendarService] updateMailAutoReplyForEachContact"),this.getContactMailAutoReply(this.contactService.userContact),this.getMailAutoReplyForConversationContacts()}async getContactMailAutoReply(e){this.logger.info("[calendarService] getContactMailAutoReply");try{const t=this.contactService.userContact.company.id;if(!e.company||e.company.id!==t)return;if(!e.calendarState.status)return void this.logger.info(`[calendarService] getContactMailAutoReply user ${e.dbId} has no calendar state`);if(e.calendarState.lastUpdate){const t=moment.duration(e.calendarState.lastUpdate.diff(moment()));if(Math.abs(Math.floor(t.asMinutes()))<15)return void this.logger.info("[calendarService] getContactMailAutoReply state has been updated in the last 15min for user "+e.dbId)}e.calendarState.lastUpdate=moment();const i=config.restServerUrl+"/api/rainbow/calendar/v1.0/automatic_reply?userid="+e.dbId,r=this.authService.getRequestHeader(),n=await fetch(i,{method:"GET",headers:r});if(!n.ok)throw n;const s=await n.json();return this.updateContactMailAutoReply(s,e),void this.logger.info("[calendarService] getContactMailAutoReply success for contact "+e.dbId)}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getContactMailAutoReply");throw this.logger.error("[calendarService] getContactMailAutoReply failure: "+e.error.message),e.error}}updateContactMailAutoReply(e,t){if(this.logger.info(`[calendarService] updateContactMailAutoReply for user ${t.jid} with data enabled ${e.enabled} and date end ${e.end}`),e.enabled){if(t.calendarState.autoReplyOn=true,t.calendarState.autoReplyInfos={},e.message_text&&(t.calendarState.autoReplyInfos.message=e.message_text),e.end){const i=moment(e.end);t.calendarState.autoReplyInfos.mdate=i,i?i.isSame(moment(),"d")?(t.calendarState.autoReplyInfos.until=i.format("LT"),t.calendarState.autoReplyInfos.untilDate=false):(t.calendarState.autoReplyInfos.until=i.format("ll"),t.calendarState.autoReplyInfos.untilDate=true):(t.calendarState.autoReplyInfos.until=e.end,t.calendarState.autoReplyInfos.untilDate=true)}t.calendarStateRaw.autoReplyEnabled=true,t.calendarStateRaw.autoReplyInfos={},e.start&&(t.calendarStateRaw.autoReplyInfos.startDate=e.start),e.end&&(t.calendarStateRaw.autoReplyInfos.endDate=e.end),e.message_html&&(t.calendarStateRaw.autoReplyInfos.messageHtml=e.message_html),e.message_text&&(t.calendarStateRaw.autoReplyInfos.messageText=e.message_text)}else t.calendarState.autoReplyOn=false,t.calendarState.autoReplyInfos={},t.calendarStateRaw.autoReplyEnabled=false,t.calendarStateRaw.autoReplyInfos={};this.eventService.publish("ON_CONTACT_CALENDAR_STATUS_CHANGE",t),this.eventSubject.next({action:"ON_CALENDAR_STATUS_CHANGE",data:this.serviceActivated})}}t.CalendarService=p},function(e,t,i){(function(e){Object.defineProperty(t,"__esModule",{value:true});const r=i(468),n=i(28),s=i(7),o=i(9),a=i(37),c=i(11),l=i(47),d=i(62),u=i(13),h=i(4),f=i(46),p=i(477),g=i(17);class m{constructor(e,t){this.callType="",this.recordingFeature=false,this.conversation=null,this.webrtcCallRef=null,this.isRecorded=false,this.displayRecordTime=null,this.pauseRecord=null,this.recorder=null,this.updateTimer=null,this.actualRecordTime=0,this.durationTimer=null,this.callType=e,this.recordingFeature=t}static create(e,t){return new m(e,t)}getWebrtcCallRef(){return this.webrtcCallRef}setWebrtcCallRef(e){this.webrtcCallRef=e}getConversation(){return this.conversation}setConversation(e){this.conversation=e}}t.CallAreaRecordContext=m;class v{}t.AbstractWebrtcP2PRecordingService=v;class S extends v{constructor(){super(),this.started=false,this.recording=false,this.upload=false,this.filename="",this.recordStopOrigin="LOCAL",this.xmppService=o.XmppService.getInstance(),this.fileStorageService=a.FileStorageService.getInstance(),this.eventService=c.EventService.getInstance(),this.fileServerService=l.FileServerService.getInstance(),this.conversationService=d.ConversationService.getInstance(),this.errorHelperService=u.ErrorHelperService.getInstance(),this.logger=h.LoggerService.getInstance(),this.i18n=f.I18nService.getInstance(),this.centralizedService=null,this.mainService=g.MainService.getInstance(),this.ringingService=p.RingingService.getInstance(),this.durationTimer=null,this.metadataBuf=new ArrayBuffer(0),this.last_duration=0,this.clusterPtrs=[],this.recordedStartedEvent=null,this.conversationEndedEvent=null,this.tempUploadedFileDescriptor=null}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.webrtcP2PRecordingService||(e.rainbow.webrtcP2PRecordingService=new S),e.rainbow.webrtcP2PRecordingService}async start(){this.started=false,this.recording=false,this.recorder=null,this.chunk=null,this.writeStream=null,this.data=new Blob([],{type:"video/webm"}),this.audioContext=null,this.recordFile=null,this.logger.info("[WebrtcP2PRecordingService] === STARTING ==="),this.centralizedService=this.mainService.inject("centralizedService"),this.decoder=new r.Decoder,this.initConversationRecordContext(),this.startListeners(),this.started=true,this.logger.info("[WebrtcP2PRecordingService] === STARTED ===")}async stop(){this.logger.info("[WebrtcP2PRecordingService] === STOPPING ==="),this.started&&(this.started=false),this.recordedStartedEvent&&(this.recordedStartedEvent(),this.recordedStartedEvent=null),this.conversationEndedEvent&&(this.conversationEndedEvent(),this.conversationEndedEvent=null),this.logger.info("[WebrtcP2PRecordingService] === STOPPED ===")}startListeners(){this.recordedStartedEvent&&(this.recordedStartedEvent(),this.recordedStartedEvent=null),this.recordedStartedEvent=this.eventService.subscribe("ON_RECORDING_START_MSG_RECEIVED",(()=>{this.ringingService.playRecordTone()})),this.conversationEndedEvent&&(this.conversationEndedEvent(),this.conversationEndedEvent=null),this.conversationEndedEvent=this.eventService.subscribe("ON_CONVERSATION_CALL_UPDATED_EVENT",((e,t)=>{this.conversationRecordContext&&t.conversation&&this.conversationRecordContext.conversationId===t.conversation.id?t.conversation.videoCall&&"Unknown"===t.conversation.videoCall.status.value&&(this.setRecordStopOrigin("LOCAL"),this.stopRecording(),this.conversationService.sendRecordingMessage(t.conversation,"stop")):this.conversationRecordContext&&t.call&&this.conversationRecordContext.conversationId===t.call.conversationId&&"Unknown"===t.call.status.value&&(this.setRecordStopOrigin("LOCAL"),this.stopRecording())}))}getConversationRecordContext(e){return e===this.conversationRecordContext.conversationId?this.conversationRecordContext:null}setConversationRecordContext(e,t,i,r,n){e&&""!==e&&(this.conversationRecordContext.conversationId=e,this.conversationRecordContext.recorder=t&&this.recording,this.conversationRecordContext.pause=i,this.conversationRecordContext.actualRecordTime=r,this.conversationRecordContext.recordStopSource=n)}canRecord(){try{return!!MediaRecorder}catch(e){return false}}createRecord(e,t,i="REMOTE",n=false,s="",o=false,a){let c=null,l=null,d=null,u=null,h=null,f=null;const p=[];this.recorder=null,this.upload=n,this.filename=s;let g=false,m=null,v=null,S=null;const b="safari"===adapter.default.browserDetails.browser,y="firefox"===adapter.default.browserDetails.browser;if(this.decoder=new r.Decoder,this.data=new Blob([],{type:"video/webm"}),b&&(a="audio/wave"),a&&MediaRecorder.isTypeSupported(a)?c={mimeType:a}:o?MediaRecorder.isTypeSupported("audio/webm")&&(c={mimeType:"audio/webm"}):MediaRecorder.isTypeSupported("video/webm;codecs=vp8")?c={mimeType:"video/webm; codecs=vp8"}:MediaRecorder.isTypeSupported("video/webm;codecs=vp9")?c={mimeType:"video/webm; codecs=vp9"}:MediaRecorder.isTypeSupported("video/webm;codecs=h264")?c={mimeType:"video/webm; codecs=h264"}:MediaRecorder.isTypeSupported("video/mpeg")&&(c={mimeType:"video/mpeg"}),y&&(c={}),null===c)return this.logger.error("[WebrtcP2PRecordingService] Codecs : "+a+" are not available for the navigator"),false;{this.logger.info("[WebrtcP2PRecordingService] createRecord -- mimeType used "+c.mimeType);let r=null;if(e){if(r=this.xmppService.connection.jingle.sessions[e],r&&(l=this.xmppService.connection.jingle.sessions[e].localStreams,r.remoteStreams&&r.remoteStreams.length?d=r.remoteStreams:r.remoteStreams&&r.remoteStreams.length||!r.remoteStreamsObject||(d=Object.values(r.remoteStreamsObject))),t){const e=this.xmppService.connection.jingle.sessions[t];l=l?l.concat(this.xmppService.connection.jingle.sessions[t].localStreams):this.xmppService.connection.jingle.sessions[t].localStreams,e.remoteStream&&e.remoteStreams.length?d=d?d.concat(e.remoteStreams):e.remoteStreams:e.remoteStreams&&e.remoteStreams.length||!e.remoteStreamsObject||(d=d?d.concat(Object.values(e.remoteStreamsObject)):Object.values(e.remoteStreamsObject))}}else{if(!t)return this.logger.error("[WebrtcP2PRecordingService] no callId"),false;r=this.xmppService.connection.jingle.sessions[t],l=this.xmppService.connection.jingle.sessions[t].localStreams,r.remoteStream&&r.remoteStreams.length?d=r.remoteStreams:r.remoteStreams&&r.remoteStreams.length||!r.remoteStreamsObject||(d=Object.values(r.remoteStreamsObject))}if(g=l&&l.length&&null!==l[0]||d&&d.length&&null!==d[0],null!==this.recorder||!g)return this.logger.error("[WebrtcP2PRecordingService] Cannot get Stream"),false;{let e,t=null;for(e=0;e<d.length;e++)d[e]&&null!==d[e]&&(t=e,d[e].getAudioTracks().forEach((i=>{p.push(i),S=e,t=null})),null!==t&&(v=t));for(t=null,e=0;e<l.length;e++)l[e]&&null!==l[e]&&(t=e,l[e].getAudioTracks().forEach((e=>{p.push(e),t=null})),null!==t&&(m=t));if(this.audioContext&&(this.logger.error("[WebrtcP2PRecordingService] anomaly audio Context not previously released"),this.closeAudioContext()),p.length)if(b)f=new MediaStream,p.forEach((e=>{f.addTrack(e)}));else{this.audioContext=new AudioContext;const e=p.map((e=>this.audioContext.createMediaStreamSource(new MediaStream([e])))),t=this.audioContext.createMediaStreamDestination();e.forEach((e=>e.connect(t))),f=t.stream}if(!o&&!b)if(h=new MediaStream,"LOCAL"===i&&null!==m){l[m].getVideoTracks().forEach((e=>{h.addTrack(e)}))}else null!==v?d[v].getVideoTracks().forEach((e=>{h.addTrack(e)})):d[S].getVideoTracks().forEach((e=>{h.addTrack(e)}));u=f&&h?new MediaStream([...f.getTracks(),...h.getTracks()]):f&&!h?f:h,this.centralizedService&&this.centralizedService.fileSystem&&this.centralizedService.fileSystem.createWriteStream&&this.centralizedService.fileSystem.unlink&&(this.fullFileName=this.centralizedService.fileSaver.getFolderPath()+"/"+s,this.centralizedService.fileSystem.createWriteStream(this.fullFileName+".temp").then((e=>{this.writeStream=e,this.writeStream.on("error",(()=>{this.logger.error("[WebrtcP2PRecordingService] WriteStream error event")})),this.writeStream.on("drain",(()=>{this.logger.info("[WebrtcP2PRecordingService] WriteStream drain event")}))}))),b?(this.recorder=new MediaRecorder(u),this.recorder.addEventListener("dataavailable",function(e){this.onCreateFileFromBlobForSafari(e.data)}.bind(this)),this.recorder.onstop=this.onStop.bind(this),this.recorder.onerror=this.onError.bind(this)):(this.recorder=new MediaRecorder(u,c),this.recorder.ondataavailable=this.onDataAvailable.bind(this),this.recorder.onstop=this.onStop.bind(this),this.recorder.onerror=this.onError.bind(this))}}return true}setRecordStopOrigin(e){e&&""!==e&&(this.recordStopOrigin=e)}startRecording(e){null!==this.recorder&&(e?this.recorder.start(e):this.recorder.start(),this.recording=true,this.startConvTimer(),this.eventService.publish("ON_USER_START_RECORDING"))}stopRecording(){null!==this.recorder&&(this.recorder.stop(),this.recording=false,this.closeAudioContext()),this.stopConvTimer(),this.initConversationRecordContext(),this.eventService.publish("ON_USER_STOP_RECORDING")}pauseResumeRecording(){null!==this.recorder&&("recording"===this.recorder.state?(this.recorder.pause(),this.conversationRecordContext.pause=true,this.stopConvTimer()):(this.recorder.resume(),this.conversationRecordContext.pause=false,this.startConvTimer()),this.eventService.publish("ON_USER_PAUSE_OR_RESUME_RECORDING"))}pauseRecording(){null!==this.recorder&&"recording"===this.recorder.state&&(this.recorder.pause(),this.conversationRecordContext.pause=true,this.stopConvTimer(),this.eventService.publish("ON_USER_PAUSE_OR_RESUME_RECORDING"))}pauseOrResumeRecording(e){e.recorder&&this.pauseResumeRecording()}startRecord(e){if(!e.recorder){e.recorder=true;const t=e.conversation;let i,r=null,s=null;if("PHONE_MP"===e.callType){const t=e.getConversation().contact;i="conv_"+t.firstname.substr(0,1)+"_"+t.lastname+"_"+moment().format("DD-MM-YYYY_H_mm_ss")+".mp4"}else i="conv_"+t.contact.firstname.substr(0,1)+"_"+t.contact.lastname+"_"+moment().format("DD-MM-YYYY_H_mm_ss")+".mp4";const o=t.videoCall.localMedia&n.Call.Media.SHARING?"LOCAL":"REMOTE";if(t.videoCall&&t.videoCall.id&&(r=t.videoCall.id),e.webrtcCallRef&&e.webrtcCallRef.id&&(s=e.webrtcCallRef.id),!r&&!s)return void(e.recorder=false);this.createRecord(r,s,o,true,i)?(this.startRecording(),this.setConversationRecordContext(t.id,e.recorder,false,0,"LOCAL"),this.conversationService.sendRecordingMessage(t,"start")):e.recorder=false}}stopRecord(e,t,i="LOCAL"){e.recorder&&(this.setRecordStopOrigin(i),this.stopRecording(),e.recorder=false,e.displayRecordTime=null,e.updateTimer&&(this.stopRecordTimer(e),e.updateTimer=null),this.conversationService.sendRecordingMessage(e.conversation,"stop"))}manageActiveRecorder(e){if(!e.updateTimer){this.setOnPauseCallback((()=>{this.handleRecordPauseResume(e)})),this.setOnResumeCallback((()=>{this.handleRecordPauseResume(e)}));const t=this.getConversationRecordContext(e.conversation.id);t&&t.recorder&&(e.pauseRecord=t.pause,e.actualRecordTime=t.actualRecordTime,e.updateTimer=null,e.pauseRecord||this.initRecordTimer(e),e.displayRecordTime=this.getDurationTime(e.actualRecordTime))}}downloadFile(e,t,i,r,n){this.logger.info("[WebrtcP2PRecordingService] downloadFile -- default function"),this.centralizedService&&this.centralizedService.fileSaver&&this.centralizedService.fileSaver.fileDownload(e,t,i,r,n)}async uploadFile(){try{const t=this.updatedBlob?this.updatedBlob:this.data,i=this.recordFile;if(false!==this.recording)throw this.logger.error("[WebrtcP2PRecordingService] uploadFile -- Unexpected uploading file when recording not stopped"),new Error("[WebrtcP2PRecordingService] uploadFile -- Recording not stopped pb");if(0===i.size)throw this.logger.error("[WebrtcP2PRecordingService] uploadFile -- Error uploading empty file"),new Error("[WebrtcP2PRecordingService] uploadFile -- Empty file pb");try{const e=await this.fileStorageService.createFileDescriptor(i);return await this.fileServerService.uploadAFileByChunk(e,t),this.logger.info("[WebrtcP2PRecordingService] uploadFile success"),void this.cleanRecord()}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"createBackupFile");throw this.logger.error("[WebrtcP2PRecordingService] createBackupFile -- Unexpected error while creating file descriptor/uploading file -- "+e),t.error}}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"uploadFile");throw this.logger.error("[WebrtcP2PRecordingService] uploadFile -- Unexpected error while uploading file -- "+t),e.error}}localSaveFile(){const e=this.updatedBlob?this.updatedBlob:this.data,t=this.recordFile;false===this.recording?(this.downloadFile(e,null,null,t.name,true),this.cleanRecord()):this.logger.error("[WebrtcP2PRecordingService] Unexpected file local storage when recording not stopped")}async createBackupFile(){try{const t=this.data,i=this.recordFile;if(false!==this.recording)throw this.logger.error("[WebrtcP2PRecordingService] createBackupFile -- Unexpected backup file when recording not stopped"),new Error("[WebrtcP2PRecordingService] createBackupFile -- Recording not stopped pb");if(0===i.size)throw this.logger.error("[WebrtcP2PRecordingService] createBackupFile -- Error backing-up empty file"),new Error("[WebrtcP2PRecordingService] createBackupFile -- Empty file pb");try{const e=await this.fileStorageService.createFileDescriptor(i);return await this.fileServerService.uploadAFileByChunk(e,t),this.logger.info("[WebrtcP2PRecordingService] createBackupFile success"),e}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"createBackupFile");throw this.logger.error("[WebrtcP2PRecordingService] createBackupFile -- Unexpected error while creating file descriptor/uploading file -- "+e),t.error}}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"createBackupFile");throw this.logger.error("[WebrtcP2PRecordingService] createBackupFile -- Unexpected error -- "+t),e.error}}setOnDataAvailableCallback(e){null!==this.recorder&&(this.recorder.ondataavailable=e)}setOnErrorCallback(e){null!==this.recorder&&(this.recorder.onerror=e)}setOnPauseCallback(e){null!==this.recorder&&(this.recorder.onpause=e)}setOnResumeCallback(e){null!==this.recorder&&(this.recorder.onresume=e)}setOnStartCallback(e){null!==this.recorder&&(this.recorder.onstart=e)}setOnStopCallback(e){null!==this.recorder&&(this.recorder.onstop=e)}initConversationRecordContext(){this.conversationRecordContext={conversationId:"",recorder:false,pause:false,actualRecordTime:0,updateTimer:null,recordStopSource:"LOCAL"}}async onDataAvailable(t){if(this.logger.info("[WebrtcP2PRecordingService] onDataAvailable: size = "+t.data.size),t.data.size>0){if(this.chunk=t.data,this.writeStream){this.writeStream.on("finish",(()=>{this.logger.info("[WebrtcP2PRecordingService] WriteStream finish event")}));const t=await this.chunk.arrayBuffer(),i=e.from(t),r=this.writeStream.write(i);this.writeStream.end(),this.logger.info("[WebrtcP2PRecordingService] write result = "+r)}this.data=new Blob([this.data,this.chunk],{type:this.chunk.type}),this.chunk=null}}async onStop(){this.durationTimer=s.interval(1e3).subscribe((async()=>{if(this.logger.info("[WebrtcP2PRecordingService] On stop recording"),this.durationTimer.unsubscribe(),this.durationTimer=null,this.data&&this.data.size>1e7){const e=this.i18n.translate("recordingInProgress");this.eventService.publish("GLOBAL_NOTIFY_MESSAGE_EVENT",e)}if(this.writeStream)this.durationTimer=s.interval(3e3).subscribe((async()=>{this.logger.info("[WebrtcP2PRecordingService] Destroy WriteStream"),this.writeStream.destroy(),this.writeStream=null,this.durationTimer.unsubscribe(),this.durationTimer=null,this.updatedBlob=await this.injectMetadata(this.data),this.onStopCreateFileFromBlob(this.updatedBlob)}));else if(navigator.mediaDevices.getUserMedia&&window.mozRTCPeerConnection)this.onStopCreateFileFromBlob(this.data);else if(navigator.mediaDevices.getUserMedia&&window.webkitRTCPeerConnection){this.logger.info("[WebrtcP2PRecordingService] On stop recording for Chrome with size "+this.data.size),this.recordFile={name:this.filename,extension:"mp4",size:this.data.size};try{this.tempUploadedFileDescriptor=await this.createBackupFile(),this.logger.info("[WebrtcP2PRecordingService] backup created"),this.updatedBlob=await this.injectMetadata(this.data),this.onStopCreateFileFromBlob(this.updatedBlob)}catch(e){this.updatedBlob=await this.injectMetadata(this.data),this.onStopCreateFileFromBlob(this.updatedBlob)}}}))}onCreateFileFromBlobForSafari(e){this.updatedBlob=e,this.logger.info("[WebrtcP2PRecordingService] onCreateFileFromBlobForSafari -- Size of updatedBlob : "+e.size),this.filename=this.filename.replace("mp4","wav"),this.recordFile={name:this.filename,extension:"wav",size:e.size},this.recording=false,this.recorder=null,this.chunk=null,this.eventService.publish("ON_OPEN_RECORDINGFILESTORAGE_POPUP",this.recordFile,this.recordStopOrigin),this.eventService.publish("ON_WEBRTC_RECORD_SAVED",this.recordFile,e,this.recordStopOrigin),this.recordStopOrigin="LOCAL"}onStopCreateFileFromBlob(e){this.logger.info("[WebrtcP2PRecordingService] onStopCreateFileFromBlob -- Size of updatedBlob : "+e.size),this.recordFile={name:this.filename,extension:"mp4",size:e.size},this.centralizedService&&this.centralizedService.fileSystem&&this.centralizedService.fileSystem.unlink&&this.centralizedService.fileSystem.unlink(this.fullFileName+".temp"),this.tempUploadedFileDescriptor&&(this.fileStorageService.deleteFileDescriptor(this.tempUploadedFileDescriptor.id),this.tempUploadedFileDescriptor=null),this.recording=false,this.recorder=null,this.chunk=null,this.eventService.publish("ON_OPEN_RECORDINGFILESTORAGE_POPUP",this.recordFile,this.recordStopOrigin),this.eventService.publish("ON_WEBRTC_RECORD_SAVED",this.recordFile,e,this.recordStopOrigin),this.recordStopOrigin="LOCAL"}readAsArrayBuffer(e){return new Promise(((t,i)=>{const r=new FileReader;r.readAsArrayBuffer(e),r.onloadend=()=>{t(r.result)},r.onerror=()=>{i()}}))}async injectMetadata(e){this.logger.info("[WebrtcP2PRecordingService] injectMetadata");const t=e.type,i=await this.readAsArrayBuffer(e);return e=null,this.data=null,this.injectMetadataFromArrayBuffer(i,t)}injectMetadataFromArrayBuffer(e,t){this.logger.info("[WebrtcP2PRecordingService] injectMetadataFromArrayBuffer");const i=new r.Decoder,n=new r.Reader;n.logging=false,n.drop_default_duration=false;i.decode(e).forEach((e=>{n.read(e)})),n.stop();const s=r.tools.makeMetadataSeekable(n.metadatas,n.duration,n.cues),o=e.slice(n.metadataSize);return new Blob([s,o],{type:t})}closeAudioContext(){this.audioContext&&(this.audioContext.destination&&this.audioContext.destination.disconnect(),"closed"!==this.audioContext.state&&(this.audioContext.close(),this.audioContext=null))}cleanRecord(){false!==this.recording?this.logger.error("[WebrtcP2PRecordingService] Unexpected record cleaning while recording not stopped"):(this.updatedBlob=null,this.recordFile=null,this.data=null)}onError(e){this.logger.error("[WebrtcP2PRecordingService] error : "+e.message||false),this.recording=false,this.stopConvTimer(),this.eventService.publish("ON_WEBRTC_RECORD_ERROR")}startConvTimer(){this.conversationRecordContext.updateTimer=setInterval((()=>{this.conversationRecordContext.actualRecordTime++}),1e3)}stopConvTimer(){null!==this.conversationRecordContext.updateTimer&&(clearTimeout(this.conversationRecordContext.updateTimer),this.conversationRecordContext.updateTimer=null)}initRecordTimer(e){e.updateTimer=setInterval((()=>{e.actualRecordTime++,e.displayRecordTime=this.getDurationTime(e.actualRecordTime)}),1e3)}stopRecordTimer(e){null!==e.updateTimer&&(clearTimeout(e.updateTimer),e.updateTimer=null)}getDurationTime(e){if(!e)return"";let t=e;const i={};return i.hour=Math.trunc(t/3600),t-=3600*i.hour,i.minute=Math.trunc(t/60),t-=60*i.minute,i.seconde=t,0===i.hour?moment(i.minute+":"+i.seconde,"mm:ss").format("mm:ss"):moment(i.hour+":"+i.minute+":"+i.seconde,"HH:mm:ss").format("HH:mm:ss")}handleRecordPauseResume(e){const t=this.getConversationRecordContext(e.conversation.id);e.recorder&&t&&(e.pauseRecord=t.pause,e.pauseRecord?(clearTimeout(e.updateTimer),e.updateTimer=null):e.updateTimer||this.initRecordTimer(e))}}t.WebrtcP2PRecordingService=S}).call(this,i(97).Buffer)},function(e,t,i){(function(e){!function(t){var i,r=void 0!==e&&e,n="undefined"!=typeof Uint8Array&&Uint8Array,s="undefined"!=typeof ArrayBuffer&&ArrayBuffer,o=[0,0,0,0,0,0,0,0],a=Array.isArray||function(e){return!!e&&"[object Array]"==Object.prototype.toString.call(e)},c=4294967296;function l(e,a,l){var y=a?0:4,C=a?4:0,w=a?0:3,_=a?1:2,E=a?2:1,T=a?3:0,I=a?m:S,P=a?v:b,A=R.prototype,M="is"+e,D="_"+M;return A.buffer=void 0,A.offset=0,A[D]=true,A.toNumber=O,A.toString=function(e){var t=this.buffer,i=this.offset,r=x(t,i+y),n=x(t,i+C),s="",o=!l&&2147483648&r;o&&(r=~r,n=c-n);e=e||10;for(;;){var a=r%e*c+n;if(r=Math.floor(r/e),n=Math.floor(a/e),s=(a%e).toString(e)+s,!r&&!n)break}o&&(s="-"+s);return s},A.toJSON=O,A.toArray=d,r&&(A.toBuffer=u),n&&(A.toArrayBuffer=h),R[M]=function(e){return!(!e||!e[D])},t[e]=R,R;function R(e,t,r,a){return this instanceof R?function(e,t,r,a,l){n&&s&&(t instanceof s&&(t=new n(t)),a instanceof s&&(a=new n(a)));if(!(t||r||a||i))return void(e.buffer=g(o,0));if(!f(t,r)){l=r,a=t,r=0,t=new(i||Array)(8)}if(e.buffer=t,e.offset=r|=0,void 0===a)return;"string"==typeof a?function(e,t,i,r){var n=0,s=i.length,o=0,a=0;"-"===i[0]&&n++;var l=n;for(;n<s;){var d=parseInt(i[n++],r);if(!(d>=0))break;a=a*r+d,o=o*r+Math.floor(a/c),a%=c}l&&(o=~o,a?a=c-a:o++);N(e,t+y,o),N(e,t+C,a)}(t,r,a,l||10):f(a,l)?p(t,r,a,l):"number"==typeof l?(N(t,r+y,a),N(t,r+C,l)):a>0?I(t,r,a):a<0?P(t,r,a):p(t,r,o,0)}(this,e,t,r,a):new R(e,t,r,a)}function O(){var e=this.buffer,t=this.offset,i=x(e,t+y),r=x(e,t+C);return l||(i|=0),i?i*c+r:r}function N(e,t,i){e[t+T]=255&i,i>>=8,e[t+E]=255&i,i>>=8,e[t+_]=255&i,i>>=8,e[t+w]=255&i}function x(e,t){return 16777216*e[t+w]+(e[t+_]<<16)+(e[t+E]<<8)+e[t+T]}}function d(e){var t=this.buffer,r=this.offset;return i=null,false!==e&&0===r&&8===t.length&&a(t)?t:g(t,r)}function u(t){var n=this.buffer,s=this.offset;if(i=r,false!==t&&0===s&&8===n.length&&e.isBuffer(n))return n;var o=new r(8);return p(o,0,n,s),o}function h(e){var t=this.buffer,r=this.offset,o=t.buffer;if(i=n,false!==e&&0===r&&o instanceof s&&8===o.byteLength)return o;var a=new n(8);return p(a,0,t,r),a.buffer}function f(e,t){var i=e&&e.length;return t|=0,i&&t+8<=i&&"string"!=typeof e[t]}function p(e,t,i,r){t|=0,r|=0;for(var n=0;n<8;n++)e[t++]=255&i[r++]}function g(e,t){return Array.prototype.slice.call(e,t,t+8)}function m(e,t,i){for(var r=t+8;r>t;)e[--r]=255&i,i/=256}function v(e,t,i){var r=t+8;for(i++;r>t;)e[--r]=255&-i^255,i/=256}function S(e,t,i){for(var r=t+8;t<r;)e[t++]=255&i,i/=256}function b(e,t,i){var r=t+8;for(i++;t<r;)e[t++]=255&-i^255,i/=256}l("Uint64BE",true,true),l("Int64BE",true,false),l("Uint64LE",false,true),l("Int64LE",false,false)}("string"!=typeof t.nodeName?t:this||{})}).call(this,i(97).Buffer)},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});var r=i(80),n=i(80),s=i(326).byEbmlID,o=function(){function e(){this._schema=s,this._buffers=[],this._stack=[]}return e.prototype.encode=function(e){var t=this;return r.concat(e.reduce((function(e,i){return e.concat(t.encodeChunk(i))}),[])).buffer},e.prototype.encodeChunk=function(e){return"m"===e.type?e.isEnd?this.endTag(e):this.startTag(e):this.writeTag(e),this.flush()},e.prototype.flush=function(){var e=this._buffers;return this._buffers=[],e},e.prototype.getSchemaInfo=function(e){for(var t=Object.keys(this._schema).map(Number),i=0;i<t.length;i++){var r=t[i];if(this._schema[r].name===e)return new n.Buffer(r.toString(16),"hex")}return null},e.prototype.writeTag=function(e){var t=e.name,i=this.getSchemaInfo(t),n=e.data;if(null==i)throw new Error("No schema entry found for "+t);var s=r.encodeTag(i,n);this._stack.length>0?this._stack[this._stack.length-1].children.push({tagId:i,elm:e,children:[],data:s}):this._buffers=this._buffers.concat(s)},e.prototype.startTag=function(e){var t=e.name,i=this.getSchemaInfo(t);if(null==i)throw new Error("No schema entry found for "+t);if(e.unknownSize){var s=r.encodeTag(i,new n.Buffer(0),e.unknownSize);this._buffers=this._buffers.concat(s)}else{var o={tagId:i,elm:e,children:[],data:null};this._stack.length>0&&this._stack[this._stack.length-1].children.push(o),this._stack.push(o)}},e.prototype.endTag=function(e){e.name;var t=this._stack.pop();if(null==t)throw new Error("EBML structure is broken");if(t.elm.name!==e.name)throw new Error("EBML structure is broken");var i=t.children.reduce((function(e,t){if(null===t.data)throw new Error("EBML structure is broken");return e.concat(t.data)}),[]),n=r.concat(i);"m"===t.elm.type?t.data=r.encodeTag(t.tagId,n,t.elm.unknownSize):t.data=r.encodeTag(t.tagId,n),this._stack.length<1&&(this._buffers=this._buffers.concat(t.data))},e}();t.default=o},function(e,t,i){var r={128:{name:"ChapterDisplay",level:4,type:"m",multiple:true,minver:1,webm:true,description:"Contains all possible strings to use for the chapter display."},131:{name:"TrackType",level:3,type:"u",mandatory:true,minver:1,range:"1-254",description:"A set of track types coded on 8 bits (1: video, 2: audio, 3: complex, 0x10: logo, 0x11: subtitle, 0x12: buttons, 0x20: control)."},133:{name:"ChapString",cppname:"ChapterString",level:5,type:"8",mandatory:true,minver:1,webm:true,description:"Contains the string to use as the chapter atom."},134:{name:"CodecID",level:3,type:"s",mandatory:true,minver:1,description:"An ID corresponding to the codec, see the codec page for more info."},136:{name:"FlagDefault",cppname:"TrackFlagDefault",level:3,type:"u",mandatory:true,minver:1,default:1,range:"0-1",description:"Set if that track (audio, video or subs) SHOULD be active if no language found matches the user preference. (1 bit)"},137:{name:"ChapterTrackNumber",level:5,type:"u",mandatory:true,multiple:true,minver:1,webm:false,range:"not 0",description:"UID of the Track to apply this chapter too. In the absense of a control track, choosing this chapter will select the listed Tracks and deselect unlisted tracks. Absense of this element indicates that the Chapter should be applied to any currently used Tracks."},145:{name:"ChapterTimeStart",level:4,type:"u",mandatory:true,minver:1,webm:true,description:"Timestamp of the start of Chapter (not scaled)."},146:{name:"ChapterTimeEnd",level:4,type:"u",minver:1,webm:false,description:"Timestamp of the end of Chapter (timestamp excluded, not scaled)."},150:{name:"CueRefTime",level:5,type:"u",mandatory:true,minver:2,webm:false,description:"Timestamp of the referenced Block."},151:{name:"CueRefCluster",level:5,type:"u",mandatory:true,webm:false,description:"The Position of the Cluster containing the referenced Block."},152:{name:"ChapterFlagHidden",level:4,type:"u",mandatory:true,minver:1,webm:false,default:0,range:"0-1",description:"If a chapter is hidden (1), it should not be available to the user interface (but still to Control Tracks; see flag notes). (1 bit)"},16980:{name:"ContentCompAlgo",level:6,type:"u",mandatory:true,minver:1,webm:false,default:0,description:"The compression algorithm used. Algorithms that have been specified so far are: 0 - zlib,   3 - Header Stripping"},16981:{name:"ContentCompSettings",level:6,type:"b",minver:1,webm:false,description:"Settings that might be needed by the decompressor. For Header Stripping (ContentCompAlgo=3), the bytes that were removed from the beggining of each frames of the track."},17026:{name:"DocType",level:1,type:"s",mandatory:true,default:"matroska",minver:1,description:"A string that describes the type of document that follows this EBML header. 'matroska' in our case or 'webm' for webm files."},17029:{name:"DocTypeReadVersion",level:1,type:"u",mandatory:true,default:1,minver:1,description:"The minimum DocType version an interpreter has to support to read this file."},17030:{name:"EBMLVersion",level:1,type:"u",mandatory:true,default:1,minver:1,description:"The version of EBML parser used to create the file."},17031:{name:"DocTypeVersion",level:1,type:"u",mandatory:true,default:1,minver:1,description:"The version of DocType interpreter used to create the file."},17476:{name:"SegmentFamily",level:2,type:"b",multiple:true,minver:1,webm:false,bytesize:16,description:"A randomly generated unique ID that all segments related to each other must use (128 bits)."},17505:{name:"DateUTC",level:2,type:"d",minver:1,description:"Date of the origin of timestamp (value 0), i.e. production date."},17540:{name:"TagDefault",level:4,type:"u",mandatory:true,minver:1,webm:false,default:1,range:"0-1",description:"Indication to know if this is the default/original language to use for the given tag. (1 bit)"},17541:{name:"TagBinary",level:4,type:"b",minver:1,webm:false,description:"The values of the Tag if it is binary. Note that this cannot be used in the same SimpleTag as TagString."},17543:{name:"TagString",level:4,type:"8",minver:1,webm:false,description:"The value of the Element."},17545:{name:"Duration",level:2,type:"f",minver:1,range:"> 0",description:"Duration of the segment (based on TimecodeScale)."},17816:{name:"ChapterFlagEnabled",level:4,type:"u",mandatory:true,minver:1,webm:false,default:1,range:"0-1",description:"Specify wether the chapter is enabled. It can be enabled/disabled by a Control Track. When disabled, the movie should skip all the content between the TimeStart and TimeEnd of this chapter (see flag notes). (1 bit)"},18016:{name:"FileMimeType",level:3,type:"s",mandatory:true,minver:1,webm:false,description:"MIME type of the file."},18017:{name:"FileUsedStartTime",level:3,type:"u",divx:true,description:"DivX font extension"},18018:{name:"FileUsedEndTime",level:3,type:"u",divx:true,description:"DivX font extension"},18037:{name:"FileReferral",level:3,type:"b",webm:false,description:"A binary value that a track/codec can refer to when the attachment is needed."},20529:{name:"ContentEncodingOrder",level:5,type:"u",mandatory:true,minver:1,webm:false,default:0,description:"Tells when this modification was used during encoding/muxing starting with 0 and counting upwards. The decoder/demuxer has to start with the highest order number it finds and work its way down. This value has to be unique over all ContentEncodingOrder elements in the segment."},20530:{name:"ContentEncodingScope",level:5,type:"u",mandatory:true,minver:1,webm:false,default:1,range:"not 0",description:"A bit field that describes which elements have been modified in this way. Values (big endian) can be OR'ed. Possible values: 1 - all frame contents, 2 - the track's private data, 4 - the next ContentEncoding (next ContentEncodingOrder. Either the data inside ContentCompression and/or ContentEncryption)"},20531:{name:"ContentEncodingType",level:5,type:"u",mandatory:true,minver:1,webm:false,default:0,description:"A value describing what kind of transformation has been done. Possible values: 0 - compression, 1 - encryption"},20532:{name:"ContentCompression",level:5,type:"m",minver:1,webm:false,description:"Settings describing the compression used. Must be present if the value of ContentEncodingType is 0 and absent otherwise. Each block must be decompressable even if no previous block is available in order not to prevent seeking."},20533:{name:"ContentEncryption",level:5,type:"m",minver:1,webm:false,description:"Settings describing the encryption used. Must be present if the value of ContentEncodingType is 1 and absent otherwise."},21368:{name:"CueBlockNumber",level:4,type:"u",minver:1,default:1,range:"not 0",description:"Number of the Block in the specified Cluster."},22100:{name:"ChapterStringUID",level:4,type:"8",mandatory:false,minver:3,webm:true,description:"A unique string ID to identify the Chapter. Use for WebVTT cue identifier storage."},22337:{name:"WritingApp",level:2,type:"8",mandatory:true,minver:1,description:'Writing application ("mkvmerge-0.3.3").'},22612:{name:"SilentTracks",cppname:"ClusterSilentTracks",level:2,type:"m",minver:1,webm:false,description:"The list of tracks that are not used in that part of the stream. It is useful when using overlay tracks on seeking. Then you should decide what track to use."},25152:{name:"ContentEncoding",level:4,type:"m",mandatory:true,multiple:true,minver:1,webm:false,description:"Settings for one content encoding like compression or encryption."},25188:{name:"BitDepth",cppname:"AudioBitDepth",level:4,type:"u",minver:1,range:"not 0",description:"Bits per sample, mostly used for PCM."},25906:{name:"SignedElement",level:3,type:"b",multiple:true,webm:false,description:"An element ID whose data will be used to compute the signature."},26148:{name:"TrackTranslate",level:3,type:"m",multiple:true,minver:1,webm:false,description:"The track identification for the given Chapter Codec."},26897:{name:"ChapProcessCommand",cppname:"ChapterProcessCommand",level:5,type:"m",multiple:true,minver:1,webm:false,description:"Contains all the commands associated to the Atom."},26914:{name:"ChapProcessTime",cppname:"ChapterProcessTime",level:6,type:"u",mandatory:true,minver:1,webm:false,description:"Defines when the process command should be handled (0: during the whole chapter, 1: before starting playback, 2: after playback of the chapter)."},26916:{name:"ChapterTranslate",level:2,type:"m",multiple:true,minver:1,webm:false,description:"A tuple of corresponding ID used by chapter codecs to represent this segment."},26931:{name:"ChapProcessData",cppname:"ChapterProcessData",level:6,type:"b",mandatory:true,minver:1,webm:false,description:"Contains the command information. The data should be interpreted depending on the ChapProcessCodecID value. For ChapProcessCodecID = 1, the data correspond to the binary DVD cell pre/post commands."},26948:{name:"ChapProcess",cppname:"ChapterProcess",level:4,type:"m",multiple:true,minver:1,webm:false,description:"Contains all the commands associated to the Atom."},26965:{name:"ChapProcessCodecID",cppname:"ChapterProcessCodecID",level:5,type:"u",mandatory:true,minver:1,webm:false,default:0,description:"Contains the type of the codec used for the processing. A value of 0 means native Matroska processing (to be defined), a value of 1 means the DVD command set is used. More codec IDs can be added later."},29555:{name:"Tag",level:2,type:"m",mandatory:true,multiple:true,minver:1,webm:false,description:"Element containing elements specific to Tracks/Chapters."},29572:{name:"SegmentFilename",level:2,type:"8",minver:1,webm:false,description:"A filename corresponding to this segment."},29766:{name:"AttachmentLink",cppname:"TrackAttachmentLink",level:3,type:"u",minver:1,webm:false,range:"not 0",description:"The UID of an attachment that is used by this codec."},2459272:{name:"CodecName",level:3,type:"8",minver:1,description:"A human-readable string specifying the codec."},408125543:{name:"Segment",level:"0",type:"m",mandatory:true,multiple:true,minver:1,description:"This element contains all other top-level (level 1) elements. Typically a Matroska file is composed of 1 segment."},17530:{name:"TagLanguage",level:4,type:"s",mandatory:true,minver:1,webm:false,default:"und",description:"Specifies the language of the tag specified, in the Matroska languages form."},17827:{name:"TagName",level:4,type:"8",mandatory:true,minver:1,webm:false,description:"The name of the Tag that is going to be stored."},26568:{name:"SimpleTag",cppname:"TagSimple",level:3,recursive:"1",type:"m",mandatory:true,multiple:true,minver:1,webm:false,description:"Contains general information about the target."},25542:{name:"TagAttachmentUID",level:4,type:"u",multiple:true,minver:1,webm:false,default:0,description:"A unique ID to identify the Attachment(s) the tags belong to. If the value is 0 at this level, the tags apply to all the attachments in the Segment."},25540:{name:"TagChapterUID",level:4,type:"u",multiple:true,minver:1,webm:false,default:0,description:"A unique ID to identify the Chapter(s) the tags belong to. If the value is 0 at this level, the tags apply to all chapters in the Segment."},25545:{name:"TagEditionUID",level:4,type:"u",multiple:true,minver:1,webm:false,default:0,description:"A unique ID to identify the EditionEntry(s) the tags belong to. If the value is 0 at this level, the tags apply to all editions in the Segment."},25541:{name:"TagTrackUID",level:4,type:"u",multiple:true,minver:1,webm:false,default:0,description:"A unique ID to identify the Track(s) the tags belong to. If the value is 0 at this level, the tags apply to all tracks in the Segment."},25546:{name:"TargetType",cppname:"TagTargetType",level:4,type:"s",minver:1,webm:false,strong:"informational",description:'An  string that can be used to display the logical level of the target like "ALBUM", "TRACK", "MOVIE", "CHAPTER", etc (see TargetType).'},26826:{name:"TargetTypeValue",cppname:"TagTargetTypeValue",level:4,type:"u",minver:1,webm:false,default:50,description:"A number to indicate the logical level of the target (see TargetType)."},25536:{name:"Targets",cppname:"TagTargets",level:3,type:"m",mandatory:true,minver:1,webm:false,description:"Contain all UIDs where the specified meta data apply. It is empty to describe everything in the segment."},307544935:{name:"Tags",level:1,type:"m",multiple:true,minver:1,webm:false,description:"Element containing elements specific to Tracks/Chapters. A list of valid tags can be found here."},17677:{name:"ChapProcessPrivate",cppname:"ChapterProcessPrivate",level:5,type:"b",minver:1,webm:false,description:'Some optional data attached to the ChapProcessCodecID information. For ChapProcessCodecID = 1, it is the "DVD level" equivalent.'},17278:{name:"ChapCountry",cppname:"ChapterCountry",level:5,type:"s",multiple:true,minver:1,webm:false,description:"The countries corresponding to the string, same 2 octets as in Internet domains."},17276:{name:"ChapLanguage",cppname:"ChapterLanguage",level:5,type:"s",mandatory:true,multiple:true,minver:1,webm:true,default:"eng",description:"The languages corresponding to the string, in the bibliographic ISO-639-2 form."},143:{name:"ChapterTrack",level:4,type:"m",minver:1,webm:false,description:"List of tracks on which the chapter applies. If this element is not present, all tracks apply"},25539:{name:"ChapterPhysicalEquiv",level:4,type:"u",minver:1,webm:false,description:'Specify the physical equivalent of this ChapterAtom like "DVD" (60) or "SIDE" (50), see complete list of values.'},28348:{name:"ChapterSegmentEditionUID",level:4,type:"u",minver:1,webm:false,range:"not 0",description:"The EditionUID to play from the segment linked in ChapterSegmentUID."},28263:{name:"ChapterSegmentUID",level:4,type:"b",minver:1,webm:false,range:">0",bytesize:16,description:"A segment to play in place of this chapter. Edition ChapterSegmentEditionUID should be used for this segment, otherwise no edition is used."},29636:{name:"ChapterUID",level:4,type:"u",mandatory:true,minver:1,webm:true,range:"not 0",description:"A unique ID to identify the Chapter."},182:{name:"ChapterAtom",level:3,recursive:"1",type:"m",mandatory:true,multiple:true,minver:1,webm:true,description:"Contains the atom information to use as the chapter atom (apply to all tracks)."},17885:{name:"EditionFlagOrdered",level:3,type:"u",minver:1,webm:false,default:0,range:"0-1",description:"Specify if the chapters can be defined multiple times and the order to play them is enforced. (1 bit)"},17883:{name:"EditionFlagDefault",level:3,type:"u",mandatory:true,minver:1,webm:false,default:0,range:"0-1",description:"If a flag is set (1) the edition should be used as the default one. (1 bit)"},17853:{name:"EditionFlagHidden",level:3,type:"u",mandatory:true,minver:1,webm:false,default:0,range:"0-1",description:"If an edition is hidden (1), it should not be available to the user interface (but still to Control Tracks; see flag notes). (1 bit)"},17852:{name:"EditionUID",level:3,type:"u",minver:1,webm:false,range:"not 0",description:"A unique ID to identify the edition. It's useful for tagging an edition."},17849:{name:"EditionEntry",level:2,type:"m",mandatory:true,multiple:true,minver:1,webm:true,description:"Contains all information about a segment edition."},272869232:{name:"Chapters",level:1,type:"m",minver:1,webm:true,description:"A system to define basic menus and partition data. For more detailed information, look at the Chapters Explanation."},18094:{name:"FileUID",level:3,type:"u",mandatory:true,minver:1,webm:false,range:"not 0",description:"Unique ID representing the file, as random as possible."},18012:{name:"FileData",level:3,type:"b",mandatory:true,minver:1,webm:false,description:"The data of the file."},18030:{name:"FileName",level:3,type:"8",mandatory:true,minver:1,webm:false,description:"Filename of the attached file."},18046:{name:"FileDescription",level:3,type:"8",minver:1,webm:false,description:"A human-friendly name for the attached file."},24999:{name:"AttachedFile",level:2,type:"m",mandatory:true,multiple:true,minver:1,webm:false,description:"An attached file."},423732329:{name:"Attachments",level:1,type:"m",minver:1,webm:false,description:"Contain attached files."},235:{name:"CueRefCodecState",level:5,type:"u",webm:false,default:0,description:"The position of the Codec State corresponding to this referenced element. 0 means that the data is taken from the initial Track Entry."},21343:{name:"CueRefNumber",level:5,type:"u",webm:false,default:1,range:"not 0",description:"Number of the referenced Block of Track X in the specified Cluster."},219:{name:"CueReference",level:4,type:"m",multiple:true,minver:2,webm:false,description:"The Clusters containing the required referenced Blocks."},234:{name:"CueCodecState",level:4,type:"u",minver:2,webm:false,default:0,description:"The position of the Codec State corresponding to this Cue element. 0 means that the data is taken from the initial Track Entry."},178:{name:"CueDuration",level:4,type:"u",mandatory:false,minver:4,webm:false,description:"The duration of the block according to the segment time base. If missing the track's DefaultDuration does not apply and no duration information is available in terms of the cues."},240:{name:"CueRelativePosition",level:4,type:"u",mandatory:false,minver:4,webm:false,description:"The relative position of the referenced block inside the cluster with 0 being the first possible position for an element inside that cluster.",position:"clusterRelative"},241:{name:"CueClusterPosition",level:4,type:"u",mandatory:true,minver:1,description:"The position of the Cluster containing the required Block.",position:"segment"},247:{name:"CueTrack",level:4,type:"u",mandatory:true,minver:1,range:"not 0",description:"The track for which a position is given."},183:{name:"CueTrackPositions",level:3,type:"m",mandatory:true,multiple:true,minver:1,description:"Contain positions for different tracks corresponding to the timestamp."},179:{name:"CueTime",level:3,type:"u",mandatory:true,minver:1,description:"Absolute timestamp according to the segment time base."},187:{name:"CuePoint",level:2,type:"m",mandatory:true,multiple:true,minver:1,description:"Contains all information relative to a seek point in the segment."},475249515:{name:"Cues",level:1,type:"m",minver:1,description:'A top-level element to speed seeking access. All entries are local to the segment. Should be mandatory for non "live" streams.'},18406:{name:"ContentSigHashAlgo",level:6,type:"u",minver:1,webm:false,default:0,description:"The hash algorithm used for the signature. A value of '0' means that the contents have not been signed but only encrypted. Predefined values: 1 - SHA1-160 2 - MD5"},18405:{name:"ContentSigAlgo",level:6,type:"u",minver:1,webm:false,default:0,description:"The algorithm used for the signature. A value of '0' means that the contents have not been signed but only encrypted. Predefined values: 1 - RSA"},18404:{name:"ContentSigKeyID",level:6,type:"b",minver:1,webm:false,description:"This is the ID of the private key the data was signed with."},18403:{name:"ContentSignature",level:6,type:"b",minver:1,webm:false,description:"A cryptographic signature of the contents."},18402:{name:"ContentEncKeyID",level:6,type:"b",minver:1,webm:false,description:"For public key algorithms this is the ID of the public key the the data was encrypted with."},18401:{name:"ContentEncAlgo",level:6,type:"u",minver:1,webm:false,default:0,description:"The encryption algorithm used. The value '0' means that the contents have not been encrypted but only signed. Predefined values: 1 - DES, 2 - 3DES, 3 - Twofish, 4 - Blowfish, 5 - AES"},28032:{name:"ContentEncodings",level:3,type:"m",minver:1,webm:false,description:"Settings for several content encoding mechanisms like compression or encryption."},196:{name:"TrickMasterTrackSegmentUID",level:3,type:"b",divx:true,bytesize:16,description:"DivX trick track extenstions"},199:{name:"TrickMasterTrackUID",level:3,type:"u",divx:true,description:"DivX trick track extenstions"},198:{name:"TrickTrackFlag",level:3,type:"u",divx:true,default:0,description:"DivX trick track extenstions"},193:{name:"TrickTrackSegmentUID",level:3,type:"b",divx:true,bytesize:16,description:"DivX trick track extenstions"},192:{name:"TrickTrackUID",level:3,type:"u",divx:true,description:"DivX trick track extenstions"},237:{name:"TrackJoinUID",level:5,type:"u",mandatory:true,multiple:true,minver:3,webm:false,range:"not 0",description:"The trackUID number of a track whose blocks are used to create this virtual track."},233:{name:"TrackJoinBlocks",level:4,type:"m",minver:3,webm:false,description:"Contains the list of all tracks whose Blocks need to be combined to create this virtual track"},230:{name:"TrackPlaneType",level:6,type:"u",mandatory:true,minver:3,webm:false,description:"The kind of plane this track corresponds to (0: left eye, 1: right eye, 2: background)."},229:{name:"TrackPlaneUID",level:6,type:"u",mandatory:true,minver:3,webm:false,range:"not 0",description:"The trackUID number of the track representing the plane."},228:{name:"TrackPlane",level:5,type:"m",mandatory:true,multiple:true,minver:3,webm:false,description:"Contains a video plane track that need to be combined to create this 3D track"},227:{name:"TrackCombinePlanes",level:4,type:"m",minver:3,webm:false,description:"Contains the list of all video plane tracks that need to be combined to create this 3D track"},226:{name:"TrackOperation",level:3,type:"m",minver:3,webm:false,description:"Operation that needs to be applied on tracks to create this virtual track. For more details look at the Specification Notes on the subject."},32123:{name:"ChannelPositions",cppname:"AudioPosition",level:4,type:"b",webm:false,description:"Table of horizontal angles for each successive channel, see appendix."},159:{name:"Channels",cppname:"AudioChannels",level:4,type:"u",mandatory:true,minver:1,default:1,range:"not 0",description:"Numbers of channels in the track."},30901:{name:"OutputSamplingFrequency",cppname:"AudioOutputSamplingFreq",level:4,type:"f",minver:1,default:"Sampling Frequency",range:"> 0",description:"Real output sampling frequency in Hz (used for SBR techniques)."},181:{name:"SamplingFrequency",cppname:"AudioSamplingFreq",level:4,type:"f",mandatory:true,minver:1,default:8e3,range:"> 0",description:"Sampling frequency in Hz."},225:{name:"Audio",cppname:"TrackAudio",level:3,type:"m",minver:1,description:"Audio settings."},2327523:{name:"FrameRate",cppname:"VideoFrameRate",level:4,type:"f",range:"> 0",strong:"Informational",description:"Number of frames per second.  only."},3126563:{name:"GammaValue",cppname:"VideoGamma",level:4,type:"f",webm:false,range:"> 0",description:"Gamma Value."},3061028:{name:"ColourSpace",cppname:"VideoColourSpace",level:4,type:"b",minver:1,webm:false,bytesize:4,description:"Same value as in AVI (32 bits)."},21683:{name:"AspectRatioType",cppname:"VideoAspectRatio",level:4,type:"u",minver:1,default:0,description:"Specify the possible modifications to the aspect ratio (0: free resizing, 1: keep aspect ratio, 2: fixed)."},21682:{name:"DisplayUnit",cppname:"VideoDisplayUnit",level:4,type:"u",minver:1,default:0,description:"How DisplayWidth & DisplayHeight should be interpreted (0: pixels, 1: centimeters, 2: inches, 3: Display Aspect Ratio)."},21690:{name:"DisplayHeight",cppname:"VideoDisplayHeight",level:4,type:"u",minver:1,default:"PixelHeight",range:"not 0",description:"Height of the video frames to display. The default value is only valid when DisplayUnit is 0."},21680:{name:"DisplayWidth",cppname:"VideoDisplayWidth",level:4,type:"u",minver:1,default:"PixelWidth",range:"not 0",description:"Width of the video frames to display. The default value is only valid when DisplayUnit is 0."},21725:{name:"PixelCropRight",cppname:"VideoPixelCropRight",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove on the right of the image."},21708:{name:"PixelCropLeft",cppname:"VideoPixelCropLeft",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove on the left of the image."},21691:{name:"PixelCropTop",cppname:"VideoPixelCropTop",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove at the top of the image."},21674:{name:"PixelCropBottom",cppname:"VideoPixelCropBottom",level:4,type:"u",minver:1,default:0,description:"The number of video pixels to remove at the bottom of the image (for HDTV content)."},186:{name:"PixelHeight",cppname:"VideoPixelHeight",level:4,type:"u",mandatory:true,minver:1,range:"not 0",description:"Height of the encoded video frames in pixels."},176:{name:"PixelWidth",cppname:"VideoPixelWidth",level:4,type:"u",mandatory:true,minver:1,range:"not 0",description:"Width of the encoded video frames in pixels."},21433:{name:"OldStereoMode",level:4,type:"u",maxver:"0",webm:false,divx:false,description:"DEPRECATED, DO NOT USE. Bogus StereoMode value used in old versions of libmatroska. (0: mono, 1: right eye, 2: left eye, 3: both eyes)."},21440:{name:"AlphaMode",cppname:"VideoAlphaMode",level:4,type:"u",minver:3,webm:true,default:0,description:"Alpha Video Mode. Presence of this element indicates that the BlockAdditional element could contain Alpha data."},21432:{name:"StereoMode",cppname:"VideoStereoMode",level:4,type:"u",minver:3,webm:true,default:0,description:"Stereo-3D video mode (0: mono, 1: side by side (left eye is first), 2: top-bottom (right eye is first), 3: top-bottom (left eye is first), 4: checkboard (right is first), 5: checkboard (left is first), 6: row interleaved (right is first), 7: row interleaved (left is first), 8: column interleaved (right is first), 9: column interleaved (left is first), 10: anaglyph (cyan/red), 11: side by side (right eye is first), 12: anaglyph (green/magenta), 13 both eyes laced in one Block (left eye is first), 14 both eyes laced in one Block (right eye is first)) . There are some more details on 3D support in the Specification Notes."},154:{name:"FlagInterlaced",cppname:"VideoFlagInterlaced",level:4,type:"u",mandatory:true,minver:2,webm:true,default:0,range:"0-1",description:"Set if the video is interlaced. (1 bit)"},224:{name:"Video",cppname:"TrackVideo",level:3,type:"m",minver:1,description:"Video settings."},26277:{name:"TrackTranslateTrackID",level:4,type:"b",mandatory:true,minver:1,webm:false,description:"The binary value used to represent this track in the chapter codec data. The format depends on the ChapProcessCodecID used."},26303:{name:"TrackTranslateCodec",level:4,type:"u",mandatory:true,minver:1,webm:false,description:"The chapter codec using this ID (0: Matroska Script, 1: DVD-menu)."},26364:{name:"TrackTranslateEditionUID",level:4,type:"u",multiple:true,minver:1,webm:false,description:"Specify an edition UID on which this translation applies. When not specified, it means for all editions found in the segment."},22203:{name:"SeekPreRoll",level:3,type:"u",mandatory:true,multiple:false,default:0,minver:4,webm:true,description:"After a discontinuity, SeekPreRoll is the duration in nanoseconds of the data the decoder must decode before the decoded data is valid."},22186:{name:"CodecDelay",level:3,type:"u",multiple:false,default:0,minver:4,webm:true,description:"CodecDelay is The codec-built-in delay in nanoseconds. This value must be subtracted from each block timestamp in order to get the actual timestamp. The value should be small so the muxing of tracks with the same actual timestamp are in the same Cluster."},28587:{name:"TrackOverlay",level:3,type:"u",multiple:true,minver:1,webm:false,description:"Specify that this track is an overlay track for the Track specified (in the u-integer). That means when this track has a gap (see SilentTracks) the overlay track should be used instead. The order of multiple TrackOverlay matters, the first one is the one that should be used. If not found it should be the second, etc."},170:{name:"CodecDecodeAll",level:3,type:"u",mandatory:true,minver:2,webm:false,default:1,range:"0-1",description:"The codec can decode potentially damaged data (1 bit)."},2536e3:{name:"CodecDownloadURL",level:3,type:"s",multiple:true,webm:false,description:"A URL to download about the codec used."},3883072:{name:"CodecInfoURL",level:3,type:"s",multiple:true,webm:false,description:"A URL to find information about the codec used."},3839639:{name:"CodecSettings",level:3,type:"8",webm:false,description:"A string describing the encoding setting used."},25506:{name:"CodecPrivate",level:3,type:"b",minver:1,description:"Private data only known to the codec."},2274716:{name:"Language",cppname:"TrackLanguage",level:3,type:"s",minver:1,default:"eng",description:"Specifies the language of the track in the Matroska languages form."},21358:{name:"Name",cppname:"TrackName",level:3,type:"8",minver:1,description:"A human-readable track name."},21998:{name:"MaxBlockAdditionID",level:3,type:"u",mandatory:true,minver:1,webm:false,default:0,description:"The maximum value of BlockAdditions for this track."},21375:{name:"TrackOffset",level:3,type:"i",webm:false,default:0,description:"A value to add to the Block's Timestamp. This can be used to adjust the playback offset of a track."},2306383:{name:"TrackTimecodeScale",level:3,type:"f",mandatory:true,minver:1,maxver:"3",webm:false,default:1,range:"> 0",description:"DEPRECATED, DO NOT USE. The scale to apply on this track to work at normal speed in relation with other tracks (mostly used to adjust video speed when the audio length differs)."},2313850:{name:"DefaultDecodedFieldDuration",cppname:"TrackDefaultDecodedFieldDuration",level:3,type:"u",minver:4,range:"not 0",description:"The period in nanoseconds (not scaled by TimcodeScale)\nbetween two successive fields at the output of the decoding process (see the notes)"},2352003:{name:"DefaultDuration",cppname:"TrackDefaultDuration",level:3,type:"u",minver:1,range:"not 0",description:"Number of nanoseconds (not scaled via TimecodeScale) per frame ('frame' in the Matroska sense -- one element put into a (Simple)Block)."},28152:{name:"MaxCache",cppname:"TrackMaxCache",level:3,type:"u",minver:1,webm:false,description:"The maximum cache size required to store referenced frames in and the current frame. 0 means no cache is needed."},28135:{name:"MinCache",cppname:"TrackMinCache",level:3,type:"u",mandatory:true,minver:1,webm:false,default:0,description:"The minimum number of frames a player should be able to cache during playback. If set to 0, the reference pseudo-cache system is not used."},156:{name:"FlagLacing",cppname:"TrackFlagLacing",level:3,type:"u",mandatory:true,minver:1,default:1,range:"0-1",description:"Set if the track may contain blocks using lacing. (1 bit)"},21930:{name:"FlagForced",cppname:"TrackFlagForced",level:3,type:"u",mandatory:true,minver:1,default:0,range:"0-1",description:"Set if that track MUST be active during playback. There can be many forced track for a kind (audio, video or subs), the player should select the one which language matches the user preference or the default + forced track. Overlay MAY happen between a forced and non-forced track of the same kind. (1 bit)"},185:{name:"FlagEnabled",cppname:"TrackFlagEnabled",level:3,type:"u",mandatory:true,minver:2,webm:true,default:1,range:"0-1",description:"Set if the track is usable. (1 bit)"},29637:{name:"TrackUID",level:3,type:"u",mandatory:true,minver:1,range:"not 0",description:"A unique ID to identify the Track. This should be kept the same when making a direct stream copy of the Track to another file."},215:{name:"TrackNumber",level:3,type:"u",mandatory:true,minver:1,range:"not 0",description:"The track number as used in the Block Header (using more than 127 tracks is not encouraged, though the design allows an unlimited number)."},174:{name:"TrackEntry",level:2,type:"m",mandatory:true,multiple:true,minver:1,description:"Describes a track with all elements."},374648427:{name:"Tracks",level:1,type:"m",multiple:true,minver:1,description:"A top-level block of information with many tracks described."},175:{name:"EncryptedBlock",level:2,type:"b",multiple:true,webm:false,description:"Similar to EncryptedBlock Structure)"},202:{name:"ReferenceTimeCode",level:4,type:"u",multiple:false,mandatory:true,minver:0,webm:false,divx:true,description:"DivX trick track extenstions"},201:{name:"ReferenceOffset",level:4,type:"u",multiple:false,mandatory:true,minver:0,webm:false,divx:true,description:"DivX trick track extenstions"},200:{name:"ReferenceFrame",level:3,type:"m",multiple:false,minver:0,webm:false,divx:true,description:"DivX trick track extenstions"},207:{name:"SliceDuration",level:5,type:"u",default:0,description:"The (scaled) duration to apply to the element."},206:{name:"Delay",cppname:"SliceDelay",level:5,type:"u",default:0,description:"The (scaled) delay to apply to the element."},203:{name:"BlockAdditionID",cppname:"SliceBlockAddID",level:5,type:"u",default:0,description:"The ID of the BlockAdditional element (0 is the main Block)."},205:{name:"FrameNumber",cppname:"SliceFrameNumber",level:5,type:"u",default:0,description:"The number of the frame to generate from this lace with this delay (allow you to generate many frames from the same Block/Frame)."},204:{name:"LaceNumber",cppname:"SliceLaceNumber",level:5,type:"u",minver:1,default:0,divx:false,description:"The reverse number of the frame in the lace (0 is the last frame, 1 is the next to last, etc). While there are a few files in the wild with this element, it is no longer in use and has been deprecated. Being able to interpret this element is not required for playback."},232:{name:"TimeSlice",level:4,type:"m",multiple:true,minver:1,divx:false,description:"Contains extra time information about the data contained in the Block. While there are a few files in the wild with this element, it is no longer in use and has been deprecated. Being able to interpret this element is not required for playback."},142:{name:"Slices",level:3,type:"m",minver:1,divx:false,description:"Contains slices description."},30114:{name:"DiscardPadding",level:3,type:"i",minver:4,webm:true,description:"Duration in nanoseconds of the silent data added to the Block (padding at the end of the Block for positive value, at the beginning of the Block for negative value). The duration of DiscardPadding is not calculated in the duration of the TrackEntry and should be discarded during playback."},164:{name:"CodecState",level:3,type:"b",minver:2,webm:false,description:"The new codec state to use. Data interpretation is private to the codec. This information should always be referenced by a seek entry."},253:{name:"ReferenceVirtual",level:3,type:"i",webm:false,description:"Relative position of the data that should be in position of the virtual block."},251:{name:"ReferenceBlock",level:3,type:"i",multiple:true,minver:1,description:"Timestamp of another frame used as a reference (ie: B or P frame). The timestamp is relative to the block it's attached to."},250:{name:"ReferencePriority",cppname:"FlagReferenced",level:3,type:"u",mandatory:true,minver:1,webm:false,default:0,description:"This frame is referenced and has the specified cache priority. In cache only a frame of the same or higher priority can replace this frame. A value of 0 means the frame is not referenced."},155:{name:"BlockDuration",level:3,type:"u",minver:1,default:"TrackDuration",description:'The duration of the Block (based on TimecodeScale). This element is mandatory when DefaultDuration is set for the track (but can be omitted as other default values). When not written and with no DefaultDuration, the value is assumed to be the difference between the timestamp of this Block and the timestamp of the next Block in "display" order (not coding order). This element can be useful at the end of a Track (as there is not other Block available), or when there is a break in a track like for subtitle tracks. When set to 0 that means the frame is not a keyframe.'},165:{name:"BlockAdditional",level:5,type:"b",mandatory:true,minver:1,webm:false,description:"Interpreted by the codec as it wishes (using the BlockAddID)."},238:{name:"BlockAddID",level:5,type:"u",mandatory:true,minver:1,webm:false,default:1,range:"not 0",description:"An ID to identify the BlockAdditional level."},166:{name:"BlockMore",level:4,type:"m",mandatory:true,multiple:true,minver:1,webm:false,description:"Contain the BlockAdditional and some parameters."},30113:{name:"BlockAdditions",level:3,type:"m",minver:1,webm:false,description:"Contain additional blocks to complete the main one. An EBML parser that has no knowledge of the Block structure could still see and use/skip these data."},162:{name:"BlockVirtual",level:3,type:"b",webm:false,description:"A Block with no data. It must be stored in the stream at the place the real Block should be in display order. (see Block Virtual)"},161:{name:"Block",level:3,type:"b",mandatory:true,minver:1,description:"Block containing the actual data to be rendered and a timestamp relative to the Cluster Timecode. (see Block Structure)"},160:{name:"BlockGroup",level:2,type:"m",multiple:true,minver:1,description:"Basic container of information containing a single Block or BlockVirtual, and information specific to that Block/VirtualBlock."},163:{name:"SimpleBlock",level:2,type:"b",multiple:true,minver:2,webm:true,divx:true,description:"Similar to SimpleBlock Structure"},171:{name:"PrevSize",cppname:"ClusterPrevSize",level:2,type:"u",minver:1,description:"Size of the previous Cluster, in octets. Can be useful for backward playing.",position:"prevCluster"},167:{name:"Position",cppname:"ClusterPosition",level:2,type:"u",minver:1,webm:false,description:"The Position of the Cluster in the segment (0 in live broadcast streams). It might help to resynchronise offset on damaged streams.",position:"segment"},22743:{name:"SilentTrackNumber",cppname:"ClusterSilentTrackNumber",level:3,type:"u",multiple:true,minver:1,webm:false,description:"One of the track number that are not used from now on in the stream. It could change later if not specified as silent in a further Cluster."},231:{name:"Timecode",cppname:"ClusterTimecode",level:2,type:"u",mandatory:true,minver:1,description:"Absolute timestamp of the cluster (based on TimecodeScale)."},524531317:{name:"Cluster",level:1,type:"m",multiple:true,minver:1,description:"The lower level element containing the (monolithic) Block structure."},19840:{name:"MuxingApp",level:2,type:"8",mandatory:true,minver:1,description:'Muxing application or library ("libmatroska-0.4.3").'},31657:{name:"Title",level:2,type:"8",minver:1,webm:false,description:"General name of the segment."},2807730:{name:"TimecodeScaleDenominator",level:2,type:"u",mandatory:true,minver:4,default:"1000000000",description:"Timestamp scale numerator, see TimecodeScale."},2807729:{name:"TimecodeScale",level:2,type:"u",mandatory:true,minver:1,default:"1000000",description:"Timestamp scale in nanoseconds (1.000.000 means all timestamps in the segment are expressed in milliseconds)."},27045:{name:"ChapterTranslateID",level:3,type:"b",mandatory:true,minver:1,webm:false,description:"The binary value used to represent this segment in the chapter codec data. The format depends on the ChapProcessCodecID used."},27071:{name:"ChapterTranslateCodec",level:3,type:"u",mandatory:true,minver:1,webm:false,description:"The chapter codec using this ID (0: Matroska Script, 1: DVD-menu)."},27132:{name:"ChapterTranslateEditionUID",level:3,type:"u",multiple:true,minver:1,webm:false,description:"Specify an edition UID on which this correspondance applies. When not specified, it means for all editions found in the segment."},4096955:{name:"NextFilename",level:2,type:"8",minver:1,webm:false,description:"An escaped filename corresponding to the next segment."},4110627:{name:"NextUID",level:2,type:"b",minver:1,webm:false,bytesize:16,description:"A unique ID to identify the next chained segment (128 bits)."},3965867:{name:"PrevFilename",level:2,type:"8",minver:1,webm:false,description:"An escaped filename corresponding to the previous segment."},3979555:{name:"PrevUID",level:2,type:"b",minver:1,webm:false,bytesize:16,description:"A unique ID to identify the previous chained segment (128 bits)."},29604:{name:"SegmentUID",level:2,type:"b",minver:1,webm:false,range:"not 0",bytesize:16,description:"A randomly generated unique ID to identify the current segment between many others (128 bits)."},357149030:{name:"Info",level:1,type:"m",mandatory:true,multiple:true,minver:1,description:"Contains miscellaneous general information and statistics on the file."},21420:{name:"SeekPosition",level:3,type:"u",mandatory:true,minver:1,description:"The position of the element in the segment in octets (0 = first level 1 element).",position:"segment"},21419:{name:"SeekID",level:3,type:"b",mandatory:true,minver:1,description:"The binary ID corresponding to the element name.",type2:"ebmlID"},19899:{name:"Seek",cppname:"SeekPoint",level:2,type:"m",mandatory:true,multiple:true,minver:1,description:"Contains a single seek entry to an EBML element."},290298740:{name:"SeekHead",cppname:"SeekHeader",level:1,type:"m",multiple:true,minver:1,description:"Contains the position of other level 1 elements."},32379:{name:"SignatureElementList",level:2,type:"m",multiple:true,webm:false,i:"Cluster|Block|BlockAdditional",description:"A list consists of a number of consecutive elements that represent one case where data is used in signature. Ex:  means that the BlockAdditional of all Blocks in all Clusters is used for encryption."},32347:{name:"SignatureElements",level:1,type:"m",webm:false,description:"Contains elements that will be used to compute the signature."},32437:{name:"Signature",level:1,type:"b",webm:false,description:"The signature of the data (until a new."},32421:{name:"SignaturePublicKey",level:1,type:"b",webm:false,description:"The public key to use with the algorithm (in the case of a PKI-based signature)."},32410:{name:"SignatureHash",level:1,type:"u",webm:false,description:"Hash algorithm used (1=SHA1-160, 2=MD5)."},32394:{name:"SignatureAlgo",level:1,type:"u",webm:false,description:"Signature algorithm used (1=RSA, 2=elliptic)."},458458727:{name:"SignatureSlot",level:-1,type:"m",multiple:true,webm:false,description:"Contain signature of some (coming) elements in the stream."},191:{name:"CRC-32",level:-1,type:"b",minver:1,webm:false,description:"The CRC is computed on all the data of the Master element it's in. The CRC element should be the first in it's parent master for easier reading. All level 1 elements should include a CRC-32. The CRC in use is the IEEE CRC32 Little Endian",crc:true},236:{name:"Void",level:-1,type:"b",minver:1,description:"Used to void damaged data, to avoid unexpected behaviors when using damaged data. The content is discarded. Also used to reserve space in a sub-element for later use."},17139:{name:"EBMLMaxSizeLength",level:1,type:"u",mandatory:true,default:8,minver:1,description:"The maximum length of the sizes you'll find in this file (8 or less in Matroska). This does not override the element size indicated at the beginning of an element. Elements that have an indicated size which is larger than what is allowed by EBMLMaxSizeLength shall be considered invalid."},17138:{name:"EBMLMaxIDLength",level:1,type:"u",mandatory:true,default:4,minver:1,description:"The maximum length of the IDs you'll find in this file (4 or less in Matroska)."},17143:{name:"EBMLReadVersion",level:1,type:"u",mandatory:true,default:1,minver:1,description:"The minimum EBML version a parser has to support to read this file."},440786851:{name:"EBML",level:"0",type:"m",mandatory:true,multiple:true,minver:1,description:"Set the EBML characteristics of the data to follow. Each EBML document has to start with this."}},n={},s={byEbmlID:r,byName:n};for(var o in r){n[r[o].name.replace("-","_")]=parseInt(o,10)}e.exports=s},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),i(313);const r=i(7),n=i(478),s=i(6),o=i(9),a=i(14),c=i(4),l=i(57),d=i(11),u=i(70),h=i(312),f=i(17);class p{constructor(){this.RAINBOW_ONCALLLOGUPDATED="rainbowcalllogupdated",this.RAINBOW_ONCALLLOGMISSEDNUMBERUPDATED="rainbowcalllogmissednumberupdated",this.RAINBOW_ONCALLLOGACKUPDATED="rainbowcalllogackupdated",this.RAINBOW_ONCALLLOGINFOSUPDATED="rainbowcallloginfosupdated",this.xmppService=o.XmppService.getInstance(),this.profileService=a.ProfileService.getInstance(),this.logger=c.LoggerService.getInstance(),this.contactService=s.ContactService.getInstance(),this.telephonyService=l.TelephonyService.getInstance(),this.eventService=d.EventService.getInstance(),this.webrtcGatewayService=u.WebrtcGatewayService.getInstance(),this.centralizedService=null,this.mainService=f.MainService.getInstance(),this.personalDirectoryService=h.PersonalDirectoryService.getInstance(),this.initialized=false,this.rxSubject=new r.Subject,this.xmppConnectionSubscription=null,this.personalDirSubscriptions=[],this.callLogHandlerRef=null,this.callLogMessageAckRef=null,this.callLogNotificationRef=null,this.usePhonebookDirectory=false,this.callLogPromises=[],this.numberMissedCallLogs=0,this.numberTotalCallLogs=0,this.callLogs=[],this.aggregatedCallLogs=[],this.ackAllCallLogsInDBDone=false,this.fetchingCallLogs=false,this.userFetchRequest=false}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.callLogService||(e.rainbow.callLogService=new p),e.rainbow.callLogService}async start(){try{this.logger.info(""),this.logger.info("[CallLogService] === STARTING ==="),this.centralizedService=this.mainService.inject("centralizedService"),this.usePhonebookDirectory=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_PHONE_BOOK)||config.permitSearchFromPhoneBook,this.attachHandlers(),this.logger.info("[CallLogService] === STARTED ===")}catch(e){this.logger.error("[CallLogService] === STARTING FAILURE === "+e.message)}}async stop(){this.logger.info("[CallLogService] === STOPPING ==="),this.numberMissedCallLogs=0,this.callLogs=[],this.aggregatedCallLogs=[],this.initialized=false,this.ackAllCallLogsInDBDone=false,this.removeXMPPListeners(),this.xmppConnectionSubscription&&this.xmppConnectionSubscription.unsubscribe(),this.logger.info("[CallLogService] === STOPPED ===")}attachHandlers(){this.logger.info("[CallLogService] attachHandlers"),this.xmppService.connected&&(this.attachXMPPListeners(),this.getNumberMissedCallLogsFromServer()),this.xmppConnectionSubscription=this.xmppService.subscribeToConnectionEvents((e=>{"ON_XMPP_CONNECTED"===e.name&&(this.attachXMPPListeners(),this.getNumberMissedCallLogsFromServer(),"RECONNECTION"===e.data.reason&&this.initialized&&this.getCallLogHistoryPage(this.lastTimestamp)),"ON_XMPP_DISCONNECTED"===e.name&&"LOGOUT"===e.data.reason&&(this.numberMissedCallLogs=0,this.callLogs=[],this.aggregatedCallLogs=[],this.initialized=false,this.ackAllCallLogsInDBDone=false)})),this.personalDirSubscriptions.push(this.personalDirectoryService.subscribe((e=>{this.onPersonalContactEvent(e)})))}removeXMPPListeners(){this.callLogHandlerRef&&(this.xmppService.connection.deleteHandler(this.callLogHandlerRef),this.callLogHandlerRef=null),this.callLogNotificationRef&&(this.xmppService.connection.deleteHandler(this.callLogNotificationRef),this.callLogNotificationRef=null),this.callLogMessageAckRef&&(this.xmppService.connection.deleteHandler(this.callLogMessageAckRef),this.callLogMessageAckRef=null),this.personalDirSubscriptions&&this.personalDirSubscriptions.forEach((e=>{e.unsubscribe()}))}attachXMPPListeners(){this.logger.info("[CallLogService] attachXMPPListeners"),this.removeXMPPListeners(),this.callLogHandlerRef=this.xmppService.connection.addHandler((e=>this.onHistoryCallLogMessageReceived(e)),p.CALL_LOG_NAMESPACE,null,null),this.callLogNotificationRef=this.xmppService.connection.addHandler((e=>this.onCallLogNotificationReceived(e)),p.CALL_LOG_NOTIF_NAMESPACE,null,null),this.callLogMessageAckRef=this.xmppService.connection.addHandler((e=>this.onCallLogAckReceived(e)),p.CALL_LOG_ACK_NAMESPACE,null,null)}subscribe(e){return this.rxSubject.subscribe(e)}async initialize(e={}){return this.initialized?Promise.resolve():(this.logger.info("[CallLogService] initialize -- Not yet initialized, fetch first call logs from server"),this.startPromise||(this.startPromise=new Promise((t=>{this.startPromiseResolve=t,this.logger.info(`[CallLogService] initialize -- initFetchOptions: Number=${e.numberOfElementsToGet} - before=${e.useBefore} - useAfter=${e.useAfter}`),this.fetchCallLogsFromServer(e),this.logger.info("[CallLogService] initialize -- numberMissedCallLogs = "+this.numberMissedCallLogs),this.logger.info("[CallLogService] initialize -- ackAllCallLogsInDBDone = "+this.ackAllCallLogsInDBDone),this.numberMissedCallLogs>14&&!this.ackAllCallLogsInDBDone&&this.ackAllCallLogsInDB()}))),this.startPromise)}async getNumberMissedCallLogsFromServer(){const e=$iq({from:this.xmppService.jid,type:"set"});e.c("query",{xmlns:p.CALL_LOG_NAMESPACE}),e.c("set",{xmlns:"http://jabber.org/protocol/rsm"}),e.c("max").t(0).up().up(),e.c("x",{xmlns:"jabber:x:data",type:"submit"}),e.c("field",{var:"read"}).c("value").t("false").up().up();const t=await this.xmppService.sendIQ(e);return this.numberMissedCallLogs=parseInt($(t).find("count").text(),10),this.logger.info("[CallLogService] getNumberMissedCallLogsFromServer -- numberMissedCallLogs = "+this.numberMissedCallLogs),this.rxSubject.next({type:this.RAINBOW_ONCALLLOGMISSEDNUMBERUPDATED,value:this.numberMissedCallLogs}),this.numberMissedCallLogs}async getCallLogHistoryPage(e=null){this.logger.debug("[CallLogService] getCallLogHistoryPage");const t={};t.numberOfElementsToGet=p.DEFAULT_CALL_LOG_FETCHED,e&&(t.useAfter=e),await this.fetchCallLogsFromServer(t)}async fetchCallLogsFromServer(e){this.logger.debug(`[CallLogService] fetchCallLogsFromServer -- FetchOptions: NbElem=${e.numberOfElementsToGet} - before=${e.useBefore} - useAfter=${e.useAfter}`);const t=$iq({from:this.xmppService.jid,type:"set"});t.c("query",{xmlns:p.CALL_LOG_NAMESPACE}),t.c("set",{xmlns:"http://jabber.org/protocol/rsm"}),e.numberOfElementsToGet?(e.numberOfElementsToGet>p.MAX_CALL_LOG_FETCHED&&(e.numberOfElementsToGet=p.MAX_CALL_LOG_FETCHED),t.c("max").t(e.numberOfElementsToGet).up()):t.c("max").t(p.DEFAULT_CALL_LOG_FETCHED).up(),e.useAfter?t.c("after").t(e.useAfter).up():e.useBefore&&this.firstTimeStamp?t.c("before").t(this.firstTimeStamp).up():t.c("before").t("").up(),await this.xmppService.sendIQ(t)}async onHistoryCallLogMessageReceived(e){const t=$(e);if(t.find("call_log").length>0)t.find("call_log").each(((e,i)=>{const r=$(i);r.attr("xmlns")===p.CALL_LOG_NOTIF_NAMESPACE&&r.length>0&&this.callLogPromises.push(this.createCallLogFromStanza(t,r))}));else if(t.find("count").length>0&&0===$(e).find("last").length&&0===$(e).find("first").length)this.logger.info("[CallLogService] onHistoryCallLogMessageReceived -- IQ count received"),this.startPromise&&(this.initialized=true,this.startPromiseResolve(),this.startPromiseResolve=null,this.startPromise=null);else if(t.find("count").length>0&&t.find("query").length>0&&($(e).find("last").length>0||"0"===t.find("count").text()||$(e).find("first").length>0))$(e).find("last").length&&(this.lastTimestamp=$(e).find("last").text()),$(e).find("first").length&&(this.firstTimeStamp=$(e).find("first").text()),this.logger.info("[CallLogService] onHistoryCallLogMessageReceived -- all calllogs received"),await Promise.all(this.callLogPromises).catch((()=>{})),this.callLogPromises=[],this.orderCallLogs(),this.startPromise&&(this.initialized=true,this.startPromiseResolve(),this.startPromiseResolve=null,this.startPromise=null),$(e).find("count").length&&(this.numberTotalCallLogs=parseInt($(e).find("count").text(),10)),setTimeout((async()=>{const e=await this.getNumberMissedCallLogsFromServer();e&&(this.logger.info("[CallLogService] onHistoryCallLogMessageReceived -- all calllogs received - still unread = "+e),this.ackAllCallLogsInDB())}),5e3);else if(t.find("deleted").length>0){const e=t.find("deleted").attr("count");e&&(this.numberTotalCallLogs-=parseInt(e,10)),this.orderCallLogs()}return true}onCallLogAckReceived(e){try{if($(e).find("read").length>0){const t=$(e).find("read").attr("call_id");this.callLogs.forEach((e=>{e.id!==t||(e.read=true)}));const i=this.getMissedCallLogCounter();i!==this.numberMissedCallLogs&&(this.numberMissedCallLogs=i,this.rxSubject.next({type:this.RAINBOW_ONCALLLOGMISSEDNUMBERUPDATED,value:this.numberMissedCallLogs}),this.eventService.publish(this.RAINBOW_ONCALLLOGACKUPDATED,this.numberMissedCallLogs),this.rxSubject.next({type:this.RAINBOW_ONCALLLOGACKUPDATED,value:this.numberMissedCallLogs}))}}catch(t){return this.logger.error("[CallLogService] onCallLogAckReceived -- failure with error "+t),true}return true}async onCallLogNotificationReceived(e){const t=$(e);try{if(t.find("deleted_call_log").length>0){const e=t.find("deleted_call_log").attr("peer"),i=t.find("deleted_call_log").attr("call_id");e?this.removeCallLogsForUser(e):i?this.removeOneCallLog(i):(this.callLogs=[],await this.getCallLogHistoryPage())}else t.find("updated_call_log").length>0&&(await this.createCallLogFromStanza(t,null).catch((()=>{})),this.orderCallLogs())}catch(i){return this.logger.error("[CallLogService] onCallLogAckReceived -- failure with error "+i),true}return true}onPersonalContactEvent(e){try{let t=false;switch(e.name){case h.PersonalDirectoryEvent.PERSONAL_DIRECTORY_ADD:if(e.data){const i=e.data;this.logger.debug(`[CallLogService] onPersonalContactEvent PERSONAL_DIRECTORY_ADD: Id = ${i.id} -- Display name = ${i.displayName}`),this.callLogs.forEach((e=>{if(!e.directoryContactId&&e.contact.temp){const i=e.contact.id,r=this.personalDirectoryService.getPersonalDirectoryContactFromNumber(i);r&&(this.logger.debug(`[CallLogService] onPersonalContactEvent -- Update display of Call log number '${e.contact.displayName}' to name '${r.displayName}'`),e.contact.displayName=r.displayName,e.directoryContactId=r.id,t=true)}})),t&&this.rxSubject.next({type:this.RAINBOW_ONCALLLOGINFOSUPDATED})}break;case h.PersonalDirectoryEvent.PERSONAL_DIRECTORY_UPDATE:if(e.data){const i=e.data;this.logger.debug(`[CallLogService] onPersonalContactEvent PERSONAL_DIRECTORY_UPDATE: Id = ${i.id} -- Display name = ${i.displayName}`),this.callLogs.forEach((e=>{const i=e.contact.id,r=this.personalDirectoryService.getPersonalDirectoryContactFromNumber(i);r?(this.logger.debug(`[CallLogService] onPersonalContactEvent -- Update display of Call log name '${e.contact.displayName}' to '${r.displayName}'`),e.contact.displayName=r.displayName,e.directoryContactId=r.id,t=true):e.directoryContactId&&(this.logger.debug(`[CallLogService] onPersonalContactEvent -- Reinit display of Call log name '${e.contact.displayName}' to number '${e.contact.phoneProCan}'`),e.contact.displayName=e.contact.phoneProCan,e.directoryContactId=null,t=true)})),t&&this.rxSubject.next({type:this.RAINBOW_ONCALLLOGINFOSUPDATED})}break;case h.PersonalDirectoryEvent.PERSONAL_DIRECTORY_DELETE:if(e.data){const i=e.data;this.logger.debug("[CallLogService] onPersonalContactEvent PERSONAL_DIRECTORY_DELETE: Id =  "+i),this.callLogs.forEach((e=>{e.directoryContactId===i&&(this.logger.debug(`[CallLogService] onPersonalContactEvent -- Reinit display of Call log name '${e.contact.displayName}' to number '${e.contact.phoneProCan}'`),e.contact.displayName=e.contact.phoneProCan,e.directoryContactId=null,t=true)})),t&&this.rxSubject.next({type:this.RAINBOW_ONCALLLOGINFOSUPDATED})}break;case h.PersonalDirectoryEvent.PERSONAL_DIRECTORY_DELETE_ALL:this.logger.debug("[CallLogService] onPersonalContactEvent PERSONAL_DIRECTORY_DELETE_ALL"),this.callLogs.forEach((e=>{e.directoryContactId&&(this.logger.debug(`[CallLogService] onPersonalContactEvent -- Reinit display of Call log name '${e.contact.displayName}' to number '${e.contact.phoneProCan}'`),e.contact.displayName=e.contact.phoneProCan,e.directoryContactId=null,t=true)})),t&&this.rxSubject.next({type:this.RAINBOW_ONCALLLOGINFOSUPDATED})}}catch(t){return this.logger.error("[CallLogService] onPersonalContactEvent -- failure with error "+t),true}return true}isInitialized(){return this.initialized}async getCalllogs(){return this.logger.info("[CallLogService] getCalllogs -- init status = "+this.initialized),await this.initialize(),this.callLogs}async getAggregatedCalllogs(){return this.logger.info("[CallLogService] getAggregatedCalllogs -- init status = "+this.initialized),await this.initialize(),this.aggregatedCallLogs}async getSimplifiedCallLogs(e=200){this.logger.info(`[CallLogService] getSimplifiedCallLogs -- init status = ${this.initialized}, number requested = ${e}`);const t={};return t.numberOfElementsToGet=e,await this.initialize(t),await this.orderAndSimplifyCallLogs()}async fetchNextPage(e=p.DEFAULT_CALL_LOG_FETCHED){this.logger.info(`[CallLogService] fetchNextPage -- init status = ${this.initialized}, number requested = ${e}`);const t={};if(!this.initialized){const e=new Error("[CallLogService] Fetch next page error - The service is not initialized through one of the APIs authorized to do so");return this.logger.error(e.message),Promise.reject(e)}if(this.fetchingCallLogs){const e=new Error("[CallLogService] Fetch next page error - A fetch of call logs is already is currently in progress. This request is ignored.");return this.logger.error(e.message),Promise.reject(e)}return this.fetchingCallLogs=true,t.numberOfElementsToGet=e,this.firstTimeStamp&&(t.useBefore=this.firstTimeStamp),await this.fetchCallLogsFromServer(t),this.fetchingCallLogs=false,await this.orderAndSimplifyCallLogs()}async orderAndSimplifyCallLogs(){return this.logger.debug("[CallLogService] orderAndSimplifyCallLogs"),await Promise.all(this.callLogPromises).catch((()=>{})),this.callLogPromises=[],this.callLogs=this.callLogs.sort(((e,t)=>t.date.getTime()-e.date.getTime())),this.callLogs.map((e=>({contact:e.contact.id,contactDisplayName:e.contact.displayName,read:e.read,contactInitials:e.contact.initials,id:e.id,state:e.state,date:e.date,duration:e.durationInfos,direction:e.direction,type:e.type,phonePro:e.contact.phoneProCan,calledNumber:e.calledNumber})))}prettifyCallLogs(e){this.logger.debug("[CallLogService] prettifyCallLogs"),e.sort(((e,t)=>Number(t.date)-Number(e.date)));for(let t=0;t<e.length;t++){let i=0,r=e[t].duration;if(r&&"string"==typeof r&&r.match(/^(?:(?:([01]?\d|2[0-3])H )?([0-5]?\d)m )?([0-5]?\ds)$/)){r=r.replace(/[hms]/g,"");const n=r.split(" ").reverse();for(let e=0;e<n.length;e++)i+=n[e]*Math.pow(60,e);e[t].duration=1e3*i}}return e}getNumberMissedCallLogs(){return this.logger.debug("[CallLogService] getNumberMissedCallLogs -- Number returned = "+this.numberMissedCallLogs),this.numberMissedCallLogs}getNumberTotalCallLogs(){return this.logger.debug("[CallLogService] getNumberTotalCallLogs -- Number returned = "+this.numberTotalCallLogs),this.numberTotalCallLogs}getMissedCallLogCounter(){let e=0;return this.callLogs.forEach((t=>{t.read||"missed"!==t.state||"incoming"!==t.direction||e++})),this.logger.debug("[CallLogService] getMissedCallLogCounter -- Number returned = "+e),e}markCallLogAsRead(e){this.logger.info("[CallLogService] markCallLogAsRead -- id = "+e);const t=$msg({from:this.xmppService.jid,to:this.xmppService.jid});t.c("read",{xmlns:p.CALL_LOG_ACK_NAMESPACE,call_id:e}),this.xmppService.send(t)}markAllCallsLogsAsRead(){this.logger.info("[CallLogService] markAllCallsLogsAsRead"),this.callLogs.forEach((e=>{if(!e.read){const t=$msg({from:this.xmppService.jid,to:this.xmppService.jid});t.c("read",{xmlns:p.CALL_LOG_ACK_NAMESPACE,call_id:e.id}),this.xmppService.send(t)}}))}async ackAllCallLogsInDB(){try{if(this.ackAllCallLogsInDBDone)return void this.logger.info("ackAllCallLogsInDB --- aready done -- ignore");this.ackAllCallLogsInDBDone=true,this.logger.warn(`ackAllCallLogsInDB --- used for ${this.numberMissedCallLogs} call-logs`);const e=$iq({from:this.xmppService.jid,type:"set"});e.c("markallread",{xmlns:p.CALL_LOG_NAMESPACE});const t=await this.xmppService.sendIQ(e);if($(t).find("error").length)return void this.logger.warn("ackAllCallLogsInDB --- error ...");await this.getNumberMissedCallLogsFromServer()}catch{return void this.logger.warn("ackAllCallLogsInDB --- error ...")}}async deleteCallLogsForContact(e){this.logger.info("[CallLogService] deleteCallLogsForContact -- contact jid = "+e);const t=$iq({from:this.xmppService.jid,to:this.xmppService.jid,type:"set"});return t.c("delete",{xmlns:p.CALL_LOG_NAMESPACE,peer:e}),this.xmppService.sendIQ(t)}async deleteOneCallLog(e){this.logger.info("[CallLogService] deleteOneCallLog -- call log id = "+e);const t=$iq({from:this.xmppService.jid,to:this.xmppService.jid,type:"set"}).c("delete",{xmlns:p.CALL_LOG_NAMESPACE,call_id:e});return this.xmppService.sendIQ(t)}async deleteAllCallLogs(){this.logger.info("[CallLogService] deleteAllCallLogs");const e=$iq({from:this.xmppService.jid,to:this.xmppService.jid,type:"set"});return e.c("delete",{xmlns:p.CALL_LOG_NAMESPACE}),this.xmppService.sendIQ(e)}removeCallLogsForUser(e){this.logger.debug("[CallLogService] removeCallLogsForUser -- user jid = "+e),e.endsWith("@_")&&(e=e.substring(0,e.length-2));const t=[];for(let i=0;i<this.callLogs.length;i++)(!this.callLogs[i].contact||this.callLogs[i].contact.jid!==e&&this.callLogs[i].contact.id!==e)&&t.push(this.callLogs[i]);this.callLogs=t}removeOneCallLog(e){this.logger.debug("[CallLogService] removeOneCallLog --  Call log id = "+e),this.callLogs=this.callLogs.filter((t=>t.id!==e))}async createCallLogFromStanza(e,t){let i=false;t?i=true:t=e;const r=t.find("call_id").text(),s=t.find("state").text();if(this.callLogs.some((e=>e.id===r||"failed"===s||"ongoing"===s)))return this.logger.debug("[CallLogService] createCallLogFromStanza --- ignore existing of wrong call-log"),null;const o=t.find("caller").text(),a=t.find("callee").text();if(o&&-1!==o.indexOf("janusgateway")||a&&-1!==a.indexOf("janusgateway"))return this.logger.debug("[CallLogService] createCallLogFromStanza --- ignore janusgateway call-log"),null;if(o&&this.webrtcGatewayService.isMediaPillarJid(o)||a&&this.webrtcGatewayService.isMediaPillarJid(a))return this.logger.debug("[CallLogService] createCallLogFromStanza --- ignore mediapillar call-log"),null;let c="webrtc",l=null,d=null,u=null;const h=this.xmppService.isConnectedJid(o),f=h?"outgoing":"incoming";let p=false;if(p=i?"conference"===t.attr("service"):"conference"===e.find("call_log").attr("service"),p)c="conference",l=o,-1===l.indexOf("@")&&(d=l,l=null);else{let r;r=i?t.attr("type"):e.find("call_log").attr("type"),r||(r=e.find("type").text()),"chat"===r&&e.find("call_log").attr("type"),"phone"===r&&(c="telephone"),l=h?a:o,-1===l.indexOf("@")&&(d=l,l=null,c="telephone")}if(l||d)try{let i=false,o=await this.contactService.getOrCreateContact(l,d);if(!p&&!l&&o.temp&&d){const e=this.contactService.getContactByPhoneNumber(d);e&&(o=e)}if(!p&&!l&&o.temp){i=true;let e=false;const r=this.usePhonebookDirectory?t.find("identity"):null;if(r&&r.length){const t=r.attr("firstName"),n=r.attr("lastName"),s=r.attr("displayName"),a=t||"";let c=n||"";""===c&&""===a&&s&&0!==s.length&&s!==d&&(c=s,e=true),(a.length||c.length)&&(this.logger.debug("[CallLogService] createCallLogFromStanza xNames updated from phonebook for contact "+o.id),e=true,o.updateName(a,c),i=false)}if(!e&&this.centralizedService)try{await this.centralizedService.outlook.updateContactFromOutlookInfos(o,d,true)?(i=false,this.logger.debug("[CallLogService] createCallLogFromStanza xNames updated from outlook for contact "+o.id)):this.logger.debug("[CallLogService] createCallLogFromStanza no update from outlook for contact "+o.id)}catch(g){this.logger.debug("[CallLogService] createCallLogFromMessage no outlook service for contact "+o.id)}let n=false;const s=/^[0-9A-D #\-\+\*\(\)\./]{1,32}$/;if(this.telephonyService.started){n=o.displayName.match(s)&&this.telephonyService.startAsPhoneNumber(o.displayName)}n&&o.phoneProCan&&""!==o.phoneProCan&&(o.displayName=o.phoneProCan)}"telephone"!==c||d||(h&&e.find("callee_info").length?d=e.find("callee_info").attr("number"):!h&&e.find("caller_info").length&&(d=e.find("caller_info").attr("number"))),"telephone"===c&&h&&e.find("callee_info")&&(u=e.find("callee_info").attr("calledNumber")),p||o.temp||o.phoneProCan||o.phonePbx||!d&&!u||(o.phoneProCan=d||u,o.phonePro||(o.phonePro=o.phoneProCan),o.phoneNumbersInitialized=true,this.eventService.publish("ON_CONTACT_UPDATED_EVENT",o));const a="true"===t.find("ack").attr("read");let m=parseInt(t.find("duration").text(),10);m=m>0?moment.duration(m,"ms").format("h[H] mm[m] ss[s]"):0;let v=e.find("delay").attr("stamp");v&&(v=new Date(v));const S=e.find("subject").text(),b=n.CallLog.create(r,o,s,m,c,a,v,f,S,false,u);if(i){const e=this.personalDirectoryService.getPersonalDirectoryContactFromNumber(d);e&&(b.contact.displayName=e.displayName,b.directoryContactId=e.id)}return this.callLogs.push(b),this.numberTotalCallLogs++,"answered"!==s||a||this.markCallLogAsRead(r),true}catch(g){return this.logger.error("[CallLogService] createCallLogFromStanza -- failure --- "+g),g}return false}orderCallLogs(){this.callLogs.sort(((e,t)=>n.CallLog.getDate(t)-n.CallLog.getDate(e))),this.aggregateCalllogs(),this.userFetchRequest||(this.logger.debug("[CallLogService] orderCallLogs -- Send event RAINBOW_ONCALLLOGUPDATED"),this.eventService.publish(this.RAINBOW_ONCALLLOGUPDATED),this.rxSubject.next({type:this.RAINBOW_ONCALLLOGUPDATED}));const e=this.getMissedCallLogCounter();e!==this.numberMissedCallLogs&&(this.numberMissedCallLogs=e,this.rxSubject.next({type:this.RAINBOW_ONCALLLOGMISSEDNUMBERUPDATED,value:this.numberMissedCallLogs}),this.eventService.publish(this.RAINBOW_ONCALLLOGACKUPDATED,this.numberMissedCallLogs),this.rxSubject.next({type:this.RAINBOW_ONCALLLOGACKUPDATED,value:this.numberMissedCallLogs}))}aggregateCalllogs(){let e=0;this.aggregatedCallLogs=[];const t={};this.callLogs.forEach(((i,r)=>{const n=i.contact.id;if("conference"===i.type)0!==r&&e++,this.aggregatedCallLogs[e]=i,this.aggregatedCallLogs[e].count=1,this.aggregatedCallLogs[e].editable=false;else if(0===r)t[n]=1,this.aggregatedCallLogs[e]=i,this.aggregatedCallLogs[e].count=1,this.aggregatedCallLogs[e].editable=true,"missed"===i.state&&"incoming"===i.direction?this.aggregatedCallLogs[e].isMissed=true:"missed"===i.state&&"outgoing"===i.direction&&(this.aggregatedCallLogs[e].isNotAnswered=true);else if(t[n]){const e=t[n],r=this.aggregatedCallLogs[e-1];r.editable&&(r.isMissed&&"missed"===i.state&&"incoming"===i.direction||r.isNotAnswered&&"missed"===i.state&&"outgoing"===i.direction?r.count++:r.editable=false)}else e++,t[n]=e+1,this.aggregatedCallLogs[e]=i,this.aggregatedCallLogs[e].count=1,this.aggregatedCallLogs[e].editable=true,"missed"===i.state&&"incoming"===i.direction?this.aggregatedCallLogs[e].isMissed=true:"missed"===i.state&&"outgoing"===i.direction&&(this.aggregatedCallLogs[e].isNotAnswered=true)}))}async fetchCallLogs(e=100){this.logger.info("[CallLogService] fetchPaginatedCallLogs --  number requested = "+e),this.userFetchRequest=true,e>p.MAX_CALL_LOG_FETCHED&&(e=p.MAX_CALL_LOG_FETCHED);let t=await this.getSimplifiedCallLogs(e);return t=this.prettifyCallLogs(t),this.userFetchRequest=false,t}async fetchPaginatedCallLogs(e=100){this.logger.info("[CallLogService] fetchPaginatedCallLogs -- number requested = "+e),this.userFetchRequest=true;let t=await this.fetchNextPage(e);return t=this.prettifyCallLogs(t),this.userFetchRequest=false,t}}p.CALL_LOG_NAMESPACE="jabber:iq:telephony:call_log",p.CALL_LOG_ACK_NAMESPACE="urn:xmpp:telephony:call_log:receipts",p.CALL_LOG_NOTIF_NAMESPACE="jabber:iq:notification:telephony:call_log",p.DEFAULT_CALL_LOG_FETCHED=75,p.MAX_CALL_LOG_FETCHED=250,t.CallLogService=p},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7),n=i(4),s=i(6),o=i(70),a=i(57),c=i(14),l=i(479),d=i(480),u=i(11),h=i(18),f=i(149);class p{constructor(){this.telephonyMode=l.TelephonyMode.create(),this.previousTelephonyMode=l.TelephonyMode.create(),this.forwardMode={immediate:d.ForwardMode.create(),busy:d.ForwardMode.create(),noreply:d.ForwardMode.create()},this.previousForwardMode={immediate:d.ForwardMode.create(),busy:d.ForwardMode.create(),noreply:d.ForwardMode.create()},this.currentTelephonyMode="",this.rxSubject=new r.Subject,this.logger=n.LoggerService.getInstance(),this.isTelephonyStarted=false,this.isNomadicFeatureAllowed=false,this.isNomadicFeatureActivated=false,this.isSipWise=false,this.isMediaPillarAvailable=false,this.contactService=s.ContactService.getInstance(),this.contact=null,this.isTelephonyAllowed=false,this.areTelephonySettingsEnabled=false,this.eventUnregisters=[],this.eventService=u.EventService.getInstance(),this.mediaPillarNumber="",this.isMediaPillarConfigured=false,this.profileService=c.ProfileService.getInstance(),this.is3dPartyFeatureActivated=false,this.isForwardFeatureAllowed=false,this.isNomadicModeActivated=false,this.isMakeCallInitiatorIsMain=false,this.nomadicPhone="",this.nomadicToNumber="",this.isCCDAgentProfilEnabled=false,this.isCCDAgentEnabled=false,this.webRTCDevice=null,this.sipDevice=null,this.telephonyService=a.TelephonyService.getInstance(),this.directoryService=f.DirectoryService.getInstance(),this.webrtcGatewayService=o.WebrtcGatewayService.getInstance(),this.handleNomadicState=(e,t)=>{if(this.isNomadicFeatureActivated=t.featureActivated,this.isNomadicFeatureActivated)if(this.mediaPillarNumber=this.webrtcGatewayService.getMyMediaPillarRemoteExtension(),this.isNomadicModeActivated=t.modeActivated,this.isMakeCallInitiatorIsMain=t.makeCallInitiatorIsMain,this.isMakeCallInitiatorIsMain)this.nomadicPhone="phonePro";else{const e=t.destination;this.contact.phoneProCan===e&&""!==e?this.nomadicPhone="phonePro":this.contact.mobileProCan===e&&""!==e?this.nomadicPhone="mobilePro":this.contact.phonePersoCan===e&&""!==e?this.nomadicPhone="phonePerso":this.contact.mobilePersoCan===e&&""!==e?this.nomadicPhone="mobilePerso":this.mediaPillarNumber===e?(this.nomadicPhone="mediaPillar",this.webrtcGatewayService.mediaPillarUserSelectAndPolling(true)):this.nomadicPhone="callNomadicToNumber",this.nomadicToNumber=e}this.isSipWise||(this.telephonyMode.computerModeAvailable=Boolean(this.isMediaPillarConfigured),this.telephonyMode.officePhoneModeAvailable=Boolean(!this.contact.isVirtualTerm)),this.telephonyMode.mobileProModeAvailable=Boolean(this.contact.mobilePro),this.telephonyMode.mobilePersoModeAvailable=Boolean(this.contact.mobilePerso),this.telephonyMode.phonePersoModeAvailable=Boolean(this.contact.phonePerso),this.telephonyMode.otherPhoneModeAvailable=Boolean(!this.is3dPartyFeatureActivated&&!this.isCCDAgentEnabled),this.computeMode()}}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.telephonyAbstractService||(e.rainbow.telephonyAbstractService=new p),e.rainbow.telephonyAbstractService}async start(){try{this.webrtcGatewayService=o.WebrtcGatewayService.getInstance(),this.logger.info("[TelephonyAbstractService] === STARTING ==="),this.previousTelephonyMode.setFromData(this.previousTelephonyMode,{currentMode:"dummyInit"}),this.computeTelephonySituation(),this.logger.info("[TelephonyAbstractService] === STARTED ===")}catch(e){}}async reconnect(){try{this.logger.info("[TelephonyAbstractService] reconnect"),this.computeTelephonySituation()}catch(e){this.logger.error("[TelephonyAbstractService] reconnect -- failure -- "+e.message)}}async stop(){this.logger.info("[TelephonyAbstractService] === STOPPING ==="),this.clearSubscriptions(),this.logger.info("=== STOPPED ===")}subscribe(e){return this.rxSubject.subscribe(e)}mediaPillarPollingManagement(e){this.isMediaPillarConfigured&&e!==l.TelephonyMode.modeType.COMPUTER&&this.webrtcGatewayService.mediaPillarUserSelectAndPolling(false)}async handleCallForwardedState(e,t,i="immediate"){if(!t)return this.forwardMode[i].currentMode=l.TelephonyMode.modeType.NOFORWARD,void(this.forwardMode[i].destination="");if("immediate"===i&&(void 0===t.forwardType||"Desactivation"===t.forwardType||void 0===t.forwardTo)||!t.activate&&"immediate"!==i)this.forwardMode[i].currentMode=l.TelephonyMode.modeType.NOFORWARD,this.forwardMode[i].destination="";else if("immediate"===i){switch(t.forwardTo){case"VOICEMAILBOX":this.forwardMode[i].currentMode=l.TelephonyMode.modeType.VOICEMAIL,this.forwardMode[i].destination="";break;case this.contact.mobileProCan:this.forwardMode[i].currentMode=l.TelephonyMode.modeType.MOBILEPRO,this.forwardMode[i].destination=t.forwardTo;break;case this.contact.phonePersoCan:this.forwardMode[i].currentMode=l.TelephonyMode.modeType.PHONEPERSO,this.forwardMode[i].destination=t.forwardTo;break;case this.contact.mobilePersoCan:this.forwardMode[i].currentMode=l.TelephonyMode.modeType.MOBILEPERSO,this.forwardMode[i].destination=t.forwardTo;break;default:this.forwardMode[i].currentMode=l.TelephonyMode.modeType.OTHERPHONE,this.forwardMode[i].destination=t.forwardTo}}else if("voicemail"===t.destinationType||"overflowvoicemail"===t.destinationType)this.forwardMode[i].currentMode=l.TelephonyMode.modeType.VOICEMAIL,this.forwardMode[i].destination="";else{let e;this.contact.mobileProCan===t.number?this.forwardMode[i].currentMode=l.TelephonyMode.modeType.MOBILEPRO:this.contact.phonePersoCan===t.number?this.forwardMode[i].currentMode=l.TelephonyMode.modeType.PHONEPERSO:this.contact.mobilePersoCan===t.number?this.forwardMode[i].currentMode=l.TelephonyMode.modeType.MOBILEPERSO:(e=await this.directoryService.searchUserByPhoneNumber(t.number))?(this.forwardMode[i].currentMode=l.TelephonyMode.modeType.CONTACT,this.forwardMode[i].destination=e.displayName):"internalnumber"===t.destinationType?(this.forwardMode[i].currentMode=l.TelephonyMode.modeType.CONTACT,this.forwardMode[i].destination=t.number):(this.forwardMode[i].currentMode=l.TelephonyMode.modeType.OTHERPHONE,this.forwardMode[i].destination=t.number)}this.forwardMode[i].changeModePossible=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_CALL_FORWARD),this.forwardMode[i].voiceMailModeAvailable=Boolean(this.telephonyService.voiceMailFeatureEnabled&&this.telephonyService.voicemailNumber),this.forwardMode[i].mobileProModeAvailable=Boolean(this.contact.mobilePro),this.forwardMode[i].mobilePersoModeAvailable=Boolean(this.contact.mobilePerso),this.forwardMode[i].phonePersoModeAvailable=Boolean(this.contact.phonePerso),this.forwardMode[i].otherPhoneModeAvailable=true,this.computeMode()}evalChangeModePossible(){this.telephonyMode.changeModePossible=this.telephonyMode.currentMode!==l.TelephonyMode.modeType.NOTELEPHONY&&!("EVT_SERVICE_INITIATED"===this.contact.telStatus||"EVT_ESTABLISHED"===this.contact.telStatus)}handleCallSipWiseState(e,t,i){t||this.logger.debug("[TelephonyAbstractService] handleCallSipWiseState : anomaly currentDeviceType"),this.webRTCDevice=i.devicesList.find((e=>"webrtc"===e.type)),this.sipDevice=i.devicesList.find((e=>"sip"===e.type)),this.telephonyMode.computerModeAvailable=Boolean(this.webRTCDevice),this.telephonyMode.officePhoneModeAvailable=Boolean(this.sipDevice),this.computeMode()}clearSubscriptions(){this.eventUnregisters&&this.eventUnregisters.length&&(this.eventUnregisters.forEach((e=>{e()})),this.eventUnregisters=[])}computeTelephonySituation(){this.clearSubscriptions(),this.contact=this.contactService.userContact,this.isSipWise=this.telephonyService.isSipWiseRoot(),this.isTelephonyAllowed=null!==this.contact.pbxId&&""!==this.contact.pbxId&&(null!==this.contact.phoneInternalNumber||this.contact.hasPhoneProDdiNumber),this.areTelephonySettingsEnabled=this.contact.telephonySettingsEnabled,this.isTelephonyAllowed&&(this.isTelephonyStarted=this.telephonyService.started,this.eventUnregisters.push(this.eventService.subscribe("ON_TELEPHONY_STATUS_CHANGED_EVENT",(()=>{this.isTelephonyStarted=this.telephonyService.started,this.mediaPillarNumber=this.webrtcGatewayService.getMyMediaPillarRemoteExtension(),this.handleNomadicState(null,this.telephonyService.nomadicObject)}))),this.isMediaPillarConfigured=this.webrtcGatewayService.isMediaPillarConfigured(),this.isMediaPillarAvailable=this.webrtcGatewayService.isMediaPillarAvailable(),this.mediaPillarNumber=this.webrtcGatewayService.getMyMediaPillarRemoteExtension(),this.eventUnregisters.push(this.eventService.subscribe("ON_WEBRTCGATEWAY_STATE_CHG",((e,t)=>{this.isMediaPillarAvailable=t,this.isMediaPillarConfigured=this.webrtcGatewayService.isMediaPillarConfigured(),this.mediaPillarNumber=this.webrtcGatewayService.getMyMediaPillarRemoteExtension(),this.computeMode()}))),this.isNomadicFeatureAllowed=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_NOMADIC),this.is3dPartyFeatureActivated=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_3DPARTY_WEBRTC_PSTN_CALLING),this.isCCDAgentProfilEnabled=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_CCD_AGENT),this.isCCDAgentEnabled=this.isCCDAgentProfilEnabled&&this.contact.isCCDAgentEnabled,this.eventUnregisters.push(this.eventService.subscribe("ON_CALL_NOMADIC_EVENT",this.handleNomadicState)),this.isSipWise?(this.eventUnregisters.push(this.eventService.subscribe("ON_SIPWISE_ROUTING_EVENT",((e,t,i)=>{this.handleCallSipWiseState(e,t,i)}))),this.telephonyService.getSipWiseRoutingInfo(),this.handleNomadicState(null,this.telephonyService.nomadicObject)):(this.eventUnregisters.push(this.eventService.subscribe("ON_PROFILE_UPDATED_EVENT",(()=>{this.handleNomadicState(null,this.telephonyService.nomadicObject)}))),this.handleNomadicState(null,this.telephonyService.nomadicObject)),this.isForwardFeatureAllowed=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_CALL_FORWARD),this.eventUnregisters.push(this.eventService.subscribe("ON_CALL_FORWARDED_EVENT",((e,t)=>{this.handleCallForwardedState(e,t)}))),this.eventUnregisters.push(this.eventService.subscribe("ON_CALL_FORWARDED_CONDI_EVENT",((e,t)=>{this.onConditionalCallForwardedEvent(e,t)}))),this.handleCallForwardedState(null,this.telephonyService.forwardObject),this.telephonyService.isSipWise()&&this.onConditionalCallForwardedEvent(null,this.telephonyService.getForwardObject()),this.eventUnregisters.push(this.eventService.subscribe("ON_UPDATE_MYTELEPHONY_STATUS_EVENT",(()=>{this.computeMode()}))),this.eventUnregisters.push(this.eventService.subscribe("ON_UPDATE_TELEPHONY_ICON_EVENT",(()=>{this.computeMode()}))))}computeMode(){this.isTelephonyStarted?this.isForwardFeatureAllowed||this.isNomadicFeatureAllowed||this.isNomadicFeatureActivated||this.isSipWise?this.isNomadicFeatureActivated&&!this.isSipWise?this.isMakeCallInitiatorIsMain&&!this.contact.isVirtualTerm?this.telephonyMode.currentMode=l.TelephonyMode.modeType.OFFICEPHONE:this.contact.isVirtualTerm&&""===this.nomadicToNumber||this.contact.isVirtualTerm&&this.isMakeCallInitiatorIsMain&&!this.isNomadicModeActivated?this.telephonyMode.currentMode=l.TelephonyMode.modeType.HELP:"mediaPillar"===this.nomadicPhone?this.isMediaPillarAvailable?this.telephonyMode.currentMode=l.TelephonyMode.modeType.COMPUTER:this.telephonyMode.currentMode=l.TelephonyMode.modeType.CALLWARN:"mobilePro"===this.nomadicPhone?this.telephonyMode.currentMode=l.TelephonyMode.modeType.MOBILEPRO:"phonePerso"===this.nomadicPhone?this.telephonyMode.currentMode=l.TelephonyMode.modeType.PHONEPERSO:"mobilePerso"===this.nomadicPhone?this.telephonyMode.currentMode=l.TelephonyMode.modeType.MOBILEPERSO:this.telephonyMode.currentMode=this.nomadicToNumber:this.isSipWise?this.webRTCDevice&&this.webRTCDevice.main?this.isMediaPillarAvailable?this.telephonyMode.currentMode=l.TelephonyMode.modeType.COMPUTER:this.telephonyMode.currentMode=l.TelephonyMode.modeType.NOTELEPHONY:this.sipDevice&&this.sipDevice.main&&(this.telephonyMode.currentMode=l.TelephonyMode.modeType.OFFICEPHONE):!this.isNomadicFeatureActivated&&this.contact.isVirtualTerm?this.telephonyMode.currentMode=l.TelephonyMode.modeType.HELP:this.currentTelephonyMode=l.TelephonyMode.modeType.OFFICEPHONE:this.telephonyMode.currentMode=l.TelephonyMode.modeType.OFFICEPHONE:this.telephonyMode.currentMode=l.TelephonyMode.modeType.NOTELEPHONY,this.evalChangeModePossible(),this.pullTelephonyMode(),this.pullForwardMode()}pullTelephonyMode(){JSON.stringify(this.telephonyMode)!==JSON.stringify(this.previousTelephonyMode)&&(this.logger.debug("[TelephonyAbstractService] pullTelephonyMode : evt trigged : "+JSON.stringify(this.telephonyMode)),this.rxSubject.next(new h.RBEvent("TELEPHONY_MODE_UPDATED",this.telephonyMode)),this.previousTelephonyMode.setFromData(this.previousTelephonyMode,this.telephonyMode))}async setTelephonyMode(e,t=""){if(this.telephonyMode.changeModePossible){if(!this.isSipWise)switch(e){case l.TelephonyMode.modeType.COMPUTER:this.telephonyService.nomadicLogin(this.mediaPillarNumber);break;case l.TelephonyMode.modeType.MOBILEPRO:this.telephonyService.nomadicLogin(this.contact.mobilePro);break;case l.TelephonyMode.modeType.PHONEPERSO:this.telephonyService.nomadicLogin(this.contact.phonePerso);break;case l.TelephonyMode.modeType.MOBILEPERSO:this.telephonyService.nomadicLogin(this.contact.mobilePerso);break;case l.TelephonyMode.modeType.OTHERPHONE:this.telephonyService.nomadicLogin(t);break;case l.TelephonyMode.modeType.OFFICEPHONE:if(this.contact.mobilePro||this.contact.mobilePerso){const e=this.contact.mobilePro?this.contact.mobilePro:this.contact.mobilePerso;await this.telephonyService.nomadicLogin(e,false,true),await this.telephonyService.nomadicLoginOnOfficePhone()}else this.telephonyService.nomadicLogout()}this.isSipWise&&(e===l.TelephonyMode.modeType.COMPUTER&&this.telephonyMode.computerModeAvailable?this.telephonyService.setSipWiseCurrentDevice(this.webRTCDevice.deviceId):e===l.TelephonyMode.modeType.OFFICEPHONE&&this.telephonyMode.officePhoneModeAvailable&&this.telephonyService.setSipWiseCurrentDevice(this.sipDevice.deviceId),this.mediaPillarPollingManagement(e))}}getTelephonyMode(){return this.telephonyMode}pullForwardMode(){JSON.stringify(this.forwardMode)!==JSON.stringify(this.previousForwardMode)&&(this.logger.debug("[TelephonyAbstractService] pullForwardMode : evt trigged : "+JSON.stringify(this.forwardMode)),this.rxSubject.next(new h.RBEvent("FORWARD_MODE_UPDATED",this.forwardMode)),this.previousForwardMode.immediate.setFromData(this.previousForwardMode.immediate,this.forwardMode.immediate),this.previousForwardMode.busy.setFromData(this.previousForwardMode.busy,this.forwardMode.busy),this.previousForwardMode.noreply.setFromData(this.previousForwardMode.busy,this.forwardMode.busy))}async setForwardMode(e,t="",i=d.ForwardMode.conditionalForwardType.IMMEDIATE){if(this.forwardMode[i].changeModePossible)try{if(this.telephonyService.isSipWise()){if(this.telephonyService.isSipWise())switch(e){case l.TelephonyMode.modeType.VOICEMAIL:await this.telephonyService.forwardToVoicemail(i);break;case l.TelephonyMode.modeType.CONTACT:await this.telephonyService.sipWiseForwardToDevice(t,"internalNumber",i);break;case l.TelephonyMode.modeType.MOBILEPRO:await this.telephonyService.sipWiseForwardToDevice(this.contact.mobilePro,"externalNumber",i);break;case l.TelephonyMode.modeType.PHONEPERSO:await this.telephonyService.sipWiseForwardToDevice(this.contact.phonePerso,"externalNumber",i);break;case l.TelephonyMode.modeType.MOBILEPERSO:await this.telephonyService.sipWiseForwardToDevice(this.contact.mobilePerso,"externalNumber",i);break;case l.TelephonyMode.modeType.OTHERPHONE:await this.telephonyService.sipWiseForwardToDevice(t,"externalNumber",i);break;case l.TelephonyMode.modeType.NOFORWARD:await this.telephonyService.sipWiseCancelForward(i)}}else switch(e){case l.TelephonyMode.modeType.VOICEMAIL:await this.telephonyService.forwardToVoicemail(i);break;case l.TelephonyMode.modeType.MOBILEPRO:await this.telephonyService.forwardToDevice(this.contact.mobilePro,i);break;case l.TelephonyMode.modeType.PHONEPERSO:await this.telephonyService.forwardToDevice(this.contact.phonePerso,i);break;case l.TelephonyMode.modeType.MOBILEPERSO:await this.telephonyService.forwardToDevice(this.contact.mobilePerso,i);break;case l.TelephonyMode.modeType.OTHERPHONE:await this.telephonyService.forwardToDevice(t,i);break;case l.TelephonyMode.modeType.NOFORWARD:await this.telephonyService.cancelForward()}}catch(r){throw this.logger.error("[TelephonyAbstractService] setForwardMode : error "+r),r}}async onConditionalCallForwardedEvent(e,t){this.handleCallForwardedState(null,t.busy,d.ForwardMode.conditionalForwardType.BUSY),this.handleCallForwardedState(null,t.noreply,d.ForwardMode.conditionalForwardType.NOREPLY)}getForwardMode(){return this.forwardMode}}t.TelephonyAbstractService=p},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(330);t.ConversationSDK=class{constructor(e){this.isFavorite=false,this.messages=[],this.id=e.dbId,this.type=e.type,this.contactId=e.contact?e.contact.dbId:null,this.bubbleId=e.room?e.room.dbId:null,this.name=e.name?e.name.value:null,this.bubbleName=e.room?e.room.name:null,this.creationDate=e.creationDate,this.lastModificiationDate=e.lastModification,this.isFavorite=e.isFavorite,this.messages=e.messages?e.messages.map((e=>new r.MessageSDK(e))):[],this.lastMessage=e.lastMessageText}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});t.MessageSDK=class{constructor(e,t=null){this.shortFileDescriptor=null,this.additionalContent=e.additionalContent,this.answeredMsgId=e.answeredMsgId,this.id=e.id,this.type=e.type.value,this.data=e.data,this.date=e.date,this.senderId=e.from?e.from.dbId:"",this.isForwarded=e.isForwarded,this.receiptStatus=e.receiptStatus,this.status=e.status,this.urgency=e.urgency,this.shortFileDescriptor=t,this.fileId=e.fileId||"",this.messageHistory=e.replaceMsgs,this.side=e.side}}},function(e,t,i){var r=i(91);function n(e,t,i,n,s){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":s||"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var c="msid:"+(n?n.id:"-")+" "+a+"\r\n";o+="a="+c,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o}function s(e,t){var i={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var i=0;i<t.length;i++)if(t[i].payloadType===e||t[i].preferredPayloadType===e)return t[i]},n=function(e,t,i,n){var s=r(e.parameters.apt,i),o=r(t.parameters.apt,n);return s&&o&&s.name.toLowerCase()===o.name.toLowerCase()};return e.codecs.forEach((function(r){for(var s=0;s<t.codecs.length;s++){var o=t.codecs[s];if(r.name.toLowerCase()===o.name.toLowerCase()&&r.clockRate===o.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&o.parameters.apt&&!n(r,o,e.codecs,t.codecs))continue;(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(r.numChannels,o.numChannels),i.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter((function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return true;return false}));break}}})),e.headerExtensions.forEach((function(e){for(var r=0;r<t.headerExtensions.length;r++){var n=t.headerExtensions[r];if(e.uri===n.uri){i.headerExtensions.push(n);break}}})),i}function o(e,t,i){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(i)}function a(e,t){var i=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return i||e.addRemoteCandidate(t),!i}function c(e,t){var i=new Error(t);return i.name=e,i.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],i}e.exports=function(e,t){function i(t,i){i.addTrack(t),i.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function l(t,i,r,n){var s=new Event("track");s.track=i,s.receiver=r,s.transceiver={receiver:r},s.streams=n,e.setTimeout((function(){t._dispatchEvent("track",s)}))}var d=function(i){var n=this,s=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){n[e]=s[e].bind(s)})),this.canTrickleIceCandidates=null,this.needNegotiation=false,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",i=JSON.parse(JSON.stringify(i||{})),this.usingBundle="max-bundle"===i.bundlePolicy,"negotiate"===i.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(i.rtcpMuxPolicy||(i.rtcpMuxPolicy="require"),i.iceTransportPolicy){case"all":case"relay":break;default:i.iceTransportPolicy="all"}switch(i.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:i.bundlePolicy="balanced"}if(i.iceServers=function(e,t){var i=false;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var n="string"==typeof r;return n&&(r=[r]),r=r.filter((function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!i?(i=true,true):0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")})),delete e.url,e.urls=n?r[0]:r,!!r.length}}))}(i.iceServers||[],t),this._iceGatherers=[],i.iceCandidatePoolSize)for(var o=i.iceCandidatePoolSize;o>0;o--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:i.iceServers,gatherPolicy:i.iceTransportPolicy}));else i.iceCandidatePoolSize=0;this._config=i,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=false};Object.defineProperty(d.prototype,"localDescription",{configurable:true,get:function(){return this._localDescription}}),Object.defineProperty(d.prototype,"remoteDescription",{configurable:true,get:function(){return this._remoteDescription}}),d.prototype.onicecandidate=null,d.prototype.onaddstream=null,d.prototype.ontrack=null,d.prototype.onremovestream=null,d.prototype.onsignalingstatechange=null,d.prototype.oniceconnectionstatechange=null,d.prototype.onconnectionstatechange=null,d.prototype.onicegatheringstatechange=null,d.prototype.onnegotiationneeded=null,d.prototype.ondatachannel=null,d.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},d.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},d.prototype.getConfiguration=function(){return this._config},d.prototype.getLocalStreams=function(){return this.localStreams},d.prototype.getRemoteStreams=function(){return this.remoteStreams},d.prototype._createTransceiver=function(e,t){var i=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:true};if(this.usingBundle&&i)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var n=this._createIceAndDtlsTransports();r.iceTransport=n.iceTransport,r.dtlsTransport=n.dtlsTransport}return t||this.transceivers.push(r),r},d.prototype.addTrack=function(t,i){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find((function(e){return e.track===t})))throw c("InvalidAccessError","Track already exists.");for(var n=0;n<this.transceivers.length;n++)this.transceivers[n].track||this.transceivers[n].kind!==t.kind||(r=this.transceivers[n]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(i)&&this.localStreams.push(i),r.track=t,r.stream=i,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},d.prototype.addStream=function(e){var i=this;if(t>=15025)e.getTracks().forEach((function(t){i.addTrack(t,e)}));else{var r=e.clone();e.getTracks().forEach((function(e,t){var i=r.getTracks()[t];e.addEventListener("enabled",(function(e){i.enabled=e.enabled}))})),r.getTracks().forEach((function(e){i.addTrack(e,r)}))}},d.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var i=this.transceivers.find((function(e){return e.rtpSender===t}));if(!i)throw c("InvalidAccessError","Sender was not created by this connection.");var r=i.stream;i.rtpSender.stop(),i.rtpSender=null,i.track=null,i.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},d.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var i=t.getSenders().find((function(t){return t.track===e}));i&&t.removeTrack(i)}))},d.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},d.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},d.prototype._createIceGatherer=function(t,i){var r=this;if(i&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var n=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(n,"state",{value:"new",writable:true}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var i=!e.candidate||0===Object.keys(e.candidate).length;n.state=i?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},n.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),n},d.prototype._gather=function(t,i){var n=this,s=this.transceivers[i].iceGatherer;if(!s.onlocalcandidate){var o=this.transceivers[i].bufferedCandidateEvents;this.transceivers[i].bufferedCandidateEvents=null,s.removeEventListener("localcandidate",this.transceivers[i].bufferCandidates),s.onlocalcandidate=function(e){if(!(n.usingBundle&&i>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:i};var a=e.candidate,c=!a||0===Object.keys(a).length;if(c)"new"!==s.state&&"gathering"!==s.state||(s.state="completed");else{"new"===s.state&&(s.state="gathering"),a.component=1,a.ufrag=s.getLocalParameters().usernameFragment;var l=r.writeCandidate(a);o.candidate=Object.assign(o.candidate,r.parseCandidate(l)),o.candidate.candidate=l,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var d=r.getMediaSections(n._localDescription.sdp);d[o.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",n._localDescription.sdp=r.getDescription(n._localDescription.sdp)+d.join("");var u=n.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==n.iceGatheringState&&(n.iceGatheringState="gathering",n._emitGatheringStateChange()),c||n._dispatchEvent("icecandidate",o),u&&(n._dispatchEvent("icecandidate",new Event("icecandidate")),n.iceGatheringState="complete",n._emitGatheringStateChange())}},e.setTimeout((function(){o.forEach((function(e){s.onlocalcandidate(e)}))}),0)}},d.prototype._createIceAndDtlsTransports=function(){var t=this,i=new e.RTCIceTransport(null);i.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(i);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:true}),t._updateConnectionState()},{iceTransport:i,dtlsTransport:r}},d.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var i=this.transceivers[e].iceTransport;i&&(delete i.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},d.prototype._transceive=function(e,i,n){var o=s(e.localCapabilities,e.remoteCapabilities);i&&e.rtpSender&&(o.encodings=e.sendEncodingParameters,o.rtcp={cname:r.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(o.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(o)),n&&e.rtpReceiver&&o.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?o.encodings=e.recvEncodingParameters:o.encodings=[{}],o.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(o.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(o.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(o))},d.prototype.setLocalDescription=function(e){var t,i,n=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!o("setLocalDescription",e.type,n.signalingState)||n._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+n.signalingState));if("offer"===e.type)t=r.splitSections(e.sdp),i=t.shift(),t.forEach((function(e,t){var i=r.parseRtpParameters(e);n.transceivers[t].localCapabilities=i})),n.transceivers.forEach((function(e,t){n._gather(e.mid,t)}));else if("answer"===e.type){t=r.splitSections(n._remoteDescription.sdp),i=t.shift();var a=r.matchPrefix(i,"a=ice-lite").length>0;t.forEach((function(e,t){var o=n.transceivers[t],c=o.iceGatherer,l=o.iceTransport,d=o.dtlsTransport,u=o.localCapabilities,h=o.remoteCapabilities;if(!(r.isRejected(e)&&0===r.matchPrefix(e,"a=bundle-only").length)&&!o.rejected){var f=r.getIceParameters(e,i),p=r.getDtlsParameters(e,i);a&&(p.role="server"),n.usingBundle&&0!==t||(n._gather(o.mid,t),"new"===l.state&&l.start(c,f,a?"controlling":"controlled"),"new"===d.state&&d.start(p));var g=s(u,h);n._transceive(o,g.codecs.length>0,false)}}))}return n._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?n._updateSignalingState("have-local-offer"):n._updateSignalingState("stable"),Promise.resolve()},d.prototype.setRemoteDescription=function(n){var d=this;if(-1===["offer","answer"].indexOf(n.type))return Promise.reject(c("TypeError",'Unsupported type "'+n.type+'"'));if(!o("setRemoteDescription",n.type,d.signalingState)||d._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+n.type+" in state "+d.signalingState));var u={};d.remoteStreams.forEach((function(e){u[e.id]=e}));var h=[],f=r.splitSections(n.sdp),p=f.shift(),g=r.matchPrefix(p,"a=ice-lite").length>0,m=r.matchPrefix(p,"a=group:BUNDLE ").length>0;d.usingBundle=m;var v=r.matchPrefix(p,"a=ice-options:")[0];return d.canTrickleIceCandidates=!!v&&v.substr(14).split(" ").indexOf("trickle")>=0,f.forEach((function(o,c){var l=r.splitLines(o),f=r.getKind(o),v=r.isRejected(o)&&0===r.matchPrefix(o,"a=bundle-only").length,S=l[0].substr(2).split(" ")[2],b=r.getDirection(o,p),y=r.parseMsid(o),C=r.getMid(o)||r.generateIdentifier();if(v||"application"===f&&("DTLS/SCTP"===S||"UDP/DTLS/SCTP"===S))d.transceivers[c]={mid:C,kind:f,protocol:S,rejected:true};else{var w,_,E,T,I,P,A,M,D;!v&&d.transceivers[c]&&d.transceivers[c].rejected&&(d.transceivers[c]=d._createTransceiver(f,true));var R,O,N=r.parseRtpParameters(o);v||(R=r.getIceParameters(o,p),(O=r.getDtlsParameters(o,p)).role="client"),A=r.parseRtpEncodingParameters(o);var x=r.parseRtcpParameters(o),L=r.matchPrefix(o,"a=end-of-candidates",p).length>0,k=r.matchPrefix(o,"a=candidate:").map((function(e){return r.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===n.type||"answer"===n.type)&&!v&&m&&c>0&&d.transceivers[c]&&(d._disposeIceAndDtlsTransports(c),d.transceivers[c].iceGatherer=d.transceivers[0].iceGatherer,d.transceivers[c].iceTransport=d.transceivers[0].iceTransport,d.transceivers[c].dtlsTransport=d.transceivers[0].dtlsTransport,d.transceivers[c].rtpSender&&d.transceivers[c].rtpSender.setTransport(d.transceivers[0].dtlsTransport),d.transceivers[c].rtpReceiver&&d.transceivers[c].rtpReceiver.setTransport(d.transceivers[0].dtlsTransport)),"offer"!==n.type||v){if("answer"===n.type&&!v){_=(w=d.transceivers[c]).iceGatherer,E=w.iceTransport,T=w.dtlsTransport,I=w.rtpReceiver,P=w.sendEncodingParameters,M=w.localCapabilities,d.transceivers[c].recvEncodingParameters=A,d.transceivers[c].remoteCapabilities=N,d.transceivers[c].rtcpParameters=x,k.length&&"new"===E.state&&(!g&&!L||m&&0!==c?k.forEach((function(e){a(w.iceTransport,e)})):E.setRemoteCandidates(k)),m&&0!==c||("new"===E.state&&E.start(_,R,"controlling"),"new"===T.state&&T.start(O)),!s(w.localCapabilities,w.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&w.sendEncodingParameters[0].rtx&&delete w.sendEncodingParameters[0].rtx,d._transceive(w,"sendrecv"===b||"recvonly"===b,"sendrecv"===b||"sendonly"===b),!I||"sendrecv"!==b&&"sendonly"!==b?delete w.rtpReceiver:(D=I.track,y?(u[y.stream]||(u[y.stream]=new e.MediaStream),i(D,u[y.stream]),h.push([D,I,u[y.stream]])):(u.default||(u.default=new e.MediaStream),i(D,u.default),h.push([D,I,u.default])))}}else{(w=d.transceivers[c]||d._createTransceiver(f)).mid=C,w.iceGatherer||(w.iceGatherer=d._createIceGatherer(c,m)),k.length&&"new"===w.iceTransport.state&&(!L||m&&0!==c?k.forEach((function(e){a(w.iceTransport,e)})):w.iceTransport.setRemoteCandidates(k)),M=e.RTCRtpReceiver.getCapabilities(f),t<15019&&(M.codecs=M.codecs.filter((function(e){return"rtx"!==e.name}))),P=w.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var F,U=false;if("sendrecv"===b||"sendonly"===b){if(U=!w.rtpReceiver,I=w.rtpReceiver||new e.RTCRtpReceiver(w.dtlsTransport,f),U)D=I.track,y&&"-"===y.stream||(y?(u[y.stream]||(u[y.stream]=new e.MediaStream,Object.defineProperty(u[y.stream],"id",{get:function(){return y.stream}})),Object.defineProperty(D,"id",{get:function(){return y.track}}),F=u[y.stream]):(u.default||(u.default=new e.MediaStream),F=u.default)),F&&(i(D,F),w.associatedRemoteMediaStreams.push(F)),h.push([D,I,F])}else w.rtpReceiver&&w.rtpReceiver.track&&(w.associatedRemoteMediaStreams.forEach((function(t){var i=t.getTracks().find((function(e){return e.id===w.rtpReceiver.track.id}));i&&function(t,i){i.removeTrack(t),i.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(i,t)})),w.associatedRemoteMediaStreams=[]);w.localCapabilities=M,w.remoteCapabilities=N,w.rtpReceiver=I,w.rtcpParameters=x,w.sendEncodingParameters=P,w.recvEncodingParameters=A,d._transceive(d.transceivers[c],false,U)}}})),void 0===d._dtlsRole&&(d._dtlsRole="offer"===n.type?"active":"passive"),d._remoteDescription={type:n.type,sdp:n.sdp},"offer"===n.type?d._updateSignalingState("have-remote-offer"):d._updateSignalingState("stable"),Object.keys(u).forEach((function(t){var i=u[t];if(i.getTracks().length){if(-1===d.remoteStreams.indexOf(i)){d.remoteStreams.push(i);var r=new Event("addstream");r.stream=i,e.setTimeout((function(){d._dispatchEvent("addstream",r)}))}h.forEach((function(e){var t=e[0],r=e[1];i.id===e[2].id&&l(d,t,r,[i])}))}})),h.forEach((function(e){e[2]||l(d,e[0],e[1],[])})),e.setTimeout((function(){d&&d.transceivers&&d.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},d.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=true,this._updateSignalingState("closed")},d.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},d.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&true!==this.needNegotiation&&(this.needNegotiation=true,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=false;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},d.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var i=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",i)}},d.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var i=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",i)}},d.prototype.createOffer=function(){var i=this;if(i._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var s=i.transceivers.filter((function(e){return"audio"===e.kind})).length,o=i.transceivers.filter((function(e){return"video"===e.kind})).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(s=true===a.offerToReceiveAudio?1:false===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(o=true===a.offerToReceiveVideo?1:false===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(i.transceivers.forEach((function(e){"audio"===e.kind?--s<0&&(e.wantReceive=false):"video"===e.kind&&--o<0&&(e.wantReceive=false)}));s>0||o>0;)s>0&&(i._createTransceiver("audio"),s--),o>0&&(i._createTransceiver("video"),o--);var l=r.writeSessionBoilerplate(i._sdpSessionId,i._sdpSessionVersion++);i.transceivers.forEach((function(n,s){var o=n.track,a=n.kind,c=n.mid||r.generateIdentifier();n.mid=c,n.iceGatherer||(n.iceGatherer=i._createIceGatherer(s,i.usingBundle));var l=e.RTCRtpSender.getCapabilities(a);t<15019&&(l.codecs=l.codecs.filter((function(e){return"rtx"!==e.name}))),l.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),n.remoteCapabilities&&n.remoteCapabilities.codecs&&n.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),l.headerExtensions.forEach((function(e){(n.remoteCapabilities&&n.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var d=n.sendEncodingParameters||[{ssrc:1001*(2*s+1)}];o&&t>=15019&&"video"===a&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),n.wantReceive&&(n.rtpReceiver=new e.RTCRtpReceiver(n.dtlsTransport,a)),n.localCapabilities=l,n.sendEncodingParameters=d})),"max-compat"!==i._config.bundlePolicy&&(l+="a=group:BUNDLE "+i.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),l+="a=ice-options:trickle\r\n",i.transceivers.forEach((function(e,t){l+=n(e,e.localCapabilities,"offer",e.stream,i._dtlsRole),l+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===i.iceGatheringState||0!==t&&i.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,l+="a="+r.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(l+="a=end-of-candidates\r\n"))}));var d=new e.RTCSessionDescription({type:"offer",sdp:l});return Promise.resolve(d)},d.prototype.createAnswer=function(){var i=this;if(i._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==i.signalingState&&"have-local-pranswer"!==i.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+i.signalingState));var o=r.writeSessionBoilerplate(i._sdpSessionId,i._sdpSessionVersion++);i.usingBundle&&(o+="a=group:BUNDLE "+i.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),o+="a=ice-options:trickle\r\n";var a=r.getMediaSections(i._remoteDescription.sdp).length;i.transceivers.forEach((function(e,r){if(!(r+1>a)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?o+="m=application 0 DTLS/SCTP 5000\r\n":o+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?o+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(o+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(o+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;if(e.stream)"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var l=s(e.localCapabilities,e.remoteCapabilities);!l.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,o+=n(e,l,"answer",e.stream,i._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(o+="a=rtcp-rsize\r\n")}}));var l=new e.RTCSessionDescription({type:"answer",sdp:o});return Promise.resolve(l)},d.prototype.addIceCandidate=function(e){var t,i=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(n,s){if(!i._remoteDescription)return s(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid){for(var l=0;l<i.transceivers.length;l++)if(i.transceivers[l].mid===e.sdpMid){o=l;break}}var d=i.transceivers[o];if(!d)return s(c("OperationError","Can not add ICE candidate"));if(d.rejected)return n();var u=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if("tcp"===u.protocol&&(0===u.port||9===u.port))return n();if(u.component&&1!==u.component)return n();if((0===o||o>0&&d.iceTransport!==i.transceivers[0].iceTransport)&&!a(d.iceTransport,u))return s(c("OperationError","Can not add ICE candidate"));var h=e.candidate.trim();0===h.indexOf("a=")&&(h=h.substr(2)),(t=r.getMediaSections(i._remoteDescription.sdp))[o]+="a="+(u.type?h:"end-of-candidates")+"\r\n",i._remoteDescription.sdp=r.getDescription(i._remoteDescription.sdp)+t.join("")}else for(var f=0;f<i.transceivers.length&&(i.transceivers[f].rejected||(i.transceivers[f].iceTransport.addRemoteCandidate({}),(t=r.getMediaSections(i._remoteDescription.sdp))[f]+="a=end-of-candidates\r\n",i._remoteDescription.sdp=r.getDescription(i._remoteDescription.sdp)+t.join(""),!i.usingBundle));f++);n()}))},d.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var i=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?i=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(i=e.rtpReceiver)})),!i)throw c("InvalidAccessError","Invalid selector.");return i.getStats()}var r=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&r.push(e[t].getStats())}))})),Promise.all(r).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var i=e[t];if(i&&i.prototype&&i.prototype.getStats){var r=i.prototype.getStats;i.prototype.getStats=function(){return r.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(i){var r;e[i].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(r=e[i]).type]||r.type,t.set(i,e[i])})),t}))}}}));var u=["createOffer","createAnswer"];return u.forEach((function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(u=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),d}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(169),n=i(6),s=i(19),o=i(8),a=i(7),c=i(18),l=i(9),d=i(14),u=i(30),h=i(4),f=i(67),p=i(17),g=i(13),m=i(43),v=i(34),S=i(11),b=i(56);class y{constructor(e,t,i,r,c,y,C,w){this.$q=e,this.$rootScope=t,this.$log=i,this.$http=r,this.$interval=c,this.errorHelperService=y,this.ConferenceSession=C,this.Conference=w,this.MEDIATYPE={WEBRTC:"webrtc",WEBRTCSHARINGONLY:"webrtcSharingOnly",PSTNAUDIO:"pstnAudio"},this.xmppConnectionSubscription=null,this.deviceManagementSubscription=null,this.videoServiceSubscription=null,this.started=false,this.webConferenceRoom=null,this.webrtcConferenceId=null,this.webrtcSharingOnlyRoom=null,this.webrtcSharingOnlyConferenceId=null,this.jingleJid=null,this.makingCall=false,this.mozaicViewModeValue=true,this.connected=false,this.disconnecting=false,this.reconnecting={},this.audioProfileChanging=false,this.activeSpeaker=false,this.disableAutoUpdateSubstreamLevels=false,this.disableAutoFillForGalleryElements=false,this.addingMedia=false,this.settingsService=s.SettingsService.getInstance(),this.authService=o.AuthService.getInstance(),this.xmppService=l.XmppService.getInstance(),this.profileService=d.ProfileService.getInstance(),this.contactService=n.ContactService.getInstance(),this.roomService=u.RoomService.getInstance(),this.virtualBackgroundService=f.VirtualBackgroundService.getInstance(),this.mainService=p.MainService.getInstance(),this.newErrorHelperService=g.ErrorHelperService.getInstance(),this.webrtcConfigAndUtils=m.WebrtcConfigAndUtils.getInstance(),this.webrtcP2PService=v.WebrtcP2PService.getInstance(),this.eventService=S.EventService.getInstance(),this.deviceManagementService=b.DeviceManagementService.getInstance(),this.conferenceEndpoints={},this.conferenceSessions={},this.rxSubject=new a.Subject,this.logger=h.LoggerService.getInstance(),this.defaultConferenceLayout="gallery_view",this.replaceBackgroundSubscription=null,this.attachLocalMediaStream=(e,t)=>{if(e){let e=false;if((t.hasLocalVideo||t.hasLocalSharing)&&(e=this.hasRemoteVideoOrSharingSession(t.id)),t.hasLocalVideo){const i=t.sessions[t.localVideoSessionId];if(i){const r=t.localStreams[i.localStreamId];e||t.hasLocalSharing||this.webrtcP2PService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),r,i.sid),this.webrtcP2PService.RTC.attachMediaStreamIfNeeded(angular.element("#conferenceVideoPip"),r,i.sid)}}if(t.hasLocalSharing){const i=t.sessions[t.localSharingSessionId];if(i){const r=t.localStreams[i.localStreamId];e?this.webrtcP2PService.RTC.attachMediaStreamIfNeeded(angular.element("#conferenceSharingPip"),r,i.sid):this.webrtcP2PService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),r,i.sid)}}}else this.webrtcP2PService.RTC.clearMediaStream(angular.element("#minivideo"),null)}}start(){return this.contactService.userContact&&!this.contactService.userContact.roomsEnabled?(this.$log.info("[WebConferenceService] === start skipped - roomsEnabled : "+this.contactService.userContact.roomsEnabled),this.$q.when()):this.$q((e=>{this.$log.info("[WebConferenceService] === STARTING ==="),this.confProvPortalURL=config.restServerUrl+"/api/rainbow/confprovisioning/v1.0/",this.confPortalURL=config.restServerUrl+"/api/rainbow/conference/v1.0/conferences/",this.conferenceEndpoints={},this.conferenceSessions={},this.listeners=[],this.statsIntervals=[],this.connected=true,this.disconnecting=false,this.webConferenceRoom=null,this.webrtcConferenceId=null,this.webrtcSharingOnlyRoom=null,this.webrtcSharingOnlyConferenceId=null,this.jingleJid=null,this.makingCall=false,this.videoGalleryElements=[],this.activeSpeaker=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.BUBBLE_ACTIVE_SPEAKER),this.attachHandlers(),this.videoGalleryElementsNumber=5,this.videoGridElementsNumber=12,this.started=true,this.$log.info("[WebConferenceService] === STARTED ==="),e()}))}stop(){return this.contactService.userContact&&!this.contactService.userContact.roomsEnabled?(this.$log.info("[WebConferenceService] === stop skipped - roomsEnabled : "+this.contactService.userContact.roomsEnabled),this.$q.when()):(this.$log.info("[WebConferenceService] === STOPPING ==="),this.started=false,this.makingCall=false,this.xmppConnectionSubscription&&this.xmppConnectionSubscription.unsubscribe(),this.deviceManagementSubscription&&this.deviceManagementSubscription.unsubscribe(),this.videoServiceSubscription&&(this.videoServiceSubscription.unsubscribe(),this.videoServiceSubscription=null),this.listeners&&this.listeners.forEach((e=>{e()})),this.$log.info("[WebConferenceService] === STOPPED ==="),this.$q.when())}attachHandlers(){this.xmppConnectionSubscription=this.xmppService.subscribeToConnectionEvents((e=>{this.$log.info("[WebConferenceService] onConnectionStateChangeEvent : "+e.name);try{"ON_XMPP_DISCONNECTED"===e.name?(this.$log.info("[WebConferenceService] onConnectionStateChangeEvent : disconnected"),this.connected=false):"ON_XMPP_CONNECTED"===e.name&&(this.$log.info("[WebConferenceService] onConnectionStateChangeEvent : connected"),this.connected=true,this.reconnectAllActiveConferenceSessions())}catch(t){this.$log.info("[WebConferenceService] onConnectionStateChangeEvent error : "+t)}})),this.replaceBackgroundSubscription&&(this.replaceBackgroundSubscription.unsubscribe(),this.replaceBackgroundSubscription=null),this.replaceBackgroundSubscription=this.virtualBackgroundService.rxSubject.subscribe((e=>{"UPDATE_STREAM"===e.name&&this.onReplaceBackgroundChangeEvent(e)})),this.deviceManagementSubscription&&(this.deviceManagementSubscription.unsubscribe(),this.deviceManagementSubscription=null),this.deviceManagementSubscription=this.deviceManagementService.subscribe((e=>{try{e.name===this.deviceManagementService.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED&&"audioinput"===e.data.kind&&this.onAudioProfileChangeEvent()}catch{}})),this.videoServiceSubscription&&(this.videoServiceSubscription.unsubscribe(),this.videoServiceSubscription=null),this.videoServiceSubscription=this.webrtcP2PService.subscribe((e=>{this.onWebrtcP2PService(e)}))}onWebrtcP2PService(e){try{if("ON_CHROME_STOP_SCREEN_SHARING_TRIGGERED"===e.name){const e=this.getActiveConferenceSession();e&&e.localSharingSessionId&&this.removeMediaFromConferenceSession(e,"sharing")}}catch(t){}}reconnectAllActiveConferenceSessions(){Object.keys(this.conferenceSessions).forEach((e=>{const t=this.conferenceSessions[e];if(t.haveJoined&&t.isActive())for(const[i,r]of Object.entries(t.sessions))"audio"===r.localType?(this.$log.info("[WebConferenceService] -- reconnectAllActiveConferenceSessions -- try to reconnect the audio session : "+i),this.sendTransportReplaceForSession(r,1e3)):t.localVideoSessionId===i?(this.$log.info("[WebConferenceService] -- reconnectAllActiveConferenceSessions -- try to reconnect the local video session : "+i),this.sendTransportReplaceForSession(r,2e3)):t.localSharingSessionId===i?(this.$log.info("[WebConferenceService] -- reconnectAllActiveConferenceSessions -- try to reconnect the local sharing session : "+i),this.sendTransportReplaceForSession(r,3e3)):"video"===r.remoteType?setTimeout(((e,t)=>{t&&this.connected&&e&&e.isActive()?(e.videoGallery||(this.createVideoGalleryElements(e.conferenceView),e.videoGallery=this.videoGalleryElements),!t.peerconnection||"stable"!==t.peerconnection.signalingState||"failed"!==t.peerconnection.iceConnectionState&&"disconnected"!==t.peerconnection.iceConnectionState?this.$log.info("[WebConferenceService] -- reconnectAllActiveConferenceSessions -- video session is already connected "+t.sid):(this.$log.info("[WebConferenceService] -- reconnectAllActiveConferenceSessions -- try to reconnect the video session : "+t.sid),this.xmppService.connection.jingle.terminate(t.sid),this.updateStatisticsForSession(e.id,t.sid),delete this.webrtcConfigAndUtils.callsStats[t.sid],e.videoGallery.forEach((e=>{e.sessionId===t.sid&&(e.sessionId="")})),delete e.sessions[t.sid],this.resubscribeToSessions(e))):this.$log.info("[WebConferenceService] -- reconnectAllActiveConferenceSessions -- : missing conference or video session")}),3e3,t,r):"sharing"===r.remoteType&&setTimeout(((e,i)=>{i&&this.connected&&e&&e.isActive()?!i.peerconnection||"stable"!==i.peerconnection.signalingState||"failed"!==i.peerconnection.iceConnectionState&&"disconnected"!==i.peerconnection.iceConnectionState?this.$log.info("[WebConferenceService] -- reconnectAllActiveConferenceSessions -- sharing session is already connected "+i.sid):(this.$log.info("[WebConferenceService] -- reconnectAllActiveConferenceSessions -- try to reconnect the sharing session : "+i.sid),this.xmppService.connection.jingle.terminate(i.sid,"icefailed"),this.updateStatisticsForSession(e.id,i.sid),delete this.webrtcConfigAndUtils.callsStats[i.sid],this.removeSessionFromVideoGallery(e,i.sid),delete t.sessions[i.sid],this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",e)):this.$log.info("[WebConferenceService] -- reconnectAllActiveConferenceSessions -- : missing conference or sharing session")}),2e3,t,r)}))}onReplaceBackgroundChangeEvent(e){try{const t=this.getActiveConferenceSession();if(t&&t.localVideoSessionId){const i=t.sessions[t.localVideoSessionId];if(i){this.logger.info("[WebconferenceService] onReplaceBackgroundChangeEvent");let r=i.localStreams.pop();e.data.type===f.VIRTUAL_BACKGROUND_TYPE.NONE&&(r.getTracks().forEach((e=>{e.enabled=false,e.stop(),e=null})),r.stop&&r.stop(),r=null),delete t.localStreams[i.localStreamId];const n=e.data.stream;i.localStreams.push(n),t.localStreams.push(n),i.localStreamId=t.localStreams.length-1,i.addStream(n),i.sendTransportReplace(),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",t)}}}catch(t){}}subscribe(e){return this.rxSubject.subscribe(e)}sendEvent(e,t=null){this.rxSubject.next(c.RBEvent.create(e,t))}retrieveWebConferences(e=this.MEDIATYPE.WEBRTC){return this.$log.info("[WebConferenceService] retrieveWebConferences with mediaType="+e),this.$q(((t,i)=>{if(!this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.WEBRTC_CONFERENCE_ALLOWED)&&!this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.WEBRTC_ADD_PARTICIPANT)&&e!==this.MEDIATYPE.WEBRTCSHARINGONLY)return this.$log.warn("[WebConferenceService] retrieveWebConferences - user is not allowed"),void i(new Error("notAllowed"));const r="?scheduled=false&format=full&userId="+this.contactService.userContact.dbId;this.$http({method:"GET",url:this.confProvPortalURL+"conferences"+r,headers:this.authService.getRequestHeader()}).then((e=>{const i=e.data.data;this.$log.info("[WebConferenceService] retrieveWebConferences successfully");for(const t of i)switch(t.mediaType){case this.MEDIATYPE.WEBRTC:case this.MEDIATYPE.WEBRTCSHARINGONLY:this.updateOrCreateWebConferenceEndpoint(t);break;case this.MEDIATYPE.PSTNAUDIO:}t(i)}),(e=>{const t="retrieveWebConferences failure: "+(e.data?e.data.errorDetails:e.data);this.$log.error("[WebConferenceService] "+t),i(new Error(t))}))}))}updateSubstreamLevelForPublisher(e,t,i,r){return e&&t&&i&&r?r.simulcast&&r.subStreamLevel!==i?(this.$log.info("[WebConferenceService] updateSubstreamLevelForPublisher(confId="+e+" participantId="+t+" publisherId="+r.publisherId+" level="+i+")"),this.$q(((n,s)=>{if(!this.conferenceSessions[e])return this.$log.error("[WebConferenceService] updateSubstreamLevelForPublisher - no corresponding conference session to update"),void s();const o=r.subStreamLevel;r.subStreamLevel=i;const a={option:"update",mediaType:"webrtc",publisherId:r.publisherId?r.publisherId:void 0,subStreamLevel:i};this.$http({method:"PUT",url:this.confPortalURL+e+"/participants/"+t,headers:this.authService.getRequestHeader(),data:a}).then((s=>{const o=s.data;r.subStreamLevel=i,this.$log.info("[WebConferenceService] updateSubstreamLevelForPublisher( confId="+e+" participantId="+t+" publisherId="+r.publisherId+" level="+i+") successfully"),n(o)}),(i=>{const n=i.data?i.data.errorDetails:i.data,a="updateSubstreamLevelForPublisher( confId="+e+" participantId="+t+") failure: "+n;this.$log.error("[WebConferenceService] "+a),r.subStreamLevel=o,s(new Error(a))}))}))):(this.$log.info("[WebConferenceService] updateSubstreamLevelForPublisher - already at same level "+(r.simulcast?"":"(no simulcast proposed)")),this.$q.resolve()):(this.$log.error("[WebConferenceService] updateSubstreamLevelForPublisher - missing a parameter"),this.$q.reject())}updateConference(e,t){return this.$log.info("[WebConferenceService] updateConference"),this.$q(((i,r)=>{if(e)this.$http({method:"PUT",url:this.confProvPortalURL+"conferences/"+e,headers:this.authService.getRequestHeader(),data:t}).then((e=>{const t=e.data.data,r=this.Conference.createFromData(t);t.hasOwnProperty("id")&&(this.conferenceEndpoints[t.id]&&delete this.conferenceEndpoints[t.id],this.conferenceEndpoints[t.id]=r),this.$log.info("[WebConferenceService] updateConference successfully"),i(r)}),(e=>{const t="updateConference failure: "+(e.data?e.data.errorDetails:e.data);this.$log.error("[WebConferenceService] "+t),r(new Error(t))}));else{const e="updateConference failure: No confEndpoint";this.$log.error("[WebConferenceService] updateConference failure : No confEndpoint"),r(new Error(e))}}))}createVideoGalleryElements(e="gallery_view"){this.videoGalleryElements=[];let t=0;if(t=e===this.ConferenceSession.ConferenceView.SpeakerView?0:e===this.ConferenceSession.ConferenceView.GalleryView?this.videoGalleryElementsNumber:this.videoGridElementsNumber,this.activeSpeaker){const e={state:"free",sessionId:"",id:"videoGallery_0",publisherId:"",subStreamLevel:null,activeSpeaker:true,hold:false};this.videoGalleryElements.push(e)}for(let i=1;i<=t;i++){const e={state:"free",sessionId:"",id:"videoGallery_"+i,publisherId:"",publisherJid:"",subStreamLevel:null,hold:false};this.videoGalleryElements.push(e)}if(this.activeSpeaker&&this.mozaicViewModeValue)for(let i=t+1;i<=this.videoGridElementsNumber;i++){const e={state:"busy",sessionId:"",id:"videoGallery_"+i,publisherId:"",publisherJid:"",subStreamLevel:null,hold:false};this.videoGalleryElements.push(e)}if("true"===this.settingsService.getSetting("sfuDisableVideos"))for(let i=0;i<this.videoGalleryElements.length;i++)this.videoGalleryElements[i].state="busy"}updateVideoGalleryElementsState(e,t,i){if(!this.activeSpeaker)return t;if("true"===this.settingsService.getSetting("sfuDisableHold"))return t;if("true"===this.settingsService.getSetting("sfuDisableVideos"))return t;if(this.settingsService.getBooleanSetting("newSfuAndP2P")&&this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_UI_3_0))return t;let r=0,n=0;i===this.ConferenceSession.ConferenceView.SpeakerView?(r=0,n=0):i===this.ConferenceSession.ConferenceView.GalleryView?(r=0,n=this.videoGalleryElementsNumber):(r=1,n=this.videoGridElementsNumber);for(let s=0;s<r;s++)if("free"===t[s].state)t[s].state="busy";else if("busy"===t[s].state&&t[s].sessionId&&!t[s].hold){const i=e.sessions[t[s].sessionId];i&&i.sendHold(true),t[s].hold=true}for(let s=r;s<=n;s++)if("busy"!==t[s].state||t[s].sessionId||t[s].publisherId){if("busy"===t[s].state&&t[s].sessionId&&t[s].hold){t[s].hold=false;const i=e.sessions[t[s].sessionId];i&&i.sendHold(false)}}else t[s].state="free";for(let s=n+1;s<=this.videoGridElementsNumber;s++)if("free"===t[s].state)t[s].state="busy";else if("busy"===t[s].state&&t[s].sessionId&&!t[s].hold){t[s].hold=true;const i=e.sessions[t[s].sessionId];i&&i.sendHold(true)}return t}holdOrUnholdHiddenSessions(e,t,i){if(!this.activeSpeaker)return t;const r=this.videoGalleryElementsNumber;for(let n=1;n<=r;n++)if("busy"!==t[n].state||t[n].sessionId||t[n].publisherId||(t[n].state="free"),i&&"busy"===t[n].state&&t[n].sessionId&&!t[n].hold&&!t[n].pinned){t[n].hold=true;const i=e.sessions[t[n].sessionId];i&&i.sendHold(true)}else if(!i&&"busy"===t[n].state&&t[n].sessionId&&t[n].hold){t[n].hold=false;const i=e.sessions[t[n].sessionId];i&&i.sendHold(false)}return t}holdOrUnholdVideoSessionAndUpdateGalleryElement(e,t,i){const r=this.conferenceSessions[e],n=r.sessions[t];if(r&&r.videoGallery&&t&&n){if(!n||n.onHold!==i){this.logger.info("holdOrUnholdVideoSessionAndUpdateGalleryElement for confId "+e+" and sessId "+t+" and hold state: "+i);for(let e=0;e<r.videoGallery.length;e++)r.videoGallery[e].sessionId===t&&(n.sendHold(i),r.videoGallery[e].hold=i);return r}}else this.logger.warn("holdOrUnholdVideoSessionAndUpdateGalleryElement -- missing or wrong parameters")}setVideoGalleryElementsNumber(e){this.videoGalleryElementsNumber=e}setVideoGridElementsNumber(e){this.videoGridElementsNumber=e}setActiveSpeakerValue(e){this.activeSpeaker=e}setMozaicViewModeValue(e){this.mozaicViewModeValue=e}isActiveSpeakerEnabled(){return this.activeSpeaker}getConferenceSessions(){return this.conferenceSessions}getConferenceEndpoints(){return this.conferenceEndpoints}addConferenceEndpoint(e,t){e?this.conferenceEndpoints[e]=t:this.$log.warn("[WebConferenceService] addConferenceEndpoint - missing conferenceEndpointId")}getConferenceIdToUse(e,t=this.MEDIATYPE.WEBRTC){const i=this.getPontConfIdForRoom(e,t);if(i)return i;switch(t){case this.MEDIATYPE.WEBRTC:if(e.isUserModerator(this.contactService.userContact)&&this.webrtcConferenceId)return this.webrtcConferenceId;break;case this.MEDIATYPE.WEBRTCSHARINGONLY:if(e.owner&&this.webrtcSharingOnlyConferenceId)return this.webrtcSharingOnlyConferenceId}return""}isMyConference(e){return e&&(this.webrtcConferenceId&&e===this.webrtcConferenceId||this.webrtcSharingOnlyConferenceId&&e===this.webrtcSharingOnlyConferenceId)}bubbleDeclineInvitationForWebConference(e){return this.$q(((t,i)=>{if(!e){const e=new Error("[webConferenceService] bubbleDeclineInvitationForWebConference error - missing parameters for room");return this.$log.error(e.message),void i(e)}const r=this.getConferenceIdToUse(e,this.MEDIATYPE.WEBRTC);if(!r){const e=new Error("[webConferenceService] bubbleDeclineInvitationForWebConference error - no available pont conference");return this.$log.error(e.message),void i(e)}this.$http({method:"PUT",url:this.confPortalURL+r+"/reject",headers:this.authService.getRequestHeader(),data:{mediaType:this.MEDIATYPE.WEBRTC,roomId:e.dbId}}).then((()=>{this.$log.debug("[webConferenceService] bubbleDeclineInvitationForWebConference - success -- "),t()}),(e=>{this.makingCall=false;this.$log.error("[webConferenceService] bubbleDeclineInvitationForWebConference - error on server"),i(this.errorHelperService.handleError(e))}))}))}bubbleStartOrJoinWebConference(e){return this.$q(((t,i)=>{if(!e){const e=new Error("[webConferenceService] bubbleStartOrJoinWebConference error - missing parameters for room");return this.$log.error(e.message),void i(e)}this.settingsService.getBooleanSetting("newSfuAndP2P")&&this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_UI_3_0)&&this.setDefaultConferenceLayout("grid_view");const r=this.getConferenceIdToUse(e,this.MEDIATYPE.WEBRTC);this.isMyConference(r)?this.bubbleStartWebConference(e).then((()=>{t()})).catch((()=>{i()})):this.bubbleJoinWebConference(e).then((()=>{t()})).catch((e=>{i(e)}))}))}bubbleStartWebConference(e){return this.$q(((t,i)=>{if(!e){const e=new Error("[webConferenceService] bubbleStartWebConference error - missing parameters for room");return this.$log.error(e.message),void i(e)}const r=this.getConferenceIdToUse(e,this.MEDIATYPE.WEBRTC);if(!r){const e=new Error("[webConferenceService] bubbleStartWebConference error - no available pont conference");return this.$log.error(e.message),void i(e)}if(this.makingCall)return this.$log.warn("[webConferenceService] already starting a conference"),this.$q.resolve();this.settingsService.getBooleanSetting("newSfuAndP2P")&&this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_UI_3_0)&&this.setDefaultConferenceLayout("grid_view"),this.$log.info("[WebConferenceService] bubbleStartWebConference "+r),this.makingCall=true;const n=this.conferenceSessions[r];if(n&&n.active)return this.$log.info("[webConferenceService] bubbleStartWebConference - No need to start an already active conference"),void t(this.joinWebConference(r,"moderator",false));const s=this.ConferenceSession.createFromData(r,[],false,"webrtc",this.defaultConferenceLayout);s.status="ringing",s.roomId=e.dbId,s.isMyConference=true,this.conferenceSessions[r]=s,this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",this.conferenceSessions[r]),this.$http({method:"PUT",url:this.confPortalURL+r+"/start",headers:this.authService.getRequestHeader(),data:{mediaType:this.MEDIATYPE.WEBRTC,roomId:e.dbId}}).then((()=>(this.$log.info("[webConferenceService] startWebConference - success -- now joining the conference"),t(this.joinWebConference(r,"moderator",false)))),(e=>{this.makingCall=false;let t="[webConferenceService] startWebConference - error on server, can't start conference -- ",n="startMeetingFailure";e&&((403620===e.errorDetailsCode||e.data&&403620===e.data.errorDetailsCode)&&(n="startMeetingConflict"),e.errorDetailsLabel?t+=e.errorDetailsLabel:e.data&&(t+=e.data.errorDetailsCode+" "+e.data.errorMsg)),this.$log.error(t),this.mainService.showGlobalPopupMessage({popupTitle:"startConference",popupBody:n,okLabel:"ok"}),this.leaveWebConference(r),this.removeConferenceSession(r),i(this.errorHelperService.handleError(e)),this.$log.error("[webConferenceService] startWebConference "+this.errorHelperService.getErrorFullMessage(e))}))}))}bubbleJoinWebConference(e){return this.$q(((t,i)=>{if(!e){const e=new Error("[webConferenceService] bubbleJoinWebConference error - missing parameters for room");return this.$log.error(e.message),void i(e)}const r=this.getConferenceIdToUse(e,this.MEDIATYPE.WEBRTC);if(!r){const e=new Error("[webConferenceService] bubbleJoinWebConference error - no available pont conference");return this.$log.error(e.message),void i(e)}if(this.makingCall)return this.$log.warn("[webConferenceService] already joining a conference"),this.$q.resolve();this.settingsService.getBooleanSetting("newSfuAndP2P")&&this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_UI_3_0)&&this.setDefaultConferenceLayout("grid_view"),this.$log.info("[WebConferenceService] bubbleJoinWebConference "+r),this.makingCall=true,this.$rootScope.$broadcast("ON_CONFERENCE_ENDED_INVITATION",e);let n=this.conferenceSessions[r];n||(n=this.ConferenceSession.createFromData(r,[],false,"webrtc",this.defaultConferenceLayout)),n.conferenceView=this.defaultConferenceLayout,n.status="ringing",n.roomId=e.dbId,this.conferenceSessions[r]=n,this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",this.conferenceSessions[r]);const s=this.isMyConference(r)?"moderator":"member";this.joinWebConference(r,s).then((()=>{t()})).catch((e=>{i(e)}))}))}async bubbleJoinWebConferenceByPhone(e,t){if(!e||!t){const e=new Error("[webConferenceService] bubbleJoinWebConferenceByPhone error - missing parameters");return this.$log.error(e.message),Promise.reject(e)}const i=this.getConferenceIdToUse(e,this.MEDIATYPE.WEBRTC);if(!i){const e=new Error("[webConferenceService] bubbleJoinWebConference error - no available pont conference");return this.$log.error(e.message),Promise.reject(e)}const r=this.confPortalURL+i+"/join",n={participant:{role:"member",type:"unmuted"},mediaType:this.MEDIATYPE.WEBRTC,delegateCapability:false,participantPhoneNumber:t};return this.webrtcConfigAndUtils.webrtcConfig&&this.webrtcConfigAndUtils.webrtcConfig.dc&&(n.dc=this.webrtcConfigAndUtils.webrtcConfig.dc),this.$q(((e,t)=>{this.$http({method:"POST",url:r,headers:this.authService.getRequestHeader(),data:n}).then((t=>{const i=t.data.data;console.error(i),e()}),(e=>{if(e){const t=e.data?e.data.errorDetails:e.data,r="joinWebConference( confId="+i+") failure: "+t;this.$log.error("[webConferenceService] "+r)}this.makingCall=false;const r={popupTitle:"warning",popupBody:"joinMeetingFailure",okLabel:"ok"};e&&e.data&&403615===e.data.errorDetailsCode&&(r.popupBody="maximumNumberConferenceParticipantsReach"),e&&e.data&&403060===e.data.errorDetailsCode&&(r.popupBody="lockedConferenceError"),this.leaveWebConference(i),delete this.conferenceSessions[i],this.mainService.showGlobalPopupMessage(r),t(this.errorHelperService.handleError(e))}))}))}startOrJoinWebConference(e){return this.$q(((t,i)=>{if(!e){const e=new Error("[webConferenceService] startOrJoinWebConference error - missing parameters for room");return this.$log.error(e.message),void i(e)}const r=this.getConferenceIdToUse(e,this.MEDIATYPE.WEBRTC);if(!r){const e=new Error("[webConferenceService] startOrJoinWebConference error - no available pont conference");return this.$log.error(e.message),void i(e)}if(this.$log.info("[WebConferenceService] startOrJoinWebConference -- "+r),this.makingCall)return this.$log.warn("[webConferenceService] already starting a conference"),this.$q.resolve();this.makingCall=true,this.makeSnapshotForConfId(r,this.MEDIATYPE.WEBRTC).then((()=>{const n=this.conferenceSessions[r];if(!(this.isMyConference(r)||n&&n.active)){const e=new Error("[webConferenceService] startOrJoinWebConference error - no active conference to join");return this.$log.error(e.message),i(e),void(this.makingCall=false)}const s=this.isMyConference(r)?"moderator":"member";n&&n.active?(this.$rootScope.$broadcast("ON_CONFERENCE_ENDED_INVITATION",e),t(this.joinWebConference(r,s))):t(this.startWebConference(e,r))}),(()=>{this.makingCall=false;const e=new Error("[webConferenceService] startOrJoinWebConference error on snapshot");this.$log.error(e.message),i(e)}))}))}startWebConference(e,t,i=false){return t&&e?(this.makingCall=true,this.$log.info("[webConferenceService] startWebConference wtih ID "+t),this.$q((e=>{i?(this.$log.debug("[webConferenceService] startWebConference - trigger snapshot for "+t),e(this.makeSnapshotForConfId(t,this.MEDIATYPE.WEBRTC))):e()})).then((()=>this.conferenceSessions[t].active?(this.$log.info("[webConferenceService] startWebConference - No need to start an already active conference"),this.joinWebConference(t,"moderator",false)):(this.conferenceSessions[t].status="ringing",this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",this.conferenceSessions[t]),this.$http({method:"PUT",url:this.confPortalURL+t+"/start",headers:this.authService.getRequestHeader(),data:{mediaType:this.MEDIATYPE.WEBRTC,roomId:e.dbId}}).then((()=>(this.$log.info("[webConferenceService] startWebConference - success -- now joining the conference"),this.joinWebConference(t,"moderator",false))),(e=>{throw this.makingCall=false,this.$log.error("[webConferenceService] startWebConference wtih ID "+t+" failure ... -- "+this.errorHelperService.getErrorFullMessage(e)),this.leaveWebConference(t),this.removeConferenceSession(t),this.errorHelperService.handleError(e)}))))).catch((e=>{this.makingCall=false;let t="[webConferenceService] startWebConference - error on server, can't start conference -- ",i="startMeetingFailure";return e&&(403620===e.errorDetailsCode&&(i="startMeetingConflict"),e.errorDetailsLabel&&(t+=e.errorDetailsLabel)),this.$log.error(t),this.mainService.showGlobalPopupMessage({popupTitle:"startConference",popupBody:i,okLabel:"ok"}),this.$q.reject(e)}))):(this.$log.error("[startWebConference] No webPontConferenceId or Room!"),this.mainService.showGlobalPopupMessage({popupTitle:"startConference",popupBody:"startMeetingFailure",okLabel:"ok"}),this.$q.reject())}joinWebConference(e,t,i=false){return this.$log.info("[webConferenceService] joinWebConference with ID "+e+" and role "+t),e?this.$q((t=>{i?(this.$log.debug("[webConferenceService] joinWebConference - trigger snapshot for "+e),t(this.makeSnapshotForConfId(e,this.MEDIATYPE.WEBRTC))):t()})).then((()=>this.$q(((i,n)=>{this.makingCall=true,this.createVideoGalleryElements(this.conferenceSessions[e].conferenceView),this.conferenceSessions[e].videoGallery=this.videoGalleryElements,"ringing"!==this.conferenceSessions[e].status&&(this.conferenceSessions[e].status="ringing",this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",this.conferenceSessions[e]));const s="web_"+r(),o=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.WEBRTC_CONFERENCE_ALLOWED),a=this.confPortalURL+e+"/join",c={participant:{role:t,type:"unmuted"},mediaType:this.MEDIATYPE.WEBRTC,delegateCapability:o};this.webrtcConfigAndUtils.webrtcConfig&&this.webrtcConfigAndUtils.webrtcConfig.dc&&(c.dc=this.webrtcConfigAndUtils.webrtcConfig.dc),this.getUserMediaForSession(e).then((t=>{t&&"noMic"===t&&(c.microphone=false),this.conferenceSessions[e].haveJoined=true,this.$http({method:"POST",url:a,headers:this.authService.getRequestHeader(),data:c}).then((t=>{const r=t.data.data;this.jingleJid=r.jingleJid;const n=r.transportTurn;this.initCall(this.jingleJid,e,s,this.MEDIATYPE.WEBRTC,n),this.makingCall=false,i()}),(t=>{if(t){const i=t.data?t.data.errorDetails:t.data,r="joinWebConference( confId="+e+") failure: "+i;this.$log.error("[webConferenceService] "+r)}this.makingCall=false,this.conferenceSessions[e].haveJoined=false;const i={popupTitle:"warning",popupBody:"joinMeetingFailure",okLabel:"ok"};t&&t.data&&403615===t.data.errorDetailsCode&&(i.popupBody="maximumNumberConferenceParticipantsReach"),t&&t.data&&403060===t.data.errorDetailsCode&&(i.popupBody="lockedConferenceError"),this.leaveWebConference(e),delete this.conferenceSessions[e],this.mainService.showGlobalPopupMessage(i),n(t)}))})).catch((t=>{this.$log.error("[webConferenceService] joinWebConference - getUserMediaForSession reject -- "+t),this.makingCall=false,"ignore"!==t&&this.leaveWebConference(e),n()}))})))).catch((e=>(this.makingCall=false,this.$log.error("[webConferenceService] joinWebConference - error on server, can't join conference"),this.$q.reject(e)))):(this.$log.error("[webConferenceService] joinWebConference - No webPontConferenceId !"),this.$q.reject())}joinSharingOnlyConference(e,t,i=true){return this.$log.info("[webConferenceService] joinSharingOnlyConference with ID "+e+" and role "+t),e?this.$q((t=>{i?(this.$log.debug("[webConferenceService] joinSharingOnlyConference - trigger snapshot for "+e),t(this.makeSnapshotForConfId(e,this.MEDIATYPE.WEBRTCSHARINGONLY))):t()})).then((()=>this.$q(((i,n)=>{this.makingCall=true,this.createVideoGalleryElements(),this.conferenceSessions[e].videoGallery=this.videoGalleryElements,"ringing"!==this.conferenceSessions[e].status&&(this.conferenceSessions[e].status="ringing",this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",this.conferenceSessions[e]));r();const s=this.confPortalURL+e+"/join",o={participant:{role:t,type:"muted"},mediaType:this.MEDIATYPE.WEBRTCSHARINGONLY};this.$http({method:"POST",url:s,headers:this.authService.getRequestHeader(),data:o}).then((t=>{const r=t.data.data;this.jingleJid=r.jingleJid,this.$log.info("[webConferenceService] joinSharingOnlyConference with ID success - jingleJid: "+this.jingleJid),this.conferenceSessions[e].jingleJid=this.jingleJid,this.conferenceSessions[e].haveJoined=true,this.makingCall=false,i()}),(t=>{if(t){const i=t.data?t.data.errorDetails:t.data,r="joinSharingOnlyConference( confId="+e+") failure: "+i;this.$log.error("[conferenceService] "+r)}this.makingCall=false;t&&t.data&&403615===t.data.errorDetailsCode&&"maximumNumberConferenceParticipantsReach",this.leaveWebConference(e),delete this.conferenceSessions[e],n(this.errorHelperService.handleError(t))}))})))).catch((()=>(this.makingCall=false,this.$log.error("[webConferenceService] joinSharingOnlyConference - error on server, can't join conference"),this.$q.reject()))):(this.$log.error("[webConferenceService] joinSharingOnlyConference - No webPontConferenceId !"),this.$q.reject())}getFreeVideoGalleryElement(e){this.$log.info("[webConferenceService] getFreeVideoGalleryElement "+e);const t=this.conferenceSessions[e];let i=null;if(t){t.videoGallery||(this.createVideoGalleryElements(t.conferenceView),t.videoGallery=this.videoGalleryElements);for(let e=0;e<t.videoGallery.length;e++)if("free"===t.videoGallery[e].state){i=t.videoGallery[e];break}}return i}askToAddSharingToConferenceSession(e,t){!this.webrtcP2PService.askToAddSharing(e.id)&&this.addMediaToConferenceSession(t,"sharing")}addMediaToConferenceSession(e,t,i=null){if(!e)return;if(this.addingMedia)return;if("true"===this.settingsService.getSetting("sfuJoinBundle")&&"video"===t)return void this.addBundleMediaToConferenceSession(e);this.addingMedia=true;const r=[t];"sharing"===t&&this.contactService.setBusyState("dnd","sharing");const n=i?this.$q.when(i):this.webrtcP2PService.getBrowserMedia(r);this.$log.info("[webConferenceService] addMediaToConferenceSession to session "+e.id+" with media "+t),n.then((async i=>{let r=i;"video"===t&&(e.originalVideoStream=i,r=await this.virtualBackgroundService.startProcessStream(i)),this.addingMedia=false;const n=[r],s=this.xmppService.connection.jingle.initiate(e.jingleJid,this.xmppService.connection.jid,t,n,null,e.id,null);e.sessions[s.sid]=s,e.localStreams.push(r),s.localStreamId=e.localStreams.length-1,"video"===t?(e.hasLocalVideo=true,e.localVideoSessionId=s.sid):(e.hasLocalSharing=true,e.localSharingSessionId=s.sid,this.sendEvent("startHighlighting")),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",e),this.webrtcConfigAndUtils.callsStats[s.sid]={},this.updateStatisticsForSession(e.id,s.sid),this.statsIntervals.push(s.getStats(8e3))})).catch((()=>{this.addingMedia=false,this.contactService.setBusyState("dnd","audio")}))}removeMediaFromConferenceSession(e,t){if(!e)return;"sharing"===t&&this.contactService.setBusyState("dnd","audio"),"webrtcSharingOnly"===e.type&&this.eventService.publish("CHECK_AND_RESET_BUSY_STATE"),this.$log.info("[webConferenceService] removeMediaFromConferenceSession from session "+e.id);const i="video"===t?e.localVideoSessionId:e.localSharingSessionId;if(e.sessions[i]){const r=e.sessions[i];this.updateStatisticsForSession(e.id,i),this.webrtcConfigAndUtils.disableAllStreamsForSession(r),this.xmppService.connection.jingle.terminate(r.sid),delete e.sessions[i],delete e.localStreams[r.localStreamId],delete this.webrtcConfigAndUtils.callsStats[i],"video"===t?(e.hasLocalVideo=false,e.localVideoSessionId=null,e.originalVideoStream&&this.disableMediaStream(e.originalVideoStream),e.originalVideoStream=null,this.virtualBackgroundService.stopProcessStream()):(e.hasLocalSharing=false,e.localSharingSessionId=null,this.sendEvent("stopHighlighting"))}this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",e),this.updateSubStreamLevelsForConferenceSession(e.id)}dropRemoteVideoSession(e,t){if(e){if(this.$log.info("[webConferenceService] dropRemoteVideoSession fom conference "+e.id+" and session "+t),e.sessions[t]){const i=e.sessions[t];this.updateStatisticsForSession(e.id,t),this.xmppService.connection.jingle.terminate(i.sid),delete e.sessions[t],delete this.webrtcConfigAndUtils.callsStats[t]}this.removeSessionFromVideoGallery(e,t),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",e)}}getUserMediaForSession(e){return this.$q(((t,i)=>{const r=this.conferenceSessions[e];if(!r)return void i();"ringing"!==r.status&&(this.conferenceSessions[e].status="ringing",this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",r)),r.haveJoined=true;this.webrtcP2PService.getBrowserMedia(["audio"]).then((r=>{this.$log.info("[webConferenceService] getUserMediaForSession -- sucess");const n=this.conferenceSessions[e];if(!n||"ended"===n.status)return this.$log.info("[webConferenceService] getUserMediaForSession -- missing conference"),this.disableMediaStream(r),void i("conference does not exist anymore");if(!this.makingCall)return this.$log.info("[webConferenceService] getUserMediaForSession -- already in the conference -- ignore"),this.disableMediaStream(r),void i("ignore");const s=[r];n.localStreams=s,t()})).catch((()=>{this.$log.error("[webConferenceService] getUserMediaForSession error -- getUserMedia failed"),this.sendEvent("joinWithoutAudio"),this.conferenceSessions[e].localStreams=[],t("noMic")}))}))}disableMediaStream(e){e&&(e.getTracks().forEach((e=>{e.enabled=false,e.stop(),e=null})),e.stop&&e.stop(),e=null)}initCall(e,t,i,r,n=false){const s=this.conferenceSessions[t];return this.$q((e=>{s||(this.$log.warn("[webConferenceService] initCall - no conferenceSession as though we are trying to init call"),e(this.makeSnapshotForConfId(t,r))),e()})).then((async()=>{await this.webrtcConfigAndUtils.setWebrtcConfiguration().catch((()=>{this.$log.error("[webConferenceService] initCall - setWebrtcConfiguration failed")}));let r="audio";"true"===this.settingsService.getSetting("sfuJoinBundle")&&(r="audio+video");const o=this.xmppService.connection.jingle.initiate(e,this.xmppService.connection.jid,r,s.localStreams,i,t,null,n);return s.jingleJid=e,s.sessions[o.sid]=o,s.status="ringing",this.createStatisticsForSession(t,o.sid),this.statsIntervals.push(o.getStats(3e3)),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",s),s}))}async transferCall(e,t,i,r,n,s=false,o,a=false){try{if(this.conferenceSessions[i]&&this.conferenceSessions[i].haveJoined)throw this.$log.info("[webConferenceService] transferCall to "+i+" -- already in progress or done"),new Error("Already making transfer call");this.makingCall=true,this.$log.info("[webConferenceService] transferCall to "+i),await this.makeSnapshotForConfId(i,n,true),await this.webrtcConfigAndUtils.setWebrtcConfiguration().catch((()=>{this.$log.error("[webConferenceService] transferCall - setWebrtcConfiguration failed")})),await this.getUserMediaForSession(i);const c=this.conferenceSessions[i];c.participants&&c.participants.forEach((e=>{s&&e.jid_im!==this.contactService.userContact.jid?e.role="member":s||e.jid_im!==this.contactService.userContact.jid||(e.role="member")}));let l="audio";"true"===this.settingsService.getSetting("sfuJoinBundle")&&(l="audio+video");const d=this.xmppService.connection.jingle.initiate(t,this.xmppService.connection.jid,l,c.localStreams,r,i,null,false);if(c.jingleJid=t,c.haveJoined=true,c.sessions[d.sid]=d,c.status="ringing",c.roomId=o,c.isMyConference=s,this.settingsService.getBooleanSetting("newSfuAndP2P")&&this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_UI_3_0)&&(this.setDefaultConferenceLayout("grid_view"),c.conferenceView=this.ConferenceSession.ConferenceView.GridView),this.createVideoGalleryElements(c.conferenceView),c.videoGallery=this.videoGalleryElements,!o){const e=this.roomService.findRoomsWithConfId(i);e&&e[0]&&(c.roomId=e[0].dbId)}this.conferenceSessions[i]=c,this.makingCall=false,this.createStatisticsForSession(i,d.sid),this.statsIntervals.push(d.getStats(3e3));try{if(e&&-1!==e.localType.indexOf("sharing")&&(!e.remoteType||-1===e.remoteType.indexOf("sharing")||s)){let t=e.localStreams.length-1;e.localStreams[e.localStreams.length-1].getAudioTracks().length&&(t=0);const r=e.localStreams[t].clone();this.$interval((()=>{this.addMediaToConferenceSession(this.conferenceSessions[i],"sharing",r)}),1500,1,true,i)}return e&&e.localType&&-1!==e.localType.indexOf("video")&&this.$interval((()=>{this.addMediaToConferenceSession(this.conferenceSessions[i],"video")}),1500,1,true,i),a&&this.$interval((()=>{const e=this.conferenceSessions[i].getConnectedParticipantByJid(this.contactService.userContact.jid);e&&this.muteParticipant(i,e.participantId,"mute")}),1e3,1,true,i),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",c),c}catch(dp){return this.$log.error("[webConferenceService] transferCall error on duplicate stream -- "+dp),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",c),c}}catch(c){this.makingCall=false,this.$log.error("[webConferenceService] transferCall error -- "+c)}}muteParticipant(e,t,i){return this.$log.info("[ConferenceService] muteParticipant( confId="+e+"participantId="+t+" option="+i+")"),e&&t&&i?this.$q(((r,n)=>{if(!this.conferenceSessions[e])return this.$log.error("[ConferenceService] muteParticipant - no corresponding conference session to update"),void n();const s={option:i,mediaType:"webrtc"};this.$http({method:"PUT",url:this.confPortalURL+e+"/participants/"+t,headers:this.authService.getRequestHeader(),data:s}).then((i=>{const n=i.data;this.$log.info("[ConferenceService] muteParticipant( confId="+e+"participantId="+t+") successfully"),r(n)}),(i=>{const r=i.data?i.data.errorDetails:i.data,s="muteParticipant( confId="+e+"participantId="+t+") failure: "+r;this.$log.error("[ConferenceService] "+s),n(new Error(s))}))})):(this.$log.error("[ConferenceService] muteParticipant - missing a parameter"),this.$q.reject())}createStatisticsForSession(e,t){if(this.$log.info("[webConferenceService] createStatisticsForSession for conf "+e+" and session "+t),!e||!t)return void this.$log.warn("[webConferenceService] createStatisticsForSession -- missing parameters");this.webrtcConfigAndUtils.callsStats[t]={};[].push({connectionId:t,stats:this.webrtcConfigAndUtils.callsStats[t]}),this.webrtcConfigAndUtils.createStatisticsForSession(e,e,"pending").then((i=>{this.$log.info("[webConferenceService] createStatisticsForSession success "+i),this.webrtcConfigAndUtils.callsStats[t].id=i,this.conferenceSessions[e].metricsId=i,this.conferenceSessions[e].metricsState="pending"})).catch((t=>{this.$log.error("[webConferenceService] createStatisticsForSession error for conf "+e)}))}updateStatisticsForSession(e,t){if(this.$log.info("[webConferenceService] updateStatisticsForSession for conf "+e+" and session "+t),!e||!t)return void this.$log.warn("[webConferenceService] updateStatisticsForSession -- missing parameters");const i=this.conferenceSessions[e];if(!i||!i.metricsId)return void this.$log.warn("[webConferenceService] updateStatisticsForSession -- missing webConference or no metricsId");i.metricsState||(i.metricsState="pending");const r=[];this.webrtcConfigAndUtils.callsStats[t]&&Object.keys(this.webrtcConfigAndUtils.callsStats[t]).length&&(this.webrtcConfigAndUtils.callsStats[t].RainMetrics&&this.webrtcConfigAndUtils.callsStats[t].push(this.webrtcConfigAndUtils.callsStats[t].RainMetrics),r.push({connectionId:t,stats:this.webrtcConfigAndUtils.callsStats[t]}),this.webrtcConfigAndUtils.updateStatisticsForCall(i.metricsId,e,i.metricsState,r))}leaveWebConference(e){if(this.$log.info("[WebConferenceService] leaveWebConference - "+e),!e)return;let t=this.webrtcP2PService.isUserContactInCall();Object.keys(this.conferenceSessions).forEach((i=>{i!==e&&this.conferenceSessions[i]&&this.conferenceSessions[i].haveJoined&&this.conferenceSessions[i].isActive&&(t=true,this.$log.info("[WebConferenceService] user has another active conference - "+i))})),t||(this.eventService.publish("CHECK_AND_RESET_BUSY_STATE"),this.sendEvent("stopHighlighting"),this.webrtcP2PService.clearSrcObjectsFromElements());const i=this.conferenceSessions[e];if(!i)return void this.$log.warn("[WebConferenceService] leaveWebConference - webConference does not exist");i.metricsState="ended";for(const n in i.sessions)if(i.sessions.hasOwnProperty(n)){const e=i.sessions[n];this.updateStatisticsForSession(i.id,e.sid),this.webrtcConfigAndUtils.disableAllStreamsForSession(e),this.xmppService.connection.jingle.terminate(e.sid),delete this.webrtcConfigAndUtils.callsStats[e.sid]}let r;for(this.webrtcP2PService.disableStreams(i.localStreams),i.originalVideoStream&&this.disableMediaStream(i.originalVideoStream),i.cleanupSessionData(),this.createVideoGalleryElements(i.conferenceView),i.videoGallery=this.videoGalleryElements,i.sessions={};this.statsIntervals.length;)r=this.statsIntervals.pop(),r&&(window.clearInterval(r),r=null);this.makingCall=false,this.$rootScope.$broadcast("ON_CONFERENCE_STATE_EVENT",i),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",i),this.contactService.userContact.guestMode&&this.$rootScope.$broadcast("ON_OPEN_POPUP","concludeInvitation"),this.virtualBackgroundService.stopProcessStream()}attachDistantMediaStream(e,t){if(e){const e=this.getRemoteAudioVideoBundleSession(t.id);if(e)return void this.attachDistantBundleSession(e);const i=this.getRemoteVideoSessions(t.id),r=this.getRemoteSharingSession(t.id);let n=false;if(r&&!r.showOnSecondPip||(n=this.updateMainSessionIfNeeded(t,i)),this.$log.info("[WebConferenceService] attachDistantMediaStream for session "+t.id),r&&!r.showOnSecondPip&&(r.remoteStreams.forEach((e=>{e.getVideoTracks().length>0&&this.webrtcP2PService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),e,r.sid)})),r.remoteStreamsObject[0]&&this.webrtcP2PService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),r.remoteStreamsObject[0],r.sid)),i.length){for(const e in i)if(i.hasOwnProperty(e)&&(i[e].remoteStreams&&i[e].remoteStreams.forEach((n=>{if(n.getVideoTracks().length>0){r&&!r.showOnSecondPip||!i[e].mainSession||this.webrtcP2PService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),n,i[e].sid);for(let r=0;r<t.videoGallery.length;r++)if(t.videoGallery[r].sessionId===i[e].sid){this.webrtcP2PService.RTC.attachMediaStreamIfNeeded(angular.element("#"+t.videoGallery[r].id),n,t.videoGallery[r].sessionId);break}}})),i[e].remoteStreamsObject[0])){r&&!r.showOnSecondPip||!i[e].mainSession||this.webrtcP2PService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),i[e].remoteStreamsObject[0],i[e].sid);for(let r=0;r<t.videoGallery.length;r++)if(t.videoGallery[r].sessionId===i[e].sid){this.webrtcP2PService.RTC.attachMediaStreamIfNeeded(angular.element("#"+t.videoGallery[r].id),i[e].remoteStreamsObject[0],t.videoGallery[r].sessionId);break}}}const s=this.getRemoteAudioSession(t.id);s&&s.remoteStreams&&s.remoteStreams.forEach((e=>{e.getAudioTracks().length>0&&this.webrtcP2PService.RTC.attachMediaStreamIfNeeded(angular.element("#globalAudioTag"),e,s.sid)})),s&&s.remoteStreamsObject[0]&&this.webrtcP2PService.RTC.attachMediaStreamIfNeeded(angular.element("#globalAudioTag"),s.remoteStreamsObject[0],s.sid),n&&this.updateSubStreamLevelsForConferenceSession(t.id)}}attachGalleryMediaStreams(e){const t=this.getRemoteVideoSessions(e.id);t.length&&t.forEach((t=>{for(let i=0;i<e.videoGallery.length;i++)if(e.videoGallery[i].sessionId===t.sid){const r=e.isOnlySharingWindow?null:e.externalWindowRef;this.attachSessionVideoToHtmlElement(t,e.videoGallery[i].id,r);break}}))}attachMozaicVideos(e,t){const i=this.getRemoteVideoSessions(e.id),r=e.isOnlySharingWindow?null:e.externalWindowRef;i.length&&i.forEach((e=>{t.forEach(((t,i)=>{t.videoSessionId===e.sid&&this.attachSessionVideoToHtmlElement(e,"mozaic_videoGallery_"+i,r)}))}));const n=this.getRemoteSharingSession(e.id);n&&this.attachSessionVideoToHtmlElement(n,"mozaicSharingVideo",r)}attachLocalPipVideo(e){if(e.hasLocalVideo){const t=e.sessions[e.localVideoSessionId];if(t){const i=e.isOnlySharingWindow?null:e.externalWindowRef;this.attachSessionVideoToHtmlElement(t,"conferenceVideoPip",i)}}}attachActiveTalkerLocalAndRemoteMediaStreams(e){this.attachRemoteAudioStream(e);const t=this.getRemoteAudioVideoBundleSession(e.id);if(t)return void this.attachDistantBundleSession(t);const i=e.isOnlySharingWindow?null:e.externalWindowRef,r=this.getRemoteVideoSessions(e.id),n=this.getRemoteSharingSession(e.id);this.updateMainSessionIfNeededToDynamicFeed(e,r),this.$log.info("[WebConferenceService] attachLocalAndRemoteMediaStreams for session "+e.id);let s=false,o=false;if(n&&!n.showOnSecondPip?(o=true,this.attachSessionVideoToHtmlElement(n,"largevideo",i),s=true):n&&n.showOnSecondPip&&(o=true,this.attachSessionVideoToHtmlElement(n,"sfuActiveSpeakerSecondVideo",i)),e.hasLocalSharing){const t=e.sessions[e.localSharingSessionId];t&&(o=true,t.showOnSecondPip?this.attachSessionVideoToHtmlElement(t,"sfuActiveSpeakerSecondVideo",i):(this.attachSessionVideoToHtmlElement(t,"largevideo",i),s=true))}if(r.length&&r.forEach((e=>{e.mainSession&&!s?(s=true,this.attachSessionVideoToHtmlElement(e,"largevideo",i)):(e.mainSession&&s||!e.mainSession&&e.activeSpeaker&&!o)&&this.attachSessionVideoToHtmlElement(e,"sfuActiveSpeakerSecondVideo",i)})),e.hasLocalVideo){const t=e.sessions[e.localVideoSessionId];t&&this.attachSessionVideoToHtmlElement(t,"conferenceVideoPip",i)}this.updateSubStreamLevelsForConferenceSession(e.id)}attachRemoteAudioStream(e){const t=this.getRemoteAudioSession(e.id);t&&t.remoteStreams&&t.remoteStreams.forEach((e=>{e.getAudioTracks().length>0&&this.webrtcP2PService.RTC.attachMediaStreamIfNeeded(angular.element("#globalAudioTag"),e,t.sid)})),t&&t.remoteStreamsObject[0]&&this.webrtcP2PService.RTC.attachMediaStreamIfNeeded(angular.element("#globalAudioTag"),t.remoteStreamsObject[0],t.sid);const i=this.getRemoteSharingSession(e.id);i&&i.remoteStreamsObject[0]&&i.remoteStreamsObject[0].getAudioTracks().length&&this.webrtcP2PService.RTC.attachMediaStreamIfNeeded(angular.element("#globalVideoTag"),i.remoteStreamsObject[0],i.sid)}attachMainMediaStream(e){e&&(this.$log.info("[webConferenceService] attachMainMediaStream"),e.remoteStreams.forEach((t=>{t.getVideoTracks().length>0&&this.webrtcP2PService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),t,e.sid)})),e&&e.remoteStreamsObject[0]&&this.webrtcP2PService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),e.remoteStreamsObject[0],e.sid))}attachDistantBundleSession(e){e&&(this.$log.info("[webConferenceService] attachDistantBundleSession"),e.remoteStreams.forEach((t=>{t.getVideoTracks().length>0&&this.webrtcP2PService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),t,e.sid),t.getAudioTracks().length>0&&this.webrtcP2PService.RTC.attachMediaStream(angular.element("#globalAudioTag"),t)})),e&&e.remoteStreamsObject[0]&&this.webrtcP2PService.RTC.attachMediaStream(angular.element("#globalAudioTag"),e.remoteStreamsObject[0]),e&&e.remoteStreamsObject[1]&&this.webrtcP2PService.RTC.attachMediaStreamIfNeeded(angular.element("#largevideo"),e.remoteStreamsObject[1],e.sid))}attachSessionVideoToHtmlElement(e,t,i=null){const r="#"+t,n=i?i.document.querySelectorAll(r):angular.element(r);e&&t?(this.$log.info("[webConferenceService] attachSessionVideoToHtmlElement"),e.remoteStreams.forEach((t=>{t.getVideoTracks().length>0&&this.webrtcP2PService.RTC.attachMediaStreamIfNeeded(n,t,e.sid)})),e&&e.remoteStreamsObject[0]&&this.webrtcP2PService.RTC.attachMediaStreamIfNeeded(n,e.remoteStreamsObject[0],e.sid),e.localStreams.forEach((t=>{t.getVideoTracks().length>0&&this.webrtcP2PService.RTC.attachMediaStreamIfNeeded(n,t,e.sid)}))):!e&&t&&this.webrtcP2PService.RTC.clearMediaStream(n,null)}updateMainSessionIfNeededToDynamicFeed(e,t){this.$log.info("[webConferenceService] updateMainSessionIfNeededToDynamicFeed");let i=true;if(t&&t.length){let r=null,n=null;Object.keys(t).forEach((e=>{const s=t[e];s&&(n||(n=s),!r&&s.activeSpeaker&&(r=s),s.mainSession&&(s.pinned||s.activeSpeaker)&&(i=false))})),i&&(r?(r.mainSession=true,r.pinned=false,e.videoGallery.forEach((e=>{e.pinned=false,e.mainSession=false}))):n&&(n.mainSession=true,n.pinned=false,e.videoGallery.forEach((e=>{e.pinned=false,e.sessionId===n.sid?e.mainSession=true:e.mainSession=false}))))}return i}updateMainSessionIfNeeded(e,t){this.$log.info("[webConferenceService] updateMainSessionIfNeeded");let i=true;if(t&&t.length){let r=null;for(const e in t)t.hasOwnProperty(e)&&(r||(r=t[e]),t[e].mainSession&&(i=false));i&&(r.mainSession=true,r.pinned=false,e.videoGallery.forEach((e=>{e.pinned=false,e.sessionId===r.sid?e.mainSession=true:e.mainSession=false})))}return i}getRelatedRoomToActiveConferenceSession(){return this.webConferenceRoom}getRelatedRoomToActiveSharingOnlyConferenceSession(){return this.webrtcSharingOnlyRoom}getConferenceBySessionId(e){let t=null;return this.conferenceSessions?(Object.entries(this.conferenceSessions).forEach((([i,r])=>{if(r&&r.sessions){const n=r.sessions;for(const[r,s]of Object.entries(n))if(s&&s.sid===e){t=this.conferenceSessions[i];break}}})),t):t}getPontConfIdForRoom(e,t=this.MEDIATYPE.WEBRTC){if(e.confEndpoints&&e.confEndpoints.length){for(let i=0;i<e.confEndpoints.length;i++)if(e.confEndpoints[i].mediaType===t)return e.confEndpoints[i].confEndpointId}return""}getConferenceSessionById(e){return this.conferenceSessions[e]}getSfuConferenceSessionForRoom(e){let t=null;return e&&(t=this.conferenceSessions[e.getSFUConfEndpointId()]),t}updateWebConferenceInfos(e){this.$log.info("[WebConferenceService] updateWebConferenceInfos"),Object.assign(this.conferenceEndpoints,e),this.webrtcConferenceId=this.getWebRtcConfEndpointId(),this.webrtcConferenceId&&this.roomService.getRoomByConferenceEndpointId(this.webrtcConferenceId).then((e=>{let t="nothing";e&&(t=e.name),this.webConferenceRoom=e,this.$log.info("[WebConferenceService] === updateWebConferenceInfos : webrtcConferenceId is currently attached to "+t)}),(()=>{this.$log.info("[WebConferenceService] === updateWebConferenceInfos FAILURE ===")}))}updateWebSharingOnlyConferenceInfos(e){this.$log.info("[WebConferenceService] updateWebSharingOnlyConferenceInfos"),Object.assign(this.conferenceEndpoints,e),this.webrtcSharingOnlyConferenceId=this.getWebRtcSharingOnlyConfEndpointId(),this.webrtcSharingOnlyConferenceId&&this.roomService.getRoomByConferenceEndpointId(this.webrtcSharingOnlyConferenceId).then((e=>{const t=e&&e.name?e.name:"nothing";this.webrtcSharingOnlyRoom=e,this.$log.info("[WebConferenceService] === updateWebSharingOnlyConferenceInfos : webrtcSharingOnlyConferenceId is currently attached to "+t)}),(()=>{this.$log.info("[WebConferenceService] === updateWebSharingOnlyConferenceInfos FAILURE ===")}))}updateWebConferenceRoom(){return this.webrtcConferenceId=this.getWebRtcConfEndpointId(),this.$q(((e,t)=>{this.roomService.getRoomByConferenceEndpointId(this.webrtcConferenceId).then((t=>{let i="nothing";t&&(i=t.name),this.webConferenceRoom=t,this.$log.info("[WebConferenceService] === updateWebConferenceRoom : room is currently attached to "+i),e()}),(()=>{this.$log.info("[WebConferenceService] === updateWebConferenceRoom FAILURE==="),t()}))}))}getWebRtcConfEndpointId(){for(const e in this.conferenceEndpoints)if(this.conferenceEndpoints.hasOwnProperty(e)&&this.conferenceEndpoints[e].mediaType===this.MEDIATYPE.WEBRTC)return this.conferenceEndpoints[e].id;return null}getWebRtcSharingOnlyConfEndpointId(){for(const e in this.conferenceEndpoints)if(this.conferenceEndpoints.hasOwnProperty(e)&&this.conferenceEndpoints[e].mediaType===this.MEDIATYPE.WEBRTCSHARINGONLY)return this.conferenceEndpoints[e].id;return null}isJoinWebConferenceAllowed(){return true}getWebConference(e){if(e)return this.conferenceSessions[e]}removeConferenceSession(e){if(!e)return;this.removeAllJingleSessionsForConferenceSession(e);let t,i=this.conferenceSessions[e];for(i&&i.cleanupSessionData(),delete this.conferenceSessions[e],i=null;this.statsIntervals.length;)t=this.statsIntervals.pop(),t&&(window.clearInterval(t),t=null);this.makingCall=false}removeAllJingleSessionsForConferenceSession(e){if(!e)return;const t=this.conferenceSessions[e];if(t){t.metricsState="ended";for(const e in t.sessions)if(t.sessions.hasOwnProperty(e)){const i=t.sessions[e];this.updateStatisticsForSession(t.id,i.sid),delete this.webrtcConfigAndUtils.callsStats[i.sid],this.webrtcConfigAndUtils.disableAllStreamsForSession(i),this.xmppService.connection.jingle.terminate(i.sid)}t.sessions=[]}}hasActiveConferenceSession(){for(const e in this.conferenceSessions)if(this.conferenceSessions.hasOwnProperty(e)&&this.conferenceSessions[e]&&this.conferenceSessions[e].type===this.MEDIATYPE.WEBRTC&&this.conferenceSessions[e].isActive()&&this.conferenceSessions[e].haveJoined)return true;return false}hasActiveConferenceSessionWithAnyDevice(){for(const e in this.conferenceSessions)if(this.conferenceSessions.hasOwnProperty(e)&&this.conferenceSessions[e]&&this.conferenceSessions[e].type===this.MEDIATYPE.WEBRTC&&this.conferenceSessions[e].isActive()&&(this.conferenceSessions[e].haveJoined||this.conferenceSessions[e].joinedFromOtherDevice))return true;return false}getActiveConferenceSession(){let e=null;for(const t in this.conferenceSessions)this.conferenceSessions.hasOwnProperty(t)&&this.conferenceSessions[t]&&this.conferenceSessions[t].type===this.MEDIATYPE.WEBRTC&&this.conferenceSessions[t].isActive()&&this.conferenceSessions[t].haveJoined&&(e=this.conferenceSessions[t]);return e}getAllActiveNonJoinedConferenceSessions(){const e=[];for(const t in this.conferenceSessions)this.conferenceSessions.hasOwnProperty(t)&&this.conferenceSessions[t]&&this.conferenceSessions[t].type===this.MEDIATYPE.WEBRTC&&this.conferenceSessions[t].isActive()&&!this.conferenceSessions[t].haveJoined&&e.push(this.conferenceSessions[t]);return e}hasActiveSharingOnlyConferenceSession(){for(const e in this.conferenceSessions)if(this.conferenceSessions.hasOwnProperty(e)&&this.conferenceSessions[e]&&this.conferenceSessions[e].type===this.MEDIATYPE.WEBRTCSHARINGONLY&&this.conferenceSessions[e].isActive())return true;return false}getActiveSharingOnlyConferenceSession(){let e=null;for(const t in this.conferenceSessions)this.conferenceSessions.hasOwnProperty(t)&&this.conferenceSessions[t]&&this.conferenceSessions[t].type===this.MEDIATYPE.WEBRTCSHARINGONLY&&this.conferenceSessions[t].isActive()&&(e=this.conferenceSessions[t]);return e}hasIncomingVideoStream(e){if(!e)return;const t=this.conferenceSessions[e];if(t){for(const e in t.sessions)if(t.sessions.hasOwnProperty(e)){const i=t.sessions[e];if(!i.isInitiator&&("video"===i.remoteType||"sharing"===i.remoteType))return true}}return false}getRemoteSessionsWithVideoOrSharingStreams(e){const t=[];if(!e)return t;const i=this.conferenceSessions[e];if(i){for(const e in i.sessions)if(i.sessions.hasOwnProperty(e)){const r=i.sessions[e];r.isInitiator||"video"!==r.remoteType&&("sharing"!==r.remoteType||i.isOnlySharingWindow)&&"audio+video"!==r.remoteType||t.push(r)}}return t}getRemoteSharingSession(e,t=false){let i=null;if(!e)return i;const r=this.conferenceSessions[e];if(r){if(r.isOnlySharingWindow&&!t)return i;for(const e in r.sessions)if(r.sessions.hasOwnProperty(e)){const t=r.sessions[e];if(!t.isInitiator&&"sharing"===t.remoteType){i=t;break}}}return i}getSharingSession(e,t=false){let i=null;if(!e)return i;const r=this.conferenceSessions[e];if(r){if(r.isOnlySharingWindow&&!t)return i;for(const e in r.sessions)if(r.sessions.hasOwnProperty(e)){const t=r.sessions[e];if("sharing"===t.remoteType||"sharing"===t.localType){i=t;break}}}return i}hasRemoteVideoOrSharingSession(e){let t=false;if(!e)return t;const i=this.conferenceSessions[e];if(i){for(const e in i.sessions)if(i.sessions.hasOwnProperty(e)){const r=i.sessions[e];if(!r.isInitiator&&("video"===r.remoteType||"sharing"===r.remoteType||"audio+video"===r.remoteType)){t=true;break}}}return t}getRemoteVideoSessions(e){const t=[];if(!e)return t;const i=this.conferenceSessions[e];if(i){for(const e in i.sessions)if(i.sessions.hasOwnProperty(e)){const r=i.sessions[e];r.isInitiator||"video"!==r.remoteType||t.push(r)}}return t}getRemoteAudioVideoBundleSession(e){let t;if(!e)return t;const i=this.conferenceSessions[e];if(i){for(const e in i.sessions)if(i.sessions.hasOwnProperty(e)){const r=i.sessions[e];if(!r.isInitiator&&"audio+video"===r.remoteType){t=r;break}}}return t}getRemoteAudioSession(e){let t;if(!e)return t;const i=this.conferenceSessions[e];if(i){for(const e in i.sessions)if(i.sessions.hasOwnProperty(e)){const r=i.sessions[e];if("audio"===r.localType){t=r;break}}}return t}getRemoteMainVideoSession(e){let t;if(!e)return t;const i=this.conferenceSessions[e];if(i){for(const e in i.sessions)if(i.sessions.hasOwnProperty(e)){const r=i.sessions[e];if(!r.isInitiator&&"video"===r.remoteType&&r.mainSession){t=r;break}}}return t}isAlreadySubscribedToDynamicFeed(e){if(!e)return false;let t=false;const i=this.conferenceSessions[e];return i&&i.videoGallery&&"videoGallery_0"===i.videoGallery[0].id&&"busy"===i.videoGallery[0].state&&(t=true),t}isAlreadySubscribedToPublisher(e,t){if(!e||!t)return false;let i=false;const r=this.conferenceSessions[e];if(r&&r.videoGallery){for(let e=0;e<r.videoGallery.length;e++)if(!r.videoGallery[e].activeSpeaker&&r.videoGallery[e].publisherId===t){i=true;break}}return i}getSessionIdForParticipantByPublisherId(e,t){let i="";if(!e||!t)return i;const r=this.conferenceSessions[e];if(r&&r.videoGallery){for(let e=0;e<r.videoGallery.length;e++)if(r.videoGallery[e].publisherId===t){i=r.videoGallery[e].sessionId;break}}return i}getSessionForParticipantByPublisherId(e,t){let i="";if(!e||!t)return i;const r=this.conferenceSessions[e];if(r&&r.videoGallery){for(let e=0;e<r.videoGallery.length;e++)if(r.videoGallery[e].publisherId===t){i=this.xmppService.connection.jingle.sessions[r.videoGallery[e].sessionId];break}}return i}relatePublisherToElement(e,t,i,r,n=false){if(!e||!t||!i)return false;this.$log.info("[WebConferenceService] relatePublisherToElement");const s=this.conferenceSessions[e];if(s){if(n)s.videoGallery[0].state="busy",s.videoGallery[0].publisherId="",s.videoGallery[0].simulcast=t.simulcast,s.videoGallery[0].subStreamLevel=r;else for(let e=0;e<s.videoGallery.length;e++)if(s.videoGallery[e].id===i){s.videoGallery[e].state="busy",s.videoGallery[e].publisherId=t.participantId,s.videoGallery[e].publisherJidIm=t.jid_im,s.videoGallery[e].displayName=t.participantId,s.videoGallery[e].simulcast=t.simulcast,s.videoGallery[e].subStreamLevel=r;const i=this.contactService.getContact(t.jid_im);i&&(s.videoGallery[e].displayName=i.displayName,s.videoGallery[e].avatarSrc=i.avatar.src);break}}this.updateSubStreamLevelsForConferenceSession(e)}getRelatedPublisherToElement(e,t){if(!e||!t)return null;this.$log.info("[WebConferenceService] getRelatedPublisherToElement");let i=null;const r=this.conferenceSessions[e];if(r&&r.videoGallery){for(let e=0;e<r.videoGallery.length;e++)if(t===r.videoGallery[e].id&&r.videoGallery[e].publisherId){i=r.videoGallery[e];break}}return i}getRelatedElementToPublisher(e,t){if(!e||!t)return null;this.$log.info("[WebConferenceService] getRelatedPublisherToElement");let i=null;const r=this.conferenceSessions[e];if(r&&r.videoGallery){for(let e=0;e<r.videoGallery.length;e++)if(r.videoGallery[e].publisherId===t){i=r.videoGallery[e];break}}return i}relateSessionToPublisher(e,t,i){if(!e||!t||!i)return false;this.$log.info("[WebConferenceService] relateSessionToPublisher pubId "+t+" sessionId "+i);let r=false;const n=this.conferenceSessions[e];if(n){for(let e=0;e<n.videoGallery.length;e++)if(t===n.videoGallery[e].publisherId&&!n.videoGallery[e].sessionId){n.videoGallery[e].sessionId=i,r=true,"videoGallery_0"===n.videoGallery[e].id&&(n.sessions[i].activeSpeaker=true,n.videoGallery[e].publisherId="");break}this.$log.info(n.videoGallery)}return r}removeSessionFromVideoGallery(e,t){if(e&&t){e.videoGallery||(this.createVideoGalleryElements(e.conferenceView),e.videoGallery=this.videoGalleryElements),this.$log.info("[WebConferenceService] removeSessionFromVideoGallery for conference "+e.id+" sessionId "+t);for(let i=0;i<e.videoGallery.length;i++)e.videoGallery[i].sessionId===t&&(e.videoGallery[i].sessionId="",e.videoGallery[i].state="free",e.videoGallery[i].publisherId="",e.videoGallery[i].publisherJidIm="",e.videoGallery[i].displayName="",e.videoGallery[i].avatarSrc="",e.videoGallery[i].simulcast=null,e.videoGallery[i].subStreamLevel=null,e.videoGallery[i].mainSession=false,e.videoGallery[i].pinned=false,e.videoGallery[i].hold=false);e.videoGallery=this.updateVideoGalleryElementsState(e,e.videoGallery,e.conferenceView)}}reInitialiseVideoGalleryElementById(e,t){if(e&&t){e.videoGallery||(this.createVideoGalleryElements(e.conferenceView),e.videoGallery=this.videoGalleryElements),this.$log.info("[WebConferenceService] reInitialiseVideoGalleryElementById for conference "+e.id+" elementId "+t);for(let i=0;i<e.videoGallery.length;i++)e.videoGallery[i].id===t&&(e.videoGallery[i].sessionId&&this.dropRemoteVideoSession(e,e.videoGallery[i].sessionId),e.videoGallery[i].sessionId="",e.videoGallery[i].state="free",e.videoGallery[i].publisherId="",e.videoGallery[i].publisherJidIm="",e.videoGallery[i].displayName="",e.videoGallery[i].avatarSrc="",e.videoGallery[i].subStreamLevel=null,e.videoGallery[i].simulcast=null,e.videoGallery[i].hold=false,e.videoGallery[i].reconnecting=false);e.videoGallery=this.updateVideoGalleryElementsState(e,e.videoGallery,e.conferenceView)}}updateMainScreenSession(e,t=null){if(!e)return;const i=this.conferenceSessions[e];if(i){for(const e in i.sessions)if(i.sessions.hasOwnProperty(e)){const r=i.sessions[e];t&&t.sessionId===r.sid?(r.mainSession=true,r.pinned=true):(r.mainSession=false,r.pinned=false)}return i.videoGallery.forEach((e=>{t&&e.id===t.id?(e.mainSession=true,e.pinned=true):(e.mainSession=false,e.pinned=false)})),i}}updateSubStreamLevelsForConferenceSessionV3(e){const t=this.conferenceSessions[e],i=t.getConnectedParticipantByJid(this.contactService.userContact.jid),r=this.getSharingSession(t.id);if(t.conferenceView===this.ConferenceSession.ConferenceView.GridView){const n=this.getRemoteVideoSessions(e);let s="0";const o=r&&!r.showOnSecondPip;n.length>1&&n.length<=3&&(s=o?"1":"2"),n.length>3&&n.length<=7&&(s=o?"0":"1"),t.videoGallery.forEach((e=>{e.simulcast&&"videoGallery_0"!==e.id&&e.subStreamLevel!==s&&this.updateSubstreamLevelForPublisher(t.id,i.participantId,s,e)}))}else{const e=r?"2":"1";t.videoGallery.forEach((r=>{r.simulcast&&"videoGallery_0"===r.id&&this.updateSubstreamLevelForPublisher(t.id,i.participantId,e,r)})),t.conferenceView===this.ConferenceSession.ConferenceView.GalleryView&&t.videoGallery.forEach((e=>{e.simulcast&&"videoGallery_0"!==e.id&&this.updateSubstreamLevelForPublisher(t.id,i.participantId,"0",e)}))}}updateSubStreamLevelsForConferenceSession(e){if(this.disableAutoUpdateSubstreamLevels)return;if(this.settingsService.getBooleanSetting("newSfuAndP2P")&&this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_UI_3_0))return void this.updateSubStreamLevelsForConferenceSessionV3(e);this.$log.info("[WebConferenceService] updateSubStreamLevelsForConferenceSession");const t=this.conferenceSessions[e],i=t.getConnectedParticipantByJid(this.contactService.userContact.jid),r=this.getSharingSession(t.id);if(t.conferenceView===this.ConferenceSession.ConferenceView.GridView){const r=this.getRemoteVideoSessions(e);let n="0";r.length>1&&r.length<=3&&(n="2"),r.length>3&&r.length<=7&&(n="1"),t.videoGallery.forEach((e=>{e.simulcast&&"videoGallery_0"!==e.id&&e.subStreamLevel!==n&&this.updateSubstreamLevelForPublisher(t.id,i.participantId,n,e)}))}else r&&!r.showOnSecondPip?t.videoGallery.forEach((e=>{e.simulcast&&"0"!==e.subStreamLevel&&this.updateSubstreamLevelForPublisher(t.id,i.participantId,"0",e)})):t.videoGallery.forEach((e=>{if(e.simulcast&&"videoGallery_0"===e.id&&this.updateSubstreamLevelForPublisher(t.id,i.participantId,"2",e),e.simulcast&&"videoGallery_0"!==e.id){const r=t.sessions[e.sessionId];if(r){const n=r.mainSession?"2":"0";this.updateSubstreamLevelForPublisher(t.id,i.participantId,n,e)}}}))}getListOfAvailableRemoteVideoPublishers(e){if(!e)return;const t=this.conferenceSessions[e];let i=[];return t&&(t.videoGallery||(this.createVideoGalleryElements(t.conferenceView),t.videoGallery=this.videoGalleryElements),i=t.getListOfRemoteVideoPublishers(),i=i.filter((e=>{for(let i=0;i<t.videoGallery.length;i++)if(t.videoGallery[i].publisherId===e.participantId)return false;return true}))),i}getListOfPublishersForElementsOnHold(e){if(!e)return;const t=this.conferenceSessions[e],i=[];if(t){t.videoGallery||(this.createVideoGalleryElements(t.conferenceView),t.videoGallery=this.videoGalleryElements);const e=t.getListOfRemoteVideoPublishers();for(let r=0;r<t.videoGallery.length;r++)"videoGallery_0"!==t.videoGallery[r].id&&t.videoGallery[r].publisherId&&t.videoGallery[r].hold&&e.forEach((e=>{e.participantId===t.videoGallery[r].publisherId&&i.push(e)}))}return i}sendTransportReplaceForSession(e,t){e&&e.sid?e.peerconnection&&"stable"===e.peerconnection.signalingState&&"failed"!==e.peerconnection.iceConnectionState&&"disconnected"!==e.peerconnection.iceConnectionState?this.$log.info("[WebConferenceService] sendTransportReplaceForSession not needed for "+e.sid):this.reconnecting[e.sid]?this.$log.info("[WebConferenceService] sendTransportReplaceForSession already reconnecting for session "+e.sid):(this.reconnecting[e.sid]=true,t||(t=1e3),this.$interval((e=>{if(this.reconnecting[e.sid]=false,delete this.reconnecting[e.sid],this.connected&&e&&e.peerconnection&&"stable"===e.peerconnection.signalingState&&("failed"===e.peerconnection.iceConnectionState||"disconnected"===e.peerconnection.iceConnectionState)){if(this.$log.info("[WebConferenceService] sendTransportReplaceForSession for session "+e.sid),e.connection=this.xmppService.connection,e.reconnectSession(),e.type!==this.MEDIATYPE.WEBRTCSHARINGONLY){const t=e.hasLocalSharing?"sharing":"audio";this.contactService.setBusyState("dnd",t)}}else this.$log.info("[WebConferenceService] sendTransportReplaceForSession for session "+e.sid+" is not send ...")}),t,1,true,e)):this.$log.warn("[WebConferenceService] sendTransportReplaceForSession missing session !")}onAudioProfileChangeEvent(){if(this.$log.info("[WebConferenceService] onAudioProfileChangeEvent"),this.audioProfileChanging)this.$log.info("[WebConferenceService] onAudioProfileChangeEvent -- already changing");else for(const e in this.conferenceSessions)if(this.conferenceSessions.hasOwnProperty(e)){const t=this.conferenceSessions[e];for(const e in t.sessions)if(t.sessions.hasOwnProperty(e)){const i=t.sessions[e];"audio"===i.localType&&(this.audioProfileChanging=true,this.$interval(((e,t)=>{this.audioProfileChanging=false;this.webrtcP2PService.getBrowserMedia(["audio"]).then((i=>{e.removeStream(e.localStreams[0]),this.webrtcP2PService.stopActiveAudioVideoStreams(e),e.localStreams.push(i),e.addStream(e.localStreams[0]),e.sendTransportReplace(),this.sendEvent("onAudioStreamAdded",t)})).catch((()=>{e.removeStream(e.localStreams[0]),this.webrtcP2PService.stopActiveAudioVideoStreams(e),e.sendTransportReplace(),this.sendEvent("onAudioStreamRemoved",t)}))}),500,1,true,i,t))}}}onJingleError(e){this.$log.info("[WebConferenceService] onJingleError -- "+e);const t=this.getConferenceBySessionId(e);if(t&&t.sessions){"audio"===t.sessions[e].localType?this.leaveWebConference(t.id):(this.updateStatisticsForSession(t.id,e),t.localVideoSessionId===e?this.removeMediaFromConferenceSession(t,"video"):t.localSharingSessionId===e?this.removeMediaFromConferenceSession(t,"sharing"):(this.removeSessionFromVideoGallery(t,e),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",t)))}}onIceConnectionDisconnectedForSession(e,t){if(this.$log.info("[WebConferenceService] onIceConnectionDisconnectedForSession -- "+t),e&&e.sessions){const i=e.sessions[t];"audio"===i.localType?(e.status="reconnecting",this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",e),this.connected&&this.sendTransportReplaceForSession(i,5e3)):e.localVideoSessionId!==t&&e.localSharingSessionId!==t||this.connected&&this.sendTransportReplaceForSession(i,8e3)}}onIceConnectionFailedForSession(e,t){if(this.$log.info("[WebConferenceService] onIceConnectionFailedForSession -- "+t),e&&e.sessions){const i=e.sessions[t];if(!i)return void this.$log.info("[WebConferenceService] onIceConnectionFailedForSession -- session is missing");"audio"===i.localType?(e.status="reconnecting",this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",e),this.connected&&this.sendTransportReplaceForSession(i,500)):e.localVideoSessionId===t||e.localSharingSessionId===t?this.connected&&this.sendTransportReplaceForSession(i,500):"video"===i.remoteType?this.connected&&(this.xmppService.connection.jingle.terminate(t),this.updateStatisticsForSession(e.id,t),delete this.webrtcConfigAndUtils.callsStats[t],e.videoGallery.forEach((e=>{e.sessionId===t&&(e.sessionId="")})),delete e.sessions[t],this.resubscribeToSessions(e)):this.connected&&(this.xmppService.connection.jingle.terminate(t,"icefailed"),this.updateStatisticsForSession(e.id,t),delete this.webrtcConfigAndUtils.callsStats[t],this.removeSessionFromVideoGallery(e,t),delete e.sessions[t],this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",e))}}onIncomingCall(e){this.$log.info("[WebConferenceService] onIncomingCall -- "+e);const t=this.xmppService.connection.jingle.sessions[e],i=t.confId,r=this.conferenceSessions[i];if(r){if(r.sessions[e]=t,t.localType=t.remoteType,t.sendAnswer(),t.accept(),"video"===t.remoteType){if(!this.activeSpeaker||t.publisherId&&r.videoGallery[0].sessionId!==t.sid){if(!this.relateSessionToPublisher(i,t.publisherId,t.sid)){this.$log.info("[WebConferenceService] no gallery element related to session, attach to first available");const e=this.getFreeVideoGalleryElement(i);e&&!this.isAlreadySubscribedToPublisher(r.id,t.publisherId)&&(e.state="busy",e.publisherId=t.publisherId,e.sessionId=t.sid)}}else r.videoGallery[0].publisherId="",t.activeSpeaker=true;this.updateSubStreamLevelsForConferenceSession(i)}"sharing"===t.remoteType&&(this.updateConferenceViewIfNeeded(i),this.updateSubStreamLevelsForConferenceSession(i)),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",r),this.webrtcConfigAndUtils.callsStats[t.sid]={},this.updateStatisticsForSession(r.id,t.sid),this.statsIntervals.push(t.getStats(8e3))}else this.$log.error("[WebConferenceService] onIncomingCall no such conferenceSession "+i)}onTerminatedCall(e){let t=this.xmppService.connection.jingle.sessions[e],i=null;t&&t.confId&&(i=this.conferenceSessions[t.confId]),i||(i=this.getActiveConferenceSession()?this.getActiveConferenceSession():this.getActiveSharingOnlyConferenceSession()),i?(this.$log.info("[WebConferenceService] onTerminatedCall -- "+e),t||(t=i.sessions[e]),t&&"audio"===t.localType?this.leaveWebConference(i.id):i.localVideoSessionId===e?this.removeMediaFromConferenceSession(i,"video"):i.localSharingSessionId===e?(this.removeMediaFromConferenceSession(i,"sharing"),this.updateSubStreamLevelsForConferenceSession(i.id)):(this.removeSessionFromVideoGallery(i,e),this.webrtcConfigAndUtils.disableAllStreamsForSession(i.sessions[e]),delete i.sessions[e],delete this.webrtcConfigAndUtils.callsStats[e],this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",i),this.autoFillGalleryElementIfNecessary(i),this.updateSubStreamLevelsForConferenceSession(i.id))):this.$log.info("[WebConferenceService] onTerminatedCall no active conferenceSession for webrtc session "+e)}onConferenceCallSwitched(e){this.$log.info("[WebConferenceService] onConferenceCallSwitched -- "+e);const t=this.getActiveConferenceSession();t&&this.leaveWebConference(t.id)}onIceConnectionStateChange(e,t){try{const i=this.getConferenceBySessionId(e);i&&t.peerconnection&&(this.$log.info("[WebConferenceService] onIceConnectionStateChange for session "+e),"stable"===t.peerconnection.signalingState&&"connected"===t.peerconnection.iceConnectionState&&(this.$log.info("[WebConferenceService] ICE Connection established successfully"),"audio"===t.localType?(i.status="connected",i.startDuration(),this.attachRemoteAudioStream(i)):"video"===t.remoteType?i.videoGallery=this.updateVideoGalleryElementsState(i,i.videoGallery,i.conferenceView):"sharing"===t.localType&&this.updateSubStreamLevelsForConferenceSession(i.id),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",i),this.$rootScope.$broadcast("ON_CONFERENCE_STATE_EVENT",i),this.sendEvent("peerConnectionEstablished",{sessionId:e})),"stable"===t.peerconnection.signalingState&&"completed"===t.peerconnection.iceConnectionState&&(this.$log.info("[WebConferenceService] ICE Connection completed successfully"),"connected"!==i.status&&("audio"===t.localType&&(i.status="connected",i.startDuration(),this.attachRemoteAudioStream(i)),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",i),this.$rootScope.$broadcast("ON_CONFERENCE_STATE_EVENT",i),this.sendEvent("peerConnectionEstablished",{sessionId:e}))),"stable"===t.peerconnection.signalingState&&"disconnected"===t.peerconnection.iceConnectionState&&(this.$log.info("[WebConferenceService] ICE Connection State disconnected"),this.onIceConnectionDisconnectedForSession(i,e)),"stable"===t.peerconnection.signalingState&&"failed"===t.peerconnection.iceConnectionState&&(this.$log.info("[WebConferenceService] ICE Connection State failed"),this.onIceConnectionFailedForSession(i,e)))}catch(i){this.$log.error("[WebConferenceService] onIceConnectionStateChange error "+i)}}updateOrCreateConferenceSession(e,t,i="webrtc"){if(this.$log.debug("[webConferenceService] updateOrCreateConferenceSession for "+e),!e||!t||!t.data)return this.$log.error("[webConferenceService] updateOrCreateConferenceSession - Not enough data"),null;let r=this.conferenceSessions[e];return r?t.data.active!==r.active&&(this.$log.debug("active"),r.updateActiveState(t.data.active),t.data.active?this.$rootScope.$broadcast("ON_CONFERENCE_STATE_EVENT",r):this.leaveWebConference(e)):(this.$log.debug("[webConferenceService] updateOrCreateConferenceSession - create new conferencesession with id "+e+"and data: \n"+JSON.stringify(t.data)),this.settingsService.getBooleanSetting("newSfuAndP2P")&&this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_UI_3_0)&&this.setDefaultConferenceLayout("grid_view"),r=this.ConferenceSession.createFromData(e,[],t.data.active,i,this.defaultConferenceLayout),this.conferenceSessions[e]=r,this.$rootScope.$broadcast("ON_CONFERENCE_STATE_EVENT",r)),r&&t.data.participants&&r.active&&(this.$log.debug("[webConferenceService] updateOrCreateConferenceSession - (is active : "+r.active+") update participants for "+e+" with:\n"+JSON.stringify(t.data.participants)),r.updateParticipants(t.data.participants).then((()=>{this.$rootScope.$broadcast("ON_CONFERENCE_PARTICIPANT_EVENT",r)}))),r}updateOrCreateWebConferenceEndpoint(e){if(this.$log.info("[WebConferenceService] updateOrCreateWebConferenceEndpoint for "+e.id),!e)return this.$log.error("[WebConferenceService] updateOrCreateWebConferenceEndpoint - no conference data !"),null;if(e.mediaType!==this.MEDIATYPE.WEBRTC&&e.mediaType!==this.MEDIATYPE.WEBRTCSHARINGONLY)return this.$log.error("[WebConferenceService] updateOrCreateWebConferenceEndpoint - wrong mediaType:"+e.mediaType),null;const t=this.Conference.createFromData(e);return this.conferenceEndpoints[e.id]=t,t.mediaType===this.MEDIATYPE.WEBRTC?this.updateWebConferenceInfos([t]):this.updateWebSharingOnlyConferenceInfos([t]),this.conferenceEndpoints[e.id]}makeSnapshotForConfId(e=null,t="webrtc",i=false){if(!e){const e="[webConferenceService] makeSnapshotForConfId - No confId !!";return this.$log.error(e),this.$q.reject(e)}const r=this.conferenceSessions[e];return!i&&r&&r.active&&r.haveJoined?(this.$log.debug("[WebConferenceService] makeSnapshotForConfId skipped, already joined"),this.$q.resolve(r)):!i&&r&&this.makingCall?(this.$log.debug("[WebConferenceService] makeSnapshotForConfId skipped, we're currently joining the conference"),this.$q.resolve(r)):(this.$log.info("[webConferenceService] makeSnapshotForConfId for confId "+e),this.$q(((i,r)=>{this.$http({method:"GET",url:this.confPortalURL+e+"/snapshot?mediaType=webrtc",headers:this.authService.getRequestHeader()}).then((r=>{this.$log.info("[webConferenceService] makeSnapshotForConfId success for confId "+e);const n=r.data;this.updateOrCreateConferenceSession(e,n,t),i(n.data)})).catch((t=>{this.$log.info("[webConferenceService] makeSnapshotForConfId failure for confID "+e),404===t.status?this.$log.error("[webConferenceService] makeSnapshotForConfId - confId "+e+" not found on server"):this.$log.error("[webConferenceService] makeSnapshotForConfId - inconsistent object on server"),this.conferenceSessions[e]&&this.removeConferenceSession(e),r()}))})))}refreshConferenceSessions(){return this.$log.info("[webConferenceService] refreshConferenceSessions"),this.$q(((e,t)=>{const i=[];for(const r in this.conferenceSessions)if(this.conferenceSessions.hasOwnProperty(r)){const e=this.conferenceSessions[r];i.push(this.makeSnapshotForConfId(e.id,e.type))}this.$q.all(i).then((()=>{this.$log.info("[webConferenceService] refreshConferenceSessions -- success"),e()})).catch((()=>{this.$log.error("[webConferenceService] refreshConferenceSessions -- error -- some session are corrupted and deleted"),t()}))}))}removeAllConferenceSessions(){this.$log.info("[webConferenceService] removeAllConferenceSessions");for(const e in this.conferenceSessions)this.conferenceSessions.hasOwnProperty(e)&&this.removeConferenceSession(e)}getConferenceSessionForRoom(e){let t=null;if(e&&e.length)for(let i=0;i<e.length;i++)e[i].mediaType!==this.MEDIATYPE.WEBRTC&&e[i].mediaType!==this.MEDIATYPE.WEBRTCSHARINGONLY||(t=this.conferenceSessions[e[i].confEndpointId]);return t}setDefaultConferenceLayout(e){this.defaultConferenceLayout=e}setDisableAutoUpdateSubstreamLevels(e){this.disableAutoUpdateSubstreamLevels=e}setDisableAutoFillForGalleryElements(e){this.disableAutoFillForGalleryElements=e}removeVideoGalleryVideos(e){e&&e.videoGallery&&e.videoGallery.forEach((t=>{const i=e.sessions[t.sessionId];i&&(this.updateStatisticsForSession(e.id,i.sid),this.webrtcConfigAndUtils.disableAllStreamsForSession(i),delete e.sessions[i.sid],delete e.localStreams[i.localStreamId],delete this.webrtcConfigAndUtils.callsStats[i.sid],this.xmppService.connection.jingle.terminate(i.sid))}))}relateSessionToActiveSpeakerElement(e,t){if(!e)return;const i=this.conferenceSessions[e];i&&i.videoGallery&&(i.videoGallery[0].sessionId=t,i.videoGallery[0].publisherId="")}resubscribeToSessions(e){e&&e.publishers.length&&e.videoGallery.forEach((t=>{if("videoGallery_0"!==t.id||"busy"!==t.state||t.reconnecting||t.sessionId){if("busy"===t.state&&!t.reconnecting&&!t.sessionId&&t.publisherId){t.reconnecting=true;const i=e.getPublisherById(t.publisherId);this.subscribeToPublisher(e.id,i,t.id,t.subStreamLevel).then((()=>{this.$log.info("[ConferenceService] resubscribeToSession for element "+t.id+" and publisher id "+t.publisherId+" -- success"),t.reconnecting=false})).catch((()=>{this.$log.error("[ConferenceService] subscribe to publisher failed, reset the video gallery element with id "+t.id),this.reInitialiseVideoGalleryElementById(e,t.id)}))}}else t.reconnecting=true,this.subscribeToPublisher(e.id,e.publishers[0],t.id,"2",true).then((()=>{this.$log.info("[ConferenceService] resubscribeToSession dynamic feed for element "+t.id+" -- success"),t.reconnecting=false})).catch((()=>{this.$log.error("[ConferenceService] subscribe to publisher dynamic feed failed, reset the video gallery element with id "+t.id),this.reInitialiseVideoGalleryElementById(e,t.id)}))}))}subscribeToPublishers(e){e&&e.publishers.length&&e.publishers.forEach((t=>{if("video"===t.mediaType&&!this.isAlreadySubscribedToPublisher(e.id,t.participantId)){const i=this.getFreeVideoGalleryElement(e.id);if(i){i.state="busy",i.publisherId=t.participantId;const r=t.simulcast?"0":null;this.subscribeToPublisher(e.id,t,i.id,r).catch((()=>{this.$log.error("[ConferenceService] subscribe to publisher failed, reset the video gallery element with id "+i.id),this.reInitialiseVideoGalleryElementById(e,i.id)}))}}}))}updateConferenceViewIfNeeded(e){if(!e)return;const t=this.conferenceSessions[e];t&&(this.settingsService.getBooleanSetting("newSfuAndP2P")&&this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_UI_3_0)||t.conferenceView===this.ConferenceSession.ConferenceView.GridView&&this.modifyConferenceView(e,this.ConferenceSession.ConferenceView.GalleryView))}modifyConferenceView(e,t){if(!e)return;const i=this.conferenceSessions[e];if(i&&i.conferenceView!==t){if(i.conferenceView=t,t===this.ConferenceSession.ConferenceView.GalleryView){if(i.videoGallery=this.updateVideoGalleryElementsState(i,i.videoGallery,t),!this.isAlreadySubscribedToDynamicFeed(i.id)){let e=null;for(const t of i.publishers)if("video"===t.mediaType){e=t;break}this.subscribeToDynamicFeed(i.id,e,i.videoGallery[0].id,"2",true)}this.subscribeToPublishers(i)}else if(t===this.ConferenceSession.ConferenceView.SpeakerView){if(i.videoGallery=this.updateVideoGalleryElementsState(i,i.videoGallery,t),!this.isAlreadySubscribedToDynamicFeed(i.id)){let e=null;for(const t of i.publishers)if("video"===t.mediaType){e=t;break}this.subscribeToDynamicFeed(i.id,e,i.videoGallery[0].id,"2",true)}}else t===this.ConferenceSession.ConferenceView.GridView&&(i.videoGallery=this.updateVideoGalleryElementsState(i,i.videoGallery,t),this.subscribeToPublishers(i));console.error(i.videoGallery),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",i)}}getActiveSpeakerSession(e){let t=null;if(!e)return t;const i=this.conferenceSessions[e];if(i){for(const e in i.sessions)if(i.sessions.hasOwnProperty(e)){const r=i.sessions[e];if(r.activeSpeaker){t=r;break}}}return t}getPinnedGalleryElement(e){let t=null;if(!e)return t;const i=this.conferenceSessions[e];return i&&i.videoGallery&&i.videoGallery.forEach((e=>{e.pinned&&(t=e)})),t}subscribeToDynamicFeed(e="",t=null,i="",r=null,n=false){return this.$q(((s,o)=>{if(!e||!t)return this.$log.warn("[WebConferenceService] subscribeToDynamicFeed missing parameters !! Ignore !"),void s();if(!this.activeSpeaker)return this.$log.warn("[WebConferenceService] subscribeToDynamicFeed -- feature not activated"),void s();if(this.conferenceSessions[e].videoGallery[0].state="busy",(this.conferenceSessions[e].conferenceView===this.ConferenceSession.ConferenceView.GalleryView||this.conferenceSessions[e].conferenceView===this.ConferenceSession.ConferenceView.GridView||this.settingsService.getBooleanSetting("newSfuAndP2P")&&this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_UI_3_0))&&!this.isAlreadySubscribedToPublisher(e,t.participantId)){const i=this.getFreeVideoGalleryElement(e);i&&(i.state="busy",i.publisherId=t.participantId,this.$interval(((e,t,i)=>{"busy"===i.state&&i.publisherId===t.participantId&&this.subscribeToPublisher(e,t,i.id,"0")}),1500,1,true,e,t,i))}return this.subscribeToPublisher(e,t,i,r,n)}))}subscribeToPublisher(e="",t=null,i="",r=null,n=false){return this.$q(((s,o)=>{if(!e||!t)return this.$log.warn("[WebConferenceService] subscribeToPublisher missing parameters !! Ignore !"),void s();this.$log.info("[WebConferenceService] subscribeToPublisher for confId "+e+" and publisher "+t.participantId),i&&this.relatePublisherToElement(e,t,i,r,n);const a=r?{subStreamLevel:r}:{};n&&(a.dynamicFeed=true,"true"===this.settingsService.getSetting("dynamicFeedMediumStream")&&(a.subStreamLevel="1")),this.$http({method:"POST",url:this.confPortalURL+e+"/participants/"+t.participantId+"/subscribe",headers:this.authService.getRequestHeader(),data:a}).then((t=>{this.$log.info("[WebConferenceService] subscribeToPublisher successfully"),n&&this.relateSessionToActiveSpeakerElement(e,t.data.data.sid),s(t.data)}),(e=>{const t="subscribeToPublisher failure: "+(e.data?e.data.errorDetails:e.data);this.$log.error("[WebConferenceService] "+t),o(new Error(t))}))}))}onNetworkQualityChange(e){const t=this.getConferenceBySessionId(e);if(t&&t.sessions){const i=t.sessions[e];i&&"audio"===i.localType&&(this.webrtcConfigAndUtils.callsStatsSimplified[e].networkQualityFlag===t.networkQuality?(this.webrtcConfigAndUtils.callsStatsSimplified[e].networkQualityIteration=this.webrtcConfigAndUtils.callsStatsSimplified[e].networkQualityIteration?this.webrtcConfigAndUtils.callsStatsSimplified[e].networkQualityIteration+1:1,0===t.networkQuality&&this.webrtcConfigAndUtils.callsStatsSimplified[e].networkQualityIteration>=3&&this.$rootScope.$broadcast("ON_CONFERENCE_NETWORK_UPDATE_EVENT",t,"badNetworkQuality",t.networkQuality)):this.webrtcConfigAndUtils.callsStatsSimplified[e].networkQualityIteration=1,t.networkQuality=this.webrtcConfigAndUtils.callsStatsSimplified[e].networkQualityFlag,this.$rootScope.$broadcast("ON_CONFERENCE_NETWORK_UPDATE_EVENT",t,"networkQuality",t.networkQuality))}}delegateConferenceToParticipant(e,t){return this.$q(((i,r)=>{this.$http({method:"PUT",url:this.confPortalURL+e+"/participants/"+t+"/delegate",headers:this.authService.getRequestHeader()}).then((e=>{this.$log.info("[WebConferenceService] delegateConferenceToParticipant successfully"),i(e.data)}),(e=>{const t="delegateConferenceToParticipant failure: "+(e.data?e.data.errorDetails:e.data);this.$log.error("[WebConferenceService] "+t),r(new Error(t))}))}))}onConferenceDelegated(e,t,i=""){if(this.$log.info("[WebConferenceService] onConferenceDelegated from "+e+" to "+t),this.conferenceSessions[t]=this.conferenceSessions[e],!this.conferenceSessions[t]||!this.conferenceSessions[e])return this.roomService.updateRoomConfEndpoint(e,t),void this.$log.info("[WebConferenceService] onConferenceDelegated -- no active conference");if(e===t&&i){const r=this.contactService.isUserContactJid(i);this.conferenceSessions[t].isMyConference=r;let n=false;const s=this.conferenceSessions[t].getConnectedParticipantByJid(this.contactService.userContact.jid);return"moderator"!==(s?s.role:"")||r||(n=true),this.conferenceSessions[t].participants&&this.conferenceSessions[t].participants.length&&this.conferenceSessions[t].participants.forEach((e=>{e.jid_im!==i?e.role="member":e.jid_im===i&&(e.role="moderator")})),n&&this.$rootScope.$broadcast("ON_CONFERENCE_DELEGATED_EVENT",e,t,i),void this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",this.conferenceSessions[t])}this.conferenceSessions[t].id=t,this.isMyConference(t)&&(this.conferenceSessions[t].isMyConference=true,this.conferenceSessions[t].participants&&this.conferenceSessions[t].participants.length&&this.conferenceSessions[t].participants.forEach((e=>{e.jid_im!==this.contactService.userContact.jid?e.role="member":e.jid_im===this.contactService.userContact.jid&&(e.role="moderator")}))),this.isMyConference(e)&&(this.conferenceSessions[t].isMyConference=false,this.conferenceSessions[t].participants&&this.conferenceSessions[t].participants.length&&this.conferenceSessions[t].participants.forEach((e=>{e.jid_im===this.contactService.userContact.jid&&(e.role="member")}))),delete this.conferenceSessions[e],this.roomService.updateRoomConfEndpoint(e,t),this.$rootScope.$broadcast("ON_CONFERENCE_DELEGATED_EVENT",e,t),this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",this.conferenceSessions[t]),!this.isMyConference(t)&&this.conferenceSessions[t].haveJoined&&this.$interval((async e=>{const i=await this.getConferenceEndpointInfos(e);if(i&&i.data&&i.data.userId){const e=this.contactService.getContactById(i.data.userId);e&&this.conferenceSessions[t].participants&&this.conferenceSessions[t].participants.length&&this.conferenceSessions[t].participants.forEach((t=>{t.jid_im===e.jid&&(t.role="moderator")})),this.$rootScope.$broadcast("ON_CONFERENCE_PARTICIPANT_EVENT",this.conferenceSessions[t])}}),100,1,true,t)}getConferenceEndpointInfos(e,t="small"){return this.$q(((i,r)=>{if(!e)return this.$log.error("[WebConferenceService] getConferenceEndpointInfos -- missing endpointId "),void r("[WebConferenceService] getConferenceEndpointInfos -- missing endpointId ");this.$http({method:"GET",url:this.confProvPortalURL+"conferences/"+e+"?format="+t,headers:this.authService.getRequestHeader()}).then((e=>{this.$log.info("[WebConferenceService] getConferenceEndpointInfos successfully"),i(e.data)}),(e=>{const t="getConferenceEndpointInfos failure: "+(e.data?e.data.errorDetails:e.data);this.$log.error("[WebConferenceService] "+t),r(new Error(t))}))}))}autoFillGalleryElementIfNecessary(e){if(this.disableAutoFillForGalleryElements)return;if(!e)return void this.$log.error("[WebConferenceService] autoFillGalleryElementIfNecessary -- missing conferenceSession");this.settingsService.getBooleanSetting("newSfuAndP2P")&&this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_UI_3_0)?this.createVideoGalleryElements("grid_view"):this.createVideoGalleryElements(e.conferenceView);let t=0;e.videoGallery.forEach((e=>{"busy"===e.state&&e.sessionId&&(this.videoGalleryElements[t].activeSpeaker=e.activeSpeaker,this.videoGalleryElements[t].highlight=e.highlight,this.videoGalleryElements[t].hold=e.hold,this.videoGalleryElements[t].mainSession=e.mainSession,this.videoGalleryElements[t].pinned=e.pinned,this.videoGalleryElements[t].publisherId=e.publisherId,this.videoGalleryElements[t].publisherJidIm=e.publisherJidIm,this.videoGalleryElements[t].publisherJid=e.publisherJid,this.videoGalleryElements[t].sessionId=e.sessionId,this.videoGalleryElements[t].simulcast=e.simulcast,this.videoGalleryElements[t].state=e.state,this.videoGalleryElements[t].subStreamLevel=e.subStreamLevel,this.videoGalleryElements[t].displayName=e.displayName,this.videoGalleryElements[t].avatarSrc=e.avatarSrc,t+=1)})),e.videoGallery=this.videoGalleryElements,e.videoGallery=this.updateVideoGalleryElementsState(e,e.videoGallery,e.conferenceView),this.updateSubStreamLevelsForConferenceSession(e.id),setTimeout((()=>{this.subscribeToPublishers(e)}),500)}addBundleMediaToConferenceSession(e){let t;if(this.$log.info("[WebConferenceService] addBundleMediaToConferenceSession"),e){for(const i in e.sessions)if(e.sessions.hasOwnProperty(i)){const r=e.sessions[i];if("audio"===r.localType||"audio+video"===r.localType){t=r;break}}}if(t){this.addingMedia=true;const i=["audio","video"],r=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.WEBRTC_CONFERENCE_SIMULCAST),n=17,s=r?1280:640,o=r?720:480;this.webrtcP2PService.getBrowserMedia(i,s,o,n).then((i=>{this.addingMedia=false,this.webrtcP2PService.stopActiveAudioVideoStreams(t),t.removeStream(e.localStreams[0]),t.localStreams=[],e.localStreams[0]=i,t.localStreams.push(i),t.addStream(e.localStreams[0],true),t.contentAdd("video",true),e.hasLocalVideo=true,e.localVideoSessionId=t.sid,t.localStreamId=0,this.$rootScope.$broadcast("ON_CONFERENCE_UPDATED_EVENT",e)})).catch((()=>{this.addingMedia=false}))}}async startMediaEchoTest(){this.$log.debug("[WebConferenceService] startMediaEchoTest");try{const e=config.restServerUrl+"/api/rainbow/conference/v1.0/echotest",t=this.authService.getPostHeader(),i=await fetch(e,{method:"PUT",headers:t});if(!i.ok)throw i;this.$log.info("[WebConferenceService] startMediaEchoTest success");const r=(await i.json()).data;if(r.jingleJid)return r.jingleJid;throw new Error("Something went wrong")}catch(e){const t=await this.newErrorHelperService.getErrorInfo(e,"startMediaEchoTest");throw t?(this.$log.error("[WebConferenceService] "+t.message),t.error):(this.$log.error("[WebConferenceService] "+e.message),e)}}async stopMediaEchoTest(){this.$log.debug("[WebConferenceService] stopMediaEchoTest");try{const e=config.restServerUrl+"/api/rainbow/conference/v1.0/stop-echotest",t=this.authService.getPostHeader(),i=await fetch(e,{method:"PUT",headers:t});if(!i.ok)throw i;this.$log.info("[WebConferenceService] stopMediaEchoTest success")}catch(e){const t=await this.newErrorHelperService.getErrorInfo(e,"stopMediaEchoTest");throw t?(this.$log.error("[WebConferenceService] "+t.message),t.error):(this.$log.error("[WebConferenceService] "+e.message),e)}}createNewConferenceSessionFromStanza(e){const t=$(e).find("conference-id").text();this.settingsService.getBooleanSetting("newSfuAndP2P")&&this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_UI_3_0)&&this.setDefaultConferenceLayout("grid_view");const i=this.ConferenceSession.createFromData(t,[],false,"webrtc",this.defaultConferenceLayout);return this.conferenceSessions[t]=i,i}}y.$inject=["$q","$rootScope","$log","$http","$interval","errorHelperService","ConferenceSession","Conference"],t.WebConferenceService=y},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(453),n=i(7),s=i(18),o=i(110),a=i(6),c=i(8),l=i(9),d=i(14),u=i(307),h=i(30),f=i(4),p=i(13),g=i(11),m=i(17),v=i(96),S=i(46);class b{constructor(e,t,i,r){this.$q=e,this.$interval=t,this.$http=i,this.webConferenceService=r,this.MEDIATYPE={PSTNAUDIO:"pstnAudio",WEBRTC:"webrtc",WEBRTCSHARINGONLY:"webrtcSharingOnly"},this.started=false,this.rxUpdateSubject=new n.Subject,this.hasConferenceRights=false,this.maxNumberOfUsersSFU=0,this.authService=c.AuthService.getInstance(),this.xmppService=l.XmppService.getInstance(),this.profileService=d.ProfileService.getInstance(),this.contactService=a.ContactService.getInstance(),this.roomService=h.RoomService.getInstance(),this.pgiConferenceService=u.PgiConferenceService.getInstance(),this.utilitiesService=o.UtilitiesService.getInstance(),this.logger=f.LoggerService.getInstance(),this.errorHelperService=p.ErrorHelperService.getInstance(),this.eventService=g.EventService.getInstance(),this.mainService=m.MainService.getInstance(),this.webConferenceServiceV2=v.WebConferenceServiceV2.getInstance(),this.i18nService=S.I18nService.getInstance(),this.stateMap={in_progress:"watching",ringing:"ringing",active:"connected",hangup:"disconnected"},this.listeners=[],this.conferenceRef=null}start(){return this.contactService.userContact&&!this.contactService.userContact.roomsEnabled?(this.logger.info("[ConferenceService] === start skipped - roomsEnabled : "+this.contactService.userContact.roomsEnabled),this.$q.when()):this.$q((e=>(this.logger.info("[ConferenceService] === STARTING ==="),this.hasConferenceRights=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.WEBRTC_CONFERENCE_ALLOWED),this.maxNumberOfUsersSFU=this.profileService.getFeatureLimitMax(this.profileService.FeaturesEnum.WEBRTC_CONFERENCE_PARTICIPANT_COUNT),this.maxNumberOfUsersSFU||(this.maxNumberOfUsersSFU=20),this.confProvPortalURL=config.restServerUrl+"/api/rainbow/confprovisioning/v1.0/",this.confPortalURL=config.restServerUrl+"/api/rainbow/conference/v1.0/conferences/",this.attachHandlers(),this.webConferenceService.retrieveWebConferences(this.MEDIATYPE.WEBRTC).then((()=>this.webConferenceService.retrieveWebConferences(this.MEDIATYPE.WEBRTCSHARINGONLY))).then((()=>this.makeSnapshots())).then((()=>{this.started=true,this.logger.info("[ConferenceService] === STARTED ==="),e(),this.makeSnapshotsForAllRooms()})).catch((t=>{this.logger.info("[ConferenceService] === STARTING FAILURE === "+t.message),e()})))))}stop(){return this.contactService.userContact&&!this.contactService.userContact.roomsEnabled?(this.logger.info("[ConferenceService] === stop skipped - roomsEnabled : "+this.contactService.userContact.roomsEnabled),this.$q.when()):this.$q((e=>{this.logger.info(""),this.logger.info("[ConferenceService] === STOPPING ==="),this.listeners&&this.listeners.forEach((e=>{e()})),this.started=false,this.logger.info("[ConferenceService] === STOPPED ==="),e()}))}reconnect(){this.reconnectService()}attachHandlers(){this.logger.info("[ConferenceService] attachHandlers"),this.conferenceRef&&(this.xmppService.connection.deleteHandler(this.conferenceRef),this.conferenceRef=null),this.conferenceRef=this.xmppService.connection.addHandler((e=>this.onConferenceUpdate(e)),"jabber:iq:conference","message",null)}reconnectService(){!this.contactService.userContact||this.contactService.userContact.roomsEnabled?(this.logger.info("[ConferenceService] reconnectService"),this.attachHandlers(),this.refreshConferenceSessions()):this.logger.info("[ConferenceService] === reconnectService skipped - roomsEnabled : "+this.contactService.userContact.roomsEnabled)}subscribe(e,t){return"update"===e?this.rxUpdateSubject.subscribe(t):null}getWebConferenceEndpoints(){return this.webConferenceService.conferenceEndpoints}makeSnapshotsForAllRooms(){this.roomService.getRoomsWithSfuConferenceEndpoints().forEach((e=>{this.webConferenceService.makeSnapshotForConfId(e)}))}makeSnapshotsForList(e){return this.$q((t=>{if(this.logger.info("[ConferenceService] makeSnapshotsForList"),!e||!e.length)return void t();const i=[];for(let r=0;r<e.length;r++)e[r].mediaType===this.MEDIATYPE.PSTNAUDIO?i.push(this.pgiConferenceService.makeSnapshotForConfId(e[r].confEndpointId)):i.push(this.webConferenceService.makeSnapshotForConfId(e[r].confEndpointId,e[r].mediaType));this.$q.all(i).finally((()=>{t(this.getConferenceSessionForRoom(e))}))}))}getConferenceSessionForRoom(e){let t=null,i=null;if(e&&e.length)for(let r=0;r<e.length;r++)e[r].mediaType===this.MEDIATYPE.PSTNAUDIO?t=this.pgiConferenceService.getConferenceSessionById(e[r].confEndpointId):i=this.webConferenceService.conferenceSessions[e[r].confEndpointId];return t||i}getMatchingConferenceSession(e,t){let i=null;if(e&&e.length)for(let r=0;r<e.length;r++)e[r].confEndpointId===t&&(i=e[r].mediaType===this.MEDIATYPE.PSTNAUDIO?this.pgiConferenceService.getConferenceSessionById(t):this.webConferenceService.conferenceSessions[t]);return i}makeSnapshots(){return this.logger.info("[ConferenceService] makeSnapshots"),this.$q((e=>{const t=[];for(const i in this.webConferenceService.conferenceEndpoints)if(this.webConferenceService.conferenceEndpoints.hasOwnProperty(i)){const e=this.webConferenceService.conferenceEndpoints[i];t.push(this.webConferenceService.makeSnapshotForConfId(e.id,e.mediaType))}this.$q.all(t).finally((()=>{this.logger.info("[ConferenceService] makeSnapshots done"),e()}))}))}onConferenceUpdate(e){try{const t=$(e).find("conference-id").text(),i=$(e).find("conference-info").length?$(e).find("conference-info").attr("action"):"";let r=this.webConferenceService.conferenceSessions[t];if("reject"===i){const e=this.roomService.findRoomsWithConfId(t);return e&&e.length&&this.eventService.publish("ON_CONFERENCE_ENDED_INVITATION",e[0]),true}if("delegate"===i){const i=$(e).find("new-conference-id").text(),r=$(e).find("new-owner-jid-im").text();return this.webConferenceService.onConferenceDelegated(t,i,r),true}return r||(r=this.webConferenceService.createNewConferenceSessionFromStanza(e)),r.haveJoined?this.updateConferenceSession(e,r):(this.updateConferenceSessionActiveState(e,r),this.checkIfUserHasJoinedConferenceFromOtherDevice(e,t,r)),true}catch(t){return this.logger.info("[ConferenceService] onConferenceUpdate error --"+t),true}}checkIfUserHasJoinedConferenceFromOtherDevice(e,t,i=null){try{const r=$(e).find("participants");r&&r.length&&(i&&(i.joinedFromOtherDevice=false),r.find("participant").each(((e,r)=>{if($(r).find("jid-im").text()===this.contactService.userContact.jid){const e=this.roomService.findRoomsWithConfId(t);e&&e.length&&this.eventService.publish("ON_CONFERENCE_ENDED_INVITATION",e[0]),i&&(i.joinedFromOtherDevice=true)}})))}catch(r){return}}updateConferenceSession(e,t){this.logger.info("[ConferenceService] updateConferenceSession");const i=$(e);let r;const n=i.find("conference-state");if(n.length){const e="true"===n.find("active").text(),i="true"===n.find("talker-active").text(),r="true"===n.find("lock").text(),s=n.find("recording-state").text(),o=n.find("recording-user-id").text();let a=n.find("locked-by").text();a||(a=n.find("unlocked-by").text());let c="";!e&&n.find("reason")&&(c=n.find("reason").text()),this.updateState(t,e,i,r,a,c),"on"!==s&&"pause"!==s||(o&&(t.recordingUserId=o),t.recordingStarted=true,t.currentRecordingState=s,this.eventService.publish("on"===s?"ON_CONFERENCE_RECORDING_STARTED":"ON_CONFERENCE_RECORDING_PAUSED",t))}const s=i.find("talkers");if(s.length){const e=[];s.find("participant-id").each(((t,i)=>{const r=$(i).text();e.push(r)}));const r=s.find("talking-time");let n=0;r.length&&(n=parseInt($(r[0]).text(),10)),e.length&&n&&t.updateTalkingTimeForParticipant(e[0],n);i.find("conference-id").text();this.updateTalkers(t,e)}const o=i.find("silents");if(o.length){const e=[];o.find("participant-id").each(((t,i)=>{const r=$(i).text();e.push(r)}));const i=o.find("talking-time");let r=0;i.length&&(r=parseInt($(i[0]).text(),10)),e.length&&r&&t.updateTalkingTimeForParticipant(e[0],r)}let a=i.find("participants");if(0===a.length&&(a=i.find("updated-participants")),a.length||(a=i.find("added-participants")),a.length){const e=[];a.find("participant").each(((i,n)=>{const s=$(n),o=s.find("participant-id").text(),a=s.find("jid-im").text(),c=s.find("phone-number").text(),l=s.find("role").text(),d=s.find("mute").text(),u=s.find("hold").text(),h=s.find("cnx-state").text(),f=s.find("delegate-capability").text(),p=s.find("talking-time").text();let g=s.find("microphone").text();g||(g="true");const m="true"===s.find("talking").text();e.push({participantId:o,jid_im:a,phoneNumber:c,participantRole:l,mute:"on"===d,held:"on"===u,participantState:h,delegateCapability:"true"===f,microphone:"true"===g}),m&&(r=o);const v=p?parseInt(p,10):0;t.updateTalkingTimeForParticipant(o,v,a)})),e.length>0&&(t.conferenceStats&&(t.conferenceStats.isUpdate=false),this.createOrUpdateParticipants(t,e))}else{const e=[];if(i.find("participant").length){const r=i.find("participant-id").text(),n=i.find("jid-im").text(),s=i.find("phone-number").text(),o="member",a=i.find("session-info").text(),c=this.stateMap[a],l="true";e.push({participantId:r,jid_im:n,phoneNumber:s,participantRole:o,mute:false,held:false,participantState:c,delegateCapability:false,microphone:"connected"===c&&"true"===l}),this.createOrUpdateParticipants(t,e)}}const c=i.find("removed-participants");if(c.length){const e=[];if(c.find("participant-id").each(((t,i)=>{const r=$(i).text();e.push(r)})),this.removeParticipants(t,e),t.participants.length<=1){i.find("conference-id").text();this.updateTalkers(t,[])}t.conferenceStats&&(t.conferenceStats.isUpdate=false)}const l=i.find("added-publishers");l.length&&(l.find("publisher").each(((e,i)=>{const r=$(i),n=r.find("publisher-id").text(),s=r.find("media-type").text(),o=r.find("jid-im").text(),a="true"===r.find("simulcast").text();this.addPublisher(t,n,s,o,a)})),this.eventService.publish("ON_CONFERENCE_PUBLISHER_UPDATED",t));const d=i.find("removed-publishers");d.length&&(d.find("publisher").each(((e,i)=>{const r=$(i),n=r.find("participant-id").text(),s=r.find("media-type").text();for(let o=0;o<t.publishers.length;o++){const e=t.publishers[o];if(e.participantId===n&&e.mediaType===s){t.publishers.splice(o,1);break}}if("video"===s&&this.webConferenceService.isAlreadySubscribedToPublisher(t.id,n)){this.logger.info("[ConferenceService] removed-publishers : subscribed to this publisher, so re-init the element");const e=this.webConferenceService.getRelatedElementToPublisher(t.id,n);e&&this.webConferenceService.reInitialiseVideoGalleryElementById(t,e.id)}})),this.eventService.publish("ON_CONFERENCE_PUBLISHER_UPDATED",t));const u=i.find("publishers");u.length&&(u.find("publisher").each(((e,i)=>{const r=$(i),n=r.find("publisher-id").text(),s=r.find("media-type").text(),o=r.find("jid-im").text(),a="true"===r.find("simulcast").text();this.addPublisher(t,n,s,o,a)})),this.eventService.publish("ON_CONFERENCE_PUBLISHER_UPDATED",t));const h=i.find("recording-user-id");return h.text()&&(t.recordingUserId=h.text(),this.eventService.publish("ON_CONFERENCE_RECORDING_STARTED",t)),r&&this.updateTalkers(t,[r]),true}updateConferenceSessionActiveState(e,t){const i=$(e).find("conference-state");if(i.length){this.logger.info("[ConferenceService] updateConferenceSessionActiveState");const e="true"===i.find("active").text(),r="true"===i.find("talker-active").text();let n="";!e&&i.find("reason")&&(n=i.find("reason").text()),this.updateState(t,e,r,null,null,n)}}updateState(e,t,i,r=false,n="",s=""){if(t||this.eventService.publish("CHECK_AND_RESET_BUSY_STATE"),e.active&&!t){if(this.contactService.userContact.guestMode&&e.type!==this.MEDIATYPE.WEBRTCSHARINGONLY)this.eventService.publish("ON_OPEN_POPUP","concludeInvitation");else{const t=this.roomService.findRoomsWithConfId(e.id);if(t&&t.length&&!t[0].owner)switch(e.type){case this.MEDIATYPE.WEBRTCSHARINGONLY:break;case this.MEDIATYPE.PSTNAUDIO:case this.MEDIATYPE.WEBRTC:default:if(e.isParticipantConnectedByJid(this.contactService.userContact.dbId)){const e=_escape(t[0].ownerContact.displayName),i=_escape(t[0].name),r=this.i18nService.translate("meetingEndBy",{owner:e,meeting:i});this.eventService.publish("GLOBAL_NOTIFY_MESSAGE_EVENT",r)}}}e.participants=[],e.status="ended",e.cleanupSessionData&&e.cleanupSessionData(),s&&"noOwnerFound"===s&&this.mainService.showGlobalPopupMessage({popupTitle:"conference",popupBody:"autoDelegationNotPossible",okLabel:"ok"})}e.updateStateFromData(t,i,r),this.eventService.publish("ON_CONFERENCE_STATE_EVENT",e),n&&this.eventService.publish("ON_CONFERENCE_LOCKED_EVENT",r,n),t||this.eventService.publish("ON_CONVERSATIONS_UPDATED_EVENT")}updateTalkers(e,t){e.updateTalkers(t),this.eventService.publish("ON_CONFERENCE_TALKER_EVENT",e)}async getServerConferenceStats(e){try{const t=`${config.restServerUrl}/api/rainbow/conference/v1.0/conferences/${e}/talkingtime`,i=this.authService.getRequestHeader(),n=await fetch(t,{method:"GET",headers:i});if(!n.ok)throw n;const s=await n.json();if(0===s.data.participants.length)return null;const o=new r.ConferenceStats;if(await this.utilitiesService.asyncForEach(s.data.participants,(async e=>{if(e.talkingTime>0){const t=new r.ConferenceStatsParticipant(e.userId);t.contact=await this.contactService.getContactByDBId(e.userId),t.talkDuration=1e3*e.talkingTime,o.participants.push(t),o.talkDuration+=t.talkDuration}})),o.participants=o.participants.sort(((e,t)=>t.talkDuration-e.talkDuration)),o.participants.length>0){const e=o.participants[0].talkDuration;o.participants.forEach((t=>{t.talkDisplay=Math.trunc(100*t.talkDuration/e)}))}return o}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getServerConferenceStats");throw this.logger.error("[ConferenceService] "+e.message),e.error}}createOrUpdateParticipants(e,t){e.updateParticipants(t).then((t=>{if(e.participants.find((e=>e.jid_im===this.contactService.userContact.id&&"disconnected"!==e.state))&&e.type===this.MEDIATYPE.WEBRTC){const t=e.hasLocalSharing?"sharing":"audio";this.contactService.setBusyState("dnd",t)}this.eventService.publish("ON_CONFERENCE_PARTICIPANT_EVENT",e),"webrtc"===e.type&&t&&this.eventService.publish("ON_WEB_CONFENRECE_PARTICIPANT_JOINED_EVENT",e,t)}))}removeParticipants(e,t){if(e.removeParticipants(t),!e.participants.find((e=>e.jid_im===this.contactService.userContact.id)))switch(this.eventService.publish("CHECK_AND_RESET_BUSY_STATE"),e.type){case this.MEDIATYPE.WEBRTC:if(this.webConferenceService.removeAllJingleSessionsForConferenceSession(e.id),e.active){const t=this.roomService.findRoomsWithConfId(e.id);if(t.length&&!this.webConferenceService.isMyConference(e.id)){const e=_escape(t[0].name),i=this.i18nService.translate("meetingDisconnect",{meeting:e});this.eventService.publish("GLOBAL_NOTIFY_MESSAGE_EVENT",i)}}e.cleanupSessionData(),this.eventService.publish("ON_CONFERENCE_UPDATED_EVENT",e);break;case this.MEDIATYPE.WEBRTCSHARINGONLY:this.webConferenceService.removeAllJingleSessionsForConferenceSession(e.id),e.cleanupSessionData()}this.eventService.publish("ON_CONFERENCE_PARTICIPANT_EVENT",e)}addPublisher(e,t,i,r,n=false){let s=true;for(let a=0;a<e.publishers.length;a++){const r=e.publishers[a];if(r.participantId===t&&r.mediaType===i){s=false;break}}const o={participantId:t,mediaType:i,jid_im:r,simulcast:n};if(s&&e.publishers.push(o),s&&"video"===i){const i=this.webConferenceService.getFreeVideoGalleryElement(e.id);let r=false;this.webConferenceService.isActiveSpeakerEnabled()&&i&&"videoGallery_0"===i.id&&(r=true),i&&!this.webConferenceService.isAlreadySubscribedToPublisher(e.id,o.participantId)&&(this.logger.info("[ConferenceService] will subscribe in confId("+e.id+") to publisher with id "+t+" and element id "+i.id+" in few moments"),i.state="busy",i.publisherId=o.participantId,this.$interval(((e,t,i,r)=>{if("busy"===i.state&&i.publisherId===t.participantId){this.logger.info("[ConferenceService] subscribe in confId("+e.id+") to publisher with id "+t.participantId+"and element id "+i.id);let n=null;t.simulcast&&(r?(n="2",i.publisherId=""):n="0"),r?this.webConferenceService.subscribeToDynamicFeed(e.id,t,i.id,n,r).catch((()=>{this.logger.error("[ConferenceService] subscribe to publisher failed, reset the video gallery element with id "+i.id),this.webConferenceService.reInitialiseVideoGalleryElementById(e,i.id)})):this.webConferenceService.subscribeToPublisher(e.id,t,i.id,n,r).catch((()=>{this.logger.error("[ConferenceService] subscribe to publisher failed, reset the video gallery element with id "+i.id),this.webConferenceService.reInitialiseVideoGalleryElementById(e,i.id)}))}}),1500,1,true,e,o,i,r))}}stopConference(e="",t=this.MEDIATYPE.WEBRTC,i=""){if(this.logger.info("[ConferenceService] stopConference( confId="+e+", type="+t+")"),!e||!i&&t!==this.MEDIATYPE.PSTNAUDIO)return this.logger.warn("[ConferenceService] stopConference missing conf ID or roomID"),this.$q.reject();const r=this.webConferenceService.conferenceSessions[e];return r&&r.isActive()?this.$q(((r,n)=>{this.$http({method:"PUT",url:this.confPortalURL+e+"/stop",headers:this.authService.getPostHeader(),data:{mediaType:t,roomId:i}}).then((()=>{this.eventService.publish("CHECK_AND_RESET_BUSY_STATE");const t=this.webConferenceService.conferenceSessions[e];t&&(this.updateState(t,false,false,false),t.cleanupSessionData(),this.eventService.publish("ON_CONFERENCE_STATE_EVENT",t)),this.logger.info("[ConferenceService] stopConference( confId="+e+") successfully"),r()}),(t=>{const i=t.data?t.data.errorDetails:t.data,r="stopConference( confId="+e+") failure: "+i;if(this.logger.error("[ConferenceService] "+r),404e3!==t.data.errorDetailsCode)this.mainService.showGlobalPopupMessage({popupTitle:"warning",popupBody:"stopMeetingFailure",okLabel:"ok"});else{const t=this.webConferenceService.conferenceSessions[e];t&&(t.active=false,t.participants=[],this.removeConferenceSession(t),this.eventService.publish("ON_CONFERENCE_STATE_EVENT",t))}n(new Error(r))}))})):(this.logger.warn("[ConferenceService] stopConference - no active conference session to stop"),this.$q.reject())}removeConferenceSession(e=null){e&&(e.type===this.MEDIATYPE.WEBRTC||e.type===this.MEDIATYPE.WEBRTCSHARINGONLY?(this.webConferenceService.leaveWebConference(e.id),this.webConferenceService.removeConferenceSession(e.id)):this.pgiConferenceService.removeConferenceSession(e.id))}disconnectsParticipant(e,t,i=this.MEDIATYPE.PSTNAUDIO){return e&&t?this.$q(((r,n)=>{this.logger.info("[ConferenceService] disconnectsParticipant( confId="+e+"participantId="+t+")"),this.$http({method:"DELETE",url:this.confPortalURL+e+"/participants/"+t+"?mediaType="+i,headers:this.authService.getRequestHeader()}).then((()=>{this.logger.info("[ConferenceService] disconnectsParticipant( confId="+e+"participantId="+t+") successfully"),r()}),(i=>{const r=i.data?i.data.errorDetails:i.data,s="disconnectsParticipant( confId="+e+"participantId="+t+") failure: "+r;this.logger.error("[ConferenceService] "+s),n(new Error(s))}))})):(this.logger.warn("[ConferenceService] disconnectsParticipant missing conf ID or participantId"),this.$q.reject())}updateConference(e,t,i=this.MEDIATYPE.PSTNAUDIO){return i===this.MEDIATYPE.PSTNAUDIO?this.pgiConferenceService.updateConference(e,t):this.webConferenceService.updateConference(e,t)}updateConferenceState(e,t,i=this.MEDIATYPE.PSTNAUDIO){return this.logger.info("[ConferenceService] updateConferenceState( confId="+e+", option="+t+" mediaType="+i+")"),e&&t?this.$q(((r,n)=>{let s=null;if(s=i===this.MEDIATYPE.PSTNAUDIO?this.pgiConferenceService.getConferenceSessionById(e):this.webConferenceService.conferenceSessions[e],!s)return this.logger.error("[ConferenceService] updateConferenceState - no corresponding conference session to update"),void n();this.$http({method:"PUT",url:this.confPortalURL+e+"/update",headers:this.authService.getRequestHeader(),data:{option:t,mediaType:s.type}}).then((t=>{const i=t.data.data;this.logger.info("[ConferenceService] updateConferenceState( confId="+e+") successfully"),r(i)}),(t=>{const i=t.data?t.data.errorDetails:t.data,r="updatsConferenceState( confId="+e+") failure: "+i;this.logger.error("[ConferenceService] "+r),n(new Error(r))}))})):(this.logger.error("[ConferenceService] updateConferenceState - missing a parameter"),this.$q.reject())}updateParticipantState(e,t,i,r=this.MEDIATYPE.PSTNAUDIO,n=null,s=null,o=null,a=null){return this.logger.info("[ConferenceService] updateParticipantState( confId="+e+"participantId="+t+" option="+i+" mediaType="+r+")"),e&&t&&i?this.$q(((c,l)=>{let d=null;if(d=r===this.MEDIATYPE.PSTNAUDIO?this.pgiConferenceService.getConferenceSessionById(e):this.webConferenceService.conferenceSessions[e],!d)return this.logger.error("[ConferenceService] updateParticipantState - no corresponding conference session to update"),void l();const u={option:i,mediaType:d.type};n&&(u.media=n),s&&(u.bitRate=s),a&&(u.publisherId=a),o&&(u.subStreamLevel=o),this.$http({method:"PUT",url:this.confPortalURL+e+"/participants/"+t,headers:this.authService.getRequestHeader(),data:u}).then((i=>{const r=i.data;this.logger.info("[ConferenceService] updateParticipantState( confId="+e+"participantId="+t+") successfully"),c(r)}),(i=>{const r=i.data?i.data.errorDetails:i.data,n="updateParticipantState( confId="+e+"participantId="+t+") failure: "+r;this.logger.error("[ConferenceService] "+n),l(new Error(n))}))})):(this.logger.error("[ConferenceService] updateParticipantState - missing a parameter"),this.$q.reject())}async addPSTNParticipantToConference(e=null,t=null){this.logger.debug("[ConferenceService] addPSTNParticipantToConference - confId: "+e+" - phoneNumber: "+t);try{const i=`${this.confPortalURL}${e}/add`,r=this.authService.getPostHeader(),n=JSON.stringify({participantPhoneNumber:t}),s=await fetch(i,{method:"POST",headers:r,body:n});if(!s.ok)throw s;return void this.logger.info("[ConferenceService] addPSTNParticipantToConference success")}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"addPSTNParticipantToConference");throw this.logger.error("[ConferenceService] "+e.message),e.error}}isUserContactInCall(){for(const e in this.webConferenceService.conferenceSessions)if(this.webConferenceService.conferenceSessions.hasOwnProperty(e)){if(this.webConferenceService.conferenceSessions[e].isParticipantConnectedByJid(this.contactService.userContact.jid))return true}return false}refreshConferenceSessions(){const e=[];return e.push(this.webConferenceService.refreshConferenceSessions()),this.$q.all(e)}computeJoinStartForSFUConference(e,t=null){const i={showStartButton:false,showJoinButton:false,isActionDisabled:false,startOrJoinTooltip:""},r=e.room.getUserByJid(this.contactService.userContact.jid);if(r&&"unsubscribed"===r.status)return this.rxUpdateSubject.next(new s.RBEvent("CONFERENCE_BUTTON_STATUS",i)),i;if(!e.room.isMeetingRoom()&&!this.contactService.userContact.webrtcAudioEnabled)return i.showStartButton=false,i.showJoinButton=false,i;const n=t||this.webConferenceService.getConferenceSessionForRoom(e.room.confEndpoints);if(n&&n.status&&"ended"!==n.status)i.showStartButton=false,i.showJoinButton=false;else if(n&&n.isActive()&&!n.haveJoined)i.showStartButton=false,i.showJoinButton=true;else if(e.room.isUserModerator(this.contactService.userContact)){if(i.showStartButton=true,!this.hasConferenceRights)return i.isActionDisabled=true,i.startOrJoinTooltip="startConferenceNoRights",this.rxUpdateSubject.next(new s.RBEvent("CONFERENCE_BUTTON_STATUS",i)),i;const t=e.room.users.filter((e=>e.contact&&e.contact.initialized&&!e.contact.isAnonymousGuest()&&!e.contact.isBadGuest()&&!e.contact.isTerminated&&("invited"===e.status||"accepted"===e.status)));let r=0;return e.room.guestEmails&&(r=e.room.guestEmails.length),e.room.guestPhoneNumbers&&(r+=e.room.guestPhoneNumbers.length),t.length+r>this.maxNumberOfUsersSFU?(i.isActionDisabled=true,i.startOrJoinTooltip=this.i18nService.translate("disabledStartConference",{number:this.maxNumberOfUsersSFU}),this.rxUpdateSubject.next(new s.RBEvent("CONFERENCE_BUTTON_STATUS",i)),i):(i.isActionDisabled=false,i.startOrJoinTooltip="startConference",this.rxUpdateSubject.next(new s.RBEvent("CONFERENCE_BUTTON_STATUS",i)),i)}return this.rxUpdateSubject.next(new s.RBEvent("CONFERENCE_BUTTON_STATUS",i)),i}}b.$inject=["$q","$interval","$http","webConferenceService"],t.ConferenceService=b},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(160),n=i(27),s=i(17),o=i(19),a=i(8),c=i(11),l=i(9),d=i(6),u=i(37),h=i(315),f=i(14),p=i(30),g=i(43),m=i(317),v=i(96),S=i(318),b=i(119),y=i(320),C=i(34),w=i(322),_=i(57),E=i(62),T=i(467),I=i(323),P=i(56),A=i(149),M=i(47),D=i(327),R=i(153),O=i(70),N=i(148),x=i(118),L=i(39),k=i(38),F=i(328),U=i(481),j=i(4),W=i(121),B=new WeakMap,H=new WeakMap,V=new WeakMap,Y=new WeakMap,G=new WeakMap;class ${constructor(e,t,i,r,L,k){this.eventService=c.EventService.getInstance(),this.settingsService=o.SettingsService.getInstance(),this.mainService=s.MainService.getInstance(),this.authService=a.AuthService.getInstance(),this.xmppService=l.XmppService.getInstance(),this.contactService=d.ContactService.getInstance(),this.fileStorageService=u.FileStorageService.getInstance(),this.invitationService=h.InvitationService.getInstance(),this.profileService=f.ProfileService.getInstance(),this.roomService=p.RoomService.getInstance(),this.webrtcConfigAndUtils=g.WebrtcConfigAndUtils.getInstance(),this.telephonyKeysService=m.TelephonyKeysService.getInstance(),this.webConferenceV2Service=v.WebConferenceServiceV2.getInstance(),this.groupService=S.GroupService.getInstance(),this.botService=b.BotService.getInstance(),this.channelService=y.ChannelService.getInstance(),this.webrtcP2PService=C.WebrtcP2PService.getInstance(),this.calendarService=w.CalendarService.getInstance(),this.telephonyService=_.TelephonyService.getInstance(),this.conversationService=E.ConversationService.getInstance(),this.presenceHelperService=T.PresenceHelperService.getInstance(),this.webrtcP2PRecordingService=I.WebrtcP2PRecordingService.getInstance(),this.deviceManagementService=P.DeviceManagementService.getInstance(),this.directoryService=A.DirectoryService.getInstance(),this.fileServerService=M.FileServerService.getInstance(),this.callLogService=D.CallLogService.getInstance(),this.webrtcGlobalEventHandlerService=R.WebrtcGlobalEventHandlerService.getInstance(),this.webrtcGatewayService=O.WebrtcGatewayService.getInstance(),this.telephonyAbstractService=F.TelephonyAbstractService.getInstance(),this.favoriteService=N.FavoriteService.getInstance(),this.voiceMessageService=x.VoiceMessageService.getInstance(),this.rainbowLogger=j.LoggerService.getInstance(),this.ccdAgentService=W.CCDAgentService.getInstance(),this.logService="ConnectionService | ",this.state="disconnected",this.connecting=false,this.RAINBOW_ONCONNECTIONSTATECHANGED="rainbowconnectionstatechanged",this.RAINBOW_ONSTARTED="started",this.RAINBOW_ONSIGNED="signed",this.RAINBOW_ONSTOPPED="stopped",this.RAINBOW_CONNECTIONINPROGRESS="inProgress",this.RAINBOW_ONUSERTOKENRENEW="userTokenRenew",this.RAINBOW_ONUSERTOKENRENEWFAILED="userTokenRenewFailed",this.RAINBOW_ONUSERTOKENWILLEXPIRE="userTokenWillExpire",this.RAINBOW_ONAPPTOKENRENEW="applicationTokenRenew",this.RAINBOW_ONAPPTOKENRENEWFAILED="applicationTokenRenewFailed",this.RAINBOW_CONNECTIONCONNECTED="connected",this.RAINBOW_CONNECTIONDISCONNECTED="disconnected",this.eventService.configure(e),this.settingsService.configure("en"),this.settingsService.setSetting("apiMode","sdk"),B.set(this,t),H.set(this,i),V.set(this,r),Y.set(this,L),G.set(this,k),this.xmppService.subscribeToConnectionEvents((e=>{let t="connected";"ON_XMPP_CONNECTING"===e.name&&(t="inProgress"),"ON_XMPP_DISCONNECTED"===e.name&&(t="LOGOUT"===e.data.reason?"unlogged":"disconnected","RESOURCE_CONSTRAINTS"===e.data.reason&&(t="unlogged",this.signout())),"ON_XMPP_CONNECTED"===e.name&&(t="connected","RECONNECTION"===e.data.reason&&(n.eventsService.dispatchEvent(this.RAINBOW_ONCONNECTIONSTATECHANGED,"reconnecting"),this.reconnectServices())),this.state=t,this.rainbowLogger.sdk(this.logService+"[onChange] :: Connection state changed to "+t),n.eventsService.dispatchEvent(this.RAINBOW_ONCONNECTIONSTATECHANGED,t)})),this.authService.subscribe((e=>{try{switch(e.name){case"ON_AUTH_TOKEN_RENEW":n.eventsService.dispatchEvent(this.RAINBOW_ONUSERTOKENRENEW);break;case"ON_AUTH_TOKEN_EXPIRE":this.signout().then((()=>{n.eventsService.dispatchEvent(this.RAINBOW_ONUSERTOKENRENEWFAILED)}));break;case"ON_AUTH_TOKEN_WILL_EXPIRE":n.eventsService.dispatchEvent(this.RAINBOW_ONUSERTOKENWILLEXPIRE);break;case"ON_APP_TOKEN_RENEW":n.eventsService.dispatchEvent(this.RAINBOW_ONAPPTOKENRENEW);break;case"ON_APP_TOKEN_EXPIRE":n.eventsService.dispatchEvent(this.RAINBOW_ONAPPTOKENRENEWFAILED)}}catch(t){this.rainbowLogger.error(this.logService+" failure "+t.message)}})),window.addEventListener("unload",(()=>{this.webrtcP2PService.stop(),this.contactService.stop(),this.conversationService.stop(),this.groupService.stop(),this.telephonyService.stop(),this.telephonyKeysService.stop(),this.ccdAgentService.stop(),this.webConferenceV2Service.stop(),this.fileServerService.stop(),this.fileStorageService.stop(),this.xmppService.stop(),this.profileService.stop(),this.webrtcP2PRecordingService.stop(),this.channelService.stop(),this.webrtcGatewayService.stop(),this.calendarService.stop(),this.presenceHelperService.stop(),this.deviceManagementService.stop(),this.callLogService.stop()}))}static get $inject(){return["$rootScope","configService","conferenceService","webConferenceService","adminCompanyService","adminUserService"]}signin(e,t){return $.hostUsed=$.RAINBOW_SANDBOX_HOST,this.signinToRainbow(e,t,null)}signinOnRainbowOfficial(e,t){return $.hostUsed=$.RAINBOW_OFFICIAL_HOST,window.config.webservices.currentServer=$.RAINBOW_OFFICIAL_HOST,this.signinToRainbow(e,t,null)}signinOnRainbowBeta(e,t){return $.hostUsed=$.RAINBOW_BETA_HOST,this.signinToRainbow(e,t,null)}signinOnRainbowCPaasPreProd(e,t){return $.hostUsed=$.RAINBOW_CPAASPREPROD_HOST,this.signinToRainbow(e,t,null)}signinOnRainbowDev(e,t){return $.hostUsed=$.RAINBOW_DEV_HOST,this.signinToRainbow(e,t,null)}signinOnRainbowSandboxChina(e,t){return $.hostUsed=$.RAINBOW_CHINASANDBOX_HOST,this.signinToRainbow(e,t,null)}signinOnRainbowChina(e,t){return $.hostUsed=$.RAINBOW_CHINA_HOST,this.signinToRainbow(e,t,null)}signinOnRainbowHosted(e,t,i){return $.hostUsed=i,this.signinToRainbow(e,t,null)}async signinSandBoxWithToken(e){$.hostUsed=$.RAINBOW_SANDBOX_HOST;return await this.signinToRainbow(null,null,e)}async signinOnRainbowOfficialWithToken(e){$.hostUsed=$.RAINBOW_OFFICIAL_HOST,window.config.webservices.currentServer=$.RAINBOW_OFFICIAL_HOST;return await this.signinToRainbow(null,null,e)}signinOnRainbowBetaWithToken(e){return $.hostUsed=$.RAINBOW_BETA_HOST,this.signinToRainbow(null,null,e)}signinOnRainbowDevWithToken(e){return $.hostUsed=$.RAINBOW_DEV_HOST,this.signinToRainbow(null,null,e)}signinOnRainbowHostedWithToken(e,t){return $.hostUsed=t,this.signinToRainbow(null,null,e)}signinWithToken(e){return this.signinToRainbow(null,null,e)}setRenewedToken(e){e||this.rainbowLogger.error(this.logService+"[setRenewedToken] Argument 'strToken' is missing or empty"),this.authService.sdkSetRenewedToken(e)}signinOnRainbowWithOICD(e){let t="";const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=i.length;for(let s=0;s<30;s++)t+=i.charAt(Math.floor(Math.random()*r));const n=`https://openrainbow.com/api/rainbow/authentication/v1.0/oidc-client/jwt?id_token=${e}&challenge=${t}`;return new Promise(((i,r)=>{if(!e)return this.rainbowLogger.sdk(this.logService+"[signinOnRainbowWithOICD] :: Argument strToken is null or undefined"),r("Argument strToken is null or undefined");let s=window.btoa(unescape(encodeURIComponent(window.sdk.key.appID+":"+window.SHA256(window.sdk.key.appSecret+t))));s="Basic "+s;const o=new Headers({"Content-Type":"application/x-www-form-urlencoded","X-Rainbow-App-Auth":s,Accept:"application/json"});fetch(n,{method:"get",mode:"cors",headers:o}).then((e=>{e.json().then((e=>{this.signinOnRainbowBetaWithToken(e.token).then((e=>i(e))).catch((e=>r(e)))}))})).catch((e=>r(e)))}))}styleSignInWithRainbowButton(e,t){const i=document.querySelector(".SignInWithRainbow");if(!i)return this.rainbowLogger.sdk(this.logService+"[styleSignInWithRainbowButton] :: Could not find a corresponding HTML element"),false;let r,n,s,o,a,c;return t||(t="medium"),e||(e="blue"),"blue"===e?(a="#1b85e0",c="#FFFFFF"):"white"===e&&(a="#FFFFFF",c="#1b85e0"),"small"===t?(r="200px",n="20px",s="18px",o="12px"):"medium"===t?(r="250px",n="30px",s="26px",o="16px"):"large"===t&&(r="350px",n="40px",s="34px",o="22px"),i.style.backgroundColor=a,i.style.color=c,i.style.width=r,i.style.height=n,i.style.fontSize=o,i.style.border="0px",i.style.borderRadius="5px",i.innerHTML="Sign in with Rainbow",i.style.backgroundImage="url('https://developers.openrainbow.com/android-chrome-48x48.png')",i.style.backgroundPosition="left",i.style.backgroundRepeat="no-repeat",i.style.verticalAlign="middle",i.style.backgroundSize=s,i.style.backgroundOrigin="content-box",i.style.paddingLeft="13px",this.rainbowLogger.sdk(this.logService+"[styleSignInWithRainbowButton] :: Styled a corresponding HTML element"),true}async signout(){try{const e={code:k.SDK.OK,label:"OK"};return this.rainbowLogger.sdk(this.logService+"[signout] :: Trying to sign out"),await this.stopServices(),this.rainbowLogger.sdk(this.logService+"[signout] :: Services Successfully unloaded!"),this.authService.loggedInUser=null,n.eventsService.dispatchEvent(this.RAINBOW_ONSTOPPED,null),n.eventsService.dispatchEvent(this.RAINBOW_ONCONNECTIONSTATECHANGED,this.state),e}catch(e){throw this.rainbowLogger.sdk(this.logService+"[signout] :: An error occurred during signout -- "+e),e}}async stopServices(){const e=H.get(this),t=V.get(this);try{this.webrtcP2PService.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: webrtcP2P service stopped"),this.favoriteService.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: Favorite service stopped"),this.voiceMessageService.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: VoiceMessage service stopped"),this.webrtcGlobalEventHandlerService.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: webrtcGlobalEventHandler service stopped"),this.telephonyService.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: Telephony service stopped"),this.contactService.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: Contact service stopped"),this.botService.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: Bot service stopped"),this.profileService.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: Profile service stopped"),this.conversationService.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: Conversation service stopped"),e.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: Conference service stopped"),this.webConferenceV2Service.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: Web ConferenceV2 service stopped"),t.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: Web Conference service stopped"),this.channelService.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: ChannelService service stopped"),this.fileServerService.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: FileServer service stopped"),this.fileStorageService.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: FileStorage service stopped"),this.invitationService.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: Invitation service stopped"),this.groupService.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: Group service stopped"),this.roomService.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: Room service stopped"),this.deviceManagementService.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: DeviceManagement Service stopped"),this.webrtcGatewayService.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: webrtcGateway service stopped"),this.webrtcP2PRecordingService.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: webrtcP2PRecording Service stopped"),this.calendarService.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: Calendar service stopped"),this.presenceHelperService.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: PresenceHelper Service stopped"),this.callLogService.stop(),this.rainbowLogger.sdk(this.logService+"[signout] :: CallLog service Service stopped"),this.xmppService.connected?await this.xmppService.stop():(this.state="unlogged",this.xmppService.resetAllObjects(),this.rainbowLogger.sdk(this.logService+"[signout] :: xmppService already stopped, update pnly state"))}catch(i){throw this.rainbowLogger.sdk(this.logService+"[stopServices] :: An error occurred during signout -- "+i),new Error(i)}}updateUserPassword(e,t){return this.contactService.updateUserPassword(e,t,false)}getState(){return this.state}getToken(){return this.authService.token}async refreshToken(){await this.authService.renewAuthToken(false)}signinToRainbow(e,t,i){const s=H.get(this),o=V.get(this),a=Y.get(this),c=G.get(this);if(this.rainbowLogger.sdk("Auth"),this.connecting)throw new U.default("Connection already in progress",k.SDK.ERRORBADREQUEST);if(this.authService.loggedInUser)throw new U.default("User already connected. Sign out before signing in again.",k.SDK.ERRORBADREQUEST);this.connecting=true;let l=false;return new Promise(((d,u)=>{if(i)l=true,e=null,t=null;else{if(!e)return this.connecting=false,u({code:k.SDK.ERRORBADREQUEST,label:"Parameter 'login' is missing or empty"});if(!t)return this.connecting=false,u({code:k.SDK.ERRORBADREQUEST,label:"Parameter 'password' is missing or empty"})}this.mainService.configure(null,L.sdkConfig),this.rainbowLogger.sdk(this.logService+"[signin] :: Rainbow host used "+$.hostUsed),l?this.rainbowLogger.sdk(this.logService+"[signin] :: Trying to sign-in with given token"):this.rainbowLogger.sdk(this.logService+"[signin] :: Trying to sign-in");const h={code:k.SDK.OK,label:"",account:null},f={appID:window.sdk.key.appID,appSecret:window.sdk.key.appSecret};if(this.authService.removeCredentials(),this.rainbowLogger.sdk("RainbowSDK Performance - sdkLogOn"),i&&!$.hostUsed){let e=r.default(i).environment.environmentApiUrl;if(e&&"https://"===e.substring(0,8))e=e.substring(8),$.hostUsed=e;else if(!e&&"https://"!==e.substring(0,8))throw this.connecting=false,new Error("Could not get a Rainbow Environment from the token. Please use one of the existing methods to connect to a specific Rainbow environment.")}this.authService.sdkLogOn(e,t,$.hostUsed,f,i).then((()=>{this.rainbowLogger.sdk("RainbowSDK Performance - sdkLogOn"),h.account={},h.label="ok",h.account.userId=this.authService.userId,h.account.companyId=this.authService.companyId,h.account.loginEmail=this.authService.login,h.account.roles=this.authService.loggedInUser.roles,h.token=this.authService.token,h.userData=this.authService.loggedInUser,this.rainbowLogger.sdk(this.logService+"[signin] :: Successfully sign-in with  | "+this.authService.jidIm),n.eventsService.dispatchEvent(this.RAINBOW_ONSIGNED,h),this.authService.startTokenSurvey(),this.rainbowLogger.sdk(this.logService+"[signin] :: Start services..."),this.rainbowLogger.sdk("RainbowSDK Performance - XMPPService"),this.xmppService.start().then((()=>(this.rainbowLogger.sdk("RainbowSDK Performance - companyService"),this.rainbowLogger.sdk(this.logService+"[signin] :: Company service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - adminCompanyService"),a.start()))).then((()=>(this.rainbowLogger.sdk("RainbowSDK Performance - adminCompanyService"),this.rainbowLogger.sdk(this.logService+"[signin] :: Admin company service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - adminUserService"),c.start()))).then((()=>(this.rainbowLogger.sdk("RainbowSDK Performance - adminUserService"),this.rainbowLogger.sdk(this.logService+"[signin] :: Admin user service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - contactService"),this.contactService.start()))).then((()=>{if(this.rainbowLogger.sdk("RainbowSDK Performance - contactService"),this.rainbowLogger.sdk(this.logService+"[signin] :: Contact service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - profileService"),L.sdkConfig.features.profileService)return this.profileService.start()})).then((()=>(this.rainbowLogger.sdk("RainbowSDK Performance - profileService"),this.rainbowLogger.sdk(this.logService+"[signin] :: Profile service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - invitationService"),this.invitationService.start()))).then((()=>(this.rainbowLogger.sdk("RainbowSDK Performance - invitationService"),this.rainbowLogger.sdk(this.logService+"[signin] :: Invitation service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - fileServerService"),this.fileServerService.start()))).then((()=>(this.rainbowLogger.sdk("RainbowSDK Performance - fileServerService"),this.rainbowLogger.sdk(this.logService+"[signin] :: FileServer service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - fileStorageService"),this.fileStorageService.start()))).then((()=>{if(this.rainbowLogger.sdk("RainbowSDK Performance - fileStorageService"),this.rainbowLogger.sdk(this.logService+"[signin] :: FileStorage service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - roomService"),L.sdkConfig.features.roomService)return this.roomService.start()})).then((()=>(this.rainbowLogger.sdk("RainbowSDK Performance - roomService"),this.rainbowLogger.sdk(this.logService+"[signin] :: Room service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - groupService"),this.groupService.start()))).then((()=>{if(this.rainbowLogger.sdk("RainbowSDK Performance - groupService"),this.rainbowLogger.sdk(this.logService+"[signin] :: Group service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - favoriteService"),L.sdkConfig.features.favoriteService)return this.favoriteService.start()})).then((()=>(this.rainbowLogger.sdk("RainbowSDK Performance - favoriteService"),this.rainbowLogger.sdk(this.logService+"[signin] :: Favorite service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - voiceMessageService"),this.voiceMessageService.start()))).then((()=>(this.rainbowLogger.sdk("RainbowSDK Performance - voiceMessageService"),this.rainbowLogger.sdk(this.logService+"[signin] :: Voice Message service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - webrtcP2PService"),this.webrtcP2PService.start()))).then((()=>(this.rainbowLogger.sdk("RainbowSDK Performance - webrtcP2PService"),this.rainbowLogger.sdk(this.logService+"[signin] :: Video service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - webrtcGlobalEventHandlerService"),this.webrtcGlobalEventHandlerService.start()))).then((()=>{if(this.rainbowLogger.sdk("RainbowSDK Performance - webrtcGlobalEventHandlerService"),this.rainbowLogger.sdk(this.logService+"[signin] :: WebRTCEventHandler service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - telephonyService"),L.sdkConfig.features.telephony)return this.telephonyService.start()})).then((()=>(this.rainbowLogger.sdk("RainbowSDK Performance - telephonyService"),this.rainbowLogger.sdk(this.logService+"[signin] :: telephonyService service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - presenceHelperService"),this.presenceHelperService.start()))).then((()=>(this.rainbowLogger.sdk("RainbowSDK Performance - presenceHelperService"),this.rainbowLogger.sdk(this.logService+"[signin] :: PresenceHelper service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - directoryService"),this.directoryService.start()))).then((()=>(this.rainbowLogger.sdk("RainbowSDK Performance - directoryService"),this.rainbowLogger.sdk(this.logService+"[signin] :: Directory service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - webrtcGatewayService"),this.webrtcGatewayService.start()))).then((()=>(this.rainbowLogger.sdk("RainbowSDK Performance - webrtcGatewayService"),this.rainbowLogger.sdk(this.logService+"[signin] :: WebrtcGateway service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - telephonyAbstractService"),this.telephonyAbstractService.start()))).then((()=>{if(this.rainbowLogger.sdk("RainbowSDK Performance - telephonyAbstractService"),this.rainbowLogger.sdk(this.logService+"[signin] :: TelephonyAbstract service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - telephonyKeysService"),L.sdkConfig.features.telephony)return this.telephonyKeysService.start()})).then((()=>{if(this.rainbowLogger.sdk("RainbowSDK Performance - telephonyAbstractService"),this.rainbowLogger.sdk(this.logService+"[signin] :: TelephonyAbstract service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - ccdAgentService"),L.sdkConfig.features.telephony)return this.ccdAgentService.start()})).then((()=>(this.rainbowLogger.sdk("RainbowSDK Performance - ccdAgentService"),this.rainbowLogger.sdk(this.logService+"[signin] :: ccdAgentService service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - webConferenceService"),o.start()))).then((()=>{if(this.rainbowLogger.sdk("RainbowSDK Performance - webConferenceService"),this.rainbowLogger.sdk(this.logService+"[signin] :: Web Conference service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - calendarService"),L.sdkConfig.features.calendarService)return this.calendarService.start(this.conversationService)})).then((()=>{if(this.rainbowLogger.sdk("RainbowSDK Performance - calendarService"),this.rainbowLogger.sdk(this.logService+"[signin] :: calendarService service ready!"),this.webConferenceV2Service.start(),o.setActiveSpeakerValue(false),this.rainbowLogger.sdk("RainbowSDK Performance - conversationService"),L.sdkConfig.features.conversationService)return this.conversationService.start(o)})).then((()=>{this.rainbowLogger.sdk("RainbowSDK Performance - conversationService"),this.rainbowLogger.sdk(this.logService+"[signin] :: Conversation service ready!"),this.rainbowLogger.sdk(this.logService+"[signin] :: Send initial presence"),this.rainbowLogger.sdk("RainbowSDK Performance - sendPresenceFromConfiguration"),this.contactService.sendPresenceFromConfiguration()})).then((()=>{this.rainbowLogger.sdk("RainbowSDK Performance - sendPresenceFromConfiguration"),this.rainbowLogger.sdk(this.logService+"[signin] :: Initial presence sent !")})).then((()=>(this.rainbowLogger.sdk("RainbowSDK Performance - deviceManagementService"),this.deviceManagementService.start()))).then((()=>{if(this.rainbowLogger.sdk("RainbowSDK Performance - deviceManagementService"),this.rainbowLogger.sdk(this.logService+"[signin] :: deviceManagement service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - botService"),L.sdkConfig.features.bots)return this.botService.start()})).then((()=>{if(this.rainbowLogger.sdk("RainbowSDK Performance - botService"),this.rainbowLogger.sdk(this.logService+"[signin] :: Bot service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - conferenceService"),L.sdkConfig.features.conference)return s.start()})).then((()=>(this.rainbowLogger.sdk("RainbowSDK Performance - conferenceService"),this.rainbowLogger.sdk(this.logService+"[signin] :: Conference service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - webrtcP2PRecordingService"),this.webrtcP2PRecordingService.start()))).then((()=>{if(this.rainbowLogger.sdk("RainbowSDK Performance - webrtcP2PRecordingService"),this.rainbowLogger.sdk(this.logService+"[signin] :: webrtc P2P Recording service ready!"),this.rainbowLogger.sdk("RainbowSDK Performance - channelService"),L.sdkConfig.features.channels)return this.channelService.start()})).then((()=>(this.rainbowLogger.sdk("RainbowSDK Performance - Channel service"),this.rainbowLogger.sdk(this.logService+"[signin] :: Channel service ready!"),this.rainbowLogger.sdk(this.logService+"[signin] :: Services Successfully loaded!"),n.eventsService.dispatchEvent(this.RAINBOW_ONSTARTED,h),this.rainbowLogger.sdk("Auth"),this.connecting=false,d(h)))).then((()=>(this.rainbowLogger.sdk("RainbowSDK Performance - callLogService"),this.callLogService.start()))).catch((()=>(this.rainbowLogger.sdk(this.logService+"[signin] :: Error during signin"),h.code=k.SDK.ERRORXMPP,h.label="errorXMPP",h.account=null,this.connecting=false,u(h))))})).catch((()=>(this.rainbowLogger.sdk(this.logService+"[signin] :: Error during signin"),h.code=k.SDK.ERRORUNAUTHORIZED,h.label="errorUnauthorized",this.connecting=false,u(h))))}))}async reconnectServices(){const e=H.get(this),t=B.get(this);try{return t.setVideoQuality(),L.sdkConfig.features.conversationService&&this.conversationService.reconnect(),L.sdkConfig.features.telephony&&(this.telephonyService.reconnect(),this.telephonyKeysService.reconnect(),this.ccdAgentService.reconnect()),L.sdkConfig.features.roomService&&this.roomService.reconnect(),this.groupService.reconnect(),this.contactService.reconnect(),this.invitationService.reconnect(),this.webrtcP2PService.reconnect(),this.webrtcGlobalEventHandlerService.reconnect(),L.sdkConfig.features.conference&&e.reconnect(),this.fileServerService.reconnect(),L.sdkConfig.features.channels&&this.channelService.reconnect(),this.profileService.reconnect(),this.voiceMessageService.reconnect(),await this.fileStorageService.reinit(false),L.sdkConfig.features.conversationService&&await this.conversationService.reinit(),L.sdkConfig.features.favoriteService&&this.favoriteService.connect(),L.sdkConfig.features.calendarService&&this.calendarService.reconnect(),void(await this.contactService.resendInitialPresenceOnReconnect())}catch(i){this.rainbowLogger.error("[launcherService] reconnectServices failure "+i.message)}}}$.hostUsed="",$.RAINBOW_OFFICIAL_HOST="openrainbow.com",$.RAINBOW_BETA_HOST="openrainbow.net",$.RAINBOW_DEV_HOST="openrainbow.org",$.RAINBOW_SANDBOX_HOST="sandbox.openrainbow.com",$.RAINBOW_CPAASPREPROD_HOST="cpaaspreprod.openrainbow.net",$.RAINBOW_CHINA_HOST="myopenrainbow.com.cn",$.RAINBOW_CHINASANDBOX_HOST="sandbox.myopenrainbow.com.cn",t.ConnectionService=$},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(6),n=i(39),s=i(43),o=i(17);class a{constructor(){this.contactService=r.ContactService.getInstance(),this.mainService=o.MainService.getInstance(),this.webrtcConfigAndUtils=s.WebrtcConfigAndUtils.getInstance()}setSimulcast(e){return this.webrtcConfigAndUtils.webrtcConfig.simulcast=e,e}setVideoQuality(e){return e||(e=n.sdkConfig.videoQuality),"low"===e?(n.sdkConfig.videoQuality="low",this.webrtcConfigAndUtils.videoQualityConfiguration={video:{fixedFrameRate:15,fixedVideoWidth:320,fixedVideoHeight:180},sharing:{fixedFrameRate:5,fixedVideoWidth:1280,fixedVideoHeight:720}}):"middle"===e?(n.sdkConfig.videoQuality="middle",this.webrtcConfigAndUtils.videoQualityConfiguration={video:{fixedFrameRate:20,fixedVideoWidth:640,fixedVideoHeight:360},sharing:{fixedFrameRate:5,fixedVideoWidth:1280,fixedVideoHeight:720}}):"high"===e&&(n.sdkConfig.videoQuality="high",this.webrtcConfigAndUtils.videoQualityConfiguration={video:{fixedFrameRate:25,fixedVideoWidth:1280,fixedVideoHeight:720},sharing:{fixedFrameRate:5,fixedVideoWidth:1920,fixedVideoHeight:1080}}),e}setVerboseLog(e){return n.sdkConfig.verboseLog=e,n.sdkConfig.verboseLog}useNewModels(e){return n.sdkConfig.newModels=e,n.sdkConfig.newModels}setDisplayOrder(e){if("FL"!==e&&"LF"!==e)throw new Error("Value should be set to either 'FL' or 'LF'");return n.sdkConfig.displayOrder=e,this.contactService.setDisplayOrder(e),n.sdkConfig.displayOrder}setCustomLogger(e){n.sdkConfig.customLogger=e}setAutoAway(e){n.sdkConfig.autoAway=e,this.mainService.configure(null,n.sdkConfig)}setAutoAwayDelay(e){if(e<0)throw new Error("Value should be higher than 0");e>0&&!n.sdkConfig.autoAway?(n.sdkConfig.autoAway=true,n.sdkConfig.autoAwayDelay=e):e&&0!==e?n.sdkConfig.autoAwayDelay=e:(n.sdkConfig.autoAway=false,n.sdkConfig.autoAwayDelay=0),this.mainService.configure(null,n.sdkConfig)}getCurrentConfig(){return n.sdkConfig}}a.logService="ConfigService | ",t.ConfigService=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(27),n=i(6),s=i(9),o=i(150),a=i(38),c=i(4),l=new WeakMap;class d{constructor(e){this.contactService=n.ContactService.getInstance(),this.xmppService=s.XmppService.getInstance(),this.rainbowLogger=c.LoggerService.getInstance(),this.RAINBOW_PRESENCE_ONLINE="online",this.RAINBOW_PRESENCE_AWAY="away",this.RAINBOW_PRESENCE_DONOTDISTURB="dnd",this.RAINBOW_PRESENCE_OFFLINE="xa",this.RAINBOW_PRESENCE_BUSY="busy",this.RAINBOW_PRESENCE_UNKNOW="unknow",this.RAINBOW_ONCONTACTPRESENCECHANGED="rainbowcontactpresencechanged",this.RAINBOW_ONPRESENCECHANGED="rainbowpresencechanged",this.RAINBOW_ONCONTACTRICHPRESENCECHANGED="rainbowcontactrichpresencechanged",this.RAINBOW_ONRICHPRESENCECHANGED="rainbowrichpresencechanged",this.RAINBOW_ONMYCONTACTPRESENCECHANGED="rainbowonmycontactpresencechanged",l.set(this,e),this.xmppService.subscribeToContactEvents((e=>{"ON_CONTACT_PRESENCE_EVENT"===e.name&&this.onPresenceChangedEvent(e.name,e.data)})),e.$on("$destroy",e.$on("ON_UPDATE_CONTACT_RICH_STATUS_EVENT",((e,t)=>this.onRichPresenceChangedEvent(e,t)))),e.$on("$destroy",e.$on("ON_UPDATE_MYCONTACT_EVENT",((e,t)=>this.onMyContactPresenceChangedEvent(e,t))))}static get $inject(){return["$rootScope"]}setPresenceTo(e){if(e!==this.RAINBOW_PRESENCE_DONOTDISTURB&&e!==this.RAINBOW_PRESENCE_AWAY&&e!==this.RAINBOW_PRESENCE_OFFLINE&&e!==this.RAINBOW_PRESENCE_ONLINE)throw new Error("Parameter 'strPresenceState' should be 'dnd', 'away', 'xa' (invisible) or 'online'");return this.rainbowLogger.sdk(d.logService+"[setPresenceTo] :: Set presence to "+e),this.contactService.changeMyPresence(e),{code:a.SDK.OK,label:"OK"}}onPresenceChangedEvent(e,t){const i=t.message||"''";t.jid===this.xmppService.fullJid?(this.rainbowLogger.sdk(d.logService+"[onPresenceChangedEvent] :: Presence changed for me ("+t.jid+") to  "+t.status+" | "+i),r.eventsService.dispatchEvent(this.RAINBOW_ONPRESENCECHANGED,t)):(this.rainbowLogger.sdk(d.logService+"[onPresenceChangedEvent] :: Presence changed for contact ("+t.jid+") to  "+t.status+" | "+i),r.eventsService.dispatchEvent(this.RAINBOW_ONCONTACTPRESENCECHANGED,t))}onRichPresenceChangedEvent(e,t){const i=t.message||"''",r=t.telStatus||"''";if(t=new o.ContactSDK(t),this.xmppService.fullJid.includes(t.jid)){this.rainbowLogger.sdk(d.logService+"[onPresenceChangedEvent] :: Rich Presence changed for myself to status "+t.status+", message "+i+" and telStatus "+r);const e=new CustomEvent(this.RAINBOW_ONRICHPRESENCECHANGED,{detail:t});document.dispatchEvent(e)}else{this.rainbowLogger.sdk(d.logService+"[onPresenceChangedEvent] :: Rich Presence changed for contact ("+t.jid+") to status "+t.status+", message "+i+" and telStatus "+r);const e=new CustomEvent(this.RAINBOW_ONCONTACTRICHPRESENCECHANGED,{detail:t});document.dispatchEvent(e)}}onMyContactPresenceChangedEvent(e,t){const i=t.message?t.message:"",n={status:t.status,message:i};this.rainbowLogger.sdk(d.logService+"[onPresenceChangedEvent] :: Presence changed for me to  status: "+n.status+" and message "+i),r.eventsService.dispatchEvent(this.RAINBOW_ONMYCONTACTPRESENCECHANGED,n)}}d.logService="PresenceService | ",t.PresenceService=d},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(8),n=i(6),s=i(14),o=i(4),a=new WeakMap,c=new WeakMap;class l{constructor(e,t){this.authService=r.AuthService.getInstance(),this.contactService=n.ContactService.getInstance(),this.profileService=s.ProfileService.getInstance(),this.rainbowLogger=o.LoggerService.getInstance(),a.set(this,e),c.set(this,t)}static get $inject(){return["$rootScope","adminUserService"]}getProfile(){return this.authService.loggedInUser}getProfileOffer(){return this.profileService.getMyProfileName()}getOptions(){const e=this.profileService.getMyProfiles(),t=[];return e.map((e=>{e.isExclusive||e.isDefault||t.find((t=>t===e.profileName))||t.push(e.profileName)})),t}async updateFirstName(e){if(!e||"string"!=typeof e||e.length<1)throw new Error("Parameter 'strFirstname' is missing, empty or null");const t={firstName:e},i=await this.profileService.setUserData(t);return this.rainbowLogger.sdk(l.logService+"[updateFirstName] :: First name updated"),i.data}async updateLastName(e){if(!e||"string"!=typeof e||e.length<1)throw new Error("Parameter 'strFirstname' is missing, empty or null");const t={lastName:e},i=await this.profileService.setUserData(t);return this.rainbowLogger.sdk(l.logService+"[updateFirstName] :: First name updated"),i.data}async updatePhoneNumber(e,t,i,r){if(!e||"string"!=typeof e||["home","work","other"].indexOf(e)<0)throw new Error("Parameter 'type' is missing or not matching one of the following types: 'home', 'work', 'other'");if(!t||"string"!=typeof t||["landline","mobile","fax","other"].indexOf(t)<0)throw new Error("Parameter 'deviceType' is missing or not matching one of the following types 'landline', 'mobile', 'fax', 'other'");if("string"!=typeof i)throw new Error("Parameter 'strPhoneNumber' must be of type 'string' ");const n={type:e,deviceType:t,number:i};r&&"string"==typeof r&&(n.country=r);const s=this.authService.loggedInUser;if(s.phoneNumbers.length){let i=-1;i=s.phoneNumbers.findIndex((i=>i.type===e&&i.deviceType===t)),-1===i?s.phoneNumbers.push(n):s.phoneNumbers[i]=n}else s.phoneNumbers.push(n);const o=await this.profileService.setUserData(s);return this.rainbowLogger.sdk(l.logService+"[updatePhoneNumber] :: Phone number updated"),o.data}async deletePhoneNumber(e,t){if(!e||"string"!=typeof e||["home","work","other"].indexOf(e)<0)throw new Error("Parameter 'type' is missing or not matching one of the following types: 'home', 'work', 'other'");if(!t||"string"!=typeof t||["landline","mobile","fax","other"].indexOf(t)<0)throw new Error("Parameter 'deviceType' is missing or not matching one of the following types 'landline', 'mobile', 'fax', 'other'");const i=this.authService.loggedInUser;let r;if(!i.phoneNumbers.length)throw new Error("No phone numbers associated with the user profile");{const n=i.phoneNumbers.filter((i=>!(i.type===e&&i.deviceType===t)));i.phoneNumbers=n,r=await this.profileService.setUserData(i),this.rainbowLogger.sdk(l.logService+"[deletePhoneNumber] :: Phone number deleted")}return r.data}async updatePhotoFromUrl(e){if(!e||"string"!=typeof e||e.length<1)throw new Error("Parameter 'imgUrl' is missing, empty or null");await this.contactService.pushAvatarImage(e),this.rainbowLogger.sdk(l.logService+"[updatePhotoFromUrl] :: Photo updated")}async updateWorkEmail(e){if(!e||"string"!=typeof e||e.length<1)throw new Error("Parameter 'strEmail' is missing, empty or null");const t=this.authService.loggedInUser;let i=false;if(t.emails.length){for(let r=0;r<t.emails.length;r++)"work"===t.emails[r].type&&(t.emails[r].email=e,i=true);i||t.emails.push({email:e,type:"work"})}else t.emails=[{email:e,type:"work"}];const r={emails:t.emails},n=await this.profileService.setUserData(r);return this.rainbowLogger.sdk(l.logService+"[updateWorkEmail] :: work email updated"),n.data}async updatePersonalEmail(e){if(!e||"string"!=typeof e||e.length<1)throw new Error("Parameter 'strEmail' is missing, empty or null");const t=this.authService.loggedInUser;let i=false;if(t.emails.length){for(let r=0;r<t.emails.length;r++)"home"===t.emails[r].type&&(t.emails[r].email=e,i=true);i||t.emails.push({email:e,type:"home"})}else t.emails=[{email:e,type:"home"}];const r={emails:t.emails},n=await this.profileService.setUserData(r);return this.rainbowLogger.sdk(l.logService+"[updatePersonalEmail] :: work email updated"),n.data}async deleteWorkEmail(){const e={emails:this.authService.loggedInUser.emails.filter((e=>"work"!==e.type))},t=await this.profileService.setUserData(e);return this.rainbowLogger.sdk(l.logService+"[deleteWorkEmails] :: work emails deleted"),t.data}async deletePersonalEmail(){const e={emails:this.authService.loggedInUser.emails.filter((e=>"home"!==e.type))},t=await this.profileService.setUserData(e);return this.rainbowLogger.sdk(l.logService+"[deletePersonalEmails] :: personal emails deleted"),t.data}async updateCountry(e){const t={country:e},i=await this.profileService.setUserData(t);return this.rainbowLogger.sdk(l.logService+"[updateCountry] :: Country updated"),i.data}async updateLanguage(e){const t={language:e},i=await this.profileService.setUserData(t);return this.rainbowLogger.sdk(l.logService+"[updateLanguage] :: Language updated"),i.data}async updateTitle(e){const t={title:e},i=await this.profileService.setUserData(t);return this.rainbowLogger.sdk(l.logService+"[updateTitle] :: title updated"),i.data}async updateNickName(e){const t={nickName:e},i=await this.profileService.setUserData(t);return this.rainbowLogger.sdk(l.logService+"[updateNickName] :: nickname updated"),i.data}async updateJobTitle(e){const t={jobTitle:e},i=await this.profileService.setUserData(t);return this.rainbowLogger.sdk(l.logService+"[updateJobTitle] :: job title updated"),i.data}}l.logService="UserProfileService | ",t.UserProfileService=l},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(38),n=i(27),s=i(150),o=i(482),a=i(39),c=i(6),l=i(315),d=i(314),u=i(14),h=i(120),f=i(322),p=i(149),g=i(152),m=new WeakMap;class v{constructor(e){this.contactService=c.ContactService.getInstance(),this.invitationService=l.InvitationService.getInstance(),this.office365AdService=d.Office365AdService.getInstance(),this.profileService=u.ProfileService.getInstance(),this.directoryService=p.DirectoryService.getInstance(),this.companyDirectoryService=h.CompanyDirectoryService.getInstance(),this.calendarService=f.CalendarService.getInstance(),this.phonebookService=g.PhonebookService.getInstance(),this.RAINBOW_ONCONTACTINFORMATIONCHANGED="rainbowcontactinformationchanged",this.RAINBOW_ONINFORMATIONCHANGED="rainbowinformationchanged",this.RAINBOW_ONCONTACTINVITATIONNUMBERCHANGED="rainbowsubscriptionnumberchanged",this.RAINBOW_ONCONTACTINVITATIONRECEIVED="rainbowinvitationreceived",this.RAINBOW_ONCONTACTCALENDARINFORMATIONCHANGE="rainbowoncontactcalendarinformationchange",this.RAINBOW_ONCONTACTCALENDARSTATECHANGE="rainbowoncontactcalendarstatechange",this.RAINBOW_ONMYCONTACTSETTINGSCHANGED="rainbowonmycontactsettingschanged",m.set(this,e),e.$on("$destroy",e.$on("ON_CONTACT_UPDATED_EVENT",((e,t)=>this.onContactInformationUpdated(e,t)))),e.$on("$destroy",e.$on("ON_USER_CONTACT_UPDATED_EVENT",((e,t)=>this.onInformationUpdated(e,t)))),e.$on("$destroy",e.$on("ON_INVITATIONS_NUMBER_UPDATED",(()=>this.onInvitationNumberChanged()))),e.$on("$destroy",e.$on("ON_INVITATION_CHANGED",((e,t)=>this.onInvitationReceived(e,t)))),e.$on("$destroy",e.$on("ON_CONTACT_CALENDAR_STATUS_CHANGE",((e,t)=>this.onContactCalendarPresenceChange(e,t)))),e.$on("$destroy",e.$on("ON_MY_CONTACT_SETTINGS_CHANGE",(()=>this.onMyContactSettingsChange()))),this.calendarService.eventSubject.subscribe((e=>{"ON_CALENDAR_STATUS_CHANGE"===e.action&&n.eventsService.dispatchEvent(this.RAINBOW_ONCONTACTCALENDARSTATECHANGE,{status:this.calendarService.serviceActivated})}))}static get $inject(){return["$rootScope"]}onContactInformationUpdated(e,t){a.sdkConfig.newModels?n.eventsService.dispatchEvent(this.RAINBOW_ONCONTACTINFORMATIONCHANGED,new s.ContactSDK(t)):n.eventsService.dispatchEvent(this.RAINBOW_ONCONTACTINFORMATIONCHANGED,t)}onInformationUpdated(e,t){a.sdkConfig.newModels?n.eventsService.dispatchEvent(this.RAINBOW_ONINFORMATIONCHANGED,new s.ContactSDK(t)):n.eventsService.dispatchEvent(this.RAINBOW_ONINFORMATIONCHANGED,t)}onInvitationNumberChanged(){n.eventsService.dispatchEvent(this.RAINBOW_ONCONTACTINVITATIONNUMBERCHANGED,null)}onInvitationReceived(e,t){a.sdkConfig.newModels?n.eventsService.dispatchEvent(this.RAINBOW_ONCONTACTINVITATIONRECEIVED,new o.InvitationSDK(t)):n.eventsService.dispatchEvent(this.RAINBOW_ONCONTACTINVITATIONRECEIVED,t)}onContactCalendarPresenceChange(e,t){n.eventsService.dispatchEvent(this.RAINBOW_ONCONTACTCALENDARINFORMATIONCHANGE,new s.ContactSDK(t))}onMyContactSettingsChange(){n.eventsService.dispatchEvent(this.RAINBOW_ONMYCONTACTSETTINGSCHANGED)}getContactByJID(e){if(!e)return{code:r.SDK.ERRORBADREQUEST,label:"Parameter 'strJID' is missing or empty"};const t=this.contactService.getContactByJid(e);return a.sdkConfig.newModels&&t?new s.ContactSDK(t):t}async getContactById(e){if(!e)return{code:r.SDK.ERRORBADREQUEST,label:"Parameter 'strId' is missing or empty"};const t=await this.contactService.getContactByDBId(e);return a.sdkConfig.newModels?new s.ContactSDK(t):t}async getNetworkContacts(){const e=this.contactService.getContacts().filter((e=>e.id!==this.contactService.userContact.id&&!e.isBot&&e.roster));return a.sdkConfig.newModels?e.map((e=>new s.ContactSDK(e))):e}getAll(){const e=this.contactService.getContacts().filter((e=>e.id!==this.contactService.userContact.id&&!e.isBot));return a.sdkConfig.newModels?e.map((e=>new s.ContactSDK(e))):e}getConnectedUser(){const e=this.contactService.userContact;return a.sdkConfig.newModels&&e?new s.ContactSDK(e):e||null}getConnectedUserPhone(){return this.contactService.userContact?0===this.contactService.userContact.pbxId.length?null:{phoneNumber:this.contactService.userContact.phonePbx,pbxId:this.contactService.userContact.pbxId}:null}async searchByName(e,t,i=false,r="",n=""){if(!e)throw new Error("Parameter 'strName' is missing or empty");t||(t=20);const o=await this.directoryService.search(e,i,Math.min(t,1e3),r,n);return a.sdkConfig.newModels?o.map((e=>new s.ContactSDK(e))):o}async searchPhonebook(e){const t=this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_PHONE_BOOK);if(!e)throw new Error("Parameter 'strPattern' is missing or empty");if(!t)throw new Error("The feature is not enabled for connected user");const i=await this.phonebookService.search(e);return a.sdkConfig.newModels?i.map((e=>new s.ContactSDK(e))):i}async searchOffice365(e){if(!e)throw new Error("Parameter 'strPattern' is missing or empty");const t=await this.office365AdService.search(e);return a.sdkConfig.newModels?t.map((e=>new s.ContactSDK(e))):t}async searchCompanyDirectory(e,t){if(!e)throw new Error("Parameter 'strPattern' is missing or empty");if(!t)throw new Error("Parameter 'companyId' is missing or empty");const i=await this.companyDirectoryService.search(e,t);return a.sdkConfig.newModels?i.map((e=>new s.ContactSDK(e))):i}async searchByLogin(e){if(!e)throw new Error("Parameter 'strLogin' is missing or empty");const t=await this.directoryService.searchUserByLogin(e);return t?a.sdkConfig.newModels?new s.ContactSDK(t):t:null}async searchByJid(e){if(!e)throw new Error("Parameter 'strJid' is missing or empty");const t=await this.directoryService.searchUserByJid(e);return a.sdkConfig.newModels?new s.ContactSDK(t):t}async searchById(e){if(!e)throw new Error("Parameter 'strId' is missing or empty");const t=await this.contactService.getContactByDBId(e,true);return t?a.sdkConfig.newModels?new s.ContactSDK(t):t:null}async acceptInvitation(e){if(!e)return new Error("Parameter 'invitationId' is missing or null");const t=this.invitationService.getInvitation(e);return await this.invitationService.acceptInvitation(t),{code:r.SDK.OK,label:"OK"}}async declineInvitation(e){if(!e)throw new Error("Parameter 'invitationId' is missing or null");const t=this.invitationService.getInvitation(e);return await this.invitationService.declineInvitation(t),{code:r.SDK.OK,label:"OK"}}async addToNetwork(e){if(!e)throw new Error("Parameter 'contactId' is missing or null");const t=await this.contactService.getContactByDBId(e);return await this.invitationService.joinContactInvitation(t)}async sendInvitationByEmail(e,t){if(!e)throw new Error("Parameter 'email' is missing or null");return await this.invitationService.sendInvitationByEmail(e,t)}async removeFromNetwork(e){if(!e)throw new Error("Parameter 'contactId' is missing or null");const t=await this.contactService.getContactByDBId(e);return await this.contactService.removeContact(t),{code:r.SDK.OK,label:"OK"}}getInvitationById(e){if(!e)throw new Error("Parameter 'invitationId' is missing or null");return this.invitationService.getInvitation(e)}getInvitationsReceived(){const e=this.invitationService.getReceivedInvitations();return a.sdkConfig.newModels&&e.length?e.map((e=>new o.InvitationSDK(e))):e}async cancelInvitation(e){if(!e)throw new Error("Parameter 'invitationId' is missing or null");const t=this.invitationService.getInvitation(e);await this.invitationService.cancelOneSendInvitation(t)}getInvitationsSent(){const e=this.invitationService.getSentInvitations();return a.sdkConfig.newModels&&e.length?e.map((e=>new o.InvitationSDK(e))):e}async updateUserCustomData(e){if(!e)throw new Error("Parameter 'customData' is missing or null");return await this.contactService.updateUserContact({customData:e}),this.getConnectedUser()}async updateUserAutoDndCalendarSetting(e){return await this.contactService.setUserSettings({applyCalendarPresence:e}),e}getUserAutoDndCalendarSetting(){return"true"===this.contactService.getUserSettingFromSettingsService("applyCalendarPresence")}async updateUserMSTeamsPresenceSetting(e){return await this.contactService.setUserSettings({applyMsTeamsPresence:e}),e}getUserMSTeamsPresenceSetting(){return"true"===this.contactService.getUserSettingFromSettingsService("applyMsTeamsPresence")}isCalendarSharingActivated(){return this.calendarService.serviceActivated}}v.logService="ContactService | ",t.ContactsService=v},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(27),n=i(6),s=i(38),o=i(328),a=i(34),c=i(57),l=i(121),d=i(70),u=i(118),h=i(4),f=new WeakMap;class p{constructor(e){this.contactService=n.ContactService.getInstance(),this.telephonyAbstractService=o.TelephonyAbstractService.getInstance(),this.webrtcP2PService=a.WebrtcP2PService.getInstance(),this.telephonyService=c.TelephonyService.getInstance(),this.ccdAgentService=l.CCDAgentService.getInstance(),this.webrtcGatewayService=d.WebrtcGatewayService.getInstance(),this.voiceMessageService=u.VoiceMessageService.getInstance(),this.rainbowLogger=h.LoggerService.getInstance(),this.RAINBOW_ONTELEPHONYCALLSTATECHANGED="rainbowontelephonycallstatechanged",this.RAINBOW_ONVOIPCALLSTATECHANGED="rainbowonvoipcallstatechanged",this.RAINBOW_ONTELEPHONYSTARTED="rainbowontelephonystarted",this.RAINBOW_ONTELEPHONYSTOPPED="rainbowontelephonystopped",this.RAINBOW_ONTELEPHONYFORWARDSTATECHANGED="rainbowontelephonyforwardstatechanged",this.RAINBOW_ONCALLNOMADICEVENT="rainbowoncallnomadicevent",this.RAINBOW_ONVOIPSTARTED="rainbowonvoipstarted",this.RAINBOW_ONVOIPSTOPPED="rainbowonvoipstopped",this.RAINBOW_ONVOICEMESSAGEUPDATED="rainbowonvoicemessageupdated",this.RAINBOW_TELEPHONYDIALING="dialing",this.RAINBOW_TELEPHONYRINGINGOUTGOING="ringingOutgoing",this.RAINBOW_TELEPHONYINCOMING="incomingCall",this.RAINBOW_TELEPHONYACTIVE="active",this.RAINBOW_TELEPHONYRELEASING="releasing",this.RAINBOW_TELEPHONYUNKNOW="Unknown",this.RAINBOW_TELEPHONYMUTE="rainbowtelephonymute",this.RAINBOW_ONTELEPHONYMODEUPDATED="rainbowontelephonymodeupdated",this.RAINBOW_ONFORWARDMODEUPDATED="rainbow_onforwardmodeupdated",f.set(this,e),e.$on("$destroy",e.$on("ON_TELEPHONY_STATUS_CHANGED_EVENT",((e,t)=>this.onTelephonyStateChanged(e,t)))),e.$on("$destroy",e.$on("ON_CALL_NOMADIC_EVENT",((e,t)=>this.onCallNomadicEvent(e,t)))),e.$on("$destroy",e.$on("ON_CALL_UPDATED_EVENT",((e,t)=>this.onTelephonyCallChanged(e,t)))),e.$on("$destroy",e.$on("ON_CALL_FORWARDED_EVENT",((e,t)=>this.onCallForwardChanged(e,t)))),e.$on("$destroy",e.$on("ON_WEBRTCGATEWAY_STATE_CHG",((e,t)=>this.onVoIPStateChanged(e,t)))),e.$on("$destroy",e.$on("ON_VOICE_MESSAGE_UPDATE_EVENT",((e,t)=>this.onVoiceMessageUpdated(e,t)))),e.$on("$destroy",e.$on("ON_CONVERSATION_CALL_MUTED_UPDATED_EVENT",((e,t)=>this.onCallMuteEvent(e,t)))),this.telephonyAbstractService.subscribe((e=>{"TELEPHONY_MODE_UPDATED"===e.name&&this.onTelephonyModeUpdated(e.data)})),this.telephonyAbstractService.subscribe((e=>{"FORWARD_MODE_UPDATED"===e.name&&this.onForwardModeUpdated(e.data)}))}static get $inject(){return["$rootScope"]}onTelephonyStateChanged(e,t){this.rainbowLogger.sdk(p.logService+"[onTelephonyStateChanged] :: PBX state changed to "+t),"started"===t?r.eventsService.dispatchEvent(this.RAINBOW_ONTELEPHONYSTARTED,null):r.eventsService.dispatchEvent(this.RAINBOW_ONTELEPHONYSTOPPED,null)}onCallNomadicEvent(e,t){this.rainbowLogger.sdk(p.logService+"[onCallNomadicEvent] :: Nomadic event received"),r.eventsService.dispatchEvent(this.RAINBOW_ONCALLNOMADICEVENT,t)}onTelephonyCallChanged(e,t){const i=this.webrtcGatewayService.isMediaPillarCallSituation(t);"Phone"!==t.type.value||i?i&&(this.rainbowLogger.sdk(p.logService+"[onTelephonyCallChanged] :: VoIP state changed to "+t),r.eventsService.dispatchEvent(this.RAINBOW_ONVOIPCALLSTATECHANGED,t)):(this.rainbowLogger.sdk(p.logService+"[onTelephonyCallChanged] :: Telephony state changed to "+t),r.eventsService.dispatchEvent(this.RAINBOW_ONTELEPHONYCALLSTATECHANGED,t))}onCallForwardChanged(e,t){this.rainbowLogger.sdk(p.logService+"[onCallForwardChanged] :: Forward state changed to "+t),r.eventsService.dispatchEvent(this.RAINBOW_ONTELEPHONYFORWARDSTATECHANGED,t)}onVoIPStateChanged(e,t){this.rainbowLogger.sdk(p.logService+"[onVoIPStateChanged] :: VoIP state changed to "+t?"true":"false"),t?r.eventsService.dispatchEvent(this.RAINBOW_ONVOIPSTARTED,null):r.eventsService.dispatchEvent(this.RAINBOW_ONVOIPSTOPPED,null)}onVoiceMessageUpdated(e,t){this.rainbowLogger.sdk(p.logService+"[onVoiceMessageUpdated] :: New Voice Message event received"),r.eventsService.dispatchEvent(this.RAINBOW_ONVOICEMESSAGEUPDATED,t)}onCallMuteEvent(e,t){this.rainbowLogger.sdk(p.logService+"[onCallMuteEvent] :: New Mute Event received"),r.eventsService.dispatchEvent(this.RAINBOW_TELEPHONYMUTE,t)}onTelephonyModeUpdated(e){this.rainbowLogger.sdk(p.logService+"[onTelephonyModeUpdated] :: New Telephony Mode event received"),r.eventsService.dispatchEvent(this.RAINBOW_ONTELEPHONYMODEUPDATED,e)}onForwardModeUpdated(e){this.rainbowLogger.sdk(p.logService+"[onForwardModeUpdated] :: New Forward Mode event received"),r.eventsService.dispatchEvent(this.RAINBOW_ONFORWARDMODEUPDATED,e)}isTelephonyAvailable(){return this.telephonyService.started}isVoiceMailConfigured(){return Boolean(this.telephonyService.voiceMailFeatureEnabled&&this.telephonyService.voicemailNumber)}getAgentVersion(){return this.telephonyService.agentStatus.agentVersion||"unknown"}getXMPPAgentStatus(){return this.telephonyService.agentStatus.xmppAgent||"unknown"}getPhoneAPIStatus(){return this.telephonyService.agentStatus.phoneApi||"unknown"}async makeCall1PCC(e,t){if(!e)throw new Error("Parameter 'strPhoneNumber' is missing or empty");const i=await this.contactService.getContactByDBId(t);return this.webrtcGatewayService.mediaPillarMakeCall1PCC(e,i)}async makeCall(e,t,i,r,n){if(!t)throw new Error("Parameter 'strPhoneNumber' is missing or empty");if(e){const s=await this.contactService.getContactByDBId(e);await this.telephonyService.makeCall(s,t,i,r,n)}else await this.telephonyService.makeCallByPhoneNumber(t,i,r,n);return{code:s.SDK.OK,label:"OK"}}async callByNumber(e){if(!e)throw new Error("Parameter 'strPhoneNumber' is missing or empty");return await this.telephonyService.makeCallByPhoneNumber(e),{code:s.SDK.OK,label:"OK"}}async callWithMessage(e,t,i,r){if(!t)throw new Error("Parameter 'phoneNumber' is missing or empty");if(!i)throw new Error("Parameter 'callSubject' is missing or empty");if(e){const n=await this.contactService.getContactByDBId(e);await this.telephonyService.makeCall(n,t,i,r)}else await this.telephonyService.makeCallByPhoneNumber(t,i,r);return{code:s.SDK.OK,label:"OK"}}async callWithSubject(e,t,i){if(!e)throw new Error("Parameter 'contact' is missing or empty");if(!t)throw new Error("Parameter 'phoneNumber' is missing or empty");if(!i)throw new Error("Parameter 'callSubject' is missing or empty");const r=await this.contactService.getContactByDBId(e);return await this.telephonyService.makeCall(r,t,i),{code:s.SDK.OK,label:"OK"}}calls(){return this.telephonyService.calls}getActiveCall(){return this.telephonyService.getActiveCall()}async release(e){if(!e)throw new Error("Parameter 'call' is missing or null");return await this.telephonyService.releaseCall(e),{code:s.SDK.OK,label:"OK"}}async deflectToVM(e){if(!e)throw new Error("Parameter 'call' is missing or null");if(!e.connectionId)throw new Error("Property 'connectionId' of the object 'call' is missing or null");if("Phone"!==e.type.value)throw new Error("Call must be of type 'Phone' (see call.type.value)");return await this.telephonyService.deflectCallToVM(e),{code:s.SDK.OK,label:"OK"}}async forwardToDevice(e,t="immediate"){if(!e||"string"!=typeof e||0===e.length)throw new Error("Parameter 'strPhoneNumber' is missing or empty");return this.telephonyService.forwardToDevice(e,t),{code:s.SDK.OK,label:"OK"}}async forwardToVoicemail(e="immediate"){return await this.telephonyService.forwardToVoicemail(e),{code:s.SDK.OK,label:"OK"}}async cancelForward(){return await this.telephonyService.cancelForward(),{code:s.SDK.OK,label:"OK"}}async getForwardStatusFromServer(){await this.telephonyService.getForwardStatus().then((()=>({code:s.SDK.OK,label:"OK"})))}getForwardStatus(){return this.telephonyService.getForwardObject()}async answer(e){if(!e)throw new Error("Parameter 'call' is missing or null");return e.mediaPillarCall?this.webrtcGatewayService.answerCall(e):await this.telephonyService.answerCall(e),{code:s.SDK.OK,label:"OK"}}async hold(e){if(!e)throw new Error("Parameter 'call' is missing or null");return await this.telephonyService.holdCall(e),{code:s.SDK.OK,label:"OK"}}async retrieve(e){if(!e)throw new Error("Parameter 'call' is missing or null");return await this.telephonyService.retrieveCall(e),{code:s.SDK.OK,label:"OK"}}async transferCall(e,t){if(!e)throw new Error("Parameter 'activeCall' is missing or null");if(!t)throw new Error("Parameter 'heldCall' is missing or null");return await this.telephonyService.transfertCall(e,t),{code:s.SDK.OK,label:"OK"}}async conferenceCall(e,t){if(!e)throw new Error("Parameter 'activeCall' is missing or null");if(!t)throw new Error("Parameter 'heldCall' is missing or null");return await this.telephonyService.conferenceCall(e,t),{code:s.SDK.OK,label:"OK"}}async fetchVoiceMailMessagesNumber(){return await this.voiceMessageService.getVoiceMessagesCounters()}muteCall(e,t){if(!e)throw new Error("Parameter 'call' is missing or null");this.webrtcGatewayService.muteAudio(e,true,t)}unmuteCall(e,t){if(!e)throw new Error("Parameter 'call' is missing or null");this.webrtcGatewayService.muteAudio(e,false,t)}getTelephonyMode(){return this.telephonyAbstractService.getTelephonyMode()}setTelephonyMode(e){return this.telephonyAbstractService.setTelephonyMode(e)}async nomadicLogin(e,t,i){if(!e)throw new Error("Parameter 'phoneNumber' is missing or null");await this.telephonyService.nomadicLogin(e,t,i)}async nomadicLogout(){await this.telephonyService.nomadicLogout()}async getNomadicState(){this.isCloudPbxUser()?await this.telephonyService.getSipWiseRoutingInfo():await this.telephonyService.getNomadicStatus()}async setExternalNomadicNumber(e){if(!e)throw new Error("Parameter 'phoneNumber' is missing or null");if("string"!=typeof e)throw new Error("Parameter 'phoneNumber' is not a string");await this.telephonyService.nomadicLogin(e)}async setNomadicOfficePhone(e=true){if(this.isCloudPbxUser()){const e=this.telephonyService.telephonyServiceSipWise.getDeviceIdWithType("sip");if(!e)throw new Error("Error: no Cloud PBX office phone device found");await this.telephonyService.setSipWiseCurrentDevice(e)}else await this.telephonyService.nomadicLoginOnOfficePhone(),e&&this.telephonyService.nomadicLogout()}async setNomadicVoIP(){if(this.telephonyService.isSipWiseRoot()){const e=this.telephonyService.telephonyServiceSipWise.getDeviceIdWithType("webrtc");await this.telephonyService.setSipWiseCurrentDevice(e)}else{const e=this.webrtcGatewayService.getMyMediaPillarRemoteExtension();await this.telephonyService.nomadicLogin(e)}}isDeskPhoneAvailable(){return!this.contactService.userContact.isVirtualTerm}isVoIPAvailable(){return this.webrtcGatewayService.isMediaPillarAvailable()}async logonCCD(e,t,i,r,n,s){if(!e)throw new Error("Parameter 'endpointTel' is missing or empty");return await this.ccdAgentService.ccdAgentLogOn(e,t,i,r,n,s)}async logoffCCD(e,t,i,r){if(!e)throw new Error("Parameter 'endpointTel' is missing or empty");return await this.ccdAgentService.ccdAgentLogOff(e,t,i,r)}async withdrawalCCD(e,t,i){return await this.ccdAgentService.ccdAgentWithdrawal(e,t,i)}async wrapupCCD(e,t,i,r){return this.ccdAgentService.ccdAgentWrapup(e,t,i,r)}subscribeToCCDEvents(e){return this.ccdAgentService.subscribe(e)}getCurrentCCDAgentStatus(){return this.ccdAgentService.getCurrentCCDAgentStatus()}async getCCDGroupStatus(e){if(!e)throw new Error("getCCDGroupStatus -- missing groupId parameter");return this.ccdAgentService.getCCDGroupStatus(e)}async sendDTMF(e,t){if(!e)throw new Error("Parameter 'dialString' is missing or empty");if(!t)throw new Error("Parameter 'call' is missing or empty");if("Video"===t.type.value)return this.webrtcP2PService.sendDTMF(e,t.mediaPillarCall.webrtcCallRef,false);if("Phone"===t.type.value)return t.mediaPillarCall?this.webrtcP2PService.sendDTMF(e,t.mediaPillarCall.webrtcCallRef,false):this.telephonyService.sendDtmf(t,e);if("Video"!==t.type.value||"Phone"!==t.type.value)throw new Error("Parameter 'call' must be of type 'Video' or 'Phone'");return true}getPbxType(){return this.telephonyService.isSipWiseRoot()?"Cloud":this.telephonyService.isOxo?"OXO":this.telephonyService.isOxe?"OXE":this.telephonyService.isThirdParty?"ThirdParty":"None"}isOxoUser(){return!this.telephonyService.isSipWiseRoot()&&Boolean(this.telephonyService.isOxo)}isOxeUser(){return!this.telephonyService.isSipWiseRoot()&&Boolean(this.telephonyService.isOxe)}isCloudPbxUser(){return Boolean(this.telephonyService.isSipWiseRoot())}isThirdPartyPbxUser(){return!this.telephonyService.isSipWiseRoot()&&Boolean(this.telephonyService.isThirdParty)}getForwardMode(){return this.telephonyAbstractService.getForwardMode()}async setForwardMode(e,t,i){return await this.telephonyAbstractService.setForwardMode(e,t,i)}}p.logService="telephonyService | ",t.PbxService=p},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(39),n=i(27),s=i(329),o=i(6),a=i(30),c=i(62),l=i(4),d=new WeakMap;class u{constructor(e){this.RAINBOW_ONCONVERSATIONSMISSEDCOUNTERCHANGED="rainbowconversationsmissedcounterchanged",this.contactService=o.ContactService.getInstance(),this.roomService=a.RoomService.getInstance(),this.conversationService=c.ConversationService.getInstance(),this.rainbowLogger=l.LoggerService.getInstance(),this.RAINBOW_ONCONVERSATIONSCHANGED="rainbowconversationschanged",this.RAINBOW_ONCONVERSATIONREMOVED="rainbowconversationremoved",this.RAINBOW_ONCONVERSATIONCHANGED="rainbowconversationchanged",d.set(this,e),e.$on("$destroy",e.$on("ON_CONVERSATIONS_UPDATED_EVENT",((e,t)=>this.onConversationsChanged(e,t)))),e.$on("$destroy",e.$on("ON_CONVERSATION_REMOVE_EVENT",((e,t)=>this.onConversationsRemoved(e,t)))),e.$on("$destroy",e.$on("ON_CONVERSATION_UPDATED_EVENT",((e,t)=>this.onConversationChanged(e,t)))),this.conversationService.missedInfoCounters.subscribe((e=>{this.onConversationsCounterChanged(e)}))}static get $inject(){return["$rootScope"]}onConversationsChanged(e,t){t&&(r.sdkConfig.newModels?n.eventsService.dispatchEvent(this.RAINBOW_ONCONVERSATIONSCHANGED,new s.ConversationSDK(t)):n.eventsService.dispatchEvent(this.RAINBOW_ONCONVERSATIONSCHANGED,t))}onConversationsRemoved(e,t){r.sdkConfig.newModels?n.eventsService.dispatchEvent(this.RAINBOW_ONCONVERSATIONREMOVED,new s.ConversationSDK(t)):n.eventsService.dispatchEvent(this.RAINBOW_ONCONVERSATIONREMOVED,t)}onConversationChanged(e,t){const i=this.conversationService.getConversation(t);r.sdkConfig.newModels,n.eventsService.dispatchEvent(this.RAINBOW_ONCONVERSATIONCHANGED,new s.ConversationSDK(i))}onConversationsCounterChanged(e){n.eventsService.dispatchEvent(this.RAINBOW_ONCONVERSATIONSMISSEDCOUNTERCHANGED,e)}async getAllConversations(){const e=this.conversationService.getConversations();return r.sdkConfig.newModels?e.map((e=>new s.ConversationSDK(e))):e}getCallById(e){if(!e)throw new Error("Parameter 'strCallId' is missing or empty");const t=this.conversationService.getConversations();let i=null;return t.forEach((function(t){t.videoCall&&t.videoCall.id===e?i=t.videoCall:t.audioCall&&t.audioCall.id===e&&(i=t.audioCall)})),i}getConversationById(e){if(!e)throw new Error("Parameter 'conversationId' is missing or empty");const t=this.conversationService.getConversation(e);if(!t)throw new Error("Could not find a conversation with the following ID: "+e);return r.sdkConfig.newModels?new s.ConversationSDK(t):t}getConversationByIdDeprecated(e){if(!e)throw new Error("Parameter 'conversationId' is missing or empty");return this.conversationService.getConversation(e)}async getConversationByBubbleId(e){try{if(!e)throw new Error("Parameter 'bubbleId' is missing or empty");const t=this.roomService.getRoomById(e),i=await this.conversationService.getOrCreateConversation(t.jid,"room");return r.sdkConfig.newModels?new s.ConversationSDK(i):i}catch(dp){return dp}}async openConversationForContact(e){if(!e)throw new Error("Parameter 'contact' is missing or null");this.rainbowLogger.sdk(u.logService+"[openConversationForContact] :: Trying to open a conversation for a contact");return await this.conversationService.getOrCreateConversation(e.jid,"contact")}async getConversationByContactId(e){if(!e)throw new Error("Parameter 'contactId' is missing or null");this.rainbowLogger.sdk(u.logService+"[openConversationForContact] :: Trying to get conversation by contactId");const t=await this.contactService.getContactByDBId(e),i=await this.conversationService.getOrCreateConversation(t.jid,"contact");return r.sdkConfig.newModels?new s.ConversationSDK(i):i}async openConversationForBubble(e){if(!e)throw new Error("Prameter 'bubble' is missing or null");this.rainbowLogger.sdk(u.logService+"[openConversationForBubble] :: Try to create or get a conversation for a bubble ");const t=await this.conversationService.getOrCreateConversation(e.jid,"room");return r.sdkConfig.newModels?new s.ConversationSDK(t):t}async closeConversation(e){if(!e)throw new Error("Parameter 'conversationId' is missing or null");const t=this.getConversationById(e);await this.conversationService.closeConversation(t)}async closeConversationDeprecated(e){if(!e)throw new Error("Parametr 'conversation' is missing or null");await this.conversationService.closeConversation(e)}}u.logService="ConversationsService | ",t.ConversationsService=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(27),n=i(66),s=i(38),o=i(37),a=i(30),c=i(39),l=i(329),d=i(330),u=i(62),h=i(95),f=i(4),p=new WeakMap;class g{constructor(e){this.fileStorageService=o.FileStorageService.getInstance(),this.roomService=a.RoomService.getInstance(),this.conversationService=u.ConversationService.getInstance(),this.rainbowLogger=f.LoggerService.getInstance(),this.RAINBOW_ONNEWIMMESSAGERECEIVED="rainbownewimmessagereceived",this.RAINBOW_ONNEWIMRECEIPTRECEIVED="rainbownewimreceiptreceived",this.RAINBOW_ONNEWPARTICIPANTSTATUS="rainbownewparticipantstatus",p.set(this,e),e.$on("$destroy",e.$on("ON_CONVERSATION_MESSAGE_RECEIVED",((e,t,i,r)=>this.onNewImMessageReceived(e,t,i,r)))),e.$on("$destroy",e.$on("ON_CONVERSATION_RECEIPT_RECEIVED",((e,t,i,r)=>this.onNewImReceiptReceived(e,t,i,r)))),e.$on("$destroy",e.$on("ON_CONVERSATIONS_STATUS_MESSAGE_EVENT",((e,t,i,r)=>this.onNewParticipantStatus(e,t,i,r))))}static get $inject(){return["$rootScope"]}onNewImMessageReceived(e,t,i,n){c.sdkConfig.newModels?r.eventsService.dispatchEvent(this.RAINBOW_ONNEWIMMESSAGERECEIVED,{message:new d.MessageSDK(t),conversation:new l.ConversationSDK(i),cc:n}):r.eventsService.dispatchEvent(this.RAINBOW_ONNEWIMMESSAGERECEIVED,{message:t,conversation:i,cc:n})}onNewImReceiptReceived(e,t,i,n){c.sdkConfig.newModels?r.eventsService.dispatchEvent(this.RAINBOW_ONNEWIMRECEIPTRECEIVED,{message:new d.MessageSDK(t),conversation:new l.ConversationSDK(i),evt:n}):r.eventsService.dispatchEvent(this.RAINBOW_ONNEWIMRECEIPTRECEIVED,{message:t,conversation:i,evt:n})}onNewParticipantStatus(e,t,i,n){n&&n.value&&(c.sdkConfig.newModels?r.eventsService.dispatchEvent(this.RAINBOW_ONNEWPARTICIPANTSTATUS,{participant:t,conversation:new l.ConversationSDK(i),status:n.value}):r.eventsService.dispatchEvent(this.RAINBOW_ONNEWPARTICIPANTSTATUS,{participant:t,conversation:i,status:n.value}))}async getMessagesFromConversation(e,t=30){if(!e)throw new Error("Parameter 'conversationId' is missing or null");t=t?Math.min(t,100):30;const i=this.conversationService.getConversation(e);if(!i)throw new Error("Could not find the conversation with the following ID: "+e);try{await this.conversationService.conversationServiceBulkHistoryHandler.getHistoryPage(i,t)}catch(dp){}return c.sdkConfig.newModels?new l.ConversationSDK(i):i}getMessageFromConversationById(e,t){if(!e)throw new Error("Parameter 'conversationId' is missing or null");if(!t)throw new Error("Parameter 'strMessageId' is missing or empty");const i=this.conversationService.getConversation(e).getMessageById(t);let r;return i&&i.fileId&&(i.shortFileDescriptor=this.fileStorageService.getFileDescriptorById(i.fileId),r=i.shortFileDescriptor),c.sdkConfig.newModels?new d.MessageSDK(i,r):i}getMessageFromBubbleById(e,t){if(!e)throw new Error("Parameter 'bubble' is missing or null");if(!t)throw new Error("Parameter 'strMessageId' is missing or empty");const i=this.conversationService.getConversation(e.dbId);if(!i)throw new Error("Parameter 'bubble' don't have a conversation");if(i.type!==h.Conversation.Type.ROOM)throw new Error("Parameter 'conversation' is not a bubble conversation");const r=i.getMessageById(t);let n;return r&&r.fileId&&(r.shortFileDescriptor=this.fileStorageService.getFileDescriptorById(r.fileId),n=r.shortFileDescriptor),c.sdkConfig.newModels?new d.MessageSDK(r,n):r}sendMessageToConversation(e,t,i,r,n="std"){const s=this.conversationService.getConversation(e);if(!s)throw new Error("Parameter 'conversation' is missing or null");if(!t)throw new Error("Parameter 'strMessage' is missing or empty");if("string"!=typeof t)throw new Error("Parameter 'strMessage' must be a string");if(t.length>1024)throw new Error("Parameter 'strMessage' should be shorter than 1024 characters");let o=null;if(r){if(r.length>1024)throw new Error("Parameter 'additionalContent.message' should be shorter than 1024 characters");if(!i||"text/markdown"!==i&&"form/json"!==i&&"rainbow/json"!==i)throw new Error("Parameter 'additionalContent.type' should be set to either 'text/markdown', 'form/json' or 'rainbow/json'");"rainbow/json"!==i&&"form/json"!==i||(r=JSON.stringify(r)),o={type:i,message:r}}if("high"!==n&&"middle"!==n&&"low"!==n&&"std"!==n)throw new Error("Parameter 'urgency' should be set to either 'high', 'middle', 'low' or 'std'");const a=this.conversationService.sendChatMessage(s,t,o,null,null,n);return c.sdkConfig.newModels?new d.MessageSDK(a):a}sendCorrectedChatMessage(e,t,i){if(this.rainbowLogger.sdk(g.logService+"[sendCorrectedChatMessage] :: Trying to send a corrected message"),!e)throw new Error("Parameter 'conversationId' is missing or null");if(!t)throw new Error("Parameter 'strMessage' is missing or empty");if(t.length>1024)throw new Error("Parameter 'strMessage' should be shorter than 1024 characters");if(!i)throw new Error("Parameter 'messageId' is missing or empty");const r=this.conversationService.getConversation(e);this.conversationService.sendCorrectedChatMessage(r,t,i);const n=r.getMessageById(i);return c.sdkConfig.newModels?new d.MessageSDK(n):n}async replyToMessage(e,t,i){if(e){if(t){if(i){const r=this.conversationService.getConversation(e),n=r.getMessageById(i),s=this.conversationService.sendChatMessage(r,t,null,n);return c.sdkConfig.newModels?new d.MessageSDK(s):s}throw new Error("Parameter 'answerMessageId' is missing or null")}throw new Error("Parameter 'strMessage' is missing or null")}throw new Error("Parameter 'conversationId' is missing or null")}deleteMessage(e,t){if(!e)throw new Error("Parameter 'conversationId' is missing or null");if(!t)throw new Error("Parameter 'messageId' is missing or empty");const i=this.conversationService.getConversation(e);this.conversationService.sendCorrectedChatMessage(i,"",t);const r=i.getMessageById(t);return c.sdkConfig.newModels?new d.MessageSDK(r):r}getLastModifiedText(e,t){if(!e)throw new Error("Parameter 'conversationId' is missing or null");if(!t)throw new Error("Parameter 'messageId' is missing or null");const i=this.conversationService.getConversation(e);if(!i)throw new Error("Couldn't find a conversation with the provided ID");const r=i.getMessageById(t);if(!r)throw new Error("Couldn't find a message with the provided ID");return r.getLastTextModified()}isMessageDeleted(e,t){if(!e)throw new Error("Parameter 'conversationId' is missing or null");if(!t)throw new Error("Parameter 'messageId' is missing or null");const i=this.conversationService.getConversation(e);if(!i)throw new Error("Couldn't find a conversation with the provided ID");const r=i.getMessageById(t);if(!r)throw new Error("Couldn't find a message with the provided ID");return r.isDeleted()}async sendIsTypingStateInConversation(e,t){if(e){if("boolean"!=typeof t)throw new Error("Parameter 'status' is missing or null - should be a boolean");{const i=this.conversationService.getConversation(e);if(!i)throw new Error("Parameter 'conversationId': this conversation doesn't exist");return void this.conversationService.sendIsTypingState(i,t)}}throw new Error("Parameter 'conversationId' is missing or null")}async sendMessageToBubble(e,t,i,r,n){if(!e)throw new Error("Parameter 'bubble' is missing or null");if(!t)throw new Error("Parameter 'strMessage' is missing or empty");if(t.length>1024)throw new Error("Parameter 'strMessage' should be shorter than 1024 characters");const s=await this.conversationService.getOrCreateConversation(e.jid,"room");if(!s)throw new Error("No 'conversation' found");return e.isActive||await this.roomService.sendInitialRoomPresenceSync(e),await this.sendMessageToConversation(s.dbId,t,i,r,n)}async sendIsTypingStateInBubble(e,t){if(!e)throw new Error("Parameter 'bubble' is missing or null");if("boolean"!=typeof t)throw new Error("Parameter 'status' is missing or null");if(!e.jid)throw new Error("Parameter 'bubble': this bubble is not a valid one");const i=await this.conversationService.getOrCreateConversation(e.jid,"room");if(!i)throw new Error("No 'conversation' found for this bubble");this.conversationService.sendIsTypingState(i,t)}async removeAllMessagesFromConversation(e){if(!e)throw new Error("Parameter 'conversationId' is missing or null");const t=this.conversationService.getConversation(e);if(t.type!==h.Conversation.Type.ONE_TO_ONE&&t.type!==h.Conversation.Type.BOT)throw new Error("Parameter 'conversation' is not a one-to-one conversation");return await this.conversationService.removeAllMessages(t),{code:s.SDK.OK,label:"OK"}}markMessageFromConversationAsRead(e,t){if(!t)throw new Error("Parameter 'messageId' is missing or empty");if(!e)throw new Error("Parameter 'conversationId' is missing or null");const i=this.conversationService.getConversation(e),r=i.getMessageById(t);if(r.receiptStatus===n.Message.ReceiptStatus.READ)throw new Error("Parameter 'message' is aldready marked as read");return this.conversationService.sendAckReadMessage(i,r),r.receiptStatus===n.Message.ReceiptStatus.READ&&this.conversationService.decreaseMissedIMCounterForConversation(i),{code:s.SDK.OK,label:"OK"}}markAllMessagesFromConversationAsRead(e){if(!e)throw new Error("Parameter 'conversationId' is missing or null");const t=this.conversationService.getConversation(e);return this.conversationService.sendAckReadMessages(t),{code:s.SDK.OK,label:"OK"}}}g.logService="IMService | ",t.ImService=g},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(39),n=i(19),s=i(9),o=i(28),a=i(27),c=i(38),l=i(6),d=i(43),u=i(483),h=i(34),f=i(62),p=i(323),g=i(70),m=i(4),v=new WeakMap;class S{constructor(e){this.DetectRTC=window.DetectRTC,this.settingsService=n.SettingsService.getInstance(),this.xmppService=s.XmppService.getInstance(),this.contactService=l.ContactService.getInstance(),this.webrtcConfigAndUtils=d.WebrtcConfigAndUtils.getInstance(),this.webrtcP2PService=h.WebrtcP2PService.getInstance(),this.conversationService=f.ConversationService.getInstance(),this.webrtcP2PRecordingService=p.WebrtcP2PRecordingService.getInstance(),this.webrtcGatewayService=g.WebrtcGatewayService.getInstance(),this.rainbowLogger=m.LoggerService.getInstance(),this.RAINBOW_ONWEBRTCCALLSTATECHANGED="rainbowonwebrtccallstatechanged",this.RAINBOW_ONWEBRTCMEDIADEVICECHANGED="rainbowonwebrtcmediadevicechanged",this.RAINBOW_ONWEBRTCERRORHANDLED="rainbowonwebrtcerrorhandled",this.RAINBOW_ONWEBRTCSTREAMADDED="rainbowonwebrtcstreamadded",this.RAINBOW_ONWEBRTCTRACKCHANGED="rainbowonwebrtctrackchanged",this.RAINBOW_ONCHROMESTOPSCREENSHARINGTRIGGERED="rainbowonchromestopscreensharingtriggered",this.RAINBOW_ONWEBRTCTMEDIAERROROCCURED="rainbowonwebrtcmediaerroroccured",this.RAINBOW_ONWEBRTCTRECORDSTARTED="rainbowonwebrtcrecordstarted",this.RAINBOW_ONWEBRTCTRECORDSTOPPED="rainbowonwebrtcrecordstopped",this.RAINBOW_ONWEBRTCTRECORDPAUSED="rainbowonwebrtcrecordpaused",this.RAINBOW_ONWEBRTCTRECORDREMOTESTARTED="rainbowonwebrtcrecordremotestarted",this.RAINBOW_ONWEBRTCTRECORDREMOTESTOPPED="rainbowonwebrtcrecordremotestopped",this.RAINBOW_ONWEBRTCTRECORDDONE="rainbowonwebrtcrecorddone",this.RAINBOW_ONWEBRTCTRECORDERROR="rainbowonwebrtcrecorderror",v.set(this,e),e.$on("$destroy",e.$on("ON_CALL_UPDATED_EVENT",((e,t)=>this.onWebRTCCallChanged(e,t)))),e.$on("$destroy",e.$on("ON_WEBRTC_CALL_ERROR_EVENT",((e,t)=>this.onWebRTCErrorHandled(e,t)))),e.$on("$destroy",e.$on("ON_WEBRTC_REMOTE_STREAM_ADDED",((e,t)=>this.onWebRTCRemoteStreamAdded(e,t)))),e.$on("$destroy",e.$on("ON_WEBRTC_CALL_ESCALATION_SUCCESS",((e,t)=>this.onWebRTCEscalation(e,t)))),e.$on("$destroy",e.$on("ON_WEBRTC_CALL_ESCALATION",((e,t)=>this.onWebRTCEscalation(e,t)))),e.$on("$destroy",e.$on("ON_CHROME_STOP_SCREEN_SHARING_TRIGGERED",(()=>this.onChromeStopScreenSharingTrigerred()))),e.$on("$destroy",e.$on("ON_WEBRTC_RECORD_SAVED",((e,t,i,r)=>this.onWebRTCRecordingData(e,t,i,r)))),e.$on("$destroy",e.$on("ON_WEBRTC_RECORD_ERROR",(()=>this.onWebRTCRecordingError()))),e.$on("$destroy",e.$on("ON_RECORDING_START_MSG_RECEIVED",(()=>this.onWebRTCRecordingStartedByRemote()))),e.$on("$destroy",e.$on("ON_RECORDING_STOP_MSG_RECEIVED",(()=>this.onWebRTCRecordingStoppedByRemote())))}static get $inject(){return["$rootScope"]}onWebRTCCallChanged(e,t){t&&t.type.value===o.Call.Type.WEBRTC.value&&!this.webrtcGatewayService.isMediaPillarCallSituation(t)&&(r.sdkConfig.newModels?a.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCCALLSTATECHANGED,new u.CallSDK(t)):a.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCCALLSTATECHANGED,t),"active"===t.status.value&&this.webrtcP2PService.attachDistantMediaStreamsUnifiedPlan(t),"active"===t.status.value&&t.remoteMedia>1&&this.showRemoteVideo(t.id))}onWebRTCErrorHandled(e,t){a.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCERRORHANDLED,t)}onWebRTCRemoteStreamAdded(e,t){setTimeout((()=>{a.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCSTREAMADDED,t)}),100)}onWebRTCEscalation(e,t){setTimeout((()=>{r.sdkConfig.newModels?a.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCCALLSTATECHANGED,new u.CallSDK(t)):a.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCCALLSTATECHANGED,t),"active"===t.status.value&&t.remoteMedia>1&&this.showRemoteVideo(t.id)}),100)}onChromeStopScreenSharingTrigerred(){setTimeout((()=>{a.eventsService.dispatchEvent(this.RAINBOW_ONCHROMESTOPSCREENSHARINGTRIGGERED,null)}),100)}onWebRTCRecordingData(e,t,i,r){a.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCTRECORDDONE,[t,i,r])}onWebRTCRecordingError(){a.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCTRECORDERROR,null)}onWebRTCRecordingStartedByRemote(){a.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCTRECORDREMOTESTARTED,null)}onWebRTCRecordingStoppedByRemote(){a.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCTRECORDREMOTESTOPPED,null)}canMakeAudioVideoCall(){return("https:"===location.protocol||"chrome-extension:"===location.protocol)&&this.DetectRTC.isWebRTCSupported&&this.DetectRTC.isGetUserMediaSupported}hasAMicrophone(){return this.DetectRTC.hasMicrophone}hasACamera(){return this.DetectRTC.hasWebcam}async callInAudio(e,t){if(!e)return{code:c.SDK.ERRORBADREQUEST,label:"Parameter 'contactId' is missing or null"};if(!this.canMakeAudioVideoCall())return{code:c.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"};const i=await this.contactService.getContactByDBId(e);return this.webrtcP2PService.makeCall(i,"audio",t),{code:c.SDK.OK,label:"OK"}}async callInVideo(e,t){if(!e)return{code:c.SDK.ERRORBADREQUEST,label:"Parameter 'contactId' is missing or null"};if(!this.canMakeAudioVideoCall())return{code:c.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"};const i=await this.contactService.getContactByDBId(e);return this.webrtcP2PService.makeCall(i,"video",t),{code:c.SDK.OK,label:"OK"}}async callInSharing(e){if(e){if(navigator.userAgent.indexOf("Chrome")>-1){const t=await this.contactService.getContactByDBId(e),i=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return parseInt(i[2],10)>72?(this.webrtcP2PService.makeDesktopSharingCall(t,"sharingOnly"),{code:c.SDK.OK,label:"OK"}):(await this.canMakeDesktopSharingCall(),this.webrtcP2PService.makeDesktopSharingCall(t,"sharingOnly"),{code:c.SDK.OK,label:"OK"})}{const t=await this.contactService.getContactByDBId(e);return this.webrtcP2PService.makeDesktopSharingCall(t,"sharingOnly"),{code:c.SDK.OK,label:"OK"}}}throw new Error("Parameter 'contactId' is missing or null")}async callinAudioWithSharing(e){const t=navigator.userAgent;if(!e)return{code:c.SDK.ERRORBADREQUEST,label:"Parameter 'contactId' is missing or null"};if(t.indexOf("Chrome")>-1){const t=await this.contactService.getContactByDBId(e),i=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(parseInt(i[2],10)>72)return this.webrtcP2PService.makeDesktopSharingCall(t),{code:c.SDK.OK,label:"OK"};await this.canMakeDesktopSharingCall(),this.webrtcP2PService.makeDesktopSharingCall(t)}else{const t=await this.contactService.getContactByDBId(e);this.webrtcP2PService.makeDesktopSharingCall(t)}return{code:c.SDK.OK,label:"OK"}}answerInAudio(e){if(!e)return{code:c.SDK.ERRORBADREQUEST,label:"Parameter 'callId' is missing or null"};if(!this.canMakeAudioVideoCall())return{code:c.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"};const t=this.webrtcP2PService.getCallById(e);if(!t)throw new Error("Couldn't find a call with the following ID: "+e);return this.webrtcP2PService.answerCall(t,"audio"),{code:c.SDK.OK,label:"OK"}}answerInVideo(e){if(!e)throw new Error("Parameter callId is missing or empty");if(!this.canMakeAudioVideoCall())return{code:c.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"};const t=this.webrtcP2PService.getCallById(e);if(!t)throw new Error("Could not find a call with the following ID: "+e);return this.webrtcP2PService.answerCall(t,"video"),{code:c.SDK.OK,label:"OK"}}getPeerConnectionForCall(e){if(!e)throw new Error("Parameter 'callId' is missing or empty");return this.xmppService.connection.jingle.sessions[e].peerconnection}showLocalVideo(){return this.canMakeAudioVideoCall()?(this.webrtcP2PService.attachLocalMediaStreams(true),{code:c.SDK.OK,label:"OK"}):{code:c.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}}hideLocalVideo(){return this.canMakeAudioVideoCall()?(this.webrtcP2PService.attachLocalMediaStreams(false),{code:c.SDK.OK,label:"OK"}):{code:c.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}}showRemoteVideo(e){if(!e)throw new Error("Parameter 'callId' is missing or null");const t=this.webrtcP2PService.getCallById(e);if(!t)throw new Error("Couldn't find a call with the following ID: "+e);return this.canMakeAudioVideoCall()?(this.webrtcP2PService.attachDistantMediaStreams(true,t),{code:c.SDK.OK,label:"OK"}):{code:c.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}}hideRemoteVideo(e){if(!e)throw new Error("Parameter 'callId' is missing or null");const t=this.webrtcP2PService.getCallById(e);if(!t)throw new Error("Couldn't find a call with the following ID: "+e);return this.canMakeAudioVideoCall()?(this.webrtcP2PService.attachDistantMediaStreams(false,t),{code:c.SDK.OK,label:"OK"}):{code:c.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}}addVideoToCall(e){if(!e)throw new Error("Parameter 'callId' is missing or null");const t=this.webrtcP2PService.getCallById(e);if(!t)throw new Error("Couldn't find a call with the following ID: "+e);return this.canMakeAudioVideoCall()?(this.webrtcP2PService.addVideoToCall(t,false),{code:c.SDK.OK,label:"OK"}):{code:c.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}}async addSharingToCall(e){const t=navigator.userAgent;if(!e)throw new Error("Parameter 'callId' is missing or null");const i=this.webrtcP2PService.getCallById(e);if(!i)throw new Error("Couldn't find a call with the following ID: "+e);if(t.indexOf("Chrome")>-1){const e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return parseInt(e[2],10)>72?(this.webrtcP2PService.addSharingToCall(i),{code:c.SDK.OK,label:"OK"}):(await this.canMakeDesktopSharingCall(),this.webrtcP2PService.addSharingToCall(i),{code:c.SDK.OK,label:"OK"})}return this.webrtcP2PService.addSharingToCall(i),{code:c.SDK.OK,label:"OK"}}removeVideoFromCall(e){if(!e)throw new Error("Parameter 'callId' is missing or null");const t=this.webrtcP2PService.getCallById(e);if(!t)throw new Error("Couldn't find a call with the following ID: "+e);return this.canMakeAudioVideoCall()?(this.webrtcP2PService.removeVideoFromCall(t),{code:c.SDK.OK,label:"OK"}):{code:c.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"}}removeSharingFromCall(e){if(!e)throw new Error("Parameter 'callId' is missing or null");const t=this.webrtcP2PService.getCallById(e);if(!t)throw new Error("Couldn't find a call with the following ID: "+e);return this.webrtcP2PService.removeSharingFromCall(t),{code:c.SDK.OK,label:"OK"}}release(e){if(!e)throw new Error("Parameter 'callId' is missing or null");this.canMakeAudioVideoCall()||this.rainbowLogger.sdk(S.logService+"release called but WebRTC is not supported by your browser");const t=this.webrtcP2PService.getCallById(e);if(!t)throw new Error("Couldn't find a call with the following ID: "+e);return this.webrtcP2PService.rejectCall(t),{code:c.SDK.OK,label:"OK"}}muteAudioCall(e){if(!e)throw new Error("Parameter 'callId' is missing or null");const t=this.webrtcP2PService.getCallById(e);if(!t)throw new Error("Couldn't find a call with the following ID: "+e);const i=this.conversationService.getConversation(t.conversationId);if(!i)throw new Error("Couldn't find a conversation associated to the call with the following ID: "+e);if(!this.canMakeAudioVideoCall())return{code:c.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"};const n=this.webrtcP2PService.muteAudio(i,true);return r.sdkConfig.newModels?new u.CallSDK(n):n}unmuteAudioCall(e){if(!e)throw new Error("Parameter 'callId' is missing or null");const t=this.webrtcP2PService.getCallById(e);if(!t)throw new Error("Couldn't find a call with the following ID: "+e);const i=this.conversationService.getConversation(t.conversationId);if(!i)throw new Error("Couldn't find a conversation associated to the call with the following ID: "+e);if(!this.canMakeAudioVideoCall())return{code:c.SDK.ERRORUNSUPPORTED,label:"WebRTC is not supported by your browser"};const n=this.webrtcP2PService.muteAudio(i,false);return r.sdkConfig.newModels?new u.CallSDK(n):n}getLocalStreamsFromCall(e){if(!e)throw new Error("Parameter 'callId' is missing or null");const t=this.webrtcP2PService.getCallById(e);if(!t)throw new Error("Couldn't find a call with the following ID: "+e);if(t.type!==o.Call.Type.WEBRTC)throw new Error("This call is not a WebRTC audio or audio/video call");const i=this.xmppService.connection.jingle.sessions[e];return i?i.localStreams:[]}getRemoteStreamsFromCall(e){if(!e)throw new Error("Parameter 'callId' is missing or null");const t=this.webrtcP2PService.getCallById(e);if(!t)throw new Error("Couldn't find a call with the following ID: "+e);const i=this.xmppService.connection.jingle.sessions[t.id];return i?i.remoteStreamsObject:[]}getCallById(e){if(!e)throw new Error("Parameter 'callId' is missing or null");const t=this.webrtcP2PService.getCallById(e);return t?r.sdkConfig.newModels?new u.CallSDK(t):t:null}async canMakeDesktopSharingCall(){const e=navigator.userAgent;if(e.indexOf("Firefox")>-1)return{code:c.SDK.OK,label:"OK"};if(e.indexOf("Chrome")>-1){const e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(parseInt(e[2],10)>72)return{code:c.SDK.OK,label:"OK"}}throw new Error("Not Chrome Extension installed for desktop sharing")}startRecording(e,t,i,r,n,s){if(!e)throw new Error("Parameter 'callId' is missing or null");const o=this.webrtcP2PService.getCallById(e);if(!o)throw new Error("Couldn't find a call with the following ID: "+e);if(this.rainbowLogger.sdk(S.logService+"[startRecording] :: Enter"),!t)throw new Error("Parameter 'fileName' is missing or null");i=null==i||i,r=null==r||r,n=null!=n&&n,s=null==s?"video/webm;codecs=vp9":s,this.rainbowLogger.sdk(S.logService+"[startRecording] :: Prepare recording...");if(this.webrtcP2PRecordingService.createRecord(o.id,null,i?"REMOTE":"LOCAL",r,t,n,s)){this.webrtcP2PRecordingService.setOnPauseCallback((()=>{this.rainbowLogger.sdk(S.logService+"[onRTCChange] :: WebRTC recording paused"),a.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCTRECORDPAUSED,null)})),this.rainbowLogger.sdk(S.logService+"[startRecording] :: Start recording"),this.webrtcP2PRecordingService.startRecording();const e=this.conversationService.getConversation(o.conversationId);return e?(this.rainbowLogger.sdk(S.logService+"[startRecording] :: Notify remote peer"),this.conversationService.sendRecordingMessage(e,"start")):this.rainbowLogger.sdk(S.logService+"[startRecording] :: No conversation found - can't notify remote peer"),this.rainbowLogger.sdk(S.logService+"[startRecording] :: WebRTC recording started"),a.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCTRECORDSTARTED,null),{code:c.SDK.OK,label:"OK"}}return this.rainbowLogger.sdk(S.logService+"[startRecording] :: can't start a webRTC recording"),a.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCTRECORDERROR,null),{code:c.SDK.ERRORBADREQUEST,label:"Can't record the conversation"}}stopRecording(e){if(!e)throw new Error("Parameter 'callId' is missing or null");const t=this.webrtcP2PService.getCallById(e);if(!t)throw new Error("Couldn't find a call with the following ID: "+e);this.rainbowLogger.sdk(S.logService+"[stopRecording] :: Stop current WebRTC recording"),this.webrtcP2PRecordingService.setOnPauseCallback(null),this.webrtcP2PRecordingService.stopRecording();const i=this.conversationService.getConversation(t.conversationId);return i?(this.rainbowLogger.sdk(S.logService+"[stopRecording] :: Notify remote peer"),this.conversationService.sendRecordingMessage(i,"stop")):this.rainbowLogger.sdk(S.logService+"[stopRecording] :: No conversation found - can't notify remote peer"),a.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCTRECORDSTOPPED,null),{code:c.SDK.OK,label:"OK"}}}S.logService="WebRTCService | ",S.isChromeExtensionInstalled=false,t.WebRTCService=S},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(27),n=i(142),s=i(105),o=i(6),a=i(30),c=i(4),l=new WeakMap;class d{constructor(e){this.contactService=o.ContactService.getInstance(),this.roomService=a.RoomService.getInstance(),this.rainbowLogger=c.LoggerService.getInstance(),this.RAINBOW_ONBUBBLEINVITATIONTOJOINRECEIVED="rainbowbubblerequesttojoin",this.RAINBOW_ONBUBBLEUPDATED="rainbowbubbleupdated",this.RAINBOW_ONBUBBLEAVATARUPDATED="rainbowbubbleavatarupdated",this.RAINBOW_ONBUBBLEDEACTIVATED="rainbowonbubbledeactivated",l.set(this,e),e.$on("$destroy",e.$on(this.roomService.ROOM_UPDATE_EVENT,((e,t)=>this.onBubbleUpdatedEvent(e,t)))),e.$on("$destroy",e.$on(this.roomService.ROOM_AVATAR_UPDATE_EVENT,(()=>this.onAvatarUpdatedEvent()))),e.$on("$destroy",e.$on("ROOM_INVITATION",((e,t)=>this.onRoomInvitationEvent(e,t))))}static get $inject(){return["$rootScope"]}onBubbleUpdatedEvent(e,t){t&&false===t.isActive?r.eventsService.dispatchEvent(this.RAINBOW_ONBUBBLEDEACTIVATED,t):r.eventsService.dispatchEvent(this.RAINBOW_ONBUBBLEUPDATED,t)}onAvatarUpdatedEvent(){r.eventsService.dispatchEvent(this.RAINBOW_ONBUBBLEAVATARUPDATED,null)}onRoomInvitationEvent(e,t){r.eventsService.dispatchEvent(this.RAINBOW_ONBUBBLEINVITATIONTOJOINRECEIVED,t)}async createBubble(e,t,i=false,r=false,n=null,s=false){let o=null;const a=t||"",c=Boolean(i),l=Boolean(r),u=Boolean(s);if(!e)throw new Error("Parameter 'strName' is missing or empty");return o=await this.roomService.createRoom(e,a,c,n,l,false,false,u),this.rainbowLogger.sdk(d.logService+"[createBubble] :: New bubble "+e+" created successfully"),o}async deleteBubble(e){if(!(e=e&&e.dbId?this.roomService.getRoomById(e.dbId):null))throw new Error("Parameter 'bubble' is missing or null");const t=await this.closeBubble(e);return this.roomService.ownerDeleteRoom(t)}async deleteAllBubbles(){const e=s.PromiseQueue.create();this.roomService.getMyRooms().forEach((t=>{e.add((()=>this.deleteBubble(t)))}))}async inviteContactToBubble(e,t,i=false,r=true){if(t=t&&t.dbId?this.roomService.getRoomById(t.dbId):null,!e)throw new Error("Parameter 'contactId' is missing or null");if(!t)throw new Error("Parameter 'bubble' is missing or null");let s=n.Room.Privilege.USER;i&&(s=n.Room.Privilege.MODERATOR);let o=false;"boolean"==typeof r&&(o=!r);let a=false,c=false,l=false,d=false,u=false;t.users.forEach((t=>{if(t.contact.dbId===e)switch(t.status){case"invited":l=true;break;case"accepted":a=true;break;case"unsubscribed":c=true;break;case"rejected":d=true;break;case"deleted":u=true}}));const h=await this.contactService.getContactByDBId(e);if(a||l)throw new Error("Contact has been already invited or is already a member of the room");if(c||d){const e=await this.roomService.ownerReinviteRejectedUser(t,h,null,s,o);return e.updateAvatarInfo(),e}if(u){const e=await this.roomService.ownerReinviteDeletedUser(t,h,null,s);return e.updateAvatarInfo(),e}const f=await this.roomService.addRoomUser(t,h,null,s,o);return f.updateAvatarInfo(),f}async removeContactFromBubble(e,t){if(t=t&&t.dbId?this.roomService.getRoomById(t.dbId):null,!e)throw new Error("Parameter 'contactId' is missing or null");if(!t)throw new Error("Parameter 'bubble' is missing or is null");let i="";t.users.forEach((t=>{t.contact.dbId===e&&(i=t.status)}));const r=await this.contactService.getContactByDBId(e);switch(i){case this.roomService.RoomUserStatus.INVITED:{const e=await this.roomService.ownerDeletesUserFromRoom(t,r);return e.updateAvatarInfo(),e}case this.roomService.RoomUserStatus.ACCEPTED:{const e=await this.roomService.unsubscribeUserFromRoom(t,r);return e.updateAvatarInfo(),e}default:return t}}async promoteContactToModerator(e,t){if(t=t&&t.dbId?this.roomService.getRoomById(t.dbId):null,!e)throw new Error("Parameter 'contactId' is missing or null");if(!t)throw new Error("Parameter 'bubble' is missing or is null");const i=await this.contactService.getContactByDBId(e),r=await this.roomService.updateRoomUser(t,i,null,"moderator");return r.updateAvatarInfo(),r}async demoteContactFromModerator(e,t){if(t=t&&t.dbId?this.roomService.getRoomById(t.dbId):null,!e)throw new Error("Parameter 'contactId' is missing or null");if(!t)throw new Error("Parameter 'bubble' is missing or is null");const i=await this.contactService.getContactByDBId(e),r=await this.roomService.updateRoomUser(t,i,null,"user");return r.updateAvatarInfo(),r}async changeOwner(e,t){if(t=t&&t.dbId?this.roomService.getRoomById(t.dbId):null,!e)throw new Error("Parameter 'contactId' is missing or null");if(!t)throw new Error("Parameter 'bubble' is missing or is null");const i=await this.contactService.getContactByDBId(e),r=await this.roomService.changeRoomOwner(t,i);return r.updateAvatarInfo(),r}async acceptInvitationToJoinBubble(e){if(!(e=e&&e.dbId?this.roomService.getRoomById(e.dbId):null))throw new Error("Parameter 'bubble' is missing or null");return await this.roomService.acceptRoomInvitation(e),e}async declineInvitationToJoinBubble(e){if(!(e=e&&e.dbId?this.roomService.getRoomById(e.dbId):null))throw new Error("Parameter 'bubble' is missing or null");return await this.roomService.declineRoomInvitation(e)}async leaveBubble(e){if(!(e=e&&e.dbId?this.roomService.getRoomById(e.dbId):null))throw new Error("Parameter 'bubble' is missing or null");let t=false;if(e.users.forEach((e=>{this.contactService.isUserContact(e)||"moderator"===e.privilege&&"accepted"===e.status&&(t=true)})),!t)throw new Error("Can't leave the bubble. No other moderator");switch(e.status){case this.roomService.RoomUserStatus.UNSUBSCRIBED:return await this.roomService.participantCloseRoom(e);default:return await this.roomService.unsubscribeMeFromRoom(e)}}async closeBubble(e){if(!(e=e&&e.dbId?this.roomService.getRoomById(e.dbId):null))throw new Error("Parameter 'bubble' is missing or null");return this.isBubbleArchived(e)||await this.roomService.ownerArchiveRoom(e),e}isBubbleArchived(e){let t=true;return(e=e&&e.dbId?this.roomService.getRoomById(e.dbId):null)?e.status!==this.roomService.RoomUserStatus.UNSUBSCRIBED?t=false:e.users.forEach((e=>{e.status!==this.roomService.RoomUserStatus.UNSUBSCRIBED&&e.status!==this.roomService.RoomUserStatus.DELETED&&(t=false)})):t=false,t}getAllBubbles(){return this.roomService.getRooms()}getAllOwnedBubbles(){return this.roomService.getMyRooms()}getAllPendingBubbles(){return this.roomService.getRooms().filter((e=>"invited"===e.status))}getAllInactiveBubbles(){return this.roomService.getRooms().filter((e=>false===e.isActive))}getBubbleById(e){if(!e)throw new Error("Parameter 'strBubbleId' is missing or empty");return this.roomService.getRoomById(e)}async updateNameForBubble(e,t){if(t=t&&t.dbId?this.roomService.getRoomById(t.dbId):null,!e)throw new Error("Parameter 'strName' is missing or empty");if(!t)throw new Error("Parameter 'bubble' is missing or empty");return t.name=e,await this.roomService.ownerUpdateRoom(t)}async updateDescriptionForBubble(e,t){if(t=t&&t.dbId?this.roomService.getRoomById(t.dbId):null,!e)throw new Error("Parameter 'strDescription' is missing or empty");if(!t)throw new Error("Parameter 'bubble' is missing or empty");return t.desc=e,await this.roomService.ownerUpdateRoom(t)}async updateAvatarForBubble(e,t){if(t=t&&t.dbId?this.roomService.getRoomById(t.dbId):null,!e)throw new Error("Parameter 'urlAvatar' is missing or empty");if(!t)throw new Error("Parameter 'bubble' is missing or empty");return t.id=t.dbId,await this.roomService.setAvatarRoom(t,e)}async deleteAvatarFromBubble(e){if(!(e=e&&e.dbId?this.roomService.getRoomById(e.dbId):null))throw new Error("Parameter 'bubble' is missing or empty");await this.roomService.deleteAvatarRoom(e.dbId)}async updateCustomDataForBubble(e,t){if(t=t&&t.dbId?this.roomService.getRoomById(t.dbId):null,!e)throw new Error("Parameter 'customData' is missing or empty");if(!t)throw new Error("Parameter 'bubble' is missing or empty");t.customData=e;const i=await this.roomService.ownerUpdateRoomCustomData(t);return t.customData=i,t}async deleteCustomDataForBubble(e){if(!(e=e&&e.dbId?this.roomService.getRoomById(e.dbId):null))throw new Error("Parameter 'bubble' is missing or empty");e.customData={};const t=await this.roomService.ownerUpdateRoomCustomData(e);return e.customData=t,e}async getBubbleFromServer(e){if(!e||!e.dbId)throw new Error("Parameter 'bubble' missing or not correct");return await this.roomService.getServerRoom(e.dbId)}async createPublicUrl(e){if(!e)throw new Error("Parameter 'bubbleId' is missing or null");const t=e?this.roomService.getRoomById(e):null;if(!t)throw new Error("Cannot find a bubble with the given ID");return await this.roomService.bindOpenInviteIdToRoom(t),this.roomService.getOpenInviteIdLinkForRoom(e)}async retrievePublicUrl(e){if(e)throw new Error("Parameter 'bubbleId' is missing or empty");return await this.roomService.retrieveOpenInviteLinkForRoom(e)}async joinBubbleUsingPublicUrl(e){if(!e)throw new Error("Parameter 'publicUrl' is missing or empty");const t=this.getOpenInviteIdFromUrl(e);return await this.roomService.joinRoomUsingOpenInviteId(t)}async reactivateInactiveBubble(e){if(!e)throw new Error("Parameter 'bubbleId' is missing or empty");const t=this.roomService.getRoomById(e);if(!t)throw new Error("Bubble does not exist");return t.isActive?Promise.resolve():await this.roomService.sendInitialRoomPresenceSync(t)}getOpenInviteIdFromUrl(e){const t=e.split("/");if(0===t.length)throw new Error("Can not extract openInviteId from Public URL");return t[t.length-1]}}d.logService="BubblesService | ",t.BubblesService=d},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(38),n=i(27),s=i(6),o=i(14),a=i(30),c=i(34),l=new WeakMap,d=new WeakMap,u=new WeakMap;t.ConferencesService=class{constructor(e,t,i){this.confBubble=null,this.confBubbleType="",this.contactService=s.ContactService.getInstance(),this.profileService=o.ProfileService.getInstance(),this.roomService=a.RoomService.getInstance(),this.webrtcP2PService=c.WebrtcP2PService.getInstance(),this.RAINBOW_ONWEBCONFERENCEUPDATED="rainbowwebconferenceupdated",this.RAINBOW_ONWEBRTCMEDIAERROROCCURED="rainbowwebrtcmediaerroroccured",this.RAINBOW_ONBUBBLESHARINGCONFERENCESTARTED="rainbowbubblesharingconferencestarted",this.RAINBOW_ONBUBBLECONFERENCESTARTED="rainbowbubbleconferencestarted",this.RAINBOW_ONBUBBLECONFERENCETALKERACTIVE="rainbowonwebconferencetalkeractive",this.RAINBOW_ONWEBCONFERENCEDELEGATED="rainbowonwebconferencedelegated",l.set(this,e),d.set(this,t),u.set(this,i),i.$on("$destroy",i.$on("ON_CONFERENCE_UPDATED_EVENT",((e,t)=>this.onConferenceUpdated(e,t)))),i.$on("$destroy",i.$on("ON_WEBRTC_GETUSERMEDIA_ERROR",((e,t)=>this.onWebRtcGetUserMediaError(e,t)))),i.$on("$destroy",i.$on("ON_CONFERENCE_PARTICIPANT_EVENT",((e,t)=>this.onConferenceParticipantEvent(e,t)))),i.$on("$destroy",i.$on("ON_CONFERENCE_STARTED_INVITATION",((e,t)=>this.onConferenceStartedInvitation(e,t)))),i.$on("$destroy",i.$on("ON_WEBCONFERENCE_STARTED_INVITATION",((e,t)=>this.onConferenceStartedInvitation(e,t)))),i.$on("$destroy",i.$on("ON_CONFERENCE_TALKER_EVENT",((e,t)=>this.onConferenceTalkerEvent(e,t)))),i.$on("$destroy",i.$on("ON_CONFERENCE_DELEGATED_EVENT",((e,t,i)=>this.onWebConferenceDelegated(e,t,i))))}static get $inject(){return["conferenceService","webConferenceService","$rootScope"]}onConferenceUpdated(e,t){t&&n.eventsService.dispatchEvent(this.RAINBOW_ONWEBCONFERENCEUPDATED,t)}onWebRtcGetUserMediaError(e,t){n.eventsService.dispatchEvent(this.RAINBOW_ONWEBRTCMEDIAERROROCCURED,t)}onConferenceParticipantEvent(e,t){n.eventsService.dispatchEvent(this.RAINBOW_ONWEBCONFERENCEUPDATED,t)}onConferenceStartedInvitation(e,t){const i=t.confEndpoints;i&&i.forEach((e=>{"webrtc"===e.mediaType&&n.eventsService.dispatchEvent(this.RAINBOW_ONBUBBLECONFERENCESTARTED,t),"webrtcSharingOnly"===e.mediaType&&n.eventsService.dispatchEvent(this.RAINBOW_ONBUBBLESHARINGCONFERENCESTARTED,t)}))}onConferenceTalkerEvent(e,t){t&&n.eventsService.dispatchEvent(this.RAINBOW_ONBUBBLECONFERENCETALKERACTIVE,t)}onWebConferenceDelegated(e,t,i){const r={oldConferenceId:t,newConferenceId:i};n.eventsService.dispatchEvent(this.RAINBOW_ONWEBCONFERENCEDELEGATED,r)}isWebConferenceAllowed(){return this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.WEBRTC_CONFERENCE_ALLOWED)}hasActiveWebConferenceSession(){return d.get(this).hasActiveConferenceSession()}getWebConferenceBubble(){return d.get(this).getRelatedRoomToActiveConferenceSession()}setActiveSpeakerValue(e){return d.get(this).setActiveSpeakerValue(e),e}async startOrJoinWebConference(e){const t=d.get(this);if(!e)throw new Error("Parameter 'bubble' is missing or empty");if(this.hasActiveWebConferenceSession())throw new Error("Already in a conference");if(!e)throw new Error("Could not find the bubble");return e.confEndpoints.length&&await t.makeSnapshotForConfId(e.confEndpoints[0].confEndpointId,"webrtc",true),await t.bubbleStartOrJoinWebConference(e),this.confBubble=e,this.confBubbleType="webrtc",this.roomService.getRoomById(e.dbId)}async stopWebConference(){const e=d.get(this),t=l.get(this);if(this.confBubble=this.confBubble&&this.confBubble.dbId?this.roomService.getRoomById(this.confBubble.dbId):null,!this.hasActiveWebConferenceSession()||!this.confBubble)throw new Error("No known conference in a Bubble");let i="";i="webrtc"===this.confBubbleType?this.confBubble.getSFUConfEndpointId():this.confBubble.getSFUSharingConfEndpointId();const r=e.getConferenceSessionById(i),n=r?r.getParticipantByJid(this.contactService.userContact.jid):null;if("moderator"!==n.role)return await t.disconnectsParticipant(i,n.participantId,this.confBubbleType),this.confBubble=null,void(this.confBubbleType=null);await t.stopConference(i,"webrtc",this.confBubble.dbId),this.confBubble=null,this.confBubbleType=null}async muteConferenceAudio(e){const t=l.get(this),i=e.getConnectedParticipantByJid(this.contactService.userContact.jid).participantId;if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");if(!i)throw new Error("Couldn't retrieve participant ID - make sure the conference is active and you are connected");await t.updateParticipantState(e.id,i,"mute","webrtc")}async unmuteConferenceAudio(e){const t=l.get(this),i=e.getConnectedParticipantByJid(this.contactService.userContact.jid).participantId;if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");if(!i)throw new Error("Couldn't retrieve participant ID - make sure the conference is active and you are connected");await t.updateParticipantState(e.id,i,"unmute","webrtc")}async muteConferenceParticipant(e,t){const i=l.get(this);if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");if(!t)throw new Error("Parameter 'participantId' is missing or empty");await i.updateParticipantState(e.id,t,"mute","webrtc")}async unmuteConferenceParticipant(e,t){const i=l.get(this);if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");if(!t)throw new Error("Parameter 'participantId' is missing or empty");await i.updateParticipantState(e.id,t,"unmute","webrtc")}async muteAllConferenceParticipants(e){const t=l.get(this);if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");const i=e.participants;for(let r=0;r<i.length;r++)"moderator"!==i[r].role&&await t.updateParticipantState(e.id,i[r].participantId,"mute","webrtc")}async unmuteAllConferenceParticipants(e){const t=l.get(this);if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");const i=e.participants;for(let r=0;r<i.length;r++)"moderator"!==i[r].role&&await t.updateParticipantState(e.id,i[r].participantId,"unmute","webrtc")}addVideoToConference(e){const t=d.get(this);if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");return t.addMediaToConferenceSession(e,"video")}addSharingToConference(e){const t=d.get(this);if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");return t.addMediaToConferenceSession(e,"sharing")}removeVideoFromConference(e){const t=d.get(this);if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");return t.removeMediaFromConferenceSession(e,"video"),e}removeSharingFromConference(e){const t=d.get(this);if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");return t.removeMediaFromConferenceSession(e,"sharing"),e}showLocalVideo(e){const t=d.get(this);if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");return t.attachLocalMediaStream(true,e),t.isActiveSpeakerEnabled(),e}showRemoteVideo(e){const t=d.get(this);if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");return t.isActiveSpeakerEnabled()?t.attachGalleryMediaStreams(e):t.attachDistantMediaStream(true,e),e}getConferenceSessionById(e){const t=d.get(this);if(!e)throw new Error("Parameter 'conferenceId' is missing or empty");return t.getConferenceSessionById(e)}async updateGalleryPublisher(e,t,i){const r=d.get(this);if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");if(!t)throw new Error("Parameter 'galleryElementId' is missing or empty");if(!i)throw new Error("Parameter 'newPublisher' is missing or empty");if(r.getRelatedPublisherToElement(e.id,t))for(let n=0;n<e.videoGallery.length;n++)e.videoGallery[n].id===t&&(e.videoGallery[n].sessionId?r.dropRemoteVideoSession(e,e.videoGallery[n].sessionId):r.reInitialiseVideoGalleryElementById(e,t));await r.subscribeToPublisher(e.id,i,t)}removeGalleryPublisher(e,t){const i=d.get(this);if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");if(!t)throw new Error("Parameter 'galleryElementId' is missing or empty");return i.dropRemoteVideoSession(e,t),{code:r.SDK.OK,label:`Publisher from ${t} successfully removed`}}setVideoGalleryElementsNumber(e){return d.get(this).setVideoGalleryElementsNumber(e),e}removePipVideo(){return this.webrtcP2PService.removeConferencePip()}updateMainVideoSession(e,t){const i=d.get(this);if(e){if(t){i.updateMainScreenSession(e,t);const r=i.getConferenceSessionById(e);return i.attachDistantMediaStream(true,r),i.getConferenceSessionById(e)}throw new Error("Parameter 'sessionId' is missing or empty")}throw new Error("Parameter 'conferenceId' is missing or empty")}async disconnectParticipant(e,t,i="webrtc"){const r=l.get(this);if(!e)throw new Error("Parameter 'conferenceId' is missing or empty");if(!t)throw new Error("Parameter 'participantId' is missing or empty");await r.disconnectsParticipant(e,t,i)}getListOfAvailableRemoteVideoPublishers(e){const t=d.get(this);if(!e)throw new Error("Parameter 'conferenceSession' is missing or empty");const i={all:[],notActive:[]};return i.all=e.getListOfRemoteVideoPublishers(),i.notActive=t.getListOfAvailableRemoteVideoPublishers(e.id),i}async delegateConferenceToParticipant(e,t){const i=d.get(this);if(!e)throw new Error("Parameter 'conferenceId' is missing or empty");if(!t)throw new Error("Parameter 'participantId' is missing or empty");return await i.delegateConferenceToParticipant(e,t)}toggleAutoStreamQuality(e){return d.get(this).setDisableAutoUpdateSubstreamLevels(!e),e}getElementStreamQuality(e){const t=document.getElementById(e);if(t&&"video"===t.localName)return{height:t.videoHeight,width:t.videoWidth};throw new Error("Can not find the video stream attached to an element with the following ID: "+e)}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(27),n=i(319),s=i(38),o=i(6),a=i(318),c=i(4),l=new WeakMap;class d{constructor(e){this.contactService=o.ContactService.getInstance(),this.groupService=a.GroupService.getInstance(),this.rainbowLogger=c.LoggerService.getInstance(),this.RAINBOW_ONGROUPCREATED="rainbowgroupcreated",this.RAINBOW_ONGROUPUPDATED="rainbowgroupupdated",this.RAINBOW_ONGROUPDELETED="rainbowgroupdeleted",this.RAINBOW_ONGROUPUSERADDED="rainbowgroupuseradded",this.RAINBOW_ONGROUPUSERREMOVED="rainbowgroupuserdeleted",l.set(this,e),e.$on("$destroy",e.$on(this.groupService.ON_UPDATE_GROUP_EVENT,((e,t)=>this.onGroupUpdated(e,t)))),e.$on("$destroy",e.$on(this.groupService.ON_CREATED_GROUP_EVENT,((e,t)=>this.onGroupCreated(e,t)))),e.$on("$destroy",e.$on(this.groupService.ON_REMOVED_GROUP_EVENT,((e,t)=>this.onGroupDeleted(e,t)))),e.$on("$destroy",e.$on(this.groupService.ON_ADD_GROUP_USER_EVENT,((e,t,i)=>this.onGroupUserAdded(e,t,i)))),e.$on("$destroy",e.$on(this.groupService.ON_REMOVE_GROUP_USER_EVENT,((e,t,i)=>this.onGroupUserRemoved(e,t,i))))}static get $inject(){return["$rootScope"]}async onGroupUpdated(e,t){const i=await this.groupService.getGroup(t);r.eventsService.dispatchEvent(this.RAINBOW_ONGROUPUPDATED,i)}async onGroupCreated(e,t){const i=await this.groupService.getGroup(t);r.eventsService.dispatchEvent(this.RAINBOW_ONGROUPCREATED,i)}onGroupDeleted(e,t){r.eventsService.dispatchEvent(this.RAINBOW_ONGROUPDELETED,t)}async onGroupUserAdded(e,t,i){const n=await this.groupService.getGroup(t);r.eventsService.dispatchEvent(this.RAINBOW_ONGROUPUSERADDED,{group:n,userId:i})}async onGroupUserRemoved(e,t,i){const n=await this.groupService.getGroup(t);r.eventsService.dispatchEvent(this.RAINBOW_ONGROUPUSERREMOVED,{group:n,userId:i})}async createGroup(e,t,i){let r=null;const s=t||"";let o=false;if("boolean"==typeof i&&(o=i),!e)throw new Error("Parameter 'strName' is missing or empty");r=new n.Group(null,e,s,o);const a=await this.groupService.addGroup(r);return this.rainbowLogger.sdk(d.logService+"[createGroup] :: New group created successfully"),a}async deleteGroup(e){if(!e)throw new Error("Parameter 'group' is missing or empty");return await this.groupService.removeGroup(e.id),this.rainbowLogger.sdk(d.logService+"[deleteGroup] :: Group deleted successfully"),{code:s.SDK.OK,label:"OK"}}async deleteAllGroups(){const e=[],t=this.groupService.getGroups(),i=e=>this.groupService.removeGroup(e.id);return t.forEach((t=>{e.push(i(t))})),await Promise.all(e),this.rainbowLogger.sdk(d.logService+"[deleteAllGroups] :: All groups deleted successfully"),{code:s.SDK.OK,label:"OK"}}getAll(){return this.groupService.getGroups()}getFavoritesGroups(){return this.groupService.getGroups().filter((e=>e.isFavorite))}async setGroupAsFavorite(e){return e.isFavorite=true,await this.groupService.updateGroup(e),e}async unsetGroupAsFavorite(e){return e.isFavorite=false,await this.groupService.updateGroup(e),e}getGroupById(e){let t=null;return this.groupService.getGroups().some((i=>e===i.id&&(t=i,true))),t}async getDetailedGroupById(e){if(!e)throw new Error("Parameter 'id' is missing or empty");return await this.groupService.getGroup(e)}async addContactInGroup(e,t){if(!e)throw new Error("Parameter 'contactId' is missing or null");if(!t)throw new Error("Parameter 'group' is missing or null");const i=await this.contactService.getContactByDBId(e),r=await this.groupService.addGroupUser(t,i);return this.rainbowLogger.sdk(d.logService+"[addContactInGroup] :: Contact added successfully"),r}async removeContactFromGroup(e,t){if(!e)throw new Error("Parameter 'contact' is missing or null");if(!t)throw new Error("Parameter 'group' is missing or null");const i=await this.contactService.getContactByDBId(e);return this.groupService.removeGroupUser(t.id,i)}}d.logService="GroupService  | ",t.GroupsService=d},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(27),n=i(327),s=new WeakMap;t.CallsLogService=class{constructor(e){this.fetchingCallLogs=false,this.callLogService=n.CallLogService.getInstance(),this.RAINBOW_ONCALLLOGUPDATED="rainbowcalllogupdated",this.RAINBOW_ONCALLLOGACKUPDATED="rainbowcalllogackupdated",this.initialized=false,s.set(this,e),e.$on("$destroy",e.$on(this.callLogService.RAINBOW_ONCALLLOGUPDATED,(()=>this.onCallLogUpdated()))),e.$on("$destroy",e.$on(this.callLogService.RAINBOW_ONCALLLOGACKUPDATED,((e,t)=>this.onCallLogAckUpdated(e,t))))}static get $inject(){return["$rootScope"]}onCallLogUpdated(){this.fetchingCallLogs||r.eventsService.dispatchEvent(this.RAINBOW_ONCALLLOGUPDATED,null)}onCallLogAckUpdated(e,t){r.eventsService.dispatchEvent(this.RAINBOW_ONCALLLOGACKUPDATED,t)}async fetchCallLogs(e=100){e>250&&(e=250),this.fetchingCallLogs=true;const t=await this.callLogService.getSimplifiedCallLogs(e);return this.fetchingCallLogs=false,this.prettifyCallLogs(t)}async fetchPaginatedCallLogs(e=100){e>250&&(e=250),this.fetchingCallLogs=true;const t=await this.callLogService.fetchNextPage(e);return this.fetchingCallLogs=false,this.prettifyCallLogs(t)}prettifyCallLogs(e){e.sort(((e,t)=>Number(t.date)-Number(e.date)));for(let t=0;t<e.length;t++){let i=0,r=e[t].duration;if(r&&"string"==typeof r&&r.match(/^(?:(?:([01]?\d|2[0-3])H )?([0-5]?\d)m )?([0-5]?\ds)$/)){r=r.replace(/[hms]/g,"");const n=r.split(" ").reverse();for(let e=0;e<n.length;e++)i+=n[e]*Math.pow(60,e);e[t].duration=1e3*i}}return e}getMissedCallLogCounter(){return this.callLogService.getMissedCallLogCounter()}getMissedCallLogNumber(){return this.callLogService.getNumberMissedCallLogs()}deleteOneCallLog(e){return this.callLogService.deleteOneCallLog(e),true}deleteCallLogsForContact(e){return this.callLogService.deleteCallLogsForContact(e),true}deleteAllCallLogs(){this.callLogService.deleteAllCallLogs()}markCallLogAsRead(e){return this.callLogService.markCallLogAsRead(e)}markAllCallsLogsAsRead(){return this.callLogService.markAllCallsLogsAsRead()}isInitialized(){return this.callLogService.initialized}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(27),n=i(148),s=i(4);class o{constructor(){this.favoriteService=n.FavoriteService.getInstance(),this.rainbowLogger=s.LoggerService.getInstance(),this.RAINBOW_ONFAVORITECREATED="rainbowonfavoritecreated",this.RAINBOW_ONFAVORITEDELETED="rainbowonfavoritedeleted",window.addEventListener("ON_FAVORITE_CREATED",(e=>this.onFavoriteCreated(e))),window.addEventListener("ON_FAVORITE_DELETED",(e=>this.onFavoriteDeleted(e)))}onFavoriteCreated(e){r.eventsService.dispatchEvent(this.RAINBOW_ONFAVORITECREATED,e.detail)}onFavoriteDeleted(e){r.eventsService.dispatchEvent(this.RAINBOW_ONFAVORITEDELETED,e.detail)}async fetchAllFavorites(){const e=await this.favoriteService.getServerFavorites();return this.rainbowLogger.sdk(o.logService+"[fetchAllFavorites] :: Successfully fetched the Favorites"),e}async createFavorite(e,t){if(!e)throw new Error(o.logService+"[createFavorite] :: Error: parameter 'id' is missing or null. Needs to be an id of an user or a bubble");if(!t)throw new Error(o.logService+"[createFavorite] :: Error: parameter 'favoriteType' is missing or null");if("bubble"!==t&&"user"!==t)throw new Error(o.logService+'[createFavorite] :: Error: favoriteType should be set to "user" or "bubble"');"bubble"===t&&(t="room"),await this.favoriteService.addServerFavorite(e,t)}async deleteFavorite(e){if(!e)throw this.rainbowLogger.sdk(o.logService+"[deleteFavorite] :: Error: parameter 'id' is missing or null"),new Error(o.logService+"[deleteFavorite] :: Error: parameter 'id' is missing or null");return await this.favoriteService.removeServerFavorite(e)}}o.logService="FavoritesService | ",t.FavoritesService=o},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(27),n=i(6),s=i(37),o=i(62),a=i(95),c=i(47),l=i(4),d=new WeakMap;class u{constructor(e){this.contactService=n.ContactService.getInstance(),this.fileStorageService=s.FileStorageService.getInstance(),this.conversationService=o.ConversationService.getInstance(),this.fileServerService=c.FileServerService.getInstance(),this.rainbowLogger=l.LoggerService.getInstance(),this.RAINBOW_ONFILEUPLOADED_ERROR="rainbowfileuploadederror",this.RAINBOW_ONFILEDOWNLOADED="rainbowonfiledownloaded",this.RAINBOW_ONFILEDOWNLOADED_ERROR="rainbowfiledownloadederror",this.RAINBOW_ONCHUNKLOADMESSAGE="rainbowonchunkloadmessage",this.RAINBOW_ONFILEUPLOADED="rainbowfileuploaded",this.eventsMap={success:{download:this.RAINBOW_ONFILEDOWNLOADED,upload:this.RAINBOW_ONFILEUPLOADED},error:{download:this.RAINBOW_ONFILEDOWNLOADED_ERROR,upload:this.RAINBOW_ONFILEUPLOADED_ERROR}},d.set(this,e),e.$on("$destroy",e.$on("ON_FILE_TRANSFER_EVENT",((e,t)=>this.onFileTransferChanged(e,t))))}static get inject(){return["$rootScope"]}onFileTransferChanged(e,t){t.result&&t.type?(this.rainbowLogger.sdk(u.logService+"[onFileTransferChanged] ::  File transfered"),r.eventsService.dispatchEvent(this.eventsMap[t.result][t.type],t)):"uploading"!==(t=t.fileDesc).state&&"downloading"!==t.state||r.eventsService.dispatchEvent(this.RAINBOW_ONCHUNKLOADMESSAGE,t)}addFileToConversation(e,t,i){return new Promise((r=>{if("string"==typeof t){const n=new XMLHttpRequest;n.open("GET",t,true),n.onreadystatechange=()=>{if(n.readyState===XMLHttpRequest.DONE){const s=n.response,o=new File([s],t.replace(/^.*[\\/]/,""));this.conversationService.sendFSMessage(e,o,i).then((e=>r(e)))}},n.responseType="blob",n.send()}else this.conversationService.sendFSMessage(e,t,i).then((e=>r(e)))}))}async uploadFileToConversation(e,t,i){if(!e)throw new Error("Parameter 'conversationId' is missing or null");if(!t)throw new Error("Parameter 'file' is missing or null");const r=await this.conversationService.getConversation(e);if(r.type!==a.Conversation.Type.ONE_TO_ONE)throw new Error("Parameter 'conversation' is not a one-to-one conversation");this.rainbowLogger.sdk(u.logService+"[uploadFileToConversation] ::  Add file to the conversation "+r.id);return await this.addFileToConversation(r,t,i)}async uploadFile(e){if(!e)throw new Error("Parameter 'file' is missing or null");const t=await this.fileStorageService.createFileDescriptor(e,[],false);return await this.fileServerService.uploadAFileByChunk(t,e)}async uploadExistingFileToConversation(e,t,i=""){if(!e)throw new Error("Parameter 'conversation' is missing or null");if(!t)throw new Error("Parameter 'fileDescriptor' is missing or null");this.rainbowLogger.sdk(u.logService+"[uploadExistingFileToConversation] ::  Upload existing file to conversation "+e);const r=this.conversationService.getConversation(e);return await this.conversationService.sendEFSMessage(r,t,i)}async uploadFileToBubble(e,t,i){if(!e)throw new Error("Parameter 'bubble' is missing or null");if(!t)throw new Error("Parameter 'file' is missing or null");const r=this.conversationService.getConversation(e.dbId);if(!r)throw new Error("Parameter 'bubble' doesn't have a conversation");if(r.type!==a.Conversation.Type.ROOM)throw new Error("Conversation found is not a conversation of type 'room'. It might be a problem with a bubble.");this.rainbowLogger.sdk(u.logService+"[uploadFileToBubble] ::  Trying to add a file to the bubble "+e.dbId);return await this.addFileToConversation(r,t,i)}async downloadFile(e){if(!e)throw new Error("Parameter 'fileDescriptor' is missing or null");this.rainbowLogger.sdk(u.logService+"[downloadFile] ::  Trying to get a file");return await this.fileServerService.getBlobFromFileDescriptor(e,true)}async removeFile(e){if(!e)throw new Error("Parameter 'fileDescriptor' is missing or null");if(e.id||e.url){this.rainbowLogger.sdk(u.logService+"[removeFile] ::  Trying to remove a file");let t=e.id;if(!t){const i=e.url.split("/");t=i.pop()||i.pop()}return await this.fileStorageService.deleteFileDescriptor(t),void this.rainbowLogger.sdk(u.logService+"[removeFile] ::  File removed")}throw new Error("Parameter 'fileDescriptor' does not contain sufficient information to remove the file - no id or url property")}getFileDescriptorFromId(e){return this.rainbowLogger.sdk(u.logService+"[getFileDescriptorFromId] ::  Get file descriptor "+e),this.fileStorageService.getFileDescriptorById(e)}async getFileDescriptorUrl(e,t){return await this.fileServerService.getFileDescriptorUrl(e,t)}async getFilesReceivedInConversation(e){if(!e)throw new Error("Parameter 'conversationId' is missing or null");const t=await this.conversationService.getConversation(e);if(t.type!==a.Conversation.Type.ONE_TO_ONE)throw new Error("Parameter 'conversation' is not a one-to-one conversation");this.rainbowLogger.sdk(u.logService+"[getFilesReceivedInConversation] ::  Get files received in conversation "+t.id+"...");const i=await this.fileStorageService.retrieveFilesReceivedFromPeer(this.contactService.userContact.dbId,t.contact.dbId);return this.rainbowLogger.sdk(u.logService+"[getFilesReceivedInConversation] ::  Shared "+i.length),i}async getFilesReceivedInBubble(e){if(!e)throw new Error("Parameter 'bubble' is missing or null");this.rainbowLogger.sdk(u.logService+"[getFilesReceivedInBubble] ::  Get files received in bubble "+e.dbId);return await this.fileStorageService.retrieveReceivedFilesForRoom(e.dbId)}async getFilesSentInConversation(e){if(!e)throw new Error("Parameter 'conversationId' is missing or null");const t=await this.conversationService.getConversation(e);if(t.type!==a.Conversation.Type.ONE_TO_ONE)throw new Error("Parameter 'conversation' is not a one-to-one conversation");this.rainbowLogger.sdk(u.logService+"[getFilesSentInConversation] :: Get files sent in conversation "+t.id);return this.fileStorageService.retrieveSentFiles(t.contact.dbId)}async getFilesSentInBubble(e){if(!e)throw new Error("Parameter 'bubble' is missing or null");this.rainbowLogger.sdk(u.logService+"[getFilesSentInBubble] :: Get files sent in bubble "+e.dbId);return this.fileStorageService.retrieveSentFiles(e.dbId)}async getUserQuotaConsumption(){return this.fileStorageService.retrieveUserConsumption()}getAllFilesSent(){return this.fileStorageService.getDocuments("date",false)}getAllFilesReceived(){return this.fileStorageService.getDocuments("date",true)}async cancelCurrentFileTransfer(e){if(!e)throw new Error("Parameter 'id' is missing or null");const t=this.fileStorageService.getFileDescriptorById(e);if(null===t)throw new Error("Could not find a file with the id "+e);if("downloading"!==t.state&&"uploading"!==t.state)throw new Error("File Status is not set to 'downloading' or 'uploading'");return this.fileServerService.cancelCurrentFiletransfer(e),"not_uploaded"!==t.state&&"uploading"!==t.state?(t.state="uploaded",t):"not_uploaded"!==t.state&&"uploading"===t.state?(t.state="not_uploaded",t):t}}u.logService="FilesStorageService | ",t.FilesStorageService=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(14);t.CapabilitiesService=class{constructor(){this.profileService=r.ProfileService.getInstance()}getAll(){return this.profileService.getMyProfileFeatures()}getUserSubscription(){return this.profileService.getMyProfileName()}isFeatureEnabled(e){return this.profileService.isFeatureEnabled(e)}hasS4BExtensionEnabled(){return this.profileService.isFeatureEnabled("MS_SKYPE_PLUGIN")}hasOutlookExtensionEnabled(){return this.profileService.isFeatureEnabled("MS_OUTLOOK_PLUGIN")}hasCalendarPresenceEnabled(){return this.profileService.isFeatureEnabled("MSO365_CALENDAR_PRESENCE")}hasTelephonyBasicCallEnabled(){return this.profileService.isFeatureEnabled("TELEPHONY_BASIC_CALL")}hasTelephonySecondCallEnabled(){return this.profileService.isFeatureEnabled("TELEPHONY_SECOND_CALL")}hasTelephonyTransferCallEnabled(){return this.profileService.isFeatureEnabled("TELEPHONY_TRANSFER_CALL")}hasTelephonyConferenceCallEnabled(){return this.profileService.isFeatureEnabled("TELEPHONY_CONFERENCE_CALL")}hasTelephonyDeflectCallEnabled(){return this.profileService.isFeatureEnabled("TELEPHONY_DEFLECT_CALL")}hasTelephonyForwardCallEnabled(){return this.profileService.isFeatureEnabled("TELEPHONY_FORWARD_CALL")}hasTelephonyPhoneBookEnabled(){return this.profileService.isFeatureEnabled("TELEPHONY_PHONE_BOOK")}hasTelephonyVoiceMailEnabled(){return this.profileService.isFeatureEnabled("TELEPHONY_VOICE_MAIL")}hasWebRTCAudioMobileEnabled(){return this.profileService.isFeatureEnabled("WEBRTC_FOR_MOBILE")}hasWebRTCVideoMobileEnabled(){return this.profileService.isFeatureEnabled("WEBRTC_FOR_MOBILE_VIDEO")}hasBridgeConferenceEnabled(){return this.profileService.isFeatureEnabled("CONFERENCE_ALLOWED")}hasBridgeConferenceRecordEnabled(){return this.profileService.isFeatureEnabled("CONFERENCE_RECORDING")}hasBridgeConferenceDialOutEnabled(){return this.profileService.isFeatureEnabled("CONFERENCE_DIAL_OUT")}maxParticipantsPerBubbleAllowed(){return this.profileService.getFeatureLimitMax("BUBBLE_PARTICIPANT_COUNT")}maxParticipantsPerBridgeConferenceAllowed(){return this.profileService.getFeatureLimitMax("CONFERENCE_PARTICIPANT_COUNT")}maxFileStorageQuotaAllowed(){return this.profileService.getFeatureLimitMax("FILE_SHARING_QUOTA_GB")}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=new WeakMap,n=new WeakMap,s=new WeakMap,o=i(24);t.SdkAdminService=class{constructor(e,t,i){this.logService="SdkAdminService | ",r.set(this,e),n.set(this,t),s.set(this,i)}static get $inject(){return["User","adminCompanyService","adminUserService"]}async createEssentialCompany(e,t){const i=n.get(this),r=o.Company.create(null,"");return r.name=e,r.country=t,await i.createCompanyEndUser(r)}async createCompany(e,t,i){const r=n.get(this),s=o.Company.create(null,"");return s.name=e,s.country=t,i&&(s.state=i),s.economicActivityClassification="",await r.createCompany(s)}async removeCompany(e){const t=n.get(this);return await t.deleteCompany(e)}async removeCompanyDeprecated(e){const t=n.get(this);return await t.deleteCompany(e.id)}async createUserForCompany(e,t,i,n,o,a){const c=r.get(this),l=s.get(this),d=c.create();d.loginEmail=e,d.firstName=t,d.lastName=i,d.password=n,d.language="en",d.companyId=o,d.adminType="undefined",d.isActive=true,d.isInitialized=true,a&&(d.tags=a&&Array.isArray(a)?a:[a]);return await l.createUser(d)}async createUserForCompanyDeprecated(e,t,i,n,o,a){const c=r.get(this),l=s.get(this),d=c.create();d.loginEmail=e,d.firstName=t,d.lastName=i,d.password=n,d.language="en",d.companyId=o,d.adminType="undefined",d.isActive=true,d.isInitialized=true,a&&(d.tags=a&&Array.isArray(a)?a:[a]);return await l.createUser(d)}async removeUserFromCompany(e){const t=s.get(this);return await t.deleteUser(e)}async fetchUsersByPattern(e,t=1,i=10){const r=s.get(this);return await r.getUsers(null,t,i,e,false,null,false)}async fetchUsersByTag(e,t=1,i=10){const r=s.get(this);return await r.getUsers(null,t,i,"",false,null,false,e)}async updateUserTags(e,t){const i=s.get(this);if(!e)throw new Error(this.logService+"[updateUserTags] :: Error: parameter 'user' is missing or null");if(!e.id)throw new Error(this.logService+"[updateUserTags] :: Error: parameter 'user.id' is missing or null");if(t instanceof Array!=true)throw new Error(this.logService+"[updateUserTags] :: Error: parameter 'tags' must be an array");if(t instanceof Array&&(t.length<1||t.length>5))throw new Error(this.logService+"[updateUserTags] :: Error: parameter 'tags' must be an array with at least 1 and maximum 5 elements");return e.tags=t,await i.updateUser(e)}async setVisibilityForCompany(e,t){const i=n.get(this);return await i.addVisibility(e.id,t.id)}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(27),n=i(38),s=i(39),o=i(484),a=i(6),c=i(320),l=i(4),d=new WeakMap;class u{constructor(e){this.contactService=a.ContactService.getInstance(),this.channelService=c.ChannelService.getInstance(),this.rainbowLogger=l.LoggerService.getInstance(),this.RAINBOW_ONCHANNELUPDATED="rainbowchannelupdate",this.RAINBOW_ONCHANNELMESSAGERECEIVED="rainbowchannelmessagereceived",this.RAINBOW_ONCHANNELRETRACTMESSAGERECEIVED="rainbowchannelretractmessage",this.RAINBOW_ONCHANNELDELETED="rainbowchanneldeleted",this.RAINBOW_ONCHANNELAVATARUPDATED="rainbowchannelavatarupdate",this.RAINBOW_ONCHANNELUSERSUBSCRIBED="rainbowchannelusersubscribed",this.RAINBOW_ONCHANNELUSERUNSUBSCRIBED="rainbowchanneluserunsubscribed",d.set(this,e),this.channelService.subscribe((e=>{"CHANNEL_USERS_UPDATE_EVENT"===e.name&&this.onChannelUsersUpdated(e.data.channelId,e.data.users),"CHANNEL_MESSAGE_RECEIVED"===e.name&&this.onMessageReceived(e.data.action,e.data.message)})),e.$on("$destroy",e.$on("CHANNEL_UPDATE_EVENT",((e,t,i)=>this.onChannelUpdated(e,t,i)))),e.$on("$destroy",e.$on("ON_UPDATE_CHANNEL_AVATAR",((e,t)=>this.onChannelAvatarUpdated(e,t)))),e.$on("$destroy",e.$on("CHANNEL_USER_SUBSCRIPTION_EVENT",((e,t,i,r)=>this.onUserSubscriptionChange(e,t,i,r))))}static get $inject(){return["$rootScope"]}onMessageReceived(e,t){const i=t&&t.channelId?t.channelId:t;this.rainbowLogger.sdk(u.logService+"[ChannelsService] :: EVENT onMessageReceived"),this.fetchChannel(i).then((i=>{0===e?r.eventsService.dispatchEvent(this.RAINBOW_ONCHANNELMESSAGERECEIVED,t):(this.rainbowLogger.sdk(u.logService+"[ChannelsService] :: EVENT onMessageReceived - retracted message"),r.eventsService.dispatchEvent(this.RAINBOW_ONCHANNELRETRACTMESSAGERECEIVED,{channel:i,message:t}))}))}onChannelUpdated(e,t,i){this.rainbowLogger.sdk(u.logService+"[ChannelsService] :: EVENT: onChannelUpdated("+t+") id:"+i),3!==t?this.fetchChannel(i).then((e=>{r.eventsService.dispatchEvent(this.RAINBOW_ONCHANNELUPDATED,{channel:e,updateType:t})})):r.eventsService.dispatchEvent(this.RAINBOW_ONCHANNELDELETED,i)}onChannelUsersUpdated(e,t){this.rainbowLogger.sdk(u.logService+"[ChannelsService] :: EVENT onChannelUsersUpdated:"+e),this.fetchChannel(e).then((e=>{r.eventsService.dispatchEvent(this.RAINBOW_ONCHANNELUPDATED,{channel:e,users:t})}))}onChannelAvatarUpdated(e,t){this.fetchChannel(t).then((e=>{this.rainbowLogger.sdk(u.logService+"[ChannelsService] :: EVENT onChannelAvatarUpdated"+e.id),r.eventsService.dispatchEvent(this.RAINBOW_ONCHANNELAVATARUPDATED,e)}))}onUserSubscriptionChange(e,t,i,n){let s=null;this.fetchChannel(i).then((e=>(s=e,this.contactService.getContactByDBId(n,true)))).then((e=>{e=e||n,4===t?(this.rainbowLogger.sdk(u.logService+"[ChannelsService] :: EVENT onUserSubscriptionChange: user subscribed to a channel: "+i),r.eventsService.dispatchEvent(this.RAINBOW_ONCHANNELUSERSUBSCRIBED,{channel:s,user:e})):(this.rainbowLogger.sdk(u.logService+"[ChannelsService] :: EVENT onUserSubscriptionChange: user unsubscribed from a channel: "+i),r.eventsService.dispatchEvent(this.RAINBOW_ONCHANNELUSERUNSUBSCRIBED,{channel:s,user:e}))}))}async fetchMyChannels(){const e=await this.channelService.getMyChannels();return s.sdkConfig.newModels?e.map((e=>new o.ChannelSDK(e))):await this.channelService.getMyChannels()}async createPublicChannel(e,t="",i=""){if(this.rainbowLogger.sdk(u.logService+"[createPublicChannel] :: Trying to create a new public channel"),!e)throw new Error("Parameter 'channelName' is missing or empty");const r=await this.channelService.createChannel(e,"company_public",t,i,false);return this.rainbowLogger.sdk(u.logService+"[createPublicChannel] :: Public Channel created: "+r.id),s.sdkConfig.newModels?new o.ChannelSDK(r):r}async createClosedChannel(e,t="",i=""){if(this.rainbowLogger.sdk(u.logService+"[createClosedChannel] :: Trying to create a new closed channel"),!e)throw new Error("Parameter 'channelName' is missing or empty");const r=await this.channelService.createChannel(e,"company_closed",t,i,false);return this.rainbowLogger.sdk(u.logService+"[createClosedChannel] :: created: "+r.id),s.sdkConfig.newModels?new o.ChannelSDK(r):r}async deleteChannel(e){if(this.rainbowLogger.sdk(u.logService+"[deleteChannel] :: Trying to delete a channel"),!e)throw new Error("Parameter 'id' is missing or empty");return await this.channelService.deleteChannel(e),this.rainbowLogger.sdk(u.logService+"[deleteChannel] :: deleted: "+e),{code:n.SDK.OK,label:"OK"}}async fetchChannelsByName(e){if(this.rainbowLogger.sdk(u.logService+"[fetchChannelsByName] :: Trying to fetch channels by name"),!e)throw new Error("Parameter 'name' is missing or empty");const t={};t.name=e;const i=await this.channelService.findChannels(t);return this.rainbowLogger.sdk(u.logService+"[fetchChannelsByName] :: fetched: "+i.length),s.sdkConfig.newModels?i.map((e=>new o.ChannelSDK(e))):i}async fetchChannelsByTopic(e){if(this.rainbowLogger.sdk(u.logService+"[fetchChannelsByTopic] :: Trying to fetch channels by topic"),!e)throw new Error("Parameter 'topic' is missing or empty");const t={};t.topic=e;const i=await this.channelService.findChannels(t);return this.rainbowLogger.sdk(u.logService+"[fetchChannelsByTopic] :: fetched: "+i.length),s.sdkConfig.newModels?i.map((e=>new o.ChannelSDK(e))):i}async fetchChannelsByCategory(e){if(this.rainbowLogger.sdk(u.logService+"[fetchChannelsByCategory] :: Trying to fetch channels by category"),!e)throw new Error("Parameter 'category' is missing or empty");const t={};t.category=e;const i=await this.channelService.findChannels(t);return this.rainbowLogger.sdk(u.logService+"[fetchChannelsByCategory] :: fetched: "+i.length),s.sdkConfig.newModels?i.map((e=>new o.ChannelSDK(e))):i}async fetchChannel(e){if(this.rainbowLogger.sdk(u.logService+"[fetchChannel] :: Trying to fetch a channel..."),!e)throw new Error("Parameter 'id' is missing or empty");const t=await this.channelService.getChannel(e);return this.rainbowLogger.sdk(u.logService+"[fetchChannel] :: fetched: "+t.id),s.sdkConfig.newModels?new o.ChannelSDK(t):t}async createItem(e,t,i,r){if(this.rainbowLogger.sdk(u.logService+"[createItem] :: Trying to create item"),!e)throw new Error("Parmeter 'channelId' is missing or empty");if(!t)throw new Error("Parmeter 'message' is missing or empty");if(r&&-1===["basic","markdown","html","data"].indexOf(r))throw new Error("Parameter 'itemType' could be 'basic', 'markdown', 'html' or 'data'");return i=i||"",r=r?"urn:xmpp:channels:"+r:"urn:xmpp:channels:basic",await this.channelService.publishToChannel(e,null,r,t,i,null,null,null),this.rainbowLogger.sdk(u.logService+"[createItem] :: created: "+e),{code:n.SDK.OK,label:"OK"}}async subscribeToChannelById(e){if(this.rainbowLogger.sdk(u.logService+"[subscribeToChannelById] :: Trying to subscribe to a channel..."),!e)throw new Error("Parameter 'id' is missing or null");const t=this.channelService.getChannelFromCache(e);if(t)await this.channelService.subscribeToChannel(t),this.rainbowLogger.sdk(u.logService+"[subscribeToChannelById] :: subscribed: "+e);else{const t=await this.channelService.getChannel(e);if(!t)return{code:n.SDK.ERRORBADREQUEST,label:"No channel found with id "+e};await this.channelService.subscribeToChannel(t),this.rainbowLogger.sdk(u.logService+"[subscribeToChannelById] :: subscribed: "+e)}return{code:n.SDK.OK,label:"OK"}}async subscribeToChannel(e){if(this.rainbowLogger.sdk(u.logService+"[subscribeToChannel] :: Trying to subscribe to a channel..."),!e)throw new Error("Paameter 'channel' is missing or null");await this.channelService.subscribeToChannel(e)}async unsubscribeFromChannelById(e){if(this.rainbowLogger.sdk(u.logService+"[unsubscribeFromChannelById] :: Trying to unsubscribe from a channel..."),!e)throw new Error("Parameter 'id' is missing or empty");const t=this.channelService.getChannelFromCache(e);if(t)await this.channelService.unsubscribeToChannel(t),this.rainbowLogger.sdk(u.logService+"[unsubscribeFromChannelById] :: unsubscribed: "+e);else{const t=await this.channelService.getChannel(e);if(!t)return{code:n.SDK.ERRORBADREQUEST,label:"No channel found with id "+e};await this.channelService.unsubscribeToChannel(t),this.rainbowLogger.sdk(u.logService+"[unsubscribeFromChannelById] :: unsubscribed: "+e)}return{code:n.SDK.OK,label:"OK"}}async unsubscribeFromChannel(e){if(this.rainbowLogger.sdk(u.logService+"[unsubscribeFromChannel] :: Trying to unsubscribe from a channel..."),!e)throw new Error("Parameter 'channel' is missing or null");return await this.channelService.unsubscribeToChannel(e),this.rainbowLogger.sdk(u.logService+"[unsubscribeFromChannel] :: unsubscribed: "+e.id),{code:n.SDK.OK,label:"OK"}}async updateChannel(e,t="",i="public",r=30,n=6e4,s=null,o=""){if(this.rainbowLogger.sdk(u.logService+"[updateChannel] :: Trying to update a channel..."),!e)throw new Error("Parameter 'id' is missing or empty");const a={};null!==t&&(a.topic=t),null!==i&&(a.mode="company"===i?"company_public":"company_closed"),null!==r&&(a.maxItems=r),null!==n&&(a.maxPayloadSize=n),null!==s&&(a.name=s),null!==o&&(a.cateogry=o);const c=await this.channelService.updateChannel(e,a);return c.visibility=a.visibility,this.rainbowLogger.sdk(u.logService+"[updateChannel] :: updated: "+e),c}async updateChannelVisibility(e,t){if(this.rainbowLogger.sdk(u.logService+"[updateChannelVisibility] :: Trying to update visibility of a channel..."),!e)throw new Error("Parameter 'id' is missing or empty");if(!t)throw new Error("Parameter 'visibility' is missing or empty");const i={};null!==t&&(i.mode="company"===t?"company_public":"company_closed");const r=await this.channelService.updateChannel(e,i);return this.rainbowLogger.sdk(u.logService+"[updateChannelVisibility] :: updated: "+e),s.sdkConfig.newModels?new o.ChannelSDK(r):r}async updateChannelVisibilityToPublic(e){if(this.rainbowLogger.sdk(u.logService+"[updateChannelVisibilityToPublic] :: Trying to update visibility to visible for a channel"),!e)throw new Error("Parameter 'id' is missing or empty");const t=await this.channelService.updateChannel(e,{mode:"company_public"});return this.rainbowLogger.sdk(u.logService+"[updateChannelVisibilityToPublic] :: updated: "+e),s.sdkConfig.newModels?new o.ChannelSDK(t):t}async updateChannelVisibilityToClosed(e){if(this.rainbowLogger.sdk(u.logService+"[updateChannelVisibilityToPublic] :: Trying to update visibility to visible for a channel"),!e)throw new Error("Parameter 'id' is missing or empty");const t=await this.channelService.updateChannel(e,{mode:"company_closed"});return this.rainbowLogger.sdk(u.logService+"[updateChannelVisibilityToPublic] :: updated: "+e),s.sdkConfig.newModels?new o.ChannelSDK(t):t}async updateChannelName(e,t){if(this.rainbowLogger.sdk(u.logService+"[updateChannelName] :: Trying to update the name of a channel"),!e)throw new Error("Parameter 'id' is missing or empty");const i={};null!==t&&(i.name=t);const r=await this.channelService.updateChannel(e,i);return this.rainbowLogger.sdk(u.logService+"[updateChannelName] :: updated: "+e),s.sdkConfig.newModels?new o.ChannelSDK(r):r}async updateChannelTopic(e,t){if(this.rainbowLogger.sdk(u.logService+"[updateChannelTopic] :: Try to update the topic of a channel"),!e)throw new Error("Parameter 'id' is missing or empty");const i={};null!==t&&(i.topic=t);const r=await this.channelService.updateChannel(e,i);return this.rainbowLogger.sdk(u.logService+"[updateChannelTopic] :: updated: "+e),s.sdkConfig.newModels?new o.ChannelSDK(r):r}async updateChannelCategory(e,t){if(this.rainbowLogger.sdk(u.logService+"[updateChannelCategory] :: Try to update the category of a channel"),!e)throw new Error("Parameter 'id' is missing or empty");const i={};null!==t&&(i.category=t);const r=await this.channelService.updateChannel(e,i);return this.rainbowLogger.sdk(u.logService+"[updateChannelCategory] :: updated: "+e),s.sdkConfig.newModels?new o.ChannelSDK(r):r}async updateChannelAvatar(e,t){if(this.rainbowLogger.sdk(u.logService+"[updateChannelAvatar] :: Try to update the avatar of a channel"),!e)throw new Error("Parameter 'id' is missing or empty");if(!t)throw new Error("Parameter 'urlAvatar' is missing or empty");const i=await this.fetchChannel(e);return this.channelService.uploadChannelAvatar(i,t,512),this.rainbowLogger.sdk(u.logService+"[updateChannelAvatar] :: updated: "+i.id),{code:n.SDK.OK,label:"OK"}}async deleteChannelAvatar(e){if(this.rainbowLogger.sdk(u.logService+"[deleteChannelAvatar] :: Try to delete the avatar of a channel"),!e)throw new Error("Parameter 'id' is missing or empty");const t=await this.fetchChannel(e);return this.channelService.deleteChannelAvatar(t),this.rainbowLogger.sdk(u.logService+"[deleteChannelAvatar] :: updated: "+e),{code:n.SDK.OK,label:"OK"}}async fetchUsers(e,t){if(this.rainbowLogger.sdk(u.logService+"[fetchUsers] :: Trying to fetch users of a channel"),!e)throw new Error("Parameter 'id' is missing or empty");return(await this.channelService.getChannelUsers(e,t)).data}async deleteAllUsersFromChannel(e){if(this.rainbowLogger.sdk(u.logService+"[deleteAllUsersFromChannel] :: Trying to get delete all users of a channel..."),!e)throw new Error("Parameter 'id' is missing or empty");await this.channelService.removeAllUsersFromChannel(e);const t=await this.channelService.getChannel(e);return this.rainbowLogger.sdk(u.logService+"[deleteAllUsersFromChannel] :: deleted: "+e),s.sdkConfig.newModels?new o.ChannelSDK(t):t}async updateChannelUsers(e,t,i="member"){if(this.rainbowLogger.sdk(u.logService+"[updateChannelUsers] :: Trying to update users of a channel"),!e)throw new Error("Parameter 'id' is missing or empty");const r=await this.channelService.updateChannelUsers(e,t,i);return this.rainbowLogger.sdk(u.logService+"[updateChannelUsers] :: updated: "+e),r}async addMembersToChannel(e,t){if(this.rainbowLogger.sdk(u.logService+"[addMembersToChannel] :: Trying to add members to a channel"),!e)throw new Error("Parameter 'id' is missing or empty");const i=await this.channelService.updateChannelUsers(e,t,"member");return this.rainbowLogger.sdk(u.logService+"[addMembersToChannel] :: added: "+e),i}async addPublishersToChannel(e,t){if(this.rainbowLogger.sdk(u.logService+"[addPublishersToChannel] :: Trying to add publishers to a channel"),!e)throw new Error("Parameter 'id' is missing or empty");const i=await this.channelService.updateChannelUsers(e,t,"publisher");return this.rainbowLogger.sdk(u.logService+"[addPublishersToChannel] :: added: "+e),i}async addOwnersToChannel(e,t){if(this.rainbowLogger.sdk(u.logService+"[addOwnersToChannel] :: Trying to add owners to a channel"),!e)throw new Error("Parameter 'id' is missing or empty");const i=await this.channelService.updateChannelUsers(e,t,"owner");return this.rainbowLogger.sdk(u.logService+"[addOwnersToChannel] :: added: "+e),i}async deleteUsersFromChannel(e,t){if(this.rainbowLogger.sdk(u.logService+"[deleteUsersFromChannel] :: Trying to delete users from a channel"),!e)throw new Error("Parameter 'id' is missing or empty");const i=await this.channelService.updateChannelUsers(e,t,"none");return this.rainbowLogger.sdk(u.logService+"[deleteUsersFromChannel] :: deleted: "+e),i}async fetchItems(e,t=10,i,r){if(this.rainbowLogger.sdk(u.logService+"[fetchItems] :: Try to fetch items of a channel"),!e)throw new Error("Parameter 'id' is missing or empty");const n=this.channelService.getChannelItems(e,t,i,r);return this.rainbowLogger.sdk(u.logService+"[fetchItems] :: fetched: "+e),n}async deleteItem(e,t){if(this.rainbowLogger.sdk(u.logService+"[deleteItem] :: Trying to delete an item."),!e)throw new Error("Parameter 'id' is missing or empty");if(!t)throw new Error("Parameter 'itemId' is missing or empty");await this.channelService.deleteChannelItem(e,t),this.rainbowLogger.sdk(u.logService+"[deleteItem] :: Item deleted: "+t)}}u.logService="ChannelsService | ",t.ChannelsService=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(27),n=i(19),s=i(317),o=i(39),a=i(96),c=i(56),l=i(67),d=i(485),u=i(4),h=i(486),f=new WeakMap,p=new WeakMap,g=new WeakMap,m=new WeakMap,v=new WeakMap,S=new WeakMap,b=new WeakMap,y=new WeakMap,C=new WeakMap,w=new WeakMap,_=new WeakMap,E=new WeakMap,T=new WeakMap,I=new WeakMap,P=new WeakMap,A=new WeakMap,M=new WeakMap,D=new WeakMap;t.SdkService=class{constructor(e,t,i,r,o,R,O,N,x,L,k,F,U,j,W,B,H,V){this.settingsService=n.SettingsService.getInstance(),this.rainbowLogger=u.LoggerService.getInstance(),this.logService="SDKService | ",this.RAINBOW_ONREADY="ready",this.RAINBOW_ONLOADED="loaded",f.set(this,e),p.set(this,t),g.set(this,i),m.set(this,r),v.set(this,o),S.set(this,R),b.set(this,O),y.set(this,N),C.set(this,x),w.set(this,L),_.set(this,k),E.set(this,F),T.set(this,U),I.set(this,j),P.set(this,W),A.set(this,B),M.set(this,H),D.set(this,V),this.connection=e,this.config=t,this.presence=i,this.contacts=r,this.conversations=o,this.im=R,this.telephony=O,this.telephonyKeys=s.TelephonyKeysService.getInstance(),this.webRTC=N,this.bubbles=x,this.conferences=L,this.groups=k,this.callsLog=F,this.userProfile=U,this.favorites=j,this.fileStorage=W,this.caps=B,this.channels=H,this.admin=V,this.webConference=a.WebConferenceServiceV2.getInstance(),this.deviceManagement=c.DeviceManagementService.getInstance(),this.virtualBackgrounds=l.VirtualBackgroundService.getInstance(),this.conferenceRecording=d.ConferenceRecordingService.getInstance(),this.suggestionsService=h.SuggestionsService.getInstance(),this.detectRTC=this.detectRTC.bind(this),this.load=this.load.bind(this),this.ready=this.ready.bind(this),this.initializeAuto=this.initializeAuto.bind(this),this.start=this.start.bind(this)}static get $inject(){return["connectionService","configService","presenceService","contactsService","conversationsService","imService","pbxService","webRTCService","bubblesService","conferencesService","groupsService","callsLogService","userProfileService","favoritesService","filesStorageService","capabilitiesService","channelsService","sdkAdminService"]}version(){return window.sdkversion}mode(){return this.settingsService.getSetting("apiMode")}setVerboseLog(e){return o.sdkConfig.verboseLog=e,o.sdkConfig.verboseLog}setKeyFromConfig(e,t){return this.rainbowLogger.sdk(this.logService+"[setKeyFromConfig] :: Linked to application ID "+e+" from configuration file"),o.sdkConfig.credentials.appID=e,o.sdkConfig.credentials.appSecret=t,true}hasBeenLaunchedFromConfig(e){const t=e?"YES":"NO";return this.rainbowLogger.sdk(this.logService+"[hasBeenLaunchedFromConfig] :: SDK launched from a configuration file "+t),sdk.hasBeenLaunchedFromConfig=e,sdk.hasBeenLaunchedFromConfig}async initialize(e,t){return e&&e.length>0?(sdk.key.appID=e,this.rainbowLogger.sdk(this.logService+"[initialize] :: Initialize the SDK for the application "+sdk.key.appID)):this.rainbowLogger.sdk(this.logService+"[initialize] :: Initialize the SDK without an application key"),t&&t.length>0&&(sdk.key.appSecret=t),await this.detectRTC(),this.rainbowLogger.sdk(this.logService+"[initialize] :: SDK Initialized successfully!"),true}async detectRTC(){const e=window.DetectRTC;await e.load(),this.initializeAuto()}load(e){e&&(this.rainbowLogger.sdk(this.logService+"Loading Rainbow Web SDK with custom config"),Object.assign(o.sdkConfig,e),this.settingsService.setSetting("displayOrder",o.sdkConfig.displayOrder)),this.start(),this.rainbowLogger.sdk(this.logService+"[load] :: Rainbow SDK loaded!"),r.eventsService.dispatchEvent(this.RAINBOW_ONLOADED,null)}ready(){this.rainbowLogger.sdk(this.logService+"[ready] :: Rainbow SDK ready!"),r.eventsService.dispatchEvent(this.RAINBOW_ONREADY,null)}initializeAuto(){const e=window.sdkversion,t=window.DetectRTC,i=window.config;this.rainbowLogger.sdk(this.logService+"[initialize ] :: Initializing the Rainbow SDK..."),this.rainbowLogger.sdk(this.logService+"[initialize ] :: -----------------------------"),this.rainbowLogger.sdk(this.logService+"[initialize ] :: Platform    | "+t.osName+" "+t.osVersion),this.rainbowLogger.sdk(this.logService+"[initialize ] :: Screen      | "+window.screen.width+"x"+window.screen.height),this.rainbowLogger.sdk(this.logService+"[initialize ] :: Cookie      | "+navigator.cookieEnabled),this.rainbowLogger.sdk(this.logService+"[initialize ] :: Server      | "+i.webservices.server),this.rainbowLogger.sdk(this.logService+"[initialize ] :: Version WEB | "+version),this.rainbowLogger.sdk(this.logService+"[initialize ] :: Version SDK | "+e),this.rainbowLogger.sdk(this.logService+"[initialize ] :: Browser     | "+t.browser.name+" "+t.browser.fullVersion),this.rainbowLogger.sdk(this.logService+"[initialize ] :: Microphone  | "+t.hasMicrophone),this.rainbowLogger.sdk(this.logService+"[initialize ] :: Camera      | "+t.hasWebcam),this.rainbowLogger.sdk(this.logService+"[initialize ] :: Speakers    | "+t.hasSpeakers),this.rainbowLogger.sdk(this.logService+"[initialize ] :: WebRTC      | "+t.isWebRTCSupported),this.rainbowLogger.sdk(this.logService+"[initialize ] :: Mode        | "+this.mode()),this.rainbowLogger.sdk(this.logService+"[initialize ] :: verboseLog  | "+o.sdkConfig.verboseLog),this.rainbowLogger.sdk(this.logService+"[initialize ] :: appID       | "+sdk.key.appID),this.rainbowLogger.sdk(this.logService+"[initialize ] :: -----------------------------"),this.rainbowLogger.sdk(this.logService+"[initialize ] :: Initialized!"),this.ready()}start(){window.config.webservices.currentServer=window.config.webservices.server}}},function(e,t){window.version="2.112.10"},function(e,t){window.sdkversion="v4.0.0-lts"},function(e,t){window.config={xmpp:{protocol:"wss",server:"sandbox.openrainbow.com",port:"443",pingInterval:"60000"},webservices:{protocol:"https",server:"sandbox.openrainbow.com",port:"443"},cpaas:{protocol:"https",server:"",port:"8887"}}},function(e,t,i){!function(e){e.Strophe.addNamespace("RSM","http://jabber.org/protocol/rsm"),e.Strophe.RSM=function(e){if(this.attribs=["max","first","last","after","before","index","count"],void 0!==e.xml)this.fromXMLElement(e.xml);else for(var t=0;t<this.attribs.length;t++){var i=this.attribs[t];this[i]=e[i]}},e.Strophe.RSM.prototype={toXML:function(){for(var t=e.$build("set",{xmlns:e.Strophe.NS.RSM}),i=0;i<this.attribs.length;i++){var r=this.attribs[i];void 0!==this[r]&&(t=t.c(r).t(this[r].toString()).up())}return t.tree()},next:function(t){return new e.Strophe.RSM({max:t,after:this.last})},previous:function(t){return new e.Strophe.RSM({max:t,before:this.first})},fromXMLElement:function(t){for(var i=0;i<this.attribs.length;i++){var r=this.attribs[i],n=t.getElementsByTagName(r)[0];null!=n&&(this[r]=e.Strophe.getText(n),"first"==r&&(this.index=n.getAttribute("index")))}}}}(i(129))},function(e,t){window.app=angular.module("rainbow",[]),window.rainbowAdmin=angular.module("rainbowAdmin",[]),window.rainbowModule=angular.module("rainbow",["rainbowAdmin"])},function(e,t,i){i.r(t);var r=i(118),n=i(152),s=i(119),o=i(34),a=i(153),c=i(57),l=i(56),d=i(4),u=i(121),h=i(47),f=i(120),p=i(332),g=i(333);angular.module("rainbow").moduleIds=[],i(359),i(154),i(76),i(104),i(369),i(370),i(371),i(372),i(373),i(377),i(139),i(107),i(378),i(106),i(66),i(28),i(101),i(140),i(379),i(380),i(162),i(128),i(381),i(382),i(383),i(384),i(385),i(386),i(387),i(388),i(389),i(164),i(311);r.VoiceMessageService.getInstance(),d.LoggerService.getInstance(),s.BotService.getInstance(),o.WebrtcP2PService.getInstance(),a.WebrtcGlobalEventHandlerService.getInstance(),c.TelephonyService.getInstance(),l.DeviceManagementService.getInstance(),n.PhonebookService.getInstance(),u.CCDAgentService.getInstance();angular.module("rainbow").service("fileServerService",h.FileServerService),angular.module("rainbow").service("companyDirectoryService",f.CompanyDirectoryService),angular.module("rainbow").service("webConferenceService",p.WebConferenceService),angular.module("rainbow").service("conferenceService",g.ConferenceService),i(454),i(455),i(456),i(457),i(458)},function(e,t,i){(function(i,r){var n;!function(){function s(e,t){var i=0,r=false,n=window.setInterval((function(){e()&&(window.clearInterval(n),t(r)),i++>50&&(window.clearInterval(n),t(r=true))}),10)}var o,a="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";if(_="object"==typeof i&&"object"==typeof i.versions&&i.versions.node&&!i.browser){var c=i.versions.node.toString().replace("v","");a="Nodejs/"+c+" (NodeOS) AppleWebKit/"+c+" (KHTML, like Gecko) Nodejs/"+c+" Nodejs/"+c}o=void 0!==r?r:window,"undefined"==typeof window&&("undefined"==typeof window&&void 0!==r&&(r.navigator={userAgent:a,getUserMedia:function(){}},o.window=r),"undefined"==typeof location&&(o.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(o.screen={width:0,height:0}));var l=window.navigator;void 0!==l?(void 0!==l.webkitGetUserMedia&&(l.getUserMedia=l.webkitGetUserMedia),void 0!==l.mozGetUserMedia&&(l.getUserMedia=l.mozGetUserMedia)):l={getUserMedia:function(){},userAgent:a};var d,u,h=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(l.userAgent||""),f=!(-1===l.userAgent.indexOf("Edge")||!l.msSaveOrOpenBlob&&!l.msSaveBlob),p=!!window.opera||l.userAgent.indexOf(" OPR/")>=0,g=l.userAgent.toLowerCase().indexOf("firefox")>-1&&"netscape"in window&&/ rv:/.test(l.userAgent),m=/^((?!chrome|android).)*safari/i.test(l.userAgent),v=!!window.chrome&&!p,S="undefined"!=typeof document&&!!document.documentMode&&!f,b={Android:function(){return l.userAgent.match(/Android/i)},BlackBerry:function(){return l.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return l.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return l.userAgent.match(/Opera Mini/i)},Windows:function(){return l.userAgent.match(/IEMobile/i)},any:function(){return b.Android()||b.BlackBerry()||b.iOS()||b.Opera()||b.Windows()},getOsName:function(){var e="Unknown OS";return b.Android()&&(e="Android"),b.BlackBerry()&&(e="BlackBerry"),b.iOS()&&(e="iOS"),b.Opera()&&(e="Opera Mini"),b.Windows()&&(e="Windows"),e}},y="Unknown OS",C="Unknown OS Version",w=function(){for(var e,t=l.appVersion,i=l.userAgent,r="-",n=[{s:"Chrome OS",r:/CrOS/},{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],s=0;e=n[s];s++)if(e.r.test(i)){r=e.s;break}var o="-";switch(/Windows/.test(r)&&(/Windows (.*)/.test(r)&&(o=/Windows (.*)/.exec(r)[1]),r="Windows"),r){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(i)&&(o=/Mac OS X (10[\.\_\d]+)/.exec(i)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(i)&&(o=/Android ([\.\_\d]+)/.exec(i)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(i)&&(o=(o=/OS (\d+)_(\d+)_?(\d+)?/.exec(t))[1]+"."+o[2]+"."+(0|o[3]))}return{osName:r,osVersion:o}}();w&&w.osName&&"-"!=w.osName?(y=w.osName,C=w.osVersion):b.any()&&("Android"==(y=b.getOsName())&&(C=!!(u=(d=(d||l.userAgent).toLowerCase()).match(/android\s([0-9\.]*)/))&&u[1]));var _="object"==typeof i&&"object"==typeof i.versions&&i.versions.node;"Unknown OS"===y&&_&&(y="Nodejs",C=i.versions.node.toString().replace("v",""));var E=false,T=false;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach((function(e){"undefined"!=typeof document&&"function"==typeof document.createElement&&(!E&&e in document.createElement("canvas")&&(E=true),!T&&e in document.createElement("video")&&(T=true))}));var I=/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/,P=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,A=/[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}/,M=[],D=[],R=[],O=[];l.mediaDevices&&l.mediaDevices.enumerateDevices&&(l.enumerateDevices=function(e){var t=l.mediaDevices.enumerateDevices();t&&t.then?l.mediaDevices.enumerateDevices().then(e).catch((function(){e([])})):e([])});var N=false;("undefined"!=typeof MediaStreamTrack&&"getSources"in MediaStreamTrack||l.mediaDevices&&l.mediaDevices.enumerateDevices)&&(N=true);var x=false,L=false,k=false,F=false,U=false,j=window.DetectRTC||{};j.browser=function(){var e,t,i,r=(l.appVersion,l.userAgent),n=l.appName,s=""+parseFloat(l.appVersion),o=parseInt(l.appVersion,10);if(p){n="Opera";try{o=(s=l.userAgent.split("OPR/")[1].split(" ")[0]).split(".")[0]}catch(a){s="0.0.0.0",o=0}}else S?((t=r.indexOf("rv:"))>0?s=r.substring(t+3):(t=r.indexOf("MSIE"),s=r.substring(t+5)),n="IE"):v?(t=r.indexOf("Chrome"),n="Chrome",s=r.substring(t+7)):m?-1!==r.indexOf("CriOS")?(t=r.indexOf("CriOS"),n="Chrome",s=r.substring(t+6)):-1!==r.indexOf("FxiOS")?(t=r.indexOf("FxiOS"),n="Firefox",s=r.substring(t+6)):(t=r.indexOf("Safari"),n="Safari",s=r.substring(t+7),-1!==(t=r.indexOf("Version"))&&(s=r.substring(t+8)),-1!==l.userAgent.indexOf("Version/")&&(s=l.userAgent.split("Version/")[1].split(" ")[0])):g?(t=r.indexOf("Firefox"),n="Firefox",s=r.substring(t+8)):(e=r.lastIndexOf(" ")+1)<(t=r.lastIndexOf("/"))&&(n=r.substring(e,t),s=r.substring(t+1),n.toLowerCase()===n.toUpperCase()&&(n=l.appName));return f&&(n="Edge",s=l.userAgent.split("Edge/")[1]),-1!==(i=s.search(/[; \)]/))&&(s=s.substring(0,i)),o=parseInt(""+s,10),isNaN(o)&&(s=""+parseFloat(l.appVersion),o=parseInt(l.appVersion,10)),{fullVersion:s,version:o,name:n,isPrivateBrowsing:false}}(),function(e){var t;try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,(function(){t=false}),(function(e){t=true}));else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var i;try{(i=window.indexedDB.open("test")).onerror=function(){return true}}catch(r){t=true}void 0===t&&s((function(){return"done"===i.readyState}),(function(e){e||(t=!i.result)}))}else if(function(e){var t=e.toLowerCase();if(0===t.indexOf("msie")&&0===t.indexOf("trident"))return false;var i=/(?:msie|rv:)\s?([\d\.]+)/.exec(t);return!!(i&&parseInt(i[1],10)>=10)}(window.navigator.userAgent)){t=false;try{window.indexedDB||(t=true)}catch(r){t=true}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(r){t=true}void 0===t&&(t=false,window.localStorage.removeItem("test"))}}catch(r){t=false}s((function(){return void 0!==t}),(function(i){e(t)}))}((function(e){j.browser.isPrivateBrowsing=!!e})),j.browser["is"+j.browser.name]=true,j.osName=y,j.osVersion=C;var W=("object"==typeof i&&"object"==typeof i.versions&&i.versions["node-webkit"],false);["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach((function(e){W||e in window&&(W=true)})),j.isWebRTCSupported=W,j.isORTCSupported="undefined"!=typeof RTCIceGatherer;var B=false;((j.browser.isChrome&&j.browser.version>=35||j.browser.isFirefox&&j.browser.version>=34||j.browser.isEdge&&j.browser.version>=17||"Android"===j.osName&&j.browser.isChrome)&&(B=true),(l.getDisplayMedia||l.mediaDevices&&l.mediaDevices.getDisplayMedia)&&(B=true),/^(https:|chrome-extension:)$/g.test(location.protocol||""))||("undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(j.browser.isChrome||j.browser.isEdge||j.browser.isOpera)||j.browser.isFirefox)&&(B=false);j.isScreenCapturingSupported=B;var H={isSupported:false,isCreateMediaStreamSourceSupported:false};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach((function(e){H.isSupported||e in window&&(H.isSupported=true,window[e]&&"createMediaStreamSource"in window[e].prototype&&(H.isCreateMediaStreamSourceSupported=true))})),j.isAudioContextSupported=H.isSupported,j.isCreateMediaStreamSourceSupported=H.isCreateMediaStreamSourceSupported;var V=false;j.browser.isChrome&&j.browser.version>31&&(V=true),j.isRtpDataChannelsSupported=V;var Y=false;(j.browser.isFirefox&&j.browser.version>28||j.browser.isChrome&&j.browser.version>25||j.browser.isOpera&&j.browser.version>=11)&&(Y=true),j.isSctpDataChannelsSupported=Y,j.isMobileDevice=h;var G=false;(l.getUserMedia||l.mediaDevices&&l.mediaDevices.getUserMedia)&&(G=true),j.browser.isChrome&&j.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(G="Requires HTTPs"),"Nodejs"===j.osName&&(G=false),j.isGetUserMediaSupported=G;var $,z,J,q="";screen.width&&(q+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:""));j.displayResolution=q,j.displayAspectRatio=($=screen.width,z=screen.height,J=function e(t,i){return 0==i?t:e(i,t%i)}($,z),$/J/(z/J)).toFixed(2),j.isCanvasSupportsStreamCapturing=E,j.isVideoSupportsStreamCapturing=T,"Chrome"==j.browser.name&&j.browser.version>=53&&(j.isCanvasSupportsStreamCapturing||(j.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),j.isVideoSupportsStreamCapturing||(j.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features")),j.DetectLocalIPAddress=function(e,t){if(j.isWebRTCSupported){var i=true,r=true;!function(e,t){function i(t){if(t){var i=P.exec(t);if(i){var r=i[1],s=t.match(I);void 0===n[r]&&e(r,s,true),n[r]=true}}else e()}function r(){l.localDescription.sdp.split("\n").forEach((function(e){e&&0===e.indexOf("a=candidate:")&&i(e)}))}if("undefined"!=typeof document&&"function"==typeof document.getElementById){var n={},s=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!s){var o=document.getElementById("iframe");if(!o)return;var a=o.contentWindow;s=a.RTCPeerConnection||a.mozRTCPeerConnection||a.webkitRTCPeerConnection}if(s){var c=null;"Chrome"===j.browser&&j.browser.version<58&&(c={optional:[{RtpDataChannels:true}]});var l=new s({iceServers:[{urls:"stun:stun.l.google.com:19302"}]},c);if(t&&(l.addStream?l.addStream(t):l.addTrack&&t.getTracks()[0]&&l.addTrack(t.getTracks()[0],t)),l.onicecandidate=function(e){e.candidate&&e.candidate.candidate?i(e.candidate.candidate):i()},!t)try{l.createDataChannel("sctp",{})}catch(d){}j.isPromisesSupported?l.createOffer().then((function(e){l.setLocalDescription(e).then(r)})):l.createOffer((function(e){l.setLocalDescription(e,r,(function(){}))}),(function(){}))}}}((function(t){t?t.match(I)?e("Local: "+t,i=false,r):t.match(A)?e("Public: "+t,i,r=false):e("Public: "+t,i,r):e()}),t)}},j.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,j.isWebSocketsBlocked=!j.isWebSocketsSupported,"Nodejs"===j.osName&&(j.isWebSocketsSupported=true,j.isWebSocketsBlocked=false),j.checkWebSocketsSupport=function(e){e=e||function(){};try{var t,i=new WebSocket("wss://echo.websocket.org:443/");i.onopen=function(){j.isWebSocketsBlocked=false,t=(new Date).getTime(),i.send("ping")},i.onmessage=function(){j.WebsocketLatency=(new Date).getTime()-t+"ms",e(),i.close(),i=null},i.onerror=function(){j.isWebSocketsBlocked=true,e()}}catch(r){j.isWebSocketsBlocked=true,e()}},j.load=function(e){(function(e){if(N)if(!l.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(l.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!l.enumerateDevices&&l.enumerateDevices&&(l.enumerateDevices=l.enumerateDevices.bind(l)),l.enumerateDevices){M=[],D=[],R=[],O=[],x=false,L=false,k=false,F=false,U=false;var t={};l.enumerateDevices((function(i){M=[],D=[],R=[],O=[],i.forEach((function(e){var i={};for(var r in e)try{"function"!=typeof e[r]&&(i[r]=e[r])}catch(n){}t[i.deviceId+i.label+i.kind]||("audio"===i.kind&&(i.kind="audioinput"),"video"===i.kind&&(i.kind="videoinput"),i.deviceId||(i.deviceId=i.id),i.id||(i.id=i.deviceId),i.label?("videoinput"!==i.kind||U||(U=true),"audioinput"!==i.kind||F||(F=true)):(i.isCustomLabel=true,"videoinput"===i.kind?i.label="Camera "+(O.length+1):"audioinput"===i.kind?i.label="Microphone "+(D.length+1):"audiooutput"===i.kind?i.label="Speaker "+(R.length+1):i.label="Please invoke getUserMedia once.",void 0!==j&&j.browser.isChrome&&j.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(i.label="HTTPs is required to get label of this "+i.kind+" device.")),"audioinput"===i.kind&&(x=true,-1===D.indexOf(i)&&D.push(i)),"audiooutput"===i.kind&&(L=true,-1===R.indexOf(i)&&R.push(i)),"videoinput"===i.kind&&(k=true,-1===O.indexOf(i)&&O.push(i)),M.push(i),t[i.deviceId+i.label+i.kind]=i)})),void 0!==j&&(j.MediaDevices=M,j.hasMicrophone=x,j.hasSpeakers=L,j.hasWebcam=k,j.isWebsiteHasWebcamPermissions=U,j.isWebsiteHasMicrophonePermissions=F,j.audioInputDevices=D,j.audioOutputDevices=R,j.videoInputDevices=O),e&&e()}))}else e&&e();else e&&e()})(e=e||function(){})},j.MediaDevices=void 0!==M?M:[],j.hasMicrophone=x,j.hasSpeakers=L,j.hasWebcam=k,j.isWebsiteHasWebcamPermissions=U,j.isWebsiteHasMicrophonePermissions=F,j.audioInputDevices=D,j.audioOutputDevices=R,j.videoInputDevices=O;var K=false;"undefined"!=typeof document&&"function"==typeof document.createElement&&"setSinkId"in document.createElement("video")&&(K=true),j.isSetSinkIdSupported=K;var X=false;j.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(X=true):j.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(X=true),j.isRTPSenderReplaceTracksSupported=X;var Q=false;j.browser.isFirefox&&j.browser.version>38&&(Q=true),j.isRemoteStreamProcessingSupported=Q;var Z=false;"undefined"!=typeof MediaStreamTrack&&"applyConstraints"in MediaStreamTrack.prototype&&(Z=true),j.isApplyConstraintsSupported=Z;var ee=false;j.browser.isFirefox&&j.browser.version>=43&&(ee=true),j.isMultiMonitorScreenCapturingSupported=ee,j.isPromisesSupported=!!("Promise"in window),j.version="1.4.0",void 0===j&&(window.DetectRTC={});var te=window.MediaStream;void 0===te&&"undefined"!=typeof webkitMediaStream&&(te=webkitMediaStream),j.MediaStream=void 0!==te&&"function"==typeof te&&Object.keys(te.prototype),"undefined"!=typeof MediaStreamTrack?j.MediaStreamTrack=Object.keys(MediaStreamTrack.prototype):j.MediaStreamTrack=false;var ie=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;j.RTCPeerConnection=void 0!==ie&&Object.keys(ie.prototype),window.DetectRTC=j,e.exports=j,void 0===(n=function(){return j}.apply(t,[]))||(e.exports=n)}()}).call(this,i(360),i(130))},function(e,t){var i,r,n=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(i===setTimeout)return setTimeout(e,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(r){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(e){i=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var c,l=[],d=false,u=-1;function h(){d&&c&&(d=false,c.length?l=c.concat(l):u=-1,l.length&&f())}function f(){if(!d){var e=a(h);d=true;for(var t=l.length;t;){for(c=l,l=[];++u<t;)c&&c[u].run();u=-1,t=l.length}c=null,d=false,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(i){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];l.push(new p(e,t)),1!==l.length||d||a(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=true,n.env={},n.argv=[],n.version="",n.versions={},n.on=g,n.addListener=g,n.once=g,n.off=g,n.removeListener=g,n.removeAllListeners=g,n.emit=g,n.prependListener=g,n.prependOnceListener=g,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});var r=i(94);t.canReportError=function(e){for(;e;){var t=e,i=t.closed,n=t.destination,s=t.isStopped;if(i||s)return false;e=n&&n instanceof r.Subscriber?n:null}return true}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.isArray=Array.isArray||function(e){return e&&"number"==typeof e.length}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.isObject=function(e){return null!==e&&"object"==typeof e}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}();t.UnsubscriptionError=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});var r=i(94),n=i(134),s=i(156);t.toSubscriber=function(e,t,i){if(e){if(e instanceof r.Subscriber)return e;if(e[n.rxSubscriber])return e[n.rxSubscriber]()}return e||t||i?new r.Subscriber(e,t,i):new r.Subscriber(s.empty)}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.observable="function"==typeof Symbol&&Symbol.observable||"@@observable"},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});var r=i(368);function n(e){return 0===e.length?r.identity:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}t.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n(e)},t.pipeFromArray=n},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.identity=function(e){return e}},function(e,t){angular.module("rainbow").factory("CompanyRequest",[function(){function e(e,t,i,r,n,s,o,a,c,l,d){this.id=e,this.requestingUserId=t,this.requestingUserLoginEmail=i,this.requestedCompanyId=r,this.requestedCompanyName=n,this.status=s,this.requestingDate=o,this.requestedNotificationLanguage=a,this.lastNotificationDate=c,this.requestedToCompanyAdmin=l,this.requestedCompanyInvitationId=d}return e.createFromData=function(t){return new e(t.id,t.requestingUserId,t.requestingUserLoginEmail,t.requestedCompanyId,t.requestedCompanyName,t.status,t.requestingDate,t.requestedNotificationLanguage,t.lastNotificationDate,t.requestedToCompanyAdmin,t.requestedCompanyInvitationId)},e}])},function(e,t){angular.module("rainbow").factory("CompanyBpLinkInvitation",[function(){function e(e,t,i,r,n,s,o,a,c,l,d,u,h,f,p){this.id=e,this.invitedCompanyId=t,this.invitedCompanyName=i,this.invitedToBeBpIr=r,this.invitingAdminId=n,this.invitingAdminLoginEmail=s,this.invitingCompanyId=o,this.invitingCompanyName=a,this.invitationDate=c,this.lastNotificationDate=l,this.requestedNotificationLanguage=d,this.status=u,this.acceptationDate=h,this.cancelationDate=f,this.declinationDate=p}return e.createFromData=function(t){return new e(t.id,t.invitedCompanyId,t.invitedCompanyName,t.invitedToBeBpIr,t.invitingAdminId,t.invitingAdminLoginEmail,t.invitingCompanyId,t.invitingCompanyName,t.invitationDate,t.lastNotificationDate,t.requestedNotificationLanguage,t.status,t.acceptationDate,t.cancelationDate,t.declinationDate)},e}])},function(e,t){angular.module("rainbow").factory("CompanyBpLinkRequest",[function(){function e(e,t,i,r,n,s,o,a,c,l,d,u,h,f,p){this.id=e,this.requestingAdminId=t,this.requestingAdminLoginEmail=i,this.requestingCompanyId=r,this.requestingCompanyName=n,this.requestedCompanyId=s,this.requestedCompanyName=o,this.requestedToBeBpIr=a,this.requestDate=c,this.lastNotificationDate=l,this.requestedNotificationLanguage=d,this.status=u,this.acceptationDate=h,this.cancelationDate=f,this.declinationDate=p}return e.createFromData=function(t){return new e(t.id,t.requestingAdminId,t.requestingAdminLoginEmail,t.requestingCompanyId,t.requestingCompanyName,t.requestedCompanyId,t.requestedCompanyName,t.requestedToBeBpIr,t.requestDate,t.lastNotificationDate,t.requestedNotificationLanguage,t.status,t.acceptationDate,t.cancelationDate,t.declinationDate)},e}])},function(e,t){angular.module("rainbow").factory("Conference",[function(){function e(e,t,i,r,n,s,o,a,c,l,d){this.companyId=e,this.id=t,this.mediaType=i,this.name=r,this.passCodes=n||[],this.scheduled=s,this.lastUpdateDate=o,this.userId=a,this.confDialOutDisabled=c,this.playEntryTone=l,this.muteUponEntry=d,this.updateFromData=function(e){this.companyId=e.companyId,this.id=e.id,this.mediaType=e.mediaType,this.name=e.name,this.passCodes=e.passCodes,this.scheduled=e.scheduled,this.lastUpdateDate=e.lastUpdateDate,this.userId=e.userId,this.confDialOutDisabled=e.confDialOutDisabled,this.playEntryTone=e.playEntryTone,this.muteUponEntry=e.muteUponEntry}}return e.createFromData=function(t){return new e(t.companyId,t.id,t.mediaType,t.name,t.passCodes,t.scheduled,t.lastUpdateDate,t.userId,t.confDialOutDisabled,t.playEntryTone,t.muteUponEntry)},e}])},function(e,t,i){i.r(t);var r=i(6),n=i(99);angular.module("rainbow").factory("ConferenceSession",["$log","ConferenceParticipant","$q","$interval",function(e,t,i,s){const o=r.ContactService.getInstance();function a(r,c,l,d,u){const h=this;h.id=r,h.participants=c,h.active=l,h.talkerActive=void 0,h.recordingStarted=false,h.recordingUserId="",h.currentRecordingState="",h.talkers=void 0,h.talkerSubject=new n.a(this.talkers),h.isLeaderAlreadyConnected=false,h.status=null,h.localStreams=[],h.sessions={},h.publishers=[],h.type=d,h.callId=null,h.hasLocalVideo=false,h.jingleJid=null,h.localVideoSessionId=null,h.localSharingSessionId=null,h.haveJoined=false,h.lock=false,h.duration=0,h.durationTimer=null,h.conferenceStats=null,h.control={activeControl:false,hasRemoteControlling:false,controller:null,controlled:null},h.conferenceView=u||a.ConferenceView.GalleryView,h.networkQuality=0,h.isMyConference=false,h.isInExternalWindow=false,h.externalWindowRef=null,h.noMicrophone=false,h.isOnlySharingWindow=false,h.record={isRecording:false,recordingIsPaused:false},h.talkingTimeStats={},h.conferenceLayoutSize={},h.dimLocalSharingScreen=true,h.lastTalkerId="",h.cleanupSessionData=function(){e.debug("[ConferenceSession] Cleanup for conferenceSession "+h.id),h.participants=[],h.talkerActive=void 0,h.talkers=void 0,h.isLeaderAlreadyConnected=false,h.localStreams=[],h.sessions={},h.publishers=[],h.hasLocalVideo=false,h.metricsState="",h.recordingStarted=false,h.recordingUserId="",h.currentRecordingState="",h.status="ended",h.hasLocalSharing=false,h.reversedVideos=false,h.jingleJid=null,h.localVideoSessionId=null,h.localSharingSessionId=null,h.haveJoined=false,h.lock=false,h.duration=0,h.conferenceStats=null,h.durationTimer&&(s.cancel(h.durationTimer),h.durationTimer=null),h.conferenceView=a.ConferenceView.GalleryView,h.joinedFromOtherDevice=false,h.isInExternalWindow=false,h.isOnlySharingWindow=false,h.externalWindowRef=null,h.noMicrophone=false,h.talkingTimeStats={},h.lastTalkerId=""},h.updateFromData=function(e,t,i){h.id=e,h.participants=t,h.active=i},h.updateActiveState=function(e){h.active=e},h.updateStateFromData=function(e,t,i){h.active=e,h.talkerActive=t,h.lock=i},h.updateTalkingTimeForParticipant=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i&&Object.keys(h.talkingTimeStats).forEach((t=>{const r=h.talkingTimeStats[t];r.jid_im&&r.jid_im===i&&t!==e&&(h.talkingTimeStats[e]=r,delete h.talkingTimeStats[t])})),h.talkingTimeStats[e]||(h.talkingTimeStats[e]={talkingTime:t}),i&&(h.talkingTimeStats[e].jid_im=i),h.talkingTimeStats[e].talkingTime=t},h.updateParticipants=function(r){return i((function(i){let n=false;r||i(false),h.participants||(h.participants=[]),0===r.length&&(h.participants=[]),r.forEach((function(i){if(!i.participantId)return;e.debug("[conferenceSession] updateParticipants participantId="+i.participantId);const r=h.getParticipantById(i.participantId)?h.getParticipantById(i.participantId):i.jid_im?h.getParticipantByJid(i.jid_im):null;if(r)e.debug("[conferenceSession] updateParticipants update participantId="+i.participantId),r.updateFromData(i);else{e.debug("[conferenceSession] updateParticipants create participantId="+i.participantId);const r=t.createFromData(i);h.participants.push(r),n=r}})),i(n)}))},h.removeParticipants=function(t){t&&t.forEach((function(t){const i=h.getParticipantIndexById(t);-1!==i&&(e.debug("[conferenceSession] removeParticipants remove participantId="+t),h.participants.splice(i,1))}))},h.removePublisher=function(t){if(!t)return;const i=h.getPublisherIndexById(t);-1!==i&&(e.debug("[conferenceSession] removePublisher remove participantId="+t),h.publishers.splice(i,1))},h.updateTalkers=function(t){e.debug("[conferenceSession] updateTalkers talkers="+t),t&&t.length&&(h.lastTalkerId=t[0]),h.talkers=t,h.talkerSubject.next(h.talkers)},h.isActive=function(){return void 0!==h.active&&h.active},h.isTalkerActive=function(){return void 0!==h.talkerActive&&h.talkerActive},h.isRecordingStarted=function(){return void 0!==h.recordingStarted&&h.recordingStarted},h.getParticipants=function(){return h.participants},h.getConnectedParticipants=function(){return h.participants?h.participants.filter((function(e){return"disconnected"!==e.state&&"watching"!==e.state})):void 0},h.getWatchingParticipants=function(){return h.participants?h.participants.filter((function(e){return"watching"===e.state})):void 0},h.getConnectedParticipantsExceptLeader=function(){return h.participants?h.participants.filter((function(e){return"disconnected"!==e.state&&"watching"!==e.state&&"moderator"!==e.role})):void 0},h.getConnectedLeaderParticipantsExcept=function(e){return h.participants?h.participants.filter((function(t){return"disconnected"!==t.state&&"moderator"===t.role&&t.jid_im!==e})):void 0},h.getConnectedParticipantsExcept=function(e){return h.participants?h.participants.filter((function(t){return t.jid_im!==e&&"disconnected"!==t.state&&"watching"!==t.state})):void 0},h.getLeaderParticipant=function(){return h.participants?h.participants.find((function(e){return"moderator"===e.role&&"disconnected"!==e.state&&"watching"!==e.state})):void 0},h.getLeaderParticipantById=function(e){return h.participants?h.participants.find((function(t){return"moderator"===t.role&&"disconnected"!==t.state&&"watching"!==t.state&&t.jid_im===e})):void 0},h.getParticipantById=function(e){return h.participants?h.participants.find((function(t){return t.participantId===e})):void 0},h.getParticipantByJid=function(e){return h.participants?h.participants.find((function(t){return t.jid_im===e})):void 0},h.getNonDisconnectedParticipantByJid=function(e){return h.participants?h.participants.find((function(t){return t.jid_im===e&&"disconnected"!==t.state})):void 0},h.getConnectedParticipantByJid=function(e){return h.participants?h.participants.find((function(t){return t.jid_im===e&&"connected"===t.state})):void 0},h.getWatchingParticipantByJid=function(e){return h.participants?h.participants.find((function(t){return t.jid_im===e&&"watching"===t.state})):void 0},h.getParticipantIndexById=function(e){return h.participants?h.participants.findIndex((function(t){return t.participantId===e})):-1},h.getPublisherIndexById=function(e){return h.publishers?h.publishers.findIndex((function(t){return t.participantId===e})):-1},h.getPublisherById=function(e){return h.publishers?h.publishers.find((function(t){return t.participantId===e})):void 0},h.isParticipantConnectedByJid=function(e){return void 0!==h.participants&&h.participants.some((function(t){return t.jid_im===e&&"connected"===t.state}))},h.isParticipantWatchingByJid=function(e){return void 0!==h.participants&&h.participants.some((function(t){return t.jid_im===e&&"watching"===t.state}))},h.isParticipantRingingByJid=function(e){return void 0!==h.participants&&h.participants.some((function(t){return t.jid_im===e&&"ringing"===t.state}))},h.isParticipantConnectedWithThisUAByJid=function(e){return h.haveJoined&&void 0!==h.participants&&h.participants.some((function(t){return t.jid_im===e&&"connected"===t.state}))},h.checkIfParticipantHasVideoByPublisherId=function(e){let t=false;if(h.publishers){for(let i=0;i<h.publishers.length;i++)if("video"===h.publishers[i].mediaType&&h.publishers[i].participantId===e){t=true;break}}return t},h.getCurrentSharingParticipant=function(){let e=null;if(h.publishers){for(let t=0;t<h.publishers.length;t++)if("sharing"===h.publishers[t].mediaType){e=h.publishers[t].participantId;break}}return e&&h.participants?h.participants.find((function(t){return t.participantId===e})):void 0},h.getDelegateParticipantsListExcept=function(e){const t=[],i=this.getConnectedParticipantsExcept(e);if(i)for(let r=0;r<i.length;r++)i[r].delegateCapability&&t.push(i[r]);return t},h.getTalkers=function(){return h.talkers},h.setCallId=function(e){h.callId=e},h.getListOfRemoteVideoPublishers=function(){const e=[];if(h.publishers)for(let t=0;t<h.publishers.length;t++)"video"===h.publishers[t].mediaType&&h.publishers[t].jid_im!==o.userContact.jid&&e.push(h.publishers[t]);return e},h.startDuration=function(){h.durationTimer||(h.durationTimer=s((function(){h.duration++}),1e3))},h.stopDuration=function(){h.durationTimer&&(s.cancel(h.durationTimer),h.durationTimer=null,h.duration=0)},h.isInConferenceWithDesktopApp=function(){const e=h.getCurrentSharingParticipant();return!(!e||!e.contact)&&-1!==e.contact.fullJid.indexOf("desk_")}}return a.createFromData=function(e,t,i,r,n){r||(r="pstnAudio");return new a(e,t,i,r,n)},a.ConferenceView={GalleryView:"gallery_view",SpeakerView:"speaker_view",GridView:"grid_view"},a}])},function(e,t,i){i.r(t),i.d(t,"MD5Algo",(function(){return l})),i.d(t,"MD5",(function(){return d})),i.d(t,"HmacMD5",(function(){return u}));var r=i(42);const n=[];for(let h=0;h<64;h+=1)n[h]=4294967296*Math.abs(Math.sin(h+1))|0;const s=(e,t,i,r,n,s,o)=>{const a=e+(t&i|~t&r)+n+o;return(a<<s|a>>>32-s)+t},o=(e,t,i,r,n,s,o)=>{const a=e+(t&r|i&~r)+n+o;return(a<<s|a>>>32-s)+t},a=(e,t,i,r,n,s,o)=>{const a=e+(t^i^r)+n+o;return(a<<s|a>>>32-s)+t},c=(e,t,i,r,n,s,o)=>{const a=e+(i^(t|~r))+n+o;return(a<<s|a>>>32-s)+t};class l extends r.Hasher{_doReset(){this._hash=new r.WordArray([1732584193,4023233417,2562383102,271733878])}_doProcessBlock(e,t){const i=e;for(let n=0;n<16;n+=1){const r=t+n,s=e[r];i[r]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}const r=this._hash.words,l=i[t+0],d=i[t+1],u=i[t+2],h=i[t+3],f=i[t+4],p=i[t+5],g=i[t+6],m=i[t+7],v=i[t+8],S=i[t+9],b=i[t+10],y=i[t+11],C=i[t+12],w=i[t+13],_=i[t+14],E=i[t+15];let T=r[0],I=r[1],P=r[2],A=r[3];T=s(T,I,P,A,l,7,n[0]),A=s(A,T,I,P,d,12,n[1]),P=s(P,A,T,I,u,17,n[2]),I=s(I,P,A,T,h,22,n[3]),T=s(T,I,P,A,f,7,n[4]),A=s(A,T,I,P,p,12,n[5]),P=s(P,A,T,I,g,17,n[6]),I=s(I,P,A,T,m,22,n[7]),T=s(T,I,P,A,v,7,n[8]),A=s(A,T,I,P,S,12,n[9]),P=s(P,A,T,I,b,17,n[10]),I=s(I,P,A,T,y,22,n[11]),T=s(T,I,P,A,C,7,n[12]),A=s(A,T,I,P,w,12,n[13]),P=s(P,A,T,I,_,17,n[14]),I=s(I,P,A,T,E,22,n[15]),T=o(T,I,P,A,d,5,n[16]),A=o(A,T,I,P,g,9,n[17]),P=o(P,A,T,I,y,14,n[18]),I=o(I,P,A,T,l,20,n[19]),T=o(T,I,P,A,p,5,n[20]),A=o(A,T,I,P,b,9,n[21]),P=o(P,A,T,I,E,14,n[22]),I=o(I,P,A,T,f,20,n[23]),T=o(T,I,P,A,S,5,n[24]),A=o(A,T,I,P,_,9,n[25]),P=o(P,A,T,I,h,14,n[26]),I=o(I,P,A,T,v,20,n[27]),T=o(T,I,P,A,w,5,n[28]),A=o(A,T,I,P,u,9,n[29]),P=o(P,A,T,I,m,14,n[30]),I=o(I,P,A,T,C,20,n[31]),T=a(T,I,P,A,p,4,n[32]),A=a(A,T,I,P,v,11,n[33]),P=a(P,A,T,I,y,16,n[34]),I=a(I,P,A,T,_,23,n[35]),T=a(T,I,P,A,d,4,n[36]),A=a(A,T,I,P,f,11,n[37]),P=a(P,A,T,I,m,16,n[38]),I=a(I,P,A,T,b,23,n[39]),T=a(T,I,P,A,w,4,n[40]),A=a(A,T,I,P,l,11,n[41]),P=a(P,A,T,I,h,16,n[42]),I=a(I,P,A,T,g,23,n[43]),T=a(T,I,P,A,S,4,n[44]),A=a(A,T,I,P,C,11,n[45]),P=a(P,A,T,I,E,16,n[46]),I=a(I,P,A,T,u,23,n[47]),T=c(T,I,P,A,l,6,n[48]),A=c(A,T,I,P,m,10,n[49]),P=c(P,A,T,I,_,15,n[50]),I=c(I,P,A,T,p,21,n[51]),T=c(T,I,P,A,C,6,n[52]),A=c(A,T,I,P,h,10,n[53]),P=c(P,A,T,I,b,15,n[54]),I=c(I,P,A,T,d,21,n[55]),T=c(T,I,P,A,v,6,n[56]),A=c(A,T,I,P,E,10,n[57]),P=c(P,A,T,I,g,15,n[58]),I=c(I,P,A,T,w,21,n[59]),T=c(T,I,P,A,f,6,n[60]),A=c(A,T,I,P,y,10,n[61]),P=c(P,A,T,I,u,15,n[62]),I=c(I,P,A,T,S,21,n[63]),r[0]=r[0]+T|0,r[1]=r[1]+I|0,r[2]=r[2]+P|0,r[3]=r[3]+A|0}_doFinalize(){const e=this._data,t=e.words,i=8*this._nDataBytes,r=8*e.sigBytes;t[r>>>5]|=128<<24-r%32;const n=Math.floor(i/4294967296),s=i;t[15+(r+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),t[14+(r+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),e.sigBytes=4*(t.length+1),this._process();const o=this._hash,a=o.words;for(let c=0;c<4;c+=1){const e=a[c];a[c]=16711935&(e<<8|e>>>24)|4278255360&(e<<24|e>>>8)}return o}clone(){const e=super.clone.call(this);return e._hash=this._hash.clone(),e}}const d=r.Hasher._createHelper(l),u=r.Hasher._createHmacHelper(l)},function(e,t,i){i.r(t),i.d(t,"SHA256Algo",(function(){return u})),i.d(t,"SHA256",(function(){return h})),i.d(t,"HmacSHA256",(function(){return f}));var r=i(42);const n=[],s=[],o=e=>{const t=Math.sqrt(e);for(let i=2;i<=t;i+=1)if(!(e%i))return false;return true},a=e=>4294967296*(e-(0|e))|0;let c=2,l=0;for(;l<64;)o(c)&&(l<8&&(n[l]=a(c**.5)),s[l]=a(c**(1/3)),l+=1),c+=1;const d=[];class u extends r.Hasher{_doReset(){this._hash=new r.WordArray(n.slice(0))}_doProcessBlock(e,t){const i=this._hash.words;let r=i[0],n=i[1],o=i[2],a=i[3],c=i[4],l=i[5],u=i[6],h=i[7];for(let f=0;f<64;f+=1){if(f<16)d[f]=0|e[t+f];else{const e=d[f-15],t=(e<<25|e>>>7)^(e<<14|e>>>18)^e>>>3,i=d[f-2],r=(i<<15|i>>>17)^(i<<13|i>>>19)^i>>>10;d[f]=t+d[f-7]+r+d[f-16]}const i=r&n^r&o^n&o,p=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),g=h+((c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25))+(c&l^~c&u)+s[f]+d[f];h=u,u=l,l=c,c=a+g|0,a=o,o=n,n=r,r=g+(p+i)|0}i[0]=i[0]+r|0,i[1]=i[1]+n|0,i[2]=i[2]+o|0,i[3]=i[3]+a|0,i[4]=i[4]+c|0,i[5]=i[5]+l|0,i[6]=i[6]+u|0,i[7]=i[7]+h|0}_doFinalize(){const e=this._data,t=e.words,i=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(i/4294967296),t[15+(r+64>>>9<<4)]=i,e.sigBytes=4*t.length,this._process(),this._hash}clone(){const e=super.clone.call(this);return e._hash=this._hash.clone(),e}}const h=r.Hasher._createHelper(u),f=r.Hasher._createHmacHelper(u)},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.default=(e,t,i=1e4)=>Promise.race([fetch(e,t),new Promise(((e,t)=>setTimeout((()=>t(new Error("timeout"))),i)))])},function(e,t){angular.module("rainbow").factory("ConferenceParticipant",[function(){function e(e,t,i,r,n,s,o,a,c,l,d,u){let h=!(arguments.length>12&&void 0!==arguments[12])||arguments[12];this.participantId=e,this.userId=t,this.jid_im=i,this.jid_tel=r,this.role=n,this.mute=s,this.held=o,this.confStartDate=a,this.startDate=c,this.phoneNumber=l,this.state=d,this.delegateCapability=u,this.noMicrophone=!h,this.updateFromData=function(e){e.participantId&&(this.participantId=e.participantId),e.userId&&(this.userId=e.userId),this.jid_im=e.jid_im,e.jid_tel&&(this.jid_tel=e.jid_tel),this.role=e.participantRole?e.participantRole:this.role,this.confStartDate=e.confStartDate?e.confStartDate:this.confStartDate,this.startDate=e.startDate?e.startDate:this.startDate,this.phoneNumber=e.phoneNumber?e.phoneNumber:this.phoneNumber,this.state=e.participantState?e.participantState:this.state,this.noMicrophone=!e.microphone,this.mute=e.mute,this.held=e.held,this.delegateCapability=e.delegateCapability}}return e.createFromData=function(t){return new e(t.participantId,t.userId,t.jid_im,t.jid_tel,t.participantRole,t.mute,t.held,t.confStartDate,t.startDate,t.phoneNumber,t.participantState,t.delegateCapability,t.microphone)},e}])},function(e,t){angular.module("rainbowAdmin").factory("Offer",[function(){function e(t,i,r,n,s,o,a,c,l,d,u,h,f,p,g,m,v,S){this.id=t,this.name=i||"",this.displayName=this.name,m&&(this.name=this.name.replace(new RegExp("\\bDemo\\b"),"Custom")),this.description=r||"Rainbow "+this.name,this.groupName=p?"Conference":n||i,this.offerReference=s,this.profileId=o,this.canBeSold=a||false,this.businessModel=c,this.isDefault=l,this.isExclusive=d,this.isPrepaid=u,this.prepaidDuration=h,this.autoSubscribe=f,this.hasConference=p,this.hasVoice=g,this.isDemo=void 0===m?!this.isDefault&&!this.canBeSold&&this.name.toLowerCase().includes("custom"):m,this.isBundle=v,this.isChinaOffer=S,this.disallowUnsubscribeWithAllocatedLicences=this.hasVoice||"Room"===this.groupName,this.disallowAllocationToUsers="Room"===this.groupName,this.isEssential=function(){return this.isDefault},this.isBusiness=function(){return this.groupName.toLowerCase().includes("business")},this.isEnterprise=function(){return this.groupName.toLowerCase().includes("enterprise")},this.isAttendant=function(){return this.groupName.toLowerCase().includes("attendant")},this.isPremium=function(){return this.groupName.toLowerCase().includes("premium")},this.getLogoSvgId=function(){return e.getLogoSvgId()},this.getLogoColorName=function(){let e="default";return e=this.isEssential()?"essential":this.isExclusive?this.hasConference?"conference":this.isBusiness()?"business":this.isEnterprise()?"enterprise":this.isAttendant()?"attendant":this.isPremium()?"premium":"default":"default",e},this.isTrial=function(){return this.isDemo},this.isUserLicense=function(){return this.isDefault||"nb_users"===this.businessModel||"usage"===this.businessModel},this.isDeviceLicense=function(e){return"nb_users"===this.businessModel&&"TV"===e&&"Room"===this.groupName},this.isServiceLicense=function(){return"nb_services"===this.businessModel},this.isFixedLicense=function(){return"flat_fee"===this.businessModel},this.isUserBasedLicense=function(){return"nb_users"===this.businessModel},this.isUsageBasedLicense=function(){return"usage"===this.businessModel}}return e.createFromData=function(t){return new e(t.id,t.name,t.description,t.groupName,t.offerReference,t.profileId,t.canBeSold,t.businessModel,t.isDefault,t.isExclusive,t.isPrepaid,t.prepaidDuration,t.autoSubscribe,t.hasConference,t.hasVoice,t.isDemo,t.isBundle,t.isChinaOffer)},e.createFromSubscriptionData=function(t){return new e(t.offerId,t.offerName,t.offerDescription,t.groupName,t.offerReference,t.profileId,t.canBeSold,t.businessModel,t.isDefault,t.isExclusive,t.isPrepaid,t.prepaidDuration,t.autoSubscribe,t.hasConference,t.hasVoice,t.isDemo,t.isBundle,t.isChinaOffer)},e.createFromSubscriptionCountersData=function(t){return new e(t.offerId,t.offerName,void 0,t.groupName,t.offerReference,void 0,t.canBeSold,t.businessModel,t.isDefault,t.isExclusive,t.isPrepaid,t.prepaidDuration,void 0,t.hasConference,t.hasVoice,t.isDemo,t.isBundle)},e.createFromProfileData=function(t){return new e(t.offerId,t.offerName,void 0,void 0,void 0,t.profileId,false,void 0,t.isDefault,t.isExclusive,t.isPrepaid,t.prepaidDuration,void 0,t.hasConference,t.hasVoice,t.isDemo,t.isBundle)},e.createFromOperationLog=function(t){const i="delete"===t.operationType?t.previousData:t.newData;return new e(i.offerId,i.offerName,i.offerDescription,void 0,i.offerReference,i.profileId,i.canBeSold,i.businessModel,i.isDefault,i.isExclusive,i.isPrepaid,i.prepaidDuration,void 0,i.hasConference,i.hasVoice,i.isDemo,i.isBundle)},e.getLogoSvgId=function(){return"rainbow-offer--filled"},e.offerComparator=function(e,t){const i=["Essential","Business","Enterprise","Conference","Voice Business","Voice Enterprise","Voice Attendant","Voice Premium","Voice","Webinar"];if(e.isDefault)return-1;if(t.isDefault)return 1;let r=i.findIndex((function(t){return e.groupName.startsWith(t)})),n=i.findIndex((function(e){return t.groupName.startsWith(e)}));return r=-1===r?i.length:r,n=-1===n?i.length:n,r<n?-1:r>n?1:e.groupName<t.groupName?-1:e.groupName>t.groupName||e.isPrepaid&&!t.isPrepaid?1:!e.isPrepaid&&t.isPrepaid||e.name<t.name?-1:e.name>t.name?1:0},e.isExclusive=function(e){return e.isDefault||e.isExclusive},e.isOptional=function(t){return!e.isExclusive(t)},e.isEssential=function(e){return e.isDefault},e.isNotEssential=function(e){return!e.isDefault},e.isModelByNbUsers=function(e){return"nb_users"===e.businessModel},e.isPrepaid=function(e){return e.isPrepaid},e.isNotPrepaid=function(e){return!e.isPrepaid},e.isUserLicense=function(e){return e.isUserLicense()},e.isUsageBasedLicense=function(e){return e.isUsageBasedLicense()},e}])},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});t.RBNotification=class{constructor(e){this.date=e}}},function(e,t,i){i.r(t);var r=i(14);angular.module("rainbow").factory("VoiceMail",[function(){function e(){const e=r.ProfileService.getInstance();this.VMFlag=false,this.VMCounter=0,this.infoMsg="",this.voiceMailFeatureEnabled=e.isFeatureEnabled(e.FeaturesEnum.TELEPHONY_VOICE_MAIL),this.setVMFlag=function(e){this.VMFlag=e},this.getVMFlag=function(){return this.VMFlag},this.setVMCounter=function(e){e>0?(this.VMFlag=true,this.VMCounter=e):this.VMCounter=0},this.getVMCounter=function(){return this.VMCounter},this.setInfoMsg=function(e){this.infoMsg=e},this.getInfoMsg=function(){return this.infoMsg},this.getDisplayState=function(){return this.voiceMailFeatureEnabled}}return e.create=function(){return new e},e}])},function(e,t){angular.module("rainbowAdmin").factory("Bot",[function(){function e(e,t,i,r,n,s){this.jid=e,this.name=t,this.id=i,this.avatarId=r||i,this.lastAvatarUpdateDate=n,this.isAvatarCustomized=s}return e.create=function(t){return new e(t.jid,t.name,t.id,t.avatarId,t.lastAvatarUpdateDate,t.isBotAvatarCustomized)},e}])},function(e,t){angular.module("rainbow").factory("Site",[function(){function e(e,t,i,r,n,s){this.id=e,this.name=t||"",this.status=i||"",this.companyId=r||"",this.settings=n||"",angular.isDefined(s)&&(this.isCentrex=s)}return e.createFromData=function(t){return new e(t.id,t.name,t.status,t.companyId,t.settings,t.isCentrex)},e.create=function(t,i,r,n){return new e(t,i,r,n)},e.StatusValues=["active","alerting","hold","terminated"],e}])},function(e,t){angular.module("rainbow").factory("System",[function(){function e(t,i,r,n,s,o,a,c,l,d,u,h,f,p,g,m,v,S,b,y,C,w,_,E,T,I,P,A){this.id=t||null,this.type=a||null,this.type!==e.TypeEnum.CLOUD_PBX&&(this.jid_pbxagent=r||"",this.jid_password=n||"",this.jid_pbxagent_password=f||"",this.jid_pbxagent_password_activating=p||"",this.pbxMainBundlePrefix=s||["0"],this.usePbxMainBundlePrefix=!angular.isDefined(g)||g,this.pbxNumberingTranslator=m||[],this.pbxNationalPrefix=E,this.pbxInternationalPrefix=T),this.country=u||"FRA",this.name=h||"",d&&(this.siteId=d),i&&(this.pbxId=i),o&&(this.serverPingTimeout=o),c&&(this.status=c),l&&(this.version=l),angular.isDefined(v)&&(this.isCentrex=v),angular.isDefined(S)&&(this.isShared=S),b&&(this.bpId=b),angular.isDefined(C)&&(this.hasMediaPillar=C),angular.isDefined(I)&&(this.hasVnaLocation=I),angular.isDefined(w)&&(this.isOxoManaged=w),P&&(this.pbxLdapId=P),angular.isDefined(A)&&(this.blockedBy=A),y?(y.domainName&&(this.domainName=y.domainName),y.numberingDigits&&(this.numberingDigits=y.numberingDigits),y.numberingPrefixes&&(this.numberingPrefixes=y.numberingPrefixes),y.outgoingPrefix&&(this.outgoingPrefix=y.outgoingPrefix),y.externalTrunkId&&(this.externalTrunkId=y.externalTrunkId),y.installationNumber&&(this.installationNumber=y.installationNumber),y.installationNumberId&&(this.installationNumberId=y.installationNumberId),y.language&&(this.language=y.language),y.customSipHeader_1&&(this.customSipHeader_1=y.customSipHeader_1),y.customSipHeader_2&&(this.customSipHeader_2=y.customSipHeader_2),y.overflowSubscribersToVoicemail&&(angular.isDefined(y.overflowSubscribersToVoicemail.activate)&&(this.callOverflowToVMActivate=y.overflowSubscribersToVoicemail.activate),y.overflowSubscribersToVoicemail.noReplyDelay&&(this.callOverflowToVMNoReplyDelay=y.overflowSubscribersToVoicemail.noReplyDelay),angular.isDefined(y.overflowSubscribersToVoicemail.activateUnavailableOverflow)&&(this.callUnavailableOverflowToVMActivate=y.overflowSubscribersToVoicemail.activateUnavailableOverflow)),y.barringOptions&&(y.barringOptions.permissions&&(this.barringOptionsPermission=y.barringOptions.permissions),y.barringOptions.restrictions&&(this.barringOptionsRestriction=y.barringOptions.restrictions)),y.cliOptions&&(this.cliOptions=y.cliOptions),y.emergencyOptions&&(this.emergencyOptions=y.emergencyOptions),y.callForwardOptions&&(this.callForwardOptions=y.callForwardOptions),angular.isDefined(y.routeInternalCallsToPeer)&&(this.routeInternalCallsToPeer=y.routeInternalCallsToPeer),y.peerAuthenticationOptions&&(this.peerAuthenticationOptions=y.peerAuthenticationOptions),y.callForkingToPstnNumber&&(this.callForkingToPstnNumber=y.callForkingToPstnNumber),angular.isDefined(y.monolineIncomingMode)&&(this.monolineIncomingMode=y.monolineIncomingMode)):w&&_?(_.numberingDigits&&(this.numberingDigits=_.numberingDigits),_.numberingPrefix&&(this.numberingPrefix=_.numberingPrefix),_.outgoingPrefix&&(this.outgoingPrefix=_.outgoingPrefix),_.target&&(this.target=_.target),_.installationNumber&&(this.installationNumber=_.installationNumber),_.installationNumberId&&(this.installationNumberId=_.installationNumberId)):(this.numberingDigits=3,this.numberingPrefixes=["1"]),this.isExternalCallForwardAuthorized=function(){return this.callForwardOptions&&"authorized"===this.callForwardOptions.externalCallForward}}return e.createFromData=function(t){return new e(t.id,t.pbxId,t.jid_pbxagent,t.jid_password,t.pbxMainBundlePrefix,t.serverPingTimeout,t.type,t.status,t.version,t.siteId,t.country,t.name,t.jid_pbxagent_password,t.jid_pbxagent_password_activating,t.usePbxMainBundlePrefix,t.pbxNumberingTranslator,t.isCentrex,t.isShared,t.bpId,t.cloudpbx,t.hasMediaPillar,t.isOxoManaged,t.oxopbx,t.pbxNationalPrefix,t.pbxInternationalPrefix,t.hasVnaLocation,t.pbxLdapId,t.blockedBy)},e.create=function(){return new e},e.TypeValues=["oxe","oxo","third_party","cloud_pbx","oxo_managed"],e.TypeEnum={OXE:"oxe",OXO:"oxo",THIRD_PARTY:"third_party",CLOUD_PBX:"cloud_pbx",OXO_MANAGED:"oxo_managed"},e.StatusValues=["created","activating","activated"],e.CliPolicy={USER_DDI_NUMBER:"user_ddi_number",INSTALLATION_DDI_NUMBER:"installation_ddi_number"},e.CliPolicyValues=[e.CliPolicy.USER_DDI_NUMBER,e.CliPolicy.INSTALLATION_DDI_NUMBER],e}]),angular.module("rainbow").filter("serverTypeFilter",[function(){return function(e){return"oxo"===e?"OXO Connect":"oxe"===e?"OmniPCX Enterprise":"third_party"===e?"Third party PBX":"cloud_pbx"===e?"Cloud PBX":"oxo_managed"===e?"Managed OXO Connect":e}}]),angular.module("rainbow").filter("systemStateFilter",[function(){return function(e){return"created"===e||"activating"===e?"pending":"activated"===e?"systemStatusActivated":"connected"===e?"systemStatusConnected":"disconnected"===e?"systemStatusDisonnected":"degraded"===e?"systemStatusDegraded":"unknown"===e?"unknown":e}}]),angular.module("rainbow").filter("systemStateColorFilter",[function(){return function(e){return"created"===e||"activating"===e||"activated"===e?"color_blue":"connected"===e?"color_green":"disconnected"===e?"color_error":"degraded"===e||"unknown"===e?"color_warning":""}}]),angular.module("rainbow").filter("thirdPartySystemStateFilter",[function(){return function(e){return"created"===e||"activating"===e?"pending":"activated"===e?"systemStatusConnected":e}}]),angular.module("rainbow").filter("thirdPartySystemStateColorFilter",[function(){return function(e){return"created"===e||"activating"===e?"color_blue":"activated"===e?"color_green":""}}]),angular.module("rainbow").filter("cloudPbxStateFilter",[function(){return function(e){return"created"===e||"activated"===e?"systemStatusConnected":"disconnected"===e?"systemStatusDisonnected":"blocked"===e?"systemStatusBlocked":e}}]),angular.module("rainbow").filter("cloudPbxStateColorFilter",[function(){return function(e){return"created"===e||"activated"===e?"color_green":"disconnected"===e||"blocked"===e?"color_error":""}}]),angular.module("rainbow").filter("cloudPbxBarringOptionPermissionFilter",[function(){return function(e){return"default"===e?"same_than_company":"local"===e?"intraPBXCallsOnly":"nat_local"===e?"nationalAndIntraPBXCalls":"int_nat_local"===e?"internationalNationalAndIntraPBXCalls":e}}]),angular.module("rainbow").filter("cloudPbxBarringOptionRestrictionFilter",[function(){return function(e){return"default"===e?"same_than_company":"no_restriction"===e?"none":"surcharged_numbers"===e?"surchargedNumbers":"custom_numbers"===e?"customizedProhibitedNumbers":e}}]),angular.module("rainbow").filter("cloudPbxCliPolicyFilter",[function(){return function(e){return"user_ddi_number"===e?"userDDINumber":"installation_ddi_number"===e?"companyPhoneNumber":"other_ddi_number"===e?"otherDDINumber":e}}]),angular.module("rainbow").filter("ivrStateFilter",[function(){return function(e){return"active"===e?"systemStatusActive":"unknown"}}]),angular.module("rainbow").filter("ivrStateClassFilter",[function(){return function(e){return"active"===e?"color_green":"color_error"}}]),angular.module("rainbow").filter("cloudPbxAnnouncementProfileFilter",[function(){return function(e){return"all"===e?"allCalls":"external_only"===e?"externalCallsOnly":"internal_only"===e?"internalCallsOnly":e}}])},function(e,t){angular.module("rainbow").factory("SystemsGroup",[function(){function e(e,t,i,r){this.id=e||null,this.name=t,this.companies=i||[],this.systems=r,this.containsSystem=function(e){return!!this.systems&&this.systems.some((function(t){return t.systemId===e}))}}return e.createFromData=function(t){return new e(t.id,t.name,t.companies,t.systems)},e.create=function(t,i,r,n){return new e(t,i,r,n)},e}])},function(e,t,i){i.r(t);var r=i(63);angular.module("rainbow").factory("User",["Subscription",function(e){const t=r.UserInfoService.getInstance();function i(r,n){const s=this;i.attributes.forEach((function(e){r&&angular.isDefined(r[e.name])?s[e.name]=r[e.name]:!n&&angular.isDefined(e.defaultValue)&&(s[e.name]=e.defaultValue)})),this.subscriptions=[],this.updateFromData=function(e){i.attributes.forEach((function(t){angular.isDefined(e[t.name])&&(s[t.name]=e[t.name])}))},this.fillSubscriptionMap=function(){const e={};this.subscriptions.forEach((function(t){e[t.id]=t})),this.subscriptionMap=e},this.fillMainSubscriptionField=function(){const t=this.subscriptions.filter(e.isExclusive).sort(e.subscriptionComparator);let i;t.length>0&&(this.mainSubscription=t[t.length-1],this.mainSubscriptionName=this.mainSubscription.offerName,i=this.mainSubscriptionName,t.length>1&&(i=t.filter(e.isNotEssential).map((function(e){return e.offerName})).join(", ")));const r=this.subscriptions.filter(e.isOptional);let n;r.length>0&&(n=r.map((function(e){return e.offerName})).join(", ")),i?(this.subscriptionNames=i,n&&(this.subscriptionNames+=", "+n)):this.subscriptionNames=n||""},this.getMainSubscription=function(){return this.mainSubscription||this.fillMainSubscriptionField(),this.mainSubscription},this.getOptionalSubscriptions=function(){return this.subscriptions.filter(e.isOptional)},this.getMainSubscriptionName=function(){return this.mainSubscriptionName||this.fillMainSubscriptionField(),this.mainSubscriptionName},this.hasUserRoleOnly=function(){return 1===this.roles.length&&-1!==this.roles.indexOf(i.RoleValues.USER)},this.isGuest=function(){return-1!==this.roles.indexOf(i.RoleValues.GUEST)||this.guestMode},this.isAdmin=function(){return-1!==this.roles.indexOf(i.RoleValues.ADMIN)},this.isOrganizationAdmin=function(){return!!this.isAdmin()&&"organization_admin"===this.adminType},this.isSiteAdmin=function(){return!!this.isAdmin()&&"site_admin"===this.adminType},this.isCompanyAdmin=function(){return!!this.isAdmin()&&"company_admin"===this.adminType},this.isBPAdmin=function(){return this.isBPAdminOperations()||this.isBPAdminFinance()},this.isBPAdminOperations=function(){return-1!==this.roles.indexOf(i.RoleValues.BP_ADMIN_OPERATIONS)},this.isBPAdminFinance=function(){return-1!==this.roles.indexOf(i.RoleValues.BP_ADMIN_FINANCE)},this.isSuperadmin=function(){return-1!==this.roles.indexOf(i.RoleValues.SUPERADMIN)},this.isBusinessAdmin=function(){return-1!==this.roles.indexOf(i.RoleValues.BUSINESS_ADMIN)},this.isCustomerSuccessAdmin=function(){return-1!==this.roles.indexOf(i.RoleValues.CUSTOMER_SUCCESS_ADMIN)},this.isPublicChannelsAdmin=function(){return-1!==this.roles.indexOf(i.RoleValues.PUBLIC_CHANNELS_ADMIN)},this.isAllCompanyChannelsAdmin=function(){return-1!==this.roles.indexOf(i.RoleValues.ALL_COMPANY_CHANNELS_ADMIN)},this.isClosedChannelsAdmin=function(){return-1!==this.roles.indexOf(i.RoleValues.CLOSED_CHANNELS_ADMIN)},this.isWebinarHost=function(){return-1!==this.roles.indexOf(i.RoleValues.WEBINAR_HOST)},this.isDirectoryAdmin=function(){return-1!==this.roles.indexOf(i.RoleValues.DIRECTORY_ADMIN)},this.isGroupSupervisor=function(){return-1!==this.roles.indexOf(i.RoleValues.GROUP_SUPERVISOR)},this.isAttendantConsole=function(){return-1!==this.roles.indexOf(i.RoleValues.ATTENDANT_CONSOLE)},this.isRainbowTv=function(){return this.isTv||-1!==this.roles.indexOf(i.RoleValues.TV)},this.computeDisplayName=function(){const e=t.getNameInformation(this.firstName,this.lastName);this.displayName=e.displayName,this.initials=e.initials},this.getPhoneNumbers=function(e,t,i){return(this.phoneNumbers||[]).filter((i=>i.type===e&&i.deviceType===t)).filter((e=>!angular.isDefined(i)||Boolean(e.systemId)===i))},this.getSystemPhoneNumber=function(){return this.phoneNumbers?this.phoneNumbers.find((function(e){return angular.isDefined(e.systemId)&&e.isFromSystem})):void 0},this.isRvcpSubscriber=function(){const e=this.getSystemPhoneNumber();return e&&"RVCP Subscriber"===e.deviceName},this.isOxoSubscriber=function(){return this.getSystemPhoneNumber()},this.getActivePhoneNumber=function(e,t,i){const r=this.getPhoneNumbers(e,t,i);if(r.length>1){const e=r.find((function(e){return angular.isDefined(e.systemId)}));if(e)return e}return r[0]},this.getDdiPhoneNumber=function(e,t,i){const r=this.getPhoneNumbers(e,t,i);if(r.length>1){let e=r.find((function(e){return e.isCloudPbxDDI||e.isOxoPbxDDI}));if(e||(e=r.find((function(e){return e.isFromSystem}))),e)return e}return r[0]}}return i.createFromData=function(t,r){t&&t.roles&&t.roles.includes("private_channels_admin")&&t.roles.splice(t.roles.indexOf("private_channels_admin"),1,i.RoleValues.ALL_COMPANY_CHANNELS_ADMIN);const n=new i(t,r);return t.profiles&&(t.profiles.forEach((function(t){const i=e.createFromData(t);i.isTerminated()||n.subscriptions.push(i)})),n.fillMainSubscriptionField()),n.computeDisplayName(),n},i.create=function(){return new i},i.prune=function(e,t){const i=Object.assign({},e);return"RAINBOW"!==i.authenticationType&&"DEFAULT"!==i.authenticationType||delete i.authenticationExternalUid,i},i.VisibilityValues=["same_than_company","public","private"],i.PermissionValues=["same_than_company","enabled","disabled"],i.VmOverflowValues=["default","custom","disabled"],i.CliPolicy={COMPANY_POLICY:"company_policy",USER_DDI_NUMBER:"user_ddi_number",INSTALLATION_DDI_NUMBER:"installation_ddi_number",OTHER_DDI_NUMBER:"other_ddi_number"},i.CliPolicyValues=[i.CliPolicy.COMPANY_POLICY,i.CliPolicy.USER_DDI_NUMBER,i.CliPolicy.INSTALLATION_DDI_NUMBER,i.CliPolicy.OTHER_DDI_NUMBER],i.CliSelectionValues=["company_policy","authorized","not_authorized"],i.RoleValues={USER:"user",GUEST:"guest",SUPERADMIN:"superadmin",SUPPORT:"support",BUSINESS_ADMIN:"business_admin",CUSTOMER_SUCCESS_ADMIN:"customer_success_admin",ADMIN:"admin",BP_ADMIN_OPERATIONS:"bp_admin",BP_ADMIN_FINANCE:"bp_finance",DIRECTORY_ADMIN:"directory_admin",PUBLIC_CHANNELS_ADMIN:"public_channels_admin",ALL_COMPANY_CHANNELS_ADMIN:"all_company_channels_admin",CLOSED_CHANNELS_ADMIN:"closed_channels_admin",TV:"tv",WEBINAR_HOST:"webinar_host",GROUP_SUPERVISOR:"supervisor",ATTENDANT_CONSOLE:"attendant"},i.LoginPolicies=[{value:"RAINBOW",label:"rainbowLoginCredentials"},{value:"SAML",label:"ssoLoginCredentialsSAML",isSSO:true},{value:"OIDC",label:"ssoLoginCredentialsOIDC",isSSO:true},{value:"DEFAULT",label:"defaultLogin"}],i.attributes=[{name:"id",defaultValue:null},{name:"loginEmail",defaultValue:""},{name:"firstName",defaultValue:""},{name:"lastName",defaultValue:""},{name:"displayName",defaultValue:""},{name:"nickName",defaultValue:""},{name:"title",defaultValue:""},{name:"jobTitle",defaultValue:""},{name:"department",defaultValue:""},{name:"companyId",defaultValue:""},{name:"companyName",defaultValue:""},{name:"siteId",defaultValue:""},{name:"systemId",defaultValue:""},{name:"accountType",defaultValue:"free"},{name:"country",defaultValue:"FRA"},{name:"timezone",defaultValue:"Europe/Paris"},{name:"emails",defaultValue:[]},{name:"phoneNumbers",defaultValue:[]},{name:"roles",defaultValue:["user"]},{name:"adminType",defaultValue:"company_admin"},{name:"isActive",defaultValue:false},{name:"isInitialized",defaultValue:false},{name:"isTerminated",defaultValue:void 0},{name:"isTv",defaultValue:void 0},{name:"password",defaultValue:void 0},{name:"jid_im",defaultValue:""},{name:"jid_tel",defaultValue:""},{name:"language",defaultValue:"en"},{name:"lastAvatarUpdateDate",defaultValue:null},{name:"visibility",defaultValue:void 0},{name:"authenticationType",defaultValue:void 0},{name:"authenticationExternalUid",defaultValue:void 0},{name:"tags",defaultValue:void 0},{name:"userInfo1",defaultValue:void 0},{name:"userInfo2",defaultValue:void 0},{name:"tryNewUiCustomisation",defaultValue:void 0},{name:"softphoneOnlyCustomisation",defaultValue:void 0},{name:"fileSharingCustomisation",defaultValue:void 0},{name:"userTitleNameCustomisation",defaultValue:void 0},{name:"useRoomCustomisation",defaultValue:void 0},{name:"phoneMeetingCustomisation",defaultValue:void 0},{name:"useChannelCustomisation",defaultValue:void 0},{name:"useScreenSharingCustomisation",defaultValue:void 0},{name:"useWebRTCVideoCustomisation",defaultValue:void 0},{name:"useWebRTCAudioCustomisation",defaultValue:void 0},{name:"useSpeakingTimeStatistics",defaultValue:void 0},{name:"instantMessagesCustomisation",defaultValue:void 0},{name:"readReceiptsCustomisation",defaultValue:void 0},{name:"userProfileCustomisation",defaultValue:void 0},{name:"fileStorageCustomisation",defaultValue:void 0},{name:"overridePresenceCustomisation",defaultValue:void 0},{name:"changeSettingsCustomisation",defaultValue:void 0},{name:"changeTelephonyCustomisation",defaultValue:void 0},{name:"recordingConversationCustomisation",defaultValue:void 0},{name:"useGifCustomisation",defaultValue:void 0},{name:"useDialOutCustomisation",defaultValue:void 0},{name:"selectedAppCustomisationTemplate",defaultValue:void 0},{name:"guestMode",defaultValue:void 0},{name:"firstLoginDate",defaultValue:void 0},{name:"lastLoginDate",defaultValue:void 0},{name:"lastSeenDate",defaultValue:void 0},{name:"selectedDeviceFirmware",defaultValue:"same_as_company"},{name:"eLearningCustomisation",defaultValue:void 0},{name:"eLearningGamificationCustomisation",defaultValue:void 0}],i}]),angular.module("rainbow").filter("genericPermissionLabelFilter",[function(){return function(e){return"same_than_company"===e?"same_than_company":"enabled"===e?"authorized":"disabled"===e?"notAuthorized":e}}]),angular.module("rainbow").filter("phoneVmOverflowLabelFilter",[function(){return function(e){return"default"===e?"same_than_company":"custom"===e?"yes":"disabled"===e?"no":e}}]),angular.module("rainbow").filter("location911UserRightFilter",[function(){return function(e){return"same_as_company"===e?"same_as_company":"none"===e?"no":"all"===e?"yes":e}}]),angular.module("rainbow").filter("cloudPbxSubscriberCliPolicyFilter",[function(){return function(e){return"company_policy"===e?"same_than_company":"user_ddi_number"===e?"userDDINumber":"installation_ddi_number"===e?"companyPhoneNumber":"other_ddi_number"===e?"otherDDINumber":e}}]),angular.module("rainbow").filter("cloudPbxSubscriberCliSelectionFilter",[function(){return function(e){return"company_policy"===e?"same_than_company":"authorized"===e?"authorized":"not_authorized"===e?"notAuthorized":e}}]),angular.module("rainbowAdmin").filter("cloudPbxSubscriberCallForwardTypeFilter",[()=>function(e){return"immediate"===e?"callForwardUnconditional":"busy"===e?"callForwardOnBusy":"noreply"===e?"callForwardOnUnanswered":e}]),angular.module("rainbowAdmin").filter("cloudPbxSubscriberCallForwardDestinationTypeFilter",[()=>function(e){return e?"voicemail"===e?"voicemail":"internalNumber"===e?"internalNumber":"externalNumber"===e?"DDINumber":e:"doNotForwardCalls"}]),angular.module("rainbow").filter("softphoneOnlyPermissionLabelFilter",[function(){return function(e){return e&&"same_than_company"!==e?"enabled"===e?"softphoneOnly":"disabled"===e?"allServices":e:"same_than_company"}}]),angular.module("rainbow").filter("monolineIncomingModeFilter",[function(){return function(e){return"company_policy"===e?"same_than_company":"activated"===e?"Monoline":"not_activated"===e?"Multiline":e}}]),angular.module("rainbowAdmin").filter("cloudPbxSubscriberPersonalRoutinesFilter",[()=>function(e){return"At work"===e?"At work":"On break"===e?"On break":"Out of office"===e?"Out of office":"Do not disturb"===e?"Do not disturb":e}])},function(e,t){angular.module("rainbow").factory("Subscription",["Offer",function(e){function t(e,t,i,r,n,s,o,a,c,l,d,u,h,f,p,g,m,v,S,b,y,C,w,_,E,T,I,P,A,M,D,R,O,N,x){this.id=e,this.name=i,this.displayName=this.name,this.offerId=t,this.offerName=i||"",R&&(this.offerName=this.offerName.replace(new RegExp("\\bDemo\\b"),"Custom")),this.offerDescription=r||"Rainbow "+this.offerName,this.groupName=n||i,this.offerReference=s,this.profileId=o,this.profileName=a,this.maxNumberUsers=c,this.numberAssignedUsers=l,this.status=d,this.syncOngoing=u||false,this.updatingMaxNumberUsers=h,void 0!==f&&(this.nbBPLicences=f),void 0!==p&&(this.nbAssignedBPUsers=p),void 0!==g&&(this.nbLicencesAssignedToECs=g),void 0!==m&&(this.nbLicencesUsed=m),void 0!==v&&(this.nbFreeLicences=v),this.businessModel=S,this.canBeSold=b,this.isDefault=y,this.isExclusive=C,this.isPrepaid=w,this.offerPrepaidDuration=_||E,this.prepaidDuration=E,this.expirationDate=T,this.autoRenew=I,this.renewalTerm=P,this.prepaidRenewalOption=A,this.hasConference=M,this.hasVoice=D,this.isDemo=void 0===R?!this.isDefault&&!this.canBeSold&&this.offerName.toLowerCase().includes("custom"):R,this.isChinaOffer=O,this.purchaseOrderNumber=N,this.creationDate=x,this.isEnterprise=function(){return this.groupName.toLowerCase().includes("enterprise")},this.isBusiness=function(){return this.groupName.toLowerCase().includes("business")},this.isEssential=function(){return this.isDefault},this.isTrial=function(){return this.isDemo},this.isTerminated=function(){return"terminated"===this.status},this.isTerminating=function(){return"terminating"===this.status},this.isUserLicense=function(){return this.isDefault||"nb_users"===this.businessModel||"usage"===this.businessModel}}return t.createFromData=function(e){return new t(e.id?e.id:e.subscriptionId,e.offerId,e.offerName,e.offerDescription,e.groupName,e.offerReference,e.profileId,e.profileName,e.maxNumberUsers,e.numberAssignedUsers,e.status,e.syncOngoing,e.updatingMaxNumberUsers,e.nbBPLicences,e.nbAssignedBPUsers,e.nbLicencesAssignedToECs,e.nbLicencesUsed,e.nbFreeLicences,e.businessModel,e.canBeSold,e.isDefault,e.isExclusive,e.isPrepaid,e.offerPrepaidDuration,e.prepaidDuration,e.expirationDate,e.autoRenew,e.renewalTerm,e.prepaidRenewalOption,e.hasConference,e.hasVoice,e.isDemo,e.isChinaOffer,e.purchaseOrderNumber,e.creationDate)},t.PrepaidRenewalOptions={RENEW_BILLED:"billed",RENEW_ALLOCATED:"allocated"},t.subscriptionComparator=function(t,i){const r=new e(t.offerId,t.offerName,t.offerDescription,t.groupName,t.offerReference,t.profileId,t.canBeSold,t.businessModel,t.isDefault,t.isExclusive,t.isPrepaid,t.offerPrepaidDuration,t.autoSubscribe,t.hasConference,t.hasVoice,t.isDemo,t.isBundle,t.isChinaOffer),n=new e(i.offerId,i.offerName,i.offerDescription,i.groupName,i.offerReference,i.profileId,i.canBeSold,i.businessModel,i.isDefault,i.isExclusive,i.isPrepaid,i.offerPrepaidDuration,i.autoSubscribe,i.hasConference,i.hasVoice,i.isDemo,i.isBundle,i.isChinaOffer);return e.offerComparator(r,n)},t.isUserLicense=function(e){return e.isDefault||"nb_users"===e.businessModel||"usage"===e.businessModel},t.isTvLicense=function(e){return"Room"===e.groupName},t.excludeTvLicense=function(e){return!t.isTvLicense(e)},t.isExclusive=function(e){return e.isDefault||e.isExclusive},t.isOptional=function(e){return!t.isExclusive(e)},t.isEssential=function(e){return e.isDefault},t.isNotEssential=function(e){return!e.isDefault},t.isConference=function(e){return t.isOptional(e)&&(e.hasConference||"usage"===e.businessModel)},t.isNotConference=function(e){return t.isOptional(e)&&!(e.hasConference||"usage"===e.businessModel)},t.withUserLicenses=function(e){return e.isDefault||"usage"===e.businessModel||"nb_users"===e.businessModel&&e.maxNumberUsers>0},t.isPrepaid=function(e){return e.isPrepaid},t.isMonthly=function(e){return!e.isPrepaid},t}])},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{constructor(e){this.id=e.id,this.urls=e.urls,this.username=e.username,this.credential=e.credential}static createFromData(e){return new r(e)}}t.IceServer=r,angular.module("rainbowAdmin").factory("IceServer",(()=>r))},function(e,t){angular.module("rainbow").factory("PhoneNumber",[function(){function e(e,t,i,r,n,s,o,a,c,l,d,u,h,f,p,g,m,v,S,b,y,C,w,_,E,T,I,P,A,M,D,R){this.id=e,this.shortNumber=t,this.number=i,this.numberE164=r,this.pbxUserId=n,this.userId=s,this.type=o,this.deviceType=a,this.pbxId=c,this.isFromSystem=l,this.isMonitored=d,this.systemId=u,this.country=h,this.voiceMailNumber=f,this.deviceName=p,this.firstName=g,this.lastName=m,this.internalNumber=v,angular.isDefined(S)&&(this.isCloudPbxDDI=S),angular.isDefined(b)&&(this.isCloudPbxDefault=b),y&&(this.password=y),_&&(this.userDisplayName=_),angular.isDefined(C)&&(this.isOxoPbxDDI=C,this.isCloudPbxDDI=C),angular.isDefined(w)&&(this.isOxoPbxDefault=w,this.isCloudPbxDefault=w),E&&(this.overflowToVoicemail=E),T&&(this.barringOptions=T),I&&(this.cliOptions=I),P&&(this.recordingProfile=P),angular.isDefined(A)&&(this.monolineIncomingMode=A),angular.isDefined(M)&&(this.status=M),angular.isDefined(D)&&(this.cloudPbxStatus=D),angular.isDefined(R)&&(this.blockedBy=R)}return e.SelectTypeEnum={EXTENSION:"extension",EXTENSION_CLOUD:"extension-cloud",GROUP_CLOUD:"group-cloud",DDI_CLOUD:"ddi-cloud",FREE_DDI_CLOUD:"free-ddi-cloud",FREE_DDI_GROUP_CLOUD:"free-ddi-group-cloud"},e.createFromData=function(t){return new e(t.id?t.id:t.phoneNumberId,t.shortNumber,t.number,t.numberE164,t.pbxUserId,t.userId,t.type,t.deviceType,t.pbxId,t.isFromSystem,t.isMonitored,t.systemId,t.country,t.voiceMailNumber,t.deviceName,t.firstName,t.lastName,t.internalNumber,t.isCloudPbxDDI,t.isCloudPbxDefault,t.password,t.isOxoPbxDDI,t.isOxoPbxDefault,t.userDisplayName,t.overflowToVoicemail,t.barringOptions,t.cliOptions,t.recordingProfile,t.monolineIncomingMode,t.status,t.cloudPbxStatus,t.blockedBy)},e}])},function(e,t){angular.module("rainbow").service("errorHelperService",["$filter",function(e){const t=this;t.ErrorCodeLabels={"-1":"unknownError",0:"errorNoServerResponse",400:"Bad request",4e5:"Bad request",400210:"invalidPhoneNumber",400400:"errorWrongPassword",400500:"invalidFile",400504:"companyNameAlreadyExist",400505:"BPCompanyWithoutPaymentConfigurationData",400506:"NoActiveSubscriptionToOffer",400509:"errorDecreaseSubscriptionForbidden",400511:"ActiveDirectoryDomainAlreadyUsed",400514:"errorDecreaseSubscriptionForbidden",400552:"BPCompanyAndECCompanyMustNotBeSame",400601:"outboundAndInternalPrefixesCantBeIdentical",400973:"noCreateUserPermission",400975:"userAlreadyExistsInOtherCompany",400983:"userAlreadyExistsInOtherCompany",400990:"noUserFound",400993:"noUserFound",401:"Authorization failure",401102:"Authorization failure",401202:"errorInvalidToken",401500:"errorUnauthorized",401501:"errorLoginForbidden",401510:"errorUnauthorized",401520:"errorUserNotActive",401521:"errorUserNotActive",403:"Forbidden",403e3:"accessDeniedNotRequiredRole",403001:"accessDeniedNotOwner",403034:"cantDeselectDefaultWebRTCGateway",403035:"cantDeleteDefaultWebRTCGateway",403060:"confLockMsg",403072:"errorIsoMd5Mismatch",403153:"notAllowedToAccessMeeting",403154:"notAllowedToAccessMeeting",403200:"notAllowedToChangeRole",403203:"notAllowedToChangeRole",403204:"notAllowedToMoveExistingUserToThisCompany",403205:"notAllowedToManageUser",403301:"notAllowedToManageCompany",403303:"notAllowedOperation",403304:"notAllowedToAddAnotherAdmin",403311:"errorRemoveSyncOngoingSubscriptionForbidden",403315:"errorRemoveSubscriptionForbidden",403316:"errorRemoveAdminAllocatedSubscriptionForbidden",403317:"errorRemoveClientAllocatedSubscriptionForbidden",403318:"errorAllocatedSubscriptionRemoveForbidden",403335:"errorDecreasePrepaidSubscriptionForbidden",403400:"notAllowedDeleteAppOwner",403500:"notAllowedBlacklistedEmail",403501:"notAllowedBlacklistedEmail",403502:"notAllowedToInviteExternalContacts",403503:"NotAllowedSelfRegistrationEmail",403504:"notAllowedLoggedInUserEmail",403507:"notAllowedSupportEmail",403513:"companyNotABpCompany",403516:"companyNotABpCompany",403517:"companySeenAsTerminated",403518:"companyBpTypeIncompatible",403519:"companyAlreadyLinkedToBp",403520:"companyNotVadBp",403526:"isolatedUser",403531:"resetPasswordBlocked",403532:"resetPasswordForbidden",403608:"errorAssignSubscriptionSyncOngoing",403609:"errorAssignSubscriptionSyncOngoing",403610:"maxSubscriptionAllocationReached",403611:"notAllowedToCreateAnEquipment",403615:"maximumNumberConferenceParticipantsReach",403616:"subscriptionCompanyAdminEssentialAlreadyExists",403617:"roleCompanyAdminEssentialAlreadyExists",403620:"maximumNumberReached",403621:"MaximumNumberConvUsersReach",403624:"notAllowedRemoveService",403625:"errorAllocatedSubscriptionRemoveForbidden",403626:"restrictedConvAccess",403630:"uploadErrorMaxQuotaReached",403655:"userAlreadyCompanyMember",403670:"errorOperationForbiddenOnGuest",403683:"errorOtherOperationInProgress",403700:"errorDeleteSiteWithSystems",403701:"errorDeleteOrganisationLinkedCompany",403702:"errorDeleteCompanyWithSubscriptions",403703:"errorDeleteCompanyWithSites",403704:"errorDeleteCompanyWithUsers",403705:"errorDeleteCompanyStillTerminated",403706:"errorRemoveBusinessPartnerRole",403719:"externalTrunkChangeForbidden",403721:"numberingPlanCantBeUpdated",403722:"outgoingPrefixChangeForbidden",403723:"cannotRemoveCompanyPublicNumber",403724:"notAllowedDeleteCloudPbxWithPublicNumbers",403725:"notAllowedDeleteCloudPbxWithUsedExtensions",403762:"forbiddenOperationGroupUsedByAutomatedAttendantMenu",403770:"forbiddenOperationUserBelongsToGroup",403780:"forbiddenOperationUserAlreadyManager",403784:"forbiddenOperationGroupStillAssocToWelcome",403785:"forbiddenOperationUserStillAssocToWelcome",403786:"forbiddenOperationUserBelongsToGroup",403792:"errorDialInLicenseAssignment",403910:"errorOtherOperationInProgress",403911:"errorOtherOperationInProgress",404:"resourceNotFound",404e3:"resourceNotFound",404001:"resourceNotFoundUpdateImpossible",404002:"resourceNotFoundDeleteImpossible",404116:"archivedOrDeletedConversation",404300:"noValidOfferReferenceInACTISFile",404301:"offerNotFound",409e3:"errorConflict",409005:"inviteUsersError",409008:"emptyVoiceMessage",409011:"noMessagesToExport",409251:"DDIAlreadyAssociatedToCompany",409552:"internalNumberAlreadyUsed",409555:"publicNumberAlreadyExists",409557:"notAllowedDeleteUserAssociatedToCloudPbx",409600:"userAlreadyExist",409601:"invitationReSentConflict",409602:"userAlreadyNetworkMember",409603:"invitationReSentConflict",409620:"offerAlreadySubscribed",409623:"conferenceOfferAlreadySubscribed",409625:"errorUpdateSyncOngoingSubscriptionForbidden",409800:"companyNotIrBp",409801:"companyNotLinkedToBp",409802:"actisCompanyAdminMismatch",409803:"actisCompanyNameMismatch",413e3:"uploadErrorTooLarge",429:"tooManyRequests",500:"errorInternalServerError",1001:"extensionNotLinkedToEquipment",1002:"extensionHasNoIdentifier",1003:"extensionDoesNotExist",1004:"extensionLookupFailure",1005:"extensionConflict",1006:"nonUniqueEquipmentForExtension",1007:"userAlreadyAssociatedToExtension",1008:"extensionAssociatedToAnotherUser",1009:"failedToAttachExtension",1010:"userHasNoExtension",1011:"userHasTooManyExtensions",1012:"failedToDetachExtension",2001:"companyHasNoCloudPbx",2002:"extensionNumberNotCompatibleWithCloudPBXNumberingPlan",2003:"extensionNumberAlreadyAssignedToAnotherUser",2004:"userAlreadyAssignedToAnotherEquipment",2005:"failedToAssociateExtensionNumber",2006:"failedToUpdateExtensionNumber",2007:"noSipDeviceWithMacAddress",2008:"sipDeviceWithMacAddressBelongsToAnotherCompany",2009:"sipDeviceWithMacAddressAttachedToAnotherUser",2010:"anotherSipDeviceWithMacAddressAttachedToUser",2011:"cannotManageSipDeviceForUserWithoutExtensionNumber",2012:"failedToAttachSipDeviceToUser",2013:"cannotManagePublicNumberForUserWithoutExtensionNumber",2014:"publicNumberDoesNotExist",2015:"publicNumberAlreadyAssociatedToAnotherUser",2016:"anotherPublicNumberIsAttachedToUser",2017:"failedToAttachPublicNumberToUser",2018:"failedToDetachExtensionNumberNotProvided",2019:"userAttachedToAnotherExtensionNumber",2020:"cannotDetachPublicNumberFromUserWithoutExtensionNumber",2021:"failedToDetachPublicNumberFromUser",2022:"failedToDetachSipDeviceFromUser"},t.portalErrorCodeLabels={subscription:{403614:"forbiddenDurationChangeBecausePriceChanges"},massprovisioning:{4e5:"invalidValue",400501:"invalidFile",400502:"invalidColumnName",400504:"invalidFile",400505:"invalidValueInActionColumn",400506:"invalidValueInActionColumn",400508:"noDataToImport",400600:"deviceTypeCannotBeUpdated",400601:"duplicateDeviceIds",400602:"duplicateMacAdresses",400603:"invalidDeviceTypes",400604:"missingDeviceTypeInLines",400605:"invalidEquipment",400972:"noCreateUserPermission",400973:"noCreateUserPermission",400980:"noUpdateUserPermission",400981:"noUpdateUserPermission",400990:"noDeleteUserPermission",400991:"noDeleteUserPermission",400994:"noUserFound",403610:"errorMaxSubscriptionReached",403622:"userDoesNotHaveVoiceLicense",404600:"deviceDoesNotExist",404601:"noCloudPbxInCompany"},rvcpprovisioning:{403622:"noVoiceLicenceAllocatedToUser",403684:"overflowConfigurationChangesStillInProgress",403694:"forbiddenOperationEquipmentHasGroups",403695:"publicNumberAlreadyDefault",403699:"forbiddenOperationEquipmentHasWelcomeService",403728:"forbiddenOperationEquipmentHasDevices",403739:"forbiddenOperationWelcomeServiceUsed",403744:"forbiddenOperationUserAlreadyAssocToWelcome",403745:"forbiddenOperationGroupAlreadyAssocToWelcome",403752:"forbiddenOperationMoreThanThreeConsecutiveMenus",403754:"forbiddenOperationMenuLinkedToAnotherMenu",403761:"forbiddenOperationUserLinkedToAutomatedAttendantMenu",403765:"forbiddenOperationMenuAlreadyLinkedToAnotherMenu",403767:"forbiddenOperationSubMenuLinkedToItsParent",409253:"forbiddenOperationCantAssignDeviceToAttendantUser",409556:"companyHasAlreadyACloudPbx",409560:"macAddressAlreadyUsed",409561:"deviceStillUsedByUser",409562:"deviceAlreadyUsed",409563:"deviceAlreadyUsedByAnotherSystem",409565:"forbiddenOperationCallForkingToPublicNumberUsedByCloudPbx",413e3:"fileTooLarge",415e3:"audioFileTypeNotSupported"},authentication:{401102:"Authorization failure",401103:"Authorization failure",401500:"Authorization failure",401520:"Forbidden",401521:"Forbidden",401522:"Forbidden",401523:"Forbidden",401530:"Authorization failure",401600:"Authorization failure",401700:"Authorization failure",403e3:"Authorization failure",5e5:"errorInternalServerError",503e3:"resourceNotFound"}},t.handleErrorMessage=function(e,i){t.getErrorFullMessage(e,i)},t.handleError=function(i,r){const n=t.getPortal(i);let s=i.status;i.data&&i.data.errorDetailsCode&&(s=i.data.errorDetailsCode);const o=new Error(t.getDetailedErrorMessage(i));return o.status=i.status,o.fieldErrors=t.getBadRequestFieldErrors(i),o.errorDetailsCode=s,o.errorDetailsLabel=t.getErrorCodeLabel(s,n),o.errorDetailsData=t.getErrorDetailsData(i,r),o.fieldErrors&&Object.keys(o.fieldErrors).length>0?o.translatedMessage=e("translate")("someFieldValuesAreInvalid"):o.translatedMessage=t.getTranslatedErrorMessage(i,r,n),o.portal=n,o},t.getPortal=function(e){const t=e.config?e.config.url:void 0,i=t?t.match(/api\/rainbow\/(\w+)\//):void 0;return i?i[1]:void 0},t.getBadRequestFieldErrors=function(e){const i={},r=e.data?e.data.errorDetails:null,n=e.data?e.data.errorDetailsCode:null,s=e.data?e.data.errorDetailsData:null;return 400===e.status?(r&&(r instanceof Array?r.forEach((function(e){i[e.param]||(i[e.param]={ok:false,message:e.msg,value:e.value})})):r.param&&(i[r.param]||(i[r.param]={ok:false,message:r.msg,value:r.value}))),400511===n&&(i.office365Tenant={ok:false,message:t.ErrorCodeLabels[400511]}),400601===n&&(i.outgoingPrefix={ok:false,message:t.ErrorCodeLabels[400601]},i.numberingPrefix={ok:false,message:t.ErrorCodeLabels[400601]})):409===e.status&&409e3===n&&s&&(s.loginEmail&&(i.loginEmail={ok:false,label:"userAlreadyExist"}),s.authenticationExternalUid&&(i.authenticationExternalUid={ok:false,label:"userIdAlreadyUsed"})),i},t.getServerErrorMessage=function(i){let r=t.getStatusErrorMessage(i);return i.data&&i.data.errorMsg&&(r="",i.data.errorDetails?i.data.errorDetails instanceof Array?r+=e("translate")("one or more fields are invalid"):i.data.errorDetails.msg?r+=i.data.errorDetails.msg:r+=i.data.errorDetails:r+=i.data.errorMsg),r},t.getStatusErrorMessage=function(e){let t;return t=500===e.status?"Internal server error":-1===e.status?"Service unavailable":415===e.status?"Unsupported Media Type":413===e.status?"Request Entity Too Large":404===e.status?"Resource not found":403===e.status?"Access is forbidden":401===e.status?"Authorization failure":400===e.status?"Bad request":429===e.status?"Too many requests":e.statusText?e.statusText:"Unknown error",t},t.getDetailedErrorMessage=function(e){let i=t.getServerErrorMessage(e);return e.data&&e.data.errorDetailsData&&"string"==typeof e.data.errorDetailsData&&(i+=" "+e.data.errorDetailsData),e.data&&e.data.errorDetails&&e.data.errorDetails instanceof Array&&e.data.errorDetails.length>0&&(i+=" : "+e.data.errorDetails[0].msg),i},t.getErrorDetailsData=function(e,t){let i;return i=e.data&&e.data.errorDetailsData&&"object"==typeof e.data.errorDetailsData?Object.assign({},e.data.errorDetailsData,t):t,i},t.getTranslatedErrorMessage=function(e,i,r){if(500===e.status)return t.getLocalizedError("500");let n=null;n=e.data&&e.data.errorDetailsCode&&e.data.errorDetailsCode>0?e.data.errorDetailsCode:e.status;const s=t.getErrorDetailsData(e,i);return t.getTranslatedErrorMessageByDetailsCode(n,s,t.getServerErrorMessage(e),r)},t.getTranslatedErrorMessageByDetailsCode=function(i,r,n,s){let o,a;return i&&(o=t.getLocalizedError(i,r,s)),n&&(a=t.getErrorMessageWithoutIds(n)),o?"massprovisioning"===s&&(i?o+=a?". "+e("translate")("errorServerDetails",{errorcode:i,errormsg:a}):". "+e("translate")("errorServerDetails",{errorcode:i}):a&&(o+=". "+e("translate")("errorServerDetails",{errormsg:a}))):i?a?(o=e("translate")("anErrorOccurred"),o+=". "+e("translate")("errorServerDetails",{errorcode:i,errormsg:a})):o=e("translate")("anErrorOccurred",{errorcode:i}):(o=e("translate")("anErrorOccurred"),a&&(o+=". "+e("translate")("errorServerDetails",{errormsg:a}))),o},t.getLocalizedError=function(i,r,n){let s;if(i){const o=t.getErrorCodeLabel(i,n);if(o){const t=e("translate")(o,r);t!==o&&(s=t)}}return s},t.getErrorCodeLabel=function(e,i){return i&&t.portalErrorCodeLabels[i]&&t.portalErrorCodeLabels[i][e]?t.portalErrorCodeLabels[i][e]:t.ErrorCodeLabels[e]},t.getErrorFullMessage=function(e,t){let i=t?t+" failure : ":"";e&&e.data?(i+=e.data.errorMsg,e.data.errorDetails&&(i+=" - ",e.data.errorDetails instanceof Array?e.data.errorDetails.forEach((function(e){i+=e.msg})):e.data.errorDetails.msg?i+=JSON.stringify(e.data.errorDetails.msg):i+=e.data.errorDetails)):i+="Unknow error - Something goes really wrong";let r="";return e&&e.headers&&(r=e.headers("x-rainbow-request-id"),i+=" x-rainbow-request-id = "+r),i},t.getErrorMessageWithoutIds=function(e){return e?e.replaceAll(new RegExp("\\s[\\d]{1}[a-f\\d]{23}","g"),""):e}}])},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(8),n=i(4),s=i(13),o=i(9),a=i(30),c=i(6),l=i(67),d=i(110),u=i(43),h=i(411),f=i(56),p=i(17),g=i(166),m=i(108),v=i(18),S=i(7),b=i(11);class y{constructor(e){this.webinarService=e,this.startConferencePromiseResolvers={},this.activeWebinar=null,this.activeWebinarSubject=new S.Subject,this.connected=true,this.reconnectingSessionIds=[],this.authService=r.AuthService.getInstance(),this.logger=n.LoggerService.getInstance(),this.xmppService=o.XmppService.getInstance(),this.roomService=a.RoomService.getInstance(),this.contactService=c.ContactService.getInstance(),this.errorHelperService=s.ErrorHelperService.getInstance(),this.virtualBackgroundService=l.VirtualBackgroundService.getInstance(),this.eventService=b.EventService.getInstance(),this.webrtcConfigAndUtils=u.WebrtcConfigAndUtils.getInstance(),this.speechRecognitionService=h.SpeechRecognitionService.getInstance(),this.utilitiesService=d.UtilitiesService.getInstance(),this.deviceManagementService=f.DeviceManagementService.getInstance(),this.mainService=p.MainService.getInstance(),this.groupChatListener=null,this.conferenceListener=null,this.xmppJingleListener=null,this.xmppStagingListener=null,this.isInteractEventSent=false,this.subscribeToPublisherPromiseResolvers={}}static create(e){return new y(e)}async reconnect(){try{this.attachListeners(),this.activeWebinar&&(this.activeWebinar=await this.webinarService.getWebinar(this.activeWebinar.id),this.activeWebinar.session&&(await this.disconnectParticipant(this.activeWebinar,this.contactService.userContact.dbId),this.activeWebinarSubject.next(v.RBEvent.create("ON_ACTIVE_WEBINAR_RECONNECT",{webinar:this.activeWebinar})))),this.logger.info("[WebinarConferenceService] reconnect -- success")}catch(e){this.logger.error("[WebinarConferenceService] reconnect -- failure -- "+e)}}attachListeners(){this.groupChatListener&&this.xmppService.connection.deleteHandler(this.groupChatListener),this.groupChatListener=this.xmppService.connection.addHandler((e=>(this.onGroupchatMessage(e),true)),"jabber:iq:notification","message","groupchat"),this.conferenceListener&&this.xmppService.connection.deleteHandler(this.conferenceListener),this.conferenceListener=this.xmppService.connection.addHandler((e=>(this.onConferenceMessage(e),true)),"jabber:iq:conference:2","message",null),this.xmppJingleListener&&this.xmppService.connection.deleteHandler(this.xmppJingleListener),this.xmppJingleListener=this.xmppService.connection.addHandler((e=>(this.onXmppJingleMessage(e),true)),"urn:xmpp:jingle-message:0","message",null),this.xmppServiceSubscription&&(this.xmppServiceSubscription.unsubscribe(),this.xmppServiceSubscription=null),this.xmppServiceSubscription=this.xmppService.connection.jingle.rxSubject.subscribe((e=>{this.onJingleMessage(e)})),this.videoServiceSubscription&&(this.videoServiceSubscription.unsubscribe(),this.videoServiceSubscription=null),this.videoServiceSubscription=this.webinarService.webrtcP2PService.subscribe((e=>{this.onVideoServiceEvent(e)})),this.xmppConnectionSubscription&&(this.xmppConnectionSubscription.unsubscribe(),this.xmppConnectionSubscription=null),this.xmppConnectionSubscription=this.xmppService.subscribeToConnectionEvents((e=>{this.onXmppConnectionChangeEvent(e)})),this.xmppStagingListener&&this.xmppService.connection.deleteHandler(this.xmppStagingListener),this.xmppStagingListener=this.xmppService.connection.addHandler((e=>(this.onAskStagingMessage(e),true)),"http://jabber.org/protocol/commands","message"),this.replaceBackgroundSubscription&&(this.replaceBackgroundSubscription.unsubscribe(),this.replaceBackgroundSubscription=null),this.replaceBackgroundSubscription=this.virtualBackgroundService.rxSubject.subscribe((e=>{this.onReplaceBackgroundChangeEvent(e)})),this.deviceManagementSubscription&&(this.deviceManagementSubscription.unsubscribe(),this.deviceManagementSubscription=null),this.deviceManagementSubscription=this.deviceManagementService.subscribe((e=>{this.onMediaDeviceChangeEvent(e)}))}async join(e){try{if(e.session&&this.logger.info("[WebinarConferenceService] join -- existing session object"),e.session||(this.logger.info("[WebinarConferenceService] join -- no session object -- try to create from room session info"),this.webinarService.createWebinarSession(e,"join")),!e.session&&(e.isOrganizer||e.isSpeaker)){this.logger.info("[WebinarConferenceService] join -- no info in room -- orga or speaker -- start a new session");try{await this.startSession(e)}catch(t){}}if(e.session&&!e.session.localParticipant){const i=new Promise((e=>{this.joinPromiseResolver=e}));try{await this.joinSession(e)}catch(t){try{if(this.logger.info(`[WebinarConferenceService] join failure -- ${t.message} -- Retry once !!!`),await this.disconnectParticipant(e,this.webinarService.userContact.dbId),!e.session)try{await this.startSession(e)}catch(dp){}e.session||this.webinarService.createWebinarSession(e,"join")}catch(dp){}await this.joinSession(e)}await i}return this.activeWebinar=e,this.activeWebinarSubject.next(v.RBEvent.create("ON_ACTIVE_WEBINAR",{webinar:e})),this.contactService.setBusyState("dnd","sharing"),this.logger.info(`[WebinarConferenceService] join -- ${e.id} -- success`),e}catch(t){throw this.logger.error("[WebinarConferenceService] join -- "+t.message),t}}async leave(e,t=false,i=false){try{if(!e.session)throw new Error("no session");if(i)this.webinarService.conference.putOnStage(e,this.webinarService.userContact.dbId,"participant",false),t?this.stopSession(e):this.disconnectParticipant(e,this.webinarService.userContact.dbId);else{try{await this.webinarService.conference.putOnStage(e,this.webinarService.userContact.dbId,"participant",false)}catch(r){}if(t)try{await this.stopSession(e)}catch(r){}else try{await this.disconnectParticipant(e,this.webinarService.userContact.dbId)}catch(r){}}return this.removeActiveWebinar(e),this.ackAllMessages(e),e.hideRecordInfo=false,this.logger.info(`[WebinarConferenceService] leave -- ${e.id} -- success`),e}catch(r){throw this.logger.error("[WebinarConferenceService] leave -- "+r.message),r}}removeActiveWebinar(e){this.activeWebinar&&e.id===this.activeWebinar.id&&(this.activeWebinar=null,this.activeWebinarSubject.next(v.RBEvent.create("ON_ACTIVE_WEBINAR",{webinar:null})),this.eventService.publish("CHECK_AND_RESET_BUSY_STATE"))}async addLocalMedia(e,t){try{const i=e.session.localParticipant;if(!i)return this.logger.info(`[WebinarConferenceService] addLocalMedia -- ${e.id} -- ${t} -- failure -- noLocalParticipant`),e.rxInfoSubject.next(v.RBEvent.create("error","webinarDisconnected")),e;if("audio"===t&&!i.medias.audio||"video"===t&&!i.medias.video||"audio+video"===t&&!i.medias.audio&&!i.medias.video)if(i.audioVideoSession){let r=i.audioVideoSession.localStreams.pop();r.getTracks().forEach((e=>{e.enabled=false,e.stop(),e=null})),r.stop&&r.stop(),r=null,i.audioVideoSession.removeStream();let n=[t];"audio"===t&&i.medias.video&&(n=["audio","video"]),"video"===t&&i.medias.audio&&(n=["audio","video"]);const s=await this.webinarService.webrtcP2PService.getBrowserMedia(n,null,null,null,e),o=await this.virtualBackgroundService.startProcessStream(s,"WebinarConferenceService");i.audioVideoSession.localStreams.push(o),await i.audioVideoSession.addBundleStream(o),"video"===t&&await i.audioVideoSession.contentAdd("video",true),n.forEach((e=>{i.medias[e]=true})),i.audioVideoStream=o,i.originalAudioVideoStream=s}else{const r="audio+video"===t?["audio","video"]:[t],n=await this.webinarService.webrtcP2PService.getBrowserMedia(r,null,null,null,e),s=await this.virtualBackgroundService.startProcessStream(n,"WebinarConferenceService");this.xmppService.connection.jingle.initiateBundle(e.session.jingleJid,this.xmppService.connection.jid,s,e.roomId),i.audioVideoStream=s,i.originalAudioVideoStream=n,r.forEach((e=>{i.medias[e]=true}))}return"sharing"!==t||i.medias.sharing||this.webinarService.webrtcP2PService.askToAddSharing("webinar_"+e.id,true)||await this.getSharingMedia(e,true),this.logger.info(`[WebinarConferenceService] addLocalMedia -- ${e.id} -- ${t} -- success`),e}catch(i){throw this.logger.error(`[WebinarConferenceService] addLocalMedia -- ${e.id} -- ${t} -- ${i.message}`),e.rxInfoSubject.next(v.RBEvent.create("error","cameraNotAvailable")),i}}async getSharingMedia(e,t=true){const i=await this.webinarService.webrtcP2PService.getBrowserMedia(["sharing"],null,null,25,e,t);if(0===i.getAudioTracks().length){const e=i.getVideoTracks()[0],t=e.getConstraints();t.frameRate=this.webrtcConfigAndUtils.videoQualityConfiguration.sharing.fixedFrameRate,e.applyConstraints(t)}e.session.localParticipant.sharingSession=this.xmppService.connection.jingle.initiate(e.session.jingleJid,this.xmppService.connection.jid,"sharing",[i],null,e.roomId),e.session.localParticipant.sharingStream=i,e.session.localParticipant.medias.sharing=true}async removeLocalMedia(e,t){try{const i=e.session.localParticipant;if("audio"===t&&i.medias.audio||"video"===t&&i.medias.video){this.disableAudioVideoMedia(e);let r=null;"audio"===t&&i.medias.video&&(r=["video"]),"video"===t&&i.medias.audio&&(r=["audio"]),r||(this.webrtcConfigAndUtils.disableAllStreamsForSession(i.audioVideoSession),this.xmppService.connection.jingle.terminate(i.audioVideoSession.sid),i.audioVideoSession=null,i.audioVideoStream=null,i.originalAudioVideoStream=null,this.logger.info(`[WebinarConferenceService] removeLocalMedia -- ${e.id} -- ${t} -- success`));const n=await this.webinarService.webrtcP2PService.getBrowserMedia(r,null,null,null,e),s=await this.virtualBackgroundService.startProcessStream(n,"WebinarConferenceService");i.audioVideoSession.localStreams.push(s),await i.audioVideoSession.addBundleStream(s),await i.audioVideoSession.contentRemove("video",true),i.audioVideoStream=s,i.originalAudioVideoStream=n,i.medias[t]=false,i.medias.video||this.virtualBackgroundService.stopProcessStream()}return"sharing"===t&&i.medias.sharing&&(i.sharingOnStage&&await this.webinarService.conference.putOnStage(e,i.id,"sharing",false),this.webrtcConfigAndUtils.disableAllStreamsForSession(i.sharingSession),this.xmppService.connection.jingle.terminate(i.sharingSession.sid),i.sharingSession=null,i.sharingStream=null,i.medias.sharing=false),this.logger.info(`[WebinarConferenceService] removeLocalMedia -- ${e.id} -- ${t} -- success`),e}catch(i){throw this.logger.error(`[WebinarConferenceService] removeMedia -- ${e.id} -- ${t} -- ${i.message}`),i}}async removeAllLocalMedias(e){try{const t=e.session.localParticipant;return await this.webinarService.conference.putOnStage(e,t.id,"participant",false),this.webrtcConfigAndUtils.disableAllStreamsForSession(t.audioVideoSession),this.xmppService.connection.jingle.terminate(t.audioVideoSession.sid),t.audioVideoSession=null,t.audioVideoStream=null,t.originalAudioVideoStream=null,t.sharingOnStage&&await this.webinarService.conference.putOnStage(e,t.id,"sharing",false),this.webrtcConfigAndUtils.disableAllStreamsForSession(t.sharingSession),this.xmppService.connection.jingle.terminate(t.sharingSession.sid),t.sharingSession=null,t.sharingStream=null,t.medias.sharing=false,this.logger.info(`[WebinarConferenceService] removeAllLocalMedias -- ${e.id} -- success`),e}catch(t){throw this.logger.error(`[WebinarConferenceService] removeAllLocalMedias -- ${e.id} -- ${t.message}`),t}}async muteParticipant(e,t,i=true,r=false){try{if(!r&&t===e.session.localParticipant.id&&e.session.localParticipant.mute===i)return e;const n=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.roomId}/users/${t}`,s=this.authService.getPostHeader(),o=JSON.stringify({option:i?"mute":"unmute"}),a=await fetch(n,{method:"PUT",headers:s,body:o});if(!a.ok)throw a;return this.logger.info(`[WebinarConferenceService] muteParticipant -- ${t} -- ${i} -- ${e.id} -- success`),e}catch(n){const e=await this.errorHelperService.getErrorInfo(n,"muteParticipant");throw this.logger.error("[WebinarConferenceService] "+e.message),e.error}}async updateParticipantLevels(e,t,i,r,n=true,s=false){try{let o=n?2:0,a=1;if(!r)return e;if(r>=1024&&(a=2),r<=320&&(a=0,o=0),s&&(a=2,o=2),a!==t.subStreamLevel||t.temporalLevel!==o){const r=a,n=o;t.temporalLevel=o,t.subStreamLevel=a;const s=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.roomId}/users/${e.session.localParticipant.id}`,c=this.authService.getPostHeader(),l={option:"update",media:i,temporalLevel:o,subStreamLevel:a,publisherId:t.id},d=await fetch(s,{method:"PUT",headers:c,body:JSON.stringify(l)});if(!d.ok)throw t.temporalLevel=n,t.subStreamLevel=r,d;this.logger.info(`[WebinarConferenceService] updateParticipantLevels -- ${e.id} -- ${t.id} -- ${i} -- substream: ${a} -- temporal: ${o} -- success`),t.rxSubject.next(v.RBEvent.create("subStreamLevel",{type:i}))}return e}catch(o){const t=await this.errorHelperService.getErrorInfo(o,"updateParticipantLevels");return this.logger.error("[WebinarConferenceService] "+t.message),e}}async putOnStage(e,t,i,r,n=false,s=false){try{const o={};[e.session.localParticipant].concat(e.session.speakerParticipants).forEach((e=>{e.onStage&&(o[e.id+"_participant"]={userId:e.id,type:"participant",properties:["staged"]}),e.sharingOnStage&&(o[e.id+"_sharing"]={userId:e.id,type:"sharing",properties:["staged"]})}));let a=o[`${t}_${i}`];a||(a=o[`${t}_${i}`]={userId:t,type:i}),e.session.masterMedia&&(n?"sharing"===i&&e.session.masterMedia.includes("sharing")?o[e.session.masterMedia].properties=["staged"]:o[e.session.masterMedia].properties=[s?"staged":"backstaged"]:o[e.session.masterMedia].properties=["master"]),a.properties=[n&&r?"master":r?"staged":"backStaged"];const c=JSON.stringify({actors:Object.keys(o).map((e=>o[e]))}),l=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.roomId}/stage`,d=this.authService.getPostHeader(),u=await fetch(l,{method:"PUT",headers:d,body:c});if(!u.ok)throw u;return this.logger.info(`[WebinarConferenceService] putOnStage -- ${e.id} -- ${t} -- ${i} -- ${r} -- ${n} -- success`),e}catch(o){throw(await this.errorHelperService.getErrorInfo(o,"putOnStage")).error}}async startWebinar(e){try{const t=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.roomId}/update`,i=this.authService.getPostHeader(),r=JSON.stringify({option:"webinar"}),n=await fetch(t,{method:"PUT",headers:i,body:r});if(!n.ok)throw n;return this.logger.info(`[WebinarConferenceService] startWebinar -- ${e.id} -- success`),e}catch(t){throw(await this.errorHelperService.getErrorInfo(t,"startWebinar")).error}}async stopWebinar(e){try{const t=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.roomId}/stop`,i=this.authService.getRequestHeader(),r=await fetch(t,{method:"DELETE",headers:i});if(!r.ok)throw r;return this.logger.info(`[WebinarConferenceService] stopWebinar -- ${e.id} -- success`),e}catch(t){const i=await this.errorHelperService.getErrorInfo(t,"stopWebinar");return this.logger.error(`[WebinarConferenceService] stopWebinar -- ${e.id} -- failure -- ${i.error.message}`),e}}async raiseHand(e,t){try{const i=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.roomId}/users/${t}/raise-hand`,r=this.authService.getPostHeader(),n=await fetch(i,{method:"PUT",headers:r});if(!n.ok)throw n;return this.logger.info(`[WebinarConferenceService] raiseHand -- ${e.id} -- success`),e.session.localParticipant.raiseHand=true,e.session.localParticipant.rxSubject.next(v.RBEvent.create("raiseHand",true)),e.rxParticipantsSubject.next(),e}catch(i){throw(await this.errorHelperService.getErrorInfo(i,"raiseHand")).error}}async lowerHand(e,t){try{const i=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.roomId}/users/${t}/lower-hand`,r=this.authService.getPostHeader(),n=await fetch(i,{method:"PUT",headers:r});if(!n.ok)throw n;return this.logger.info(`[WebinarConferenceService] lowerHand -- ${e.id} -- success`),e.session.localParticipant.raiseHand=false,e.session.localParticipant.rxSubject.next(v.RBEvent.create("raiseHand",false)),e.rxParticipantsSubject.next(),e}catch(i){throw(await this.errorHelperService.getErrorInfo(i,"lowerHand")).error}}async allowAttendeeToTalk(e,t){try{const i=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.roomId}/users/${t}/allow-talk`,r=this.authService.getPostHeader(),n=await fetch(i,{method:"PUT",headers:r});if(!n.ok)throw n;this.logger.info(`[WebinarConferenceService] allowAttendeeToTalk -- ${e.id} -- ${t} -- success`);const s=e.session.getParticipantById(t);return s.raiseHand=false,s.rxSubject.next(v.RBEvent.create("raiseHand",false)),e.updateRaiseHandParticipants(),e.rxSubject.next(),e}catch(i){throw(await this.errorHelperService.getErrorInfo(i,"allowAttendeeToTalk")).error}}async disableAttendeeToTalk(e,t){try{this.logger.info(`[WebinarConferenceService] disableAttendeeToTalk -- ${e.id} -- ${t}`);const i=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.roomId}/users/${t}/disable-talk`,r=this.authService.getPostHeader(),n=await fetch(i,{method:"PUT",headers:r});if(!n.ok)throw n;return e}catch(i){throw(await this.errorHelperService.getErrorInfo(i,"disableAttendeeToTalk")).error}}async activateWebinarSound(e){try{e.session&&e.session.speakerParticipants.forEach((e=>{e.audioVideoAudioElement&&e.audioVideoAudioElement.play(),e.sharingAudioElement&&e.sharingAudioElement.play()}))}catch(t){throw(await this.errorHelperService.getErrorInfo(t,"activateWebinarSound")).error}}async askForStaging(e,t){try{const i=e.session.getParticipantById(t),r=$msg({from:this.xmppService.jid,to:i.contact.jid,type:"set"});r.c("command",{xmlns:"http://jabber.org/protocol/commands",node:"request-staging",webinarId:e.id}),await this.xmppService.sendIQ(r)}catch(i){throw(await this.errorHelperService.getErrorInfo(i,"askForStaging")).error}}async declineStagingInvitation(e,t){try{const i=e.session.getParticipantById(t),r=$msg({from:this.xmppService.jid,to:i.contact.jid,type:"set"});r.c("command",{xmlns:"http://jabber.org/protocol/commands",node:"refuse-staging",webinarId:e.id}),await this.xmppService.sendIQ(r)}catch(i){throw(await this.errorHelperService.getErrorInfo(i,"askForStaging")).error}}hasActiveWebinarSession(){return null!==this.activeWebinar}isActiveWebinar(e){return this.activeWebinar&&e.id===this.activeWebinar.id}disableAudioVideoMedia(e){if(e.session&&e.session.localParticipant&&e.session.localParticipant.audioVideoSession){let t=e.session.localParticipant.originalAudioVideoStream;t&&(t.getTracks().forEach((e=>{e.enabled=false,e.stop(),e=null})),t=null);let i=e.session.localParticipant.audioVideoSession.localStreams.pop();i&&(i.getTracks().forEach((e=>{e.enabled=false,e.stop(),e=null})),i.stop&&i.stop(),i=null),e.session.localParticipant.audioVideoSession.removeStream(),this.logger.info("[WebinarConferenceService] disableAudioVideoMedia for localParticipant -- "+e.id)}}enableSubtitles(e,t){e.subtitlesEnable=t,t?e.session.localParticipant.audioVideoStream&&this.speechRecognitionService.init("webinar",e.session.localParticipant.audioVideoStream,null):this.speechRecognitionService.stop()}startSession(e){return new Promise((async(t,i)=>{try{if(e.isAttendee&&!e.session)e.session=m.WebinarSession.create(),this.logger.info(`[WebinarConferenceService] startSession -- ${e.id} -- create a session object`),t(e);else{const r=setTimeout((()=>{this.startConferencePromiseResolvers[e.id]&&delete this.startConferencePromiseResolvers[e.id],i(new Error("Webinar start practice session timeout"))}),6e3);this.startConferencePromiseResolvers[e.id]=()=>{clearTimeout(r),this.startConferencePromiseResolvers[e.id]&&delete this.startConferencePromiseResolvers[e.id],t(e)};const n=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.roomId}/start`,s=this.authService.getPostHeader(),o=await fetch(n,{method:"POST",headers:s});if(!o.ok)throw o}this.logger.info(`[WebinarConferenceService] startSession -- ${e.id} -- success`)}catch(r){const t=await this.errorHelperService.getErrorInfo(r,"startSession -- "+e.id);this.logger.info(`[WebinarConferenceService] startSession -- ${e.id} -- error -- ${t.message}`),i(t.error)}}))}async joinSession(e){try{const t=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.roomId}/join?context=webinar`,i=this.authService.getPostHeader(),r=this.xmppService.getResourceFromJid(this.xmppService.fullJid),n=JSON.stringify({mute:true,resourceId:r}),s=await fetch(t,{method:"POST",headers:i,body:n});if(!s.ok)throw s;const o=(await s.json()).data;if(e.session.jingleJid=o.jingleJid,true===o.isAlreadyConnected)throw new Error("already connected to this webinar");return this.logger.info(`[WebinarConferenceService] joinSession -- ${e.id} -- success`),e}catch(t){throw(await this.errorHelperService.getErrorInfo(t,"joinSession -- "+e.id)).error}}async stopSession(e){try{e.action="stopSession";const t=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.roomId}/stop`,i=this.authService.getPostHeader(),r=JSON.stringify({webinarRoomType:"practiceRoom"}),n=await fetch(t,{method:"DELETE",headers:i,body:r});if(!n.ok)throw n;return this.logger.info(`[WebinarConferenceService] stopSession -- ${e.id} -- success`),e}catch(t){throw(await this.errorHelperService.getErrorInfo(t,"stopSession")).error}}async disconnectParticipant(e,t){try{const i=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.room.dbId}/users/${t}`,r=this.authService.getRequestHeader(),n=await fetch(i,{method:"DELETE",headers:r});if(!n.ok)throw n;return e.session&&(e.session.removeParticipant(t),t===this.contactService.userContact.dbId&&(e.session.speakerParticipants=[])),e.rxParticipantsSubject.next(),this.logger.info(`[WebinarConferenceService] disconnectParticipant -- ${e.id} -- usrId:${t} -- success`),e}catch(i){throw(await this.errorHelperService.getErrorInfo(i,"disconnectParticipant")).error}}async createAudioElement(e,t){let i=document.getElementById(e);if(!i){i=document.createElement("audio"),i.setAttribute("id",e),i.setAttribute("style","display:none"),i.setAttribute("class","webinarAudioElementClass");const t=this.deviceManagementService.getCurrentAudioOutputDevice();await this.deviceManagementService.setSetSinkIdForAudioElement(i,t),document.body.appendChild(i)}return i.srcObject=t,i.play().catch((()=>{this.isInteractEventSent||(this.isInteractEventSent=true,this.activeWebinarSubject.next(v.RBEvent.create("ON_ACTIVE_WEBINAR_NOSOUND",{webinar:this.activeWebinar})))})),i}updateAudioElementsOutput(){const e=document.getElementsByClassName("webinarAudioElementClass"),t=this.deviceManagementService.getCurrentAudioOutputDevice();Array.from(e).forEach((async e=>{try{await this.deviceManagementService.setSetSinkIdForAudioElement(e,t),e.play()}catch(i){}}))}async onGroupchatMessage(e){try{const t=$(e),i=t.find("event[xmlns='jabber:iq:notification']");if(i.length){const e=this.xmppService.getBareJidFromJid(t.attr("from")),r=this.roomService.getRoomByJid(e);if(!r)return true;const n=r&&r.isWebinarRoom()?await this.webinarService.getWebinar(r.conference.webinar.id):null;if(!n)throw new Error("webinar not found for roomId : "+r.dbId);switch(i.attr("name")){case"conferenceAdd":{const e=t.find("webinar").find("room-type");if(!n.isAttendee&&e.length&&"waitingRoom"===e.text())return n.status="waitingRoom",n.rxSubject.next(),true;n.session||(n.session=m.WebinarSession.create(),this.logger.info(`[WebinarConferenceService] onGroupchatMessage -- conferenceAdd -- ${n.id} -- create a session object`),this.startConferencePromiseResolvers[n.id]&&this.startConferencePromiseResolvers[n.id](),n.rxSubject.next(),this.webinarService.submitEvent(g.WebinarService.WEBINARS_UPDATE),this.webinarService.submitEvent("WEBINAR_NOTIFICATION",{webinar:n,from:i.attr("jid"),action:"start"}),this.logger.info(`[WebinarConferenceService] onGroupchatMessage -- conferenceAdd -- ${n.id} -- success`))}break;case"conferenceRemove":{const e=t.find("webinar").find("room-type");if(e.length){const t=e.text();"webinar"!==t&&"waitingRoom"!==t||(n.status="terminated"),"practiceRoom"===t&&(n.status="upcoming",n.practiceRoom.conference.sessions=[])}n.session=null,n.rxSubject.next(),this.webinarService.submitEvent(g.WebinarService.WEBINARS_UPDATE),"terminated"===n.status&&(this.ackAllMessages(n),this.webinarService.submitEvent(g.WebinarService.WEBINAR_TERMINATED,n)),this.logger.info("[WebinarConferenceService] onGroupchatMessage -- conferenceRemove -- "+n.id)}break;case"webinarStart":n.isAttendee&&!n.room&&this.webinarService.submitEvent("WEBINAR_NOTIFICATION",{webinar:n,action:"start"}),n.room&&n.room.conference&&n.room.conference.sessions.length&&n.room.conference.sessions[0].startDate&&(n.room.conference.sessions[0].startDate=new Date),await this.handleStage(n,t),n.status="inProgress",n.rxSubject.next(),this.webinarService.submitEvent(g.WebinarService.WEBINARS_UPDATE),this.webinarService.submitEvent("WEBINAR_NOTIFICATION",{webinar:n,from:i.attr("jid"),action:"start"}),this.logger.info("[WebinarConferenceService] onGroupchatMessage -- webinarStart -- "+n.id);break;case"stageUpdate":await this.handleStage(n,t);break;case"webinarDelete":this.webinarService.removeWebinar(n),this.logger.info(`[WebinarConferenceService] onGroupchatMessage -- webinarDelete -- ${n.id}  -- remove webinar`)}}return true}catch(t){return this.logger.error("[WebinarConferenceService] onGroupchatMessage -- "+t.message),true}}async ackAllMessages(e){if(e.room){let t=this.webinarService.conversationService.getConversation(e.room.jid);t||(t=await this.webinarService.conversationService.getOrCreateConversation(e.room.jid,"room")),this.webinarService.conversationService.ackAllMessages(t)}if(e.practiceRoom){let t=this.webinarService.conversationService.getConversation(e.practiceRoom.jid);t||(t=await this.webinarService.conversationService.getOrCreateConversation(e.practiceRoom.jid,"room")),this.webinarService.conversationService.ackAllMessages(t)}}async onXmppJingleMessage(e){try{const t=$(e),i=t.attr("from"),r=t.find("propose");if(r.length>0){const e=r.find("conference").attr("id"),t=this.webinarService.getWebinarBySessionId(null,e);if(t){const e=r.attr("id");this.xmppService.send($msg({from:this.contactService.userContact.fullJid,to:this.contactService.userContact.jid}).c("accept",{xmlns:"urn:xmpp:jingle-message:0",id:e})),this.xmppService.send($msg({from:this.contactService.userContact.fullJid,to:this.xmppService.getBareJidFromJid(i)}).c("proceed",{xmlns:"urn:xmpp:jingle-message:0",id:e})),this.logger.info(`[WebinarConferenceService] onXmppJingleMessage -- ${t.id} -- accept propose and proceed`)}}return true}catch(t){return this.logger.error("[WebinarConferenceService] onXmppJingleMessage -- "+t.message),true}}async onAskStagingMessage(e){try{const t=$(e),i=t.attr("from"),r=t.find("command"),n=r.attr("webinarId");if(!n)return true;const s=this.contactService.getContactByJid(this.xmppService.getBareJidFromJid(i)),o=await this.webinarService.getWebinar(n);if(r.length>0){const e=r.attr("node");switch(this.logger.info(`[WebinarConferenceService] onAskStagingMessage -- ${n} -- ${e}`),e){case"request-staging":o.rxAskStagingSubject.next(v.RBEvent.create("REQUEST_STAGING",{webinar:o,fromContact:s}));break;case"refuse-staging":o.rxAskStagingSubject.next(v.RBEvent.create("REFUSE_STAGING",{webinar:o,fromContact:s}))}}return true}catch(t){return this.logger.error("[WebinarConferenceService] onAskStagingMessage -- "+t.message),true}}async onConferenceMessage(e){let t="enter";try{const i=$(e),r=i.find("room-id").text(),n=this.webinarService.getWebinarByRoomId(r);if(!n)return this.logger.debug(`[WebinarConferenceService] onConferenceMessage -- roomId ${r} -- no webinar`),true;const s=i.find("conference-info");if(s.length){switch($(s).attr("event")){case"webinarStart":return t="event webinarStart",n.isAttendee&&!n.room&&this.webinarService.submitEvent("WEBINAR_NOTIFICATION",{webinar:n,action:"start"}),n.room&&n.room.conference&&n.room.conference.sessions.length&&n.room.conference.sessions[0].startDate&&(n.room.conference.sessions[0].startDate=new Date),n.status="inProgress",n.rxSubject.next(),this.webinarService.submitEvent(g.WebinarService.WEBINARS_UPDATE),this.logger.info("[WebinarConferenceService] onConferenceMessage -- webinarStart -- "+n.id),true;case"webinarDelete":t="event webinarDelete",this.webinarService.removeWebinar(n),this.logger.info(`[WebinarConferenceService] onConferenceMessage -- webinarDelete -- ${n.id}  -- remove webinar`);break;case"conferenceAdd":t="event conferenceAdd",n.session||(n.session=m.WebinarSession.create(),this.logger.info(`[WebinarConferenceService] onConferenceMessage(conferenceAdd) -- ${n.id} -- create a session object`),this.startConferencePromiseResolvers[n.id]&&this.startConferencePromiseResolvers[n.id](),n.rxSubject.next(),this.webinarService.submitEvent(g.WebinarService.WEBINARS_UPDATE),this.logger.info(`[WebinarConferenceService] onConferenceMessage -- conferenceAdd -- ${n.id} -- success`));break;case"conferenceRemove":t="event conferenceRemove";const e=i.find("webinar").find("room-type");if(e.length){const t=e.text();"webinar"!==t&&"waitingRoom"!==t||(n.status="terminated"),"practiceRoom"===t&&(n.status="upcoming",n.practiceRoom.conference.sessions=[])}return n.session=null,n.rxSubject.next(),this.webinarService.submitEvent(g.WebinarService.WEBINARS_UPDATE),"terminated"===n.status&&this.webinarService.submitEvent(g.WebinarService.WEBINAR_TERMINATED,n),this.logger.info(`[WebinarConferenceService] onConferenceMessage -- conferenceRemove -- ${n.id}  -- session terminate`),true}const e=i.find("conference-state");if(e.length){t="conference-state";if(!("true"===$(e).find("active").text()))return this.removeActiveWebinar(n),n.session=null,"inProgress"===n.status&&(n.status="terminated",n.rxSubject.next(),this.webinarService.submitEvent(g.WebinarService.WEBINARS_UPDATE)),this.logger.info(`[WebinarConferenceService] onConferenceMessage -- ${n.id} -- session terminate`),true}const r=$(s[0]).attr("action");if(n.session&&n.session.jingleJid){if("raise-hand"===r||"lower-hand"===r){t="action raise-hand or lower-hand";const e=i.find("user-id").text(),s=n.session.getParticipantById(e);s&&(this.logger.info(`[WebinarConferenceService] onConferenceMessage -- ${n.id} -- ${e} -- ${r}`),s.raiseHand="raise-hand"===r,s.rxSubject.next(v.RBEvent.create("raiseHand",s.raiseHand)),n.updateRaiseHandParticipants(),n.rxParticipantsSubject.next(),n.rxSubject.next())}if("allow-talk"===r){t="action allow-talk";const e=i.find("user-id").text(),r=n.session.getParticipantById(e);r&&(this.logger.info(`[WebinarConferenceService] onConferenceMessage -- ${n.id} -- ${e} -- allow-talk`),r.raiseHand=false,r.allowedToTalk=true,r.invitedToTalk=true,r.rxSubject.next(v.RBEvent.create("raiseHand",false)),n.updateRaiseHandParticipants(),n.rxParticipantsSubject.next(),n.rxSubject.next(),n.isAttendee&&n.rxAskStagingSubject.next(v.RBEvent.create("REQUEST_ATTENDEE_STAGING")))}if("disable-talk"===r){t="action disable-talk";const e=i.find("user-id").text(),r=n.session.getParticipantById(e);r&&(this.logger.info(`[WebinarConferenceService] onConferenceMessage -- ${n.id} -- ${e} -- disable-talk`),r.medias.audio=false,r.medias.video=false,r.medias.sharing=false,r.allowedToTalk=false,r.invitedToTalk=false,r.rxSubject.next(),n.isAttendee&&n.rxAskStagingSubject.next(v.RBEvent.create("REQUEST_ATTENDEE_UNSTAGING")))}}}if(n.session){let e="newParticipant",r=i.find("participants").find("participant");if(0===r.length&&(r=i.find("added-participants").find("participant"),e="addParticipant"),0===r.length&&(r=i.find("updated-participants").find("participant"),e="updateParticipant"),r.length){t=e;const i=[];r.each(((e,t)=>{i.push(this.createSessionParticipantFromElem($(t)))}));(await Promise.all(i)).forEach((t=>{if(t){this.contactService.isUserContact(t.contact)&&!n.session.localParticipant?(n.session.localParticipant=t,this.joinPromiseResolver&&(this.joinPromiseResolver(),this.joinPromiseResolver=null)):n.session.addOrUpdateParticipant(t,e);const i=t.id===n.session.localParticipant.id?"local":t.id;this.logger.info(`[WebinarConferenceService] onConferenceMessage ${e} -- ${i} -- ${n.id}`)}})),n.rxParticipantsSubject.next()}const s=i.find("removed-participants");if(s.length){t="removed-participant";$(s).find("user-id").each(((e,t)=>{const i=$(t).text(),r=n.session.getParticipantById(i);r&&(r.medias.audio=r.medias.video=r.medias.sharing=false);const s=n.session.speakerParticipants.findIndex((e=>e.id===i));if(-1!==s)n.session.speakerParticipants.splice(s,1);else{const e=n.session.attendeeParticipants.findIndex((e=>e.id===i));-1!==e&&n.session.attendeeParticipants.splice(e,1)}n.session.localParticipant&&i===n.session.localParticipant.id&&(n.session.localParticipant=null),this.logger.info(`[WebinarConferenceService] onConferenceMessage removedParticipant -- ${i} -- ${n.id}`)})),n.session.localParticipant||0!==n.session.speakerParticipants.length||(n.session=null),n.updateRaiseHandParticipants(),n.rxParticipantsSubject.next(),n.rxSubject.next()}{let e="publishers",r=i.find("publishers");0===r.length&&(r=i.find("added-publishers"),e="addPublisher"),r.length&&(t="publishers",r.find("publisher").each(((t,i)=>{const r=$(i),s=r.find("user-id").text(),o=n.session.getParticipantById(s),a=r.find("media-type").text();this.logger.info(`[WebinarConferenceService] onConferenceMessage -- ${n.id} -- ${e} -- ${s} -- ${a}`),"addPublisher"===e&&s!==n.session.localParticipant.id&&this.subscribeToPublisher(n,o,"sharing"===a?"sharing":"audioVideo"),"audioVideo"===a&&(o.medias.video=false),a.split("+").forEach((e=>{o.medias[e]=true})),"attendee"===o.role&&void 0===n.session.speakerParticipants.find((e=>e.id===o.id))&&n.session.speakerParticipants.push(o)})));const s=i.find("removed-publishers");s.length&&(t="removed-publishers",s.find("publisher").each(((e,t)=>{const i=$(t),r=i.find("user-id").text(),s=n.session.getParticipantById(r),o=i.find("media-type").text();if(s){this.logger.info(`[WebinarConferenceService] onConferenceMessage -- ${n.id} -- removePublisher -- ${r} -- ${o}`),"video"===o&&s.audioVideoAudioElement&&(document.body.removeChild(s.audioVideoAudioElement),s.audioVideoAudioElement=null,s.medias.audio=s.medias.video=false),"sharing"===o&&s.sharingAudioElement&&(document.body.removeChild(s.sharingAudioElement),s.sharingAudioElement=null,s.medias.sharing=false),s.medias[o]=false,"sharing"===o&&(s.sharingOnStage=false),n.session.masterMedia===`${s.id}_${o}`&&(n.session.masterMedia=null);const e=n.session.speakerParticipants.findIndex((e=>e.id===s.id));if(-1!==e){const t=n.session.speakerParticipants[e];false===t.medias.audio&&false===t.medias.sharing&&n.session.speakerParticipants.splice(e,1)}s.rxSubject.next(v.RBEvent.create(o)),n.rxParticipantsSubject.next()}else this.logger.info(`[WebinarConferenceService] onConferenceMessage -- ${n.id} -- removePublisher -- ${r} -- ${o} -- Not found`)})));const o=i.find("talkers");if(o.length){t="talkers";const e=o.find("talker")[0],i=$(e).find("user-id").text(),r=n.session.getParticipantById(i);if(r){[n.session.localParticipant].concat(n.session.speakerParticipants).forEach((e=>{e.id!==i&&e.activeSpeaker&&(e.activeSpeaker=false,e.rxSubject.next(v.RBEvent.create("activeSpeaker")))})),r.activeSpeaker=true,r.rxSubject.next(v.RBEvent.create("activeSpeaker"))}this.logger.info(`[WebinarConferenceService] onConferenceMessage -- ${n.id} -- talker -- ${i}`)}const a=i.find("silents");a.length&&(t="silents",a.find("silent").each(((e,t)=>{const i=$(t).find("user-id").text(),r=n.session.getParticipantById(i);r&&r.activeSpeaker&&(r.activeSpeaker=false,r.rxSubject.next(v.RBEvent.create("activeSpeaker"))),this.logger.info(`[WebinarConferenceService] onConferenceMessage -- ${n.id} -- silent -- ${i}`)})));const c=i.find("substream");if(c.length){t="substream";const e=i.find("user-id").text(),r=n.session.getParticipantById(e);r&&r.medias.video&&(r.audioVideoSubStreamLevel=parseInt($(c[0]).text(),10),r.rxSubject.next(v.RBEvent.create("substreamLevel",{type:"video"})),this.logger.info(`[WebinarConferenceService] onConferenceMessage -- ${n.id} -- substreamLevel -- ${r.audioVideoSubStreamLevel}`))}const l=i.find("temporal");if(l.length){t="temporal";const e=i.find("user-id").text(),r=n.session.getParticipantById(e);r&&r.medias.video&&(r.audioVideoTemporalLevel=parseInt($(l[0]).text(),10),r.rxSubject.next(v.RBEvent.create("temporalElems")),this.logger.info(`[WebinarConferenceService] onConferenceMessage -- ${n.id} -- temporalElems -- ${r.audioVideoTemporalLevel}`))}const d=i.find("raise-hands");if(d.length){t="raise-hands";const e=$(d[0]).find("raise-hand");e.length&&e.each(((e,t)=>{const i=$(t).find("user-id").text(),r=n.session.getParticipantById(i);r.raiseHand=true,r.rxSubject.next(v.RBEvent.create("raiseHand",true)),n.updateRaiseHandParticipants(),n.rxSubject.next()}))}}const o=i.find("attendees");if(o.length){t="attendees";const e=[];o.find("attendee-jid").each(((t,i)=>{e.push(this.createSessionParticipantFromAttendeeJid($(i).text()))}));(await Promise.all(e)).forEach((e=>{e&&(n.session.addOrUpdateParticipant(e),this.logger.info(`[WebinarConferenceService] onConferenceMessage addAttendee -- ${e.id} -- ${n.id}`))})),n.rxParticipantsSubject.next()}t="handleStage",await this.handleStage(n,i)}return true}catch(i){return this.logger.error(`[WebinarConferenceService] onConferenceMessage -- ${t} -- ${i.message}`),true}}async handleStage(e,t){if(t.find("stage").length&&e.session){if(!e.session)return void this.logger.info(`[WebinarConferenceService] handleStage -- ${e.id} -- no session -- ignored`);this.logger.info("[WebinarConferenceService] handleStage -- "+e.id),e.session.masterMedia=null,e.session.speakerParticipants.forEach((e=>{e.onStage=e.sharingOnStage=false}));const i=t.find("actor");if(i.length){const t=[];i.each(((e,i)=>{const r=$(i),n=r.find("user-id").text(),s=r.find("type").text(),o=r.find("property"),a=$(o[0]).text(),c="master"===a,l="staged"===a||c;t.push({participantId:n,type:s,isMaster:c,isStaged:l,staged:a})})),await this.utilitiesService.asyncForEach(t,(async t=>{let i=e.session.getParticipantById(t.participantId);!i&&e.isAttendee&&(this.logger.info(`[WebinarConferenceService] handleStage -- ${e.id} -- ${t.participantId} -- ${t.staged} -- no participant -- create session`),i=m.WebinarSessionParticipant.create(t.participantId),i.contact=await this.contactService.getContactByDBId(t.participantId),e.session.speakerParticipants.push(i),i.rxSubject.next(v.RBEvent.create("updateParticipant"))),i&&("participant"===t.type&&(this.logger.info(`[WebinarConferenceService] handleStage -- ${e.id} -- ${i.id} -- participant -- ${t.staged} -- ${i.medias.audio}`),i.onStage=t.isStaged,i.onStage&&(i.invitedToTalk=false),e.isAttendee&&t.isStaged&&!i.medias.audio&&e.session.localParticipant.id!==i.id&&(this.logger.info(`[WebinarConferenceService] handleStage -- ${e.id} -- ${i.id} -- subscribe to publisher`),await this.subscribeToPublisher(e,i,"audioVideo")),t.isMaster&&(e.session.masterMedia=`${t.participantId}_${t.type}`),e.isAttendee&&!t.isStaged&&!t.isMaster&&i.medias.audio&&(this.webrtcConfigAndUtils.disableAllStreamsForSession(i.audioVideoSession),t.participantId===e.session.localParticipant.id?this.disableAudioVideoMedia(e):(this.logger.info(`[WebinarConferenceService] handleStage -- ${e.id} -- ${i.id} -- terminate session (leave stage)`),this.xmppService.connection.jingle.terminate(i.audioVideoSession.sid,"leaveStage")),i.audioVideoSession=i.audioVideoStream=null,i.medias.audio=i.medias.video=false),i.rxSubject.next(v.RBEvent.create("updateStage",{type:"video"}))),"sharing"===t.type&&(this.logger.info(`[WebinarConferenceService] handleStage -- ${e.id} -- ${i.id} -- sharing -- ${t.staged}`),i.sharingOnStage=t.isStaged,t.isStaged&&!i.medias.sharing&&e.session.localParticipant.id!==i.id&&await this.subscribeToPublisher(e,i,"sharing"),e.isAttendee&&!t.isStaged&&i.medias.sharing&&(e.session.localParticipant.id===i.id?(this.logger.info(`[WebinarConferenceService] handleStage -- ${e.id} -- ${i.id} -- guest sharing -- remove media`),this.removeLocalMedia(e,"sharing")):(this.logger.info(`[WebinarConferenceService] handleStage -- ${e.id} -- ${i.id} -- sharing -- terminate session (leave stage)`),this.xmppService.connection.jingle.terminate(i.sharingSession.sid,"leaveStage"),i.sharingSession=i.sharingStream=null,i.medias.sharing=false)),t.isMaster&&(e.session.masterMedia=`${t.participantId}_${t.type}`),i.rxSubject.next(v.RBEvent.create("updateStage",{type:"sharing"}))))}))}e.rxParticipantsSubject.next()}}async subscribeToPublisher(e,t,i){return this.subscribeToPublisherPromiseResolvers[`${e.id}_${t.id}_${i}`]?this.logger.info(`[WebinarConferenceService] subscribeToPublisher -- ${e.id} -- ${t.id} -- ${i} -- already in progress`):this.subscribeToPublisherPromiseResolvers[`${e.id}_${t.id}_${i}`]=new Promise(((r,n)=>{this.subscribeToPublisherInternal(e,t,i).then((()=>{r(),delete this.subscribeToPublisherPromiseResolvers[`${e.id}_${t.id}_${i}`]})).catch((r=>{n(r),delete this.subscribeToPublisherPromiseResolvers[`${e.id}_${t.id}_${i}`]}))})),this.subscribeToPublisherPromiseResolvers[`${e.id}_${t.id}_${i}`]}async subscribeToPublisherInternal(e,t,i){try{const r=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.roomId}/users/${t.id}/subscribe`,n=this.authService.getPostHeader(),s={media:i};"audioVideo"===i&&(i="audio+video",t.subStreamLevel=t.onStage?1:0,t.temporalLevel=t.onStage?2:0,s.subStreamLevel=t.subStreamLevel,s.temporalLevel=t.temporalLevel,this.logger.info(`[WebinarConferenceService] subscribeToPublisher -- ${e.id} -- ${t.id} -- ${i} -- substreamLevel: ${t.subStreamLevel} -- temporalLevel: ${t.temporalLevel}`)),"sharing"===i&&(t.subStreamLevel=t.onStage?2:0,t.temporalLevel=t.onStage?2:0,this.logger.info(`[WebinarConferenceService] subscribeToPublisher -- ${e.id} -- ${t.id} -- ${i}`));const o=JSON.stringify(s),a=await fetch(r,{method:"PUT",headers:n,body:o});if(i.split("+").forEach((e=>{t.medias[e]=true})),!a.ok)throw a}catch(r){throw(await this.errorHelperService.getErrorInfo(r,"subscribeToPublisher")).error}}async createSessionParticipantFromElem(e){try{const t=e.find("user-id").text(),i=await this.contactService.getContactByDBId(t);if(i){const r=m.WebinarSessionParticipant.create(t);return r.contact=i,r.mute="true"===e.find("mute").text(),r.role=e.find("role").text(),r}return null}catch(t){return this.logger.error("[WebinarConferenceService] createSessionParticipantFromParticipantElem -- Failure"),null}}async createSessionParticipantFromAttendeeJid(e){try{const t=await this.contactService.getOrCreateContact(e);if(t){const e=m.WebinarSessionParticipant.create(t.dbId);return e.contact=t,e.mute=true,e.role="attendee",e}return null}catch(t){return this.logger.error("[WebinarConferenceService] createSessionParticipantFromAttendeeElem -- Failure"),null}}onVideoServiceEvent(e){try{if("ON_CHROME_STOP_SCREEN_SHARING_TRIGGERED"===e.name){const t=e.data.webinar;t&&this.removeLocalMedia(t,"sharing")}}catch(t){}}onJingleMessage(e){try{const t=this.webinarService.getWebinarBySessionId(e.data.sid,e.data.confId);if(t)switch(e.name){case"jingleSessionInvitation":this.onJingleSessionInvite(t,e.data.sid);break;case"iceconnectionstatechange.jingle":this.onJingleConnectionStateChange(t,e.data.session);break;case"callterminated.jingle":this.onSessionTerminated(t,e.data.sid);break;case"jingleUpdateStream":this.onJingleUpdateStream(t,e.data.sid,e.data.medias);break;case"webrtcSessionStats.jingle":this.onJingleStatsChange(t,e.data);break;case"error.jingle":this.logger.error(`[WebinarConferenceService] onJingleMessage -- ${e.name} -- ${t.id} -- ${JSON.stringify(e.data.error)}`);break;case"ack.jingle":break;default:this.logger.debug(`[WebinarConferenceService] onJingleMessage -- ${e.name} -- ${t.id}`)}}catch(t){this.logger.info("[WebinarConferenceService] onJingleMessage -- failure -- "+e.name)}}async onJingleConnectionStateChange(e,t){if(t&&t.peerconnection&&"stable"===t.peerconnection.signalingState){switch(t.peerconnection.connectionState?t.peerconnection.connectionState:t.peerconnection.iceConnectionState){case"connected":case"completed":if("audio+video"===t.localType)if(t.publisherId){if(t.publisherId!==e.session.localParticipant.id){const i=t.remoteStreamsObject&&t.remoteStreamsObject[0]?t.remoteStreamsObject[0]:null;if(!i)return;const r=e.session.getParticipantById(t.publisherId);r.audioVideoSession=t,r.audioVideoStream=i,0===i.getVideoTracks().length&&(r.medias.video=false),r.audioVideoAudioElement=await this.createAudioElement(`av_${r.id} `,i),e.rxParticipantsSubject.next(v.RBEvent.create("addParticipant",r)),this.logger.info(`[WebinarConferenceService] audio+video sessionEstablished -- ${r.id} -- ${e.id}`),r.rxSubject.next(v.RBEvent.create("updateMedia",{type:"video"}))}}else{if(!e.session.localParticipant.audioVideoSession)if(e.session.localParticipant.audioVideoSession=t,this.logger.info("[WebinarConferenceService] audio+video sessionEstablished -- local -- "+e.id),e.isAttendee){const t=this.contactService.userContact.dbId;await this.webinarService.conference.muteParticipant(e,t,e.session.localParticipant.mute,true),await this.webinarService.conference.putOnStage(e,t,"participant",true),e.session.localParticipant.allowedToTalk=true}else e.session.speakerParticipants.forEach((t=>{t.medias.audio&&this.subscribeToPublisher(e,t,"audioVideo"),t.medias.sharing&&this.subscribeToPublisher(e,t,"sharing")}));e.session.localParticipant.rxSubject.next(v.RBEvent.create("updateMedia",{type:"video"}))}else if("sharing"===t.localType){if(t.publisherId){const i=t.remoteStreamsObject&&t.remoteStreamsObject[0]?t.remoteStreamsObject[0]:null;if(!i)return;const r=e.session.getParticipantById(t.publisherId);r.sharingSession=t,r.sharingStream=i,r.sharingAudioElement=await this.createAudioElement("sharing_"+r.id,i),r.rxSubject.next(v.RBEvent.create("updateMedia",{type:"sharing"})),this.logger.info(`[WebinarConferenceService] sharing sessionEstablished -- ${r.id} -- ${e.id}`)}else{if(this.logger.info("[WebinarConferenceService] sharing sessionEstablished -- local -- "+e.id),e.isAttendee){const t=this.contactService.userContact.dbId;await this.webinarService.conference.putOnStage(e,t,"sharing",true,true)}e.session.localParticipant.rxSubject.next(v.RBEvent.create("updateMedia",{type:"sharing"}))}e.rxParticipantsSubject.next()}break;case"disconnected":this.connected&&(this.logger.info("[WebinarConferenceService] sessionDisconnected -- "+e.id),"audio+video"!==t.localType&&"sharing"!==t.localType||this.sendTransportReplaceForSession(e,t,"audio+video"===t.localType?5e3:8e3));break;case"failed":this.connected&&(this.logger.info("[WebinarConferenceService] sessionFailed -- "+e.id),"audio+video"===t.localType||"sharing"===t.localType?this.sendTransportReplaceForSession(e,t,500):"audio+video"!==t.remoteType&&"sharing"!==t.remoteType||(this.xmppService.connection.jingle.terminate(t.sid),e.session.speakerParticipants.forEach((i=>{i.medias.audio&&"audio+video"===t.remoteType&&this.subscribeToPublisher(e,i,"audioVideo"),i.medias.sharing&&"sharing"===t.remoteType&&this.subscribeToPublisher(e,i,"sharing")}))))}}}sendTransportReplaceForSession(e,t,i=1e3){this.reconnectingSessionIds[t.sid]?this.logger.info(`[WebinarConferenceService] sendTransportReplaceForSession already reconnecting for session ${t.sid} -- ${e.id}`):(this.reconnectingSessionIds[t.sid]=true,setTimeout((()=>{this.reconnectingSessionIds[t.sid]=false,delete this.reconnectingSessionIds[t.sid],this.connected&&t&&t.peerconnection&&"stable"===t.peerconnection.signalingState&&("failed"===t.peerconnection.iceConnectionState||"disconnected"===t.peerconnection.iceConnectionState)?(this.logger.info(`[WebinarConferenceService] sendTransportReplaceForSession ${t.sid} -- ${e.id}`),t.connection=this.xmppService.connection,t.reconnectSession()):this.logger.info(`[WebinarConferenceService] sendTransportReplaceForSession ${t.sid} -- ${e.id} is not send ...`)}),i))}onJingleSessionInvite(e,t){this.logger.info(`[WebinarConferenceService] onJingleSessionInvite -- ${e.id} -- ${t}`);const i=this.xmppService.connection.jingle.sessions[t];i.localType=i.remoteType,i.sendAnswer(),i.accept(),this.logger.info(`[WebinarConferenceService] onJingleSessionInvite -- accept -- ${e.id} -- ${t}`)}onSessionTerminated(e,t){this.logger.info(`[WebinarConferenceService] onJingleMessage -- onSessionTerminated -- ${e.id} -- ${t}`),e.session.speakerParticipants.find((i=>i.audioVideoSession&&i.audioVideoSession.sid===t?(i.medias.audio=i.medias.video=false,i.audioVideoStream=null,i.audioVideoSession=null,i.rxSubject.next(v.RBEvent.create("video")),e.rxParticipantsSubject.next(),this.logger.info(`[WebinarConferenceService] onJingleMessage -- onSessionTerminated -- audio+video -- ${e.id} -- ${i.id}`),true):!(!i.sharingSession||i.sharingSession.sid!==t)&&(i.medias.sharing=false,i.sharingStream=null,i.sharingSession=null,i.rxSubject.next(v.RBEvent.create("sharing")),e.rxParticipantsSubject.next(),this.logger.info(`[WebinarConferenceService] onJingleMessage -- onSessionTerminated -- sharing -- ${e.id} -- ${i.id}`),true)))}onJingleUpdateStream(e,t,i){const r=this.xmppService.connection.jingle.sessions[t];if(r&&r.publisherId){const t=e.session.getParticipantById(r.publisherId),n=r.remoteStreamsObject&&r.remoteStreamsObject[0]?r.remoteStreamsObject[0]:null;n&&("audio+video"===r.localType?(t.audioVideoSession=r,t.audioVideoStream=n,t.medias.audio=i.audio,t.medias.video=i.video,t.rxSubject.next(v.RBEvent.create("updateMedia",{type:"video"}))):(t.sharingSession=r,t.sharingStream=n,t.medias.sharing=true,t.rxSubject.next(v.RBEvent.create("updateMedia",{type:"sharing"}))))}}onJingleStatsChange(e,t){this.logger.infoOrange("webinar stats "+t)}onXmppConnectionChangeEvent(e){try{this.logger.info(`[WebinarConferenceService] onXmppConnectionChangeEvent : ${e.name} ${e.data?e.data.reason:"UNKNOWN"}`),"ON_XMPP_DISCONNECTED"===e.name?this.connected=false:"ON_XMPP_CONNECTED"===e.name&&"PRESENCE"===e.data.reason&&(this.connected=true)}catch(t){}}async onReplaceBackgroundChangeEvent(e){try{const t=this.webinarService.conference.activeWebinar;if(t.session&&t.session.localParticipant&&t.session.localParticipant.medias.video){this.logger.info("[WebinarConferenceService] onReplaceBackgroundChangeEvent"),t.session.localParticipant.audioVideoStream=e.data.stream;const i=e.data.stream.getTracks();2===i.length&&t.session.localParticipant.audioVideoSession.replaceVideoTrack(i[1]),t.session.localParticipant.rxSubject.next(v.RBEvent.create("updateMedia",{type:"video"}))}}catch(t){}}async onMediaDeviceChangeEvent(e){try{if(e.name===this.deviceManagementService.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED){const t=e.data.kind;this.logger.info(`[WebinarConferenceService] onMediaDeviceChangeEvent (${t})`);const i=this.activeWebinar;if("audiooutput"===t)this.updateAudioElementsOutput();else if(i&&i.session&&(i.session.localParticipant.medias.audio||i.session.localParticipant.medias.video)){const e=i.session.localParticipant,r=[];e.medias.audio&&r.push("audio"),e.medias.video&&r.push("video");const n=await this.webinarService.webrtcP2PService.getBrowserMedia(r,null,null,null,i);this.webrtcConfigAndUtils.disableMediaStreams([e.originalAudioVideoStream]),e.originalAudioVideoStream=n,await this.virtualBackgroundService.stopProcessStream();const s=await this.virtualBackgroundService.startProcessStream(n,"WebinarConferenceService");try{const i=s.getTracks();await this.utilitiesService.asyncForEach(i,(async(t,i)=>{await e.audioVideoSession.replaceTransceiverTrack(t,i)})),this.webrtcConfigAndUtils.disableMediaStreams(e.audioVideoSession.localStreams),e.audioVideoSession.localStreams=[],e.audioVideoSession.localStreams.push(s),e.audioVideoStream=s,e.rxSubject.next(v.RBEvent.create("updateMedia",{type:"video"})),this.logger.info(`[WebinarConferenceService] onMediaDeviceChangeEvent (${t}) -- Success 'on the fly'`)}catch{e.audioVideoSession.removeStream(),this.webrtcConfigAndUtils.disableMediaStreams(e.audioVideoSession.localStreams),e.audioVideoSession.localStreams=[],e.audioVideoSession.localStreams.push(s),await e.audioVideoSession.addBundleStream(s),e.audioVideoSession.sendTransportReplace(),e.audioVideoStream=s,e.rxSubject.next(v.RBEvent.create("updateMedia",{type:"video"})),this.logger.info(`[WebinarConferenceService] onMediaDeviceChangeEvent (${t}) -- Success 'via transport-replace'`)}}}}catch(t){this.logger.info("[WebinarConferenceService] onMediaDeviceChangeEvent -- Failure")}}}t.WebinarConferenceService=y},function(e,t,i){var r,n=(r="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e){var t,i,n=void 0!==(e=e||{})?e:{};n.ready=new Promise((function(e,r){t=e,i=r}));var s,o={};for(s in n)n.hasOwnProperty(s)&&(o[s]=n[s]);var a,c="./this.program",l=function(e,t){throw t},d="";"undefined"!=typeof document&&document.currentScript&&(d=document.currentScript.src),r&&(d=r),d=0!==d.indexOf("blob:")?d.substr(0,d.lastIndexOf("/")+1):"";var u,h=n.print||console.log.bind(console),f=n.printErr||console.warn.bind(console);for(s in o)o.hasOwnProperty(s)&&(n[s]=o[s]);o=null,n.arguments&&n.arguments,n.thisProgram&&(c=n.thisProgram),n.quit&&(l=n.quit),n.wasmBinary&&(u=n.wasmBinary);var p,g=n.noExitRuntime||true;"object"!=typeof WebAssembly&&R("no native wasm support detected");var m,v,S,b,y=false,C="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function w(e,t,i){for(var r=t+i,n=t;e[n]&&!(n>=r);)++n;if(n-t>16&&e.subarray&&C)return C.decode(e.subarray(t,n));for(var s="";t<n;){var o=e[t++];if(128&o){var a=63&e[t++];if(192!=(224&o)){var c=63&e[t++];if((o=224==(240&o)?(15&o)<<12|a<<6|c:(7&o)<<18|a<<12|c<<6|63&e[t++])<65536)s+=String.fromCharCode(o);else{var l=o-65536;s+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else s+=String.fromCharCode((31&o)<<6|a)}else s+=String.fromCharCode(o)}return s}function _(e){m=e,n.HEAP8=v=new Int8Array(e),n.HEAP16=new Int16Array(e),n.HEAP32=b=new Int32Array(e),n.HEAPU8=S=new Uint8Array(e),n.HEAPU16=new Uint16Array(e),n.HEAPU32=new Uint32Array(e),n.HEAPF32=new Float32Array(e),n.HEAPF64=new Float64Array(e)}n.INITIAL_MEMORY;var E,T=[],I=[],P=[],A=[];I.push({func:function(){G()}});var M=0,D=null;function R(e){n.onAbort&&n.onAbort(e),f(e+=""),y=true,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw i(t),t}function O(e){return t=e,i="data:application/octet-stream;base64,",String.prototype.startsWith?t.startsWith(i):0===t.indexOf(i);var t,i}n.preloadedImages={},n.preloadedAudios={};var N,x,L="/cacheV2/virtual-background/tflite/tflite.wasm";function k(e){try{if(e==L&&u)return new Uint8Array(u);if(a);throw"both async and sync fetching of the wasm failed"}catch(t){R(t)}}function F(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var i=t.func;"number"==typeof i?void 0===t.arg?E.get(i)():E.get(i)(t.arg):i(void 0===t.arg?null:t.arg)}else t(n)}}function U(e){return b[$()>>2]=e,e}function j(e){try{return p.grow(e-m.byteLength+65535>>>16),_(p.buffer),1}catch(t){}}O(L)||(N=L,L=n.locateFile?n.locateFile(N,d):d+N),x=function(){return performance.now()};var W={};function B(){if(!B.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:c||"./this.program"};for(var t in W)e[t]=W[t];var i=[];for(var t in e)i.push(t+"="+e[t]);B.strings=i}return B.strings}var H,V={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var i=V.buffers[e];0===t||10===t?((1===e?h:f)(w(i,0)),i.length=0):i.push(t)},varargs:void 0,get:function(){return V.varargs+=4,b[V.varargs-4>>2]},getStr:function(e){return function(e,t){return e?w(S,e,t):""}(e)},get64:function(e,t){return e}},Y={a:function(){R()},n:function(e,t){var i;if(0===e)i=Date.now();else{if(1!==e&&4!==e)return U(28),-1;i=x()}return b[t>>2]=i/1e3|0,b[t+4>>2]=i%1e3*1e3*1e3|0,0},i:function(e,t){R("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},f:function(e,t){R("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},l:function(e,t,i){S.copyWithin(e,t,t+i)},m:function(e){var t,i,r=S.length;if(e>2147483648)return false;for(var n=1;n<=4;n*=2){var s=r*(1+.2/n);if(s=Math.min(s,e+100663296),j(Math.min(2147483648,((t=Math.max(e,s))%(i=65536)>0&&(t+=i-t%i),t))))return true}return false},o:function(e){for(var t=x();x()-t<e;);},p:function(e,t){var i=0;return B().forEach((function(r,n){var s=t+i;b[e+4*n>>2]=s,function(e,t,i){for(var r=0;r<e.length;++r)v[t++>>0]=e.charCodeAt(r);i||(v[t>>0]=0)}(r,s),i+=r.length+1})),0},g:function(e,t){var i=B();b[e>>2]=i.length;var r=0;return i.forEach((function(e){r+=e.length+1})),b[t>>2]=r,0},j:function(e){!function(e,t){t&&g&&0===e||(g||(n.onExit&&n.onExit(e),y=true),l(e,new z(e)))}(e)},h:function(e){return 0},k:function(e,t,i,r,n){},c:function(e,t,i,r){for(var n=0,s=0;s<i;s++){for(var o=b[t+8*s>>2],a=b[t+(8*s+4)>>2],c=0;c<a;c++)V.printChar(e,S[o+c]);n+=a}return b[r>>2]=n,0},d:function(){return 6},e:function(){return 28},b:function(e){switch(e){case 30:return 16384;case 85:return 131072;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:case 80:case 81:case 79:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==typeof navigator&&navigator.hardwareConcurrency||1}return U(28),-1}},G=(function(){var e={a:Y};function t(e,t){var i=e.exports;n.asm=i,_((p=n.asm.q).buffer),E=n.asm.D,function(e){if(M--,n.monitorRunDependencies&&n.monitorRunDependencies(M),0==M&&D){var t=D;D=null,t()}}()}function r(e){t(e.instance)}function s(t){return(u||"function"!=typeof fetch?Promise.resolve().then((function(){return k(L)})):fetch(L,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+L+"'";return e.arrayBuffer()})).catch((function(){return k(L)}))).then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){f("failed to asynchronously prepare wasm: "+e),R(e)}))}if(M++,n.monitorRunDependencies&&n.monitorRunDependencies(M),n.instantiateWasm)try{return n.instantiateWasm(e,t)}catch(o){return f("Module.instantiateWasm callback failed with error: "+o),false}(u||"function"!=typeof WebAssembly.instantiateStreaming||O(L)||"function"!=typeof fetch?s(r):fetch(L,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(r,(function(e){return f("wasm streaming compile failed: "+e),f("falling back to ArrayBuffer instantiation"),s(r)}))}))).catch(i)}(),n.___wasm_call_ctors=function(){return(G=n.___wasm_call_ctors=n.asm.r).apply(null,arguments)}),$=(n._getModelBufferMemoryOffset=function(){return(n._getModelBufferMemoryOffset=n.asm.s).apply(null,arguments)},n._getInputMemoryOffset=function(){return(n._getInputMemoryOffset=n.asm.t).apply(null,arguments)},n._getInputHeight=function(){return(n._getInputHeight=n.asm.u).apply(null,arguments)},n._getInputWidth=function(){return(n._getInputWidth=n.asm.v).apply(null,arguments)},n._getInputChannelCount=function(){return(n._getInputChannelCount=n.asm.w).apply(null,arguments)},n._getOutputMemoryOffset=function(){return(n._getOutputMemoryOffset=n.asm.x).apply(null,arguments)},n._getOutputHeight=function(){return(n._getOutputHeight=n.asm.y).apply(null,arguments)},n._getOutputWidth=function(){return(n._getOutputWidth=n.asm.z).apply(null,arguments)},n._getOutputChannelCount=function(){return(n._getOutputChannelCount=n.asm.A).apply(null,arguments)},n._loadModel=function(){return(n._loadModel=n.asm.B).apply(null,arguments)},n._runInference=function(){return(n._runInference=n.asm.C).apply(null,arguments)},n.___errno_location=function(){return($=n.___errno_location=n.asm.E).apply(null,arguments)});function z(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function J(e){function i(){H||(H=true,n.calledRun=true,y||(F(I),F(P),t(n),n.onRuntimeInitialized&&n.onRuntimeInitialized(),function(){if(n.postRun)for("function"==typeof n.postRun&&(n.postRun=[n.postRun]);n.postRun.length;)e=n.postRun.shift(),A.unshift(e);var e;F(A)}()))}M>0||(function(){if(n.preRun)for("function"==typeof n.preRun&&(n.preRun=[n.preRun]);n.preRun.length;)e=n.preRun.shift(),T.unshift(e);var e;F(T)}(),M>0||(n.setStatus?(n.setStatus("Running..."),setTimeout((function(){setTimeout((function(){n.setStatus("")}),1),i()}),1)):i()))}if(D=function e(){H||J(),H||(D=e)},n.run=J,n.preInit)for("function"==typeof n.preInit&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return J(),e.ready});e.exports=n},function(e,t,i){var r,n=(r="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e){var t,i,n=void 0!==(e=e||{})?e:{};n.ready=new Promise((function(e,r){t=e,i=r}));var s,o={};for(s in n)n.hasOwnProperty(s)&&(o[s]=n[s]);var a,c="./this.program",l=function(e,t){throw t},d="";"undefined"!=typeof document&&document.currentScript&&(d=document.currentScript.src),r&&(d=r),d=0!==d.indexOf("blob:")?d.substr(0,d.lastIndexOf("/")+1):"";var u,h=n.print||console.log.bind(console),f=n.printErr||console.warn.bind(console);for(s in o)o.hasOwnProperty(s)&&(n[s]=o[s]);o=null,n.arguments&&n.arguments,n.thisProgram&&(c=n.thisProgram),n.quit&&(l=n.quit),n.wasmBinary&&(u=n.wasmBinary);var p,g=n.noExitRuntime||true;"object"!=typeof WebAssembly&&R("no native wasm support detected");var m,v,S,b,y=false,C="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function w(e,t,i){for(var r=t+i,n=t;e[n]&&!(n>=r);)++n;if(n-t>16&&e.subarray&&C)return C.decode(e.subarray(t,n));for(var s="";t<n;){var o=e[t++];if(128&o){var a=63&e[t++];if(192!=(224&o)){var c=63&e[t++];if((o=224==(240&o)?(15&o)<<12|a<<6|c:(7&o)<<18|a<<12|c<<6|63&e[t++])<65536)s+=String.fromCharCode(o);else{var l=o-65536;s+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else s+=String.fromCharCode((31&o)<<6|a)}else s+=String.fromCharCode(o)}return s}function _(e){m=e,n.HEAP8=v=new Int8Array(e),n.HEAP16=new Int16Array(e),n.HEAP32=b=new Int32Array(e),n.HEAPU8=S=new Uint8Array(e),n.HEAPU16=new Uint16Array(e),n.HEAPU32=new Uint32Array(e),n.HEAPF32=new Float32Array(e),n.HEAPF64=new Float64Array(e)}n.INITIAL_MEMORY;var E,T=[],I=[],P=[],A=[];I.push({func:function(){G()}});var M=0,D=null;function R(e){n.onAbort&&n.onAbort(e),f(e+=""),y=true,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw i(t),t}function O(e){return t=e,i="data:application/octet-stream;base64,",String.prototype.startsWith?t.startsWith(i):0===t.indexOf(i);var t,i}n.preloadedImages={},n.preloadedAudios={};var N,x,L="tflite-simd.wasm";function k(e){try{if(e==L&&u)return new Uint8Array(u);if(a);throw"both async and sync fetching of the wasm failed"}catch(t){R(t)}}function F(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var i=t.func;"number"==typeof i?void 0===t.arg?E.get(i)():E.get(i)(t.arg):i(void 0===t.arg?null:t.arg)}else t(n)}}function U(e){return b[$()>>2]=e,e}function j(e){try{return p.grow(e-m.byteLength+65535>>>16),_(p.buffer),1}catch(t){}}O(L)||(N=L,L=n.locateFile?n.locateFile(N,d):d+N),x=function(){return performance.now()};var W={};function B(){if(!B.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:c||"./this.program"};for(var t in W)e[t]=W[t];var i=[];for(var t in e)i.push(t+"="+e[t]);B.strings=i}return B.strings}var H,V={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var i=V.buffers[e];0===t||10===t?((1===e?h:f)(w(i,0)),i.length=0):i.push(t)},varargs:void 0,get:function(){return V.varargs+=4,b[V.varargs-4>>2]},getStr:function(e){return function(e,t){return e?w(S,e,t):""}(e)},get64:function(e,t){return e}},Y={a:function(){R()},n:function(e,t){var i;if(0===e)i=Date.now();else{if(1!==e&&4!==e)return U(28),-1;i=x()}return b[t>>2]=i/1e3|0,b[t+4>>2]=i%1e3*1e3*1e3|0,0},i:function(e,t){R("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},f:function(e,t){R("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},l:function(e,t,i){S.copyWithin(e,t,t+i)},m:function(e){var t,i,r=S.length;if(e>2147483648)return false;for(var n=1;n<=4;n*=2){var s=r*(1+.2/n);if(s=Math.min(s,e+100663296),j(Math.min(2147483648,((t=Math.max(e,s))%(i=65536)>0&&(t+=i-t%i),t))))return true}return false},o:function(e){for(var t=x();x()-t<e;);},p:function(e,t){var i=0;return B().forEach((function(r,n){var s=t+i;b[e+4*n>>2]=s,function(e,t,i){for(var r=0;r<e.length;++r)v[t++>>0]=e.charCodeAt(r);i||(v[t>>0]=0)}(r,s),i+=r.length+1})),0},g:function(e,t){var i=B();b[e>>2]=i.length;var r=0;return i.forEach((function(e){r+=e.length+1})),b[t>>2]=r,0},j:function(e){!function(e,t){t&&g&&0===e||(g||(n.onExit&&n.onExit(e),y=true),l(e,new z(e)))}(e)},h:function(e){return 0},k:function(e,t,i,r,n){},c:function(e,t,i,r){for(var n=0,s=0;s<i;s++){for(var o=b[t+8*s>>2],a=b[t+(8*s+4)>>2],c=0;c<a;c++)V.printChar(e,S[o+c]);n+=a}return b[r>>2]=n,0},d:function(){return 6},e:function(){return 28},b:function(e){switch(e){case 30:return 16384;case 85:return 131072;case 132:case 133:case 12:case 137:case 138:case 15:case 235:case 16:case 17:case 18:case 19:case 20:case 149:case 13:case 10:case 236:case 153:case 9:case 21:case 22:case 159:case 154:case 14:case 77:case 78:case 139:case 82:case 68:case 67:case 164:case 11:case 29:case 47:case 48:case 95:case 52:case 51:case 46:return 200809;case 27:case 246:case 127:case 128:case 23:case 24:case 160:case 161:case 181:case 182:case 242:case 183:case 184:case 243:case 244:case 245:case 165:case 178:case 179:case 49:case 50:case 168:case 169:case 175:case 170:case 171:case 172:case 97:case 76:case 32:case 173:case 35:case 80:case 81:case 79:return-1;case 176:case 177:case 7:case 155:case 8:case 157:case 125:case 126:case 92:case 93:case 129:case 130:case 131:case 94:case 91:return 1;case 74:case 60:case 69:case 70:case 4:return 1024;case 31:case 42:case 72:return 32;case 87:case 26:case 33:return 2147483647;case 34:case 1:return 47839;case 38:case 36:return 99;case 43:case 37:return 2048;case 0:return 2097152;case 3:return 65536;case 28:return 32768;case 44:return 32767;case 75:return 16384;case 39:return 1e3;case 89:return 700;case 71:return 256;case 40:return 255;case 2:return 100;case 180:return 64;case 25:return 20;case 5:return 16;case 6:return 6;case 73:return 4;case 84:return"object"==typeof navigator&&navigator.hardwareConcurrency||1}return U(28),-1}},G=(function(){var e={a:Y};function t(e,t){var i=e.exports;n.asm=i,_((p=n.asm.q).buffer),E=n.asm.D,function(e){if(M--,n.monitorRunDependencies&&n.monitorRunDependencies(M),0==M&&D){var t=D;D=null,t()}}()}function r(e){t(e.instance)}function s(t){return(u||"function"!=typeof fetch?Promise.resolve().then((function(){return k(L)})):fetch(L,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+L+"'";return e.arrayBuffer()})).catch((function(){return k(L)}))).then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){f("failed to asynchronously prepare wasm: "+e),R(e)}))}if(M++,n.monitorRunDependencies&&n.monitorRunDependencies(M),n.instantiateWasm)try{return n.instantiateWasm(e,t)}catch(o){return f("Module.instantiateWasm callback failed with error: "+o),false}(u||"function"!=typeof WebAssembly.instantiateStreaming||O(L)||"function"!=typeof fetch?s(r):fetch(L,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(r,(function(e){return f("wasm streaming compile failed: "+e),f("falling back to ArrayBuffer instantiation"),s(r)}))}))).catch(i)}(),n.___wasm_call_ctors=function(){return(G=n.___wasm_call_ctors=n.asm.r).apply(null,arguments)}),$=(n._getModelBufferMemoryOffset=function(){return(n._getModelBufferMemoryOffset=n.asm.s).apply(null,arguments)},n._getInputMemoryOffset=function(){return(n._getInputMemoryOffset=n.asm.t).apply(null,arguments)},n._getInputHeight=function(){return(n._getInputHeight=n.asm.u).apply(null,arguments)},n._getInputWidth=function(){return(n._getInputWidth=n.asm.v).apply(null,arguments)},n._getInputChannelCount=function(){return(n._getInputChannelCount=n.asm.w).apply(null,arguments)},n._getOutputMemoryOffset=function(){return(n._getOutputMemoryOffset=n.asm.x).apply(null,arguments)},n._getOutputHeight=function(){return(n._getOutputHeight=n.asm.y).apply(null,arguments)},n._getOutputWidth=function(){return(n._getOutputWidth=n.asm.z).apply(null,arguments)},n._getOutputChannelCount=function(){return(n._getOutputChannelCount=n.asm.A).apply(null,arguments)},n._loadModel=function(){return(n._loadModel=n.asm.B).apply(null,arguments)},n._runInference=function(){return(n._runInference=n.asm.C).apply(null,arguments)},n.___errno_location=function(){return($=n.___errno_location=n.asm.E).apply(null,arguments)});function z(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function J(e){function i(){H||(H=true,n.calledRun=true,y||(F(I),F(P),t(n),n.onRuntimeInitialized&&n.onRuntimeInitialized(),function(){if(n.postRun)for("function"==typeof n.postRun&&(n.postRun=[n.postRun]);n.postRun.length;)e=n.postRun.shift(),A.unshift(e);var e;F(A)}()))}M>0||(function(){if(n.preRun)for("function"==typeof n.preRun&&(n.preRun=[n.preRun]);n.preRun.length;)e=n.preRun.shift(),T.unshift(e);var e;F(T)}(),M>0||(n.setStatus?(n.setStatus("Running..."),setTimeout((function(){setTimeout((function(){n.setStatus("")}),1),i()}),1)):i()))}if(D=function e(){H||J(),H||(D=e)},n.run=J,n.preInit)for("function"==typeof n.preInit&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return J(),e.ready});e.exports=n},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(4),n=i(394),s=i(395),o=i(396),a=i(397),c=i(398),l=i(67),d=i(78);t.glsl=String.raw,t.segmentationDimensions={model96:{height:96,width:160},model144:{height:144,width:256}};class u{constructor(){this.logger=r.LoggerService.getInstance(),this.vbService=l.VirtualBackgroundService.getInstance(),this.outputCanvasElement=null,this.vbService.setPostProcessingValue()}static create(){return new u}async init(){try{this.tflite=this.vbService.tflite,this.outputCanvasElement=this.vbService.outputCanvasElement,this.gl=this.vbService.gl,this.segmentationPixelCount=this.vbService.segmentationPixelCount,this.VIRTUAL_BACKGROUND_TYPE=l.VIRTUAL_BACKGROUND_TYPE,this.statsEnabled=this.vbService.statsEnabledFlag,this.stats=this.vbService.stats,this.vbHelper=d.WebglHelper.create();const e=t.glsl`#version 300 es

            in vec2 a_position;
            in vec2 a_texCoord;
            
            // a varying to pass the texture coordinates to the fragment shader
            out vec2 v_texCoord;
            
            void main(){
                //Recovers the position of the current vertex (with a projection on the plane)
                gl_Position = vec4(a_position, 0.0, 1.0);

                // Pass the texcoord to the fragment shader.
                v_texCoord = a_texCoord;
            }`;this.vertexShader=this.vbHelper.initShader(this.gl,this.gl.VERTEX_SHADER,e),this.vertexArray=this.gl.createVertexArray(),this.gl.bindVertexArray(this.vertexArray),this.positionBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),this.gl.STATIC_DRAW),this.texCoordBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texCoordBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,1,1]),this.gl.STATIC_DRAW),this.inputFrameTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputFrameTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.personMaskTexture=this.vbHelper.createTexture(this.gl,this.gl.RGBA8,this.vbService.videoElement.width,this.vbService.videoElement.height),this.options=this.vbService.options,this.segmentationMaskCanvas=document.createElement("canvas"),this.segmentationMaskCanvas.width=this.options.segmentationDimensions.width,this.segmentationMaskCanvas.height=this.options.segmentationDimensions.height,this.segmentationTexture=this.vbHelper.createTexture(this.gl,this.gl.RGBA8,this.segmentationMaskCanvas.width,this.segmentationMaskCanvas.height),this.virtualBackgroundResizingStage=n.ResizingStage.create(this),this.virtualBackgroundSoftMax=s.SoftMax.create(this),this.virtualBackgroundJointBilateralFilter=o.JointBilateralFilter.create(this),this.virtualBackgroundImageStage=await c.ImageStage.create(this.options,this),this.virtualBackgroundBlurStage=a.BlurStage.create(this.options,this),this.updatePostProcessingConfig(),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT)}catch(e){this.vbService.setBackgroundMode("blur",null),this.logger.error("[VirtualBackgroundWebGL2Pipeline] startEffect -- Failure -- "+e.message)}}async render(){try{if(this.vbService.statsEnabledFlag){const e=performance.now();this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputFrameTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.vbService.videoElement),this.gl.bindVertexArray(this.vertexArray);const t=performance.now();await this.virtualBackgroundResizingStage.render();const i=performance.now();this.tflite._runInference();const r=performance.now();this.virtualBackgroundSoftMax.render();const n=performance.now();this.virtualBackgroundJointBilateralFilter.render();const s=performance.now();this.virtualBackgroundImageStage?this.virtualBackgroundImageStage.render():this.virtualBackgroundBlurStage&&this.virtualBackgroundBlurStage.render();const o=performance.now();this.vbService.stats.value.fps++,this.vbService.stats.value.webglinitialization+=t-e,this.vbService.stats.value.resizingstage+=i-t,this.vbService.stats.value.tflite+=r-i,this.vbService.stats.value.softMax+=n-r,this.vbService.stats.value.jointBilateralFilter+=s-n,this.vbService.stats.value.realization+=o-s}else this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputFrameTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.vbService.videoElement),this.gl.bindVertexArray(this.vertexArray),await this.virtualBackgroundResizingStage.render(),this.tflite._runInference(),this.virtualBackgroundSoftMax.render(),this.virtualBackgroundJointBilateralFilter.render(),this.virtualBackgroundImageStage?this.virtualBackgroundImageStage.render():this.virtualBackgroundBlurStage&&this.virtualBackgroundBlurStage.render()}catch(e){this.logger.error("[VirtualBackgroudWebgl2Pipeline] render -- failure -- "+e.message)}}updatePostProcessingConfig(){const e={smoothSegmentation:true,jointBilateralFilter:{sigmaColor:this.vbService.sigmaColor,sigmaSpace:this.vbService.sigmaSpace},coverage:[this.vbService.coverageMin,this.vbService.coverageMax],lightWrapping:this.vbService.lightWrapping,blendMode:this.vbService.blendMode};this.virtualBackgroundJointBilateralFilter.updateSigmaSpace(e.jointBilateralFilter.sigmaSpace),this.virtualBackgroundJointBilateralFilter.updateSigmaColor(e.jointBilateralFilter.sigmaColor),this.virtualBackgroundImageStage?(this.virtualBackgroundImageStage.updateCoverage(e.coverage),this.virtualBackgroundImageStage.updateLightWrapping(e.lightWrapping),this.virtualBackgroundImageStage.updateBlendMode(e.blendMode)):this.virtualBackgroundBlurStage?this.virtualBackgroundBlurStage.updateCoverage(e.coverage):(this.virtualBackgroundImageStage.updateCoverage([0,.9999]),this.virtualBackgroundImageStage.updateLightWrapping(0))}cleanUp(){this.virtualBackgroundImageStage&&this.virtualBackgroundImageStage.cleanUp(),this.virtualBackgroundJointBilateralFilter&&this.virtualBackgroundJointBilateralFilter.cleanUp(),this.virtualBackgroundSoftMax&&this.virtualBackgroundSoftMax.cleanUp(),this.virtualBackgroundResizingStage&&this.virtualBackgroundResizingStage.cleanUp(),this.virtualBackgroundBlurStage&&this.virtualBackgroundBlurStage.cleanUp(),this.segmentationMaskCanvas&&this.segmentationMaskCanvas.remove(),this.personMaskTexture&&this.gl.deleteTexture(this.personMaskTexture),this.segmentationTexture&&this.gl.deleteTexture(this.segmentationTexture),this.inputFrameTexture&&this.gl.deleteTexture(this.inputFrameTexture),this.texCoordBuffer&&this.gl.deleteBuffer(this.texCoordBuffer),this.positionBuffer&&this.gl.deleteBuffer(this.positionBuffer),this.vertexArray&&this.gl.deleteVertexArray(this.vertexArray),this.vertexShader&&this.gl.deleteShader(this.vertexShader)}}t.Webgl2Pipeline=u},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(78);class n{static create(e){return new n(e)}constructor(e){this.vbWebgl2=e,this.vbHelper=r.WebglHelper.create(),this.gl=this.vbWebgl2.gl,this.segmentationMaskWidth=this.vbWebgl2.segmentationMaskCanvas.width,this.segmentationMaskHeight=this.vbWebgl2.segmentationMaskCanvas.height;const t=String.raw`#version 300 es
        precision highp float;
        
        uniform sampler2D u_inputFrame;
        
        in vec2 v_texCoord;
        
        out vec4 outColor;
        
        void main(){
            outColor = texture(u_inputFrame, v_texCoord);
        }`;this.fragmentShader=this.vbHelper.initShader(this.gl,this.gl.FRAGMENT_SHADER,t),this.program=this.vbHelper.initProgram(this.gl,this.vbWebgl2.vertexShader,this.fragmentShader,this.vbWebgl2.positionBuffer,this.vbWebgl2.texCoordBuffer),this.videoTexture=this.vbHelper.createTexture(this.gl,this.gl.RGBA8,this.segmentationMaskWidth,this.segmentationMaskHeight),this.videoFrameBuffer=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.videoFrameBuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.videoTexture,0),this.videoOutputPixels=new Uint8Array(4*this.vbWebgl2.segmentationPixelCount);const i=this.gl.getUniformLocation(this.program,"u_inputFrame");this.gl.useProgram(this.program),this.gl.uniform1i(i,0)}async render(){if(this.vbWebgl2.statsEnabled){const e=performance.now();this.gl.viewport(0,0,this.segmentationMaskWidth,this.segmentationMaskHeight),this.gl.useProgram(this.program),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.videoFrameBuffer),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4);const t=this.gl.createBuffer();this.gl.bindBuffer(this.gl.PIXEL_PACK_BUFFER,t),this.gl.bufferData(this.gl.PIXEL_PACK_BUFFER,this.videoOutputPixels.byteLength,this.gl.STREAM_READ),this.gl.readPixels(0,0,this.segmentationMaskWidth,this.segmentationMaskHeight,this.gl.RGBA,this.gl.UNSIGNED_BYTE,0),this.gl.bindBuffer(this.gl.PIXEL_PACK_BUFFER,null);const i=performance.now();await this.getBufferSubDataAsync(t,this.videoOutputPixels),this.gl.deleteBuffer(t);const r=performance.now(),n=this.vbWebgl2.tflite,s=n._getInputMemoryOffset()/4,o=performance.now();for(let c=0;c<this.vbWebgl2.segmentationPixelCount;c++){const e=s+3*c,t=4*c;n.HEAPF32[e]=this.videoOutputPixels[t]/255,n.HEAPF32[e+1]=this.videoOutputPixels[t+1]/255,n.HEAPF32[e+2]=this.videoOutputPixels[t+2]/255}const a=performance.now();this.vbWebgl2.stats.value.initialisation+=i-e,this.vbWebgl2.stats.value.synchro+=r-i,this.vbWebgl2.stats.value.copy+=o-r,this.vbWebgl2.stats.value.ecriture+=a-o}else{this.gl.viewport(0,0,this.segmentationMaskWidth,this.segmentationMaskHeight),this.gl.useProgram(this.program),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.videoFrameBuffer),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4);const e=this.gl.createBuffer();this.gl.bindBuffer(this.gl.PIXEL_PACK_BUFFER,e),this.gl.bufferData(this.gl.PIXEL_PACK_BUFFER,this.videoOutputPixels.byteLength,this.gl.STREAM_READ),this.gl.readPixels(0,0,this.segmentationMaskWidth,this.segmentationMaskHeight,this.gl.RGBA,this.gl.UNSIGNED_BYTE,0),this.gl.bindBuffer(this.gl.PIXEL_PACK_BUFFER,null),await this.getBufferSubDataAsync(e,this.videoOutputPixels),this.gl.deleteBuffer(e);const t=this.vbWebgl2.tflite,i=t._getInputMemoryOffset()/4;for(let r=0;r<this.vbWebgl2.segmentationPixelCount;r++){const e=i+3*r,n=4*r;t.HEAPF32[e]=this.videoOutputPixels[n]/255,t.HEAPF32[e+1]=this.videoOutputPixels[n+1]/255,t.HEAPF32[e+2]=this.videoOutputPixels[n+2]/255}}}cleanUp(){this.videoFrameBuffer&&this.gl.deleteFramebuffer(this.videoFrameBuffer),this.videoTexture&&this.gl.deleteTexture(this.videoTexture),this.program&&this.gl.deleteProgram(this.program),this.fragmentShader&&this.gl.deleteShader(this.fragmentShader)}async getBufferSubDataAsync(e,t){const i=this.gl.fenceSync(this.gl.SYNC_GPU_COMMANDS_COMPLETE,0);this.gl.flush();const r=await this.clientWaitAsync(i);this.gl.deleteSync(i),r!==this.gl.WAIT_FAILED&&(this.gl.bindBuffer(this.gl.PIXEL_PACK_BUFFER,e),this.gl.getBufferSubData(this.gl.PIXEL_PACK_BUFFER,0,t),this.gl.bindBuffer(this.gl.PIXEL_PACK_BUFFER,null))}clientWaitAsync(e){return new Promise((t=>{const i=()=>{const r=this.gl.clientWaitSync(e,0,0);r!==this.gl.WAIT_FAILED?r!==this.gl.TIMEOUT_EXPIRED?t(r):requestAnimationFrame(i):t(r)};requestAnimationFrame(i)}))}}t.ResizingStage=n},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(78);class n{static create(e){return new n(e)}constructor(e){this.vbWebgl2=e,this.vbHelper=r.WebglHelper.create(),this.segmentationMaskWidth=this.vbWebgl2.segmentationMaskCanvas.width,this.segmentationMaskHeight=this.vbWebgl2.segmentationMaskCanvas.height,this.gl=this.vbWebgl2.gl;const t=String.raw`#version 300 es
        precision highp float;
    
        // Passed in from the vertex shader.
        in vec2 v_texCoord;
    
        out vec4 outColor;
    
        uniform sampler2D u_inputSegmentation;
    
        void main() {
            // The softMax equation to retrieve the maximum of the 2 values returned by the AI for each pixel.
            // We pass this value in our alpha afterwards to obtain the mask
            vec2 segmentation = texture(u_inputSegmentation, v_texCoord).rg;
            float shift = max(segmentation.r, segmentation.g);
            float backgroundExp = exp(segmentation.r - shift);
            float personExp = exp(segmentation.g - shift);
            outColor = vec4(vec3(0.0), personExp / (backgroundExp + personExp));
        }`;this.fragmentShader=this.vbHelper.initShader(this.gl,this.gl.FRAGMENT_SHADER,t),this.program=this.vbHelper.initProgram(this.gl,this.vbWebgl2.vertexShader,this.fragmentShader,this.vbWebgl2.positionBuffer,this.vbWebgl2.texCoordBuffer),this.inputTexture=this.vbHelper.createTexture(this.gl,this.gl.RG32F,this.segmentationMaskWidth,this.segmentationMaskHeight),this.frameBuffer=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frameBuffer),this.gl.framebufferTexture2D(this.gl.DRAW_FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.vbWebgl2.segmentationTexture,0);const i=this.gl.getUniformLocation(this.program,"u_inputSegmentation");this.gl.useProgram(this.program),this.gl.uniform1i(i,1)}render(){const e=this.vbWebgl2.tflite,t=e._getOutputMemoryOffset()/4;this.gl.viewport(0,0,this.segmentationMaskWidth,this.segmentationMaskHeight),this.gl.useProgram(this.program),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,0,0,this.segmentationMaskWidth,this.segmentationMaskHeight,this.gl.RG,this.gl.FLOAT,e.HEAPF32,t),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frameBuffer),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}cleanUp(){this.inputTexture&&this.gl.deleteTexture(this.inputTexture),this.frameBuffer&&this.gl.deleteFramebuffer(this.frameBuffer),this.program&&this.gl.deleteProgram(this.program),this.fragmentShader&&this.gl.deleteShader(this.fragmentShader)}}t.SoftMax=n},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(78);class n{static create(e){return new n(e)}constructor(e){this.vbWebgl2=e,this.vbHelper=r.WebglHelper.create(),this.outputCanvasWidth=this.vbWebgl2.outputCanvasElement.width,this.outputCanvasHeight=this.vbWebgl2.outputCanvasElement.height,this.segmentationMaskWidth=this.vbWebgl2.segmentationMaskCanvas.width,this.segmentationMaskHeight=this.vbWebgl2.segmentationMaskCanvas.height,this.texelWidth=1/this.outputCanvasWidth,this.texelHeight=1/this.outputCanvasHeight,this.gl=this.vbWebgl2.gl;const t=String.raw`#version 300 es
        precision highp float;
    
        uniform sampler2D u_inputFrame;
        uniform sampler2D u_segmentationMask;
        uniform vec2 u_texelSize;
        uniform float u_step;
        uniform float u_radius;
        uniform float u_offset;
        uniform float u_sigmaTexel;
        uniform float u_sigmaColor;
    
        in vec2 v_texCoord;
    
        out vec4 outColor;
    
        float gaussian(float x, float sigma) {
            float coeff = -0.5 / (sigma * sigma * 4.0 + 1.0e-6);
            return exp((x * x) * coeff);
        }
        
        void main() {
            vec2 centerCoord = v_texCoord;
            vec3 centerColor = texture(u_inputFrame, centerCoord).rgb;
            float newVal = 0.0;
    
            float spaceWeight = 0.0;
            float colorWeight = 0.0;
            float totalWeight = 0.0;
    
            // Subsample kernel space.
            for (float i = -u_radius + u_offset; i <= u_radius; i += u_step) {
                for (float j = -u_radius + u_offset; j <= u_radius; j += u_step) {
                    vec2 shift = vec2(j, i) * u_texelSize;
                    vec2 coord = vec2(centerCoord + shift);
                    vec3 frameColor = texture(u_inputFrame, coord).rgb;
                    float outVal = texture(u_segmentationMask, coord).a;
    
                    spaceWeight = gaussian(distance(centerCoord, coord), u_sigmaTexel);
                    colorWeight = gaussian(distance(centerColor, frameColor), u_sigmaColor);
                    totalWeight += spaceWeight * colorWeight;
    
                    newVal += spaceWeight * colorWeight * outVal;
                }
            }
            newVal /= totalWeight;
    
            outColor = vec4(vec3(0.0), newVal);
          }`,i=this.vbHelper.initShader(this.gl,this.gl.FRAGMENT_SHADER,t);this.program=this.vbHelper.initProgram(this.gl,this.vbWebgl2.vertexShader,i,this.vbWebgl2.positionBuffer,this.vbWebgl2.texCoordBuffer);const n=this.gl.getUniformLocation(this.program,"u_inputFrame"),s=this.gl.getUniformLocation(this.program,"u_segmentationMask"),o=this.gl.getUniformLocation(this.program,"u_texelSize");this.stepLocation=this.gl.getUniformLocation(this.program,"u_step"),this.radiusLocation=this.gl.getUniformLocation(this.program,"u_radius"),this.offsetLocation=this.gl.getUniformLocation(this.program,"u_offset"),this.sigmaTexelLocation=this.gl.getUniformLocation(this.program,"u_sigmaTexel"),this.sigmaColorLocation=this.gl.getUniformLocation(this.program,"u_sigmaColor"),this.frameBuffer=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frameBuffer),this.gl.framebufferTexture2D(this.gl.DRAW_FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.vbWebgl2.personMaskTexture,0),this.gl.useProgram(this.program),this.gl.uniform1i(n,0),this.gl.uniform1i(s,1),this.gl.uniform2f(o,this.texelWidth,this.texelHeight),this.updateSigmaSpace(0),this.updateSigmaColor(0)}render(){this.gl.viewport(0,0,this.outputCanvasWidth,this.outputCanvasHeight),this.gl.useProgram(this.program),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.vbWebgl2.segmentationTexture),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frameBuffer),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}updateSigmaSpace(e){e*=Math.max(this.outputCanvasWidth/this.segmentationMaskWidth,this.outputCanvasHeight/this.segmentationMaskHeight);const t=Math.max(1,.66*Math.sqrt(e)),i=e,r=t>1?.5*t:0,n=Math.max(this.texelWidth,this.texelHeight)*e;this.gl.useProgram(this.program),this.gl.uniform1f(this.stepLocation,t),this.gl.uniform1f(this.radiusLocation,i),this.gl.uniform1f(this.offsetLocation,r),this.gl.uniform1f(this.sigmaTexelLocation,n)}updateSigmaColor(e){this.gl.useProgram(this.program),this.gl.uniform1f(this.sigmaColorLocation,e)}cleanUp(){this.frameBuffer&&this.gl.deleteFramebuffer(this.frameBuffer),this.program&&this.gl.deleteProgram(this.program),this.fragmentShader&&this.gl.deleteShader(this.fragmentShader)}}t.JointBilateralFilter=n},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(78);class n{static create(e,t){return e.backgroundType===t.VIRTUAL_BACKGROUND_TYPE.IMAGE||e.backgroundType===t.VIRTUAL_BACKGROUND_TYPE.VIDEO?null:new n(t,e)}constructor(e,t){this.blur=new s(e,t),this.blend=new o(e)}render(){this.blur.render(),this.blend.render()}updateCoverage(e){this.blend.updateCoverage(e)}cleanUp(){this.blend.cleanUp(),this.blur.cleanUp()}}t.BlurStage=n;class s{constructor(e,t){this.vbHelper=r.WebglHelper.create(),this.vbWebgl2=e,this.gl=this.vbWebgl2.gl,this.options=t;const i=this.vbWebgl2.outputCanvasElement.width,n=this.vbWebgl2.outputCanvasElement.height,s=String.raw`#version 300 es
            precision highp float;
            
            uniform sampler2D u_inputFrame;
            uniform sampler2D u_personMask;
            uniform vec2 u_texelSize;
            
            in vec2 v_texCoord;
            
            out vec4 outColor;
            
            const float offset[5] = float[](0.0, 1.0, 2.0, 3.0, 4.0);
            const float weight[5] = float[](0.2270270270, 0.1945945946, 0.1216216216,
                0.0540540541, 0.0162162162);
            
            void main(){
                vec4 centerColor = texture(u_inputFrame, v_texCoord);
                float personMask = texture(u_personMask, v_texCoord).a;

                vec4 frameColor = centerColor * weight[0] * (1.0 - personMask);
                
                for (int i=1; i<5; i++){
                    vec2 offset = vec2(offset[i]) * u_texelSize;

                    vec2 texCoord = v_texCoord + offset;
                    frameColor += texture(u_inputFrame, texCoord) * weight[i] *
                        (1.0 - texture(u_personMask, texCoord).a);
                    
                    texCoord = v_texCoord - offset;
                    frameColor += texture(u_inputFrame, texCoord) * weight[i] * 
                        (1.0 - texture(u_personMask, texCoord).a);
                }
                outColor = vec4(frameColor.rgb + (1.0 - frameColor.a) * centerColor.rgb, 1.0);
            }`,o=String.raw`#version 300 es
            precision highp float;
            
            uniform sampler2D u_inputFrame;
            uniform sampler2D u_personMask;
            uniform vec2 u_texelSize;
            
            in vec2 v_texCoord;
            
            out vec4 outColor;
            
            const float offset[5] = float[](0.0, 3.0, 6.0, 9.0, 12.0);
            const float weight[5] = float[](0.2270270270, 0.1945945946, 0.1216216216,
                0.0540540541, 0.0162162162);
            
            void main(){
                vec4 centerColor = texture(u_inputFrame, v_texCoord);
                float personMask = texture(u_personMask, v_texCoord).a;

                vec4 frameColor = centerColor * weight[0] * (1.0 - personMask);
                
                for (int i=1; i<5; i++){
                    vec2 offset = vec2(offset[i]) * u_texelSize;

                    vec2 texCoord = v_texCoord + offset;
                    frameColor += texture(u_inputFrame, texCoord) * weight[i] *
                        (1.0 - texture(u_personMask, texCoord).a);
                    
                    texCoord = v_texCoord - offset;
                    frameColor += texture(u_inputFrame, texCoord) * weight[i] * 
                        (1.0 - texture(u_personMask, texCoord).a);
                }
                outColor = vec4(frameColor.rgb + (1.0 - frameColor.a) * centerColor.rgb, 1.0);
            }`;this.outputWidth=.5*i,this.outputHeight=.5*n,this.texelWidth=1/this.outputWidth,this.texelHeight=1/this.outputHeight,this.options.backgroundType===e.VIRTUAL_BACKGROUND_TYPE.BLUR?this.fragmentShaderBlur=this.vbHelper.initShader(this.gl,this.gl.FRAGMENT_SHADER,s):this.options.backgroundType===e.VIRTUAL_BACKGROUND_TYPE.BLUR_PLUS&&(this.fragmentShaderBlur=this.vbHelper.initShader(this.gl,this.gl.FRAGMENT_SHADER,o)),this.program=this.vbHelper.initProgram(this.gl,this.vbWebgl2.vertexShader,this.fragmentShaderBlur,this.vbWebgl2.positionBuffer,this.vbWebgl2.texCoordBuffer),this.inputFrameLocation=this.gl.getUniformLocation(this.program,"u_inputFrame"),this.personMaskLocation=this.gl.getUniformLocation(this.program,"u_personMask"),this.texelSizeLocation=this.gl.getUniformLocation(this.program,"u_texelSize"),this.texture1=this.vbHelper.createTexture(this.gl,this.gl.RGBA8,this.outputWidth,this.outputHeight,this.gl.NEAREST,this.gl.LINEAR),this.texture2=this.vbHelper.createTexture(this.gl,this.gl.RGBA8,this.outputWidth,this.outputHeight,this.gl.NEAREST,this.gl.LINEAR),this.frameBuffer1=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frameBuffer1),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.texture1,0),this.frameBuffer2=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frameBuffer2),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.texture2,0),this.gl.useProgram(this.program),this.gl.uniform1i(this.personMaskLocation,1)}render(){this.gl.viewport(0,0,this.outputWidth,this.outputHeight),this.gl.useProgram(this.program),this.gl.uniform1i(this.inputFrameLocation,0),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.vbWebgl2.personMaskTexture);for(let e=0;e<3;e++)this.gl.uniform2f(this.texelSizeLocation,0,this.texelHeight),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frameBuffer1),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.gl.activeTexture(this.gl.TEXTURE2),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture1),this.gl.uniform1i(this.inputFrameLocation,2),this.gl.uniform2f(this.texelSizeLocation,this.texelWidth,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frameBuffer2),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture2)}cleanUp(){this.frameBuffer1&&this.gl.deleteFramebuffer(this.frameBuffer1),this.frameBuffer2&&this.gl.deleteFramebuffer(this.frameBuffer2),this.texture1&&this.gl.deleteTexture(this.texture1),this.texture2&&this.gl.deleteTexture(this.texture2),this.program&&this.gl.deleteProgram(this.program),this.fragmentShaderBlur&&this.gl.deleteShader(this.fragmentShaderBlur)}}t.BlurPass=s;class o{constructor(e){this.vbWebgl2=e,this.vbHelper=r.WebglHelper.create();const t=String.raw`#version 300 es
            
        in vec2 a_position;
        in vec2 a_texCoord;
        
        out vec2 v_texCoord;
        
        void main(){
            gl_Position = vec4(a_position * vec2(1.0, -1.0), 0.0, 1.0);
            v_texCoord = a_texCoord;
        }`,i=String.raw`#version 300 es
            precision highp float;
            
            uniform sampler2D u_inputFrame;
            uniform sampler2D u_personMask;
            uniform sampler2D u_blurredInputFrame;
            uniform vec2 u_coverage;
            
            in vec2 v_texCoord;
            
            out vec4 outColor;
            
            void main(){
                vec3 color = texture(u_inputFrame, v_texCoord).rgb;
                vec3 blurredColor = texture(u_blurredInputFrame, v_texCoord).rgb;
                float personMask = texture(u_personMask, v_texCoord).a;
                personMask = smoothstep(u_coverage.x, u_coverage.y, personMask);
                outColor = vec4(mix(blurredColor, color, personMask), 1.0);
            }`;this.gl=this.vbWebgl2.gl,this.vertexShaderBlend=this.vbHelper.initShader(this.gl,this.gl.VERTEX_SHADER,t),this.fragmentShaderBlend=this.vbHelper.initShader(this.gl,this.gl.FRAGMENT_SHADER,i),this.program=this.vbHelper.initProgram(this.gl,this.vertexShaderBlend,this.fragmentShaderBlend,this.vbWebgl2.positionBuffer,this.vbWebgl2.texCoordBuffer);const n=this.gl.getUniformLocation(this.program,"u_inputFame"),s=this.gl.getUniformLocation(this.program,"u_personMask"),o=this.gl.getUniformLocation(this.program,"u_blurredInputFrame");this.coverageLocation=this.gl.getUniformLocation(this.program,"u_coverage"),this.gl.useProgram(this.program),this.gl.uniform1i(n,0),this.gl.uniform1i(s,1),this.gl.uniform1i(o,2),this.gl.uniform2f(this.coverageLocation,0,1)}render(){this.gl.viewport(0,0,this.vbWebgl2.outputCanvasElement.width,this.vbWebgl2.outputCanvasElement.height),this.gl.useProgram(this.program),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}updateCoverage(e){this.gl.useProgram(this.program),this.gl.uniform2f(this.coverageLocation,e[0],e[1])}cleanUp(){this.program&&this.gl.deleteProgram(this.program),this.fragmentShaderBlend&&this.gl.deleteShader(this.fragmentShaderBlend),this.vertexShaderBlend&&this.gl.deleteShader(this.vertexShaderBlend)}}t.BlendPass=o},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(78);class n{constructor(e,t,i){this.vertexShaderImage=null,this.fragmentShaderImage=null,this.program=null,this.backgroundTexture=null,this.vbWebgl2=t,this.vbHelper=r.WebglHelper.create();const n=String.raw`#version 300 es        
            uniform vec2 u_backgroundScale;
            uniform vec2 u_backgroundOffset;
            
            in vec2 a_position;
            in vec2 a_texCoord;
            
            out vec2 v_texCoord;
            out vec2 v_backgroundCoord;
            
            void main(){
                gl_Position = vec4(a_position * vec2(1.0, - 1.0), 0.0, 1.0);
                v_texCoord = a_texCoord;
                v_backgroundCoord = a_texCoord * u_backgroundScale + u_backgroundOffset;
            }`,s=String.raw`#version 300 es
            
            precision highp float;
            
            uniform sampler2D u_inputFrame;
            uniform sampler2D u_personMask;
            uniform sampler2D u_background;
            uniform vec2 u_coverage;
            uniform float u_lightWrapping;
            uniform float u_blendMode;
            
            in vec2 v_texCoord;
            in vec2 v_backgroundCoord;
            
            out vec4 outColor;
            
            vec3 screen(vec3 a, vec3 b){
                return 1.0 - (1.0 - a) * (1.0 - b);
            }
            
            vec3 linearDodge(vec3 a, vec3 b){
                return a + b;
            }
            
            void main(){
                vec3 frameColor = texture(u_inputFrame, v_texCoord).rgb;
                vec3 backgroundColor = texture(u_background, v_backgroundCoord).rgb;
                float personMask = texture(u_personMask, v_texCoord).a;
                float lightWrapMask = 1.0 - max(0.0, personMask - u_coverage.y)/(1.0 - u_coverage.y);
                vec3 lightWrap = u_lightWrapping * lightWrapMask * backgroundColor;
                frameColor = u_blendMode * linearDodge(frameColor, lightWrap) +
                    (1.0 - u_blendMode) * screen(frameColor, lightWrap);
                personMask = smoothstep(u_coverage.x, u_coverage.y, personMask);
                outColor = vec4(frameColor * personMask + backgroundColor * (1.0 - personMask), 1.0);
            }`,o=this.vbWebgl2.outputCanvasElement.width,a=this.vbWebgl2.outputCanvasElement.height;this.gl=this.vbWebgl2.gl,this.vertexShaderImage=this.vbHelper.initShader(this.gl,this.gl.VERTEX_SHADER,n),this.fragmentShaderImage=this.vbHelper.initShader(this.gl,this.gl.FRAGMENT_SHADER,s),this.program=this.vbHelper.initProgram(this.gl,this.vertexShaderImage,this.fragmentShaderImage,this.vbWebgl2.positionBuffer,this.vbWebgl2.texCoordBuffer),this.backgroundScaleLocation=this.gl.getUniformLocation(this.program,"u_backgroundScale"),this.backgroundOffsetLocation=this.gl.getUniformLocation(this.program,"u_backgroundOffset");const c=this.gl.getUniformLocation(this.program,"u_inputFrame"),l=this.gl.getUniformLocation(this.program,"u_personMask");this.backgroundLocation=this.gl.getUniformLocation(this.program,"u_background"),this.coverageLocation=this.gl.getUniformLocation(this.program,"u_coverage"),this.lightWrappingLocation=this.gl.getUniformLocation(this.program,"u_lightWrapping"),this.blendModeLocation=this.gl.getUniformLocation(this.program,"u_blendMode"),this.outputRatio=o/a,this.gl.useProgram(this.program),this.gl.uniform2f(this.backgroundScaleLocation,1,1),this.gl.uniform2f(this.backgroundOffsetLocation,0,0),this.gl.uniform1i(c,0),this.gl.uniform1i(l,1),this.gl.uniform2f(this.coverageLocation,0,1),this.gl.uniform1f(this.lightWrappingLocation,0),this.gl.uniform1f(this.blendModeLocation,0);let d=null,u=null;this.options=i,this.options.backgroundType===this.vbWebgl2.VIRTUAL_BACKGROUND_TYPE.IMAGE?(d=e,e&&this.updateBackgroundImage(d)):this.options.backgroundType===this.vbWebgl2.VIRTUAL_BACKGROUND_TYPE.VIDEO&&(u=e,e&&this.updateBackgroundImage(u))}static create(e,t){return new Promise(((i,r)=>{if(e.backgroundType!==t.VIRTUAL_BACKGROUND_TYPE.IMAGE&&e.backgroundType!==t.VIRTUAL_BACKGROUND_TYPE.VIDEO)i(null);else if(e.backgroundType===t.VIRTUAL_BACKGROUND_TYPE.IMAGE){const s=new Image;s.crossOrigin="anonymous",s.onload=()=>{i(new n(s,t,e))},s.onerror=()=>{r(new Error("[VirtualBackgroundImageStage] -- create -- failed to load image"))},s.src=e.imgBg}else if(e.backgroundType===t.VIRTUAL_BACKGROUND_TYPE.VIDEO){const s=document.createElement("video");s.crossOrigin="anonymous",s.onloadeddata=()=>{i(new n(s,t,e))},s.onerror=()=>{r(new Error("[VirtualBackgroundImageStage] -- create -- failed to load video"))},s.src=e.imgBg,s.play(),s.autoplay=true,s.muted=true,s.loop=true}}))}render(){this.gl.viewport(0,0,this.vbWebgl2.outputCanvasElement.width,this.vbWebgl2.outputCanvasElement.height),this.gl.useProgram(this.program),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.vbWebgl2.personMaskTexture),null!==this.backgroundTexture&&(this.gl.activeTexture(this.gl.TEXTURE2),this.gl.bindTexture(this.gl.TEXTURE_2D,this.backgroundTexture),this.gl.uniform1i(this.backgroundLocation,2),this.options.backgroundType===this.vbWebgl2.VIRTUAL_BACKGROUND_TYPE.VIDEO&&this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,0,0,this.video.videoWidth,this.video.videoHeight,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.video)),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}updateCoverage(e){this.gl.useProgram(this.program),this.gl.uniform2f(this.coverageLocation,e[0],e[1])}updateLightWrapping(e){this.gl.useProgram(this.program),this.gl.uniform1f(this.lightWrappingLocation,e)}updateBlendMode(e){this.gl.useProgram(this.program),this.gl.uniform1f(this.blendModeLocation,"screen"===e?0:1)}cleanUp(){this.backgroundTexture&&this.gl.deleteTexture(this.backgroundTexture),this.program&&this.gl.deleteProgram(this.program),this.fragmentShaderImage&&this.gl.deleteShader(this.fragmentShaderImage),this.vertexShaderImage&&this.gl.deleteShader(this.vertexShaderImage)}updateBackgroundImage(e){let t,i,r,n;this.options.backgroundType===this.vbWebgl2.VIRTUAL_BACKGROUND_TYPE.IMAGE&&(this.backgroundTexture=this.vbHelper.createTexture(this.gl,this.gl.RGBA8,e.naturalWidth,e.naturalHeight,this.gl.LINEAR,this.gl.LINEAR),this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,0,0,e.naturalWidth,e.naturalHeight,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),t=e.naturalWidth,i=e.naturalHeight,r=e.naturalWidth,n=e.naturalHeight),this.options.backgroundType===this.vbWebgl2.VIRTUAL_BACKGROUND_TYPE.VIDEO&&(this.backgroundTexture=this.vbHelper.createTexture(this.gl,this.gl.RGBA8,e.videoWidth,e.videoHeight,this.gl.LINEAR,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,this.backgroundTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),this.video=e,t=this.video.videoWidth,i=this.video.videoHeight,r=this.video.videoWidth,n=this.video.videoHeight);let s=0,o=0;t/i<this.outputRatio?(i=t/this.outputRatio,o=(n-i)/2):(t=i*this.outputRatio,s=(r-t)/2);const a=t/r,c=i/n;s/=r,o/=n,this.gl.uniform2f(this.backgroundScaleLocation,a,c),this.gl.uniform2f(this.backgroundOffsetLocation,s,o)}}t.ImageStage=n},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(67),n=i(4);class s{constructor(){this.vbService=r.VirtualBackgroundService.getInstance(),this.logger=n.LoggerService.getInstance()}static create(){return new s}async init(){try{this.tflite=this.vbService.tflite,this.segmentationPixelCount=this.vbService.segmentationPixelCount,this.segmentationMask=new ImageData(this.vbService.options.segmentationDimensions.width,this.vbService.options.segmentationDimensions.height),this.segmentationMaskCanvas=document.createElement("canvas"),this.segmentationMaskCanvas.width=this.vbService.options.segmentationDimensions.width,this.segmentationMaskCanvas.height=this.vbService.options.segmentationDimensions.height,this.segmentationMaskCtx=this.segmentationMaskCanvas.getContext("2d"),this.outputCanvasCtx=this.vbService.outputCanvasElement.getContext("2d"),this.vbService.options.backgroundType===r.VIRTUAL_BACKGROUND_TYPE.IMAGE?(this.virtualImage=new Image,this.virtualImage.crossOrigin="anonymous",this.virtualImage.onload=()=>{},this.virtualImage.onerror=()=>{Error("[VirtualBackgroundCanvas2D] -- create -- failed to load image")},this.virtualImage.src=this.vbService.options.imgBg):this.vbService.options.backgroundType===r.VIRTUAL_BACKGROUND_TYPE.VIDEO&&(this.virtualVideo=document.createElement("video"),this.virtualVideo.crossOrigin="anonymous",this.virtualVideo.onplaying=()=>{},this.virtualVideo.onerror=()=>{Error("[VirtualBackgroundCanvas2D] -- create -- failed to load video")},this.virtualVideo.src=this.vbService.options.imgBg,this.virtualVideo.play(),this.virtualVideo.autoplay=true,this.virtualVideo.muted=true,this.virtualVideo.loop=true)}catch(e){this.logger.error("[VirtualBackgroundCanvas2D] startEffect -- Failure -- "+e.message)}}async render(){try{if(this.vbService.statsEnabledFlag){const e=performance.now();this.runPreProcessing();const t=performance.now();this.runInference();const i=performance.now();this.runPostProcessing();const r=performance.now();this.vbService.stats.value.fps++,this.vbService.stats.value.preProcessingDuration+=t-e,this.vbService.stats.value.inferenceDuration+=i-t,this.vbService.stats.value.postProcessingDuration+=r-i}else this.runPreProcessing(),this.runInference(),this.runPostProcessing()}catch(e){this.logger.error("[VirtualBackgroudCanvas2D] render -- failure -- "+e.message)}}updatePostProcessingConfig(){}cleanUp(){this.segmentationMaskCanvas.remove()}runPreProcessing(){this.segmentationMaskCtx.drawImage(this.vbService.videoElement,0,0,this.vbService.videoElement.width,this.vbService.videoElement.height,0,0,this.vbService.options.segmentationDimensions.width,this.vbService.options.segmentationDimensions.height);const e=this.segmentationMaskCtx.getImageData(0,0,this.vbService.options.segmentationDimensions.width,this.vbService.options.segmentationDimensions.height),t=this.tflite._getInputMemoryOffset()/4;for(let i=0;i<this.segmentationPixelCount;i++)this.tflite.HEAPF32[t+3*i]=e.data[4*i]/255,this.tflite.HEAPF32[t+3*i+1]=e.data[4*i+1]/255,this.tflite.HEAPF32[t+3*i+2]=e.data[4*i+2]/255}runInference(){this.tflite._runInference();const e=this.tflite._getOutputMemoryOffset()/4;for(let t=0;t<this.segmentationPixelCount;t++){const i=this.tflite.HEAPF32[e+2*t],r=this.tflite.HEAPF32[e+2*t+1],n=Math.max(i,r),s=Math.exp(i-n),o=Math.exp(r-n);this.segmentationMask.data[4*t+3]=255*o/(s+o)}this.segmentationMaskCtx.putImageData(this.segmentationMask,0,0)}runPostProcessing(){this.outputCanvasCtx.globalCompositeOperation="copy",this.outputCanvasCtx.filter=this.vbService.options.backgroundType===r.VIRTUAL_BACKGROUND_TYPE.IMAGE||this.vbService.options.backgroundType===r.VIRTUAL_BACKGROUND_TYPE.VIDEO?"blur(4px)":"blur(8px)",this.outputCanvasCtx.drawImage(this.segmentationMaskCanvas,0,0,this.vbService.options.segmentationDimensions.width,this.vbService.options.segmentationDimensions.height,0,0,this.vbService.videoElement.width,this.vbService.videoElement.height),this.outputCanvasCtx.globalCompositeOperation="source-in",this.outputCanvasCtx.filter="none",this.outputCanvasCtx.drawImage(this.vbService.videoElement,0,0),this.outputCanvasCtx.globalCompositeOperation="destination-over",this.vbService.options.backgroundType===r.VIRTUAL_BACKGROUND_TYPE.IMAGE?this.outputCanvasCtx.drawImage(this.virtualImage,0,0,this.vbService.videoElement.width,this.vbService.videoElement.height):this.vbService.options.backgroundType===r.VIRTUAL_BACKGROUND_TYPE.VIDEO?this.outputCanvasCtx.drawImage(this.virtualVideo,0,0,this.vbService.videoElement.width,this.vbService.videoElement.height):this.vbService.options.backgroundType===r.VIRTUAL_BACKGROUND_TYPE.BLUR?(this.outputCanvasCtx.filter="blur(6px)",this.outputCanvasCtx.drawImage(this.vbService.videoElement,0,0)):this.vbService.options.backgroundType===r.VIRTUAL_BACKGROUND_TYPE.BLUR_PLUS&&(this.outputCanvasCtx.filter="blur(30px)",this.outputCanvasCtx.drawImage(this.vbService.videoElement,0,0))}}t.Canvas2DPipeline=s},function(e,t,i){i.r(t),i.d(t,"SET_TIMEOUT",(function(){return r})),i.d(t,"CLEAR_TIMEOUT",(function(){return n})),i.d(t,"TIMEOUT_TICK",(function(){return s})),i.d(t,"timerWorkerScript",(function(){return a}));const r=1,n=2,s=3,o="\n    var timer;\n    onmessage = function(request) {\n        switch (request.data.id) {\n            case ".concat(r,": timer = setTimeout(() => { postMessage({ id: ").concat(s," }); }, request.data.timeMs); break;\n            case ").concat(n,": if (timer) clearTimeout(timer); break;\n        }\n    };\n"),a=URL.createObjectURL(new Blob([o],{type:"application/javascript"}))},function(e,t,i){var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:true}),n(i(79),t),n(i(55),t),n(i(61),t),n(i(68),t),n(i(69),t),n(i(143),t),n(i(109),t),n(i(144),t),n(i(167),t),n(i(145),t),n(i(408),t),n(i(409),t),n(i(168),t),n(i(410),t)},function(e,t,i){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:true}),t.formatText=void 0;var s=function(){function e(e){this._regularExpression=e}return e.prototype.format=function(e,t){var i;if(t){for(var r=t;null!=(i=this._regularExpression.exec(t));)r=r.replace(i[0],this.internalFormat(e,i));return r}return t},e}(),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.internalFormat=function(e,t){var i=new Date(Date.parse(t[1])),r=null!=t[2]?t[2].toLowerCase():"compact";return"compact"!=r?i.toLocaleDateString(e,{day:"numeric",weekday:r,month:r,year:"numeric"}):i.toLocaleDateString()},t}(s),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.internalFormat=function(e,t){return new Date(Date.parse(t[1])).toLocaleTimeString(e,{hour:"numeric",minute:"2-digit"})},t}(s);t.formatText=function(e,t){for(var i=t,r=0,n=[new o(/\{{2}DATE\((\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:Z|(?:(?:-|\+)\d{2}:\d{2})))(?:, ?(COMPACT|LONG|SHORT))?\)\}{2}/g),new a(/\{{2}TIME\((\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:Z|(?:(?:-|\+)\d{2}:\d{2})))\)\}{2}/g)];r<n.length;r++){i=n[r].format(e,i)}return i}},function(e,t,i){var r=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:true,get:function(){return t[i]}})}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||r(t,e,i)};Object.defineProperty(t,"__esModule",{value:true}),n(i(404),t),n(i(405),t)},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.MenuItem=void 0;var r=i(109),n=i(146),s=function(){function e(e,t){this._isEnabled=true,this.key=e,this._value=t}return e.prototype.click=function(){this.isEnabled&&this.onClick&&this.onClick(this)},e.prototype.updateCssClasses=function(){if(this._element){var e=this._hostConfig?this._hostConfig:r.defaultHostConfig;this._element.className=e.makeCssClassName("ac-ctrl"),this._element.classList.add(e.makeCssClassName(this.isEnabled?"ac-ctrl-dropdown-item":"ac-ctrl-dropdown-item-disabled")),this.isEnabled||this._element.classList.add(e.makeCssClassName("ac-disabled"))}},e.prototype.toString=function(){return this.value},e.prototype.render=function(e){var t=this;return this._hostConfig=e,this._element||(this._element=document.createElement("span"),this._element.innerText=this.value,this._element.setAttribute("role","menuitem"),this.isEnabled||this._element.setAttribute("aria-disabled","true"),this._element.setAttribute("aria-selected","false"),this._element.onmouseup=function(e){t.click()},this._element.onkeydown=function(e){e.key===n.Constants.keys.enter&&(e.cancelBubble=true,t.click())},this.updateCssClasses()),this._element},Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(e){this._value=e,this._element&&(this._element.innerText=e)},enumerable:false,configurable:true}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,this.updateCssClasses())},enumerable:false,configurable:true}),e}();t.MenuItem=s},function(e,t,i){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:true}),t.PopupMenu=void 0;var s=i(146),o=i(406),a=function(e){function t(){var t=e.call(this)||this;return t._items=new o.Collection,t._renderedItems=[],t._selectedIndex=-1,t}return n(t,e),t.prototype.renderContent=function(){var e=document.createElement("div");e.className=this.hostConfig.makeCssClassName("ac-ctrl ac-popup"),e.setAttribute("role","listbox");for(var t=0;t<this._items.length;t++){var i=this._items.get(t).render(this.hostConfig);i.tabIndex=0,e.appendChild(i),t==this.selectedIndex&&i.focus(),this._renderedItems.push(i)}return e},t.prototype.keyDown=function(t){e.prototype.keyDown.call(this,t);var i=this._selectedIndex;switch(t.key){case s.Constants.keys.tab:this.closePopup(true);break;case s.Constants.keys.up:(i<=0||--i<0)&&(i=this._renderedItems.length-1),this.selectedIndex=i,t.cancelBubble=true;break;case s.Constants.keys.down:(i<0||++i>=this._renderedItems.length)&&(i=0),this.selectedIndex=i,t.cancelBubble=true}},Object.defineProperty(t.prototype,"items",{get:function(){return this._items},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"selectedIndex",{get:function(){return this._selectedIndex},set:function(e){e>=0&&e<this._renderedItems.length&&(this._renderedItems[e].focus(),this._selectedIndex=e)},enumerable:false,configurable:true}),t}(i(407).PopupControl);t.PopupMenu=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.Collection=void 0;var r=function(){function e(){this._items=[]}return e.prototype.get=function(e){return this._items[e]},e.prototype.add=function(e){this._items.push(e),this.onItemAdded&&this.onItemAdded(e)},e.prototype.remove=function(e){var t=this._items.indexOf(e);t>=0&&(this._items=this._items.splice(t,1),this.onItemRemoved&&this.onItemRemoved(e))},e.prototype.indexOf=function(e){return this._items.indexOf(e)},Object.defineProperty(e.prototype,"length",{get:function(){return this._items.length},enumerable:false,configurable:true}),e}();t.Collection=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.PopupControl=void 0;var r=i(146),n=i(68),s=i(109),o=function(){function e(){this._isOpen=false}return e.prototype.keyDown=function(e){switch(e.key){case r.Constants.keys.escape:this.closePopup(true)}},e.prototype.render=function(e){var t=this,i=document.createElement("div");return i.tabIndex=0,i.className=this.hostConfig.makeCssClassName("ac-ctrl","ac-ctrl-popup-container"),i.setAttribute("role","dialog"),i.setAttribute("aria-modal","true"),i.onkeydown=function(e){return t.keyDown(e),!e.cancelBubble},i.appendChild(this.renderContent()),i},e.prototype.focus=function(){this._popupElement&&this._popupElement.firstElementChild.focus()},e.prototype.popup=function(e){var t,i,r,s,o,a=this;if(!this._isOpen){this._overlayElement=document.createElement("div"),this._overlayElement.className=this.hostConfig.makeCssClassName("ac-ctrl-overlay"),this._overlayElement.tabIndex=0,this._overlayElement.style.width=document.documentElement.scrollWidth+"px",this._overlayElement.style.height=document.documentElement.scrollHeight+"px",this._overlayElement.onfocus=function(e){a.closePopup(true)},document.body.appendChild(this._overlayElement);var c=e.getBoundingClientRect();this._popupElement=this.render(c),(t=this._popupElement.classList).remove.apply(t,this.hostConfig.makeCssClassNames("ac-ctrl-slide","ac-ctrl-slideLeftToRight","ac-ctrl-slideRightToLeft","ac-ctrl-slideTopToBottom","ac-ctrl-slideRightToLeft")),window.addEventListener("resize",(function(e){a.closePopup(true)}));var l=e.getAttribute("aria-label");l&&this._popupElement.setAttribute("aria-label",l),this._overlayElement.appendChild(this._popupElement);var d,u=this._popupElement.getBoundingClientRect(),h=window.innerHeight-c.bottom,f=c.top,p=c.left,g=(p=window.innerWidth-c.right,c.left),m=c.left+n.getScrollX();if(f<u.height&&h<u.height){var v=Math.min(u.height,window.innerHeight);if(this._popupElement.style.maxHeight=v+"px",d=v<u.height?n.getScrollY():n.getScrollY()+c.top+(c.height-v)/2,g<u.width&&p<u.width){var S=Math.min(u.width,window.innerWidth);this._popupElement.style.maxWidth=S+"px",m=S<u.width?n.getScrollX():n.getScrollX()+c.left+(c.width-S)/2}else p>=u.width?(m=n.getScrollX()+c.right,(i=this._popupElement.classList).add.apply(i,this.hostConfig.makeCssClassNames("ac-ctrl-slide","ac-ctrl-slideLeftToRight"))):(m=n.getScrollX()+c.left-u.width,(r=this._popupElement.classList).add.apply(r,this.hostConfig.makeCssClassNames("ac-ctrl-slide","ac-ctrl-slideRightToLeft")))}else h>=u.height?(d=n.getScrollY()+c.bottom,(s=this._popupElement.classList).add.apply(s,this.hostConfig.makeCssClassNames("ac-ctrl-slide","ac-ctrl-slideTopToBottom"))):(d=n.getScrollY()+c.top-u.height,(o=this._popupElement.classList).add.apply(o,this.hostConfig.makeCssClassNames("ac-ctrl-slide","ac-ctrl-slideBottomToTop"))),p<u.width&&(m=n.getScrollX()+c.right-u.width);this._popupElement.style.left=m+"px",this._popupElement.style.top=d+"px",this._popupElement.focus(),this._isOpen=true}},e.prototype.closePopup=function(e){this._isOpen&&(document.body.removeChild(this._overlayElement),this._isOpen=false,this.onClose&&this.onClose(this,e))},Object.defineProperty(e.prototype,"hostConfig",{get:function(){return this._hostConfig?this._hostConfig:s.defaultHostConfig},set:function(e){this._hostConfig=e},enumerable:false,configurable:true}),Object.defineProperty(e.prototype,"isOpen",{get:function(){return this._isOpen},enumerable:false,configurable:true}),e}();t.PopupControl=o},function(e,t,i){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),s=this&&this.__decorate||function(e,t,i,r){var n,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,i,o):n(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o};Object.defineProperty(t,"__esModule",{value:true}),t.Table=t.TableRow=t.TableCell=t.StylableContainer=t.TableColumnDefinition=void 0;var o=i(145),a=i(55),c=i(144),l=i(69),d=i(61),u=i(79),h=i(68),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.width=new d.SizeAndUnit(1,a.SizeUnit.Weight),t}return n(t,e),t.prototype.getSchemaKey=function(){return"ColumnDefinition"},t.horizontalCellContentAlignmentProperty=new l.EnumProperty(l.Versions.v1_5,"horizontalCellContentAlignment",a.HorizontalAlignment),t.verticalCellContentAlignmentProperty=new l.EnumProperty(l.Versions.v1_5,"verticalCellContentAlignment",a.VerticalAlignment),t.widthProperty=new l.CustomProperty(l.Versions.v1_5,"width",(function(e,t,i,r){var n=t.defaultValue,s=i[t.name],o=false;if("number"!=typeof s||isNaN(s))if("string"==typeof s)try{n=d.SizeAndUnit.parse(s)}catch(c){o=true}else o=true;else n=new d.SizeAndUnit(s,a.SizeUnit.Weight);return o&&r.logParseEvent(e,a.ValidationEvent.InvalidPropertyValue,u.Strings.errors.invalidColumnWidth(s)),n}),(function(e,t,i,r,n){r.unit===a.SizeUnit.Pixel?n.serializeValue(i,"width",r.physicalSize+"px"):n.serializeNumber(i,"width",r.physicalSize)}),new d.SizeAndUnit(1,a.SizeUnit.Weight)),s([l.property(t.horizontalCellContentAlignmentProperty)],t.prototype,"horizontalCellContentAlignment",void 0),s([l.property(t.verticalCellContentAlignmentProperty)],t.prototype,"verticalCellContentAlignment",void 0),s([l.property(t.widthProperty)],t.prototype,"width",void 0),t}(l.SerializableObject);t.TableColumnDefinition=f;var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._items=[],t}return n(t,e),t.prototype.parseItem=function(e,t){var i=this;return t.parseCardObject(this,e,[],!this.isDesignMode(),(function(e){return i.createItemInstance(e)}),(function(e,i){t.logParseEvent(void 0,a.ValidationEvent.ElementTypeNotAllowed,u.Strings.errors.elementTypeNotAllowed(e))}))},t.prototype.internalAddItem=function(e){if(e.parent)throw new Error(u.Strings.errors.elementAlreadyParented());this._items.push(e),e.setParent(this)},t.prototype.internalRemoveItem=function(e){var t=this._items.indexOf(e);return t>=0&&(this._items.splice(t,1),e.setParent(void 0),this.updateLayout(),true)},t.prototype.internalParse=function(t,i){e.prototype.internalParse.call(this,t,i),this._items=[];var r=t[this.getCollectionPropertyName()];if(Array.isArray(r))for(var n=0,s=r;n<s.length;n++){var o=s[n],a=this.parseItem(o,i);a&&this._items.push(a)}},t.prototype.internalToJSON=function(t,i){e.prototype.internalToJSON.call(this,t,i),i.serializeArray(t,this.getCollectionPropertyName(),this._items)},t.prototype.removeItem=function(e){return this.internalRemoveItem(e)},t.prototype.getItemCount=function(){return this._items.length},t.prototype.getItemAt=function(e){return this._items[e]},t.prototype.getFirstVisibleRenderedItem=function(){return this.getItemCount()>0?this.getItemAt(0):void 0},t.prototype.getLastVisibleRenderedItem=function(){return this.getItemCount()>0?this.getItemAt(this.getItemCount()-1):void 0},t}(o.StylableCardElementContainer);t.StylableContainer=p;var g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._columnIndex=-1,t._cellType="data",t}return n(t,e),t.prototype.getHasBorder=function(){return this.parentRow.parentTable.showGridLines},t.prototype.applyBorder=function(){if(this.renderedElement&&this.getHasBorder()){var e=this.hostConfig.containerStyles.getStyleByName(this.parentRow.parentTable.gridStyle);if(e.borderColor){var t=h.stringToCssColor(e.borderColor);t&&(this.renderedElement.style.borderRight="1px solid "+t,this.renderedElement.style.borderBottom="1px solid "+t)}}},t.prototype.getDefaultPadding=function(){return this.getHasBackground()||this.getHasBorder()?new d.PaddingDefinition(a.Spacing.Small,a.Spacing.Small,a.Spacing.Small,a.Spacing.Small):e.prototype.getDefaultPadding.call(this)},t.prototype.internalRender=function(){var t=e.prototype.internalRender.call(this);return t&&(t.setAttribute("role","data"===this.cellType?"cell":"columnheader"),t.style.minWidth="0","header"===this.cellType&&t.setAttribute("scope","col")),t},t.prototype.shouldSerialize=function(e){return true},t.prototype.getJsonTypeName=function(){return"TableCell"},t.prototype.getEffectiveTextStyleDefinition=function(){return"header"===this.cellType?this.hostConfig.textStyles.columnHeader:e.prototype.getEffectiveTextStyleDefinition.call(this)},t.prototype.getEffectiveHorizontalAlignment=function(){if(void 0!==this.horizontalAlignment)return this.horizontalAlignment;if(void 0!==this.parentRow.horizontalCellContentAlignment)return this.parentRow.horizontalCellContentAlignment;if(this.columnIndex>=0){var t=this.parentRow.parentTable.getColumnAt(this.columnIndex).horizontalCellContentAlignment;if(void 0!==t)return t}return void 0!==this.parentRow.parentTable.horizontalCellContentAlignment?this.parentRow.parentTable.horizontalCellContentAlignment:e.prototype.getEffectiveHorizontalAlignment.call(this)},t.prototype.getEffectiveVerticalContentAlignment=function(){if(void 0!==this.verticalContentAlignment)return this.verticalContentAlignment;if(void 0!==this.parentRow.verticalCellContentAlignment)return this.parentRow.verticalCellContentAlignment;if(this.columnIndex>=0){var t=this.parentRow.parentTable.getColumnAt(this.columnIndex).verticalCellContentAlignment;if(void 0!==t)return t}return void 0!==this.parentRow.parentTable.verticalCellContentAlignment?this.parentRow.parentTable.verticalCellContentAlignment:e.prototype.getEffectiveVerticalContentAlignment.call(this)},Object.defineProperty(t.prototype,"columnIndex",{get:function(){return this._columnIndex},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"cellType",{get:function(){return this._cellType},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"parentRow",{get:function(){return this.parent},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"isStandalone",{get:function(){return false},enumerable:false,configurable:true}),t}(o.Container);t.TableCell=g;var m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getDefaultPadding=function(){return new d.PaddingDefinition(a.Spacing.None,a.Spacing.None,a.Spacing.None,a.Spacing.None)},t.prototype.applyBackground=function(){if(this.renderedElement){var e=this.hostConfig.containerStyles.getStyleByName(this.style,this.hostConfig.containerStyles.getStyleByName(this.defaultStyle));if(e.backgroundColor){var t=h.stringToCssColor(e.backgroundColor);this.renderedElement.style.backgroundColor=t}}},t.prototype.getCollectionPropertyName=function(){return"cells"},t.prototype.createItemInstance=function(e){return e&&"TableCell"!==e?void 0:new g},t.prototype.internalRender=function(){var e=this.getIsFirstRow(),t=this.hostConfig.table.cellSpacing,i=document.createElement("div");i.setAttribute("role","row"),i.style.display="flex",i.style.flexDirection="row";for(var r=0;r<Math.min(this.getItemCount(),this.parentTable.getColumnCount());r++){var n=this.getItemAt(r);n._columnIndex=r,n._cellType=this.parentTable.firstRowAsHeaders&&e?"header":"data";var s=n.render();if(s){var o=this.parentTable.getColumnAt(r);o.computedWidth.unit===a.SizeUnit.Pixel?s.style.flex="0 0 "+o.computedWidth.physicalSize+"px":s.style.flex="1 1 "+o.computedWidth.physicalSize+"%",r>0&&!this.parentTable.showGridLines&&t>0&&(s.style.marginLeft=t+"px"),i.appendChild(s)}}return i.children.length>0?i:void 0},t.prototype.shouldSerialize=function(e){return true},t.prototype.addCell=function(e){this.internalAddItem(e)},t.prototype.removeCellAt=function(e){return e>=0&&e<this.getItemCount()&&this.removeItem(this.getItemAt(e))},t.prototype.ensureHasEnoughCells=function(e){for(;this.getItemCount()<e;)this.addCell(new g)},t.prototype.getJsonTypeName=function(){return"TableRow"},t.prototype.getIsFirstRow=function(){return this.parentTable.getItemAt(0)===this},Object.defineProperty(t.prototype,"parentTable",{get:function(){return this.parent},enumerable:false,configurable:true}),Object.defineProperty(t.prototype,"isStandalone",{get:function(){return false},enumerable:false,configurable:true}),t.styleProperty=new o.ContainerStyleProperty(l.Versions.v1_5,"style"),t.horizontalCellContentAlignmentProperty=new l.EnumProperty(l.Versions.v1_5,"horizontalCellContentAlignment",a.HorizontalAlignment),t.verticalCellContentAlignmentProperty=new l.EnumProperty(l.Versions.v1_5,"verticalCellContentAlignment",a.VerticalAlignment),s([l.property(t.horizontalCellContentAlignmentProperty)],t.prototype,"horizontalCellContentAlignment",void 0),s([l.property(t.verticalCellContentAlignmentProperty)],t.prototype,"verticalCellContentAlignment",void 0),t}(p);t.TableRow=m;var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._columns=[],t.firstRowAsHeaders=true,t.showGridLines=true,t}return n(t,e),Object.defineProperty(t.prototype,"gridStyle",{get:function(){var e=this.getValue(t.gridStyleProperty);if(e&&this.hostConfig.containerStyles.getStyleByName(e))return e},set:function(e){this.setValue(t.gridStyleProperty,e)},enumerable:false,configurable:true}),t.prototype.ensureRowsHaveEnoughCells=function(){for(var e=0;e<this.getItemCount();e++)this.getItemAt(e).ensureHasEnoughCells(this.getColumnCount())},t.prototype.removeCellsFromColumn=function(e){for(var t=0;t<this.getItemCount();t++)this.getItemAt(t).removeCellAt(e)},t.prototype.getCollectionPropertyName=function(){return"rows"},t.prototype.createItemInstance=function(e){return e&&"TableRow"!==e?void 0:new m},t.prototype.internalParse=function(t,i){e.prototype.internalParse.call(this,t,i),this.ensureRowsHaveEnoughCells()},t.prototype.internalRender=function(){if(this.getItemCount()>0){for(var e=0,t=0,i=this._columns;t<i.length;t++){(s=i[t]).width.unit===a.SizeUnit.Weight&&(e+=s.width.physicalSize)}for(var r=0,n=this._columns;r<n.length;r++){var s;(s=n[r]).width.unit===a.SizeUnit.Pixel?s.computedWidth=new d.SizeAndUnit(s.width.physicalSize,a.SizeUnit.Pixel):s.computedWidth=new d.SizeAndUnit(100/e*s.width.physicalSize,a.SizeUnit.Weight)}var o=document.createElement("div");if(o.setAttribute("role","table"),o.style.display="flex",o.style.flexDirection="column",this.showGridLines){var c=this.hostConfig.containerStyles.getStyleByName(this.gridStyle);if(c.borderColor){var l=h.stringToCssColor(c.borderColor);l&&(o.style.borderTop="1px solid "+l,o.style.borderLeft="1px solid "+l)}}for(var u=this.hostConfig.table.cellSpacing,f=0;f<this.getItemCount();f++){var p=this.getItemAt(f).render();if(p){if(f>0&&!this.showGridLines&&u>0){var g=document.createElement("div");g.setAttribute("aria-hidden","true"),g.style.height=u+"px",o.appendChild(g)}o.appendChild(p)}}return o}},t.prototype.addColumn=function(e){this._columns.push(e),this.ensureRowsHaveEnoughCells()},t.prototype.removeColumn=function(e){var t=this._columns.indexOf(e);t>=0&&(this.removeCellsFromColumn(t),this._columns.splice(t,1))},t.prototype.getColumnCount=function(){return this._columns.length},t.prototype.getColumnAt=function(e){return this._columns[e]},t.prototype.addRow=function(e){this.internalAddItem(e),e.ensureHasEnoughCells(this.getColumnCount())},t.prototype.getJsonTypeName=function(){return"Table"},t.columnsProperty=new l.SerializableObjectCollectionProperty(l.Versions.v1_5,"columns",f),t.firstRowAsHeadersProperty=new l.BoolProperty(l.Versions.v1_5,"firstRowAsHeaders",true),t.showGridLinesProperty=new l.BoolProperty(l.Versions.v1_5,"showGridLines",true),t.gridStyleProperty=new o.ContainerStyleProperty(l.Versions.v1_5,"gridStyle"),t.horizontalCellContentAlignmentProperty=new l.EnumProperty(l.Versions.v1_5,"horizontalCellContentAlignment",a.HorizontalAlignment),t.verticalCellContentAlignmentProperty=new l.EnumProperty(l.Versions.v1_5,"verticalCellContentAlignment",a.VerticalAlignment),s([l.property(t.columnsProperty)],t.prototype,"_columns",void 0),s([l.property(t.firstRowAsHeadersProperty)],t.prototype,"firstRowAsHeaders",void 0),s([l.property(t.showGridLinesProperty)],t.prototype,"showGridLines",void 0),s([l.property(t.gridStyleProperty)],t.prototype,"gridStyle",null),s([l.property(t.horizontalCellContentAlignmentProperty)],t.prototype,"horizontalCellContentAlignment",void 0),s([l.property(t.verticalCellContentAlignmentProperty)],t.prototype,"verticalCellContentAlignment",void 0),t}(p);t.Table=v,c.GlobalRegistry.defaultElements.register("Table",v,l.Versions.v1_5)},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.ChannelAdapter=void 0;var r=function(){};t.ChannelAdapter=r},function(e,t,i){var r=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,s){function o(e){try{c(r.next(e))}catch(t){s(t)}}function a(e){try{c(r.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var i,r,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&s[0]?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:false};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=o.trys,(n=n.length>0&&n[n.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(a){s=[6,a],r=0}finally{i=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:true}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:true}),t.AdaptiveApplet=void 0;var s=i(55),o=i(68),a=i(61),c=i(168),l=i(79),d=i(145),u=i(69);function h(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(a.GlobalSettings.applets.logEnabled)if(a.GlobalSettings.applets.onLogEvent)a.GlobalSettings.applets.onLogEvent(e,t,i);else switch(e){case s.LogLevel.Warning:console.warn(t,i);break;case s.LogLevel.Error:console.error(t,i);break;default:console.log(t,i)}}var f=function(){function e(e,t,i){this.action=e,this.trigger=t,this.consecutiveRefreshes=i,this.attemptNumber=0}return e.prototype.retryAsync=function(){return r(this,void 0,void 0,(function(){return n(this,(function(e){return this.onSend&&this.onSend(this),[2]}))}))},e}(),p=function(){function e(){this._allowAutomaticCardUpdate=false,this.renderedElement=document.createElement("div"),this.renderedElement.className="aaf-cardHost",this.renderedElement.style.position="relative",this.renderedElement.style.display="flex",this.renderedElement.style.flexDirection="column",this._cardHostElement=document.createElement("div"),this._refreshButtonHostElement=document.createElement("div"),this._refreshButtonHostElement.className="aaf-refreshButtonHost",this._refreshButtonHostElement.style.display="none",this.renderedElement.appendChild(this._cardHostElement),this.renderedElement.appendChild(this._refreshButtonHostElement)}return e.prototype.displayCard=function(e){if(!e.renderedElement)throw new Error("displayCard: undefined card.");o.clearElementChildren(this._cardHostElement),this._refreshButtonHostElement.style.display="none",this._cardHostElement.appendChild(e.renderedElement)},e.prototype.showManualRefreshButton=function(e){var t=this;if(!this.onShowManualRefreshButton||this.onShowManualRefreshButton(this)){this._refreshButtonHostElement.style.display="none";var i=void 0;if(this.onRenderManualRefreshButton)i=this.onRenderManualRefreshButton(this);else{var r=l.Strings.runtime.refreshThisCard();if(a.GlobalSettings.applets.refresh.mode===s.RefreshMode.Automatic){var n=l.Strings.runtime.automaticRefreshPaused();" "!==n[n.length-1]&&(n+=" "),r=l.Strings.runtime.clckToRestartAutomaticRefresh()}var h={type:"AdaptiveCard",version:"1.2",body:[{type:"RichTextBlock",horizontalAlignment:"right",inlines:[{type:"TextRun",text:r,selectAction:{type:"Action.Submit",id:"refreshCard"}}]}]},f=new d.AdaptiveCard;f.parse(h,new d.SerializationContext(u.Versions.v1_2)),f.onExecuteAction=function(i){"refreshCard"===i.id&&(o.clearElementChildren(t._refreshButtonHostElement),t.internalExecuteAction(e,c.ActivityRequestTrigger.Automatic,0))},i=f.render()}i&&(o.clearElementChildren(this._refreshButtonHostElement),this._refreshButtonHostElement.appendChild(i),this._refreshButtonHostElement.style.removeProperty("display"))}},e.prototype.createActivityRequest=function(e,t,i){var r=this;if(this.card){var n=new f(e,t,i);return n.onSend=function(e){e.attemptNumber++,r.internalSendActivityRequestAsync(n)},!!this.onPrepareActivityRequest&&!this.onPrepareActivityRequest(this,n,e)?void 0:n}throw new Error("createActivityRequest: no card has been set.")},e.prototype.createMagicCodeInputCard=function(t){var i={type:"AdaptiveCard",version:"1.0",body:[{type:"TextBlock",color:"attention",text:1===t?void 0:"That didn't work... let's try again.",wrap:true,horizontalAlignment:"center"},{type:"TextBlock",text:'Please login in the popup. You will obtain a magic code. Paste that code below and select "Submit"',wrap:true,horizontalAlignment:"center"},{type:"Input.Text",id:"magicCode",placeholder:"Enter magic code"},{type:"ActionSet",horizontalAlignment:"center",actions:[{type:"Action.Submit",id:e.submitMagicCodeActionId,title:"Submit"},{type:"Action.Submit",id:e.cancelMagicCodeAuthActionId,title:"Cancel"}]}]},r=new d.AdaptiveCard;return r.parse(i),r},e.prototype.cancelAutomaticRefresh=function(){this._allowAutomaticCardUpdate&&h(s.LogLevel.Warning,"Automatic card refresh has been cancelled as a result of the user interacting with the card."),this._allowAutomaticCardUpdate=false},e.prototype.createSerializationContext=function(){return this.onCreateSerializationContext?this.onCreateSerializationContext(this):new d.SerializationContext},e.prototype.internalSetCard=function(e,t){var i=this;if("object"==typeof e&&"AdaptiveCard"===e.type&&(this._cardPayload=e),this._cardPayload)try{var r=new d.AdaptiveCard;this.hostConfig&&(r.hostConfig=this.hostConfig);var n=this.createSerializationContext();if(r.parse(this._cardPayload,n),(!this.onCardChanging||this.onCardChanging(this,this._cardPayload))&&(this._card=r,this._card.authentication&&this._card.authentication.tokenExchangeResource&&this.onPrefetchSSOToken&&this.onPrefetchSSOToken(this,this._card.authentication.tokenExchangeResource),this._card.onExecuteAction=function(e){i.cancelAutomaticRefresh(),i.internalExecuteAction(e,c.ActivityRequestTrigger.Manual,0)},this._card.onInputValueChanged=function(e){i.cancelAutomaticRefresh()},this._card.render(),this._card.renderedElement&&(this.displayCard(this._card),this.onCardChanged&&this.onCardChanged(this),this._card.refresh)))if(a.GlobalSettings.applets.refresh.mode===s.RefreshMode.Automatic&&t<a.GlobalSettings.applets.refresh.maximumConsecutiveAutomaticRefreshes)if(a.GlobalSettings.applets.refresh.timeBetweenAutomaticRefreshes<=0)h(s.LogLevel.Info,"Triggering automatic card refresh number "+(t+1)),this.internalExecuteAction(this._card.refresh.action,c.ActivityRequestTrigger.Automatic,t+1);else{h(s.LogLevel.Info,"Scheduling automatic card refresh number "+(t+1)+" in "+a.GlobalSettings.applets.refresh.timeBetweenAutomaticRefreshes+"ms");var o=this._card.refresh.action;this._allowAutomaticCardUpdate=true,window.setTimeout((function(){i._allowAutomaticCardUpdate&&i.internalExecuteAction(o,c.ActivityRequestTrigger.Automatic,t+1)}),a.GlobalSettings.applets.refresh.timeBetweenAutomaticRefreshes)}else a.GlobalSettings.applets.refresh.mode!==s.RefreshMode.Disabled&&(h(s.LogLevel.Warning,t>0?"Stopping automatic refreshes after "+t+" consecutive refreshes.":"The card has a refresh section, but automatic refreshes are disabled."),(a.GlobalSettings.applets.refresh.allowManualRefreshesAfterAutomaticRefreshes||a.GlobalSettings.applets.refresh.mode===s.RefreshMode.Manual)&&(h(s.LogLevel.Info,"Showing manual refresh button."),this.showManualRefreshButton(this._card.refresh.action)))}catch(l){h(s.LogLevel.Error,"setCard: "+l)}},e.prototype.internalExecuteAction=function(e,t,i){if(e instanceof d.ExecuteAction){if(!this.channelAdapter)throw new Error("internalExecuteAction: No channel adapter set.");var r=this.createActivityRequest(e,t,i);r&&r.retryAsync()}this.onAction&&this.onAction(this,e)},e.prototype.createProgressOverlay=function(e){if(!this._progressOverlay)if(this.onCreateProgressOverlay)this._progressOverlay=this.onCreateProgressOverlay(this,e);else{this._progressOverlay=document.createElement("div"),this._progressOverlay.className="aaf-progress-overlay";var t=document.createElement("div");t.className="aaf-spinner",t.style.width="28px",t.style.height="28px",this._progressOverlay.appendChild(t)}return this._progressOverlay},e.prototype.removeProgressOverlay=function(e){this.onRemoveProgressOverlay&&this.onRemoveProgressOverlay(this,e),void 0!==this._progressOverlay&&(this.renderedElement.removeChild(this._progressOverlay),this._progressOverlay=void 0)},e.prototype.activityRequestSucceeded=function(e,t){this.onActivityRequestSucceeded&&this.onActivityRequestSucceeded(this,e,t)},e.prototype.activityRequestFailed=function(e){return this.onActivityRequestFailed?this.onActivityRequestFailed(this,e):a.GlobalSettings.applets.defaultTimeBetweenRetryAttempts},e.prototype.showAuthCodeInputDialog=function(t){var i=this;if(!this.onShowAuthCodeInputDialog||this.onShowAuthCodeInputDialog(this,t)){var r=this.createMagicCodeInputCard(t.attemptNumber);r.render(),r.onExecuteAction=function(r){if(i.card&&r instanceof d.SubmitAction)switch(r.id){case e.submitMagicCodeActionId:var n=void 0;r.data&&"string"==typeof r.data.magicCode&&(n=r.data.magicCode),n?(i.displayCard(i.card),t.authCode=n,t.retryAsync()):alert("Please enter the magic code you received.");break;case e.cancelMagicCodeAuthActionId:h(s.LogLevel.Warning,"Authentication cancelled by user."),i.displayCard(i.card);break;default:h(s.LogLevel.Error,"Unespected action taken from magic code input card (id = "+r.id+")"),alert(l.Strings.magicCodeInputCard.somethingWentWrong())}},this.displayCard(r)}},e.prototype.internalSendActivityRequestAsync=function(e){return r(this,void 0,void 0,(function(){var t,i,r,o;return n(this,(function(d){switch(d.label){case 0:if(!this.channelAdapter)throw new Error("internalSendActivityRequestAsync: channelAdapter is not set.");void 0!==(t=this.createProgressOverlay(e))&&this.renderedElement.appendChild(t),i=false,r=function(){var t,r,d,u,f,p,g;return n(this,(function(n){switch(n.label){case 0:t=void 0,1===e.attemptNumber?h(s.LogLevel.Info,"Sending activity request to channel (attempt "+e.attemptNumber+")"):h(s.LogLevel.Info,"Re-sending activity request to channel (attempt "+e.attemptNumber+")"),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,o.channelAdapter.sendRequestAsync(e)];case 2:return t=n.sent(),[3,4];case 3:return r=n.sent(),h(s.LogLevel.Error,"Activity request failed: "+r),o.removeProgressOverlay(e),i=true,[3,4];case 4:if(!t)return[3,10];if(!(t instanceof c.SuccessResponse))return[3,5];if(o.removeProgressOverlay(e),void 0===t.rawContent)throw new Error("internalSendActivityRequestAsync: Action.Execute result is undefined");d=t.rawContent;try{d=JSON.parse(t.rawContent)}catch(m){}if("string"==typeof d)h(s.LogLevel.Info,"The activity request returned a string after "+e.attemptNumber+" attempt(s)."),o.activityRequestSucceeded(t,d);else{if("object"!=typeof d||"AdaptiveCard"!==d.type)throw new Error("internalSendActivityRequestAsync: Action.Execute result is of unsupported type ("+typeof t.rawContent+")");h(s.LogLevel.Info,"The activity request returned an Adaptive Card after "+e.attemptNumber+" attempt(s)."),o.internalSetCard(d,e.consecutiveRefreshes),o.activityRequestSucceeded(t,o.card)}return i=true,[3,10];case 5:return t instanceof c.ErrorResponse?(u=o.activityRequestFailed(t))>=0&&e.attemptNumber<a.GlobalSettings.applets.maximumRetryAttempts?(h(s.LogLevel.Warning,"Activity request failed: "+t.error.message+". Retrying in "+u+"ms"),e.attemptNumber++,[4,new Promise((function(e,t){window.setTimeout((function(){e()}),u)}))]):[3,7]:[3,9];case 6:return n.sent(),[3,8];case 7:h(s.LogLevel.Error,"Activity request failed: "+t.error.message+". Giving up after "+e.attemptNumber+" attempt(s)"),o.removeProgressOverlay(e),i=true,n.label=8;case 8:return[3,10];case 9:if(t instanceof c.LoginRequestResponse){if(h(s.LogLevel.Info,"The activity request returned a LoginRequestResponse after "+e.attemptNumber+" attempt(s)."),e.attemptNumber<=a.GlobalSettings.applets.maximumRetryAttempts){if(f=true,t.tokenExchangeResource&&o.onSSOTokenNeeded&&(f=!o.onSSOTokenNeeded(o,e,t.tokenExchangeResource)),f){if(o.removeProgressOverlay(e),void 0===t.signinButton)throw new Error("internalSendActivityRequestAsync: the login request doesn't contain a valid signin URL.");h(s.LogLevel.Info,"Login required at "+t.signinButton.value),o.onShowSigninPrompt?o.onShowSigninPrompt(o,e,t.signinButton):(o.showAuthCodeInputDialog(e),p=window.screenX+(window.outerWidth-a.GlobalSettings.applets.authPromptWidth)/2,g=window.screenY+(window.outerHeight-a.GlobalSettings.applets.authPromptHeight)/2,window.open(t.signinButton.value,t.signinButton.title?t.signinButton.title:"Sign in","width="+a.GlobalSettings.applets.authPromptWidth+",height="+a.GlobalSettings.applets.authPromptHeight+",left="+p+",top="+g))}}else h(s.LogLevel.Error,"Authentication failed. Giving up after "+e.attemptNumber+" attempt(s)"),alert(l.Strings.magicCodeInputCard.authenticationFailed());return[2,"break"]}throw new Error("Unhandled response type: "+t.toString());case 10:return[2]}}))},o=this,d.label=1;case 1:return i?[3,3]:[5,r()];case 2:return"break"===d.sent()?[3,3]:[3,1];case 3:return[2]}}))}))},e.prototype.refreshCard=function(){this._card&&this._card.refresh&&this.internalExecuteAction(this._card.refresh.action,c.ActivityRequestTrigger.Manual,0)},e.prototype.setCard=function(e){this.internalSetCard(e,0)},Object.defineProperty(e.prototype,"card",{get:function(){return this._card},enumerable:false,configurable:true}),e.submitMagicCodeActionId="submitMagicCode",e.cancelMagicCodeAuthActionId="cancelMagicCodeAuth",e}();t.AdaptiveApplet=p},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7),n=i(95),s=i(96),o=i(6),a=i(4),c=i(9);class l{constructor(){this.timeout=null,this.user=null,this.service=null}static create(e,t,i,r){const n=new l;return n.id=e,n.user=i,n.service=r,n.update(t),n}update(e){this.text=e,clearTimeout(this.timeout),this.timeout=setTimeout((()=>{const e=this.service.speechRecognitionMessages.value,t=e.findIndex((e=>e.id===this.id));e.splice(t,1),this.service.speechRecognitionMessages.next(e)}),5e3)}}t.SpeechRecognitionMessage=l;class d{constructor(e,t,i,r){this.name=e,this.lang=t,this.url=i,this.bufferSize=r,this._selected=false}static create(e,t,i,r=4096){return new d(e,t,i,r)}}t.SpeechRecognitionModelInfo=d;class u{constructor(e,t){this.name=e,this.modelsInfo=t}static create(e,t){return new u(e,t)}}t.SpeechRecognitionModel=u;class h{constructor(){this.messages=[]}reset(){this.messages=[]}static create(){return new h}addMessage(e,t){this.messages.push({timestamp:new Date,user:e,text:t})}}t.SpeechRecognitionTranscription=h;class f{constructor(){this.stream=null,this.websocket=null,this.audioContext=null,this.logger=a.LoggerService.getInstance(),this.xmppService=c.XmppService.getInstance(),this.contactService=o.ContactService.getInstance(),this.webConferenceService=s.WebConferenceServiceV2.getInstance(),this.roomJid=null,this.models=[],this.currentModel=null,this.xmppHandler=null,this.subscription=null,this.type=null,this.transcriptionOn=false,this.started=false,this.speechRecognitionMessages=new r.BehaviorSubject([]),this.transcription=new r.BehaviorSubject(h.create()),this.xmppService.connected&&this.subscribeToASRMessages(),this.xmppService.subscribeToConnectionEvents((e=>{"ON_XMPP_CONNECTED"===e.name&&this.subscribeToASRMessages(),"ON_XMPP_DISCONNECTED"===e.name&&e.data.reason}))}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.SpeechRecognitionService||(e.rainbow.SpeechRecognitionService=new f),e.rainbow.SpeechRecognitionService}async init(e,t,i,r){try{const n=r?r.bufferSize:4096;this.logger.info(`[SpeechRecognitionService] init ${e} -- ${i} -- bufferSize : ${n}`),this.type=e,this.roomJid=i,await this.getModels(),await this.createWebSocket(),this.stream=t,this.audioContext=new AudioContext({sampleRate:16e3});const s=this.audioContext.createMediaStreamSource(t),o=this.audioContext.createScriptProcessor(n,1,1);o.onaudioprocess=e=>{this.recorderProcess(e)},s.connect(o),o.connect(this.audioContext.destination),"room"===e&&(this.subscription=this.webConferenceService.subscribe((e=>{if(e.name===this.webConferenceService.RAINBOW_ONWEBCONFERENCESTATUSUPDATED){const t=this.webConferenceService.getWebConferenceSessionById(e.data.roomDbId);t&&t.subtitlesEnable&&"ended"===e.data.status&&this.stop()}}))),this.started=true}catch(n){throw this.logger.error("[SpeechRecognitionService] init -- FAILURE -- "+n.message),new Error(n.message)}}stop(){this.started&&(this.logger.info("[SpeechRecognitionService] stop"),this.audioContext.close(),this.websocket.send('{"eof": 1}'),this.started=false),this.subscription&&this.subscription.unsubscribe()}startTranscription(){this.transcriptionOn=true,this.transcription.value.reset()}stopTranscription(){return this.transcriptionOn=false,this.transcription.value}async getModels(){return 0===this.models.length&&await this.getModelsFromServer(),this.models}getCurrentModel(){return this.currentModel}async getModelsFromServer(){const e=[d.create("Model Vosk","french","wss://demo.openrainbow.org:666/asr-ws/fr-vosk",8192),d.create("Model Linto","french","wss://demo.openrainbow.org:666/asr-ws/fr"),d.create("Model ALE","french","wss://demo.openrainbow.org:666/asr-ws/fr-ale")],t=[d.create("Model Danzu old","english","wss://demo.openrainbow.org:666/asr-ws/en-nn"),d.create("Model Linto","english","wss://demo.openrainbow.org:666/asr-ws/en"),d.create("Model Vosk 21","english","wss://demo.openrainbow.org:666/asr-ws/en-vosk-21",8192),d.create("Model Vosk 22","english","wss://demo.openrainbow.org:666/asr-ws/en-vosk-22",8192),d.create("Model Vosk Aspire","english","wss://demo.openrainbow.org:666/asr-ws/en-vosk-aspire",8192)],i=[d.create("Model Vosk","german","wss://demo.openrainbow.org:666/asr-ws/de-vosk",8192)],r=[d.create("Model Vosk","russian","wss://demo.openrainbow.org:666/asr-ws/ru-vosk",8192)];this.models.push(u.create("subtitleFrench",e)),this.models.push(u.create("subtitleEnglish",t)),this.models.push(u.create("subtitleGerman",i)),this.models.push(u.create("subtitleRussian",r)),this.currentModel=this.models[0].modelsInfo[1],this.currentModel._selected=true,this.logger.info(`[SpeechRecognitionService] getModelsFromServer -- SUCCESS -- current model : ${this.currentModel.lang} - ${this.currentModel.name} - ${this.currentModel.url}`)}async setModel(e){this.logger.info(`[SpeechRecognitionService] setModel ${e.lang} - ${e.name} - ${e.url}`),this.currentModel=e,this.started&&(this.stop(),await this.init(this.type,this.stream,this.roomJid,e))}createWebSocket(){return new Promise(((e,t)=>{this.logger.info(`[SpeechRecognitionService] createWebSocket -- ${this.currentModel.lang} -- ${this.currentModel.name} -- ${this.currentModel.url}`),this.websocket=new WebSocket(this.currentModel.url),this.websocket.onopen=()=>{this.logger.info(`[SpeechRecognitionService] createWebSocket -- ${this.currentModel.lang} -- ${this.currentModel.name} -- ${this.currentModel.url} -- SUCCESS`),this.websocket.send('{"config": {"sample_rate":16000 }}'),e()},this.websocket.onerror=()=>{this.websocket.close(),t(new Error("websocket error"))},this.websocket.onclose=()=>{this.logger.info("[SpeechRecognitionService] webSocket is closed")},this.websocket.onmessage=async e=>{const t=JSON.parse(e.data);if(t.partial||t.text){const e=t.text?t.text:t.partial,i=!t.text;if(e.charAt(0).toUpperCase(),this.roomJid){const t=n.Conversation.getUniqueMessageId(),r=$msg({id:t,from:this.xmppService.jid,to:this.roomJid,type:"groupchat"});r.c("asr",{xmlns:"http://jabber.org/asr",text:e,partial:i,userId:this.contactService.userContact.dbId}),await this.xmppService.send(r)}}else t.eod&&this.websocket.close()}}))}recorderProcess(e){const t=e.inputBuffer.getChannelData(0);this.websocket.send(this.convertFloat32ToInt16(t))}convertFloat32ToInt16(e){let t=e.length;const i=new Int16Array(t);for(;t--;)i[t]=32767*Math.min(1,e[t]);return i.buffer}onSpeechMessage(e){try{const t=$(e).find("asr");if(t.length>0){const e=this.speechRecognitionMessages.value,i=t.attr("userId"),r=t.attr("text"),n="true"===t.attr("partial"),s=e.findIndex((e=>e.id===i));let o=null;-1!==s?(e[s].text=r,o=e[s].user):(o=this.contactService.getContactById(i),e.push(l.create(i,r,o,this))),this.speechRecognitionMessages.next(e),this.transcriptionOn&&!n&&(this.transcription.value.addMessage(o,r),this.transcription.next(this.transcription.value))}return true}catch(t){return this.logger.error("[speechRecognitionService] onSpeechMessage error "+t),true}}subscribeToASRMessages(){this.logger.info("[SpeechRecognitionService] - subscribeToASRMessages"),this.xmppHandler&&(this.xmppService.connection.deleteHandler(this.xmppHandler),this.xmppHandler=null),this.xmppHandler=this.xmppService.connection.addHandler((e=>this.onSpeechMessage(e)),"http://jabber.org/asr","message")}}t.SpeechRecognitionService=f},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{constructor(e,t){this.hasLocalSharing=false,this.talkingTimeStats={},this.talker=null,this.isMyConference=false,this.dynamicFeedSession=null,this.lastTalker=null,this.record={isRecording:false,recordingIsPaused:false},this.recordingStarted=false,this.recordingUserId="",this.currentRecordingState="",this.noAudio=false,this.gridServiceSubscription=null,this.type="v2",this.haveJoined=false,this.isInExternalWindow=false,this.isOnlySharingWindow=false,this.autoPopoutSharingWindow=false,this.control={activeControl:false,hasRemoteControlling:false,controller:null,controlled:null},this.conferenceLayoutSize={},this.subtitlesEnable=false,this.dimLocalSharingScreen=true,this.originalVideoStream=null,this.networkQuality=0,this.services=[],this.subscribedToGridService=false,this.dynamicFeedSubscriptionInProgress=false,this.id=e,this.room=t,this.duration=0,this.participants=[],this.conferenceView="grid_view",this.haveJoined=false,this.isMyConference=false,this.pinnedParticipant=null,this.locked=false,this.localStreams=[]}static create(e,t){return new r(e,t)}getParticipants(){return this.participants}getLocalParticipant(){return this.localParticipant}getRoom(){return this.room}getAudioSession(){return this.audioSession}getSharingParticipant(){return this.sharingParticipant}getRemoteSharingParticipant(){return this.sharingParticipant&&!this.hasLocalSharing?this.sharingParticipant:null}getLocalSharingSession(){return this.localSharingSession}getSharingSession(){return this.localSharingSession?this.localSharingSession:this.getRemoteSharingSession()}getRemoteSharingSession(){return this.sharingParticipant&&!this.hasLocalSharing?this.sharingParticipant.videoSession:null}getParticipantById(e){if(this.localParticipant.id===e)return this.localParticipant;return this.participants.find((t=>t.id===e))}findParticipantByContactDbId(e){if(this.localParticipant&&this.localParticipant.contact.dbId===e)return this.localParticipant;return this.participants.find((t=>t.contact&&t.contact.dbId===e))}isLocked(){return this.locked}getParticipantsListWithDelegateCapability(){return this.participants.filter((e=>e.delegateCapability))}addOrUpdateService(e,t){this.services||(this.services=[]);-1!==this.services.findIndex((t=>t.id===e))||this.services.push({id:e,name:t})}addOrUpdateParticipant(e){if(this.localParticipant&&this.localParticipant.id===e.id)return this.localParticipant.mute=e.mute,void(this.localParticipant.noMicrophone=e.noMicrophone);const t=this.participants.findIndex((t=>t.id===e.id));if(-1!==t){const i=this.participants[t];i.mute=e.mute,i.noMicrophone=e.noMicrophone}else this.participants.push(e)}updateTalkingTimeForParticipant(e,t){this.talkingTimeStats[e]||(this.talkingTimeStats[e]={talkingTime:t}),this.talkingTimeStats[e].talkingTime=t}startDuration(){this.durationTimer||(this.durationTimer=setInterval((()=>{this.duration++}),1e3))}stopDuration(){this.durationTimer&&(clearInterval(this.durationTimer),this.durationTimer=null,this.duration=0)}getPinnedParticipant(){if(this.pinnedParticipant){this.getParticipantByIdAndMediaType(this.pinnedParticipant.id,this.pinnedParticipant.mediaType)||(this.pinnedParticipant=null)}return this.pinnedParticipant}updatePinnedParticipant(e=null,t=""){this.pinnedParticipant=e?{id:e.id,mediaType:t}:null}setLocked(e=false){this.locked=e}setSharingParticipant(e=null){!e&&this.sharingParticipant.videoSession&&(this.sharingParticipant.videoSession.terminate(),this.sharingParticipant.videoSession=null),this.sharingParticipant=e}getParticipantByIdAndMediaType(e,t){if("sharing"===t){if(this.localParticipant.id===e)return this.hasLocalSharing?this.localParticipant:null;if(this.sharingParticipant&&this.sharingParticipant.id===e)return this.sharingParticipant}else{if(this.localParticipant.id===e)return this.localParticipant.videoSession?this.localParticipant:null;const t=this.participants.find((t=>t.id===e));if(t&&t.videoSession)return t}return null}}t.WebConferenceSession=r},function(e,t,i){var r,n,s=i(170),o=i(171),a=0,c=0;e.exports=function(e,t,i){var l=t&&i||0,d=t||[],u=(e=e||{}).node||r,h=void 0!==e.clockseq?e.clockseq:n;if(null==u||null==h){var f=s();null==u&&(u=r=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==h&&(h=n=16383&(f[6]<<8|f[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),g=void 0!==e.nsecs?e.nsecs:c+1,m=p-a+(g-c)/1e4;if(m<0&&void 0===e.clockseq&&(h=h+1&16383),(m<0||p>a)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=p,c=g,n=h;var v=(1e4*(268435455&(p+=122192928e5))+g)%4294967296;d[l++]=v>>>24&255,d[l++]=v>>>16&255,d[l++]=v>>>8&255,d[l++]=255&v;var S=p/4294967296*1e4&268435455;d[l++]=S>>>8&255,d[l++]=255&S,d[l++]=S>>>24&15|16,d[l++]=S>>>16&255,d[l++]=h>>>8|128,d[l++]=255&h;for(var b=0;b<6;++b)d[l+b]=u[b];return t||o(d)}},function(e,t,i){var r=i(170),n=i(171);e.exports=function(e,t,i){var s=t&&i||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||r)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var a=0;a<16;++a)t[s+a]=o[a];return t||n(o)}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{constructor(e){this.currentPstnState="",this.isPinned=false,this.id=e,this.subscriptionInProgress=false,this.mute=false,this.noMicrophone=false,this.isVideoAvailable=false,this.delegateCapability=false}static create(e){return new r(e)}}t.WebConferenceParticipant=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(11),n=i(4),s=i(8),o=i(13),a=i(9);t.WebConferenceHelper=class{constructor(e){this.webConferenceService=e,this.eventService=r.EventService.getInstance(),this.authService=s.AuthService.getInstance(),this.logger=n.LoggerService.getInstance(),this.errorHelperService=o.ErrorHelperService.getInstance(),this.xmppService=a.XmppService.getInstance(),this.configuration={dynamicFeed:true,limitVideoSubscriptions:0,disableAutoSubscriptions:false}}start(){this.attachHandlers()}stop(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=null)}setConfiguration(e=false,t=false,i=0){this.logger.info(`[webConferenceHelper] setConfiguration new configuration disableDynamicFeed -- ${e}, disableAutoSubscriptions -- ${t}`),this.configuration.dynamicFeed=!e,this.configuration.limitVideoSubscriptions=i,this.configuration.disableAutoSubscriptions=t}async updateSubstreamLevelForParticipantBasedOnVideoSize(e,t,i){try{const r=this.webConferenceService.getWebConferenceSessionById(e);if(!r||!t||!i)throw new Error("[WebConferenceHelper] updateSubstreamLevelForParticipantBasedOnVideoSize -- missing parameters");let n=1;if(i>=854&&(n=2),i<=320&&(n=0),n!==t.subStreamLevel){t.subStreamLevel=n,this.logger.info(`[webConferenceHelper] updateSubstreamLevelForParticipantBasedOnVideoSize -- ${e} -- ${t.id} -- ${n}`);const i={option:"update",subStreamLevel:n,publisherId:t.id},s=JSON.stringify(i),o=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${r.id}/users/${r.localParticipant.id}`,a=this.authService.getPostHeader(),c=await fetch(o,{method:"PUT",headers:a,body:s});if(!c.ok)throw c}}catch(r){const e=await this.errorHelperService.getErrorInfo(r,"updateSubstreamLevelForParticipantBasedOnVideoSize");throw this.logger.error(e.message),e.error}}async updateParticipantBasedOnPacketLostQualityLimitation(e,t,i,r){try{if(!e||!t)throw new Error("[WebConferenceHelper] updateParticipantBasedOnPacketLostQualityLimitation -- missing parameters");let n=t.subStreamLevel,s=t.temporalLevel;if(i?(r.qualityLimitation=true,2===t.subStreamLevel||1===t.subStreamLevel&&0===t.temporalLevel?(n=t.subStreamLevel-1,s=2):(0===t.subStreamLevel||1===t.subStreamLevel&&2===t.temporalLevel)&&(s=0)):0===t.subStreamLevel&&0===t.temporalLevel?s=2:0===t.subStreamLevel&&2===t.temporalLevel?(n=1,s=2):1===t.subStreamLevel&&0===t.temporalLevel?(s=2,r.qualityLimitation=false):r.qualityLimitation=false,n!==t.subStreamLevel||s!==t.temporalLevel){this.logger.info(`[webConferenceHelper] updateParticipantBasedOnPacketLostQualityLimitation -- ${e.id} -- ${t.id} -- ${n} -- ${s}`);const i={option:"update",subStreamLevel:n,publisherId:t.id,temporalLevel:s},r=JSON.stringify(i),o=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.id}/users/${e.localParticipant.id}`,a=this.authService.getPostHeader(),c=await fetch(o,{method:"PUT",headers:a,body:r});if(!c.ok)throw c;t.subStreamLevel=n,t.temporalLevel=s}}catch(n){const e=await this.errorHelperService.getErrorInfo(n,"updateParticipantBasedOnPacketLostQualityLimitation");throw this.logger.error(e.message),e.error}}attachHandlers(){this.subscription=this.webConferenceService.subscribe((e=>{try{e.name===this.webConferenceService.RAINBOW_ONWEBCONFERENCELOCKSTATEUPDATED?this.eventService.publish("ON_CONFERENCE_LOCKED_EVENT",e.data.isLock,e.data.lockedBy):e.name===this.webConferenceService.RAINBOW_ONWEBCONFERENCEPUBLISHERSADDED?this.subscribeToNewPublishers(e.data.roomDbId):e.name===this.webConferenceService.RAINBOW_ONWEBCONFERENCESERVICEUPDATE&&this.subscribeToNewServices(e.data.roomDbId)}catch(t){}}))}subscribeToNewPublishers(e){const t=this.webConferenceService.getWebConferenceSessionById(e),i=[];if(t&&t.participants.length){if(!this.configuration.dynamicFeed||t.dynamicFeedSession||t.dynamicFeedSubscriptionInProgress||this.webConferenceService.subscribeToDynamicFeed(t),this.configuration.disableAutoSubscriptions)return;t.participants.forEach((e=>{!e.isVideoAvailable||e.subscriptionInProgress||e.videoSession||i.push(e)}))}i.length&&this.subscribeToPublishersByParts(t,i)}async subscribeToPublishersByParts(e,t,i=12){const r=[];for(let n=0;n<i;n++)if(t[0]){const i=t.shift();!i.isVideoAvailable||i.subscriptionInProgress||i.videoSession||r.push(this.webConferenceService.subscribeToParticipantVideo(e,i))}r.length&&(await Promise.all(r),t.length&&this.subscribeToPublishersByParts(e,t))}subscribeToNewServices(e){const t=this.webConferenceService.getWebConferenceSessionById(e);t&&t.services.length&&!t.subscribedToGridService&&t.services.forEach((e=>{"video-compositor"===e.name&&this.webConferenceService.subscribeToService(t,e.id)}))}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(6),n=i(9),s=i(4),o=i(11),a=i(28),c=i(14),l=i(65),d=i(43);t.WebrtcP2PEventHandler=class{constructor(e){this.webrtcP2PService=e,this.xmppService=n.XmppService.getInstance(),this.logger=s.LoggerService.getInstance(),this.contactService=r.ContactService.getInstance(),this.eventService=o.EventService.getInstance(),this.profileService=c.ProfileService.getInstance(),this.webrtcConfigAndUtils=d.WebrtcConfigAndUtils.getInstance(),this.nameSpace="urn:xmpp:jingle-message:0"}setRemoteTypeMedia(e,t){t.remoteMedia=0;for(let i=0;i<e.length;i++)switch(e[i]){case"audio":t.remoteMedia=t.remoteMedia|a.Call.Media.AUDIO;break;case"video":t.remoteMedia=t.remoteMedia|a.Call.Media.VIDEO;break;case"sharing":t.remoteMedia=t.remoteMedia|a.Call.Media.SHARING;break;default:t.remoteMedia=null}this.logger.debug("[WebrtcP2PEventHandler] REMOTE TYPE || REMOTE MEDIA  "+t.remoteMedia)}setLocalTypeMedia(e,t){t.localMedia=0;for(let i=0;i<e.length;i++)switch(e[i]){case"audio":t.localMedia=t.localMedia|a.Call.Media.AUDIO;break;case"video":t.localMedia=t.localMedia|a.Call.Media.VIDEO;break;case"sharing":t.localMedia=t.localMedia|a.Call.Media.SHARING;break;default:t.localMedia=null}this.logger.debug("[WebrtcP2PEventHandler] LOCAL TYPE || LOCAL MEDIA  "+t.localMedia)}async sendProposition(e,t,i=""){this.logger.info("[WebrtcP2PEventHandler] | sendProposition to "+JSON.stringify({displayName:e.nameForLog,resources:e.resources}));let r=["audio"],n=[];"video"===t?r.push("video"):"videoOnly"===t?r=["video"]:"sharing"===t?(r=["audio"],n=["sharing"]):"sharingOnly"===t&&(r=["sharing"]);const s="web_"+crypto.randomUUID(),o=a.Call.create(a.Call.Status.DIALING,s,a.Call.Type.WEBRTC,e);let c,l;try{if(c=await this.webrtcP2PService.getBrowserMedia(r,void 0,void 0,void 0,o),l=await this.webrtcP2PService.getBrowserMedia(n),this.webrtcP2PService.makingCall&&this.webrtcP2PService.started){this.webrtcP2PService.calls[o.id]=o,o.isInitiator=true,c.callId=s;let t=c;-1!==r.indexOf("video")&&(o.originalStream=c,t=await this.webrtcP2PService.virtualBackgroundService.startProcessStream(c)),this.webrtcP2PService.pushInLocalStreams(t,s),l&&(l.callId=s,this.webrtcP2PService.pushInLocalStreams(l,s),r.push(n.pop())),this.setLocalTypeMedia(r,o);const a="web_"+crypto.randomUUID();let d=$msg({from:this.contactService.userContact.fullJid,to:e.jid,id:a});d.c("propose",{xmlns:this.nameSpace,id:s}),i&&d.c("subject",{xmlns:"urn:xmpp:jingle-subject:0"}).t(i).up(),d.c("description",{xmlns:"urn:xmpp:jingle:apps:rtp:1",media:r[0]}).up(),r[1]&&(d=d.c("description",{xmlns:"urn:xmpp:jingle:apps:rtp:1",media:r[1]}).up()),d=d.c("unifiedplan",{xmlns:"urn:xmpp:jingle:apps:jsep:1"}).up(),this.xmppService.send(d),this.webrtcP2PService.makingCall=false,this.contactService.setBusyState("dnd",this.webrtcP2PService.calculatePresenceMessage(o)),this.eventService.publish("ON_CALL_UPDATED_EVENT",o),this.webrtcP2PService.autoreleaseTimeout&&clearTimeout(this.webrtcP2PService.autoreleaseTimeout),this.webrtcP2PService.autoreleaseTimeout=setTimeout((()=>{this.logger.info("[WebrtcP2PEventHandler]  | send proposition : no response after 30 seconds : release the call"),o&&this.webrtcP2PService.rejectCall(o)}),3e4)}else this.logger.warn("[WebrtcP2PEventHandler] | sendProposition -- call should no longer be made !"),this.webrtcP2PService.makingCall=false,c.getTracks().forEach((function(e){e.enabled=false,e.stop(),e=null})),c.stop&&c.stop(),c=null,l&&(l.getTracks().forEach((function(e){e.enabled=false,e.stop(),e=null})),l.stop&&l.stop(),l=null)}catch(d){this.logger.info("[WebrtcP2PEventHandler]   | sendProposition failure : "+JSON.stringify({error:d.message})),this.webrtcP2PService.makingCall=false,-1===n.indexOf("sharing")&&-1!==d.toString().indexOf("getUserMedia")&&this.webrtcP2PService.openErrorPopup(),this.webrtcP2PService.removeCallObject(o),this.webrtcP2PService.isUserContactInCall()||this.webrtcP2PService.resetToSafeState(),this.webrtcP2PService.autoreleaseTimeout&&clearTimeout(this.webrtcP2PService.autoreleaseTimeout),c&&(c.getTracks().forEach((function(e){e.enabled=false,e.stop(),e=null})),c.stop&&c.stop(),c=null)}}retractProposition(e){this.logger.info("[WebrtcP2PEventHandler]   | retractProposition for call "+e.id);const t="web_"+crypto.randomUUID(),i=$msg({from:this.contactService.userContact.fullJid,to:e.contact.jid,id:t}).c("retract",{xmlns:this.nameSpace,id:e.id});this.xmppService.send(i),this.eventService.publish("CHECK_AND_RESET_BUSY_STATE"),this.webrtcP2PService.removeCallObject(e)}acceptProposition(e,t){if(e.status===a.Call.Status.ANSWERING)return void this.logger.warn("[WebrtcP2PEventHandler] | acceptProposition for call "+e.id+" -- ignored! Already answering");this.logger.info("[WebrtcP2PEventHandler] | acceptProposition for call "+e.id),e.status=a.Call.Status.ANSWERING;const i="web_"+crypto.randomUUID();let r=$msg({from:this.contactService.userContact.fullJid,to:this.contactService.userContact.jid,id:i}).c("accept",{xmlns:this.nameSpace,id:e.id});this.xmppService.send(r);const n="web_"+crypto.randomUUID();r=$msg({from:this.contactService.userContact.fullJid,to:e.fullJid,id:n}).c("proceed",{xmlns:this.nameSpace,id:e.id}),r=r.c("unifiedplan",{xmlns:"urn:xmpp:jingle:apps:jsep:1"}).up(),this.xmppService.send(r);let s=["audio"];t&&"video"===t&&s.push("video"),e.remoteMedia===a.Call.Media.VIDEO&&(s=["video"]),e.remoteMedia===a.Call.Media.SHARING&&(s=[]),this.setLocalTypeMedia(s,e),this.contactService.setBusyState("dnd",this.webrtcP2PService.calculatePresenceMessage(e)),this.eventService.publish("ON_CALL_UPDATED_EVENT",e),this.webrtcP2PService.autoreleaseTimeout&&clearTimeout(this.webrtcP2PService.autoreleaseTimeout),this.webrtcP2PService.autoreleaseTimeout=setTimeout((()=>{e&&(null!==e.getMediaPillarCall()?this.logger.warn("[webrtcgateway/WebrtcP2PEventHandler] | acceptProposition autoreleaseTimeout after 45 s : remove the call :"+e.id):this.logger.info("[WebrtcP2PEventHandler] | acceptProposition autoreleaseTimeout after 45 s : remove the call "+e.id),this.webrtcP2PService.removeCallObject(e),this.eventService.publish("CHECK_AND_RESET_BUSY_STATE"))}),45e3)}rejectProposition(e,t){this.logger.info("[WebrtcP2PEventHandler] | rejectProposition for call "+e.id);const i="web_"+crypto.randomUUID();let r=$msg({from:this.contactService.userContact.fullJid,to:this.contactService.userContact.jid,id:i}).c("reject",{xmlns:this.nameSpace,id:e.id});this.xmppService.send(r);const n=e.getMediaPillarCall(),s=n&&n.getMediaPillarJid()?n.getMediaPillarJid():e.contact.jid,o="web_"+crypto.randomUUID();s?(r=$msg({from:this.contactService.userContact.fullJid,to:s,id:o}).c("reject",{xmlns:this.nameSpace,id:e.id,reason:t}),this.xmppService.send(r)):this.logger.error("[WebrtcP2PEventHandler] | rejectProposition -- missing other JID !"),e&&(e.status=a.Call.Status.UNKNOWN,delete this.webrtcP2PService.calls[e.id],this.eventService.publish("ON_CALL_UPDATED_EVENT",e)),this.webrtcConfigAndUtils.setWebrtcConfiguration(),this.webrtcP2PService.autoreleaseTimeout&&clearTimeout(this.webrtcP2PService.autoreleaseTimeout)}onMessageReceived(e){try{const t=$(e);t.find("error").length>0||t.find("delay").length>0||$(e).find("service-unavailable").length>0?this.onMessageReceivedError(e):t.find("propose").length>0?this.onPropositionReceived(e):t.find("retract").length>0?this.onRetractReceived(e):t.find("reject").length>0?this.onRejectReceived(e):t.find("accept").length>0?this.onAcceptReceived(e):t.find("proceed").length>0&&this.onProceedReceived(e)}catch(t){return this.logger.error("[WebrtcP2PEventHandler]   | onMessageReceived error "+t),true}return true}onMessageReceivedError(e){this.logger.info("[WebrtcP2PEventHandler]   | onMessageReceivedError");const t=$(e).find("propose").attr("id"),i=this.webrtcP2PService.calls[t];i&&this.logger.error("[WebrtcP2PEventHandler]   | onMessageReceivedError call is in "+i.status.value+" state")}async getOrCreateContact(e,t){let i;if(this.contactService.isMediaPillarJid(e)){this.logger.info("[WebrtcP2PEventHandler] | getOrCreateContact for mediapillar jid "+e);const r=$(t).find("mediapillar");if(r){const t=r.find("callernumber"),n=t?t.text():void 0,s=r.find("displayname"),o=s?s.text():void 0;this.logger.info("[WebrtcP2PEventHandler]   | getOrCreateContact MP for jid "+e+" callernumber: "+l.default(n)+" displayname: "+l.default(o));const a=this.contactService.getContactByPhoneNumber(n);return a&&a!==this.contactService.userContact?(this.logger.debug("[WebrtcP2PEventHandler]   | getOrCreateContact found contact from phonenumber => contact id: "+a.id),i=a):(i=this.contactService.createBasicContact(null,n),o&&(i.displayName=o)),i}return this.contactService.getOrCreateContact(e)}return this.logger.info("[WebrtcP2PEventHandler]   | getOrCreateContact for jid "+e),this.contactService.getOrCreateContact(e)}async onPropositionReceived(e){const t=$(e).find("propose").attr("id"),i=$(e).attr("from");this.logger.info("[WebrtcP2PEventHandler] jingle propose | onPropositionReceived for ID "+t+" and jid "+i);let r=this.webrtcP2PService.calls[t];try{if(!r){const n=this.xmppService.getBareJidFromJid(i);r=a.Call.create(a.Call.Status.UNKNOWN,t,a.Call.Type.WEBRTC,null),r.fullJid=i,this.webrtcP2PService.calls[r.id]=r;const s=await this.getOrCreateContact(n,e);if(r.contact=s,!this.webrtcP2PService.calls[r.id])return;if($(e).find("mediapillar")){const t=$(e).find("callId");if(t.length>0){const e=t[0];e&&(this.logger.debug("[WebrtcP2PEventHandler]   | onPropositionReceived mediapillar callId detected: "+e.textContent),r.setAssocPhoneCallId(e.textContent))}}}if($(e).find("subject").length>0){const t=$(e).find("subject")[0];this.logger.debug("[WebrtcP2PEventHandler]   | onPropositionReceived subject Detected: "+t.textContent),r.setSubject(t.textContent)}const n=[],s=$(e).find("description").length;for(let t=0;t<s;t++){const i=$(e).find("description")[t];n.push($(i).attr("media"))}r.setStatus(a.Call.Status.RINGING_INCOMMING),this.setRemoteTypeMedia(n,r),this.eventService.publish("ON_CALL_UPDATED_EVENT",r),r.remoteMedia===a.Call.Media.SHARING&&r.contact&&this.webrtcP2PService.hasMediaPillarCallWithContactJid(r.contact.jid)&&(r.isSecondSharingCall=true),this.webrtcP2PService.autoreleaseTimeout&&clearTimeout(this.webrtcP2PService.autoreleaseTimeout),this.contactService.isMediaPillarJid(r.fullJid)||(this.webrtcP2PService.autoreleaseTimeout=setTimeout((()=>{r&&(this.logger.info("[WebrtcP2PEventHandler]   | onPropositionReceived autoreleaseTimeout after 2 min : remove the call "+r.id),this.webrtcP2PService.removeCallObject(r))}),12e4))}catch(n){this.logger.error("[WebrtcP2PEventHandler]   | onPropositionReceived error "+n),this.webrtcP2PService.autoreleaseTimeout&&clearTimeout(this.webrtcP2PService.autoreleaseTimeout),this.webrtcP2PService.removeCallObject(r)}}onRetractReceived(e){const t=$(e).find("retract").attr("id");this.logger.info("[WebrtcP2PEventHandler] jingle retract  | onRetractReceveid "+t);const i=this.webrtcP2PService.calls[t];i&&(i.status===a.Call.Status.ANSWERING&&this.eventService.publish("CHECK_AND_RESET_BUSY_STATE"),this.webrtcP2PService.removeCallObject(i)),this.webrtcP2PService.autoreleaseTimeout&&clearTimeout(this.webrtcP2PService.autoreleaseTimeout)}onRejectReceived(e){const t=$(e).find("reject").attr("id"),i=this.webrtcP2PService.calls[t],r=$(e).attr("from");this.logger.info("[WebrtcP2PEventHandler] jignle reject | onRejectReceived "+t+" jid "+r),this.webrtcP2PService.autoreleaseTimeout&&clearTimeout(this.webrtcP2PService.autoreleaseTimeout),i&&(i.status===a.Call.Status.RINGING_INCOMMING&&(null!==i.getMediaPillarCall()&&this.eventService.publish("ON_MEDIAPILLAR_CALL_REJECT_EVENT",i),this.webrtcP2PService.removeCallObject(i)),i.status===a.Call.Status.DIALING&&(this.eventService.publish("CHECK_AND_RESET_BUSY_STATE"),this.webrtcP2PService.removeCallObject(i)),i.status!==a.Call.Status.ACTIVE&&i.status!==a.Call.Status.CONNECTING||i.fullJid&&i.fullJid===r&&(this.eventService.publish("CHECK_AND_RESET_BUSY_STATE"),this.webrtcP2PService.removeCallObject(i)))}onAcceptReceived(e){const t=$(e).find("accept").attr("id"),i=this.webrtcP2PService.calls[t],r=$(e).attr("from");i&&r!==this.contactService.userContact.fullJid&&(this.logger.info("[WebrtcP2PEventHandler] jignle accept  | onAcceptReceived "+t+" jid "+r),null!==i.getMediaPillarCall()&&this.eventService.publish("ON_MEDIAPILLAR_CALL_REMOTE_CTRL_EVENT",i),this.webrtcP2PService.removeCallObject(i)),r!==this.contactService.userContact.fullJid&&this.webrtcP2PService.autoreleaseTimeout&&clearTimeout(this.webrtcP2PService.autoreleaseTimeout)}async onProceedReceived(e){this.webrtcP2PService.autoreleaseTimeout&&clearTimeout(this.webrtcP2PService.autoreleaseTimeout);const t=$(e).find("proceed").attr("id"),i=this.webrtcP2PService.calls[t],r=$(e).attr("from");if(this.logger.info("[WebrtcP2PEventHandler] jignle proceed  | onProceedReceived -- "+t+" jid "+r),i.fullJid=r,i.localMedia===a.Call.Media.SHARING&&i.contact&&this.webrtcP2PService.hasMediaPillarCallWithContactJid(i.contact.jid)&&(i.isSecondSharingCall=true),i.isInConversationWithMobile()&&i.localMedia&a.Call.Media.VIDEO){let e=[];const t=this.webrtcConfigAndUtils.getMobileMediaConstraints("video");e=["audio","video"],i.localMedia&a.Call.Media.AUDIO||(e=["video"]);try{const r=await this.webrtcP2PService.getBrowserMedia(e,t.fixedVideoWidth,t.fixedVideoHeight,t.fixedFrameRate);this.logger.info("[WebrtcP2PEventHandler]   | onProceedReceived --\x3e renegociate video quality"),i.localMedia&a.Call.Media.VIDEO&&(this.webrtcConfigAndUtils.disableMediaStreams(i.localStreams),i.localStreams=[],this.webrtcConfigAndUtils.disableMediaStream(i.originalStream),i.originalStream=null);let n=r;-1!==e.indexOf("video")&&(i.originalStream=r,n=await this.webrtcP2PService.virtualBackgroundService.startProcessStream(r)),this.webrtcP2PService.pushInLocalStreams(n,i.id),this.webrtcP2PService.makeJingleCall(i)}catch(n){this.logger.info("[WebrtcP2PEventHandler]   | onProceedReceived "+i+" failure : "+n.message),-1!==n.toString().indexOf("getUserMedia")?(this.logger.info("onProceedReceived impossible, no webcam plugged"),this.webrtcP2PService.openErrorPopup()):(this.webrtcP2PService.releaseCall(i),this.webrtcP2PService.resetToSafeState())}}else i.localMedia&a.Call.Media.SHARING?this.webrtcP2PService.makeJingleSharingCall(i):this.webrtcP2PService.makeJingleCall(i)}incomingCall(e){this.logger.info("[WebrtcP2PEventHandler] incomingCall "+e);let t=null;const i=this.xmppService.connection.jingle.sessions[e];if(i&&i.peerjid&&(t=this.webrtcP2PService.calls[e],!t)){const e=this.xmppService.getBareJidFromJid(i.peerjid),r=this.contactService.getContactByJid(e);t=this.webrtcP2PService.getCallByJid(r.jid,i.peerjid)}t?(i.sendRinging(),setTimeout((()=>{this.webrtcP2PService.answerJingleCall(t)}),350),this.eventService.publish("ON_CALL_UPDATED_EVENT",t),this.webrtcP2PService.autoreleaseTimeout&&clearTimeout(this.webrtcP2PService.autoreleaseTimeout),t.statsInterval&&(this.logger.info("[WebrtcP2PEventHandler] remove getStats interval"),window.clearInterval(t.statsInterval),t.statsInterval=null),this.webrtcConfigAndUtils.createOrUpdateStatisticsForCall(t),this.logger.info("[WebrtcP2PEventHandler] start getStats interval"),t.statsInterval=i.getStats(3e3)):(this.logger.warn("[WebrtcP2PEventHandler] incomingCall no such call ! Terminate the session "),this.eventService.publish("CHECK_AND_RESET_BUSY_STATE"),i&&i.terminate())}activeCall(e){this.logger.info("[WebrtcP2PEventHandler] activeCall "+e);const t=this.xmppService.connection.jingle.sessions[e];this.webrtcP2PService.autoreleaseTimeout&&clearTimeout(this.webrtcP2PService.autoreleaseTimeout);const i=this.webrtcP2PService.calls[e];this.webrtcP2PService.updateRemoteTypeMedia(t.remoteType,i),i&&i.status.key!==a.Call.Status.RELEASING.key&&i.status.key!==a.Call.Status.UNKNOWN.key&&(i.setStatus(a.Call.Status.ACTIVE),this.eventService.publish("ON_CALL_UPDATED_EVENT",i),i.startDuration(),this.webrtcP2PService.attachDistantMediaStreams(true,i))}terminatedCall(e,t,i){0===Object.keys(this.xmppService.connection.jingle.sessions).length&&this.logger.info("INFO    | all calls terminated");const r=this.webrtcP2PService.calls[e];r||0===Object.keys(this.webrtcP2PService.calls).length?("busy"===t&&this.webrtcP2PService.openErrorPopup("remoteUserNoMoreAvailable"),this.webrtcP2PService.autoreleaseTimeout&&clearTimeout(this.webrtcP2PService.autoreleaseTimeout),this.webrtcConfigAndUtils.disableAllStreamsForSession(r),this.webrtcConfigAndUtils.createOrUpdateStatisticsForCall(r),this.webrtcConfigAndUtils.callsStats[e]&&delete this.webrtcConfigAndUtils.callsStats[e],r&&this.webrtcP2PService.removeCallObject(r),i||setTimeout((()=>{this.eventService.publish("CHECK_AND_RESET_BUSY_STATE")}),1e3),r&&r.statsInterval&&(window.clearInterval(r.statsInterval),r.statsInterval=null),this.webrtcP2PService.isUserContactInCall()||this.webrtcP2PService.clearSrcObjectsFromElements()):this.logger.info("INFO    | terminatedCall : no call with "+e+" exists.")}onJingleError(e){e&&this.webrtcP2PService.calls[e]&&this.webrtcP2PService.calls[e].status!==a.Call.Status.ACTIVE&&(this.webrtcP2PService.removeCallObject(this.webrtcP2PService.calls[e]),this.webrtcP2PService.resetToSafeState(),this.webrtcP2PService.openErrorPopup("IceConnectionFailed"))}iceConnectionStateChange(e,t){this.logger.info("[WebrtcP2PEventHandler] iceConnectionStateChange for "+e);let i=null;const r=this.webrtcP2PService.calls[t.sid];try{const n=t.peerconnection.connectionState?t.peerconnection.connectionState:t.peerconnection.iceConnectionState;if("stable"!==t.peerconnection.signalingState)return void this.logger.info("[WebrtcGlobalEventHandlerService]  | iceconnectionstatechange "+e+" "+n+"|"+t.peerconnection.signalingState+" is ignored");this.logger.info("[WebrtcGlobalEventHandlerService]  | iceconnectionstatechange "+e+" "+n+"|"+t.peerconnection.signalingState),"connected"===n&&(this.logger.info("INFO    | ICE Connection established successfully"),$("#globalAudioTag")[0]&&this.logger.info("[WebrtcP2PEventHandler] sinkId for globalAudioTag is "+$("#globalAudioTag")[0].sinkId),this.webrtcP2PService.reconnectCall=false,i=this.webrtcP2PService.calls[e],i&&i.onHold?(r.setStatus(a.Call.Status.HOLD),this.eventService.publish("ON_WEBRTC_CALL_ESCALATION",i)):i&&i.putOnHold?(r.setStatus(a.Call.Status.PUT_ON_HOLD),this.eventService.publish("ON_WEBRTC_CALL_ESCALATION",i)):i&&i.status!==a.Call.Status.ACTIVE&&(this.logger.info("INFO    | ICE Connection : call is active now !"),this.activeCall(e)),t.isRenegotiating&&(this.logger.info("INFO    | Renegotiating done"),t.isRenegotiating=false,this.eventService.publish("ON_WEBRTC_CALL_ESCALATION",i),this.eventService.publish("ON_WEBRTC_CALL_ESCALATION_SUCCESS",i)),t.autoReconnectTimer&&(clearTimeout(t.autoReconnectTimer),t.autoReconnectTimer=null),this.webrtcP2PService.autoreleaseTimeout&&(clearTimeout(this.webrtcP2PService.autoreleaseTimeout),this.webrtcP2PService.autoreleaseTimeout=null)),"completed"===n&&(this.logger.info("INFO    | ICE Connection completed successfully"),this.webrtcP2PService.reconnectCall=false,i=this.webrtcP2PService.calls[e],i&&i.onHold?(r.setStatus(a.Call.Status.HOLD),this.eventService.publish("ON_WEBRTC_CALL_ESCALATION",i)):i&&i.putOnHold?(r.setStatus(a.Call.Status.PUT_ON_HOLD),this.eventService.publish("ON_WEBRTC_CALL_ESCALATION",i)):i&&i.status!==a.Call.Status.ACTIVE&&(this.logger.info("INFO    | ICE Connection : call is active now !"),this.activeCall(e)),t.isRenegotiating&&(this.logger.info("INFO    | Renegotiating done"),t.isRenegotiating=false,this.eventService.publish("ON_WEBRTC_CALL_ESCALATION",i),this.eventService.publish("ON_WEBRTC_CALL_ESCALATION_SUCCESS",i)),this.webrtcP2PService.autoreleaseTimeout&&(clearTimeout(this.webrtcP2PService.autoreleaseTimeout),this.webrtcP2PService.autoreleaseTimeout=null)),"disconnected"===n&&(this.logger.info("INFO    | signalingState disconnected"),r&&r.status!==a.Call.Status.UNKNOWN&&(this.logger.info("INFO    | iceConnectionStateChange go to connecting state"),r.setStatus(a.Call.Status.CONNECTING),this.eventService.publish("ON_CALL_UPDATED_EVENT",r)),this.webrtcP2PService.connected||(this.webrtcP2PService.reconnectCall=true),t.autoReconnectTimer||(this.logger.error("arm autoReconnectTimer"),t.autoReconnectTimer=setTimeout((()=>{this.logger.error("autoReconnectTimer -- execute"),this.webrtcP2PService.connected&&(this.logger.error("autoReconnectTimer -- network OK, proceed with reconnect"),t.reconnectSession())}),5e3)),this.webrtcP2PService.autoreleaseTimeout||(this.webrtcP2PService.autoreleaseTimeout=setTimeout((()=>{this.logger.info("[WebrtcP2PEventHandler]  | reconnection is impossible after 45 seconds : release the call"),r&&r.status!==a.Call.Status.UNKNOWN&&this.webrtcP2PService.rejectCall(r)}),45e3))),"failed"===n&&(this.logger.info("INFO    | signalingState FAILED"),r&&r.status!==a.Call.Status.UNKNOWN&&(this.logger.info("INFO    | iceConnectionStateChange go to connecting state"),r.setStatus(a.Call.Status.CONNECTING),this.eventService.publish("ON_CALL_UPDATED_EVENT",r),this.eventService.publish("ON_RECORDING_CNXLOST_EVENT")),this.webrtcP2PService.connected||(this.webrtcP2PService.reconnectCall=true),this.webrtcP2PService.connected&&(this.logger.error("[WebrtcP2PEventHandler] signalingState FAILED -- network OK, proceed with reconnect"),t.reconnectSession()),this.webrtcP2PService.autoreleaseTimeout||(this.webrtcP2PService.autoreleaseTimeout=setTimeout((()=>{this.logger.info("[WebrtcP2PEventHandler]  | reconnection is impossible after 45 seconds : release the call"),r&&r.status!==a.Call.Status.UNKNOWN&&this.webrtcP2PService.rejectCall(r)}),45e3)))}catch(n){try{this.logger.error("JINGLE  | iceconnectionstatechange error "+n),r?this.webrtcP2PService.removeCallObject(r,"unsupported-applications"):this.xmppService.connection.jingle.terminate(null,"unsupported-applications"),this.eventService.publish("CHECK_AND_RESET_BUSY_STATE")}catch(dp){this.logger.error("JINGLE  | iceconnectionstatechange error "+dp),this.eventService.publish("CHECK_AND_RESET_BUSY_STATE")}}}mediaModified(e,t){this.logger.info("[WebrtcP2PEventHandler] mediaModified "+e);const i=this.webrtcP2PService.calls[e];this.xmppService.connection.jingle.sessions[e].isRenegotiating=true,i.remoteMedia="sharing"===t?a.Call.Media.AUDIO|a.Call.Media.SHARING:"video"===t?a.Call.Media.AUDIO|a.Call.Media.VIDEO:"sharing+video"===t?a.Call.Media.AUDIO|a.Call.Media.VIDEO|a.Call.Media.SHARING:a.Call.Media.AUDIO,this.contactService.setBusyState("dnd",this.webrtcP2PService.calculatePresenceMessage(i)),this.eventService.publish("ON_WEBRTC_CALL_ESCALATION",i)}async onTrasferCallEvent(e,t){this.logger.info(`[WebrtcP2PEventHandler]   | onTrasferCallEvent referTo ${e} and other sid ${t}`);const i=["audio"],r=await this.contactService.getOrCreateContact(this.xmppService.getBareJidFromJid(e)),n="web_"+crypto.randomUUID(),s=a.Call.create(a.Call.Status.DIALING,n,a.Call.Type.WEBRTC,r);let o;try{o=await this.webrtcP2PService.getBrowserMedia(i,void 0,void 0,void 0,s),this.webrtcP2PService.calls[s.id]=s,s.isInitiator=true,o.callId=n,s.fullJid=e,this.webrtcP2PService.pushInLocalStreams(o,n),this.setLocalTypeMedia(i,s),await this.webrtcP2PService.makeJingleCall(s,null,null,t),this.contactService.setBusyState("dnd",this.webrtcP2PService.calculatePresenceMessage(s)),this.eventService.publish("ON_WEBRTC_CALL_TRANSFER_EVENT",r.jid)}catch(c){this.logger.info("[WebrtcP2PEventHandler]   | onTrasferCallEvent failure : "+JSON.stringify({error:c.message})),this.webrtcP2PService.makingCall=false,this.webrtcP2PService.removeCallObject(s),this.webrtcP2PService.isUserContactInCall()||this.webrtcP2PService.resetToSafeState(),this.webrtcP2PService.autoreleaseTimeout&&clearTimeout(this.webrtcP2PService.autoreleaseTimeout),o&&(o.getTracks().forEach((function(e){e.enabled=false,e.stop(),e=null})),o.stop&&o.stop(),o=null)}}async onIncomingTrasferredCall(e){this.logger.info("[WebrtcP2PEventHandler]   | onIncomingTransferredCall for sid "+e);const t=this.xmppService.connection.jingle.sessions[e],i=this.xmppService.getBareJidFromJid(t.peerjid),r=a.Call.create(a.Call.Status.CONNECTING,e,a.Call.Type.WEBRTC,null);try{r.fullJid=t.peerjid,this.webrtcP2PService.calls[r.id]=r;const n=await this.contactService.getOrCreateContact(i);r.contact=n;const s=["audio"];this.setRemoteTypeMedia(s,r),r.localMedia=a.Call.Media.AUDIO,this.eventService.publish("ON_CALL_UPDATED_EVENT",r),this.incomingCall(e),this.eventService.publish("ON_WEBRTC_CALL_TRANSFER_EVENT",i)}catch(n){this.logger.error("[WebrtcP2PEventHandler]   | onIncomingTransferredCall error "+n),this.webrtcP2PService.removeCallObject(r)}}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(108),n=i(8),s=i(4),o=i(13);class a{}t.AbstractWebinarService=a;class c extends a{constructor(e){super(),this.webinarService=e,this.authService=n.AuthService.getInstance(),this.logger=s.LoggerService.getInstance(),this.errorHelperService=o.ErrorHelperService.getInstance()}static create(e){return new c(e)}async add(e,t){try{const i=`${config.restServerUrl}/api/rainbow/webinar/v1.0/webinars/${e.id}/invitations/participant`,r=this.authService.getPostHeader(),n=t.getData(),s=await fetch(i,{method:"POST",headers:r,body:n});if(!s.ok)throw s;return e}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"addParticipant");throw this.logger.error("[WebinarParticipantsService] "+e.message),e.error}}async approve(e,t){try{const i=`${config.restServerUrl}/api/rainbow/webinar/v1.0/webinars/${e.id}/registrations/approve`,n=this.authService.getPostHeader(),s=JSON.stringify({emails:t}),o=await fetch(i,{method:"PUT",headers:n,body:s});if(!o.ok)throw o;const a=(await o.json()).data;return r.Webinar.updateFromData(e,a),e.rxSubject.next(),e}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"approveParticipants");throw this.logger.error("[WebinarParticipantsService] "+e.message),e.error}}async reject(e,t){try{const i=`${config.restServerUrl}/api/rainbow/webinar/v1.0/webinars/${e.id}/registrations/reject`,n=this.authService.getPostHeader(),s=JSON.stringify({emails:t}),o=await fetch(i,{method:"PUT",headers:n,body:s});if(!o.ok)throw o;const a=(await o.json()).data;return r.Webinar.updateFromData(e,a),e.rxSubject.next(),e}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"rejectParticipants");throw this.logger.error("[WebinarParticipantsService] "+e.message),e.error}}async resendInvitationMail(e,t){try{const i=`${config.restServerUrl}/api/rainbow/webinar/v1.0/webinars/${e.id}/registrations/mail-resend`,r=this.authService.getPostHeader(),n=JSON.stringify({emails:t}),s=await fetch(i,{method:"PUT",headers:r,body:n});if(!s.ok)throw s;return e}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"resendParticipantInvitationMail");throw this.logger.error("[WebinarParticipantsService] "+e.message),e.error}}async getInfo(e,t){try{const i=`${config.restServerUrl}/api/rainbow/webinar/v1.0/webinars/${e.id}/registrations?email=${t}`,r=this.authService.getRequestHeader(),n=await fetch(i,{method:"GET",headers:r});if(!n.ok)throw n;return(await n.json()).data[0]}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"getParticipantInfo");throw this.logger.error("[WebinarParticipantsService] "+e.message),e.error}}async getCSVTemplateUrl(){try{let e=config.restServerUrl+"/api/rainbow/massprovisioning/v1.0/webinars/participants/template";"webinar"===this.webinarService.roomService.context&&(e+="?context=webinar");const t=this.authService.getRequestHeader(),i=await fetch(e,{method:"GET",headers:t});if(!i.ok)throw i;const r=await i.blob();return URL.createObjectURL(r)}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getCSVParticipantTemplateUrl");throw this.logger.error("[WebinarParticipantsService] "+t.message),t.error}}async getCSVText(e){try{const t=(await this.webinarService.getAttendeesAnalytics(e)).reduce(((e,t)=>(e[t.email]=t,e)),{});let i="\nemail;firstName;lastName;company;jobTitle;country;state;attendance\n";return e.participants.forEach((e=>{i+=`${e.email&&e.email.length?e.email:""};${e.firstName&&e.firstName.length?e.firstName:""};${e.lastName&&e.lastName.length?e.lastName:""};${e.company&&e.company.length?e.company:""};${e.jobTitle&&e.jobTitle.length?e.jobTitle:""};${e.country&&e.country.length?e.country:""};${e.state&&e.state.length?e.state:""};${e.email&&t[e.email]&&true===t[e.email].attendance?"Yes":"No"};\n`})),i.trim()}catch(t){return""}}async checkCSV(e,t){const i=r.WebinarCSVStatus.create();try{let r=`${config.restServerUrl}/api/rainbow/massprovisioning/v1.0/webinars/participants/imports/check?webinarId=${e.id}`;"webinar"===this.webinarService.roomService.context&&(r+="&context=webinar");const n=this.authService.getPostHeader("text/csv; charset=utf-8"),s=t,o=await fetch(r,{method:"POST",headers:n,body:s});if(!o.ok)throw o;const a=(await o.json()).data;return i.okCount=a.okCount,i.errorCount=a.errorCount,a.errorReport&&(i.errorReport=Object.keys(a.errorReport).map((e=>{const t=a.errorReport[e],i=t.csvSource.split(";"),r={email:{value:i[0],status:"ok"},firstName:{value:i[1],status:"ok"},lastName:{value:i[2],status:"ok"},company:{value:i[3],status:"ok"},jobTitle:{value:i[4],status:"ok"},country:{value:i[5],status:"ok"}};return t.errors.forEach((e=>{r[e.param].status="error"})),r}))),i}catch(n){i.errorDetails="UnknownError";const e=await this.errorHelperService.getErrorInfo(n,"checkCSVParticipants");return 400===n.status&&e.error.errorDetails&&(i.errorDetails=e.error.errorDetails),this.logger.error("[WebinarParticipantsService] "+e.message),i}}async importCSV(e,t){try{let i=`${config.restServerUrl}/api/rainbow/massprovisioning/v1.0/webinars/participants/imports?webinarId=${e.id}`;"webinar"===this.webinarService.roomService.context&&(i+="&context=webinar");const r=this.authService.getPostHeader("text/csv; charset=utf-8"),n=t,s=await fetch(i,{method:"POST",headers:r,body:n});if(!s.ok)throw s;return e}catch(i){const t=await this.errorHelperService.getErrorInfo(i,"importCSVParticipants");return this.logger.error("[WebinarParticipantsService] "+t.message),e}}async getImportDetails(e){try{let t=`${config.restServerUrl}/api/rainbow/massprovisioning/v1.0/webinars/participants/imports/${e.id}/details`;"webinar"===this.webinarService.roomService.context&&(t+="?context=webinar");const i=this.authService.getRequestHeader(),r=await fetch(t,{method:"GET",headers:i});if(!r.ok)throw r;return e}catch(t){const i=await this.errorHelperService.getErrorInfo(t,"getImportDetails");return this.logger.error("[WebinarParticipantsService] "+i.message),e}}async authenticate(e,t,i=false,r=null,n=null){const s=await this.getAccount(e,t,i,r,n);if(s.password){try{await this.authService.logon(s.login,s.password,false)}catch(o){throw o.errorDetailsCode="webinarParticipantAuthFailure",o}return s}return s}async getAccount(e,t,i=false,r=null,n=null){try{const s=config.restServerUrl+"/api/rainbow/webinar/v1.0/webinars/account",o=this.authService.getPostHeader();let a={openInviteId:e,joinUuid:t,accessCode:r,agreement:i};n&&(n.firstName&&(a.firstName=n.firstName),n.lastName&&(a.lastName=n.lastName),n.company&&(a.company=n.company),n.jobTitle&&(a.jobTitle=n.jobTitle)),a=JSON.stringify(a);const c=await fetch(s,{method:"POST",headers:o,body:a});if(!c.ok)throw c;const l=(await c.json()).data,d=window.atob(l.account).split(":");return this.logger.info("[WebinarParticipantsService] getAccount -- success"),{login:d[0],password:d[1],state:l.state}}catch(s){const e=await this.errorHelperService.getErrorInfo(s,"getAccount");if(403140===e.error.errorDetailsCode){return{login:window.atob(e.error.errorDetailsData.account),password:null}}throw e.error}}async joinWebinar(e,t,i=null){try{const r=config.restServerUrl+"/api/rainbow/webinar/v1.0/webinars/join",n=this.authService.getPostHeader();let s={openInviteId:e,joinUuid:t,accessCode:i};s=JSON.stringify(s);const o=await fetch(r,{method:"POST",headers:n,body:s});if(!o.ok)throw o;const a=await o.json();return this.logger.info("[WebinarParticipantsService] joinWebinar -- success"),a}catch(r){const e=await this.errorHelperService.getErrorInfo(r,"joinWebinar");throw this.logger.error("[WebinarParticipantsService] "+e.message),e.error}}async joinWebinarAsRainbowAttendee(e){try{this.logger.info("[WebinarParticipantsService] joinWebinarAsRainbowAttendee -- "+e);const t=`${config.restServerUrl}/api/rainbow/webinar/v1.0/webinars/${e}/join`,i=this.authService.getPostHeader(),r=await fetch(t,{method:"POST",headers:i});if(!r.ok)throw r;const n=await this.webinarService.getWebinar(e);await this.webinarService.getWebinarRooms(n,false)}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"joinWebinar");throw this.logger.error("[WebinarParticipantsService] "+e.message),e.error}}}t.WebinarParticipantsService=c},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(108),n=i(8),s=i(4),o=i(13);class a{}t.AbstractWebinarSpeakersService=a;class c extends a{constructor(e){super(),this.webinarService=e,this.authService=n.AuthService.getInstance(),this.logger=s.LoggerService.getInstance(),this.errorHelperService=o.ErrorHelperService.getInstance()}static create(e){return new c(e)}get(e,t){return e.organizers.concat(e.speakers).find((e=>e.userId===t))}async invite(e,t,i){try{const n=`${config.restServerUrl}/api/rainbow/webinar/v1.0/webinars/${e.id}/invitations/moderators`,s=this.authService.getPostHeader(),o=JSON.stringify({users:t,emails:i}),a=await fetch(n,{method:"POST",headers:s,body:o});if(!a.ok)throw a;const c=await a.json(),l=c.data;r.Webinar.updateFromData(e,l.webinar),this.webinarService.updateRoles(e),e.rxSubject.next();const d=c.failed;return d&&d.invalidUsers&&d.invalidUsers.length>0?d.invalidUsers.map((e=>({id:e.id,errorCode:e.errorDetailsCode}))):null}catch(n){const e=await this.errorHelperService.getErrorInfo(n,"inviteSpeakers");throw this.logger.error("[WebinarSpeakersService] "+e.message),e.error}}async remove(e,t,i){try{const n=`${config.restServerUrl}/api/rainbow/webinar/v1.0/webinars/${e.id}/moderators/remove`,s=this.authService.getPostHeader(),o=JSON.stringify({users:t,emails:i}),a=await fetch(n,{method:"PUT",headers:s,body:o});if(!a.ok)throw a;const c=(await a.json()).data;r.Webinar.updateFromData(e,c.webinar),e.rxSubject.next()}catch(n){const e=await this.errorHelperService.getErrorInfo(n,"removeSpeakers");throw this.logger.error("[WebinarSpeakersService] "+e.message),e.error}}async promoteSpeakers(e,t){try{const i=`${config.restServerUrl}/api/rainbow/webinar/v1.0/webinars/${e.id}/moderators/promote`,n=this.authService.getPostHeader(),s=JSON.stringify({users:t}),o=await fetch(i,{method:"PUT",headers:n,body:s});if(!o.ok)throw o;const a=(await o.json()).data;r.Webinar.updateFromData(e,a),this.webinarService.updateRoles(e),e.rxSubject.next()}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"promoteSpeakers");throw this.logger.error("[WebinarSpeakersService] "+e.message),e.error}}async demoteOrganizers(e,t){try{const i=`${config.restServerUrl}/api/rainbow/webinar/v1.0/webinars/${e.id}/moderators/demote`,n=this.authService.getPostHeader(),s=JSON.stringify({users:t}),o=await fetch(i,{method:"PUT",headers:n,body:s});if(!o.ok)throw o;const a=(await o.json()).data;r.Webinar.updateFromData(e,a),this.webinarService.updateRoles(e),e.rxSubject.next()}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"demoteOrganizers");throw this.logger.error("[WebinarSpeakersService] "+e.message),e.error}}async updateOrganizer(e,t,i){try{const n=`${config.restServerUrl}/api/rainbow/webinar/v1.0/webinars/${e.id}/moderators/${t}`,s=this.authService.getPostHeader(),o=JSON.stringify({hightlighted:i}),a=await fetch(n,{method:"PUT",headers:s,body:o});if(!a.ok)throw a;const c=(await a.json()).data;r.Webinar.updateFromData(e,c),this.webinarService.updateRoles(e),e.rxSubject.next()}catch(n){const e=await this.errorHelperService.getErrorInfo(n,"updateOrganizer");throw this.logger.error("[WebinarSpeakersService] "+e.message),e.error}}}t.WebinarSpeakersService=c},function(e,t,i){t.byteLength=function(e){var t=l(e),i=t[0],r=t[1];return 3*(i+r)/4-r},t.toByteArray=function(e){var t,i,r=l(e),o=r[0],a=r[1],c=new s(function(e,t,i){return 3*(t+i)/4-i}(0,o,a)),d=0,u=a>0?o-4:o;for(i=0;i<u;i+=4)t=n[e.charCodeAt(i)]<<18|n[e.charCodeAt(i+1)]<<12|n[e.charCodeAt(i+2)]<<6|n[e.charCodeAt(i+3)],c[d++]=t>>16&255,c[d++]=t>>8&255,c[d++]=255&t;2===a&&(t=n[e.charCodeAt(i)]<<2|n[e.charCodeAt(i+1)]>>4,c[d++]=255&t);1===a&&(t=n[e.charCodeAt(i)]<<10|n[e.charCodeAt(i+1)]<<4|n[e.charCodeAt(i+2)]>>2,c[d++]=t>>8&255,c[d++]=255&t);return c},t.fromByteArray=function(e){for(var t,i=e.length,n=i%3,s=[],o=0,a=i-n;o<a;o+=16383)s.push(d(e,o,o+16383>a?a:o+16383));1===n?(t=e[i-1],s.push(r[t>>2]+r[t<<4&63]+"==")):2===n&&(t=(e[i-2]<<8)+e[i-1],s.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return s.join("")};for(var r=[],n=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=o.length;a<c;++a)r[a]=o[a],n[o.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=e.indexOf("=");return-1===i&&(i=t),[i,i===t?0:4-i%4]}function d(e,t,i){for(var n,s,o=[],a=t;a<i;a+=3)n=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),o.push(r[(s=n)>>18&63]+r[s>>12&63]+r[s>>6&63]+r[63&s]);return o.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,i,r,n){var s,o,a=8*n-r-1,c=(1<<a)-1,l=c>>1,d=-7,u=i?n-1:0,h=i?-1:1,f=e[t+u];for(u+=h,s=f&(1<<-d)-1,f>>=-d,d+=a;d>0;s=256*s+e[t+u],u+=h,d-=8);for(o=s&(1<<-d)-1,s>>=-d,d+=r;d>0;o=256*o+e[t+u],u+=h,d-=8);if(0===s)s=1-l;else{if(s===c)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),s-=l}return(f?-1:1)*o*Math.pow(2,s-r)},t.write=function(e,t,i,r,n,s){var o,a,c,l=8*s-n-1,d=(1<<l)-1,u=d>>1,h=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:s-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=d):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),(t+=o+u>=1?h/c:h*Math.pow(2,1-u))*c>=2&&(o++,c/=2),o+u>=d?(a=0,o=d):o+u>=1?(a=(t*c-1)*Math.pow(2,n),o+=u):(a=t*Math.pow(2,u-1)*Math.pow(2,n),o=0));n>=8;e[i+f]=255&a,f+=p,a/=256,n-=8);for(o=o<<n|a,l+=n;l>0;e[i+f]=255&o,f+=p,o/=256,l-=8);e[i+f-p]|=128*g}},function(e,t){var i={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==i.call(e)}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(4),n=i(6),s=i(11),o=i(37),a=i(47);class c{constructor(){this.logger=r.LoggerService.getInstance(),this.contactService=n.ContactService.getInstance(),this.eventService=s.EventService.getInstance(),this.fileStorageService=o.FileStorageService.getInstance(),this.fileServerService=a.FileServerService.getInstance()}static create(){return new c}onManagementMessageReceived(e){try{const t=$(e);return t.find("file").length>0?this.manageFileStanzaData(t.find("file")):t.find("thumbnail").length>0?this.manageThumbnailStanzaData(t.find("thumbnail")):t.find("recordingfile").length>0||this.logger.info("[FileDescriptorEventHandler] onManagementMessageReceived  -- ignore the message"),true}catch(t){return this.logger.error("[FileDescriptorEventHandler] onManagementMessageReceived ERROR "+t),true}}async manageFileStanzaData(e){const t=$(e).attr("action"),i=$(e).find("fileid");let r=false;for(let s=0;s<i.length;s++){const e=$(i[s]).text(),o=this.fileStorageService.getFileDescriptorById(e);switch(this.logger.info("[FileDescriptorEventHandler] manageFileStanzaData -- "+t+" fileDescriptor "+e),t){case"create":this.logger.debug("[FileDescriptorEventHandler] fileDescriptor "+e+" created on server -- do nothing");break;case"delete":o?(o.ownerId===this.contactService.userContact.dbId&&"deleted"!==o.state&&(r=true),this.fileStorageService.deleteFileDescriptorFromCache(e),this.fileStorageService.deleteVoiceMessageFileDescriptor(e),this.eventService.publish("ON_FILE_REMOVED_FROM_STORE_EVENT",{fileId:e})):this.eventService.publish("ON_FILE_REMOVED_FROM_STORE_EVENT",{fileId:e});break;case"update":try{const t=await this.fileStorageService.retrieveAndStoreOneFileDescriptor(e,true);if(this.logger.info("[FileDescriptorEventHandler] fileDescriptor retrieved"),t.ownerId!==this.contactService.userContact.dbId&&this.fileStorageService.retrieveUserConsumption(),!t.previewBlob&&t.isThumbnailPossible())try{const e=await this.fileServerService.getBlobThumbnailFromFileDescriptor(t);t.previewBlob=e,t.previewBlobSubject.next(t.previewBlob),this.eventService.publish("ON_FILE_DESCRIPTOR_RECEIVED_EVENT",{fileId:t.id})}catch(n){this.logger.error("[FileDescriptorEventHandler] fileDescriptor retrieve error : "+n)}"isClean"===t.virusScanState&&(this.fileStorageService.updateAFileDescriptorLocally(t),this.eventService.publish("ON_FILE_DESCRIPTOR_RECEIVED_EVENT",{fileId:t.id})),this.fileStorageService.fileDescriptorsSubject.next({action:"update",fd:t})}catch(n){this.logger.error("[FileDescriptorEventHandler] fileDescriptor retrieve error : "+n)}this.fileStorageService.retrieveAndStoreOneVoiceMessageFileDescriptor(e)}}r&&this.fileStorageService.retrieveUserConsumption()}async manageThumbnailStanzaData(e){const t=$(e).attr("action"),i=$(e).find("fileid").text(),r=$(e).find("url").text(),n=$(e).find("mime").text(),s=$(e).find("size").text(),o=$(e).find("md5sum").text(),a=$(e).find("originalWidth").text(),c=$(e).find("originalHeight").text();if(this.logger.info("[FileDescriptorEventHandler] manageThumbnailStanzaData -- "+t+" fileDescriptor "+i),this.logger.debug("[FileDescriptorEventHandler]   fileUrl="+r),this.logger.debug("[FileDescriptorEventHandler]   fileMime="+n),this.logger.debug("[FileDescriptorEventHandler]   fileSize="+s),this.logger.debug("[FileDescriptorEventHandler]   md5sum="+o),this.logger.debug("[FileDescriptorEventHandler]   fileId="+i),"create"===t||"update"===t)try{await this.fileStorageService.retrieveAndStoreOneFileDescriptor(i);const e=this.fileStorageService.getFileDescriptorById(i);if(e)if(this.logger.debug("[FileDescriptorEventHandler] updating Thumbnail of found FileDescriptor "+i),e.previewBlob&&!e.previewDownloaded||!e.previewBlob){this.eventService.publish("ON_FILE_DESCRIPTOR_THUMBNAIL_READY",e.id),e.thumbnail.availableThumbnail=true,e.thumbnail.md5sum=o,e.thumbnail.size=Number(s),a&&c&&e.setOriginalImageDimensions(Number(a),Number(c)),this.logger.info("[FileDescriptorEventHandler] preview not already downloaded for "+i+" -- download it");try{await this.fileServerService.getBlobThumbnailFromFileDescriptor(e),this.eventService.publish("ON_FILE_DESCRIPTOR_RECEIVED_EVENT",{fileId:e.id})}catch(l){this.logger.error("[FileDescriptorEventHandler] Unable to get blob thumbnail from file descriptor")}}else this.eventService.publish("ON_FILE_DESCRIPTOR_THUMBNAIL_READY",e.id),this.logger.info("[FileDescriptorEventHandler] preview already downloaded for "+i+" -- do nothing");else this.logger.error("[FileDescriptorEventHandler] FileDescriptor not found and we do nothing and its not OK")}catch(d){this.logger.error("[FileDescriptorEventHandler] FileDescriptor was not found on server...")}}}t.FileDescriptorEventHandlerService=c},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:true,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:true,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,i){var r={"./af":172,"./af.js":172,"./ar":173,"./ar-dz":174,"./ar-dz.js":174,"./ar-kw":175,"./ar-kw.js":175,"./ar-ly":176,"./ar-ly.js":176,"./ar-ma":177,"./ar-ma.js":177,"./ar-sa":178,"./ar-sa.js":178,"./ar-tn":179,"./ar-tn.js":179,"./ar.js":173,"./az":180,"./az.js":180,"./be":181,"./be.js":181,"./bg":182,"./bg.js":182,"./bm":183,"./bm.js":183,"./bn":184,"./bn-bd":185,"./bn-bd.js":185,"./bn.js":184,"./bo":186,"./bo.js":186,"./br":187,"./br.js":187,"./bs":188,"./bs.js":188,"./ca":189,"./ca.js":189,"./cs":190,"./cs.js":190,"./cv":191,"./cv.js":191,"./cy":192,"./cy.js":192,"./da":193,"./da.js":193,"./de":194,"./de-at":195,"./de-at.js":195,"./de-ch":196,"./de-ch.js":196,"./de.js":194,"./dv":197,"./dv.js":197,"./el":198,"./el.js":198,"./en-au":199,"./en-au.js":199,"./en-ca":200,"./en-ca.js":200,"./en-gb":201,"./en-gb.js":201,"./en-ie":202,"./en-ie.js":202,"./en-il":203,"./en-il.js":203,"./en-in":204,"./en-in.js":204,"./en-nz":205,"./en-nz.js":205,"./en-sg":206,"./en-sg.js":206,"./eo":207,"./eo.js":207,"./es":208,"./es-do":209,"./es-do.js":209,"./es-mx":210,"./es-mx.js":210,"./es-us":211,"./es-us.js":211,"./es.js":208,"./et":212,"./et.js":212,"./eu":213,"./eu.js":213,"./fa":214,"./fa.js":214,"./fi":215,"./fi.js":215,"./fil":216,"./fil.js":216,"./fo":217,"./fo.js":217,"./fr":218,"./fr-ca":219,"./fr-ca.js":219,"./fr-ch":220,"./fr-ch.js":220,"./fr.js":218,"./fy":221,"./fy.js":221,"./ga":222,"./ga.js":222,"./gd":223,"./gd.js":223,"./gl":224,"./gl.js":224,"./gom-deva":225,"./gom-deva.js":225,"./gom-latn":226,"./gom-latn.js":226,"./gu":227,"./gu.js":227,"./he":228,"./he.js":228,"./hi":229,"./hi.js":229,"./hr":230,"./hr.js":230,"./hu":231,"./hu.js":231,"./hy-am":232,"./hy-am.js":232,"./id":233,"./id.js":233,"./is":234,"./is.js":234,"./it":235,"./it-ch":236,"./it-ch.js":236,"./it.js":235,"./ja":237,"./ja.js":237,"./jv":238,"./jv.js":238,"./ka":239,"./ka.js":239,"./kk":240,"./kk.js":240,"./km":241,"./km.js":241,"./kn":242,"./kn.js":242,"./ko":243,"./ko.js":243,"./ku":244,"./ku.js":244,"./ky":245,"./ky.js":245,"./lb":246,"./lb.js":246,"./lo":247,"./lo.js":247,"./lt":248,"./lt.js":248,"./lv":249,"./lv.js":249,"./me":250,"./me.js":250,"./mi":251,"./mi.js":251,"./mk":252,"./mk.js":252,"./ml":253,"./ml.js":253,"./mn":254,"./mn.js":254,"./mr":255,"./mr.js":255,"./ms":256,"./ms-my":257,"./ms-my.js":257,"./ms.js":256,"./mt":258,"./mt.js":258,"./my":259,"./my.js":259,"./nb":260,"./nb.js":260,"./ne":261,"./ne.js":261,"./nl":262,"./nl-be":263,"./nl-be.js":263,"./nl.js":262,"./nn":264,"./nn.js":264,"./oc-lnc":265,"./oc-lnc.js":265,"./pa-in":266,"./pa-in.js":266,"./pl":267,"./pl.js":267,"./pt":268,"./pt-br":269,"./pt-br.js":269,"./pt.js":268,"./ro":270,"./ro.js":270,"./ru":271,"./ru.js":271,"./sd":272,"./sd.js":272,"./se":273,"./se.js":273,"./si":274,"./si.js":274,"./sk":275,"./sk.js":275,"./sl":276,"./sl.js":276,"./sq":277,"./sq.js":277,"./sr":278,"./sr-cyrl":279,"./sr-cyrl.js":279,"./sr.js":278,"./ss":280,"./ss.js":280,"./sv":281,"./sv.js":281,"./sw":282,"./sw.js":282,"./ta":283,"./ta.js":283,"./te":284,"./te.js":284,"./tet":285,"./tet.js":285,"./tg":286,"./tg.js":286,"./th":287,"./th.js":287,"./tk":288,"./tk.js":288,"./tl-ph":289,"./tl-ph.js":289,"./tlh":290,"./tlh.js":290,"./tr":291,"./tr.js":291,"./tzl":292,"./tzl.js":292,"./tzm":293,"./tzm-latn":294,"./tzm-latn.js":294,"./tzm.js":293,"./ug-cn":295,"./ug-cn.js":295,"./uk":296,"./uk.js":296,"./ur":297,"./ur.js":297,"./uz":298,"./uz-latn":299,"./uz-latn.js":299,"./uz.js":298,"./vi":300,"./vi.js":300,"./x-pseudo":301,"./x-pseudo.js":301,"./yo":302,"./yo.js":302,"./zh-cn":303,"./zh-cn.js":303,"./zh-hk":304,"./zh-hk.js":304,"./zh-mo":305,"./zh-mo.js":305,"./zh-tw":306,"./zh-tw.js":306};function n(e){var t=s(e);return i(t)}function s(e){if(!i.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}n.keys=function(){return Object.keys(r)},n.resolve=s,e.exports=n,n.id=425},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(4),n=i(8),s=i(13),o=i(11),a=i(6),c=i(17),l=i(28),d=i(427),u=i(65);class h{constructor(){this.mainService=c.MainService.getInstance(),this.logger=r.LoggerService.getInstance(),this.authService=n.AuthService.getInstance(),this.errorHelperService=s.ErrorHelperService.getInstance(),this.eventService=o.EventService.getInstance(),this.contactService=a.ContactService.getInstance(),this.settings={},this.emergencyCallData={},this.monolineIncomingMode=false}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.telephonyServiceSipWise||(e.rainbow.telephonyServiceSipWise=new h),e.rainbow.telephonyServiceSipWise}async start(){if(this.logger.info("[TelephonyServiceSipWise] [TEL] === STARTING ==="),this.telephonyService=this.mainService.inject("telephonyService"),!this.telephonyService)throw new Error("TelephonyServiceSipWise failure - Telephony service is missing");if(this.webrtcGatewayService=this.mainService.inject("webrtcGatewayService"),!this.webrtcGatewayService)throw new Error("TelephonyServiceSipWise failure - webrtc Gateway service is missing");this.portalURL=config.restServerUrl+"/api/rainbow/voice/v1.0/",this.portalAdminURL=config.restServerUrl+"/api/rainbow/rvcpprovisioning/v1.0/",this.routingDataClear(),this.emergencyCallDataClear(),this.initializeSettings(),this.logger.info("[TelephonyServiceSipWise] [TEL] === STARTED ===")}routingDataClear(){this.routingData={devicesList:[],ringingDestinations:[],alsoOfficePhoneRingEnabled:true}}getPortalURL(){return this.portalURL}isMonolineIncomingModeActivated(){return this.monolineIncomingMode}getDeviceIdWithType(e){if(this.routingData.devicesList.length<1)return this.logger.info("[TelephonyServiceSipWise] getDeviceIdWithType : Anomaly API getUserDevices not yet performed"),null;if("sip"!==e&&"webrtc"!==e&&"generic"!==e)return this.logger.info("[TelephonyServiceSipWise] getDeviceIdWithType : Anomaly wrong device type"),null;const t=this.routingData.devicesList.findIndex((t=>t.type===e));return-1!==t?this.routingData.devicesList[t].deviceId:(this.logger.info("[TelephonyServiceSipWise] getDeviceIdWithType : device type "+e+" not found"),null)}getDeviceDbIdWithType(e){if(this.routingData.devicesList.length<1)return this.logger.info("[TelephonyServiceSipWise] getDeviceIdWithType : Anomaly API getUserDevices not yet performed"),null;if("sip"!==e&&"webrtc"!==e&&"generic"!==e)return this.logger.info("[TelephonyServiceSipWise] getDeviceIdWithType : Anomaly wrong device type"),null;const t=this.routingData.devicesList.findIndex((t=>t.type===e));return-1!==t?this.routingData.devicesList[t].id:(this.logger.info("[TelephonyServiceSipWise] getDeviceIdWithType : device type "+e+" not found"),null)}getCurrentDevice(){if(this.routingData.devicesList.length<1)return this.logger.info("[TelephonyServiceSipWise] getCurrentDevice : Anomaly API getUserDevices not yet performed"),null;const e=this.routingData.devicesList.find((e=>e.main));return e&&"outOfService"!==e.state?e:(this.logger.info("[TelephonyServiceSipWise] getCurrentDevice anomaly - no current/main device"),null)}setCurrentDevice(e){const t=this.routingData.devicesList.find((t=>t.deviceId===e));return t?(this.logger.info("[TelephonyServiceSipWise] setCurrentDevice for device: "+t.deviceId+" / type : "+t.type),"outOfService"===t.state&&this.logger.error("[TelephonyServiceSipWise] setCurrentDevice anomaly - current device outOfService"),this.routingData.devicesList.forEach((e=>{e.main=false})),t.main=true,true):(this.logger.error("[TelephonyServiceSipWise] setCurrentDevice anomaly - current device not found / for device "+e),false)}setRingingDevice(e){const t=[];if(!this.getCurrentDevice()||!e)return this.logger.info("[TelephonyServiceSipWise] setRingingDevice : Anomaly no current device"),null;const i=this.getDeviceIdWithType("webrtc");if(!i)return this.logger.info("[TelephonyServiceSipWise] setRingingDevice : Anomaly no webrtc device"),null;t.push(i);const r=this.getDeviceIdWithType("sip");return r&&e===r&&t.push(r),t}async putUserRoutingInfo(e,t){try{if(this.logger.info("[TelephonyServiceSipWise] putUserRoutingInfo : currentId = "+e+" destinations = "+t),!e&&!t){const e=new Error("set routing failure - missing para");throw this.logger.error("[TelephonyServiceSipWise] putUserRoutingInfo anomaly: missing para"),e}const i={};if(e){const t=this.routingData.devicesList.find((t=>t.deviceId===e));if(!t){const e=new Error("Anomaly putUserRoutingInfo - current device not found");throw this.logger.error("[TelephonyServiceSipWise] putUserRoutingInfo anomaly - current device not found"),e}if(this.logger.info("[TelephonyServiceSipWise] putUserRoutingInfo found device with state : "+t.state),"inService"!==t.state){const e=new Error("Anomaly putUserRoutingInfo - current device outOfService");throw this.logger.error("[TelephonyServiceSipWise] putUserRoutingInfo anomaly - current device outOfService"),e}i.currentDeviceId=e}if(t&&t.length>=1)i.destinations=t;else{const t=this.setRingingDevice(e);t&&t.length>=1&&(i.destinations=t)}const r=new URL(this.portalURL+"routing"),n=this.authService.getPostHeader(),s=JSON.stringify(i);this.logger.info("[TelephonyServiceSipWise] putUserRoutingInfo PUT "+r),this.logger.info("[TelephonyServiceSipWise] putUserRoutingInfo data: "+s);const o=await fetch(r.toString(),{method:"PUT",headers:n,body:s});if(!o.ok)throw o;this.logger.info("[TelephonyServiceSipWise] putUserRoutingInfo success "),e&&this.setCurrentDevice(e),this.patchNomadicData(),this.eventService.publish("ON_SIPWISE_ROUTING_EVENT",this.getCurrentDevice().type,this.routingData)}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"putUserRoutingInfo");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async getUserRoutingInfo(){try{if(this.logger.info("[TelephonyServiceSipWise] getUserRoutingInfo"),this.routingData.devicesList.length<1)return void this.logger.info("[TelephonyServiceSipWise] getUserRoutingInfo : sipWise devices not yet avalaible");const e=new URL(this.portalURL+"routing"),t=this.authService.getRequestHeader();this.logger.info("[TelephonyServiceSipWise] routing GET "+e);const i=await fetch(e.toString(),{method:"GET",headers:t});if(!i.ok)throw i;const r=(await i.json()).data;this.logger.info("[TelephonyServiceSipWise] getUserRoutingInfo success / status : "+i.statusText);const n=r.currentDeviceId,s=r.destinations;if(!n){const e=new Error("Anomaly getUserRoutingInfo - no current device");throw this.logger.error("[TelephonyServiceSipWise] [TEL] getUserRoutingInfo anomaly - no current device"),e}{const e=this.routingData.devicesList.find((e=>e.deviceId===n));if(!e){const e=new Error("Anomaly getUserRoutingInfo - current device not found");throw this.logger.error("[TelephonyServiceSipWise] [TEL] getUserRoutingInfo anomaly - current not found"),e}if("outOfService"===e.state){const e=new Error("Anomaly getUserRoutingInfo - current device outOfService");throw this.logger.error("[TelephonyServiceSipWise] [TEL] getUserRoutingInfo anomaly - current device outOfService"),e}if(this.logger.info("[TelephonyServiceSipWise] [TEL] getUserRoutingInfo current : "+n+" type = "+e.type),!this.setCurrentDevice(n))throw new Error("Anomaly getUserRoutingInfo - setCurrentDevice error")}if(!s){const e=new Error("Anomaly getUserRoutingInfo - no destination");throw this.logger.error("[TelephonyServiceSipWise] getUserRoutingInfo anomaly - no destination "),e}this.routingData.ringingDestinations=s,this.logger.info("[TelephonyServiceSipWise] getUserRoutingInfo  / ringing destinations nb  = "+s.length),this.routingData.alsoOfficePhoneRingEnabled=-1!==this.routingData.ringingDestinations.findIndex((e=>"sip"===e.type)),this.patchNomadicData(),this.eventService.publish("ON_SIPWISE_ROUTING_EVENT",this.getCurrentDevice().type,this.routingData)}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getUserRoutingInfo");throw this.logger.error("[TelephonyServiceSipWise] "+t.message),t.error}}patchNomadicData(){const e=this.getCurrentDevice();this.logger.info("[TelephonyServiceSipWise] patchNomadicData current type =  "+e.type),e&&"webrtc"===e.type?(this.telephonyService.nomadicObject.destination=this.webrtcGatewayService.getMyMediaPillarRemoteExtension(),this.webrtcGatewayService.isMediaPillarAvailable()?(this.telephonyService.nomadicObject.featureActivated=true,this.telephonyService.nomadicObject.modeActivated=true,this.telephonyService.nomadicObject.makeCallInitiatorIsMain=false):(this.telephonyService.nomadicObject.featureActivated=true,this.telephonyService.nomadicObject.modeActivated=false,this.telephonyService.nomadicObject.makeCallInitiatorIsMain=false)):(this.telephonyService.nomadicObject={},this.telephonyService.nomadicObject.destination="",this.telephonyService.nomadicObject.featureActivated=true,this.telephonyService.nomadicObject.modeActivated=false,this.telephonyService.nomadicObject.makeCallInitiatorIsMain=true),this.logger.info("[TelephonyServiceSipWise] patchNomadicData nomadicObject (desti/modeAct/CallIsMain) = "+this.telephonyService.nomadicObject.destination+"/"+this.telephonyService.nomadicObject.modeActivated+"/"+this.telephonyService.nomadicObject.makeCallInitiatorIsMain),this.eventService.publish("ON_CALL_NOMADIC_EVENT",this.telephonyService.nomadicObject)}async getUserDevices(){try{this.logger.info("[TelephonyServiceSipWise] getUserDevices");const e=new URL(this.portalURL+"devices"),t=this.authService.getRequestHeader();this.logger.info("[TelephonyServiceSipWise] devices GET "+e);const i=await fetch(e.toString(),{method:"GET",headers:t});if(!i.ok)throw i;const r=await i.json();if(this.logger.info("[TelephonyServiceSipWise] getUserDevices success / status : "+i.statusText),r.forEach((e=>{const t={type:e.type,id:e.id,deviceId:e.deviceId,jid_wrg:"",extension:"",state:"",main:false};"webrtc"===e.type?(t.main=false,t.jid_wrg=e.jid_wrg,this.routingData.devicesList.unshift(t)):this.routingData.devicesList.push(t),e.monolineIncomingMode&&(this.logger.info("[TelephonyServiceSipWise] [TEL] getUserDevices -- monolineIncomingMode is activated"),this.monolineIncomingMode=true),this.logger.info("[TelephonyServiceSipWise] [TEL] getUserDevices : deviceId = "+e.deviceId+" type = "+e.type)})),!(this.routingData.devicesList.length>=1)){const e=new Error("Anomaly getUserDevices - no device");throw this.logger.error("[TelephonyServiceSipWise] getUserDevices anomaly - no device"),e}this.logger.info("[TelephonyServiceSipWise] [TEL] getUserDevices  : "+this.routingData.devicesList.length+" device(s)"),"webrtc"!==this.routingData.devicesList[0].type&&this.logger.error("[TelephonyServiceSipWise] getUserDevices anomaly - no webrtc device")}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"devices");throw this.logger.error("[TelephonyServiceSipWise] "+t.message),t.error}}async getCliOptionsCurrent(){try{this.logger.info("[TelephonyServiceSipWise] getCliOptionsCurrent");const e=new URL(this.portalURL+"cli-options/current"),t=this.authService.getRequestHeader();this.logger.info("[TelephonyServiceSipWise] getCliOptionsCurrent GET "+e);const i=await fetch(e.toString(),{method:"GET",headers:t});if(!i.ok)throw i;const r=(await i.json()).data;this.logger.info("[TelephonyServiceSipWise] getCliOptionsCurrent success / status : "+i.statusText);return d.CliOption.createRoutineFromData(r)}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getCliOptionsCurrent");throw this.logger.error("[TelephonyServiceSipWise] "+t.message),t.error}}async getCliOptionsAll(){try{this.logger.info("[TelephonyServiceSipWise] getCliOptionsAll");const e=new URL(this.portalURL+"cli-options"),t=this.authService.getRequestHeader();this.logger.info("[TelephonyServiceSipWise] getCliOptionsAll GET "+e);const i=await fetch(e.toString(),{method:"GET",headers:t});if(!i.ok)throw i;const r=(await i.json()).data;this.logger.info("[TelephonyServiceSipWise] getCliOptionsAll success / status : "+i.statusText);const n=[];return r.forEach((e=>{n.push(d.CliOption.createRoutineFromData(e))})),n}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getCliOptionsAll");throw this.logger.error("[TelephonyServiceSipWise] "+t.message),t.error}}async setCliOption(e){if(!e||!e.policy){const e="wrong parameters",t=await this.errorHelperService.getErrorInfo(e,"setCliOption");throw this.logger.error("[TelephonyServiceSipWise] "+t.message),t.error}try{const t=this.authService.getPostHeader(),i="PUT",r=this.portalURL+"cli-options";this.logger.info("[TelephonyServiceSipWise] Set cli-options "+i+" "+r);const n=JSON.stringify(e),s=await fetch(r,{method:i,headers:t,body:n});if(!s.ok)throw s;const o=(await s.json()).data;return this.logger.debug("[TelephonyServiceSipWise] Set cli-options -- SUCCESS -- "),o}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"cli-options");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async getClirOption(){try{const e=this.authService.getPostHeader(),t="GET",i=this.portalURL+"clir-options";this.logger.info("[TelephonyServiceSipWise] Get clir-options "+t+" "+i);const r=await fetch(i,{method:t,headers:e});if(!r.ok)throw r;const n=(await r.json()).data.anonymous;return this.logger.debug("[TelephonyServiceSipWise] Get clir-options -- SUCCESS -- "),n}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"clir-options");throw this.logger.error("[TelephonyServiceSipWise] "+t.message),t.error}}async setClirOption(e){try{const t=this.authService.getPostHeader(),i="PUT",r=this.portalURL+"clir-options";this.logger.info("[TelephonyServiceSipWise] Set clir-options "+i+" "+r);const n=JSON.stringify({anonymous:e}),s=await fetch(r,{method:i,headers:t,body:n});if(!s.ok)throw s;const o=(await s.json()).data;return this.logger.debug("[TelephonyServiceSipWise] Set clir-options -- SUCCESS -- "),o}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"clir-options");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async getUserGroups(){try{this.logger.info("[TelephonyServiceSipWise] getUserGroups");const e=new URL(this.portalURL+"groups"),t=this.authService.getRequestHeader();this.logger.info("[TelephonyServiceSipWise] groups GET "+e);const i=await fetch(e.toString(),{method:"GET",headers:t});if(!i.ok)throw i;const r=(await i.json()).data;this.logger.info("[TelephonyServiceSipWise] getUserGroups success / status : "+i.statusText),this.telephonyService.sipWiseUserGroupsDataClear(),r.length>0&&(this.telephonyService.sipWiseUserGroupsData.myMemberId=this.contactService.userContact.dbId,r.forEach((e=>{this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.push(e);const t="hunting_group"===e.type&&"manager_assistant"===e.subType,i="hunting_group"===e.type&&"hg_attendant"===e.subType;if(("hunting_group"!==e.type||t||i)&&"call_queue"!==e.type||this.telephonyService.sipWiseUserGroupsData.huntingGroupNb++,t){this.telephonyService.sipWiseUserGroupsData.isSomeMngAssistAsHG=true;e.members.find((e=>"leader"===e.roles[0]))?e.members[0].memberId===this.contactService.userContact.dbId?e.members.forEach((e=>{"assistant"===e.roles[0]&&this.telephonyService.sipWiseUserGroupsData.managerAssistantMyAssistList.push({id:e.memberId,status:e.status})})):this.telephonyService.sipWiseUserGroupsData.managerAssistantMyMngList.push({id:e.members[0].memberId,status:e.members[0].status}):this.logger.info("[TelephonyServiceSipWise] getUserGroups for groupId : "+e.id+" Anomaly not 1 only manager in 1st pos")}else if("manager_assistant"===e.type)if(this.telephonyService.sipWiseUserGroupsData.managerAssistantNb++,1===this.telephonyService.sipWiseUserGroupsData.managerAssistantNb){const t=e.members.find((e=>"manager"===e.roles[0]));t?(this.telephonyService.sipWiseUserGroupsData.managerAssistGrId=e.id,this.telephonyService.sipWiseUserGroupsData.managerId=t.memberId,this.telephonyService.sipWiseUserGroupsData.managerName=t.displayName,this.telephonyService.sipWiseUserGroupsData.managerStatus=t.status):this.logger.info("[TelephonyServiceSipWise] getUserGroups for groupId : "+e.id+" Anomaly not 1 only manager");const i=e.members.find((e=>"assistant"===e.roles[0]));i?(this.telephonyService.sipWiseUserGroupsData.assistantId=i.memberId,this.telephonyService.sipWiseUserGroupsData.assistantName=i.displayName,this.telephonyService.sipWiseUserGroupsData.assistantStatus=i.status):this.logger.info("[TelephonyServiceSipWise] getUserGroups for groupId : "+e.id+" Anomaly not 1 only assistant")}else this.logger.info("[TelephonyServiceSipWise] getUserGroups : Anomaly not a 1:1 mng/ass situation")}))),this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.length>=1?this.logger.info("[TelephonyServiceSipWise] getUserGroups  : "+this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.length+" user's group(s)"):this.logger.info("[TelephonyServiceSipWise] getUserGroups  : no group")}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getUserGroups");throw this.logger.error("[TelephonyServiceSipWise] "+t.message),t.error}}async joinGroup(e,t){try{this.logger.info("[TelephonyServiceSipWise] joinGroup for groupId : "+e+" leaderId:"+t);let i="",r=-1;if(e?0===this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.length?i="no group":(r=this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.findIndex((t=>t.id===e)),-1===r&&(i="group not found")):i="missing groupId",t){if(!this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.find((e=>"hunting_group"===e.type&&"manager_assistant"===e.subType&&e.members[0].memberId===t))){const e="sipwise joinGroup -- invalid leaderId";return void this.logger.error("[telephonyService] "+e)}}if(""!==i){const e=new Error("join group failure - "+i);throw this.logger.error("[TelephonyServiceSipWise] join group anomaly:"+i),e}let n="";t&&(n="?leaderId="+t);const s=new URL(this.portalURL+"groups/"+encodeURIComponent(e)+"/join"+n),o=this.authService.getPostHeader();this.logger.info("[TelephonyServiceSipWise] joinGroup POST "+s);const a=await fetch(s.toString(),{method:"POST",headers:o});if(!a.ok)throw a;const c=(await a.json()).data;this.logger.info("[TelephonyServiceSipWise] joinGroup success / status : "+a.statusText),r=this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.findIndex((e=>e.id===c.id)),-1!==r?this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.splice(r,1,c):this.logger.info("[TelephonyServiceSipWise] joinGroup  : anomaly group not present in local struct")}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"joinGroup");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async leaveGroup(e,t){try{this.logger.info("[TelephonyServiceSipWise] leaveGroup for groupId : "+e+" leaderId:"+t);let i="",r=-1;if(e?0===this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.length?i="no group":(r=this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.findIndex((t=>t.id===e)),-1===r&&(i="group not found")):i="missing groupId",t){if(!this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.find((e=>"hunting_group"===e.type&&"manager_assistant"===e.subType&&e.members[0].memberId===t))){const e="sipwise leaveGroup -- invalid leaderId";return void this.logger.error("[telephonyService] "+e)}}if(""!==i){const e=new Error("leave group failure - "+i);throw this.logger.error("[TelephonyServiceSipWise] leave Group anomaly:"+i),e}let n="";t&&(n="?leaderId="+t);const s=new URL(this.portalURL+"groups/"+encodeURIComponent(e)+"/leave"+n),o=this.authService.getPostHeader();this.logger.info("[TelephonyServiceSipWise] leave Group POST "+s);const a=await fetch(s.toString(),{method:"POST",headers:o});if(!a.ok)throw a;const c=(await a.json()).data;this.logger.info("[TelephonyServiceSipWise] leave group success / status : "+a.statusText),r=this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.findIndex((e=>e.id===c.id)),-1!==r?this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.splice(r,1,c):this.logger.info("[TelephonyServiceSipWise] leaveGroup  : anomaly group not present in local struct")}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"leaveGroup");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async joinAllGroups(e="default"){try{this.logger.info("[TelephonyServiceSipWise] joinAllGroups");let t="";if(0===this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.length&&(t="no group"),"default"!==e&&"manager_assistant"!==e&&"hg_attendant"!==e&&(t="wrong group subType"),""!==t){const e=new Error("joinAllGroups failure - "+t);throw this.logger.error("[TelephonyServiceSipWise] join all groups anomaly:"+t),e}let i="";"default"!==e&&(i="?subType="+e);const r=new URL(this.portalURL+"groups/join"+i),n=this.authService.getPostHeader();this.logger.info("[TelephonyServiceSipWise] joinAllGroups POST "+r);const s=await fetch(r.toString(),{method:"POST",headers:n});if(!s.ok)throw s;const o=(await s.json()).data;this.logger.info("[TelephonyServiceSipWise] joinAllGroups success / status : "+s.statusText),o.forEach((e=>{const t=this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.findIndex((t=>t.id===e.id));-1!==t?this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.splice(t,1,e):this.logger.info("[TelephonyServiceSipWise] joinAllGroups  : anomaly group not present in local struct")}))}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"joinAllGroups");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async leaveAllGroups(e="default"){try{this.logger.info("[TelephonyServiceSipWise] leaveAllGroups");let t="";if(0===this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.length&&(t="no group"),"default"!==e&&"manager_assistant"!==e&&"hg_attendant"!==e&&(t="wrong group subType"),""!==t){const e=new Error("leaveAllGroups failure - "+t);throw this.logger.error("[TelephonyServiceSipWise] leave all groups anomaly:"+t),e}let i="";"default"!==e&&(i="?subType="+e);const r=new URL(this.portalURL+"groups/leave"+i),n=this.authService.getPostHeader();this.logger.info("[TelephonyServiceSipWise] leaveAllGroups POST "+r);const s=await fetch(r.toString(),{method:"POST",headers:n});if(!s.ok)throw s;const o=(await s.json()).data;return this.logger.info("[TelephonyServiceSipWise] leaveAllGroups success / status : "+s.statusText),o.forEach((e=>{const t=this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.findIndex((t=>t.id===e.id));-1!==t?this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.splice(t,1,e):this.logger.info("[TelephonyServiceSipWise] leaveAllGroups  : anomaly group not present in local struct")})),s}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"leaveAllGroups");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async removeMemberFromGroup(e,t){try{this.logger.info("[TelephonyServiceSipWise] removeMemberFromGroup - groupId: "+e+" - memberId: "+t);const i=new URL(this.portalURL+"groups/"+encodeURIComponent(e)+"/members/"+encodeURIComponent(t)),r=this.authService.getPostHeader(),n=await fetch(i.toString(),{method:"DELETE",headers:r});if(!n.ok)throw n;this.logger.info("[TelephonyServiceSipWise] removeMemberFromGroup success / status : "+n.statusText)}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"removeMemberFromGroup");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async addMemberFromGroup(e,t){try{this.logger.info("[TelephonyServiceSipWise] addMemberFromGroup - groupId: "+e+" - memberId: "+t);const i=new URL(this.portalURL+"groups/"+encodeURIComponent(e)+"/members"),r=this.authService.getPostHeader(),n={memberId:t,status:"idle"},s=JSON.stringify(n),o=await fetch(i.toString(),{method:"POST",headers:r,body:s});if(!o.ok)throw o;this.logger.info("[TelephonyServiceSipWise] addMemberFromGroup success / status : "+o.statusText)}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"addMemberFromGroup");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async changeMemberRole(e,t,i,r){try{this.logger.info("[TelephonyServiceSipWise] changeMemberRole - groupId: "+e+" - memberId: "+t+" - isAgent: "+i.toString()+" - isManager: "+r.toString());const n=[],s=new URL(this.portalURL+"groups/"+encodeURIComponent(e)+"/members/"+encodeURIComponent(t)),o=this.authService.getPostHeader();i&&n.push("agent"),r&&n.push("manager");const a={roles:n},c=JSON.stringify(a),l=await fetch(s.toString(),{method:"PUT",headers:o,body:c});if(!l.ok)throw l;this.logger.info("[TelephonyServiceSipWise] DemoteMemberToAgent success / status : "+l.statusText)}catch(n){const e=await this.errorHelperService.getErrorInfo(n,"DemoteMemberToAgent");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async changeMemberStatus(e,t,i){try{const r=i?"idle":"active";this.logger.info("[TelephonyServiceSipWise] changeMemberStatus - groupId: "+e+" - memberId: "+t+" - status:"+r);const n=new URL(this.portalURL+"groups/"+encodeURIComponent(e)+"/members/"+encodeURIComponent(t)),s=this.authService.getPostHeader(),o={status:r},a=JSON.stringify(o),c=await fetch(n.toString(),{method:"PUT",headers:s,body:a});if(!c.ok)throw c;this.logger.info("[TelephonyServiceSipWise] PromoteMemberToManager success / status : "+c.statusText)}catch(r){const e=await this.errorHelperService.getErrorInfo(r,"PromoteMemberToManager");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async setUserGroupForward(e,t,i){try{this.logger.info("[TelephonyServiceSipWise] setUserGroupForward for groupId : "+e);let r="";if(e?0===this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.length&&(r="invalid groupId"):r="missing groupId",""!==r){const e=new Error("set group forward failure - "+r);throw this.logger.error("[TelephonyServiceSipWise] set group forward anomaly:"+r),e}const n=new URL(this.portalURL+"groups/"+encodeURIComponent(e)+"/forwards/"+encodeURIComponent(t)),s=this.authService.getPostHeader(),o=JSON.stringify(i);this.logger.info("[TelephonyServiceSipWise] setUserGroupForward PUT "+n),this.logger.info("[TelephonyServiceSipWise] setUserGroupForward data: "+o);const a=await fetch(n.toString(),{method:"PUT",headers:s,body:o});if(!a.ok)throw a;this.logger.info("[TelephonyServiceSipWise] setUserGroupForward success / status : "+a.statusText)}catch(r){const e=await this.errorHelperService.getErrorInfo(r,"setUserGroupForward");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async getUserGroupForwards(e){try{this.logger.info("[TelephonyServiceSipWise] getUserGroupForwards for groupId : "+e);let t="";if(e?0===this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.length&&(t="invalid groupId"):t="missing groupId",""!==t){const e=new Error("get group forward failure - "+t);throw this.logger.error("[TelephonyServiceSipWise] get group forward anomaly:"+t),e}const i=new URL(this.portalURL+"groups/"+encodeURIComponent(e)+"/forwards"),r=this.authService.getRequestHeader();this.logger.info("[TelephonyServiceSipWise] getUserGroupForwards GET "+i);const n=await fetch(i.toString(),{method:"GET",headers:r});if(!n.ok)throw n;const s=(await n.json()).data,o=this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.find((t=>t.id===e));if(o.name!==s.name){this.logger.info("[TelephonyServiceSipWise] getUserGroupForwards Anomaly group name : "+o.name+" VS "+s.name);const e=await this.errorHelperService.getErrorInfo(n,"getUserGroupForwards");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}if(o.forwardData=s,e===this.telephonyService.sipWiseUserGroupsData.managerAssistGrId)if(this.telephonyService.sipWiseUserGroupsData.managerAssistantNb>1)this.logger.info("[TelephonyServiceSipWise] getUserGroupForwards : Anomaly not a 1:1 mng/ass situation");else{let e="unknown";const t=s.members.find((e=>e.memberId===this.telephonyService.sipWiseUserGroupsData.managerId));if(t&&t.displayName===this.telephonyService.sipWiseUserGroupsData.managerName){const i=t.forwards.find((e=>"immediate"===e.type));e=i&&i.activate&&"managersecretary"===i.destinationType?"activated":"unactivated"}else this.logger.info("[TelephonyServiceSipWise] getUserGroupForwards : Anomaly manager forward status");this.telephonyService.sipWiseUserGroupsData.managerForward=e}return this.logger.info("[TelephonyServiceSipWise] getUserGroupForwards success / status : "+n.statusText),o}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getUserGroupForwards");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async getAllUserGroupsForwards(){this.logger.info("[TelephonyServiceSipWise] getAllUserGroupsForwards");const e=[];if(0!==this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.length)if(this.telephonyService.sipWiseUserGroupsData.sipWiseUserGroupsList.forEach((t=>{"manager_assistant"===t.type&&e.push(this.getUserGroupForwards(t.id))})),0!==e.length)try{await Promise.all(e),this.logger.info("[TelephonyServiceSipWise] getAllUserGroupsForwards -- group forward completed -- "+e.length+" group(s) forward updated")}catch(t){throw this.logger.error("[TelephonyServiceSipWise] getAllUserGroupsForwards -- group forward failure -- "+t.message),t}else this.logger.info("[TelephonyServiceSipWise] getAllUserGroupsForwards / no manager assistant group");else this.logger.info("[TelephonyServiceSipWise] getAllUserGroupsForwards / no group")}async getAllUserGroupsPhoneNumberDDI(e=false){try{this.logger.info("[TelephonyServiceSipWise] getAllUserGroupsPhoneNumberDDI");const t=new URL(this.portalURL+"phone-numbers/ddi");t.searchParams.set("isAssignedToUser",e?"true":"false");const i=this.authService.getRequestHeader();this.logger.info("[TelephonyServiceSipWise] getAllUserGroupsPhoneNumberDDI GET "+t);const r=await fetch(t.toString(),{method:"GET",headers:i});if(!r.ok)throw r;const n=await r.json();return n.data}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"getAllUserGroupsPhoneNumberDDI");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async updateHuntingGroup(e,t){try{this.logger.info("[TelephonyServiceSipWise] updateHuntingGroup: "+e);const i=new URL(this.portalURL+"groups/"+encodeURIComponent(e)),r=this.authService.getPostHeader(),n={externalNumberId:t},s=JSON.stringify(n);this.logger.info("[TelephonyServiceSipWise] updateHuntingGroup PUT "+i);const o=await fetch(i.toString(),{method:"PUT",headers:r,body:s});if(!o.ok)throw o;return void this.logger.info("[TelephonyServiceSipWise] updateHuntingGroup success")}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"updateHuntingGroup");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async searchHuntingGroups(e,t=20){try{if(this.logger.info("[TelephonyServiceSipWise] searchHuntingGroups: "+e),!this.telephonyService||!this.telephonyService.isSipWise())return this.logger.debug("[TelephonyServiceSipWise] searchHuntingGroups -- Request ignored as SipWise telephony not running"),[];const i=new URL(this.portalURL+"search/huntinggroups");i.searchParams.set("name",e);const r=this.authService.getRequestHeader();this.logger.info("[TelephonyServiceSipWise] getUserGroupForwards GET "+i);const n=await fetch(i.toString(),{method:"GET",headers:r});if(!n.ok)throw n;const s=(await n.json()).data;this.logger.info("[TelephonyServiceSipWise] searchHuntingGroups success");const o=s.map((e=>{const t=this.contactService.createBasicContact(null,e.shortNumber,false);return t.updateName(null,e.name),t.phoneInternalNumber=e.shortNumber,t.phonePersoCan=e.externalNumber?e.externalNumber:"",t.dbId=e.id,t.getAvatar(),t}));return o.splice(t),o}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"searchHuntingGroups");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async getAutomatedAttendantsList(){try{this.logger.info("[TelephonyServiceSipWise] getAutomatedAttendantsList");const e=new URL(this.portalURL+"auto-attendants"),t=[],i=this.authService.getRequestHeader();this.logger.info("[TelephonyServiceSipWise] getAutomatedAttendantsList GET "+e);const r=await fetch(e.toString(),{method:"GET",headers:i});if(!r.ok)throw r;const n=(await r.json()).data;return this.logger.info("[TelephonyServiceSipWise] getAutomatedAttendantsList success"),n&&n.length>0&&n.forEach((e=>{t.push({id:e.id,label:e.name})})),t}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getAutomatedAttendantsList");throw this.logger.error("[TelephonyServiceSipWise] "+t.message),t.error}}async getSnapshot(e,t,i){try{this.logger.info("[TelephonyServiceSipWise] getSnapshot");const r=new URL(this.portalURL+"snapshot");e&&(this.logger.info("[TelephonyServiceSipWise] snapshot with callId "+e.id),r.searchParams.set("callId",e.id)),t&&(this.logger.info("[TelephonyServiceSipWise] snapshot with deviceId "+t),r.searchParams.set("deviceId",t)),i&&(this.logger.info("[TelephonyServiceSipWise] snapshot with seqNum "+i),r.searchParams.set("seqNum",i));const n=this.authService.getRequestHeader();this.logger.info("[TelephonyServiceSipWise] snapshot GET "+r.toString());const s=await fetch(r.toString(),{method:"GET",headers:n});if(!s.ok)throw s;const o=(await s.json()).data;return this.logger.info("[TelephonyServiceSipWise] getSnapshot success / status : "+s.statusText),o}catch(r){const e=await this.errorHelperService.getErrorInfo(r,"devices");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async processSnapshot(){try{this.logger.info("[TelephonyServiceSipWise] processSnapshot");const t=10,i=10;let r=0;const n=await this.getSnapshot();n&&n.devices?n.devices.forEach((e=>{this.routingData.devicesList.find((t=>t.deviceId===e.deviceId)).state=e.state,this.logger.info("[TelephonyServiceSipWise] processSnapshot / devicesId="+e.deviceId+"; state="+e.state),this.routingData.devicesList.find((t=>t.deviceId===e.deviceId)).state="inService"})):this.logger.error("[TelephonyServiceSipWise] processSnapshot / anomaly no device ");const s=[];if(!n||!n.calls)return void this.logger.info("[TelephonyServiceSipWise] processSnapshot / no call elt");if(n.calls.length>t)return void this.logger.error("[TelephonyServiceSipWise] processSnapshot / anomaly to much calls : "+n.calls.length);if(n.calls.forEach((e=>{"ringingIn"===e.legs[0].state&&(r++,r>=i&&this.logger.info("[TelephonyServiceSipWise] processSnapshot / anomaly to much ringingIn calls : "+r)),r<i&&s.push(this.createCallFromSnapShotCallsElt(e))})),0===s.length)return void this.logger.info("[TelephonyServiceSipWise] processSnapshot / anomaly no call created");try{await Promise.all(s),this.logger.info("[TelephonyServiceSipWise] processSnapshot -- calls creation completed -- "+s.length+" calls created")}catch(e){throw this.logger.error("[TelephonyServiceSipWise] processSnapshot -- calls creation failure -- "+e.message),e}}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"processSnapshot");throw this.logger.error("[TelephonyServiceSipWise] "+t.message),t.error}}async createCallFromSnapShotCallsElt(e){try{let t=null;this.logger.info("[TelephonyServiceSipWise] createCallFromSnapShotCallsElt - callId = "+e.callId);let i=null,r=null,n=null,s=null,o=null,a=null,c=null,l=null;if(!e.legs){const e="createCallFromSnapShotCallsElt -- Anomaly no leg";return void this.logger.error("[TelephonyServiceSipWise] "+e)}{const t=this.getCurrentDevice();if(null===t){const t="createCallFromSnapShotCallsElt -- Anomaly no current device";this.logger.error("[TelephonyServiceSipWise] "+t),i=e.legs[0]}else i=e.legs.find((e=>e.deviceId===t.id)),i||(i=e.legs[0]);r=i.legId?i.legId:null,n=i.deviceId?i.deviceId:null,s=this.telephonyService.telephonyEventHandler.convLegStateToCallStatus(i.state),this.logger.info("[TelephonyServiceSipWise] createCallFromSnapShotCallsElt - legId = "+r+" deviceId = "+n+" leg_state = "+i.state)}if(!e.endpoints)return void this.logger.info("[TelephonyServiceSipWise] createCallFromSnapShotCallsElt -- No endPoint provided !");if(o=e.endpoints[0],a=o.phoneNumber,c=o.jid,l=o.displayName,c||a){const i=await this.contactService.getOrCreateContact(c,a);return c||i.displayName||(i.displayName=l,i.initials=l.charAt(0),i.getAvatar()),t=this.telephonyService.getOrCreateCallSipWise(s,e.callId,r,n,i),t.relevantEquipmentId=n,t.isSecondary=false,this.eventService.publish("ON_CALL_UPDATED_EVENT",t),t}const d="createCallFromSnapShotCallsElt -- Anomaly no jid no phoneNumber";return void this.logger.error("[TelephonyServiceSipWise] "+d)}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"createCallFromSnapShotCallsElt");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async forwardToDevice(e,t,i,r){try{if(this.logger.info("[TelephonyServiceSipWise] forwardToDevice : phoneNumber = "+e+" / destType = "+t+" / fwtype = "+i),!e){const e=new Error("forward failure - missing phoneNumber");throw this.logger.error("[TelephonyServiceSipWise] forward anomaly: missing phoneNumber"),e}const n=new URL(this.portalURL+"forwards/"+encodeURIComponent(i));r&&n.searchParams.set("userId",r);const s=this.authService.getPostHeader(),o={number:e,destinationType:t,activate:true},a=JSON.stringify(o);this.logger.info("[TelephonyServiceSipWise] forwardToDevice PUT "+n),this.logger.info("[TelephonyServiceSipWise] forwardToDevice data: "+a);const c=await fetch(n.toString(),{method:"PUT",headers:s,body:a});if(!c.ok)throw c;await c.json(),this.logger.info("[TelephonyServiceSipWise] forwardToDevice success")}catch(n){const e=await this.errorHelperService.getErrorInfo(n,"forwardToDevice");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async cancelForward(e,t){try{if(this.logger.info("[TelephonyServiceSipWise] cancelForward :  fwtype = "+e),!e||"immediate"!==e&&"busy"!==e&&"noreply"!==e){const e=new Error("cancel forward failure - wrong forwardType");throw this.logger.error("[TelephonyServiceSipWise] cancel forward anomaly: wrong forwardType"),e}const i=new URL(this.portalURL+"forwards/"+encodeURIComponent(e));t&&i.searchParams.set("userId",t);const r=this.authService.getPostHeader(),n={activate:false},s=JSON.stringify(n);this.logger.info("[TelephonyServiceSipWise] cancelForward PUT "+i),this.logger.info("[TelephonyServiceSipWise] cancelForward data: "+s);const o=await fetch(i.toString(),{method:"PUT",headers:r,body:s});if(!o.ok)throw o;await o.json(),this.logger.info("[TelephonyServiceSipWise] cancelForward success")}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"cancelForward");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async getForwardStatus(){try{this.logger.info("[TelephonyServiceSipWise] getForwardStatus");const e=new URL(this.portalURL+"forwards"),t=this.authService.getRequestHeader();this.logger.info("[TelephonyServiceSipWise] forwards GET "+e.toString());const i=await fetch(e.toString(),{method:"GET",headers:t});if(!i.ok)throw i;const r=(await i.json()).data;if(r){this.logger.info("[TelephonyServiceSipWise] getForwardStatus success");const e=this.convForwardObject(r);return this.logger.info("[TelephonyServiceSipWise] [TEL] getForwardStatus immediat fwdtype = "+e.immediate.forwardType+" immediat forwardTo = "+e.immediate.forwardTo),e.busy&&this.logger.info("[TelephonyServiceSipWise] [TEL] getForwardStatus busy activate = "+e.busy.activate),e.noreply&&this.logger.info("[TelephonyServiceSipWise] [TEL] getForwardStatus noreply activate = "+e.noreply.activate),this.eventService.publish("ON_CALL_FORWARDED_EVENT",{forwardType:e.immediate.forwardType,forwardTo:e.immediate.forwardTo,pbxForwardType:"immediate"}),this.telephonyService.forwardObject.forwardType=e.immediate.forwardType,this.telephonyService.forwardObject.forwardTo=e.immediate.forwardTo,this.telephonyService.forwardObject.pbxForwardType="immediate",void((e.busy||e.noreply)&&(this.eventService.publish("ON_CALL_FORWARDED_CONDI_EVENT",{busy:e.busy,noreply:e.noreply}),this.telephonyService.forwardObject.busy=e.busy,this.telephonyService.forwardObject.noreply=e.noreply))}const n=new Error("getForwardStatus failure - invalide response");throw this.logger.error("[TelephonyServiceSipWise] getForwardStatus anomaly: invalide response"),n}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getForwardStatus");throw this.logger.error("[TelephonyServiceSipWise] "+t.message),t.error}}convForwardObject(e){const t={immediate:{forwardType:"Desactivation",forwardTo:""},busy:{},noreply:{},manAssist:{}};return e.forEach((e=>{"immediate"===e.type?(e.activate&&("voicemail"===e.destinationType?(t.immediate.forwardType="Activation",t.immediate.forwardTo="VOICEMAILBOX"):""!==e.number&&(t.immediate.forwardType="Activation",t.immediate.forwardTo=e.number)),"managersecretary"===e.destinationType&&(t.immediate.forwardType=e.activate,t.immediate.forwardTo="MANAGERASSISTANT",t.manAssist=e)):"busy"===e.type?t.busy=e:"noreply"===e.type&&(t.noreply=e)})),t}async getOverFlowStatus(e,t){try{this.logger.info("[TelephonyServiceSipWise] getOverFlowStatus : systemId = "+e+" / phoneNumberId = "+t);const i=new URL(this.portalAdminURL+"cloudpbxs/"+encodeURIComponent(e)+"/subscribers/"+encodeURIComponent(t)+"/overflow/status"),r=this.authService.getRequestHeader();this.logger.info("[TelephonyServiceSipWise] getOverFlowStatus GET "+i.toString());const n=await fetch(i.toString(),{method:"GET",headers:r});if(!n.ok)throw n;const s=(await n.json()).data;return this.logger.info("[TelephonyServiceSipWise] getOverFlowStatus activated: "+s.activate),s}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"getOverFlowStatus");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}getSettings(){return this.settings}async initializeSettings(){this.logger.info("[TelephonyServiceSipWise] initializeSettings");try{const e=new URL(this.portalURL+"settings"),t=this.authService.getRequestHeader();this.logger.info("[TelephonyServiceSipWise] initializeSettings GET "+e);const i=await fetch(e.toString(),{method:"GET",headers:t});if(!i.ok)throw i;const r=(await i.json()).data;return this.settings=r,this.logger.info("[TelephonyServiceSipWise] initializeSettings success / status : "+i.statusText+" - emulatedRingBackTone : "+r.emulatedRingBackTone),r}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"initializeSettings");throw this.logger.error("[TelephonyServiceSipWise] "+t.message),t.error}}emergencyCallDataClear(){this.emergencyCallData={WGEmergencyCallForbidden:false,emergencyNuList:[],serverData:null}}checkEmergencyNumber(e){return this.emergencyCallData&&this.emergencyCallData.emergencyNuList.includes(e)}async getEmergencyCallData(){try{const e=new URL(this.portalURL+"emergency-numbers"),t=this.authService.getRequestHeader();this.logger.info("[TelephonyServiceSipWise] getEmergencyCallData GET "+e);const i=await fetch(e.toString(),{method:"GET",headers:t});if(!i.ok)throw i;const r=(await i.json()).data;this.logger.info("[TelephonyServiceSipWise] getEmergencyCallDataSipWise success / status : "+i.statusText),this.logger.info("[TelephonyServiceSipWise] getEmergencyCallDataSipWise success / callAuthorizationWithSoftPhone  : "+r.emergencyOptions.callAuthorizationWithSoftPhone),this.logger.info("[TelephonyServiceSipWise] getEmergencyCallDataSipWise success / nb of emergency Nu : "+r.emergencyNumbers.length),this.emergencyCallDataClear(),this.emergencyCallData.WGEmergencyCallForbidden=!r.emergencyOptions.callAuthorizationWithSoftPhone,this.emergencyCallData.serverData=r.emergencyNumbers,r.emergencyNumbers&&r.emergencyNumbers.length>0&&r.emergencyNumbers.forEach((e=>{this.emergencyCallData.emergencyNuList.push(e.number)})),"testemergency"===this.telephonyService.sipWiseMode()&&(this.emergencyCallData.WGEmergencyCallForbidden=true,this.emergencyCallData.emergencyNuList.push("3669"))}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"getEmergencyCallData");throw this.logger.error("[TelephonyServiceSipWise] "+t.message),t.error}}async makeSimpleCall(e,t,i){try{if(this.logger.info("[TelephonyServiceSipWise] [TEL] makeSimpleCall to "+(e?e.nameForLogs:u.default(t))),!this.telephonyService.isBasicCallAllowed){const e=new Error("makeSimpleCallSipWise failure - Not Allowed");throw e.status=e.errorDetailsCode="403",this.logger.error("[TelephonyServiceSipWise] [TEL] "+e.message),this.telephonyService.makingCall=false,e}const r=this.telephonyService.getPhoneInfo(e,t),n=this.getCurrentDevice(),s=n?n.deviceId:"";if((this.emergencyCallData.WGEmergencyCallForbidden&&n&&"webrtc"===n.type||"testemergency"===this.telephonyService.sipWiseMode())&&this.checkEmergencyNumber(t))throw this.logger.info("[TelephonyServiceSipWise] [TEL] makeVOIPSipemergencyCall - Not Allowed for num : "+t),this.telephonyService.rxSubject.next({name:"ON_EMERGENCYCALL_VOIPSIP_NOTALLOWED_EVENT",data:t}),this.telephonyService.makingCall=false,new Error;const o=this.portalURL+"calls",a=this.authService.getPostHeader(),c={deviceId:s,calleeExtNumber:r.longNumber,calleeShortNumber:r.shortNumber,calleePbxId:r.pbxId,callerAutoAnswer:true};i&&(c.calledNumber=i);const d=JSON.stringify(c);this.logger.info("[TelephonyServiceSipWise] makeSimpleCall POST "+o),this.logger.info("[TelephonyServiceSipWise] makeSimpleCall data: "+d);const h=await fetch(o,{method:"POST",headers:a,body:d});if(!h.ok)throw h;const f=await h.json(),p=f.data.callId;if(this.logger.info("[TelephonyServiceSipWise] [TEL] makeSimpleCall - success : callee "+u.default(t)+" / callId = "+p),!p||""===p){const t=l.Call.create(l.Call.Status.ERROR,null,l.Call.Type.PHONE,e);t.errorMessage="unexpectedError",this.telephonyService.calls[t.contact.id]=t,t.autoClear=setTimeout((()=>{this.telephonyService.clearCall(t)}),5e3),this.telephonyService.makingCall=false,this.eventService.publish("ON_CALL_UPDATED_EVENT",t);const i=await this.errorHelperService.getErrorInfo(h,"makeCall");throw this.logger.error("[TelephonyServiceSipWise] "+i.message),i.error}const g=this.telephonyService.getOrCreateCallSipWise(l.Call.Status.DIALING,p,null,null,e);return g.setRelevantEquipmentId(g.getDeviceIdSipWise()),g.isOwner=true,this.logger.info("[TelephonyServiceSipWise] makeSimpleCall Call created ("+g+")"),g.setIsVm(t===this.telephonyService.voicemailNumber),g.autoClear=setTimeout((()=>{this.logger.info("[TelephonyServiceSipWise] keepAlive CallReset ("+g+")"),this.telephonyService.clearCall(g)}),1e4),this.eventService.publish("ON_CALL_UPDATED_EVENT",g),g.id}catch(r){const t=await this.errorHelperService.getErrorInfo(r,"makeCall");this.logger.error("[TelephonyServiceSipWise] [TEL] "+t.message);const i=l.Call.create(l.Call.Status.ERROR,null,l.Call.Type.PHONE,e);throw i.errorMessage="403"===t.error.errorDetailsCode?"notAllowed":"invalidPhoneNumber",this.telephonyService.calls[i.contact.id]=i,i.autoClear=setTimeout((()=>{this.telephonyService.clearCall(i)}),5e3),i.publish("ON_CALL_UPDATED_EVENT"),this.eventService.publish("ON_CALL_UPDATED_EVENT",i),t.error}finally{this.telephonyService.makingCall=false}}async releaseCall(e){try{this.logger.info("[TelephonyServiceSipWise] [TEL] releaseCall "+e.id);const t=this.portalURL+"calls/"+encodeURIComponent(e.id),i=this.authService.getPostHeader(),r={legId:e.connectionId?e.connectionId:""},n=JSON.stringify(r);this.logger.info("[TelephonyServiceSipWise] releaseCall DELETE "+t),this.logger.info("[TelephonyServiceSipWise] releaseCall data: "+n);const s=await fetch(t,{method:"DELETE",headers:i,body:n});if(!s.ok){const e=await this.errorHelperService.getErrorInfo(s,"releaseCall responseKo");throw this.logger.error("[TelephonyServiceSipWise] [TEL] "+e.message),s}return e.setStatus(l.Call.Status.UNKNOWN),e.startDate=null,e.setIsVm(false),this.logger.info("[TelephonyServiceSipWise] [TEL] releaseCall "+e.id+" - success"),this.eventService.publish("ON_CALL_UPDATED_EVENT",e),delete this.telephonyService.calls[e.id],e}catch(t){const i=await this.errorHelperService.getErrorInfo(t,"releaseCall");throw this.logger.error("[TelephonyServiceSipWise] [TEL] "+i.message),this.deleteCallIfInvalid(i.error,e),i.error}}deleteCallIfInvalid(e,t){e&&"voice"===e.portal&&404201===e.errorDetailsCode&&"Specified leg not found"===e.errorDetails&&t&&(this.logger.warn("[TelephonyServiceSipWise] deleteCallIfInvalid: delete client call non existing on server: "+t.id),t.setStatus(l.Call.Status.UNKNOWN),this.eventService.publish("ON_CALL_UPDATED_EVENT",t),this.telephonyService.calls[t.id]&&delete this.telephonyService.calls[t.id])}async answerCall(e){try{this.logger.info("[TelephonyServiceSipWise] answerCall : "+e.id);const t=new URL(this.portalURL+"calls/"+encodeURIComponent(e.id)+"/answer"),i=this.authService.getPostHeader(),r={legId:e.connectionId},n=JSON.stringify(r);this.logger.info("[TelephonyServiceSipWise] answerCall POST "+t),this.logger.info("[TelephonyServiceSipWise] answerCall data: "+n);const s=await fetch(t.toString(),{method:"POST",headers:i,body:n});if(!s.ok)throw s;return e.setStatus(l.Call.Status.ACTIVE),this.logger.info("[TelephonyServiceSipWise] answerCall success : "+u.default(e.contact.phone)+" Call ("+e+")"),this.eventService.publish("ON_CALL_UPDATED_EVENT",e),e}catch(t){const i=await this.errorHelperService.getErrorInfo(t,"answerCall");throw this.logger.error("[TelephonyServiceSipWise] [TEL] "+i.message),this.logger.info("[TelephonyServiceSipWise] answerCall fail : error = "+i.error.errorCode+" msg = "+i.error.errorMsg+" details = "+i.error.errorDetails),i.error&&"Device is not able to answer a call"===i.error.errorDetails&&this.mainService.showGlobalPopupMessage({autoClose:false,okLabel:"close",popupTitle:"warning",popupBody:"deviceDoesntAllowAnswer"}),e.setStatus(l.Call.Status.UNKNOWN),i.error}}async holdCall(e){try{this.logger.info("[TelephonyServiceSipWise] holdCall : "+e.id);const t=new URL(this.portalURL+"calls/"+encodeURIComponent(e.id)+"/hold"),i=this.authService.getPostHeader(),r={legId:e.connectionId},n=JSON.stringify(r);this.logger.info("[TelephonyServiceSipWise] holdCall POST "+t),this.logger.info("[TelephonyServiceSipWise] holdCall data: "+n);const s=await fetch(t.toString(),{method:"POST",headers:i,body:n});if(!s.ok)throw s;return this.logger.info("[TelephonyServiceSipWise] holdCall success : "+u.default(e.contact.phone)+" Call ("+e+")"),e.setStatus(l.Call.Status.HOLD),this.eventService.publish("ON_CALL_UPDATED_EVENT",e),e}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"holdCall");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async retrieveCall(e){try{this.logger.info("[TelephonyServiceSipWise] retrieveCall : "+e.id);const t=new URL(this.portalURL+"calls/"+encodeURIComponent(e.id)+"/retrieve"),i=this.authService.getPostHeader(),r={legId:e.connectionId},n=JSON.stringify(r);this.logger.info("[TelephonyServiceSipWise] retrieveCall POST "+t),this.logger.info("[TelephonyServiceSipWise] retrieveCall data: "+n);const s=await fetch(t.toString(),{method:"POST",headers:i,body:n});if(!s.ok)throw s;return this.logger.info("[TelephonyServiceSipWise] retrieveCall success : "+u.default(e.contact.phone)+" Call ("+e+")"),e.setStatus(l.Call.Status.ACTIVE),this.eventService.publish("ON_CALL_UPDATED_EVENT",e),e}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"retrieveCall");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async deflectCall(e,t){try{if(this.logger.info("[TelephonyServiceSipWise] deflectCall : "+e.id+" to destination : "+t),!t){const e=new Error("deflect failure - no destination");throw this.logger.error("[TelephonyServiceSipWise] deflect anomaly: no destination"),e}const i=new URL(this.portalURL+"calls/"+encodeURIComponent(e.id)+"/deflect"),r=this.authService.getPostHeader(),n={destination:t},s=JSON.stringify(n);this.logger.info("[TelephonyServiceSipWise] deflectCall POST "+i),this.logger.info("[TelephonyServiceSipWise] deflectCall data: "+s);const o=await fetch(i.toString(),{method:"POST",headers:r,body:s});if(!o.ok)throw o;this.logger.info("[TelephonyServiceSipWise] deflectCall success :  Call ("+e+")")}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"deflectCall");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async transferCall(e,t){try{if(this.logger.info("[TelephonyServiceSipWise] transferCall : activeCall : "+e.id+" heldCall : "+t.id),!e||!t){const e=new Error("transfer failure - missing activeCall or heldCall");throw this.logger.error("[TelephonyServiceSipWise] transfer anomaly: missing calls ref"),e}const i=new URL(this.portalURL+"calls/"+encodeURIComponent(e.id)+"/transfer"),r=this.authService.getPostHeader(),n={heldCallId:t.id},s=JSON.stringify(n);this.logger.info("[TelephonyServiceSipWise] transferCall POST "+i),this.logger.info("[TelephonyServiceSipWise] transferCall data: "+s);const o=await fetch(i.toString(),{method:"POST",headers:r,body:s});if(!o.ok)throw o;this.logger.info("[TelephonyServiceSipWise] transferCall success : "+e.id+"->"+t.id)}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"deflectCall");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async blindTransferCall(e,t,i){try{if(this.logger.info("[TelephonyServiceSipWise] blindTransferCall : activeCall : "+e.id),!e||!t&&!i){const e=new Error("blind transfer failure - missing activeCall or callee number");throw this.logger.error("[TelephonyServiceSipWise] blind transfer anomaly: missing calls ref or callee number"),e}const r=new URL(this.portalURL+"calls/"+encodeURIComponent(e.id)+"/blind-transfer"),n=this.authService.getPostHeader(),s={destination:void 0};t?s.destination=t:i&&(s.destination=i);const o=JSON.stringify(s);this.logger.info("[TelephonyServiceSipWise] blindTransferCall POST "+r),this.logger.info("[TelephonyServiceSipWise] blindTransferCall data: "+o);const a=await fetch(r.toString(),{method:"POST",headers:n,body:o});if(!a.ok)throw a;this.logger.info("[TelephonyServiceSipWise] blindTransferCall success :  Call ("+e+")")}catch(r){const e=await this.errorHelperService.getErrorInfo(r,"blindTransferCall");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e&&e.error&&400995===e.error.errorDetailsCode&&this.mainService.showGlobalPopupMessage({autoClose:false,okLabel:"close",popupTitle:"warning",popupBody:"blindTransferNotPossibleForUser"}),e.error}}async transferRouting(e,t,i){if(this.logger.info("[TelephonyServiceSipWise] transfer-routing "),!e||!t&&!i){const e="wrong parameters",t=await this.errorHelperService.getErrorInfo(e,"transferRouting");throw this.logger.error("[telephonyBlindTransfer] "+t.message),t.error}try{const r=new URL(this.portalURL+"transfer-routing");r.searchParams.set("calleeId",e),t&&(this.logger.info("[TelephonyServiceSipWise] transferRouting with addresseeId "+t),r.searchParams.set("addresseeId",t)),i&&(this.logger.info("[TelephonyServiceSipWise] transferRouting with addresseePhoneNumber "+i),r.searchParams.set("addresseePhoneNumber",i));const n=this.authService.getRequestHeader();this.logger.info("[TelephonyServiceSipWise] transfer-routing GET "+r);const s=await fetch(r.toString(),{method:"GET",headers:n});if(!s.ok){this.logger.debug("[TelephonyServiceSipWise] transfer-routing -- FAIL -- ");return await this.errorHelperService.getErrorInfo(s,"transfer-routing")}const o=(await s.json()).data;return this.logger.debug("[TelephonyServiceSipWise] transfer-routing -- SUCCESS -- "),o}catch(r){const e=await this.errorHelperService.getErrorInfo(r,"transfer-routing");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async sendDtmf(e,t){try{this.logger.info("[TelephonyServiceSipWise] sendDtmf for callId : "+e.id+" dtmf : "+t);const i=new URL(this.portalURL+"calls/"+encodeURIComponent(e.id)+"/sendDtmf"),r=this.authService.getPostHeader(),n={legId:e.connectionId,digits:t},s=JSON.stringify(n);this.logger.info("[TelephonyServiceSipWise] sendDtmf POST "+i),this.logger.info("[TelephonyServiceSipWise] sendDtmf data: "+s);const o=await fetch(i.toString(),{method:"POST",headers:r,body:s});if(!o.ok)throw o;this.logger.info("[TelephonyServiceSipWise] sendDtmf success :  Call ("+e+")"),this.eventService.publish("ON_DTMF_SENT",t)}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"sendDtmf");throw this.logger.error("[TelephonyServiceSipWise] "+e.message),e.error}}async sipWiseGetCliOption(){try{const e=this.authService.getPostHeader(),t="GET",i=this.portalURL+"cli-options";this.logger.info("[callRouting] Get cli-options "+t+" "+i);const r=await fetch(i,{method:t,headers:e});if(!r.ok)throw r;const n=(await r.json()).data;return this.logger.debug("[callRouting] Get cli-options -- SUCCESS -- "),n}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"cli-options");throw this.logger.error("[callRouting] "+t.message),t.error}}async sipWiseSetCliOption(e){if(!e||!e.policy){const e="wrong parameters",t=await this.errorHelperService.getErrorInfo(e,"sipWiseSetCliOption");throw this.logger.error("[callRouting] "+t.message),t.error}try{const t=this.authService.getPostHeader(),i="PUT",r=this.portalURL+"cli-options";this.logger.info("[callRouting] Set cli-options "+i+" "+r);const n=JSON.stringify(e),s=await fetch(r,{method:i,headers:t,body:n});if(!s.ok)throw s;const o=(await s.json()).data;return this.logger.debug("[callRouting] Set cli-options -- SUCCESS -- "),o}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"cli-options");throw this.logger.error("[callRouting] "+e.message),e.error}}async sipWiseGetClirOption(){try{const e=this.authService.getPostHeader(),t="GET",i=this.portalURL+"clir-options";this.logger.info("[callRouting] Get clir-options "+t+" "+i);const r=await fetch(i,{method:t,headers:e});if(!r.ok)throw r;const n=(await r.json()).data.anonymous;return this.logger.debug("[callRouting] Get clir-options -- SUCCESS -- "),n}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"clir-options");throw this.logger.error("[callRouting] "+t.message),t.error}}async sipWiseSetClirOption(e){try{const t=this.authService.getPostHeader(),i="PUT",r=this.portalURL+"clir-options";this.logger.info("[callRouting] Set clir-options "+i+" "+r);const n=JSON.stringify({anonymous:e}),s=await fetch(r,{method:i,headers:t,body:n});if(!s.ok)throw s;const o=(await s.json()).data;return this.logger.debug("[callRouting] Set clir-options -- SUCCESS -- "),o}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"clir-options");throw this.logger.error("[callRouting] "+e.message),e.error}}}t.TelephonyServiceSipWise=h},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{constructor(e,t,i,r,n,s,o){this.policy=e,this.companyPolicy=n,this.phoneNumberId=t,this.number=i,this.type=r,this.name=s,this.current=o}static createRoutineFromData(e){return new r(e.policy,e.phoneNumberId,e.number,e.type,e.companyPolicy,e.name,e.current)}}t.CliOption=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(9),n=i(4),s=i(6),o=i(11),a=i(14),c=i(307),l=i(19),d=i(105),u=i(28),h=i(65),f=i(106);class p{constructor(e){this.telephonyService=e,this.xmppService=r.XmppService.getInstance(),this.logger=n.LoggerService.getInstance(),this.contactService=s.ContactService.getInstance(),this.eventService=o.EventService.getInstance(),this.profileService=a.ProfileService.getInstance(),this.pgiConferenceService=c.PgiConferenceService.getInstance(),this.settingsService=l.SettingsService.getInstance(),this.messageHandlerRef=null,this.promiseQueue=d.PromiseQueue.create()}static create(e){return new p(e)}attachHandlers(){this.detachHandlers(),this.messageHandlerRef=this.xmppService.addHandler((e=>(this.onCallserviceMessageReceived(e),true)),p.CALLSERVICE_NS,"message",null)}detachHandlers(){this.messageHandlerRef&&(this.xmppService.deleteHandler(this.messageHandlerRef),this.messageHandlerRef=null)}onCallserviceMessageReceived(e){try{const t=$(e);if("Offline Storage"===t.find("delay").text())return true;const i=t.find("callservice").children(),r=i.prop("tagName").split(":"),n=r[r.length-1].toLowerCase(),s=i.attr("callId"),o=s?" -- "+s:"";let a=i.attr("deviceType");const c=a?" -- "+a:"";let l=i.attr("oldCallId");l=l?" -- old "+l:"",a||(a="MAIN");const d=this.telephonyService.getNomadicObject(),u=!d||(d.makeCallInitiatorIsMain||!d.modeActivated);let h=false,f=false;u||(f=this.telephonyService.isMediaPillarUserSelected(),h=this.telephonyService.isMediaPillarAvailable()&&this.telephonyService.isMediaPillarUserSelected());if(!["messaging","voicemessages","forwarded","nomadicstatus","opendesktop"].includes(n)&&("MAIN"===a&&!u||"SECONDARY"===a&&(u||!h&&f))&&!this.existingCall(s))return this.logger.info("[TelephonyHybridEventHandler] onCallserviceMessageReceived -- "+n.toUpperCase()+o+l+c+" => IGNORED"),true;switch(this.logger.info("[TelephonyHybridEventHandler] [TEL] onCallserviceMessageReceived -- "+n.toUpperCase()+o+l+c),n){case"initiated":this.promiseQueue.add((()=>this.onInitiatedEvent(i)));break;case"originated":this.promiseQueue.add((()=>this.onOriginatedEvent(i)));break;case"delivered":this.promiseQueue.add((()=>this.onDeliveredEvent(i)));break;case"queued":this.promiseQueue.add((()=>this.onQueuedEvent(i)));break;case"failed":this.promiseQueue.add((()=>this.onFailCallEvent(i)));break;case"updatecall":this.promiseQueue.add((()=>this.onUpdateCallEvent(i)));break;case"updateparty":this.promiseQueue.add((()=>this.onUpdatePartyEvent(i)));break;case"established":this.promiseQueue.add((()=>this.onEstablishedEvent(i)));break;case"holdcall":case"held":this.promiseQueue.add((()=>this.onHeldEvent(i)));break;case"retrievecall":this.promiseQueue.add((()=>this.onRetrieveCallEvent(i)));break;case"transfercall":case"transferred":this.promiseQueue.add((()=>this.onTransferEvent(i)));break;case"conferenced":this.promiseQueue.add((()=>this.onConferenceEvent(i)));break;case"diverted":this.promiseQueue.add((()=>this.onDivertedEvent(i)));break;case"callsubject":this.promiseQueue.add((()=>this.onCallSubjectEvent(i)));break;case"connectioncleared":this.promiseQueue.add((()=>this.onClearCallEvent(i)));break;case"forwarded":this.promiseQueue.add((()=>this.onCallForwardedEvent(i)));break;case"nomadicstatus":this.promiseQueue.add((()=>this.onCallNomadicEvent(i)));break;case"opendesktop":this.logger.info("[TelephonyHybridEventHandler] openDesktop detected ")}return true}catch(t){return this.logger.error("[TelephonyHybridEventHandler] onCallserviceMessageReceived -- failure -- "+t.message),true}}existingCall(e){const t=Boolean(this.telephonyService.calls[e]);return this.logger.debug("[TelephonyHybridEventHandler] existingCall -- "+e+" => "+t),t}async onInitiatedEvent(e){this.logger.info("[TelephonyHybridEventHandler] onInitiatedEvent");try{const t=await this.getCall(e,false,true),i=e.attr("deviceState"),r=e.attr("newCallId"),n=e.attr("cause"),s=e.attr("resource");if(void 0!==r){const n=await this.getOrCreateCall(r);this.logger.info("[TelephonyHybridEventHandler] onInitiatedEvent : changed call id from "+t.id+" to "+r),this.computeCallRelevancy(e,n),"LCI_CONNECTED"===i?n.setStatus(u.Call.Status.ACTIVE):n.setStatus(t.status),n.setContact(t.contact),n.isOwner=t.isOwner,n.direction="outgoing";const s=this.pgiConferenceService.getConferenceSessionWithConnId(t.connectionId);s&&(s.callId=r),t.isInExternalWindow&&this.eventService.publish("ON_REPLACE_CALLS_IN_EXTERNAL_POPOUT",n,t),t.isMediaPillarCall()&&this.eventService.publish("ON_REPLACE_CALLREFS_REQUEST",n,t),this.telephonyService.clearCall(t),this.sendCallUpdateEvent(t),this.sendCallUpdateEvent(n),delete this.telephonyService.calls[t.id]}else{this.computeCallRelevancy(e,t),t.direction="outgoing";const i="true"===this.settingsService.getSetting("autoAnswer").toString()&&"desktop"===this.settingsService.getSetting("autoAnswerByDeviceType").toString();if(this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_MAKE_CALL_CTI_APP)&&t.isSecondary&&!s&&!t.isOwner&&"MAKECALL"===n&&i&&this.contactService.isSingleComputerClient()&&(t.autoAnswer=true),this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_MAKE_CALL_CTI_APP)&&t.isSecondary&&!s&&!t.isOwner&&"MAKECALL"===n||"CALLBACK"===n){this.logger.info("[TelephonyHybridEventHandler] TELEPHONY_MAKE_CALL_CTI_APP - 3pcc activated");const i=await this.contactService.getOrCreateContact("","000");t.setContact(i),t.setStatus(u.Call.Status.RINGING_INCOMMING),t.lastCause=n||"",this.sendCallUpdateEvent(t,e)}else this.sendCallUpdateEvent(t)}}catch(t){const e="onInitiatedEvent -- "+t.message;throw this.logger.error("[TelephonyHybridEventHandler] "+e),new Error(e)}}async onOriginatedEvent(e){this.logger.info("[TelephonyHybridEventHandler] onOriginatedEvent");try{const t=await this.getCall(e,false,true),i=e.attr("endpointIm"),r=e.attr("endpointTel"),n=e.attr("newCallId"),s={contactPhoneNumber:"",contact:t.contact,participantsPhoneNumbers:null,participants:null};if(i||r?s.contactPhoneNumber=r||"":t.contact&&t.contact.temp&&(s.contactPhoneNumber=t.contact.id),t.setCurrentCalled(s),void 0!==n){const o=await this.getOrCreateCall(n,i,r);this.logger.info("[TelephonyHybridEventHandler] onOriginatedEvent : changed call id from "+t.id+" to "+n),this.computeCallRelevancy(e,o),o.setStatus(t.status),o.setContact(t.contact),o.setCurrentCalled(s),o.isOwner=t.isOwner,o.direction="outgoing";const a=this.pgiConferenceService.getConferenceSessionWithConnId(t.connectionId);a&&(a.callId=n),t.isInExternalWindow&&this.eventService.publish("ON_REPLACE_CALLS_IN_EXTERNAL_POPOUT",o,t),t.isMediaPillarCall()&&this.eventService.publish("ON_REPLACE_CALLREFS_REQUEST",o,t),this.telephonyService.clearCall(t),this.sendCallUpdateEvent(t),this.sendCallUpdateEvent(o),delete this.telephonyService.calls[t.id]}else this.computeCallRelevancy(e,t),t.direction="outgoing",t.setStatus(u.Call.Status.DIALING),this.sendCallUpdateEvent(t)}catch(t){const e="onOriginatedEvent -- "+t.message;throw this.logger.error("[TelephonyHybridEventHandler] "+e),new Error(e)}}async onDeliveredEvent(e){this.logger.info("[TelephonyHybridEventHandler] onDeliveredEvent");try{const t=await this.getCall(e);this.computeCallRelevancy(e,t);const i=e.attr("type"),r=e.attr("endpointIm"),n=e.attr("endpointTel"),s=e.attr("cause"),o=e.attr("correlatorData")||"",a=e.attr("correlatorDataHex")||"",c=e.attr("globalCallId")||"",l=e.find("party");if(l&&l.length&&(t.calledNumber=l.attr("number")||"",t.calledNumber)){t.calledRole=l.attr("role")||"",t.calledJID=l.attr("jid")||"";const e=l.attr("displayName")||"",i=l.attr("firstName")||"",r=l.attr("lastName")||"";t.calledDisplayName=e||t.calledDisplayName,t.calledFirstName=i||t.calledFirstName,t.calledLastName=r||t.calledLastName,t.calledFirstName||t.calledLastName?t.calledDisplayName=this.computeDisplayName(t.calledFirstName,t.calledLastName):t.calledDisplayName||(t.calledDisplayName=t.calledNumber)}t.setStatus("outgoing"===i?u.Call.Status.RINGING_OUTGOING:u.Call.Status.RINGING_INCOMMING),t.lastCause=s||"",t.correlatorData=o,t.globalCallId=c,t.correlatorDataHex=a,t.direction=i,t.callerNumber="outgoing"===i?this.contactService.userContact.phoneInternalNumber:n,this.logger.info(`[TelephonyHybridEventHandler] onDeliveredEvent id '${t.id}' direction '${t.direction}' endpointTel '${n}' callerNumber '${t.callerNumber}' calledNumber '${t.calledNumber}'`),await this.updateCallContact(r,n,e,t),this.computeRemoteNumber(r,n,t),this.sendCallUpdateEvent(t,e)}catch(t){const e="onDeliveredEvent -- "+t.message;throw this.logger.error("[TelephonyHybridEventHandler] "+e),new Error(e)}}async onQueuedEvent(e){this.logger.info("[TelephonyHybridEventHandler] onQueuedEvent");try{const t=e.attr("type"),i=e.attr("cause");if("PARK"===i)return void this.logger.warn("[TelephonyHybridEventHandler] onQueuedEvent -> ignore PARK cause");if("incoming"===t&&"CAMPON"!==i&&this.telephonyService.isOxe&&(this.logger.info("[TelephonyHybridEventHandler] onQueuedEvent - Oxe Reservation by OPE - cause "+i),this.telephonyService.isUserIdle()))return void this.logger.warn("[TelephonyHybridEventHandler] onQueuedEvent - Oxe Reservation by OPE - user idle (no active call) -> ignore event - cause "+i);const r=await this.getCall(e);this.computeCallRelevancy(e,r);const n=e.attr("endpointIm"),s=e.attr("endpointTel"),o=e.find("party");if(o&&o.length&&(r.calledNumber=o.attr("number")||"",r.calledNumber)){r.calledRole=o.attr("role")||"",r.calledJID=o.attr("jid")||"";const e=o.attr("displayName")||"",t=o.attr("firstName")||"",i=o.attr("lastName")||"";r.calledDisplayName=e||r.calledDisplayName,r.calledFirstName=t||r.calledFirstName,r.calledLastName=i||r.calledLastName,r.calledFirstName||r.calledLastName?r.calledDisplayName=this.computeDisplayName(r.calledFirstName,r.calledLastName):r.calledDisplayName||(r.calledDisplayName=r.calledNumber)}const a="outgoing"===t?u.Call.Status.QUEUED_OUTGOING:u.Call.Status.QUEUED_INCOMMING;r.setStatus(a),r.relevantEquipmentId=u.Call.getDeviceIdFromConnectionId(r.connectionId),r.direction=t,r.callerNumber="outgoing"===t?this.contactService.userContact.phoneInternalNumber:s,this.logger.info(`[TelephonyHybridEventHandler] onQueuedEvent id '${r.id}' direction '${r.direction}' endpointTel '${s}' callerNumber '${r.callerNumber}' => calledNumber '${r.calledNumber}'`),await this.updateCallContact(n,s,e,r),this.computeRemoteNumber(n,s,r),this.sendCallUpdateEvent(r,e)}catch(t){const e="onQueuedEvent -- "+t.message;throw this.logger.error("[TelephonyHybridEventHandler] "+e),new Error(e)}}async onFailCallEvent(e){this.logger.info("[TelephonyHybridEventHandler] onFailCallEvent");try{const t=e.attr("cause"),i=await this.getCall(e);i.setStatus(u.Call.Status.ERROR),i.errorMessage=p.CallFailureLabels[t],i.errorMessage||(i.errorMessage=t),this.sendCallUpdateEvent(i,e)}catch(t){const e="onFailCallEvent -- "+t.message;throw this.logger.error("[TelephonyHybridEventHandler] "+e),new Error(e)}}async onUpdateCallEvent(e){this.logger.info("[TelephonyHybridEventHandler] onUpdateCallEvent");try{const t=await this.getCall(e,void 0,void 0,true);if(!t)return void this.logger.info("[TelephonyHybridEventHandler] onUpDateCallEvent call does exist => IGNORED event");const i=e.attr("endpointIm");let r=e.attr("endpointTel"),n="",s="";const o=e.find("identity").attr("firstName"),a=e.find("identity").attr("lastName"),c=e.find("identity").attr("displayName"),l=e.find("identity").attr("pbxDisplayName");let d=false;if(!config.permitSearchFromPhoneBook&&!this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.TELEPHONY_PHONE_BOOK))return void this.logger.debug("[TelephonyHybridEventHandler] onUpDateCallEvent xnames not allowed for the user profile => IGNORED event");if(a&&a.length)s=a,o&&o.length&&(n=o),this.logger.info("[TelephonyHybridEventHandler] onUpDateCallEvent received for call "+t.id+" for phoneNumber:"+h.default(r)+" with name : "+n.slice(0,1)+"***");else{if(!c||!c.length||c===r)return void this.logger.info("[TelephonyHybridEventHandler] onUpDateCallEvent xnames not available => IGNORED event");s=c,this.logger.info("[TelephonyHybridEventHandler] onUpDateCallEvent only displayName available")}i||r||(r="****");const u=await this.contactService.getOrCreateContact(i,r);if(u.temp){if(u.updateName(n,s),t.contact&&t.contact.id){const e={contactPhoneNumber:r,contact:u};t.contact.id===u.id&&t.contact.displayName!==r&&t.contact.nameUpdatePrio!==f.Contact.NameUpdatePrio.OUTLOOK_UPDATE_PRIO||(u.nameUpdatePrio=f.Contact.NameUpdatePrio.SERVER_UPDATE_PRIO,t.setContact(u),t.setCurrentCalled(e),d=true,this.logger.debug("[TelephonyHybridEventHandler] onUpDateCallEvent xnames updated for "+r+" with contact : "+u.nameForLogs))}else if(t.participants&&t.participants.length>0){const e=t.getCurrentCalled();for(let i=0;i<t.participants.length;i++)t.participants[i].temp?t.participants[i].phoneProCan&&t.participants[i].phoneProCan===r&&(this.logger.debug("[TelephonyHybridEventHandler] onUpDateCallEvent temp participant "+t.participants[i].nameForLog+" updated with : "+u.nameForLogs),t.participants[i]=u,t.participants[i].nameUpdatePrio=f.Contact.NameUpdatePrio.SERVER_UPDATE_PRIO,e.participantsPhoneNumbers[i]=r,e.participants[i]=u,d=true):this.logger.debug("[TelephonyHybridEventHandler] onUpDateCallEvent STRANGE former participant was a rainbow: "+t.participants[i].nameForLog);t.setCurrentCalled(e)}}else if(t.contact&&t.contact.id){const e={contactPhoneNumber:r,contact:u};t.contact.id!==u.id&&(t.contact.temp&&(t.contact.updateName(n,s),t.contact.nameUpdatePrio=f.Contact.NameUpdatePrio.SERVER_UPDATE_PRIO),t.setContact(u),t.setCurrentCalled(e),d=true,this.logger.debug("[TelephonyHybridEventHandler] onUpDateCallEvent call update with rainbow contact : "+u.nameForLogs))}else if(t.participants&&t.participants.length>0){const e=t.getCurrentCalled();for(let n=0;n<t.participants.length;n++)t.participants[n].temp?t.participants[n].phoneProCan&&t.participants[n].phoneProCan===r&&(this.logger.debug("[TelephonyHybridEventHandler] onUpDateCallEvent temp participant "+t.participants[n].nameForLog+" updated with : "+u.nameForLogs),t.participants[n]=u,t.setParticipants(t.participants),e.participantsPhoneNumbers[n]=r,e.participants[n]=u,d=true):t.participants[n].jid===i?(e.participantsPhoneNumbers[n]=r,e.participants[n]=t.participants[n],d=true,this.logger.debug("[TelephonyHybridEventHandler] onUpDateCallEvent rainbow participant "+t.participants[n].nameForLog+" updated with the same : "+u.nameForLogs)):this.logger.debug("[TelephonyHybridEventHandler] onUpDateCallEvent other participant not updated : "+t.participants[n].nameForLog+" vs "+u.nameForLogs);t.setCurrentCalled(e)}l&&(t.PBXDisplay=l,d=true),d?this.sendCallUpdateEvent(t,e):this.logger.debug("[TelephonyHybridEventHandler] onUpDateCallEvent, no update needed for call : "+t.id)}catch(t){const e="onUpdateCallEvent -- "+t.message;throw this.logger.error("[TelephonyHybridEventHandler] "+e),new Error(e)}}async onUpdatePartyEvent(e){this.logger.info("[TelephonyHybridEventHandler] onUpdatePartyEvent");try{const t=await this.getCall(e,void 0,void 0,true);if(!t)return void this.logger.info("[TelephonyHybridEventHandler] onUpDatePartyEvent call does exist => IGNORED event");let i="",r="";const n=e.find("party");if(n&&n.length&&(t.calledNumber=n.attr("number")||"",t.calledNumber)){r=n.attr("role")||"",i=n.attr("displayName")||"";const e=n.attr("firstName")||"",s=n.attr("lastName")||"";t.calledFirstName=e||t.calledFirstName,t.calledLastName=s||t.calledLastName,t.calledFirstName||t.calledLastName?i=this.computeDisplayName(t.calledFirstName,t.calledLastName):i||(i=t.calledNumber)}i===t.getCalledDisplayName()&&r===t.calledRole||(t.setCalledDisplayName(i),t.setCalledRole(r),this.sendCallUpdateEvent(t,e))}catch(t){const e="onUpdateCallEvent -- "+t.message;throw this.logger.error("[TelephonyHybridEventHandler] "+e),new Error(e)}}async onEstablishedEvent(e){this.logger.info("[TelephonyHybridEventHandler] onEstablishedEvent");try{const t=await this.getCall(e);this.computeCallRelevancy(e,t);const i=e.attr("endpointIm");let r=e.attr("endpointTel");const n=e.attr("callId"),s=e.attr("globalCallId")||"",o=e.find("party");if(o&&o.length&&(t.calledNumber=o.attr("number")||"",t.calledNumber)){t.calledRole=o.attr("role")||"",t.calledJID=o.attr("jid")||"";const e=o.attr("displayName")||"",i=o.attr("firstName")||"",r=o.attr("lastName")||"";t.calledDisplayName=e||t.calledDisplayName,t.calledFirstName=i||t.calledFirstName,t.calledLastName=r||t.calledLastName,t.calledFirstName||t.calledLastName?t.calledDisplayName=this.computeDisplayName(t.calledFirstName,t.calledLastName):t.calledDisplayName||(t.calledDisplayName=t.calledNumber)}if(this.settingsService.getBooleanSetting("openPopoutOnAnswerCall")&&this.telephonyService.isOxe&&(t.isInExternalWindow=true),t.contact&&t.contact.id)t.setStatus(u.Call.Status.ACTIVE),t.setConnectionId(n),t.globalCallId=s,!t.direction&&this.telephonyService.isOxe&&this.computeCallDirectionFromGlobalCallId(t),t.callerNumber="outgoing"===t.direction?this.contactService.userContact.phoneInternalNumber:r,this.logger.info(`[TelephonyHybridEventHandler] onEstablishedEvent id '${t.id}' endpointTel '${r}' calledNumber '${t.calledNumber}'`),await this.updateCallContact(i,r,e,t),this.computeRemoteNumber(i,r,t),this.sendCallUpdateEvent(t,e);else if(t.participants&&t.participants.length>0){let n=null;for(let e=0;e<t.participants.length&&!n;e++)(t.participants[e].id===i||t.currentCalled.participantsPhoneNumbers&&t.currentCalled.participantsPhoneNumbers.length>0&&t.currentCalled.participantsPhoneNumbers[e]===r)&&(n=t.participants[e]);t.participants=[],t.isConference=false;let s=t.getCurrentCalled();if(n)t.setContact(n),t.setStatus(u.Call.Status.ACTIVE),s={contactPhoneNumber:r,contact:n},t.setCurrentCalled(s),this.sendCallUpdateEvent(t,e);else{i||r||(r="****");const n=await this.contactService.getOrCreateContact(i,r);t.setContact(n),t.setStatus(u.Call.Status.ACTIVE),s={contactPhoneNumber:r,contact:n},t.setCurrentCalled(s),this.sendCallUpdateEvent(t,e)}}else{this.logger.info("[TelephonyHybridEventHandler] onEstablishedEvent, no call contact / no participants"),i||r||(r="****");const n=await this.contactService.getOrCreateContact(i,r);t.setContact(n),t.setStatus(u.Call.Status.ACTIVE);const s={contactPhoneNumber:r,contact:n};t.setCurrentCalled(s),this.sendCallUpdateEvent(t,e)}}catch(t){const e="onEstablishedEvent -- "+t.message;throw this.logger.error("[TelephonyHybridEventHandler] "+e),new Error(e)}}computeRemoteNumber(e,t,i){"outgoing"===i.direction&&e&&i.contact?(i.remoteNumber=i.contact.phoneInternalNumber||i.contact.phonePro||t,this.logger.info("[TelephonyHybridEventHandler] computeRemoteNumber based on rainbow contact numbers for outgoing call "+i+" => remoteNumber: "+i.remoteNumber)):(i.remoteNumber=t,this.logger.info("[TelephonyHybridEventHandler] computeRemoteNumber based on endpointTel for call "+i+" => remoteNumber: "+i.remoteNumber))}computeCallDirectionFromGlobalCallId(e){const t=this.telephonyService.getOtherCallWithSameGlobalCallId(e);t&&(e.direction=t.direction,this.logger.info("[TelephonyHybridEventHandler] computeCallDirectionFromGlobalCallId "+e+" => direction: "+e.direction))}async onHeldEvent(e){this.logger.info("[TelephonyHybridEventHandler] onHeldEvent");try{const t=await this.getCall(e,true),i=e.attr("callId"),r=u.Call.getDeviceIdFromConnectionId(t.connectionId);r===u.Call.getDeviceIdFromConnectionId(i)?t.setStatus(u.Call.Status.HOLD):t.setStatus(u.Call.Status.PUT_ON_HOLD),this.sendCallUpdateEvent(t,e)}catch(t){const e="onHeldEvent -- "+t.message;throw this.logger.error("[TelephonyHybridEventHandler] "+e),new Error(e)}}async onRetrieveCallEvent(e){this.logger.info("[TelephonyHybridEventHandler] onRetrieveCallEvent");try{const t=await this.getCall(e,true);t.setStatus(u.Call.Status.ACTIVE),this.sendCallUpdateEvent(t,e)}catch(t){const e="onRetrieveCallEvent -- "+t.message;throw this.logger.error("[TelephonyHybridEventHandler] "+e),new Error(e)}}async onDivertedEvent(e){this.logger.info("[TelephonyHybridEventHandler] onDivertedEvent");try{const t=e.attr("oldCallId"),i=u.Call.getIdFromConnectionId(t),r=this.telephonyService.calls[i];if(!r)return void this.logger.warn("[TelephonyHybridEventHandler] onDivertedEvent - receive divertedEvent on unknown call --- ignored");this.computeCallRelevancy(e,r),this.telephonyService.clearCall(r,true),this.sendCallUpdateEvent(r,e)}catch(t){const e="onDivertedEvent -- "+t.message;throw this.logger.error("[TelephonyHybridEventHandler] "+e),new Error(e)}}async onTransferEvent(e){this.logger.info("[TelephonyHybridEventHandler] onTransferEvent");try{const t=e.attr("activeCallId"),i=e.attr("heldCallId"),r=e.attr("newCallId"),n=u.Call.getIdFromConnectionId(t),s=this.telephonyService.calls[n];if(i){const e=u.Call.getIdFromConnectionId(i),t=this.telephonyService.calls[e];t&&t.setStatus(u.Call.Status.UNKNOWN),s&&s.setStatus(u.Call.Status.UNKNOWN),t&&this.sendCallUpdateEvent(t),s&&this.sendCallUpdateEvent(s)}if(r){const t=e.attr("newEndpointIm");let i=e.attr("newEndpointTel"),n=e.attr("deviceState");n||(n=e.attr("deviceStatus"));let o=e.attr("deviceType");o||(o="MAIN"),s&&(s.setStatus(u.Call.Status.UNKNOWN),this.sendCallUpdateEvent(s)),t||i||(i="****");const a=await this.getOrCreateCall(r,t,i);n&&"LCI_ALERTING"===n?(a.setStatus(u.Call.Status.RINGING_INCOMMING),a.direction="incoming"):n&&"LCI_QUEUED"===n?(a.setStatus(u.Call.Status.QUEUED_INCOMMING),a.direction="incoming"):(a.setStatus(u.Call.Status.ACTIVE),a.direction=s?s.direction:null),a.relevantEquipmentId=u.Call.getDeviceIdFromConnectionId(r),a.isSecondary=o&&"SECONDARY"===o,await this.updateCallContact(t,i,e,a),this.computeRemoteNumber(t,i,a),this.sendCallUpdateEvent(a,e)}}catch(t){const e="onTransferEvent -- "+t.message;throw this.logger.error("[TelephonyHybridEventHandler] "+e),new Error(e)}}async onConferenceEvent(e){this.logger.info("[TelephonyHybridEventHandler] onConferenceEvent");const t=e.find("primaryOldCallId").text(),i=e.find("secondaryOldCallId").text(),r=e.find("newCallId").text(),n=u.Call.getIdFromConnectionId(t),s=u.Call.getIdFromConnectionId(i),o=this.telephonyService.calls[n],a=this.telephonyService.calls[s],c=[],l=[],d=[];e.find("participant").each(((e,t)=>{const i=$(t);let r=i.find("endpointTel").text();const n=i.find("endpointIm").text();n&&this.contactService.isUserContactJid(n)||l.push((async()=>{if(n||r||(r="****"),!n&&o&&o.contact&&o.currentCalled.contactPhoneNumber===r)c.push(o.contact),d.push(r);else if(!n&&a&&a.contact&&a.currentCalled.contactPhoneNumber===r)c.push(a.contact),d.push(r);else try{const t=await this.contactService.getOrCreateContact(n,r);c.push(t),d.push(r);try{await this.telephonyService.updateContactFromOutlookInfos(t,r)?this.logger.debug("[TelephonyHybridEventHandler] on conferenced, update from outlook for contact :"+t.nameForLogs):this.logger.debug("[TelephonyHybridEventHandler] on conferenced, no update from outlook for contact :"+t.nameForLogs)}catch(e){this.logger.debug("[TelephonyHybridEventHandler] on conferenced, no Outlook search available")}}catch(e){this.logger.error("[TelephonyHybridEventHandler] onConferenceEvent - Impossible to get contact - "+e.message)}})())}));try{await Promise.all(l)}finally{let e=false;o&&(e=e||o.isSecondary),a&&(e=e||a.isSecondary);const t=this.createConferenceCall(r,c),i=t.getCurrentCalled();i.participants=c,i.participantsPhoneNumbers=d,t.setCurrentCalled(i),t.setStatus(u.Call.Status.ACTIVE),t.relevantEquipmentId=u.Call.getDeviceIdFromConnectionId(r),t.isSecondary=e,this.logger.debug("[TelephonyHybridEventHandler] on conferenced, create new call: "+t),(o&&o.isInExternalWindow||a&&a.isInExternalWindow)&&(t.isInExternalWindow=true),this.sendCallUpdateEvent(t),o&&(o.setStatus(u.Call.Status.UNKNOWN),this.logger.debug("[TelephonyHybridEventHandler] on conferenced, updated primaryOldCall: "+o),this.sendCallUpdateEvent(o)),a&&(a.setStatus(u.Call.Status.UNKNOWN),this.logger.debug("[TelephonyHybridEventHandler] on conferenced, updated secondaryOldCall: "+a),this.sendCallUpdateEvent(a))}}async onCallSubjectEvent(e){this.logger.info("[TelephonyHybridEventHandler] onCallSubjectEvent");try{const t=await this.getCall(e,true);t.subject=e.find("subject").text(),t.subject&&(this.logger.info("[TelephonyHybridEventHandler] subject display"+t.subject),this.sendCallUpdateEvent(t))}catch(t){const e="onCallSubjectEvent -- "+t.message;throw this.logger.error("[TelephonyHybridEventHandler] "+e),new Error(e)}}async onClearCallEvent(e){const t=e.attr("callId"),i=u.Call.getIdFromConnectionId(t),r=e.attr("cause");this.logger.info("[TelephonyHybridEventHandler] onClearCallEvent, connectionId: "+t);try{if(this.telephonyService.calls[i]){const t=await this.getCall(e);this.computeCallRelevancy(e,t),this.telephonyService.clearCall(t,true),t.lastCause=r||"",this.sendCallUpdateEvent(t,e)}else this.logger.info("[TelephonyHybridEventHandler] onClearCallEvent, no call for connectionId: "+t)}catch(n){const e="onClearCallEvent -- "+n.message;throw this.logger.error("[TelephonyHybridEventHandler] "+e),new Error(e)}}async onCallForwardedEvent(e){const t=e.attr("forwardType"),i=e.attr("forwardTo"),r=e.attr("pbxForwardType");this.logger.info("[TelephonyHybridEventHandler] onCallForwardedEvent forwardType: "+t+" forwardTo: "+i+" pbxForwardType: "+r),this.eventService.publish("ON_CALL_FORWARDED_EVENT",{forwardType:t,forwardTo:i,pbxForwardType:r}),this.telephonyService.forwardObject.forwardType=t,this.telephonyService.forwardObject.forwardTo=i,this.telephonyService.forwardObject.pbxForwardType=r}async onCallNomadicEvent(e){if(this.logger.info("[TelephonyHybridEventHandler] onCallNomadicEvent"),!this.telephonyService.started&&!this.telephonyService.starting)return this.logger.info("[TelephonyHybridEventHandler] onCallNomadicEvent on uninitialized telephony => relaunch telephony initialization"),void this.telephonyService.launchTelephonyInitilization();const t={destination:e.attr("destination"),featureActivated:e.attr("featureActivated"),makeCallInitiatorIsMain:e.attr("makeCallInitiatorIsMain"),modeActivated:e.attr("modeActivated"),nomadicModeInitialized:e.attr("nomadicModeInitialized")};if(await this.telephonyService.updateNomadicData(t)){const e=this.telephonyService.nomadicObject.featureActivated&&this.telephonyService.nomadicObject.modeActivated&&!this.telephonyService.nomadicObject.makeCallInitiatorIsMain;this.telephonyService.getTelephonyState(e)}}sendCallUpdateEvent(e,t){const i=this.extractInfoEvent(t);this.logger.info("[TelephonyHybridEventHandler] sendCallUpdateEvent call: "+e+(i?" infoEvt: "+JSON.stringify(i):"")),this.eventService.publish("ON_CALL_UPDATED_EVENT",e,i)}extractInfoEvent(e){let t={actionElemName:"",cause:""};if(e&&null!==e){const i=e.prop("tagName").split(":");t.actionElemName=i[i.length-1].toLowerCase(),t.cause=e.attr("cause"),t.cause=t.cause?t.cause:""}else t=null;return t}createConferenceCall(e,t){const i=u.Call.create(u.Call.Status.UNKNOWN,null,u.Call.Type.PHONE);return i.setConnectionId(e),i.isConference=true,i.setParticipants(t),this.telephonyService.calls[i.id]=i,i}async getCall(e,t,i,r){const n=e.attr("endpointIm"),s=e.attr("endpointTel"),o=e.attr("callId");return this.getOrCreateCall(o,n,s,t,i,r)}async getOrCreateCall(e,t,i,r,n,s){if(r){const t=e;e=Object.keys(this.telephonyService.calls||[]).find((t=>u.Call.getCallIdFromConnectionId(t)===u.Call.getCallIdFromConnectionId(e))),this.logger.debug("[TelephonyHybridEventHandler] getOrCreateCall - HOLD/RETRIEVE search call with callId: "+u.Call.getCallIdFromConnectionId(t)+" from connection id: "+t+" => found connectionId: "+e)}if(!e)throw new Error("no connection id");if(n){const i=this.telephonyService.pendingMakeCalls.pop();if(i)return i.setStatus(u.Call.Status.DIALING),i.setConnectionId(e),i.setRelevantEquipmentId(u.Call.getDeviceIdFromConnectionId(i.connectionId)),this.logger.info("[TelephonyHybridEventHandler] getOrCreateCall - "+e+" - "+t+" => found pendingMakeCall: Call confirmed by csta event "+i),this.telephonyService.calls[i.id]=i,i}const o=this.telephonyService.calls[e];if(o)return this.logger.info("[TelephonyHybridEventHandler] getOrCreateCall - "+e+" - "+h.default(i)+" - "+t+" => found call: "+o),o;if(s)return this.logger.info("[TelephonyHybridEventHandler] getOrCreateCall - "+e+" => call not found"),null;this.logger.info("[TelephonyHybridEventHandler] getOrCreateCall - "+e+" - "+h.default(i)+" - "+t+" => not found : create call..."),t||i||(i="****");const a=await this.contactService.getOrCreateContact(t,i);return this.telephonyService.getOrCreateCall(u.Call.Status.UNKNOWN,e,a)}computeCallRelevancy(e,t){const i=e.attr("newCallId"),r=i||e.attr("callId");let n=e.attr("deviceType");const s=u.Call.getDeviceIdFromConnectionId(r),o=this.telephonyService.getNomadicObject();let a=o.makeCallInitiatorIsMain;n||(n="MAIN"),o.modeActivated||(a=true),"MAIN"===n&&a&&(t.relevantEquipmentId=s,t.connectionId=r),"SECONDARY"!==n||a||(t.relevantEquipmentId=s,t.connectionId=r),t.isSecondary=n&&"SECONDARY"===n&&!a,this.logger.info("[TelephonyHybridEventHandler] computeCallRelevancy -- relevantEquipmentId: "+t.relevantEquipmentId+" connectionId: "+t.connectionId+" isSecondary: "+t.isSecondary)}async updateCallContact(e,t,i,r){const n=i.prop("tagName").split(":"),s=n[n.length-1].toLowerCase();try{const i=this.analyzeContactChange(e,t,r);if(r.isConference||""===t||r.setCurrentCalledContactNumber(t),i)try{const n=await this.contactService.getOrCreateContact(e,t);if(i.searchOutlookToBeDone){try{await this.telephonyService.updateContactFromOutlookInfos(n,t)?(this.logger.debug("[TelephonyHybridEventHandler] on "+s+", update from outlook for contact :"+n.nameForLogs),this.makeUpdateContact(r,n,t)):(this.logger.debug("[TelephonyHybridEventHandler] on "+s+", no update from outlook for contact :"+n.nameForLogs),i.updateContactToBeDone&&(this.logger.debug("[TelephonyHybridEventHandler] on "+s+", update contact :"+n.nameForLogs),this.makeUpdateContact(r,n,t)))}catch(o){this.logger.debug("[TelephonyHybridEventHandler] on "+s+", no Outlook search available"),i.updateContactToBeDone&&(this.logger.debug("[TelephonyHybridEventHandler] on "+s+", update contact :"+n.nameForLogs),this.makeUpdateContact(r,n,t))}return}return this.logger.debug("[TelephonyHybridEventHandler] on "+s+", update contact :"+n.nameForLogs),void this.makeUpdateContact(r,n,t)}catch(o){if(o){const e="updateCallContact -- "+o.message;this.logger.error("[TelephonyHybridEventHandler] "+e)}this.logger.debug("[TelephonyHybridEventHandler] on "+s+", no Outlook search available")}}catch(o){const e="updateCallContact -- "+o.message;throw this.logger.error("[TelephonyHybridEventHandler] "+e),new Error(e)}}makeUpdateContact(e,t,i){e.setContact(t);const r={contactPhoneNumber:i,contact:t};e.setCurrentCalled(r)}analyzeContactChange(e,t,i){let r=false,n=false;return e||t?i.isConference?void 0:i.contact?(""!==e?i.contact.id!==e&&(r=true,n=false):i.contact.temp?i.contact.id!==t?(r=true,n=true):i.contact.displayName===t&&(r=false,n=true):""!==i.getCurrentCalled().contactPhoneNumber&&""!==t&&i.getCurrentCalled().contactPhoneNumber!==t&&(r=true,n=true),r||n?{updateContactToBeDone:r,searchOutlookToBeDone:n}:null):{updateContactToBeDone:true,searchOutlookToBeDone:true}:null}computeDisplayName(e,t){const i=e?e.charAt(0).toUpperCase()+e.slice(1):null,r=t?t.charAt(0).toUpperCase()+t.slice(1):null;let n="";return n=r&&i?"FL"===this.settingsService.getSetting("displayOrder")?i+" "+r:r+" "+i:r&&!i?r:i||"Anonymous",n}}p.CALLSERVICE_NS="urn:xmpp:pbxagent:callservice:1",p.CallFailureLabels={DESTNOTOBTAINABLE:"outOfService",DONOTDISTURB:"dnd",TRUNKSBUSY:"trunksbusy",BUSY:"busy"},t.TelephonyHybridEventHandler=p},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(131),n=i(141),s=i(430),o=i(431),a=i(308),c=i(103),l=i(11),d=i(132),u=i(432),h=i(4),f=i(6),p=i(8),g=i(9),m=i(147),v=i(14),S=i(30),b=i(46),y=i(17),C=i(13);var w;!function(e){e.PSTNAUDIO="pstnAudio",e.WEBRTC="webrtc",e.WEBRTCSHARINGONLY="webrtcSharingOnly"}(w=t.MEDIATYPE||(t.MEDIATYPE={}));t.NgPgiConferenceService=class{constructor(){this.eventService=l.EventService.getInstance(),this.logger=h.LoggerService.getInstance(),this.authService=p.AuthService.getInstance(),this.xmppService=g.XmppService.getInstance(),this.countryService=m.CountryService.getInstance(),this.profileService=v.ProfileService.getInstance(),this.contactService=f.ContactService.getInstance(),this.roomService=S.RoomService.getInstance(),this.mainService=y.MainService.getInstance(),this.i18n=b.I18nService.getInstance(),this.errorHelperService=C.ErrorHelperService.getInstance(),this.conferenceEndpoints={},this.conferenceEnpointsSubject=new d.Subject,this.conferenceSessions={},this.conferenceSessionsSubject=new u.ReplaySubject,this.started=false,this.isPstnConferenceAvailable=false,this.isPstnConferenceAvailableSubject=new r.BehaviorSubject(this.isPstnConferenceAvailable),this.pstnConferencePhoneNumbers=null,this.startedSubject=new r.BehaviorSubject(false)}start(){this.logger.info("=== STARTING ==="),this.confProvPortalURL=new URL(config.restServerUrl+"/api/rainbow/confprovisioning/v1.0/"),this.confPortalURL=new URL(config.restServerUrl+"/api/rainbow/conference/v1.0/"),this.attachHandlers(),this.computePstnConferencePremission(),this.isPstnConferenceAvailableSubject.pipe(n.distinctUntilChanged()).subscribe((e=>{e&&this.initializeServiceData()})),this.started=true,this.logger.info("=== STARTED ==="),this.startedSubject.next(true),this.contactService.userContact.phoneMeetingsEnabledSubject.pipe(n.distinctUntilChanged()).subscribe((e=>{e||this.stop()}))}stop(){this.logger.info(""),this.logger.info("[PgiConferenceService] === STOPPING ==="),this.isPstnConferenceAvailable=false,this.started=false,this.logger.info("[PgiConferenceService] === STOPPED ==="),this.startedSubject.next(false)}reconnect(){this.reconnectService()}reconnectService(){this.logger.info("reconnectService"),this.attachHandlers(),this.refreshConferenceSessions()}attachHandlers(){this.xmppManagementHandler&&(this.xmppService.deleteHandler(this.xmppManagementHandler),this.xmppManagementHandler=null),this.xmppManagementHandler=this.xmppService.addHandler((e=>(this.onManagementMessage(e),true)),null,"message","management"),this.conferenceHandler&&(this.xmppService.connection.deleteHandler(this.conferenceHandler),this.conferenceHandler=null),this.conferenceHandler=this.xmppService.connection.addHandler((e=>(this.onConferenceMessage(e),true)),"jabber:iq:conference","message",null)}onManagementMessage(e){const t=$(e);t.find("confuseractivated ").length>0&&this.setPstnConferenceAvailability(this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_ALLOWED));const i=t.find("confendpoint");if(i.length&&"update"===i.attr("action")){this.logger.info("onManagementMessage - update of conference");const e=t.find("confendpointid").text();this.retrieveConference(e,true)}}onConferenceMessage(e){const t=$(e),i=t.find("conference-id").text(),r=this.getConferenceSessionById(i);r&&this.updateConferenceSession(t,r)}updateConferenceSession(e,t){this.logger.info("updateConferenceSession - "+t.id);const i=e.find("conference-state");if(i.length){const e="true"===i.find("active").text(),r="true"===i.find("lock").text();this.updateState(t,e,r)}const r=e.find("talkers");if(r.length){const e=[];r.find("participant-id").each(((t,i)=>{const r=$(i).text();e.push(r)})),this.logger.debug("update talkers with: "+e),t.updateTalkers(e)}let n=e.find("participants");if(0===n.length){if(n=e.find("updated-participants"),n.length){const e=[];n.find("participant").each(((t,i)=>{const r=$(i),n=r.find("participant-id").text(),s=r.find("jid-im").text(),o=r.find("phone-number").text(),c=r.find("role").text(),l=r.find("mute").text(),d=r.find("hold").text(),u=r.find("cnx-state").text();e.push(a.ConferenceParticipant.createFromData({participantId:n,jid_im:s,participantRole:c,mute:"on"===l,held:"on"===d,phoneNumber:o,participantState:u}))})),t.participants=e}}else{const e=[];n.find("participant").each(((t,i)=>{const r=$(i),n=r.find("participant-id").text(),s=r.find("jid-im").text(),o=r.find("phone-number").text(),c=r.find("role").text(),l=r.find("mute").text(),d=r.find("hold").text(),u=r.find("cnx-state").text();e.push(a.ConferenceParticipant.createFromData({participantId:n,jid_im:s,participantRole:c,mute:"on"===l,held:"on"===d,phoneNumber:o,participantState:u}))})),e.length&&(t.participants=e)}if(!n.length&&(n=e.find("added-participants"),n.length)){const e=t.participants;n.find("participant").each(((t,i)=>{const r=$(i),n=r.find("participant-id").text(),s=r.find("jid-im").text(),o=r.find("phone-number").text(),c=r.find("role").text(),l=r.find("mute").text(),d=r.find("hold").text(),u=r.find("cnx-state").text();e.push(a.ConferenceParticipant.createFromData({participantId:n,jid_im:s,participantRole:c,mute:"on"===l,held:"on"===d,phoneNumber:o,participantState:u}))})),t.participants=e}const s=e.find("removed-participants");if(s.length){const e=[];s.find("participant-id").each(((t,i)=>{const r=$(i).text();e.push(r)})),this.logger.debug("remove participants: "+e),t.removeParticipants(e)}this.conferenceSessionsSubject.next({id:t.id,action:"updated"})}async updateState(e,t,i=false){if(e.active&&!t){if(this.contactService.userContact.guestMode&&e.type!==w.WEBRTCSHARINGONLY)return this.eventService.publish("ON_OPEN_POPUP","concludeInvitation"),e.cleanupSessionData(),void e.updateStateFromData(t,i);const n=this.roomService.findRoomsWithConfId(e.id)[0];if(n){if(n.owner&&e.id===this.getPstnInstantConferenceEndpointId())try{const e=await this.roomService.retrieveRoomConsumption();e>this.profileService.getFeatureLimitMax(this.profileService.FeaturesEnum.BUBBLE_COUNT)?(this.mainService.showGlobalPopupMessage({popupTitle:"createBubble",popupBody:"maxCollabSpaceReached",okLabel:"ok"}),await this.roomService.deletePersonalMeetingRoom()):n.isMyPersonalMeetingRoom()&&this.eventService.publish("ON_SHOW_POPUP",{component:"renameMeeting",data:n})}catch(r){}else if(!n.owner&&e.isParticipantConnectedByJid(this.contactService.userContact.dbId)){const e=c.default(n.ownerContact.displayName),t=c.default(n.name),i=this.i18n.translate("meetingEndBy",{owner:e,meeting:t});this.eventService.publish("GLOBAL_NOTIFY_MESSAGE_EVENT",i)}}e.cleanupSessionData()}e.updateStateFromData(t,i)}async initializeServiceData(){try{await this.retrievePstnConferences(),await this.makeSnapshots(),this.logger.info("service data initialized")}catch(e){this.logger.warn("service data init failed")}}setPstnConferenceAvailability(e){this.isPstnConferenceAvailable&&!e&&this.mainService.showGlobalPopupMessage({popupTitle:"information",popupBody:"pgiRightsRemovedWarning",okLabel:"ok"}),this.isPstnConferenceAvailable=e,this.isPstnConferenceAvailableSubject.next(this.isPstnConferenceAvailable)}computePstnConferencePremission(){let e=true;this.profileService.getProfilesByName("conference").filter((e=>"active"===e.status)).forEach((t=>{t.provisioningNeeded&&t.provisioningNeeded.length&&t.provisioningNeeded.forEach((t=>{-1!==t.providerType.toLowerCase().indexOf("pgi")&&(e=t.provisioningOngoing,e&&this.logger.info("computePstnConferencePremission - pgi provisioning on going"))}))})),this.setPstnConferenceAvailability(this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.CONFERENCE_ALLOWED)&&!e)}async makeSnapshots(){try{this.logger.info("makeSnapshots");const e=[];for(const t in this.conferenceEndpoints)if(this.conferenceEndpoints[t]){const i=this.conferenceEndpoints[t];i&&(this.logger.info("makeSnapshots -- "+i.id),e.push(i.id))}await Promise.all(e.map((async e=>{try{await this.makeSnapshotForConfId(e)}catch(t){}}))),this.logger.info("makeSnapshots -- SUCCESS")}catch(e){this.logger.info("makeSnapshots -- ERROR")}}async makeSnapshotForConfId(e){if(!e){const e=new Error("makeSnapshotForConfId - No confId !!");throw this.logger.error(e.message),e}try{const t=this.conferenceSessions[e];if(t&&t.active&&t.haveJoined)return this.logger.debug("makeSnapshotForConfId skipped, already joined"),t;const i=new URL(`conferences/${e}/snapshot`,this.confPortalURL),r=this.authService.getRequestHeader(),n=await fetch(i.href,{method:"GET",headers:r});if(!n.ok)throw this.logger.debug(`Request ${n.headers.get("x-rainbow-request-id")} failed with status ${n.status}`),n;const s=(await n.json()).data;return this.updateOrCreateConferenceSession(e,s),s}catch(t){this.conferenceSessions[e]&&(this.logger.debug("makeSnapshotForConfId failed - remove conferenceSession "+e),this.removeConferenceSession(e));const i=await this.errorHelperService.getErrorInfo(t,"makeSnapshotForConfId");throw this.logger.error("[pgiConferenceService] "+i.message),i.error}}removeConferenceSession(e){e&&(this.logger.debug("removeConferenceSession "+e),delete this.conferenceSessions[e],this.conferenceSessionsSubject.next({id:e,action:"deleted"}))}updateOrCreateConferenceSession(e,t){if(this.logger.debug("updateOrCreateConferenceSession for "+e),!e||!t)return this.logger.warn("updateOrCreateConferenceSession - Not enough data"),null;let i=this.conferenceSessions[e];return i?(t.active!==i.active&&(this.logger.debug("updateOrCreateConferenceSession - state update to "+(t.active?"active":"inactive")),i.active=t.active,this.conferenceSessionsSubject.next({id:e,action:"updated"})),t.participants&&(this.logger.debug(`updateOrCreateConferenceSession - update participants for ${e} with:\n${JSON.stringify(t.participants)}`),i.participants=t.participants.map((e=>a.ConferenceParticipant.createFromData(e))),this.conferenceSessionsSubject.next({id:e,action:"updated"}))):(this.logger.debug(`updateOrCreateConferenceSession - create new conferencesession with id ${e} and data: \n${JSON.stringify(t)}`),i=o.ConferenceSession.createFromData(e,t.participants,t.active,w.PSTNAUDIO),this.conferenceSessions[e]=i,this.conferenceSessionsSubject.next({id:e,action:"created"})),i}async updateConference(e,t){try{if(this.logger.info("updateConference"),!e){const e="updateConference failure: No confEndpoint";throw this.logger.error("updateConference failure : No confEndpoint"),new Error(e)}const i=new URL("conferences/"+e,this.confProvPortalURL),r=this.authService.getRequestHeader();r["Content-Type"]="application/json";const n=await fetch(i.href,{method:"PUT",headers:r,body:JSON.stringify(t)});if(!n.ok)throw this.logger.debug(`Request ${n.headers.get("x-rainbow-request-id")} failed with status ${n.status}`),n;const s=(await n.json()).data,o=this.updateOrCreatePstnConferenceEndpoint(s);return this.logger.info("updateConference SUCCESS"),o}catch(i){throw this.logger.error("updateConference ERROR"),i}}getPstnInstantConferenceEndpoint(){return this.conferenceEndpoints[Object.keys(this.conferenceEndpoints)[0]]}getPstnInstantConferenceEndpointId(){return this.conferenceEndpoints[Object.keys(this.conferenceEndpoints)[0]]?this.conferenceEndpoints[Object.keys(this.conferenceEndpoints)[0]].id:null}async retrievePstnConferences(){try{if(this.logger.info("retrievePstnConferences"),!this.isPstnConferenceAvailable)throw this.logger.warn("retrievePstnConferences - user is not allowed"),new Error("notAllowed");const e=new URL("conferences",this.confProvPortalURL);e.searchParams.set("format","full"),e.searchParams.set("userId",this.contactService.userContact.dbId),e.searchParams.set("scheduled","false"),e.searchParams.set("mediaType",w.PSTNAUDIO);const t=this.authService.getRequestHeader(),i=await fetch(e.href,{method:"GET",headers:t});if(!i.ok)throw this.logger.debug(`Request ${i.headers.get("x-rainbow-request-id")} failed with status ${i.status}`),i;const r=(await i.json()).data;for(const n of r)n&&n.mediaType===w.PSTNAUDIO&&this.updateOrCreatePstnConferenceEndpoint(n);return this.logger.info("retrievePstnConferences successfully"),r}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"retrievePstnConferences");throw this.logger.error("[pgiConferenceService] "+t.message),t.error}}async retrieveConference(e,t=false){if(!e){const e=new Error("retrieveConference - missing parameter");throw this.logger.error(e.message),e}try{if(this.logger.info("retrieveConference - "+e),this.conferenceEndpoints[e]&&!t)return this.conferenceEndpoints[e];const i=new URL("conferences/"+e,this.confProvPortalURL),r=this.authService.getRequestHeader(),n=await fetch(i.href,{method:"GET",headers:r});if(!n.ok)throw this.logger.debug(`Request ${n.headers.get("x-rainbow-request-id")} failed with status ${n.status}`),n;const s=(await n.json()).data;return s&&Object.prototype.hasOwnProperty.call(s,"id")?this.updateOrCreatePstnConferenceEndpoint(s):s}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"retrieveConference");throw this.logger.error("[pgiConferenceService] "+e.message),e.error}}updateOrCreatePstnConferenceEndpoint(e){if(this.logger.info("updateOrCreatePstnConferenceEndpoint for "+e.id),!e)return this.logger.error("updateOrCreatePstnConferenceEndpoint - no conference data !"),null;if(e.mediaType!==w.PSTNAUDIO)return this.logger.warn("updateOrCreatePstnConferenceEndpoint - wrong mediaType: "+e.mediaType),null;if(this.conferenceEndpoints[e.id])this.conferenceEndpoints[e.id].updateFromData(e),this.conferenceEnpointsSubject.next({id:e.id,action:"updated"});else{const t=s.ConferenceEndpoint.createFromData(e);this.conferenceEndpoints[e.id]=t,this.conferenceEnpointsSubject.next({id:e.id,action:"created"})}return this.conferenceEndpoints[e.id]}getConferenceSessionWithConnId(e){this.logger.debug("getConferenceSessionWithConnId with connId "+e);for(const t in this.conferenceSessions)if(this.conferenceSessions[t]){const i=this.conferenceSessions[t];if(i&&i.callId===e)return this.logger.debug(`getConferenceSessionWithConnId with connId ${e}: - conferenceSessionId: ${t}`),i}return null}getConferenceSessionById(e){return this.conferenceSessions[e]}async subscribeToPstnSession(e){if(this.logger.info(`subscribeToPstnSession( confId=${e})`),!e){const e=new Error("subscribeToPstnSession - missing parameter");throw this.logger.error(e.message),e}try{const t=new URL(`conferences/${e}/join`,this.confPortalURL),i=this.authService.getRequestHeader();i["Content-Type"]="application/json";const r={participantPhoneNumber:"joinWithoutAudio",participant:{role:"member",type:"unmuted"},mediaType:w.PSTNAUDIO},n=await fetch(t.href,{method:"POST",headers:i,body:JSON.stringify(r)});if(!n.ok)throw this.logger.debug(`Request ${n.headers.get("x-rainbow-request-id")} failed with status ${n.status}`),n;const s=(await n.json()).status;return this.logger.info(`subscribeToPstnSession( confId=${e}) success : ${s}`),e}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"subscribeToPstnSession");throw this.logger.error("[pgiConferenceService] "+e.message),e.error}}async unSubscribeParticipantFromPstnSession(e,t){if(this.logger.info(`unSubscribeParticipantFromPstnSession( confId=${e} - participantId=${t})`),!e||!t){const e=new Error("unSubscribeParticipantFromPstnSession - missing parameter");throw this.logger.error(e.message),e}try{const i=new URL(`conferences/${e}/participants/${t}`,this.confPortalURL);i.searchParams.set("mediaType",w.PSTNAUDIO);const r=this.authService.getRequestHeader();r["Content-Type"]="application/json";const n={participantPhoneNumber:"joinWithoutAudio",participant:{role:"member",type:"unmuted"},mediaType:w.PSTNAUDIO},s=await fetch(i.href,{method:"DELETE",headers:r,body:JSON.stringify(n)});if(!s.ok)throw this.logger.debug(`Request ${s.headers.get("x-rainbow-request-id")} failed with status ${s.status}`),s;const o=(await s.json()).status;this.logger.info(`unSubscribeParticipantFromPstnSession( confId=${e} ) success : ${o}`)}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"unSubscribeParticipantFromPstnSession");throw this.logger.error("[pgiConferenceService] "+e.message),e.error}}async startPstnConference(e){if(this.logger.info(`startPstnConference( confId=${e} )`),!e){const e=new Error("startPstnConference - missing parameter");throw this.logger.error(e.message),e}if(this.conferenceSessions[e]&&this.conferenceSessions[e].active)this.logger.info("startPstnConference : conference already started");else try{const t=new URL(`conferences/${e}/start`,this.confPortalURL),i=this.authService.getRequestHeader(),r=await fetch(t.href,{method:"PUT",headers:i});if(!r.ok)throw this.logger.debug(`Request ${r.headers.get("x-rainbow-request-id")} failed with status ${r.status}`),r;const n=(await r.json()).status;this.logger.info(`startPstnConference( confId=${e} ) success : ${n}`)}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"startPstnConference");throw this.logger.error("[pgiConferenceService] "+e.message),e.error}}async stopPstnConference(e){if(this.logger.info(`stopPstnConference( confId=${e} )`),!e){const e=new Error("stopPstnConference - missing parameter");throw this.logger.error(e.message),e}if(this.conferenceSessions[e]&&this.conferenceSessions[e].active)try{const t=new URL(`conferences/${e}/stop`,this.confPortalURL),i=this.authService.getRequestHeader();i["Content-Type"]="application/json";const r={mediaType:w.PSTNAUDIO},n=await fetch(t.href,{method:"PUT",headers:i,body:JSON.stringify(r)}),s=await n.json();if(!n.ok){if(this.logger.debug(`Request ${n.headers.get("x-rainbow-request-id")} failed with status ${n.status}`),404===n.status&&404e3===s.errorDetailsCode){const t=this.getConferenceSessionById(e);t&&(t.active=false,t.participants=[],this.removeConferenceSession(e))}throw n}const o=s.status;this.logger.info(`stopPstnConference( confId=${e} ) success : ${o}`)}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"stopPstnConference");throw this.logger.error("[pgiConferenceService] "+e.message),e.error}else this.logger.info("stopPstnConference : no conference to stop")}async joinPstnConference(e,t,i,r){if(!e||!t||!i){const e=new Error("joinPstnConference - missing parameter");throw this.logger.error(e.message),e}this.logger.info(`joinPstnConference( confId=${e}, PhoneNumber=${t}, role=${i.role}, country=${r} )`);try{const n=new URL(`conferences/${e}/join`,this.confPortalURL),s=this.authService.getRequestHeader();s["Content-Type"]="application/json";const o={participantPhoneNumber:t,participant:i,country:r,mediaType:w.PSTNAUDIO},a=await fetch(n.href,{method:"POST",headers:s,body:JSON.stringify(o)});if(!a.ok)throw this.logger.debug(`Request ${a.headers.get("x-rainbow-request-id")} failed with status ${a.status}`),a;this.conferenceSessions[e].joinInProgress=true;const c=(await a.json()).status;return this.logger.info(`joinPstnConference( confId=${e} ) success - ${c}`),e}catch(n){const e=await this.errorHelperService.getErrorInfo(n,"joinPstnConference");throw this.logger.error("[pgiConferenceService] "+e.message),e.error}}async disconnectParticipant(e,t){if(!e||!t){const e=new Error("disconnectParticipant - missing parameter");throw this.logger.error(e.message),e}this.logger.info(`disconnectParticipant( confId=${e}, participantId=${t} )`);try{const i=new URL(`conferences/${e}/participants/${t}`,this.confPortalURL);i.searchParams.set("mediaType",w.PSTNAUDIO);const r=this.authService.getRequestHeader(),n=await fetch(i.href,{method:"DELETE",headers:r});if(!n.ok)throw this.logger.debug(`Request ${n.headers.get("x-rainbow-request-id")} failed with status ${n.status}`),n;this.logger.info("disconnectParticipant success")}catch(i){const e=await this.errorHelperService.getErrorInfo(i,"disconnectParticipant");throw this.logger.error("[pgiConferenceService] "+e.message),e.error}}async retrievePstnPhoneNumbers(e=false){if(this.logger.info("retrievePstnPhoneNumbers : "+e),this.pstnConferencePhoneNumbers)return e?this.formatConferenceDialinNumbers(this.pstnConferencePhoneNumbers):this.pstnConferencePhoneNumbers;try{const t=new URL("conferences/audio/phonenumbers",this.confProvPortalURL);t.searchParams.set("shortList","false");const i=this.authService.getRequestHeader(),r=await fetch(t.href,{method:"GET",headers:i});if(!r.ok)throw this.logger.debug(`Request ${r.headers.get("x-rainbow-request-id")} failed with status ${r.status}`),r;const n=await r.json();return this.logger.info("retrievePstnPhoneNumbers success"),this.pstnConferencePhoneNumbers=n.data.phoneNumberList,e?this.formatConferenceDialinNumbers(this.pstnConferencePhoneNumbers):this.pstnConferencePhoneNumbers}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"retrievePstnPhoneNumbers");throw this.logger.error("[pgiConferenceService] "+e.message),e.error}}async resetPersonalMeetingRoom(){this.logger.info("resetPersonalMeetingRoom");try{const e=new URL("meetings/reset",this.confProvPortalURL),t=this.authService.getRequestHeader();t["Content-Type"]="application/json";const i=await fetch(e.href,{method:"PUT",headers:t});if(!i.ok)throw this.logger.debug(`Request ${i.headers.get("x-rainbow-request-id")} failed with status ${i.status}`),i}catch(e){const t=await this.errorHelperService.getErrorInfo(e,"resetPersonalMeetingRoom");throw this.logger.error("[pgiConferenceService] "+t.message),t.error}}formatConferenceDialinNumbers(e){const t={};return e.forEach((e=>{if(e.locationcode){const i=this.countryService.getAlpha2Code(e.locationcode.substr(0,3));i&&(t[i]||(t[i]={numbersList:[]})),t[i].numbersList.push({number:e.number,locationName:e.location,city:e.location.split(", ")[1],numberType:e.numberType,needLanguageSelection:e.needLanguageSelection})}})),t}async refreshConferenceSessions(){this.logger.info("refreshConferenceSessions");try{for(const e in this.conferenceSessions)Object.prototype.hasOwnProperty.call(this.conferenceSessions,e)&&await this.makeSnapshotForConfId(e)}catch(e){this.logger.error("refreshConferenceSessions -- ERROR")}}subscribeToMyConferenceSessions(e){this.conferenceSessions[this.getPstnInstantConferenceEndpointId()]&&this.conferenceSessions[this.getPstnInstantConferenceEndpointId()].activeSubject.pipe(n.distinctUntilChanged()).subscribe(e)}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{constructor(e,t,i,r,n=false,s=[],o=false,a=false){this.id=e,this.userId=t,this.mediaType=i,this.scheduled=r,this.confDialOutDisabled=n,this.passCodes=s,this.playEntryTone=o,this.muteUponEntry=a}static createFromData(e){return new r(e.id,e.userId,e.mediaType,e.scheduled,e.confDialOutDisabled,e.passCodes,e.playEntryTone,e.muteUponEntry)}updateFromData(e){this.id=e.id,this.userId=e.userId,this.mediaType=e.mediaType,this.scheduled=e.scheduled,this.confDialOutDisabled=e.confDialOutDisabled,this.passCodes=e.passCodes,this.playEntryTone=e.playEntryTone,this.muteUponEntry=e.muteUponEntry}}t.ConferenceEndpoint=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(308),n=i(131);class s{constructor(e,t,i,r){this.conferenceStats=null,this.talkers=[],this.talkerSubject=new n.BehaviorSubject(this.talkers),this._haveJoined=false,this.haveJoinedSubject=new n.BehaviorSubject(this._haveJoined),this._joinInProgress=false,this.joinInProgressSubject=new n.BehaviorSubject(this._haveJoined),this._active=false,this.activeSubject=new n.BehaviorSubject(this._active),this._callId="",this.callIdSubject=new n.BehaviorSubject(this._callId),this._participants=[],this.participantsSubject=new n.BehaviorSubject(this._participants),this._lock=false,this.lockSubject=new n.BehaviorSubject(this._lock),this.id=e,this.participants=t,this.active=i,this.type=r}static createFromData(e,t,i,n){return new s(e,t.map((e=>r.ConferenceParticipant.createFromData(e))),i,n)}get haveJoined(){return this._haveJoined}set haveJoined(e){this._haveJoined=e,this.haveJoinedSubject.next(this._haveJoined)}get joinInProgress(){return this._joinInProgress}set joinInProgress(e){this._joinInProgress=e,this.joinInProgressSubject.next(this._joinInProgress)}get active(){return this._active}set active(e){this._active=e,this.activeSubject.next(this._active)}get callId(){return this._callId}set callId(e){this._callId=e,this.callIdSubject.next(this._callId)}get participants(){return this._participants}set participants(e){if(e.length)for(const t of e){if(!t.participantId)return;const e=this.getParticipantById(t.participantId)?this.getParticipantById(t.participantId):this.getParticipantByJid(t.jid_im);e?e.updateFromData(t):this._participants.push(r.ConferenceParticipant.createFromData(t))}else this._participants=[];this.participantsSubject.next(this._participants)}get lock(){return this._lock}set lock(e){this._lock=e,this.lockSubject.next(this._lock)}cleanupSessionData(){this.participants=[],this.talkers=[],this.haveJoined=false}updateFromData(e=[],t=false){this.participants=e,this.active=t}updateStateFromData(e,t){this.active=e,this.lock=t}removeParticipants(e=[]){for(const t of e){const e=this.getParticipantIndexById(t);-1!==e&&this._participants.splice(e,1)}this.participantsSubject.next(this._participants)}updateTalkers(e){this.talkers=e,this.talkerSubject.next(this.talkers)}getParticipants(){return this.participants}getConnectedParticipants(){return this.participants?this.participants.filter((e=>"disconnected"!==e.participantState&&"watching"!==e.participantState)):void 0}getWatchingParticipants(){return this.participants?this.participants.filter((e=>"watching"===e.participantState)):void 0}getConnectedParticipantsExceptLeader(){return this.participants?this.participants.filter((e=>"disconnected"!==e.participantState&&"watching"!==e.participantState&&"moderator"!==e.participantRole)):void 0}getConnectedLeaderParticipantsExcept(e){return this.participants?this.participants.filter((t=>"disconnected"!==t.participantState&&"moderator"===t.participantRole&&t.jid_im!==e)):void 0}getConnectedParticipantsExcept(e){return this.participants?this.participants.filter((t=>t.jid_im!==e&&"disconnected"!==t.participantState&&"watching"!==t.participantState)):void 0}getLeaderParticipant(){return this.participants?this.participants.find((e=>"moderator"===e.participantRole&&"disconnected"!==e.participantState&&"watching"!==e.participantState)):void 0}getLeaderParticipantById(e){return this.participants?this.participants.find((t=>"moderator"===t.participantRole&&"disconnected"!==t.participantState&&"watching"!==t.participantState&&t.jid_im===e)):void 0}getParticipantById(e){return this.participants?this.participants.find((t=>t.participantId===e)):void 0}getParticipantByJid(e){return this.participants?this.participants.find((t=>t.jid_im===e)):void 0}getNonDisconnectedParticipantByJid(e){return this.participants?this.participants.find((t=>t.jid_im===e&&"disconnected"!==t.participantState)):void 0}getConnectedParticipantByJid(e){return this.participants?this.participants.find((t=>t.jid_im===e&&"connected"===t.participantState)):void 0}getWatchingParticipantByJid(e){return this.participants?this.participants.find((t=>t.jid_im===e&&"watching"===t.participantState)):void 0}getParticipantIndexById(e){return this.participants?this.participants.findIndex((t=>t.participantId===e)):-1}isParticipantConnectedByJid(e){return void 0!==this.participants&&this.participants.some((t=>t.jid_im===e&&"connected"===t.participantState))}isParticipantWatchingByJid(e){return void 0!==this.participants&&this.participants.some((t=>t.jid_im===e&&"watching"===t.participantState))}isParticipantRingingByJid(e){return void 0!==this.participants&&this.participants.some((t=>t.jid_im===e&&"ringing"===t.participantState))}isParticipantConnectedWithThisUAByJid(e){return this.haveJoined&&void 0!==this.participants&&this.participants.some((t=>t.jid_im===e&&"connected"===t.participantState))}getTalkers(){return this.talkers}getParticipantStatus(e){if(this.participants&&this.participants.length){const t=this.participants.find((t=>t.jid_im===e));if(t)return t.participantState}return"none"}}t.ConferenceSession=s},function(e,t,i){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:true});var s=i(132),o=i(433),a=i(77),c=i(440),l=i(135),d=i(158),u=function(e){function t(t,i,r){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===i&&(i=Number.POSITIVE_INFINITY);var n=e.call(this)||this;return n.scheduler=r,n._events=[],n._infiniteTimeWindow=false,n._bufferSize=t<1?1:t,n._windowTime=i<1?1:i,i===Number.POSITIVE_INFINITY?(n._infiniteTimeWindow=true,n.next=n.nextInfiniteTimeWindow):n.next=n.nextTimeWindow,n}return n(t,e),t.prototype.nextInfiniteTimeWindow=function(t){var i=this._events;i.push(t),i.length>this._bufferSize&&i.shift(),e.prototype.next.call(this,t)},t.prototype.nextTimeWindow=function(t){this._events.push(new h(this._getNow(),t)),this._trimBufferThenGetEvents(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t,i=this._infiniteTimeWindow,r=i?this._events:this._trimBufferThenGetEvents(),n=this.scheduler,s=r.length;if(this.closed)throw new l.ObjectUnsubscribedError;if(this.isStopped||this.hasError?t=a.Subscription.EMPTY:(this.observers.push(e),t=new d.SubjectSubscription(this,e)),n&&e.add(e=new c.ObserveOnSubscriber(e,n)),i)for(var o=0;o<s&&!e.closed;o++)e.next(r[o]);else for(o=0;o<s&&!e.closed;o++)e.next(r[o].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),t},t.prototype._getNow=function(){return(this.scheduler||o.queue).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,i=this._windowTime,r=this._events,n=r.length,s=0;s<n&&!(e-r[s].time<i);)s++;return n>t&&(s=Math.max(s,n-t)),s>0&&r.splice(0,s),r},t}(s.Subject);t.ReplaySubject=u;var h=function(e,t){this.time=e,this.value=t}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});var r=i(434),n=i(437);t.queueScheduler=new n.QueueScheduler(r.QueueAction),t.queue=t.queueScheduler},function(e,t,i){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:true});var s=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.scheduler=t,r.work=i,r}return n(t,e),t.prototype.schedule=function(t,i){return void 0===i&&(i=0),i>0?e.prototype.schedule.call(this,t,i):(this.delay=i,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,i){return i>0||this.closed?e.prototype.execute.call(this,t,i):this._execute(t,i)},t.prototype.requestAsyncId=function(t,i,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?e.prototype.requestAsyncId.call(this,t,i,r):t.flush(this)},t}(i(435).AsyncAction);t.QueueAction=s},function(e,t,i){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:true});var s=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.scheduler=t,r.work=i,r.pending=false,r}return n(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var i=this.id,r=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(r,i,t)),this.pending=true,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,i){return void 0===i&&(i=0),setInterval(e.flush.bind(e,this),i)},t.prototype.recycleAsyncId=function(e,t,i){if(void 0===i&&(i=0),null!==i&&this.delay===i&&false===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=false;var i=this._execute(e,t);if(i)return i;false===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var i=false,r=void 0;try{this.work(e)}catch(n){i=true,r=!!n&&n||new Error(n)}if(i)return this.unsubscribe(),r},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,i=t.actions,r=i.indexOf(this);this.work=null,this.state=null,this.pending=false,this.scheduler=null,-1!==r&&i.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(i(436).Action);t.AsyncAction=s},function(e,t,i){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:true});var s=function(e){function t(t,i){return e.call(this)||this}return n(t,e),t.prototype.schedule=function(e,t){return this},t}(i(77).Subscription);t.Action=s},function(e,t,i){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:true});var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(i(438).AsyncScheduler);t.QueueScheduler=s},function(e,t,i){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:true});var s=i(439),o=function(e){function t(i,r){void 0===r&&(r=s.Scheduler.now);var n=e.call(this,i,(function(){return t.delegate&&t.delegate!==n?t.delegate.now():r()}))||this;return n.actions=[],n.active=false,n.scheduled=void 0,n}return n(t,e),t.prototype.schedule=function(i,r,n){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(i,r,n):e.prototype.schedule.call(this,i,r,n)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var i;this.active=true;do{if(i=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=false,i){for(;e=t.shift();)e.unsubscribe();throw i}}},t}(s.Scheduler);t.AsyncScheduler=o},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});var r=function(){function e(t,i){void 0===i&&(i=e.now),this.SchedulerAction=t,this.now=i}return e.prototype.schedule=function(e,t,i){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(i,t)},e.now=function(){return Date.now()},e}();t.Scheduler=r},function(e,t,i){var r,n=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:true});var s=i(94),o=i(441);t.observeOn=function(e,t){return void 0===t&&(t=0),function(i){return i.lift(new a(e,t))}};var a=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.scheduler,this.delay))},e}();t.ObserveOnOperator=a;var c=function(e){function t(t,i,r){void 0===r&&(r=0);var n=e.call(this,t)||this;return n.scheduler=i,n.delay=r,n}return n(t,e),t.dispatch=function(e){var t=e.notification,i=e.destination;t.observe(i),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.destination.add(this.scheduler.schedule(t.dispatch,this.delay,new l(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(o.Notification.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(o.Notification.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(o.Notification.createComplete()),this.unsubscribe()},t}(s.Subscriber);t.ObserveOnSubscriber=c;var l=function(e,t){this.notification=e,this.destination=t};t.ObserveOnMessage=l},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});var r=i(442),n=i(443),s=i(447);!function(e){e.NEXT="N",e.ERROR="E",e.COMPLETE="C"}(t.NotificationKind||(t.NotificationKind={}));var o=function(){function e(e,t,i){this.kind=e,this.value=t,this.error=i,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,i){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return i&&i()}},e.prototype.accept=function(e,t,i){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,i)},e.prototype.toObservable=function(){switch(this.kind){case"N":return n.of(this.value);case"E":return s.throwError(this.error);case"C":return r.empty()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}();t.Notification=o},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});var r=i(93);t.EMPTY=new r.Observable((function(e){return e.complete()})),t.empty=function(e){return e?function(e){return new r.Observable((function(t){return e.schedule((function(){return t.complete()}))}))}(e):t.EMPTY}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});var r=i(444),n=i(445),s=i(309);t.of=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=e[e.length-1];return r.isScheduler(i)?(e.pop(),s.scheduleArray(e,i)):n.fromArray(e)}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.isScheduler=function(e){return e&&"function"==typeof e.schedule}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});var r=i(93),n=i(446),s=i(309);t.fromArray=function(e,t){return t?s.scheduleArray(e,t):new r.Observable(n.subscribeToArray(e))}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true}),t.subscribeToArray=function(e){return function(t){for(var i=0,r=e.length;i<r&&!t.closed;i++)t.next(e[i]);t.complete()}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});var r=i(93);function n(e){var t=e.error;e.subscriber.error(t)}t.throwError=function(e,t){return t?new r.Observable((function(i){return t.schedule(n,0,{error:e,subscriber:i})})):new r.Observable((function(t){return t.error(e)}))}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(9),n=i(4),s=i(105),o=i(28),a=i(6),c=i(11);class l{constructor(e){this.telephonyService=e,this.xmppService=r.XmppService.getInstance(),this.logger=n.LoggerService.getInstance(),this.contactService=a.ContactService.getInstance(),this.eventService=c.EventService.getInstance(),this.messageHandlerRef=null,this.overflowUpdatRef=null,this.userConfigurationRef=null,this.huntingGroupUpdateRef=null,this.CallFailureLabels={invalidNumberFormat:"invalidPhoneNumber",destOutOfOrder:"outOfService",destNotObtainable:"outOfService",doNotDisturb:"dnd",busy:"busy",incompatibleDestination:"numberNotAllowed",resourcesNotAvailable:"outOfService"},this.promiseQueue=s.PromiseQueue.create()}static create(e){return new l(e)}attachHandlers(){this.detachHandlers(),this.messageHandlerRef=this.xmppService.addHandler((e=>(this.onCallserviceMessageReceived(e),true)),l.CALLSERVICE_NS,"message",null),this.overflowUpdatRef=this.xmppService.addHandler((e=>(this.onOverflowUpdateMessageReceived(e),true)),l.OVERFLOWUPDATE_NS,"message",null),this.userConfigurationRef=this.xmppService.addHandler((e=>(this.onUserConfigurationMessageReceived(e),true)),l.USERCONFIGURATION_NS,"message",null),this.huntingGroupUpdateRef=this.xmppService.addHandler((e=>(this.onhuntingGroupUpdateMessageReceived(e),true)),null,"message","groupchat")}detachHandlers(){this.messageHandlerRef&&(this.xmppService.deleteHandler(this.messageHandlerRef),this.messageHandlerRef=null),this.overflowUpdatRef&&(this.xmppService.deleteHandler(this.overflowUpdatRef),this.overflowUpdatRef=null),this.userConfigurationRef&&(this.xmppService.deleteHandler(this.userConfigurationRef),this.userConfigurationRef=null),this.huntingGroupUpdateRef&&(this.xmppService.deleteHandler(this.huntingGroupUpdateRef),this.huntingGroupUpdateRef=null)}onCallserviceMessageReceived(e){try{const t=$(e).find("telephony"),i=t.find("forwardUpdated");if(i&&0!==i.length)return void this.onforwardUpdatedMsg(i);const r=t.find("event"),n=r.attr("seqNum");if(!n)return void this.logger.info("[TelephonySipWiseEventHandler] onCallserviceMessageReceived -- no telephony event received then msg ignored");{const e=r.attr("ts"),t=r.attr("cause");this.logger.info("[TelephonySipWiseEventHandler] onCallserviceMessageReceived -- telephony event received and queued: seqNum = "+n+" cause = "+t+" ts = "+e)}this.promiseQueue.add((()=>this.onTelephonyEvent(r,n)))}catch(t){this.logger.error("[TelephonySipWiseEventHandler] onCallserviceMessageReceived -- failure -- "+t.message)}}onOverflowUpdateMessageReceived(e){try{const t=$(e),i=t.find("overflowOnSubscriberUpdated").find("overflowUpdated");i&&0!==i.length&&this.overflowUpdatedMsg(i)}catch(t){this.logger.error("[TelephonySipWiseEventHandler] onOverflowUpdateMessageReceived -- failure -- "+t.message)}}onUserConfigurationMessageReceived(e){try{const t=$(e),i=t.find("routing");i&&0!==i.length&&this.onRoutingUpdatedMsg(i);const r=t.find("cliUpdated");r&&0!==r.length&&this.onCliUpdatedMsg(r)}catch(t){this.logger.error("[TelephonySipWiseEventHandler] onUserConfigurationMessageReceived -- failure -- "+t.message)}}onhuntingGroupUpdateMessageReceived(e){try{const t=$(e).find("rvcpgroup"),i=t.find("member"),r=i.attr("status");t&&0!==t.length&&t.attr("event")&&(this.logger.info("[telephonySipWiseEventHandler] onhuntingGroupUpdateMessageReceived -- update HG received -- "),this.logger.info("[telephonySipWiseEventHandler] onhuntingGroupUpdateMessageReceived -- for memberId/role/status: "+i.attr("memberId")+"/"+i.text()+"/"+r),this.eventService.publish("ON_SIPWISE_HUNTING_GROUP_UPDATE_EVENT"))}catch(t){this.logger.error("[TelephonySipWiseEventHandler] onhuntingGroupUpdateMessageReceived -- failure -- "+t.message)}}onforwardUpdatedMsg(e){this.logger.info("[TelephonySipWiseEventHandler] onforwardUpdatedMsg : msg forwardUpdated received");const t=e.attr("forwardItem");if("user"===t&&this.telephonyService.getForwardStatus(),"group"===t){const t=e.attr("forwardItemId");t?(this.telephonyService.getSipWiseUserGroupsForwards(t),"manager"===this.telephonyService.sipWiseManAssistGetMyRole()&&this.telephonyService.getForwardStatus()):this.telephonyService.getSipWiseUserGroups()}}onRoutingUpdatedMsg(e){this.logger.info("[TelephonySipWiseEventHandler] onRoutingUpdatedMsg : msg routing update received");const t=e.find("routingUpdated"),i=t.find("currentDeviceId").text(),r=t.find("destinations"),n=[],s=this.telephonyService.telephonyServiceSipWise.routingData;i&&r?(s.alsoOfficePhoneRingEnabled=false,r.find("destination").each(((e,t)=>{const i=$(t),r=i.attr("type"),o=i.attr("deviceId");this.logger.info("[TelephonySipWiseEventHandler] onRoutingUpdatedMsg ITER desti / type = "+r+" deviceId = "+o),n.push({deviceId:o,type:r}),"sip"===r&&(s.alsoOfficePhoneRingEnabled=true)})),i&&this.telephonyService.telephonyServiceSipWise.setCurrentDevice(i),n&&n.length&&(this.logger.info("[TelephonySipWiseEventHandler] onRoutingUpdatedMsg  / ringing destinations nb  = "+n.length),s.ringingDestinations=n,this.eventService.publish("ON_SIPWISE_ROUTING_EVENT",this.telephonyService.telephonyServiceSipWise.getCurrentDevice().type,s))):this.logger.info("[TelephonySipWiseEventHandler] onRoutingUpdatedMsg Anomaly: no current/destination elts")}overflowUpdatedMsg(e){this.logger.info("[TelephonySipWiseEventHandler] overflowUpdatedMsg received :"+(null!==e)),this.telephonyService.getForwardStatus()}onCliUpdatedMsg(e){this.logger.info("[TelephonyServiceEventHandlerSipWise] cliUpdatedMsg received");const t=e.find("policy").text(),i=e.find("phoneNumberId").text(),r=e.find("number").text();if(!t||!i||!r)return void this.logger.info("[TelephonyServiceEventHandlerSipWise] onCliUpdatedMsg Anomaly: missing CLI para");const n={policy:t,phoneNumberId:i,number:r};this.telephonyService.getSipWiseAllCli(true),this.eventService.publish("ON_CLI_EVENT",n)}async onTelephonyEvent(e,t){this.logger.info("[TelephonySipWiseEventHandler] [TEL] onTelephonyEvent for seqNum = "+t);const i=[];try{await this.manageAllCalls(e,t,i),await this.manageAllLegs(e,t,i),await this.manageAllEndPoints(e,t,i)}catch(r){this.logger.info("[TelephonySipWiseEventHandler] onTelephonyEvent CATCH / seqNum = "+t);const e="onTelephonyEvent -- "+r.message;this.logger.error("[TelephonySipWiseEventHandler] "+e)}finally{this.callsUpdate(i)}}async manageAllCalls(e,t,i){const r=[];let n=0;e.find("call").each(((s,o)=>{const a=$(o),c=a.attr("callId"),l=a.attr("op");this.logger.debug("[TelephonySipWiseEventHandler] manageAllCalls ITER callId = "+c+" op = "+l+" / seqNum = "+t),"ended"!==l&&n++,r.push((async()=>{try{await this.manageCallElem(a,e,t,i)}catch(r){this.logger.info("[TelephonySipWiseEventHandler] manageAllCalls CATCH / seqNum = "+t);const e="manageAllCalls -- "+r.message;this.logger.error("[TelephonySipWiseEventHandler] "+e)}})())}));try{await Promise.all(r)}finally{this.logger.info("[TelephonySipWiseEventHandler] manageAllCalls : nb living calls = "+n+" / seqNum = "+t)}}async manageCallElem(e,t,i,r){if(e.length)try{const n=e.attr("callId"),s=e.attr("oldCallId"),a=e.attr("op");if(!n){const e="manageCallElem -- Anomaly callId missing / seqNum = "+i;throw this.logger.error("[TelephonySipWiseEventHandler] "+e),new Error(e)}if(!a){const e="manageCallElem -- Anomaly op missing / seqNum = "+i;throw this.logger.error("[TelephonySipWiseEventHandler] "+e),new Error(e)}if(this.logger.info("[TelephonySipWiseEventHandler] manageCallElem callId = "+n+" op = "+a+" / seqNum = "+i),s){const e=this.telephonyService.calls[s];e?(this.logger.info("[TelephonySipWiseEventHandler] manageCallElem : oldcallId = "+s+" ended  / seqNum = "+i),this.telephonyService.clearCall(e,true),r[n]={trigger:true,info:"callended"}):this.logger.info("[TelephonySipWiseEventHandler] manageCallElem : oldCallId "+s+" ended, no call found")}switch(a){case"created":{this.logger.info("[TelephonySipWiseEventHandler] manageCallElem / call creation / seqNum = "+i);const s=this.telephonyService.createCallSipWise(o.Call.Status.UNKNOWN,n);if(s){const r=t.attr("cause");r&&s.setInitCauseSipWiseData(r);const o=e.find("direction").text();o&&s.setDirection(o);const a=e.find("type").text();a&&s.setTypeSipWiseData(a);const c=e.find("called"),l={};l.phoneNumber=c.find("phoneNumber").text(),l.displayName=c.find("displayName").text(),l.phoneNumber||(l.phoneNumber=t.find("phoneNumber").text());const d=l.phoneNumber?l.phoneNumber.charAt(0)+l.phoneNumber.replace(/[^\s](?=.{1,}$)/g,"*").substr(1):"";this.logger.info(`[TelephonySipWiseEventHandler] manageCallElem / call creation / seqNum = ${i} -- setCalledSipWiseData -- ${d}`),s.setCalledSipWiseData(l);const u=e.find("autoOffHookResource").text();u&&(s.setAutoOffHookResource(u),this.logger.info("[TelephonySipWiseEventHandler] manageCallElem autoOffHookResource = "+u+" callId = "+n+" / seqNum = "+i)),"singleStepTransfer"===s.getInitCauseSipWiseData()&&s.getAutoOffHookResource()&&(s.setMixtWebTelSingleStepTrans(true),this.logger.info("[TelephonySipWiseEventHandler] manageCallElem mixtWebTelSingleStepTrans = true for callId = "+n+" / seqNum = "+i))}r[n]={trigger:false,info:"call"+a};break}case"updated":{this.logger.info("[TelephonySipWiseEventHandler] manageCallElem / call update / seqNum = "+i);const s=e.find("called"),o={};o.phoneNumber=s.find("phoneNumber").text(),o.displayName=s.find("displayName").text(),o.phoneNumber||(o.phoneNumber=t.find("phoneNumber").text());const c=this.getCallFromCallId(n);if(c){const e=o.phoneNumber?o.phoneNumber.charAt(0)+o.phoneNumber.replace(/[^\s](?=.{1,}$)/g,"*").substr(1):"";this.logger.info(`[TelephonySipWiseEventHandler] manageCallElem / call update / seqNum = ${i} -- setCalledSipWiseData -- ${e}`),c.setCalledSipWiseData(o)}this.checkCallRelevancy(n)?r[n]={trigger:true,info:"call"+a}:this.logger.info("[TelephonySipWiseEventHandler] manageCallElem : on callId "+n+" updated, not relevant");break}case"ended":this.logger.info("[TelephonySipWiseEventHandler] manageCallElem / call end / seqNum = "+i),this.checkCallRelevancy(n)?(this.logger.info("[TelephonySipWiseEventHandler] manageCallElem : callId = "+n+" ended  / seqNum = "+i),this.telephonyService.clearCall(this.getCallFromCallId(n),true),r[n]={trigger:true,info:"call"+a}):this.logger.info("[TelephonySipWiseEventHandler] manageCallElem : on callId "+n+" ended, not relevant");break;default:{this.logger.info("[TelephonySipWiseEventHandler] manageCallElem / invalid op -> "+a+" / seqNum = "+i);const e="manageCallElem -- Anomaly invalid op / seqNum = "+i;throw this.logger.error("[TelephonySipWiseEventHandler] "+e),new Error(e)}}}catch(n){const e="manageCallElem -- "+n.message;throw new Error(e)}else this.logger.info("[TelephonySipWiseEventHandler] manageCallElem / no CallElem")}async manageAllLegs(e,t,i){const r=[];let n=0;e.find("leg").each(((s,o)=>{const a=$(o),c=a.attr("legId"),l=a.attr("op");this.logger.info("[TelephonySipWiseEventHandler] manageAllLegs ITER legId = "+c+" op = "+l+" / seqNum = "+t),a.length&&("ended"!==l&&n++,r.push((async()=>{try{await this.manageLegElem(a,e,t,i)}catch(r){this.logger.info("[TelephonySipWiseEventHandler] manageAllLegs CATCH / seqNum = "+t);const e="manageAllLegs -- "+r.message;this.logger.error("[TelephonySipWiseEventHandler] "+e)}})()))}));try{await Promise.all(r)}finally{this.logger.info("[TelephonySipWiseEventHandler] manageAllLegs : nb living legs = "+n+" / seqNum = "+t)}}async manageLegElem(e,t,i,r){try{const n=e.attr("legId"),s=e.attr("callId"),o=e.attr("deviceId"),a=e.attr("state"),c=e.attr("op");if(!n){throw new Error("manageLegElem -- Anomaly legId missing / seqNum = "+i)}if(!s){throw new Error("manageLegElem -- Anomaly callId missing / seqNum = "+i)}if(!c){throw new Error("manageLegElem -- Anomaly op missing / seqNum = "+i)}switch(this.logger.info("[TelephonySipWiseEventHandler] manageLegElem legId = "+n+" callId = "+s+" deviceId = "+o+" state = "+a+" op = "+c+" / seqNum = "+i),c){case"created":if(this.computeCallRelevancy(o,s)){this.logger.debug("[TelephonySipWiseEventHandler] manageLegElem / create legId/callId = "+n+"/"+s+" relevant"),await this.legElemCreate(t);this.getCallFromCallId(s).setConnectionIdSipWise(n),r[s]={trigger:true,info:"leg"+c}}else this.logger.info("[TelephonySipWiseEventHandler] manageLegElem / create legId/callId = "+n+"/"+s+" not relevant");break;case"updated":if(this.computeCallRelevancy(o,s)){this.logger.debug("[TelephonySipWiseEventHandler] manageLegElem / update legId/callId = "+n+"/"+s+" relevant"),await this.legElemUpdate(t);this.getCallFromCallId(s).setConnectionIdSipWise(n),r[s]={trigger:true,info:"leg"+c}}else this.logger.info("[TelephonySipWiseEventHandler] manageLegElem / update legId/callId = "+n+"/"+s+" not relevant");break;case"ended":if(this.logger.info("[TelephonySipWiseEventHandler] manageLegElem / leg end / seqNum = "+i),this.computeCallRelevancy(o,s)){this.getCallFromCallId(s)?(this.telephonyService.clearCall(this.getCallFromCallId(s),true),r[s]={trigger:true,info:"leg"+c}):this.logger.info("[TelephonySipWiseEventHandler] manageLegElem : leg ended / call already removed")}else this.logger.info("[TelephonySipWiseEventHandler] manageLegElem : leg ended but not relevant");break;default:{this.logger.info("[TelephonySipWiseEventHandler] manageLegElem / invalid op -> "+c+" / seqNum = "+i);const e="manageLegElem -- Anomaly invalid op / seqNum = "+i;throw this.logger.error("[TelephonySipWiseEventHandler] "+e),new Error(e)}}}catch(n){const e="manageCallElem -- "+n.message;throw new Error(e)}}async manageAllEndPoints(e,t,i){const r=[];let n=0;e.find("endpoint").each(((s,o)=>{const a=$(o),c=a.attr("op");a.length&&("ended"!==c&&n++,r.push((async()=>{try{await this.manageEndPointElem(a,e,t,i)}catch(r){this.logger.info("[TelephonySipWiseEventHandler] manageAllEndPoints CATCH / seqNum = "+t);const e="manageAllEndPoints -- "+r.message;this.logger.error("[TelephonySipWiseEventHandler] "+e)}})()))}));try{await Promise.all(r)}finally{this.logger.info("[TelephonySipWiseEventHandler] manageAllEndPoints : nb living endPoint = "+n+" / seqNum = "+t)}}async manageEndPointElem(e,t,i,r){try{const n=e.attr("endpointId"),s=e.attr("callId"),o=e.attr("op");if(!n){throw new Error("manageEndPointElem -- Anomaly endPointId missing / seqNum = "+i)}if(!s){throw new Error("manageEndPointElem -- Anomaly callId missing / seqNum = "+i)}if(!o){throw new Error("manageEndPointElem -- Anomaly op missing / seqNum = "+i)}let a=null,c=null;const l=e.find("phoneNumber").text(),d=this.getCallFromCallId(s),u=e.find("jid").text();switch(o){case"created":{this.logger.info("[TelephonySipWiseEventHandler] manageEndPointElem: create endPointId/callId = "+n+"/"+s),d.remoteNumber=l;const e=d.getDirection();d.callerNumber="outgoing"===e?this.contactService.userContact.phoneInternalNumber:l,await this.endPointElemCreate(t),this.checkCallRelevancy(s)?(r[s]={trigger:true,info:"endpoint"+o},a=this.analyzeContactChange(u,l,d),a&&a.searchOutlookToBeDone&&d.contact&&(c=await this.telephonyService.updateContactFromOutlookInfos(d.contact,l),c?(this.logger.debug("[TelephonySipWiseEventHandler]  update from outlook for contact :"+d.contact.nameForLogs),this.getCallFromCallId(s).setContact(this.getCallFromCallId(s).contact)):this.logger.debug("[TelephonyHybridEventHandler] no update from outlook for contact :"+d.contact.nameForLogs))):this.logger.info("[TelephonySipWiseEventHandler] manageEndPointElem: create endPointId/callId = "+n+"/"+s+" not yet relevant")}break;case"updated":this.logger.info("[TelephonySipWiseEventHandler] manageEndPointElem / updated"),await this.endPointElemUpdate(t),this.checkCallRelevancy(s)?(a=this.analyzeContactChange(u,l,d),a&&a.searchOutlookToBeDone&&d.contact&&(c=await this.telephonyService.updateContactFromOutlookInfos(d.contact,l),c?this.logger.debug("[TelephonySipWiseEventHandler]  update from outlook for contact :"+d.contact.nameForLogs):this.logger.debug("[TelephonyHybridEventHandler] no update from outlook for contact :"+d.contact.nameForLogs)),this.sendCallUpdateEvent(this.getCallFromCallId(s),{actionElemName:"updatecall"})):this.logger.info("[TelephonySipWiseEventHandler] manageEndPointElem: update endPointId/callId = "+n+"/"+s+" not relevant");break;case"ended":this.logger.info("[TelephonySipWiseEventHandler] manageEndPointElem / ended");break;default:this.logger.info("[TelephonySipWiseEventHandler] manageEndPointElem / invalid op -> "+o+" / seqNum = "+i);throw new Error("manageEndPointElem / Anomaly unmanaged op : "+o)}}catch(n){const e="manageEndPointElem -- "+n.message;throw new Error(e)}}async legElemCreate(e){const t=e.find("leg");try{const i=await this.getCall(t),r=t.attr("state"),n=t.attr("deviceId");if(!n){const e="legElemCreate -- Anomaly deviceId missing";throw this.logger.error("[TelephonySipWiseEventHandler] "+e),new Error(e)}this.logger.info("[TelephonySipWiseEventHandler] legElemCreate / leg state : "+r+" / deviceId : "+n),i.setDeviceIdSipWise(n),i.setRelevantEquipmentId(n),this.callsetStatusFromLegState(i,r,e)}catch(i){this.logger.info("[TelephonySipWiseEventHandler] legElemCreate catch");const e="legElemCreate -- "+i.message;throw this.logger.error("[TelephonySipWiseEventHandler] "+e),new Error(e)}}async legElemUpdate(e){const t=e.find("leg");try{const i=await this.getCall(t),r=t.attr("state");this.callsetStatusFromLegState(i,r,e)}catch(i){this.logger.info("[TelephonySipWiseEventHandler] legElemUpdate catch");const e="legElemUpdate -- "+i.message;throw this.logger.error("[TelephonySipWiseEventHandler] "+e),new Error(e)}}async endPointElemCreate(e){const t=e.find("endpoint"),i=t.attr("callId"),r=t.find("phoneNumber").text(),n=t.find("jid").text(),s=t.find("firstName").text(),o=t.find("lastName").text(),a=t.find("displayName").text(),c=t.find("type").text();if(n||r){const e=await this.contactService.getOrCreateContact(n,r);n||(s&&o?e.updateName(s,o):a&&e.updateName("",a));const l=this.getCallFromCallId(i);i&&l?(l.setEndPointDeviceListSipWise(this.endPointDevicesMng(t)),l.setContact(e),c&&(l.distantType=c),this.logger.info("[TelephonySipWiseEventHandler] endPointElemCreate setContact DONE : displayName = "+l.contact.nameForLog)):this.logger.info("[TelephonySipWiseEventHandler] endPointElemCreate NOT DONE / no associated call")}else{const e="endPointElemCreate -- Anomaly no jid no phoneNumber";this.logger.error("[TelephonySipWiseEventHandler] "+e)}}async endPointElemUpdate(e){const t=e.find("endpoint"),i=t.attr("callId"),r=t.find("phoneNumber").text(),n=t.find("jid").text(),s=t.find("firstName").text(),o=t.find("lastName").text(),a=t.find("displayName").text(),c=t.find("type").text();if(n||r){const e=await this.contactService.getOrCreateContact(n,r);n||(s&&o?e.updateName(s,o):a&&e.updateName("",a));const l=this.getCallFromCallId(i);i&&l?(l.setEndPointDeviceListSipWise(this.endPointDevicesMng(t)),l.setContact(e),c&&(l.distantType=c),this.logger.info("[TelephonySipWiseEventHandler] endPointElemUpdate setContact DONE : displayName = "+l.contact.nameForLog)):this.logger.info("[TelephonySipWiseEventHandler] endPointElemUpdate setContact NOT DONE / no associated call")}else{const e="endPointElemUpdate -- Anomaly no jid no phoneNumber";this.logger.error("[TelephonySipWiseEventHandler] "+e)}}endPointDevicesMng(e){const t=e.attr("callId"),i=e.attr("endpointId"),r=[];if(t&&i)e.find("device").each(((e,n)=>{const s=$(n),o=s.attr("type"),a=s.attr("deviceId");o&&a&&r.push({callId:t,endpointId:i,deviceType:o,deviceId:a})}));else{const e="endPointDevicesMng -- Anomaly no callId or endpointId";this.logger.error("[TelephonySipWiseEventHandler] "+e)}return r}onFailCallEvent(e,t){const i=t.find("failedReason").text();this.logger.info("[TelephonySipWiseEventHandler] onFailCallEvent for callId : "+e.id+" / call status ERROR / cause : "+i),e.setStatus(o.Call.Status.ERROR),e.errorMessage=this.CallFailureLabels[i],e.errorMessage||(e.errorMessage=i),setTimeout((()=>{e&&e.status===o.Call.Status.ERROR&&(this.telephonyService.releaseCall(e),e.setStatus(o.Call.Status.UNKNOWN),this.eventService.publish("ON_CALL_UPDATED_EVENT",e))}),5e3)}convLegStateToCallStatus(e){let t=null;if(!e)return this.logger.info("[TelephonySipWiseEventHandler] convLegStateToCallStatus Anomaly no legState"),t;switch(e){case"initiated":case"dialing":t=o.Call.Status.DIALING;break;case"ringingIn":t=o.Call.Status.RINGING_INCOMMING;break;case"ringingOut":t=o.Call.Status.RINGING_OUTGOING;break;case"queued":t=o.Call.Status.QUEUED_INCOMMING;break;case"active":t=o.Call.Status.ACTIVE;break;case"hold":t=o.Call.Status.HOLD;break;case"holdVictim":t=o.Call.Status.PUT_ON_HOLD;break;case"failed":t=o.Call.Status.ERROR;break;default:this.logger.info("[TelephonySipWiseEventHandler] convLegStateToCallStatus Anomaly legState = "+e)}return t}callsetStatusFromLegState(e,t,i){if(!e||!t)return void this.logger.info("[TelephonySipWiseEventHandler] callsetStatusFromLegState Anomaly Call = "+e+" legState"+t);const r=this.convLegStateToCallStatus(t);r===o.Call.Status.ERROR?this.onFailCallEvent(e,i):e.setStatus(r),this.logger.info("[TelephonySipWiseEventHandler] callsetStatusFromLegState legstate = "+t+" Call.status = "+e.status.value)}getCallFromCallId(e){if(!e)return this.logger.debug("[TelephonySipWiseEventHandler] getCallFromCallId - Anomaly no callId"),null;const t=this.telephonyService.calls[e];return t?(this.logger.debug("[TelephonySipWiseEventHandler] getCallFromCallId = "+e+" -  call: "+t),t):null}async getCall(e){const t=e.attr("callId"),i=e.attr("legId");return await this.getOrCreateCall(t,i)}async getOrCreateCall(e,t){if(!e){const e="getOrCreateCall -- Anomaly no callId";throw this.logger.error("[TelephonySipWiseEventHandler] "+e),new Error(e)}let i=this.telephonyService.calls[e];if(i&&i.getConnectionIdSipWise())return this.logger.debug("[TelephonySipWiseEventHandler] getOrCreateCall - "+e+" -  => found completed call: "+i),i;if(this.logger.debug("[TelephonySipWiseEventHandler] getOrCreateCall - "+e+" -  => not completed : manage it"),!t){const e="getOrCreateCall -- Anomaly no LegId";throw this.logger.error("[TelephonySipWiseEventHandler] "+e),new Error(e)}return i=await this.telephonyService.getOrCreateCallSipWise(o.Call.Status.UNKNOWN,e,t),i}sendCallUpdateEvent(e,t){if(e){e.autoClear&&(clearTimeout(e.autoClear),e.autoClear=null),this.logger.info("[TelephonySipWiseEventHandler] [TEL] sendCallUpdateEvent for call "+e);const i=this.extractInfoEvent(t);this.eventService.publish("ON_CALL_UPDATED_EVENT",e,i)}}extractInfoEvent(e){let t=null;return e&&null!==e&&(t=e),t}callsUpdate(e){this.logger.info("[TelephonySipWiseEventHandler] CallsUpdate"),Object.keys(e||[]).forEach((t=>{e[t]&&e[t].trigger?(this.logger.info("[TelephonySipWiseEventHandler] CallsUpdate for callId "+t+" triggered"),this.sendCallUpdateEvent(this.getCallFromCallId(t),e[t].info)):this.logger.info("[TelephonySipWiseEventHandler] CallsUpdate for callId "+t+" no triggered")}))}computeCallRelevancy(e,t){let i=false;const r=this.telephonyService.telephonyServiceSipWise.getCurrentDevice();if(e&&r&&(i=e===r.deviceId),t){const r=this.getCallFromCallId(t);r&&r.getMixtWebTelSingleStepTrans()&&(i=true,this.logger.info("[TelephonySipWiseEventHandler] computeCallRelevancy for deviceId : "+e+" / special mixte (webrtc&sip) transfer"))}return this.logger.info("[TelephonySipWiseEventHandler] computeCallRelevancy for deviceId : "+e+" / relevant = "+i),i}checkCallRelevancy(e){let t=false;const i=this.telephonyService.telephonyServiceSipWise.getCurrentDevice(),r=this.getCallFromCallId(e);return r&&i&&(this.logger.debug("[TelephonySipWiseEventHandler] checkCallRelevancy call.deviceID = "+r.getDeviceIdSipWise()),t=r.getDeviceIdSipWise()===i.deviceId),r&&r.getMixtWebTelSingleStepTrans()&&(t=true,this.logger.info("[TelephonySipWiseEventHandler] checkCallRelevancy for callId : "+e+" / special mixte (webrtc&sip) transfer")),this.logger.info("[TelephonySipWiseEventHandler] checkCallRelevancy for callId : "+e+" / relevant = "+t),t}analyzeContactChange(e,t,i){let r=false,n=false;return e||t?i.isConference?void 0:i.contact?(""!==e?i.contact.id!==e&&(r=true,n=false):i.contact.temp?i.contact.id!==t?(r=true,n=true):i.contact.displayName===t&&(r=false,n=true):i.getCurrentCalled()&&""!==i.getCurrentCalled().contactPhoneNumber&&""!==t&&i.getCurrentCalled().contactPhoneNumber!==t&&(r=true,n=true),r||n?{updateContactToBeDone:r,searchOutlookToBeDone:n}:null):{updateContactToBeDone:true,searchOutlookToBeDone:true}:null}}l.CALLSERVICE_NS="urn:xmpp:pbxagent:telephony:1",l.OVERFLOWUPDATE_NS="urn:xmpp:pbxagent:overflowOnSubscriberUpdated:1",l.USERCONFIGURATION_NS="urn:xmpp:rvcp:userConfiguration:1",l.HUNTINGGROUPUPDATE_NS="jabber:iq:notification",t.TelephonySipWiseEventHandler=l},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7);t.VoiceMessage=class{constructor(e,t,i,n,s,o,a){this.id=e,this.contact=t,this.unread=i,this.duration=n,this.date=new Date(s),this.dateString=s,this.from=o,this.jid=a,this.directoryContactId=null,this.rxSubject=new r.Subject}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7);t.Favorite=class{constructor(e,t,i){this.rxSubject=new r.Subject,this.id=e,this.peerId=t,this.type=i}updateContact(e){this.contact=e,this.rxSubject.next({name:"updateFavoriteContact",data:e})}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(66),n=i(76);i(313);const s=i(6),o=i(9),a=i(46),c=i(4),l=i(37),d=i(47),u=i(110),h=i(310);t.ConversationServiceBulkHistoryHandler=class{constructor(e){this.conversationService=e,this.xmppService=o.XmppService.getInstance(),this.i18n=a.I18nService.getInstance(),this.logger=c.LoggerService.getInstance(),this.contactService=s.ContactService.getInstance(),this.fileStorageService=l.FileStorageService.getInstance(),this.fileServerService=d.FileServerService.getInstance(),this.utilitiesService=u.UtilitiesService.getInstance()}async getHistoryPage(e,t){this.logger.info(`[ConversationServiceBulkHistoryHandler] getHistoryPage(${e.id})`);try{return this.getHistoryPageInternal(e,t)}catch(i){return this.logger.info("[ConversationServiceBulkHistoryHandler] "+i.message),null}}async getHistoryPageAroundMessage(e,t){this.logger.info(`[ConversationServiceBulkHistoryHandler] getHistoryPageAroundDate(${e.id}, ${t})`),await this.getHistoryPageInternal(e,15,"after",t),await this.getHistoryPageInternal(e,15,"before",t)}async getHistoryPageFromTimeTillNow(e,t){for(this.logger.info(`[ConversationServiceBulkHistoryHandler] getHistoryPage(${e.id}) - from ${t}`),await this.getHistoryPageInternal(e,5,"before",t),await this.getHistoryPageInternal(e,250,"after",t);!e.historyBelowComplete;)await this.getHistoryPageInternal(e,250,"after",e.historyLastIndex)}async getHistoryPageInternal(e,t,i="before",r=null){this.logger.info(`[ConversationServiceBulkHistoryHandler] getHistoryPage(${e.id}, ${t})`);const n=new Promise((t=>{e.historyDefered={resolve:t}}));if(e.room&&e.room.initPresPromise&&await e.room.initPresPromise.promise,e.currentHistoryId&&e.currentHistoryId===e.historyIndex){const i=`getHistoryPage(${e.id}, ${t}, ${e.historyIndex}) --- already asked`;throw this.logger.info("[ConversationServiceBulkHistoryHandler] "+i),new Error(i)}if(e.currentHistoryId=e.historyIndex,"before"===i&&e.historyAboveComplete){const t=`getHistoryPage(${e.id}) --- historyAboveComplete`;throw this.logger.info("[ConversationServiceBulkHistoryHandler] "+t),new Error(t)}if("after"===i&&e.historyBelowComplete){const t=`getHistoryPage(${e.id}) --- historyBelowComplete`;throw this.logger.info("[ConversationServiceBulkHistoryHandler] "+t),new Error(t)}const s=e.id,o=`${e.id}${this.utilitiesService.randomString(5)}`,a=e.room?e.room.jid:null,c=e.room?this.contactService.userContact.jid:e.id,l=$iq({id:o,to:a,type:"set"}).c("query",{queryid:s,xmlns:"urn:xmpp:mam:1:bulk"}).c("x",{xmlns:"jabber:x:data",type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("urn:xmpp:mam:1").up().up().c("field",{var:"with"}).c("value").t(c).up().up().up().c("set",{xmlns:"http://jabber.org/protocol/rsm"}).c("max").t(t).up();if(r){const e="after"===i?Number(r)-1:r;l.c(i).t(e)}else-1===e.historyIndex?l.c(i).t(""):l.c(i).t(e.historyIndex);const d=performance.now();await this.xmppService.sendIQ(l);const u=Math.round(performance.now()-d);return await n,this.logger.info(`[ConversationServiceBulkHistoryHandler] getHistoryPage(${e.id}) -- duration ${u}ms`),e}resetHistory(e){const t=e.messages.length;if(t>90){this.logger.info("[ConversationServiceBulkHistoryHandler] resetHistory for conversation "+e.id);const i=t-30;e.messages.splice(0,i),e.currentHistoryId=null,e.historyAboveComplete=false,e.historyBelowComplete=false,e.historyIndex=e.messages[0].historyIndex}}onHistoryMessageReceived(e){try{this.logger.info("[conversationService] onHistoryMessageReceived");const t=$(e).find("results");if(1===t.length){const e=t.find("result");if(e.length>0){const i=$(e[0]).attr("queryid");this.logger.info(`[ConversationServiceBulkHistoryHandler] onHistoryMessageReceived "results" (${i})`);const r=this.conversationService.getConversation(i);r&&t.find("result").each(((e,t)=>{const i=$(t).find("forwarded message"),n=i.attr("from"),s=$(i).find("forwarded[xmlns='urn:xmpp:forward:0']");if(s&&s.length){this.logger.info("[ConversationServiceBulkHistoryHandler] ("+r.id+") Forwarded Message detected");const e=i.attr("id"),o=$(s).find("forwarded message"),a=o.attr("id"),c=r.getMessageByIdInHistory(a);this.createMessage(r,t,o,n,e,c)}else this.createMessage(r,t,i,n,null,null)}))}}else{const t=$(e).find("fin"),i=$(e).attr("id"),r=i.substring(0,i.length-5);this.logger.info(`[ConversationServiceBulkHistoryHandler] onHistoryMessageReceived "fin" (${r})`);const n=this.conversationService.getConversation(r);if(n){n.historyIndex=$(t).find("set first").text(),n.historyLastIndex=$(t).find("set last").text(),n.historyIndex===n.historyLastIndex?n.historyAboveComplete="true"===t.attr("complete"):n.historyBelowComplete="true"===t.attr("complete");const e=n.historyMessages[0].date.getTime(),i=n.messages.findIndex((t=>t.date.getTime()>e));if(n.messages.splice(i,0,...n.historyMessages),n.historyMessages=[],n.lastMessageText="",n.lastMessageSender=null,n.messages&&n.messages.length>0){const e=n.messages[n.messages.length-1];n.lastMessageText=e.data,n.lastMessageSender=e.from.id}n.historyDefered&&n.historyDefered.resolve()}}}catch(t){return this.logger.error("[ConversationServiceBulkHistoryHandler] onHistoryMessageReceived -- failure -- "+t),true}return true}createMessage(e,t,i,n,s,o){const a=s||i.attr("id");let c=e.getMessageById(a);if(c||(c=e.historyMessages.find((e=>e.id===a))),c||(c=e.getReplacedMessageById(a)),c)return void this.logger.info("[ConversationServiceBulkHistoryHandler] ("+e.id+") try to add an already stored message with id "+c.id);let l=null,d=i.attr("type"),u=n&&0===n.indexOf("room_")?n.split("/")[1]:this.xmppService.getBareJidFromJid(n),f=null;const p=$(t).find("event");if((!u||p.length)&&p.length){if(u=p.attr("jid"),f=p.attr("name"),e.room){if(e.room.isMeetingRoom()&&("welcome"===f||"conferenceAdd"===f||"conferenceRemove"===f||"invitation"===f))return;if(e.room.isWebinarRoom())return;if("welcome"===f&&e.room.ownerContact&&(u=e.room.ownerContact.jid),"conferenceAdd"!==f&&"conferenceRemove"!==f||!e.room.ownerContact)"voicemessage"===f&&(u=this.contactService.userContact.jid);else{const t=e.room.getUserByJid(u);l=t&&t.contact?t.contact:e.room.ownerContact}}d="admin"}if(!u)return void this.logger.warn("[ConversationServiceBulkHistoryHandler] onHistoryMessageReceived - Receive message without valid fromJid information");if("webrtc"===d||"phone"===d){d="webrtc";const e=$(t).find("caller").text();l=this.contactService.getContact(e)}l||(l=this.contactService.getContact(u)),l||(l=this.contactService.createEmptyContact(u));const g=new Date($(t).find("forwarded delay").attr("stamp"));let m=$(i).find("body").text();const v=this.contactService.isUserContact(l)?r.Message.Side.RIGHT:r.Message.Side.LEFT,S=$(t).find("geoloc");let b=null;if(S&&S.length){const e=$(S);b={lon:e.find("lon").text(),lat:e.find("lat").text()}}let y="std";const C=$(i).find("headers[xmlns='http://jabber.org/protocol/shim']");if(C&&C.length){const e=$(C).find("header[name='Urgency']");e&&e.length&&(y=e.text())}const w=$(i).find("x[xmlns='jabber:x:oob']");if(w&&w.length&&(d="fileSharing"),$(t).find("call_log").length){const e=$(t).find("state").text();if("missed"===e)m="missedCall||"+g;else if("answered"===e){const e=$(t).find("duration")?parseInt($(t).find("duration").text(),10):0;m=`activeCallMsg||${g}||${e>0?`(${moment.duration(e,"ms").format("h[H] mm[m] ss[s]")})`:""}`}}let _="";if("voicemessage"===f){const e=$(i).find("gmwi"),t=e.find("message").attr("new"),r=e.find("message").attr("old");_=this.i18n.translate("huntingGroupVmCounters",{newMsgs:t,oldMsgs:r})}const E=$(t).find("url-metadata"),T=[];switch(E&&E.each(((e,t)=>{const i=$(t);T.push(h.UrlMetaData.create({title:i.attr("title"),url:i.attr("url"),description:i.attr("description"),image:i.attr("image")}))})),d){case"webrtc":c=r.Message.createWebRTCMessage(a,g,l,v,m,false);break;case"admin":c=r.Message.createBubbleAdminMessage(a,g,l,f,_);break;case"fileSharing":c=this.createFileSharingMessage(w,a,g,l,v,m,b);break;case"recording":break;default:{const i=$(t).find("content[xmlns='urn:xmpp:content']");let n=null;if(i&&i.length>0){const e=$(i[0]);n=r.MessageAdditionalContent.create(e.attr("type"),e.text())}let s=null;const o=$(t).find("mention[xmlns='urn:xmpp:attention:0']");if(o.length){s=[];o.find("jid").each(((e,t)=>{const i={};i.jid=$(t).text(),i.pos=parseInt($(t).attr("pos"),10),i.size=parseInt($(t).attr("size"),10),i.jid&&s.push(i)}))}const d=$(t).find("replace");if(d&&d.length){const t=d.attr("id");let i=e.getMessageByIdInHistory(t);if(i||(i=e.getMessageById(t)),i||(i=r.Message.create(t,g,l,v,m,false,n,null,null,null,s),c=i),l.jid!==i.from.jid)this.logger.warn("[ConversationServiceBulkHistoryHandler] onHistoryMessageReceived : message Replaced by somebody else - Skip"),c=null;else if(i){i.addReplaceMsg(a,m),i.mentions=s;const e=m.length?m.substr(0,1)+"***"+m.substr(m.length-1):"";this.logger.info("Add new history replace message for message "+a+" witn body "+e)}}else{const i=$(t).find("answeredMsg"),o=i?i.text():null,d=i?i.attr("stamp"):null;c=r.Message.create(a,g,l,v,m,false,n,null,o,d,s),c.urgency=y,c.urlMetadata=T.length>0?T[0]:null;const u=$(t).find("modified");u&&u.length&&(c.modified=true);const h=$(t).find("deleted");if(h&&h.length&&(c.deleted=true),o){const t=e.getMessageByIdInHistory(o);t?(t.urgencyAck=true,t.sendUpdateEvent()):this.logger.error("[ConversationServiceBulkHistoryHandler] Not possible to handle answeredMsg because replied msg not found")}}}}if(c){c.isForwarded=null!==o,c.forwardedMsg=o,c.urgency=y,c.historyIndex=$(t).attr("id");const n=$(i).find("ack"),s=c.side!==r.Message.Side.RIGHT||$(n).attr("readtime")||"true"!==$(n).attr("read")?5:4;if(c.receiptStatus="true"===$(n).attr("read")?s:"true"===$(n).attr("recv")?4:3,c.isAdaptiveCardResponse()){const t=JSON.parse(c.additionalContent.message);t&&""===t.rainbow.text||e.addMessageInHistoryMessages(c)}else e.addMessageInHistoryMessages(c);this.logger.info("Add new history message : "+c.getInfoForLogs())}}createFileSharingMessage(e,t,i,s,o,a,c,l=null){const d=$(e),u=d.find("url").text(),h=d.find("filename").text(),f=this.fileStorageService.extractFileIdFromUrl(u),p=r.Message.createFileSharingMessage(t,i,s,o,a,false,f,h,null,c,l);return this.fileStorageService.retrieveAndStoreOneFileDescriptor(f).then((e=>{e&&e.state===n.FileState.NOT_UPLOADED&&(p.receiptStatus=1,p.fileErrorMsg=this.i18n.translate("file_notuploaded")),this.fileServerService.getBlobThumbnailFromFileDescriptor(e).then((t=>{e.previewBlob=t,e.previewBlobSubject.next(e.previewBlob)})).catch((()=>{this.logger.info("[ConversationServiceBulkHistoryHandler] getBlobThumbnailFromFileDescriptor error "),e.previewBlobSubject.next(e.previewBlob)}))})).catch((e=>{this.logger.info("[ConversationServiceBulkHistoryHandler] createFileSharingMessage error "+e)})),p}}},function(e,t,i){var r;
/*!
     * jQuery JavaScript Library v3.5.1
     * https://jquery.com/
     *
     * Includes Sizzle.js
     * https://sizzlejs.com/
     *
     * Copyright JS Foundation and other contributors
     * Released under the MIT license
     * https://jquery.org/license
     *
     * Date: 2020-05-04T22:49Z
     */!function(t,i){"object"==typeof e.exports?e.exports=t.document?i(t,true):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return i(e)}:i(t)}("undefined"!=typeof window?window:this,(function(i,n){var s=[],o=Object.getPrototypeOf,a=s.slice,c=s.flat?function(e){return s.flat.call(e)}:function(e){return s.concat.apply([],e)},l=s.push,d=s.indexOf,u={},h=u.toString,f=u.hasOwnProperty,p=f.toString,g=p.call(Object),m={},v=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},S=function(e){return null!=e&&e===e.window},b=i.document,y={type:true,src:true,nonce:true,noModule:true};function C(e,t,i){var r,n,s=(i=i||b).createElement("script");if(s.text=e,t)for(r in y)(n=t[r]||t.getAttribute&&t.getAttribute(r))&&s.setAttribute(r,n);i.head.appendChild(s).parentNode.removeChild(s)}function w(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?u[h.call(e)]||"object":typeof e}var _=function(e,t){return new _.fn.init(e,t)};function E(e){var t=!!e&&"length"in e&&e.length,i=w(e);return!v(e)&&!S(e)&&("array"===i||0===t||"number"==typeof t&&t>0&&t-1 in e)}_.fn=_.prototype={jquery:"3.5.1",constructor:_,length:0,toArray:function(){return a.call(this)},get:function(e){return null==e?a.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=_.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return _.each(this,e)},map:function(e){return this.pushStack(_.map(this,(function(t,i){return e.call(t,i,t)})))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(_.grep(this,(function(e,t){return(t+1)%2})))},odd:function(){return this.pushStack(_.grep(this,(function(e,t){return t%2})))},eq:function(e){var t=this.length,i=+e+(e<0?t:0);return this.pushStack(i>=0&&i<t?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:l,sort:s.sort,splice:s.splice},_.extend=_.fn.extend=function(){var e,t,i,r,n,s,o=arguments[0]||{},a=1,c=arguments.length,l=false;for("boolean"==typeof o&&(l=o,o=arguments[a]||{},a++),"object"==typeof o||v(o)||(o={}),a===c&&(o=this,a--);a<c;a++)if(null!=(e=arguments[a]))for(t in e)r=e[t],"__proto__"!==t&&o!==r&&(l&&r&&(_.isPlainObject(r)||(n=Array.isArray(r)))?(i=o[t],s=n&&!Array.isArray(i)?[]:n||_.isPlainObject(i)?i:{},n=false,o[t]=_.extend(l,s,r)):void 0!==r&&(o[t]=r));return o},_.extend({expando:"jQuery"+("3.5.1"+Math.random()).replace(/\D/g,""),isReady:true,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,i;return!(!e||"[object Object]"!==h.call(e))&&(!(t=o(e))||"function"==typeof(i=f.call(t,"constructor")&&t.constructor)&&p.call(i)===g)},isEmptyObject:function(e){var t;for(t in e)return false;return true},globalEval:function(e,t,i){C(e,{nonce:t&&t.nonce},i)},each:function(e,t){var i,r=0;if(E(e))for(i=e.length;r<i&&false!==t.call(e[r],r,e[r]);r++);else for(r in e)if(false===t.call(e[r],r,e[r]))break;return e},makeArray:function(e,t){var i=t||[];return null!=e&&(E(Object(e))?_.merge(i,"string"==typeof e?[e]:e):l.call(i,e)),i},inArray:function(e,t,i){return null==t?-1:d.call(t,e,i)},merge:function(e,t){for(var i=+t.length,r=0,n=e.length;r<i;r++)e[n++]=t[r];return e.length=n,e},grep:function(e,t,i){for(var r=[],n=0,s=e.length,o=!i;n<s;n++)!t(e[n],n)!==o&&r.push(e[n]);return r},map:function(e,t,i){var r,n,s=0,o=[];if(E(e))for(r=e.length;s<r;s++)null!=(n=t(e[s],s,i))&&o.push(n);else for(s in e)null!=(n=t(e[s],s,i))&&o.push(n);return c(o)},guid:1,support:m}),"function"==typeof Symbol&&(_.fn[Symbol.iterator]=s[Symbol.iterator]),_.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(e,t){u["[object "+t+"]"]=t.toLowerCase()}));var T=
/*!
         * Sizzle CSS Selector Engine v2.3.5
         * https://sizzlejs.com/
         *
         * Copyright JS Foundation and other contributors
         * Released under the MIT license
         * https://js.foundation/
         *
         * Date: 2020-03-14
         */function(e){var t,i,r,n,s,o,a,c,l,d,u,h,f,p,g,m,v,S,b,y="sizzle"+1*new Date,C=e.document,w=0,_=0,E=ce(),T=ce(),I=ce(),P=ce(),A=function(e,t){return e===t&&(u=true),0},M={}.hasOwnProperty,D=[],R=D.pop,O=D.push,N=D.push,x=D.slice,L=function(e,t){for(var i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},k="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",F="[\\x20\\t\\r\\n\\f]",U="(?:\\\\[\\da-fA-F]{1,6}"+F+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",j="\\["+F+"*("+U+")(?:"+F+"*([*^$|!~]?=)"+F+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+U+"))|)"+F+"*\\]",W=":("+U+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+j+")*)|.*)\\)|)",B=new RegExp(F+"+","g"),H=new RegExp("^"+F+"+|((?:^|[^\\\\])(?:\\\\.)*)"+F+"+$","g"),V=new RegExp("^"+F+"*,"+F+"*"),Y=new RegExp("^"+F+"*([>+~]|"+F+")"+F+"*"),G=new RegExp(F+"|>"),$=new RegExp(W),z=new RegExp("^"+U+"$"),J={ID:new RegExp("^#("+U+")"),CLASS:new RegExp("^\\.("+U+")"),TAG:new RegExp("^("+U+"|[*])"),ATTR:new RegExp("^"+j),PSEUDO:new RegExp("^"+W),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+F+"*(even|odd|(([+-]|)(\\d*)n|)"+F+"*(?:([+-]|)"+F+"*(\\d+)|))"+F+"*\\)|)","i"),bool:new RegExp("^(?:"+k+")$","i"),needsContext:new RegExp("^"+F+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+F+"*((?:-\\d)?\\d*)"+F+"*\\)|)(?=[^-]|$)","i")},q=/HTML$/i,K=/^(?:input|select|textarea|button)$/i,X=/^h\d$/i,Q=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+F+"?|\\\\([^\\r\\n\\f])","g"),ie=function(e,t){var i="0x"+e.slice(1)-65536;return t||(i<0?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320))},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ne=function(e,t){return t?"\0"===e?"":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},se=function(){h()},oe=ye((function(e){return true===e.disabled&&"fieldset"===e.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{N.apply(D=x.call(C.childNodes),C.childNodes),D[C.childNodes.length].nodeType}catch(Te){N={apply:D.length?function(e,t){O.apply(e,x.call(t))}:function(e,t){for(var i=e.length,r=0;e[i++]=t[r++];);e.length=i-1}}}function ae(e,t,r,n){var s,a,l,d,u,p,v,S=t&&t.ownerDocument,C=t?t.nodeType:9;if(r=r||[],"string"!=typeof e||!e||1!==C&&9!==C&&11!==C)return r;if(!n&&(h(t),t=t||f,g)){if(11!==C&&(u=Z.exec(e)))if(s=u[1]){if(9===C){if(!(l=t.getElementById(s)))return r;if(l.id===s)return r.push(l),r}else if(S&&(l=S.getElementById(s))&&b(t,l)&&l.id===s)return r.push(l),r}else{if(u[2])return N.apply(r,t.getElementsByTagName(e)),r;if((s=u[3])&&i.getElementsByClassName&&t.getElementsByClassName)return N.apply(r,t.getElementsByClassName(s)),r}if(i.qsa&&!P[e+" "]&&(!m||!m.test(e))&&(1!==C||"object"!==t.nodeName.toLowerCase())){if(v=e,S=t,1===C&&(G.test(e)||Y.test(e))){for((S=ee.test(e)&&ve(t.parentNode)||t)===t&&i.scope||((d=t.getAttribute("id"))?d=d.replace(re,ne):t.setAttribute("id",d=y)),a=(p=o(e)).length;a--;)p[a]=(d?"#"+d:":scope")+" "+be(p[a]);v=p.join(",")}try{return N.apply(r,S.querySelectorAll(v)),r}catch(w){P(e,true)}finally{d===y&&t.removeAttribute("id")}}}return c(e.replace(H,"$1"),t,r,n)}function ce(){var e=[];return function t(i,n){return e.push(i+" ")>r.cacheLength&&delete t[e.shift()],t[i+" "]=n}}function le(e){return e[y]=true,e}function de(e){var t=f.createElement("fieldset");try{return!!e(t)}catch(Te){return false}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ue(e,t){for(var i=e.split("|"),n=i.length;n--;)r.attrHandle[i[n]]=t}function he(e,t){var i=t&&e,r=i&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(i){for(;i=i.nextSibling;)if(i===t)return-1}return e?1:-1}function fe(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function pe(e){return function(t){var i=t.nodeName.toLowerCase();return("input"===i||"button"===i)&&t.type===e}}function ge(e){return function(t){return"form"in t?t.parentNode&&false===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&oe(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function me(e){return le((function(t){return t=+t,le((function(i,r){for(var n,s=e([],i.length,t),o=s.length;o--;)i[n=s[o]]&&(i[n]=!(r[n]=i[n]))}))}))}function ve(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in i=ae.support={},s=ae.isXML=function(e){var t=e.namespaceURI,i=(e.ownerDocument||e).documentElement;return!q.test(t||i&&i.nodeName||"HTML")},h=ae.setDocument=function(e){var t,n,o=e?e.ownerDocument||e:C;return o!=f&&9===o.nodeType&&o.documentElement?(p=(f=o).documentElement,g=!s(f),C!=f&&(n=f.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",se,false):n.attachEvent&&n.attachEvent("onunload",se)),i.scope=de((function(e){return p.appendChild(e).appendChild(f.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length})),i.attributes=de((function(e){return e.className="i",!e.getAttribute("className")})),i.getElementsByTagName=de((function(e){return e.appendChild(f.createComment("")),!e.getElementsByTagName("*").length})),i.getElementsByClassName=Q.test(f.getElementsByClassName),i.getById=de((function(e){return p.appendChild(e).id=y,!f.getElementsByName||!f.getElementsByName(y).length})),i.getById?(r.filter.ID=function(e){var t=e.replace(te,ie);return function(e){return e.getAttribute("id")===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var i=t.getElementById(e);return i?[i]:[]}}):(r.filter.ID=function(e){var t=e.replace(te,ie);return function(e){var i=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return i&&i.value===t}},r.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var i,r,n,s=t.getElementById(e);if(s){if((i=s.getAttributeNode("id"))&&i.value===e)return[s];for(n=t.getElementsByName(e),r=0;s=n[r++];)if((i=s.getAttributeNode("id"))&&i.value===e)return[s]}return[]}}),r.find.TAG=i.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):i.qsa?t.querySelectorAll(e):void 0}:function(e,t){var i,r=[],n=0,s=t.getElementsByTagName(e);if("*"===e){for(;i=s[n++];)1===i.nodeType&&r.push(i);return r}return s},r.find.CLASS=i.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&g)return t.getElementsByClassName(e)},v=[],m=[],(i.qsa=Q.test(f.querySelectorAll))&&(de((function(e){var t;p.appendChild(e).innerHTML="<a id='"+y+"'></a><select id='"+y+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]="+F+`*(?:''|"")`),e.querySelectorAll("[selected]").length||m.push("\\["+F+"*(?:value|"+k+")"),e.querySelectorAll("[id~="+y+"-]").length||m.push("~="),(t=f.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||m.push("\\["+F+"*name"+F+"*="+F+`*(?:''|"")`),e.querySelectorAll(":checked").length||m.push(":checked"),e.querySelectorAll("a#"+y+"+*").length||m.push(".#.+[+~]"),e.querySelectorAll("\\\f"),m.push("[\\r\\n\\f]")})),de((function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=f.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+F+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&m.push(":enabled",":disabled"),p.appendChild(e).disabled=true,2!==e.querySelectorAll(":disabled").length&&m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")}))),(i.matchesSelector=Q.test(S=p.matches||p.webkitMatchesSelector||p.mozMatchesSelector||p.oMatchesSelector||p.msMatchesSelector))&&de((function(e){i.disconnectedMatch=S.call(e,"*"),S.call(e,"[s!='']:x"),v.push("!=",W)})),m=m.length&&new RegExp(m.join("|")),v=v.length&&new RegExp(v.join("|")),t=Q.test(p.compareDocumentPosition),b=t||Q.test(p.contains)?function(e,t){var i=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(i.contains?i.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t){for(;t=t.parentNode;)if(t===e)return true}return false},A=t?function(e,t){if(e===t)return u=true,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r||(1&(r=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!i.sortDetached&&t.compareDocumentPosition(e)===r?e==f||e.ownerDocument==C&&b(C,e)?-1:t==f||t.ownerDocument==C&&b(C,t)?1:d?L(d,e)-L(d,t):0:4&r?-1:1)}:function(e,t){if(e===t)return u=true,0;var i,r=0,n=e.parentNode,s=t.parentNode,o=[e],a=[t];if(!n||!s)return e==f?-1:t==f?1:n?-1:s?1:d?L(d,e)-L(d,t):0;if(n===s)return he(e,t);for(i=e;i=i.parentNode;)o.unshift(i);for(i=t;i=i.parentNode;)a.unshift(i);for(;o[r]===a[r];)r++;return r?he(o[r],a[r]):o[r]==C?-1:a[r]==C?1:0},f):f},ae.matches=function(e,t){return ae(e,null,null,t)},ae.matchesSelector=function(e,t){if(h(e),i.matchesSelector&&g&&!P[t+" "]&&(!v||!v.test(t))&&(!m||!m.test(t)))try{var r=S.call(e,t);if(r||i.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(Te){P(t,true)}return ae(t,f,null,[e]).length>0},ae.contains=function(e,t){return(e.ownerDocument||e)!=f&&h(e),b(e,t)},ae.attr=function(e,t){(e.ownerDocument||e)!=f&&h(e);var n=r.attrHandle[t.toLowerCase()],s=n&&M.call(r.attrHandle,t.toLowerCase())?n(e,t,!g):void 0;return void 0!==s?s:i.attributes||!g?e.getAttribute(t):(s=e.getAttributeNode(t))&&s.specified?s.value:null},ae.escape=function(e){return(e+"").replace(re,ne)},ae.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ae.uniqueSort=function(e){var t,r=[],n=0,s=0;if(u=!i.detectDuplicates,d=!i.sortStable&&e.slice(0),e.sort(A),u){for(;t=e[s++];)t===e[s]&&(n=r.push(s));for(;n--;)e.splice(r[n],1)}return d=null,e},n=ae.getText=function(e){var t,i="",r=0,s=e.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=n(e)}else if(3===s||4===s)return e.nodeValue}else for(;t=e[r++];)i+=n(t);return i},(r=ae.selectors={cacheLength:50,createPseudo:le,match:J,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ie),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ie),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ae.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ae.error(e[0]),e},PSEUDO:function(e){var t,i=!e[6]&&e[2];return J.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":i&&$.test(i)&&(t=o(i,true))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ie).toLowerCase();return"*"===e?function(){return true}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=E[e+" "];return t||(t=new RegExp("(^|"+F+")"+e+"("+F+"|$)"))&&E(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,i){return function(r){var n=ae.attr(r,e);return null==n?"!="===t:!t||(n+="","="===t?n===i:"!="===t?n!==i:"^="===t?i&&0===n.indexOf(i):"*="===t?i&&n.indexOf(i)>-1:"$="===t?i&&n.slice(-i.length)===i:"~="===t?(" "+n.replace(B," ")+" ").indexOf(i)>-1:"|="===t&&(n===i||n.slice(0,i.length+1)===i+"-"))}},CHILD:function(e,t,i,r,n){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),a="of-type"===t;return 1===r&&0===n?function(e){return!!e.parentNode}:function(t,i,c){var l,d,u,h,f,p,g=s!==o?"nextSibling":"previousSibling",m=t.parentNode,v=a&&t.nodeName.toLowerCase(),S=!c&&!a,b=false;if(m){if(s){for(;g;){for(h=t;h=h[g];)if(a?h.nodeName.toLowerCase()===v:1===h.nodeType)return false;p=g="only"===e&&!p&&"nextSibling"}return true}if(p=[o?m.firstChild:m.lastChild],o&&S){for(b=(f=(l=(d=(u=(h=m)[y]||(h[y]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]||[])[0]===w&&l[1])&&l[2],h=f&&m.childNodes[f];h=++f&&h&&h[g]||(b=f=0)||p.pop();)if(1===h.nodeType&&++b&&h===t){d[e]=[w,f,b];break}}else if(S&&(b=f=(l=(d=(u=(h=t)[y]||(h[y]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]||[])[0]===w&&l[1]),false===b)for(;(h=++f&&h&&h[g]||(b=f=0)||p.pop())&&((a?h.nodeName.toLowerCase()!==v:1!==h.nodeType)||!++b||(S&&((d=(u=h[y]||(h[y]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]=[w,b]),h!==t)););return(b-=n)===r||b%r==0&&b/r>=0}}},PSEUDO:function(e,t){var i,n=r.pseudos[e]||r.setFilters[e.toLowerCase()]||ae.error("unsupported pseudo: "+e);return n[y]?n(t):n.length>1?(i=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?le((function(e,i){for(var r,s=n(e,t),o=s.length;o--;)e[r=L(e,s[o])]=!(i[r]=s[o])})):function(e){return n(e,0,i)}):n}},pseudos:{not:le((function(e){var t=[],i=[],r=a(e.replace(H,"$1"));return r[y]?le((function(e,t,i,n){for(var s,o=r(e,null,n,[]),a=e.length;a--;)(s=o[a])&&(e[a]=!(t[a]=s))})):function(e,n,s){return t[0]=e,r(t,null,s,i),t[0]=null,!i.pop()}})),has:le((function(e){return function(t){return ae(e,t).length>0}})),contains:le((function(e){return e=e.replace(te,ie),function(t){return(t.textContent||n(t)).indexOf(e)>-1}})),lang:le((function(e){return z.test(e||"")||ae.error("unsupported lang: "+e),e=e.replace(te,ie).toLowerCase(),function(t){var i;do{if(i=g?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(i=i.toLowerCase())===e||0===i.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return false}})),target:function(t){var i=e.location&&e.location.hash;return i&&i.slice(1)===t.id},root:function(e){return e===p},focus:function(e){return e===f.activeElement&&(!f.hasFocus||f.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(false),disabled:ge(true),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,true===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return false;return true},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return X.test(e.nodeName)},input:function(e){return K.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:me((function(){return[0]})),last:me((function(e,t){return[t-1]})),eq:me((function(e,t,i){return[i<0?i+t:i]})),even:me((function(e,t){for(var i=0;i<t;i+=2)e.push(i);return e})),odd:me((function(e,t){for(var i=1;i<t;i+=2)e.push(i);return e})),lt:me((function(e,t,i){for(var r=i<0?i+t:i>t?t:i;--r>=0;)e.push(r);return e})),gt:me((function(e,t,i){for(var r=i<0?i+t:i;++r<t;)e.push(r);return e}))}}).pseudos.nth=r.pseudos.eq,{radio:true,checkbox:true,file:true,password:true,image:true})r.pseudos[t]=fe(t);for(t in{submit:true,reset:true})r.pseudos[t]=pe(t);function Se(){}function be(e){for(var t=0,i=e.length,r="";t<i;t++)r+=e[t].value;return r}function ye(e,t,i){var r=t.dir,n=t.next,s=n||r,o=i&&"parentNode"===s,a=_++;return t.first?function(t,i,n){for(;t=t[r];)if(1===t.nodeType||o)return e(t,i,n);return false}:function(t,i,c){var l,d,u,h=[w,a];if(c){for(;t=t[r];)if((1===t.nodeType||o)&&e(t,i,c))return true}else for(;t=t[r];)if(1===t.nodeType||o)if(d=(u=t[y]||(t[y]={}))[t.uniqueID]||(u[t.uniqueID]={}),n&&n===t.nodeName.toLowerCase())t=t[r]||t;else{if((l=d[s])&&l[0]===w&&l[1]===a)return h[2]=l[2];if(d[s]=h,h[2]=e(t,i,c))return true}return false}}function Ce(e){return e.length>1?function(t,i,r){for(var n=e.length;n--;)if(!e[n](t,i,r))return false;return true}:e[0]}function we(e,t,i,r,n){for(var s,o=[],a=0,c=e.length,l=null!=t;a<c;a++)(s=e[a])&&(i&&!i(s,r,n)||(o.push(s),l&&t.push(a)));return o}function _e(e,t,i,r,n,s){return r&&!r[y]&&(r=_e(r)),n&&!n[y]&&(n=_e(n,s)),le((function(s,o,a,c){var l,d,u,h=[],f=[],p=o.length,g=s||function(e,t,i){for(var r=0,n=t.length;r<n;r++)ae(e,t[r],i);return i}(t||"*",a.nodeType?[a]:a,[]),m=!e||!s&&t?g:we(g,h,e,a,c),v=i?n||(s?e:p||r)?[]:o:m;if(i&&i(m,v,a,c),r)for(l=we(v,f),r(l,[],a,c),d=l.length;d--;)(u=l[d])&&(v[f[d]]=!(m[f[d]]=u));if(s){if(n||e){if(n){for(l=[],d=v.length;d--;)(u=v[d])&&l.push(m[d]=u);n(null,v=[],l,c)}for(d=v.length;d--;)(u=v[d])&&(l=n?L(s,u):h[d])>-1&&(s[l]=!(o[l]=u))}}else v=we(v===o?v.splice(p,v.length):v),n?n(null,o,v,c):N.apply(o,v)}))}function Ee(e){for(var t,i,n,s=e.length,o=r.relative[e[0].type],a=o||r.relative[" "],c=o?1:0,d=ye((function(e){return e===t}),a,true),u=ye((function(e){return L(t,e)>-1}),a,true),h=[function(e,i,r){var n=!o&&(r||i!==l)||((t=i).nodeType?d(e,i,r):u(e,i,r));return t=null,n}];c<s;c++)if(i=r.relative[e[c].type])h=[ye(Ce(h),i)];else{if((i=r.filter[e[c].type].apply(null,e[c].matches))[y]){for(n=++c;n<s&&!r.relative[e[n].type];n++);return _e(c>1&&Ce(h),c>1&&be(e.slice(0,c-1).concat({value:" "===e[c-2].type?"*":""})).replace(H,"$1"),i,c<n&&Ee(e.slice(c,n)),n<s&&Ee(e=e.slice(n)),n<s&&be(e))}h.push(i)}return Ce(h)}return Se.prototype=r.filters=r.pseudos,r.setFilters=new Se,o=ae.tokenize=function(e,t){var i,n,s,o,a,c,l,d=T[e+" "];if(d)return t?0:d.slice(0);for(a=e,c=[],l=r.preFilter;a;){for(o in i&&!(n=V.exec(a))||(n&&(a=a.slice(n[0].length)||a),c.push(s=[])),i=false,(n=Y.exec(a))&&(i=n.shift(),s.push({value:i,type:n[0].replace(H," ")}),a=a.slice(i.length)),r.filter)!(n=J[o].exec(a))||l[o]&&!(n=l[o](n))||(i=n.shift(),s.push({value:i,type:o,matches:n}),a=a.slice(i.length));if(!i)break}return t?a.length:a?ae.error(e):T(e,c).slice(0)},a=ae.compile=function(e,t){var i,n=[],s=[],a=I[e+" "];if(!a){for(t||(t=o(e)),i=t.length;i--;)(a=Ee(t[i]))[y]?n.push(a):s.push(a);(a=I(e,function(e,t){var i=t.length>0,n=e.length>0,s=function(s,o,a,c,d){var u,p,m,v=0,S="0",b=s&&[],y=[],C=l,_=s||n&&r.find.TAG("*",d),E=w+=null==C?1:Math.random()||.1,T=_.length;for(d&&(l=o==f||o||d);S!==T&&null!=(u=_[S]);S++){if(n&&u){for(p=0,o||u.ownerDocument==f||(h(u),a=!g);m=e[p++];)if(m(u,o||f,a)){c.push(u);break}d&&(w=E)}i&&((u=!m&&u)&&v--,s&&b.push(u))}if(v+=S,i&&S!==v){for(p=0;m=t[p++];)m(b,y,o,a);if(s){if(v>0)for(;S--;)b[S]||y[S]||(y[S]=R.call(c));y=we(y)}N.apply(c,y),d&&!s&&y.length>0&&v+t.length>1&&ae.uniqueSort(c)}return d&&(w=E,l=C),b};return i?le(s):s}(s,n))).selector=e}return a},c=ae.select=function(e,t,i,n){var s,c,l,d,u,h="function"==typeof e&&e,f=!n&&o(e=h.selector||e);if(i=i||[],1===f.length){if((c=f[0]=f[0].slice(0)).length>2&&"ID"===(l=c[0]).type&&9===t.nodeType&&g&&r.relative[c[1].type]){if(!(t=(r.find.ID(l.matches[0].replace(te,ie),t)||[])[0]))return i;h&&(t=t.parentNode),e=e.slice(c.shift().value.length)}for(s=J.needsContext.test(e)?0:c.length;s--&&(l=c[s],!r.relative[d=l.type]);)if((u=r.find[d])&&(n=u(l.matches[0].replace(te,ie),ee.test(c[0].type)&&ve(t.parentNode)||t))){if(c.splice(s,1),!(e=n.length&&be(c)))return N.apply(i,n),i;break}}return(h||a(e,f))(n,t,!g,i,!t||ee.test(e)&&ve(t.parentNode)||t),i},i.sortStable=y.split("").sort(A).join("")===y,i.detectDuplicates=!!u,h(),i.sortDetached=de((function(e){return 1&e.compareDocumentPosition(f.createElement("fieldset"))})),de((function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")}))||ue("type|href|height|width",(function(e,t,i){if(!i)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),i.attributes&&de((function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}))||ue("value",(function(e,t,i){if(!i&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),de((function(e){return null==e.getAttribute("disabled")}))||ue(k,(function(e,t,i){var r;if(!i)return true===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null})),ae}(i);_.find=T,_.expr=T.selectors,_.expr[":"]=_.expr.pseudos,_.uniqueSort=_.unique=T.uniqueSort,_.text=T.getText,_.isXMLDoc=T.isXML,_.contains=T.contains,_.escapeSelector=T.escape;var I=function(e,t,i){for(var r=[],n=void 0!==i;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(n&&_(e).is(i))break;r.push(e)}return r},P=function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i},A=_.expr.match.needsContext;function M(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var D=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function R(e,t,i){return v(t)?_.grep(e,(function(e,r){return!!t.call(e,r,e)!==i})):t.nodeType?_.grep(e,(function(e){return e===t!==i})):"string"!=typeof t?_.grep(e,(function(e){return d.call(t,e)>-1!==i})):_.filter(t,e,i)}_.filter=function(e,t,i){var r=t[0];return i&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?_.find.matchesSelector(r,e)?[r]:[]:_.find.matches(e,_.grep(t,(function(e){return 1===e.nodeType})))},_.fn.extend({find:function(e){var t,i,r=this.length,n=this;if("string"!=typeof e)return this.pushStack(_(e).filter((function(){for(t=0;t<r;t++)if(_.contains(n[t],this))return true})));for(i=this.pushStack([]),t=0;t<r;t++)_.find(e,n[t],i);return r>1?_.uniqueSort(i):i},filter:function(e){return this.pushStack(R(this,e||[],false))},not:function(e){return this.pushStack(R(this,e||[],true))},is:function(e){return!!R(this,"string"==typeof e&&A.test(e)?_(e):e||[],false).length}});var O,N=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(_.fn.init=function(e,t,i){var r,n;if(!e)return this;if(i=i||O,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:N.exec(e))||!r[1]&&t)return!t||t.jquery?(t||i).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof _?t[0]:t,_.merge(this,_.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:b,true)),D.test(r[1])&&_.isPlainObject(t))for(r in t)v(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(n=b.getElementById(r[2]))&&(this[0]=n,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):v(e)?void 0!==i.ready?i.ready(e):e(_):_.makeArray(e,this)}).prototype=_.fn,O=_(b);var x=/^(?:parents|prev(?:Until|All))/,L={children:true,contents:true,next:true,prev:true};function k(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}_.fn.extend({has:function(e){var t=_(e,this),i=t.length;return this.filter((function(){for(var e=0;e<i;e++)if(_.contains(this,t[e]))return true}))},closest:function(e,t){var i,r=0,n=this.length,s=[],o="string"!=typeof e&&_(e);if(!A.test(e)){for(;r<n;r++)for(i=this[r];i&&i!==t;i=i.parentNode)if(i.nodeType<11&&(o?o.index(i)>-1:1===i.nodeType&&_.find.matchesSelector(i,e))){s.push(i);break}}return this.pushStack(s.length>1?_.uniqueSort(s):s)},index:function(e){return e?"string"==typeof e?d.call(_(e),this[0]):d.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(_.uniqueSort(_.merge(this.get(),_(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),_.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return I(e,"parentNode")},parentsUntil:function(e,t,i){return I(e,"parentNode",i)},next:function(e){return k(e,"nextSibling")},prev:function(e){return k(e,"previousSibling")},nextAll:function(e){return I(e,"nextSibling")},prevAll:function(e){return I(e,"previousSibling")},nextUntil:function(e,t,i){return I(e,"nextSibling",i)},prevUntil:function(e,t,i){return I(e,"previousSibling",i)},siblings:function(e){return P((e.parentNode||{}).firstChild,e)},children:function(e){return P(e.firstChild)},contents:function(e){return null!=e.contentDocument&&o(e.contentDocument)?e.contentDocument:(M(e,"template")&&(e=e.content||e),_.merge([],e.childNodes))}},(function(e,t){_.fn[e]=function(i,r){var n=_.map(this,t,i);return"Until"!==e.slice(-5)&&(r=i),r&&"string"==typeof r&&(n=_.filter(r,n)),this.length>1&&(L[e]||_.uniqueSort(n),x.test(e)&&n.reverse()),this.pushStack(n)}}));var F=/[^\x20\t\r\n\f]+/g;function U(e){return e}function j(e){throw e}function W(e,t,i,r){var n;try{e&&v(n=e.promise)?n.call(e).done(t).fail(i):e&&v(n=e.then)?n.call(e,t,i):t.apply(void 0,[e].slice(r))}catch(s){i.apply(void 0,[s])}}_.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return _.each(e.match(F)||[],(function(e,i){t[i]=true})),t}(e):_.extend({},e);var t,i,r,n,s=[],o=[],a=-1,c=function(){for(n=n||e.once,r=t=true;o.length;a=-1)for(i=o.shift();++a<s.length;)false===s[a].apply(i[0],i[1])&&e.stopOnFalse&&(a=s.length,i=false);e.memory||(i=false),t=false,n&&(s=i?[]:"")},l={add:function(){return s&&(i&&!t&&(a=s.length-1,o.push(i)),function t(i){_.each(i,(function(i,r){v(r)?e.unique&&l.has(r)||s.push(r):r&&r.length&&"string"!==w(r)&&t(r)}))}(arguments),i&&!t&&c()),this},remove:function(){return _.each(arguments,(function(e,t){for(var i;(i=_.inArray(t,s,i))>-1;)s.splice(i,1),i<=a&&a--})),this},has:function(e){return e?_.inArray(e,s)>-1:s.length>0},empty:function(){return s&&(s=[]),this},disable:function(){return n=o=[],s=i="",this},disabled:function(){return!s},lock:function(){return n=o=[],i||t||(s=i=""),this},locked:function(){return!!n},fireWith:function(e,i){return n||(i=[e,(i=i||[]).slice?i.slice():i],o.push(i),t||c()),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l},_.extend({Deferred:function(e){var t=[["notify","progress",_.Callbacks("memory"),_.Callbacks("memory"),2],["resolve","done",_.Callbacks("once memory"),_.Callbacks("once memory"),0,"resolved"],["reject","fail",_.Callbacks("once memory"),_.Callbacks("once memory"),1,"rejected"]],r="pending",n={state:function(){return r},always:function(){return s.done(arguments).fail(arguments),this},catch:function(e){return n.then(null,e)},pipe:function(){var e=arguments;return _.Deferred((function(i){_.each(t,(function(t,r){var n=v(e[r[4]])&&e[r[4]];s[r[1]]((function(){var e=n&&n.apply(this,arguments);e&&v(e.promise)?e.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[r[0]+"With"](this,n?[e]:arguments)}))})),e=null})).promise()},then:function(e,r,n){var s=0;function o(e,t,r,n){return function(){var a=this,c=arguments,l=function(){var i,l;if(!(e<s)){if((i=r.apply(a,c))===t.promise())throw new TypeError("Thenable self-resolution");l=i&&("object"==typeof i||"function"==typeof i)&&i.then,v(l)?n?l.call(i,o(s,t,U,n),o(s,t,j,n)):(s++,l.call(i,o(s,t,U,n),o(s,t,j,n),o(s,t,U,t.notifyWith))):(r!==U&&(a=void 0,c=[i]),(n||t.resolveWith)(a,c))}},d=n?l:function(){try{l()}catch(i){_.Deferred.exceptionHook&&_.Deferred.exceptionHook(i,d.stackTrace),e+1>=s&&(r!==j&&(a=void 0,c=[i]),t.rejectWith(a,c))}};e?d():(_.Deferred.getStackHook&&(d.stackTrace=_.Deferred.getStackHook()),i.setTimeout(d))}}return _.Deferred((function(i){t[0][3].add(o(0,i,v(n)?n:U,i.notifyWith)),t[1][3].add(o(0,i,v(e)?e:U)),t[2][3].add(o(0,i,v(r)?r:j))})).promise()},promise:function(e){return null!=e?_.extend(e,n):n}},s={};return _.each(t,(function(e,i){var o=i[2],a=i[5];n[i[1]]=o.add,a&&o.add((function(){r=a}),t[3-e][2].disable,t[3-e][3].disable,t[0][2].lock,t[0][3].lock),o.add(i[3].fire),s[i[0]]=function(){return s[i[0]+"With"](this===s?void 0:this,arguments),this},s[i[0]+"With"]=o.fireWith})),n.promise(s),e&&e.call(s,s),s},when:function(e){var t=arguments.length,i=t,r=Array(i),n=a.call(arguments),s=_.Deferred(),o=function(e){return function(i){r[e]=this,n[e]=arguments.length>1?a.call(arguments):i,--t||s.resolveWith(r,n)}};if(t<=1&&(W(e,s.done(o(i)).resolve,s.reject,!t),"pending"===s.state()||v(n[i]&&n[i].then)))return s.then();for(;i--;)W(n[i],o(i),s.reject);return s.promise()}});var B=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;_.Deferred.exceptionHook=function(e,t){i.console&&i.console.warn&&e&&B.test(e.name)&&i.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},_.readyException=function(e){i.setTimeout((function(){throw e}))};var H=_.Deferred();function V(){b.removeEventListener("DOMContentLoaded",V),i.removeEventListener("load",V),_.ready()}_.fn.ready=function(e){return H.then(e).catch((function(e){_.readyException(e)})),this},_.extend({isReady:false,readyWait:1,ready:function(e){(true===e?--_.readyWait:_.isReady)||(_.isReady=true,true!==e&&--_.readyWait>0||H.resolveWith(b,[_]))}}),_.ready.then=H.then,"complete"===b.readyState||"loading"!==b.readyState&&!b.documentElement.doScroll?i.setTimeout(_.ready):(b.addEventListener("DOMContentLoaded",V),i.addEventListener("load",V));var Y=function(e,t,i,r,n,s,o){var a=0,c=e.length,l=null==i;if("object"===w(i))for(a in n=true,i)Y(e,t,a,i[a],true,s,o);else if(void 0!==r&&(n=true,v(r)||(o=true),l&&(o?(t.call(e,r),t=null):(l=t,t=function(e,t,i){return l.call(_(e),i)})),t))for(;a<c;a++)t(e[a],i,o?r:r.call(e[a],a,t(e[a],i)));return n?e:l?t.call(e):c?t(e[0],i):s},G=/^-ms-/,$=/-([a-z])/g;function z(e,t){return t.toUpperCase()}function J(e){return e.replace(G,"ms-").replace($,z)}var q=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function K(){this.expando=_.expando+K.uid++}K.uid=1,K.prototype={cache:function(e){var t=e[this.expando];return t||(t={},q(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:true}))),t},set:function(e,t,i){var r,n=this.cache(e);if("string"==typeof t)n[J(t)]=i;else for(r in t)n[J(r)]=t[r];return n},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][J(t)]},access:function(e,t,i){return void 0===t||t&&"string"==typeof t&&void 0===i?this.get(e,t):(this.set(e,t,i),void 0!==i?i:t)},remove:function(e,t){var i,r=e[this.expando];if(void 0!==r){if(void 0!==t){i=(t=Array.isArray(t)?t.map(J):(t=J(t))in r?[t]:t.match(F)||[]).length;for(;i--;)delete r[t[i]]}(void 0===t||_.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!_.isEmptyObject(t)}};var X=new K,Q=new K,Z=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ee=/[A-Z]/g;function te(e,t,i){var r;if(void 0===i&&1===e.nodeType)if(r="data-"+t.replace(ee,"-$&").toLowerCase(),"string"==typeof(i=e.getAttribute(r))){try{i=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:Z.test(e)?JSON.parse(e):e)}(i)}catch(n){}Q.set(e,t,i)}else i=void 0;return i}_.extend({hasData:function(e){return Q.hasData(e)||X.hasData(e)},data:function(e,t,i){return Q.access(e,t,i)},removeData:function(e,t){Q.remove(e,t)},_data:function(e,t,i){return X.access(e,t,i)},_removeData:function(e,t){X.remove(e,t)}}),_.fn.extend({data:function(e,t){var i,r,n,s=this[0],o=s&&s.attributes;if(void 0===e){if(this.length&&(n=Q.get(s),1===s.nodeType&&!X.get(s,"hasDataAttrs"))){for(i=o.length;i--;)o[i]&&0===(r=o[i].name).indexOf("data-")&&(r=J(r.slice(5)),te(s,r,n[r]));X.set(s,"hasDataAttrs",true)}return n}return"object"==typeof e?this.each((function(){Q.set(this,e)})):Y(this,(function(t){var i;if(s&&void 0===t)return void 0!==(i=Q.get(s,e))||void 0!==(i=te(s,e))?i:void 0;this.each((function(){Q.set(this,e,t)}))}),null,t,arguments.length>1,null,true)},removeData:function(e){return this.each((function(){Q.remove(this,e)}))}}),_.extend({queue:function(e,t,i){var r;if(e)return t=(t||"fx")+"queue",r=X.get(e,t),i&&(!r||Array.isArray(i)?r=X.access(e,t,_.makeArray(i)):r.push(i)),r||[]},dequeue:function(e,t){t=t||"fx";var i=_.queue(e,t),r=i.length,n=i.shift(),s=_._queueHooks(e,t);"inprogress"===n&&(n=i.shift(),r--),n&&("fx"===t&&i.unshift("inprogress"),delete s.stop,n.call(e,(function(){_.dequeue(e,t)}),s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return X.get(e,i)||X.access(e,i,{empty:_.Callbacks("once memory").add((function(){X.remove(e,[t+"queue",i])}))})}}),_.fn.extend({queue:function(e,t){var i=2;return"string"!=typeof e&&(t=e,e="fx",i--),arguments.length<i?_.queue(this[0],e):void 0===t?this:this.each((function(){var i=_.queue(this,e,t);_._queueHooks(this,e),"fx"===e&&"inprogress"!==i[0]&&_.dequeue(this,e)}))},dequeue:function(e){return this.each((function(){_.dequeue(this,e)}))},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var i,r=1,n=_.Deferred(),s=this,o=this.length,a=function(){--r||n.resolveWith(s,[s])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";o--;)(i=X.get(s[o],e+"queueHooks"))&&i.empty&&(r++,i.empty.add(a));return a(),n.promise(t)}});var ie=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,re=new RegExp("^(?:([+-])=|)("+ie+")([a-z%]*)$","i"),ne=["Top","Right","Bottom","Left"],se=b.documentElement,oe=function(e){return _.contains(e.ownerDocument,e)},ae={composed:true};se.getRootNode&&(oe=function(e){return _.contains(e.ownerDocument,e)||e.getRootNode(ae)===e.ownerDocument});var ce=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&oe(e)&&"none"===_.css(e,"display")};function le(e,t,i,r){var n,s,o=20,a=r?function(){return r.cur()}:function(){return _.css(e,t,"")},c=a(),l=i&&i[3]||(_.cssNumber[t]?"":"px"),d=e.nodeType&&(_.cssNumber[t]||"px"!==l&&+c)&&re.exec(_.css(e,t));if(d&&d[3]!==l){for(c/=2,l=l||d[3],d=+c||1;o--;)_.style(e,t,d+l),(1-s)*(1-(s=a()/c||.5))<=0&&(o=0),d/=s;d*=2,_.style(e,t,d+l),i=i||[]}return i&&(d=+d||+c||0,n=i[1]?d+(i[1]+1)*i[2]:+i[2],r&&(r.unit=l,r.start=d,r.end=n)),n}var de={};function ue(e){var t,i=e.ownerDocument,r=e.nodeName,n=de[r];return n||(t=i.body.appendChild(i.createElement(r)),n=_.css(t,"display"),t.parentNode.removeChild(t),"none"===n&&(n="block"),de[r]=n,n)}function he(e,t){for(var i,r,n=[],s=0,o=e.length;s<o;s++)(r=e[s]).style&&(i=r.style.display,t?("none"===i&&(n[s]=X.get(r,"display")||null,n[s]||(r.style.display="")),""===r.style.display&&ce(r)&&(n[s]=ue(r))):"none"!==i&&(n[s]="none",X.set(r,"display",i)));for(s=0;s<o;s++)null!=n[s]&&(e[s].style.display=n[s]);return e}_.fn.extend({show:function(){return he(this,true)},hide:function(){return he(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each((function(){ce(this)?_(this).show():_(this).hide()}))}});var fe,pe,ge=/^(?:checkbox|radio)$/i,me=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,ve=/^$|^module$|\/(?:java|ecma)script/i;fe=b.createDocumentFragment().appendChild(b.createElement("div")),(pe=b.createElement("input")).setAttribute("type","radio"),pe.setAttribute("checked","checked"),pe.setAttribute("name","t"),fe.appendChild(pe),m.checkClone=fe.cloneNode(true).cloneNode(true).lastChild.checked,fe.innerHTML="<textarea>x</textarea>",m.noCloneChecked=!!fe.cloneNode(true).lastChild.defaultValue,fe.innerHTML="<option></option>",m.option=!!fe.lastChild;var Se={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function be(e,t){var i;return i=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&M(e,t)?_.merge([e],i):i}function ye(e,t){for(var i=0,r=e.length;i<r;i++)X.set(e[i],"globalEval",!t||X.get(t[i],"globalEval"))}Se.tbody=Se.tfoot=Se.colgroup=Se.caption=Se.thead,Se.th=Se.td,m.option||(Se.optgroup=Se.option=[1,"<select multiple='multiple'>","</select>"]);var Ce=/<|&#?\w+;/;function we(e,t,i,r,n){for(var s,o,a,c,l,d,u=t.createDocumentFragment(),h=[],f=0,p=e.length;f<p;f++)if((s=e[f])||0===s)if("object"===w(s))_.merge(h,s.nodeType?[s]:s);else if(Ce.test(s)){for(o=o||u.appendChild(t.createElement("div")),a=(me.exec(s)||["",""])[1].toLowerCase(),c=Se[a]||Se._default,o.innerHTML=c[1]+_.htmlPrefilter(s)+c[2],d=c[0];d--;)o=o.lastChild;_.merge(h,o.childNodes),(o=u.firstChild).textContent=""}else h.push(t.createTextNode(s));for(u.textContent="",f=0;s=h[f++];)if(r&&_.inArray(s,r)>-1)n&&n.push(s);else if(l=oe(s),o=be(u.appendChild(s),"script"),l&&ye(o),i)for(d=0;s=o[d++];)ve.test(s.type||"")&&i.push(s);return u}var _e=/^key/,Ee=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Te=/^([^.]*)(?:\.(.+)|)/;function Ie(){return true}function Pe(){return false}function Ae(e,t){return e===function(){try{return b.activeElement}catch(dp){}}()==("focus"===t)}function Me(e,t,i,r,n,s){var o,a;if("object"==typeof t){for(a in"string"!=typeof i&&(r=r||i,i=void 0),t)Me(e,a,i,r,t[a],s);return e}if(null==r&&null==n?(n=i,r=i=void 0):null==n&&("string"==typeof i?(n=r,r=void 0):(n=r,r=i,i=void 0)),false===n)n=Pe;else if(!n)return e;return 1===s&&(o=n,(n=function(e){return _().off(e),o.apply(this,arguments)}).guid=o.guid||(o.guid=_.guid++)),e.each((function(){_.event.add(this,t,n,r,i)}))}function De(e,t,i){i?(X.set(e,t,false),_.event.add(e,t,{namespace:false,handler:function(e){var r,n,s=X.get(this,t);if(1&e.isTrigger&&this[t]){if(s.length)(_.event.special[t]||{}).delegateType&&e.stopPropagation();else if(s=a.call(arguments),X.set(this,t,s),r=i(this,t),this[t](),s!==(n=X.get(this,t))||r?X.set(this,t,false):n={},s!==n)return e.stopImmediatePropagation(),e.preventDefault(),n.value}else s.length&&(X.set(this,t,{value:_.event.trigger(_.extend(s[0],_.Event.prototype),s.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===X.get(e,t)&&_.event.add(e,t,Ie)}_.event={global:{},add:function(e,t,i,r,n){var s,o,a,c,l,d,u,h,f,p,g,m=X.get(e);if(q(e))for(i.handler&&(i=(s=i).handler,n=s.selector),n&&_.find.matchesSelector(se,n),i.guid||(i.guid=_.guid++),(c=m.events)||(c=m.events=Object.create(null)),(o=m.handle)||(o=m.handle=function(t){return void 0!==_&&_.event.triggered!==t.type?_.event.dispatch.apply(e,arguments):void 0}),l=(t=(t||"").match(F)||[""]).length;l--;)f=g=(a=Te.exec(t[l])||[])[1],p=(a[2]||"").split(".").sort(),f&&(u=_.event.special[f]||{},f=(n?u.delegateType:u.bindType)||f,u=_.event.special[f]||{},d=_.extend({type:f,origType:g,data:r,handler:i,guid:i.guid,selector:n,needsContext:n&&_.expr.match.needsContext.test(n),namespace:p.join(".")},s),(h=c[f])||((h=c[f]=[]).delegateCount=0,u.setup&&false!==u.setup.call(e,r,p,o)||e.addEventListener&&e.addEventListener(f,o)),u.add&&(u.add.call(e,d),d.handler.guid||(d.handler.guid=i.guid)),n?h.splice(h.delegateCount++,0,d):h.push(d),_.event.global[f]=true)},remove:function(e,t,i,r,n){var s,o,a,c,l,d,u,h,f,p,g,m=X.hasData(e)&&X.get(e);if(m&&(c=m.events)){for(l=(t=(t||"").match(F)||[""]).length;l--;)if(f=g=(a=Te.exec(t[l])||[])[1],p=(a[2]||"").split(".").sort(),f){for(u=_.event.special[f]||{},h=c[f=(r?u.delegateType:u.bindType)||f]||[],a=a[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=s=h.length;s--;)d=h[s],!n&&g!==d.origType||i&&i.guid!==d.guid||a&&!a.test(d.namespace)||r&&r!==d.selector&&("**"!==r||!d.selector)||(h.splice(s,1),d.selector&&h.delegateCount--,u.remove&&u.remove.call(e,d));o&&!h.length&&(u.teardown&&false!==u.teardown.call(e,p,m.handle)||_.removeEvent(e,f,m.handle),delete c[f])}else for(f in c)_.event.remove(e,f+t[l],i,r,true);_.isEmptyObject(c)&&X.remove(e,"handle events")}},dispatch:function(e){var t,i,r,n,s,o,a=new Array(arguments.length),c=_.event.fix(e),l=(X.get(this,"events")||Object.create(null))[c.type]||[],d=_.event.special[c.type]||{};for(a[0]=c,t=1;t<arguments.length;t++)a[t]=arguments[t];if(c.delegateTarget=this,!d.preDispatch||false!==d.preDispatch.call(this,c)){for(o=_.event.handlers.call(this,c,l),t=0;(n=o[t++])&&!c.isPropagationStopped();)for(c.currentTarget=n.elem,i=0;(s=n.handlers[i++])&&!c.isImmediatePropagationStopped();)c.rnamespace&&false!==s.namespace&&!c.rnamespace.test(s.namespace)||(c.handleObj=s,c.data=s.data,void 0!==(r=((_.event.special[s.origType]||{}).handle||s.handler).apply(n.elem,a))&&false===(c.result=r)&&(c.preventDefault(),c.stopPropagation()));return d.postDispatch&&d.postDispatch.call(this,c),c.result}},handlers:function(e,t){var i,r,n,s,o,a=[],c=t.delegateCount,l=e.target;if(c&&l.nodeType&&!("click"===e.type&&e.button>=1)){for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||true!==l.disabled)){for(s=[],o={},i=0;i<c;i++)void 0===o[n=(r=t[i]).selector+" "]&&(o[n]=r.needsContext?_(n,this).index(l)>-1:_.find(n,this,null,[l]).length),o[n]&&s.push(r);s.length&&a.push({elem:l,handlers:s})}}return l=this,c<t.length&&a.push({elem:l,handlers:t.slice(c)}),a},addProp:function(e,t){Object.defineProperty(_.Event.prototype,e,{enumerable:true,configurable:true,get:v(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:true,configurable:true,writable:true,value:t})}})},fix:function(e){return e[_.expando]?e:new _.Event(e)},special:{load:{noBubble:true},click:{setup:function(e){var t=this||e;return ge.test(t.type)&&t.click&&M(t,"input")&&De(t,"click",Ie),false},trigger:function(e){var t=this||e;return ge.test(t.type)&&t.click&&M(t,"input")&&De(t,"click"),true},_default:function(e){var t=e.target;return ge.test(t.type)&&t.click&&M(t,"input")&&X.get(t,"click")||M(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},_.removeEvent=function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i)},_.Event=function(e,t){if(!(this instanceof _.Event))return new _.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&false===e.returnValue?Ie:Pe,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&_.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[_.expando]=true},_.Event.prototype={constructor:_.Event,isDefaultPrevented:Pe,isPropagationStopped:Pe,isImmediatePropagationStopped:Pe,isSimulated:false,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Ie,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Ie,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Ie,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},_.each({altKey:true,bubbles:true,cancelable:true,changedTouches:true,ctrlKey:true,detail:true,eventPhase:true,metaKey:true,pageX:true,pageY:true,shiftKey:true,view:true,char:true,code:true,charCode:true,key:true,keyCode:true,button:true,buttons:true,clientX:true,clientY:true,offsetX:true,offsetY:true,pointerId:true,pointerType:true,screenX:true,screenY:true,targetTouches:true,toElement:true,touches:true,which:function(e){var t=e.button;return null==e.which&&_e.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Ee.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},_.event.addProp),_.each({focus:"focusin",blur:"focusout"},(function(e,t){_.event.special[e]={setup:function(){return De(this,e,Ae),false},trigger:function(){return De(this,e),true},delegateType:t}})),_.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(e,t){_.event.special[e]={delegateType:t,bindType:t,handle:function(e){var i,r=this,n=e.relatedTarget,s=e.handleObj;return n&&(n===r||_.contains(r,n))||(e.type=s.origType,i=s.handler.apply(this,arguments),e.type=t),i}}})),_.fn.extend({on:function(e,t,i,r){return Me(this,e,t,i,r)},one:function(e,t,i,r){return Me(this,e,t,i,r,1)},off:function(e,t,i){var r,n;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,_(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(n in e)this.off(n,t,e[n]);return this}return false!==t&&"function"!=typeof t||(i=t,t=void 0),false===i&&(i=Pe),this.each((function(){_.event.remove(this,e,i,t)}))}});var Re=/<script|<style|<link/i,Oe=/checked\s*(?:[^=]|=\s*.checked.)/i,Ne=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function xe(e,t){return M(e,"table")&&M(11!==t.nodeType?t:t.firstChild,"tr")&&_(e).children("tbody")[0]||e}function Le(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function ke(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Fe(e,t){var i,r,n,s,o,a;if(1===t.nodeType){if(X.hasData(e)&&(a=X.get(e).events))for(n in X.remove(t,"handle events"),a)for(i=0,r=a[n].length;i<r;i++)_.event.add(t,n,a[n][i]);Q.hasData(e)&&(s=Q.access(e),o=_.extend({},s),Q.set(t,o))}}function Ue(e,t){var i=t.nodeName.toLowerCase();"input"===i&&ge.test(e.type)?t.checked=e.checked:"input"!==i&&"textarea"!==i||(t.defaultValue=e.defaultValue)}function je(e,t,i,r){t=c(t);var n,s,o,a,l,d,u=0,h=e.length,f=h-1,p=t[0],g=v(p);if(g||h>1&&"string"==typeof p&&!m.checkClone&&Oe.test(p))return e.each((function(n){var s=e.eq(n);g&&(t[0]=p.call(this,n,s.html())),je(s,t,i,r)}));if(h&&(s=(n=we(t,e[0].ownerDocument,false,e,r)).firstChild,1===n.childNodes.length&&(n=s),s||r)){for(a=(o=_.map(be(n,"script"),Le)).length;u<h;u++)l=n,u!==f&&(l=_.clone(l,true,true),a&&_.merge(o,be(l,"script"))),i.call(e[u],l,u);if(a)for(d=o[o.length-1].ownerDocument,_.map(o,ke),u=0;u<a;u++)l=o[u],ve.test(l.type||"")&&!X.access(l,"globalEval")&&_.contains(d,l)&&(l.src&&"module"!==(l.type||"").toLowerCase()?_._evalUrl&&!l.noModule&&_._evalUrl(l.src,{nonce:l.nonce||l.getAttribute("nonce")},d):C(l.textContent.replace(Ne,""),l,d))}return e}function We(e,t,i){for(var r,n=t?_.filter(t,e):e,s=0;null!=(r=n[s]);s++)i||1!==r.nodeType||_.cleanData(be(r)),r.parentNode&&(i&&oe(r)&&ye(be(r,"script")),r.parentNode.removeChild(r));return e}_.extend({htmlPrefilter:function(e){return e},clone:function(e,t,i){var r,n,s,o,a=e.cloneNode(true),c=oe(e);if(!(m.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||_.isXMLDoc(e)))for(o=be(a),r=0,n=(s=be(e)).length;r<n;r++)Ue(s[r],o[r]);if(t)if(i)for(s=s||be(e),o=o||be(a),r=0,n=s.length;r<n;r++)Fe(s[r],o[r]);else Fe(e,a);return(o=be(a,"script")).length>0&&ye(o,!c&&be(e,"script")),a},cleanData:function(e){for(var t,i,r,n=_.event.special,s=0;void 0!==(i=e[s]);s++)if(q(i)){if(t=i[X.expando]){if(t.events)for(r in t.events)n[r]?_.event.remove(i,r):_.removeEvent(i,r,t.handle);i[X.expando]=void 0}i[Q.expando]&&(i[Q.expando]=void 0)}}}),_.fn.extend({detach:function(e){return We(this,e,true)},remove:function(e){return We(this,e)},text:function(e){return Y(this,(function(e){return void 0===e?_.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)}))}),null,e,arguments.length)},append:function(){return je(this,arguments,(function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||xe(this,e).appendChild(e)}))},prepend:function(){return je(this,arguments,(function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=xe(this,e);t.insertBefore(e,t.firstChild)}}))},before:function(){return je(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this)}))},after:function(){return je(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)}))},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(_.cleanData(be(e,false)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map((function(){return _.clone(this,e,t)}))},html:function(e){return Y(this,(function(e){var t=this[0]||{},i=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Re.test(e)&&!Se[(me.exec(e)||["",""])[1].toLowerCase()]){e=_.htmlPrefilter(e);try{for(;i<r;i++)1===(t=this[i]||{}).nodeType&&(_.cleanData(be(t,false)),t.innerHTML=e);t=0}catch(n){}}t&&this.empty().append(e)}),null,e,arguments.length)},replaceWith:function(){var e=[];return je(this,arguments,(function(t){var i=this.parentNode;_.inArray(this,e)<0&&(_.cleanData(be(this)),i&&i.replaceChild(t,this))}),e)}}),_.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(e,t){_.fn[e]=function(e){for(var i,r=[],n=_(e),s=n.length-1,o=0;o<=s;o++)i=o===s?this:this.clone(true),_(n[o])[t](i),l.apply(r,i.get());return this.pushStack(r)}}));var Be=new RegExp("^("+ie+")(?!px)[a-z%]+$","i"),He=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=i),t.getComputedStyle(e)},Ve=function(e,t,i){var r,n,s={};for(n in t)s[n]=e.style[n],e.style[n]=t[n];for(n in r=i.call(e),t)e.style[n]=s[n];return r},Ye=new RegExp(ne.join("|"),"i");function Ge(e,t,i){var r,n,s,o,a=e.style;return(i=i||He(e))&&(""!==(o=i.getPropertyValue(t)||i[t])||oe(e)||(o=_.style(e,t)),!m.pixelBoxStyles()&&Be.test(o)&&Ye.test(t)&&(r=a.width,n=a.minWidth,s=a.maxWidth,a.minWidth=a.maxWidth=a.width=o,o=i.width,a.width=r,a.minWidth=n,a.maxWidth=s)),void 0!==o?o+"":o}function $e(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(d){l.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",d.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",se.appendChild(l).appendChild(d);var e=i.getComputedStyle(d);r="1%"!==e.top,c=12===t(e.marginLeft),d.style.right="60%",o=36===t(e.right),n=36===t(e.width),d.style.position="absolute",s=12===t(d.offsetWidth/3),se.removeChild(l),d=null}}function t(e){return Math.round(parseFloat(e))}var r,n,s,o,a,c,l=b.createElement("div"),d=b.createElement("div");d.style&&(d.style.backgroundClip="content-box",d.cloneNode(true).style.backgroundClip="",m.clearCloneStyle="content-box"===d.style.backgroundClip,_.extend(m,{boxSizingReliable:function(){return e(),n},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),r},reliableMarginLeft:function(){return e(),c},scrollboxSize:function(){return e(),s},reliableTrDimensions:function(){var e,t,r,n;return null==a&&(e=b.createElement("table"),t=b.createElement("tr"),r=b.createElement("div"),e.style.cssText="position:absolute;left:-11111px",t.style.height="1px",r.style.height="9px",se.appendChild(e).appendChild(t).appendChild(r),n=i.getComputedStyle(t),a=parseInt(n.height)>3,se.removeChild(e)),a}}))}();var ze=["Webkit","Moz","ms"],Je=b.createElement("div").style,qe={};function Ke(e){var t=_.cssProps[e]||qe[e];return t||(e in Je?e:qe[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),i=ze.length;i--;)if((e=ze[i]+t)in Je)return e}(e)||e)}var Xe=/^(none|table(?!-c[ea]).+)/,Qe=/^--/,Ze={position:"absolute",visibility:"hidden",display:"block"},et={letterSpacing:"0",fontWeight:"400"};function tt(e,t,i){var r=re.exec(t);return r?Math.max(0,r[2]-(i||0))+(r[3]||"px"):t}function it(e,t,i,r,n,s){var o="width"===t?1:0,a=0,c=0;if(i===(r?"border":"content"))return 0;for(;o<4;o+=2)"margin"===i&&(c+=_.css(e,i+ne[o],true,n)),r?("content"===i&&(c-=_.css(e,"padding"+ne[o],true,n)),"margin"!==i&&(c-=_.css(e,"border"+ne[o]+"Width",true,n))):(c+=_.css(e,"padding"+ne[o],true,n),"padding"!==i?c+=_.css(e,"border"+ne[o]+"Width",true,n):a+=_.css(e,"border"+ne[o]+"Width",true,n));return!r&&s>=0&&(c+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-s-c-a-.5))||0),c}function rt(e,t,i){var r=He(e),n=(!m.boxSizingReliable()||i)&&"border-box"===_.css(e,"boxSizing",false,r),s=n,o=Ge(e,t,r),a="offset"+t[0].toUpperCase()+t.slice(1);if(Be.test(o)){if(!i)return o;o="auto"}return(!m.boxSizingReliable()&&n||!m.reliableTrDimensions()&&M(e,"tr")||"auto"===o||!parseFloat(o)&&"inline"===_.css(e,"display",false,r))&&e.getClientRects().length&&(n="border-box"===_.css(e,"boxSizing",false,r),(s=a in e)&&(o=e[a])),(o=parseFloat(o)||0)+it(e,t,i||(n?"border":"content"),s,r,o)+"px"}function nt(e,t,i,r,n){return new nt.prototype.init(e,t,i,r,n)}_.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=Ge(e,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:true,columnCount:true,fillOpacity:true,flexGrow:true,flexShrink:true,fontWeight:true,gridArea:true,gridColumn:true,gridColumnEnd:true,gridColumnStart:true,gridRow:true,gridRowEnd:true,gridRowStart:true,lineHeight:true,opacity:true,order:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{},style:function(e,t,i,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var n,s,o,a=J(t),c=Qe.test(t),l=e.style;if(c||(t=Ke(a)),o=_.cssHooks[t]||_.cssHooks[a],void 0===i)return o&&"get"in o&&void 0!==(n=o.get(e,false,r))?n:l[t];"string"===(s=typeof i)&&(n=re.exec(i))&&n[1]&&(i=le(e,t,n),s="number"),null!=i&&i==i&&("number"!==s||c||(i+=n&&n[3]||(_.cssNumber[a]?"":"px")),m.clearCloneStyle||""!==i||0!==t.indexOf("background")||(l[t]="inherit"),o&&"set"in o&&void 0===(i=o.set(e,i,r))||(c?l.setProperty(t,i):l[t]=i))}},css:function(e,t,i,r){var n,s,o,a=J(t);return Qe.test(t)||(t=Ke(a)),(o=_.cssHooks[t]||_.cssHooks[a])&&"get"in o&&(n=o.get(e,true,i)),void 0===n&&(n=Ge(e,t,r)),"normal"===n&&t in et&&(n=et[t]),""===i||i?(s=parseFloat(n),true===i||isFinite(s)?s||0:n):n}}),_.each(["height","width"],(function(e,t){_.cssHooks[t]={get:function(e,i,r){if(i)return!Xe.test(_.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?rt(e,t,r):Ve(e,Ze,(function(){return rt(e,t,r)}))},set:function(e,i,r){var n,s=He(e),o=!m.scrollboxSize()&&"absolute"===s.position,a=(o||r)&&"border-box"===_.css(e,"boxSizing",false,s),c=r?it(e,t,r,a,s):0;return a&&o&&(c-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(s[t])-it(e,t,"border",false,s)-.5)),c&&(n=re.exec(i))&&"px"!==(n[3]||"px")&&(e.style[t]=i,i=_.css(e,t)),tt(0,i,c)}}})),_.cssHooks.marginLeft=$e(m.reliableMarginLeft,(function(e,t){if(t)return(parseFloat(Ge(e,"marginLeft"))||e.getBoundingClientRect().left-Ve(e,{marginLeft:0},(function(){return e.getBoundingClientRect().left})))+"px"})),_.each({margin:"",padding:"",border:"Width"},(function(e,t){_.cssHooks[e+t]={expand:function(i){for(var r=0,n={},s="string"==typeof i?i.split(" "):[i];r<4;r++)n[e+ne[r]+t]=s[r]||s[r-2]||s[0];return n}},"margin"!==e&&(_.cssHooks[e+t].set=tt)})),_.fn.extend({css:function(e,t){return Y(this,(function(e,t,i){var r,n,s={},o=0;if(Array.isArray(t)){for(r=He(e),n=t.length;o<n;o++)s[t[o]]=_.css(e,t[o],false,r);return s}return void 0!==i?_.style(e,t,i):_.css(e,t)}),e,t,arguments.length>1)}}),_.Tween=nt,nt.prototype={constructor:nt,init:function(e,t,i,r,n,s){this.elem=e,this.prop=i,this.easing=n||_.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(_.cssNumber[i]?"":"px")},cur:function(){var e=nt.propHooks[this.prop];return e&&e.get?e.get(this):nt.propHooks._default.get(this)},run:function(e){var t,i=nt.propHooks[this.prop];return this.options.duration?this.pos=t=_.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):nt.propHooks._default.set(this),this}},nt.prototype.init.prototype=nt.prototype,nt.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=_.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){_.fx.step[e.prop]?_.fx.step[e.prop](e):1!==e.elem.nodeType||!_.cssHooks[e.prop]&&null==e.elem.style[Ke(e.prop)]?e.elem[e.prop]=e.now:_.style(e.elem,e.prop,e.now+e.unit)}}},nt.propHooks.scrollTop=nt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},_.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},_.fx=nt.prototype.init,_.fx.step={};var st,ot,at=/^(?:toggle|show|hide)$/,ct=/queueHooks$/;function lt(){ot&&(false===b.hidden&&i.requestAnimationFrame?i.requestAnimationFrame(lt):i.setTimeout(lt,_.fx.interval),_.fx.tick())}function dt(){return i.setTimeout((function(){st=void 0})),st=Date.now()}function ut(e,t){var i,r=0,n={height:e};for(t=t?1:0;r<4;r+=2-t)n["margin"+(i=ne[r])]=n["padding"+i]=e;return t&&(n.opacity=n.width=e),n}function ht(e,t,i){for(var r,n=(ft.tweeners[t]||[]).concat(ft.tweeners["*"]),s=0,o=n.length;s<o;s++)if(r=n[s].call(i,t,e))return r}function ft(e,t,i){var r,n,s=0,o=ft.prefilters.length,a=_.Deferred().always((function(){delete c.elem})),c=function(){if(n)return false;for(var t=st||dt(),i=Math.max(0,l.startTime+l.duration-t),r=1-(i/l.duration||0),s=0,o=l.tweens.length;s<o;s++)l.tweens[s].run(r);return a.notifyWith(e,[l,r,i]),r<1&&o?i:(o||a.notifyWith(e,[l,1,0]),a.resolveWith(e,[l]),false)},l=a.promise({elem:e,props:_.extend({},t),opts:_.extend(true,{specialEasing:{},easing:_.easing._default},i),originalProperties:t,originalOptions:i,startTime:st||dt(),duration:i.duration,tweens:[],createTween:function(t,i){var r=_.Tween(e,l.opts,t,i,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},stop:function(t){var i=0,r=t?l.tweens.length:0;if(n)return this;for(n=true;i<r;i++)l.tweens[i].run(1);return t?(a.notifyWith(e,[l,1,0]),a.resolveWith(e,[l,t])):a.rejectWith(e,[l,t]),this}}),d=l.props;for(!function(e,t){var i,r,n,s,o;for(i in e)if(n=t[r=J(i)],s=e[i],Array.isArray(s)&&(n=s[1],s=e[i]=s[0]),i!==r&&(e[r]=s,delete e[i]),(o=_.cssHooks[r])&&"expand"in o)for(i in s=o.expand(s),delete e[r],s)i in e||(e[i]=s[i],t[i]=n);else t[r]=n}(d,l.opts.specialEasing);s<o;s++)if(r=ft.prefilters[s].call(l,e,d,l.opts))return v(r.stop)&&(_._queueHooks(l.elem,l.opts.queue).stop=r.stop.bind(r)),r;return _.map(d,ht,l),v(l.opts.start)&&l.opts.start.call(e,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),_.fx.timer(_.extend(c,{elem:e,anim:l,queue:l.opts.queue})),l}_.Animation=_.extend(ft,{tweeners:{"*":[function(e,t){var i=this.createTween(e,t);return le(i.elem,e,re.exec(t),i),i}]},tweener:function(e,t){v(e)?(t=e,e=["*"]):e=e.match(F);for(var i,r=0,n=e.length;r<n;r++)i=e[r],ft.tweeners[i]=ft.tweeners[i]||[],ft.tweeners[i].unshift(t)},prefilters:[function(e,t,i){var r,n,s,o,a,c,l,d,u="width"in t||"height"in t,h=this,f={},p=e.style,g=e.nodeType&&ce(e),m=X.get(e,"fxshow");for(r in i.queue||(null==(o=_._queueHooks(e,"fx")).unqueued&&(o.unqueued=0,a=o.empty.fire,o.empty.fire=function(){o.unqueued||a()}),o.unqueued++,h.always((function(){h.always((function(){o.unqueued--,_.queue(e,"fx").length||o.empty.fire()}))}))),t)if(n=t[r],at.test(n)){if(delete t[r],s=s||"toggle"===n,n===(g?"hide":"show")){if("show"!==n||!m||void 0===m[r])continue;g=true}f[r]=m&&m[r]||_.style(e,r)}if((c=!_.isEmptyObject(t))||!_.isEmptyObject(f))for(r in u&&1===e.nodeType&&(i.overflow=[p.overflow,p.overflowX,p.overflowY],null==(l=m&&m.display)&&(l=X.get(e,"display")),"none"===(d=_.css(e,"display"))&&(l?d=l:(he([e],true),l=e.style.display||l,d=_.css(e,"display"),he([e]))),("inline"===d||"inline-block"===d&&null!=l)&&"none"===_.css(e,"float")&&(c||(h.done((function(){p.display=l})),null==l&&(d=p.display,l="none"===d?"":d)),p.display="inline-block")),i.overflow&&(p.overflow="hidden",h.always((function(){p.overflow=i.overflow[0],p.overflowX=i.overflow[1],p.overflowY=i.overflow[2]}))),c=false,f)c||(m?"hidden"in m&&(g=m.hidden):m=X.access(e,"fxshow",{display:l}),s&&(m.hidden=!g),g&&he([e],true),h.done((function(){for(r in g||he([e]),X.remove(e,"fxshow"),f)_.style(e,r,f[r])}))),c=ht(g?m[r]:0,r,h),r in m||(m[r]=c.start,g&&(c.end=c.start,c.start=0))}],prefilter:function(e,t){t?ft.prefilters.unshift(e):ft.prefilters.push(e)}}),_.speed=function(e,t,i){var r=e&&"object"==typeof e?_.extend({},e):{complete:i||!i&&t||v(e)&&e,duration:e,easing:i&&t||t&&!v(t)&&t};return _.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in _.fx.speeds?r.duration=_.fx.speeds[r.duration]:r.duration=_.fx.speeds._default),null!=r.queue&&true!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){v(r.old)&&r.old.call(this),r.queue&&_.dequeue(this,r.queue)},r},_.fn.extend({fadeTo:function(e,t,i,r){return this.filter(ce).css("opacity",0).show().end().animate({opacity:t},e,i,r)},animate:function(e,t,i,r){var n=_.isEmptyObject(e),s=_.speed(t,i,r),o=function(){var t=ft(this,_.extend({},e),s);(n||X.get(this,"finish"))&&t.stop(true)};return o.finish=o,n||false===s.queue?this.each(o):this.queue(s.queue,o)},stop:function(e,t,i){var r=function(e){var t=e.stop;delete e.stop,t(i)};return"string"!=typeof e&&(i=t,t=e,e=void 0),t&&this.queue(e||"fx",[]),this.each((function(){var t=true,n=null!=e&&e+"queueHooks",s=_.timers,o=X.get(this);if(n)o[n]&&o[n].stop&&r(o[n]);else for(n in o)o[n]&&o[n].stop&&ct.test(n)&&r(o[n]);for(n=s.length;n--;)s[n].elem!==this||null!=e&&s[n].queue!==e||(s[n].anim.stop(i),t=false,s.splice(n,1));!t&&i||_.dequeue(this,e)}))},finish:function(e){return false!==e&&(e=e||"fx"),this.each((function(){var t,i=X.get(this),r=i[e+"queue"],n=i[e+"queueHooks"],s=_.timers,o=r?r.length:0;for(i.finish=true,_.queue(this,e,[]),n&&n.stop&&n.stop.call(this,true),t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(true),s.splice(t,1));for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete i.finish}))}}),_.each(["toggle","show","hide"],(function(e,t){var i=_.fn[t];_.fn[t]=function(e,r,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(ut(t,true),e,r,n)}})),_.each({slideDown:ut("show"),slideUp:ut("hide"),slideToggle:ut("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(e,t){_.fn[e]=function(e,i,r){return this.animate(t,e,i,r)}})),_.timers=[],_.fx.tick=function(){var e,t=0,i=_.timers;for(st=Date.now();t<i.length;t++)(e=i[t])()||i[t]!==e||i.splice(t--,1);i.length||_.fx.stop(),st=void 0},_.fx.timer=function(e){_.timers.push(e),_.fx.start()},_.fx.interval=13,_.fx.start=function(){ot||(ot=true,lt())},_.fx.stop=function(){ot=null},_.fx.speeds={slow:600,fast:200,_default:400},_.fn.delay=function(e,t){return e=_.fx&&_.fx.speeds[e]||e,t=t||"fx",this.queue(t,(function(t,r){var n=i.setTimeout(t,e);r.stop=function(){i.clearTimeout(n)}}))},function(){var e=b.createElement("input"),t=b.createElement("select").appendChild(b.createElement("option"));e.type="checkbox",m.checkOn=""!==e.value,m.optSelected=t.selected,(e=b.createElement("input")).value="t",e.type="radio",m.radioValue="t"===e.value}();var pt,gt=_.expr.attrHandle;_.fn.extend({attr:function(e,t){return Y(this,_.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each((function(){_.removeAttr(this,e)}))}}),_.extend({attr:function(e,t,i){var r,n,s=e.nodeType;if(3!==s&&8!==s&&2!==s)return void 0===e.getAttribute?_.prop(e,t,i):(1===s&&_.isXMLDoc(e)||(n=_.attrHooks[t.toLowerCase()]||(_.expr.match.bool.test(t)?pt:void 0)),void 0!==i?null===i?void _.removeAttr(e,t):n&&"set"in n&&void 0!==(r=n.set(e,i,t))?r:(e.setAttribute(t,i+""),i):n&&"get"in n&&null!==(r=n.get(e,t))?r:null==(r=_.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!m.radioValue&&"radio"===t&&M(e,"input")){var i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}}},removeAttr:function(e,t){var i,r=0,n=t&&t.match(F);if(n&&1===e.nodeType)for(;i=n[r++];)e.removeAttribute(i)}}),pt={set:function(e,t,i){return false===t?_.removeAttr(e,i):e.setAttribute(i,i),i}},_.each(_.expr.match.bool.source.match(/\w+/g),(function(e,t){var i=gt[t]||_.find.attr;gt[t]=function(e,t,r){var n,s,o=t.toLowerCase();return r||(s=gt[o],gt[o]=n,n=null!=i(e,t,r)?o:null,gt[o]=s),n}}));var mt=/^(?:input|select|textarea|button)$/i,vt=/^(?:a|area)$/i;function St(e){return(e.match(F)||[]).join(" ")}function bt(e){return e.getAttribute&&e.getAttribute("class")||""}function yt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(F)||[]}_.fn.extend({prop:function(e,t){return Y(this,_.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each((function(){delete this[_.propFix[e]||e]}))}}),_.extend({prop:function(e,t,i){var r,n,s=e.nodeType;if(3!==s&&8!==s&&2!==s)return 1===s&&_.isXMLDoc(e)||(t=_.propFix[t]||t,n=_.propHooks[t]),void 0!==i?n&&"set"in n&&void 0!==(r=n.set(e,i,t))?r:e[t]=i:n&&"get"in n&&null!==(r=n.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=_.find.attr(e,"tabindex");return t?parseInt(t,10):mt.test(e.nodeName)||vt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),m.optSelected||(_.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),_.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){_.propFix[this.toLowerCase()]=this})),_.fn.extend({addClass:function(e){var t,i,r,n,s,o,a,c=0;if(v(e))return this.each((function(t){_(this).addClass(e.call(this,t,bt(this)))}));if((t=yt(e)).length){for(;i=this[c++];)if(n=bt(i),r=1===i.nodeType&&" "+St(n)+" "){for(o=0;s=t[o++];)r.indexOf(" "+s+" ")<0&&(r+=s+" ");n!==(a=St(r))&&i.setAttribute("class",a)}}return this},removeClass:function(e){var t,i,r,n,s,o,a,c=0;if(v(e))return this.each((function(t){_(this).removeClass(e.call(this,t,bt(this)))}));if(!arguments.length)return this.attr("class","");if((t=yt(e)).length){for(;i=this[c++];)if(n=bt(i),r=1===i.nodeType&&" "+St(n)+" "){for(o=0;s=t[o++];)for(;r.indexOf(" "+s+" ")>-1;)r=r.replace(" "+s+" "," ");n!==(a=St(r))&&i.setAttribute("class",a)}}return this},toggleClass:function(e,t){var i=typeof e,r="string"===i||Array.isArray(e);return"boolean"==typeof t&&r?t?this.addClass(e):this.removeClass(e):v(e)?this.each((function(i){_(this).toggleClass(e.call(this,i,bt(this),t),t)})):this.each((function(){var t,n,s,o;if(r)for(n=0,s=_(this),o=yt(e);t=o[n++];)s.hasClass(t)?s.removeClass(t):s.addClass(t);else void 0!==e&&"boolean"!==i||((t=bt(this))&&X.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||false===e?"":X.get(this,"__className__")||""))}))},hasClass:function(e){var t,i,r=0;for(t=" "+e+" ";i=this[r++];)if(1===i.nodeType&&(" "+St(bt(i))+" ").indexOf(t)>-1)return true;return false}});var Ct=/\r/g;_.fn.extend({val:function(e){var t,i,r,n=this[0];return arguments.length?(r=v(e),this.each((function(i){var n;1===this.nodeType&&(null==(n=r?e.call(this,i,_(this).val()):e)?n="":"number"==typeof n?n+="":Array.isArray(n)&&(n=_.map(n,(function(e){return null==e?"":e+""}))),(t=_.valHooks[this.type]||_.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,n,"value")||(this.value=n))}))):n?(t=_.valHooks[n.type]||_.valHooks[n.nodeName.toLowerCase()])&&"get"in t&&void 0!==(i=t.get(n,"value"))?i:"string"==typeof(i=n.value)?i.replace(Ct,""):null==i?"":i:void 0}}),_.extend({valHooks:{option:{get:function(e){var t=_.find.attr(e,"value");return null!=t?t:St(_.text(e))}},select:{get:function(e){var t,i,r,n=e.options,s=e.selectedIndex,o="select-one"===e.type,a=o?null:[],c=o?s+1:n.length;for(r=s<0?c:o?s:0;r<c;r++)if(((i=n[r]).selected||r===s)&&!i.disabled&&(!i.parentNode.disabled||!M(i.parentNode,"optgroup"))){if(t=_(i).val(),o)return t;a.push(t)}return a},set:function(e,t){for(var i,r,n=e.options,s=_.makeArray(t),o=n.length;o--;)((r=n[o]).selected=_.inArray(_.valHooks.option.get(r),s)>-1)&&(i=true);return i||(e.selectedIndex=-1),s}}}}),_.each(["radio","checkbox"],(function(){_.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=_.inArray(_(e).val(),t)>-1}},m.checkOn||(_.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})})),m.focusin="onfocusin"in i;var wt=/^(?:focusinfocus|focusoutblur)$/,_t=function(e){e.stopPropagation()};_.extend(_.event,{trigger:function(e,t,r,n){var s,o,a,c,l,d,u,h,p=[r||b],g=f.call(e,"type")?e.type:e,m=f.call(e,"namespace")?e.namespace.split("."):[];if(o=h=a=r=r||b,3!==r.nodeType&&8!==r.nodeType&&!wt.test(g+_.event.triggered)&&(g.indexOf(".")>-1&&(m=g.split("."),g=m.shift(),m.sort()),l=g.indexOf(":")<0&&"on"+g,(e=e[_.expando]?e:new _.Event(g,"object"==typeof e&&e)).isTrigger=n?2:3,e.namespace=m.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=r),t=null==t?[e]:_.makeArray(t,[e]),u=_.event.special[g]||{},n||!u.trigger||false!==u.trigger.apply(r,t))){if(!n&&!u.noBubble&&!S(r)){for(c=u.delegateType||g,wt.test(c+g)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(r.ownerDocument||b)&&p.push(a.defaultView||a.parentWindow||i)}for(s=0;(o=p[s++])&&!e.isPropagationStopped();)h=o,e.type=s>1?c:u.bindType||g,(d=(X.get(o,"events")||Object.create(null))[e.type]&&X.get(o,"handle"))&&d.apply(o,t),(d=l&&o[l])&&d.apply&&q(o)&&(e.result=d.apply(o,t),false===e.result&&e.preventDefault());return e.type=g,n||e.isDefaultPrevented()||u._default&&false!==u._default.apply(p.pop(),t)||!q(r)||l&&v(r[g])&&!S(r)&&((a=r[l])&&(r[l]=null),_.event.triggered=g,e.isPropagationStopped()&&h.addEventListener(g,_t),r[g](),e.isPropagationStopped()&&h.removeEventListener(g,_t),_.event.triggered=void 0,a&&(r[l]=a)),e.result}},simulate:function(e,t,i){var r=_.extend(new _.Event,i,{type:e,isSimulated:true});_.event.trigger(r,null,t)}}),_.fn.extend({trigger:function(e,t){return this.each((function(){_.event.trigger(e,t,this)}))},triggerHandler:function(e,t){var i=this[0];if(i)return _.event.trigger(e,t,i,true)}}),m.focusin||_.each({focus:"focusin",blur:"focusout"},(function(e,t){var i=function(e){_.event.simulate(t,e.target,_.event.fix(e))};_.event.special[t]={setup:function(){var r=this.ownerDocument||this.document||this,n=X.access(r,t);n||r.addEventListener(e,i,true),X.access(r,t,(n||0)+1)},teardown:function(){var r=this.ownerDocument||this.document||this,n=X.access(r,t)-1;n?X.access(r,t,n):(r.removeEventListener(e,i,true),X.remove(r,t))}}}));var Et=i.location,Tt={guid:Date.now()},It=/\?/;_.parseXML=function(e){var t;if(!e||"string"!=typeof e)return null;try{t=(new i.DOMParser).parseFromString(e,"text/xml")}catch(r){t=void 0}return t&&!t.getElementsByTagName("parsererror").length||_.error("Invalid XML: "+e),t};var Pt=/\[\]$/,At=/\r?\n/g,Mt=/^(?:submit|button|image|reset|file)$/i,Dt=/^(?:input|select|textarea|keygen)/i;function Rt(e,t,i,r){var n;if(Array.isArray(t))_.each(t,(function(t,n){i||Pt.test(e)?r(e,n):Rt(e+"["+("object"==typeof n&&null!=n?t:"")+"]",n,i,r)}));else if(i||"object"!==w(t))r(e,t);else for(n in t)Rt(e+"["+n+"]",t[n],i,r)}_.param=function(e,t){var i,r=[],n=function(e,t){var i=v(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==i?"":i)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!_.isPlainObject(e))_.each(e,(function(){n(this.name,this.value)}));else for(i in e)Rt(i,e[i],t,n);return r.join("&")},_.fn.extend({serialize:function(){return _.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var e=_.prop(this,"elements");return e?_.makeArray(e):this})).filter((function(){var e=this.type;return this.name&&!_(this).is(":disabled")&&Dt.test(this.nodeName)&&!Mt.test(e)&&(this.checked||!ge.test(e))})).map((function(e,t){var i=_(this).val();return null==i?null:Array.isArray(i)?_.map(i,(function(e){return{name:t.name,value:e.replace(At,"\r\n")}})):{name:t.name,value:i.replace(At,"\r\n")}})).get()}});var Ot=/%20/g,Nt=/#.*$/,xt=/([?&])_=[^&]*/,Lt=/^(.*?):[ \t]*([^\r\n]*)$/gm,kt=/^(?:GET|HEAD)$/,Ft=/^\/\//,Ut={},jt={},Wt="*/".concat("*"),Bt=b.createElement("a");function Ht(e){return function(t,i){"string"!=typeof t&&(i=t,t="*");var r,n=0,s=t.toLowerCase().match(F)||[];if(v(i))for(;r=s[n++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(i)):(e[r]=e[r]||[]).push(i)}}function Vt(e,t,i,r){var n={},s=e===jt;function o(a){var c;return n[a]=true,_.each(e[a]||[],(function(e,a){var l=a(t,i,r);return"string"!=typeof l||s||n[l]?s?!(c=l):void 0:(t.dataTypes.unshift(l),o(l),false)})),c}return o(t.dataTypes[0])||!n["*"]&&o("*")}function Yt(e,t){var i,r,n=_.ajaxSettings.flatOptions||{};for(i in t)void 0!==t[i]&&((n[i]?e:r||(r={}))[i]=t[i]);return r&&_.extend(true,e,r),e}Bt.href=Et.href,_.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Et.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Et.protocol),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Wt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":JSON.parse,"text xml":_.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(e,t){return t?Yt(Yt(e,_.ajaxSettings),t):Yt(_.ajaxSettings,e)},ajaxPrefilter:Ht(Ut),ajaxTransport:Ht(jt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var r,n,s,o,a,c,l,d,u,h,f=_.ajaxSetup({},t),p=f.context||f,g=f.context&&(p.nodeType||p.jquery)?_(p):_.event,m=_.Deferred(),v=_.Callbacks("once memory"),S=f.statusCode||{},y={},C={},w="canceled",E={readyState:0,getResponseHeader:function(e){var t;if(l){if(!o)for(o={};t=Lt.exec(s);)o[t[1].toLowerCase()+" "]=(o[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=o[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return l?s:null},setRequestHeader:function(e,t){return null==l&&(e=C[e.toLowerCase()]=C[e.toLowerCase()]||e,y[e]=t),this},overrideMimeType:function(e){return null==l&&(f.mimeType=e),this},statusCode:function(e){var t;if(e)if(l)E.always(e[E.status]);else for(t in e)S[t]=[S[t],e[t]];return this},abort:function(e){var t=e||w;return r&&r.abort(t),T(0,t),this}};if(m.promise(E),f.url=((e||f.url||Et.href)+"").replace(Ft,Et.protocol+"//"),f.type=t.method||t.type||f.method||f.type,f.dataTypes=(f.dataType||"*").toLowerCase().match(F)||[""],null==f.crossDomain){c=b.createElement("a");try{c.href=f.url,c.href=c.href,f.crossDomain=Bt.protocol+"//"+Bt.host!=c.protocol+"//"+c.host}catch(I){f.crossDomain=true}}if(f.data&&f.processData&&"string"!=typeof f.data&&(f.data=_.param(f.data,f.traditional)),Vt(Ut,f,t,E),l)return E;for(u in(d=_.event&&f.global)&&0==_.active++&&_.event.trigger("ajaxStart"),f.type=f.type.toUpperCase(),f.hasContent=!kt.test(f.type),n=f.url.replace(Nt,""),f.hasContent?f.data&&f.processData&&0===(f.contentType||"").indexOf("application/x-www-form-urlencoded")&&(f.data=f.data.replace(Ot,"+")):(h=f.url.slice(n.length),f.data&&(f.processData||"string"==typeof f.data)&&(n+=(It.test(n)?"&":"?")+f.data,delete f.data),false===f.cache&&(n=n.replace(xt,"$1"),h=(It.test(n)?"&":"?")+"_="+Tt.guid+++h),f.url=n+h),f.ifModified&&(_.lastModified[n]&&E.setRequestHeader("If-Modified-Since",_.lastModified[n]),_.etag[n]&&E.setRequestHeader("If-None-Match",_.etag[n])),(f.data&&f.hasContent&&false!==f.contentType||t.contentType)&&E.setRequestHeader("Content-Type",f.contentType),E.setRequestHeader("Accept",f.dataTypes[0]&&f.accepts[f.dataTypes[0]]?f.accepts[f.dataTypes[0]]+("*"!==f.dataTypes[0]?", "+Wt+"; q=0.01":""):f.accepts["*"]),f.headers)E.setRequestHeader(u,f.headers[u]);if(f.beforeSend&&(false===f.beforeSend.call(p,E,f)||l))return E.abort();if(w="abort",v.add(f.complete),E.done(f.success),E.fail(f.error),r=Vt(jt,f,t,E)){if(E.readyState=1,d&&g.trigger("ajaxSend",[E,f]),l)return E;f.async&&f.timeout>0&&(a=i.setTimeout((function(){E.abort("timeout")}),f.timeout));try{l=false,r.send(y,T)}catch(I){if(l)throw I;T(-1,I)}}else T(-1,"No Transport");function T(e,t,o,c){var u,h,b,y,C,w=t;l||(l=true,a&&i.clearTimeout(a),r=void 0,s=c||"",E.readyState=e>0?4:0,u=e>=200&&e<300||304===e,o&&(y=function(e,t,i){for(var r,n,s,o,a=e.contents,c=e.dataTypes;"*"===c[0];)c.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r){for(n in a)if(a[n]&&a[n].test(r)){c.unshift(n);break}}if(c[0]in i)s=c[0];else{for(n in i){if(!c[0]||e.converters[n+" "+c[0]]){s=n;break}o||(o=n)}s=s||o}if(s)return s!==c[0]&&c.unshift(s),i[s]}(f,E,o)),!u&&_.inArray("script",f.dataTypes)>-1&&(f.converters["text script"]=function(){}),y=function(e,t,i,r){var n,s,o,a,c,l={},d=e.dataTypes.slice();if(d[1])for(o in e.converters)l[o.toLowerCase()]=e.converters[o];for(s=d.shift();s;)if(e.responseFields[s]&&(i[e.responseFields[s]]=t),!c&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),c=s,s=d.shift()){if("*"===s)s=c;else if("*"!==c&&c!==s){if(!(o=l[c+" "+s]||l["* "+s])){for(n in l)if((a=n.split(" "))[1]===s&&(o=l[c+" "+a[0]]||l["* "+a[0]])){true===o?o=l[n]:true!==l[n]&&(s=a[0],d.unshift(a[1]));break}}if(true!==o)if(o&&e.throws)t=o(t);else try{t=o(t)}catch(I){return{state:"parsererror",error:o?I:"No conversion from "+c+" to "+s}}}}return{state:"success",data:t}}(f,y,E,u),u?(f.ifModified&&((C=E.getResponseHeader("Last-Modified"))&&(_.lastModified[n]=C),(C=E.getResponseHeader("etag"))&&(_.etag[n]=C)),204===e||"HEAD"===f.type?w="nocontent":304===e?w="notmodified":(w=y.state,h=y.data,u=!(b=y.error))):(b=w,!e&&w||(w="error",e<0&&(e=0))),E.status=e,E.statusText=(t||w)+"",u?m.resolveWith(p,[h,w,E]):m.rejectWith(p,[E,w,b]),E.statusCode(S),S=void 0,d&&g.trigger(u?"ajaxSuccess":"ajaxError",[E,f,u?h:b]),v.fireWith(p,[E,w]),d&&(g.trigger("ajaxComplete",[E,f]),--_.active||_.event.trigger("ajaxStop")))}return E},getJSON:function(e,t,i){return _.get(e,t,i,"json")},getScript:function(e,t){return _.get(e,void 0,t,"script")}}),_.each(["get","post"],(function(e,t){_[t]=function(e,i,r,n){return v(i)&&(n=n||r,r=i,i=void 0),_.ajax(_.extend({url:e,type:t,dataType:n,data:i,success:r},_.isPlainObject(e)&&e))}})),_.ajaxPrefilter((function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")})),_._evalUrl=function(e,t,i){return _.ajax({url:e,type:"GET",dataType:"script",cache:true,async:false,global:false,converters:{"text script":function(){}},dataFilter:function(e){_.globalEval(e,t,i)}})},_.fn.extend({wrapAll:function(e){var t;return this[0]&&(v(e)&&(e=e.call(this[0])),t=_(e,this[0].ownerDocument).eq(0).clone(true),this[0].parentNode&&t.insertBefore(this[0]),t.map((function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e})).append(this)),this},wrapInner:function(e){return v(e)?this.each((function(t){_(this).wrapInner(e.call(this,t))})):this.each((function(){var t=_(this),i=t.contents();i.length?i.wrapAll(e):t.append(e)}))},wrap:function(e){var t=v(e);return this.each((function(i){_(this).wrapAll(t?e.call(this,i):e)}))},unwrap:function(e){return this.parent(e).not("body").each((function(){_(this).replaceWith(this.childNodes)})),this}}),_.expr.pseudos.hidden=function(e){return!_.expr.pseudos.visible(e)},_.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},_.ajaxSettings.xhr=function(){try{return new i.XMLHttpRequest}catch(e){}};var Gt={0:200,1223:204},$t=_.ajaxSettings.xhr();m.cors=!!$t&&"withCredentials"in $t,m.ajax=$t=!!$t,_.ajaxTransport((function(e){var t,r;if(m.cors||$t&&!e.crossDomain)return{send:function(n,s){var o,a=e.xhr();if(a.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(o in e.xhrFields)a[o]=e.xhrFields[o];for(o in e.mimeType&&a.overrideMimeType&&a.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest"),n)a.setRequestHeader(o,n[o]);t=function(e){return function(){t&&(t=r=a.onload=a.onerror=a.onabort=a.ontimeout=a.onreadystatechange=null,"abort"===e?a.abort():"error"===e?"number"!=typeof a.status?s(0,"error"):s(a.status,a.statusText):s(Gt[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=t(),r=a.onerror=a.ontimeout=t("error"),void 0!==a.onabort?a.onabort=r:a.onreadystatechange=function(){4===a.readyState&&i.setTimeout((function(){t&&r()}))},t=t("abort");try{a.send(e.hasContent&&e.data||null)}catch(c){if(t)throw c}},abort:function(){t&&t()}}})),_.ajaxPrefilter((function(e){e.crossDomain&&(e.contents.script=false)})),_.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return _.globalEval(e),e}}}),_.ajaxPrefilter("script",(function(e){void 0===e.cache&&(e.cache=false),e.crossDomain&&(e.type="GET")})),_.ajaxTransport("script",(function(e){var t,i;if(e.crossDomain||e.scriptAttrs)return{send:function(r,n){t=_("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",i=function(e){t.remove(),i=null,e&&n("error"===e.type?404:200,e.type)}),b.head.appendChild(t[0])},abort:function(){i&&i()}}}));var zt,Jt=[],qt=/(=)\?(?=&|$)|\?\?/;_.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Jt.pop()||_.expando+"_"+Tt.guid++;return this[e]=true,e}}),_.ajaxPrefilter("json jsonp",(function(e,t,r){var n,s,o,a=false!==e.jsonp&&(qt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&qt.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return n=e.jsonpCallback=v(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(qt,"$1"+n):false!==e.jsonp&&(e.url+=(It.test(e.url)?"&":"?")+e.jsonp+"="+n),e.converters["script json"]=function(){return o||_.error(n+" was not called"),o[0]},e.dataTypes[0]="json",s=i[n],i[n]=function(){o=arguments},r.always((function(){void 0===s?_(i).removeProp(n):i[n]=s,e[n]&&(e.jsonpCallback=t.jsonpCallback,Jt.push(n)),o&&v(s)&&s(o[0]),o=s=void 0})),"script"})),m.createHTMLDocument=((zt=b.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===zt.childNodes.length),_.parseHTML=function(e,t,i){return"string"!=typeof e?[]:("boolean"==typeof t&&(i=t,t=false),t||(m.createHTMLDocument?((r=(t=b.implementation.createHTMLDocument("")).createElement("base")).href=b.location.href,t.head.appendChild(r)):t=b),s=!i&&[],(n=D.exec(e))?[t.createElement(n[1])]:(n=we([e],t,s),s&&s.length&&_(s).remove(),_.merge([],n.childNodes)));var r,n,s},_.fn.load=function(e,t,i){var r,n,s,o=this,a=e.indexOf(" ");return a>-1&&(r=St(e.slice(a)),e=e.slice(0,a)),v(t)?(i=t,t=void 0):t&&"object"==typeof t&&(n="POST"),o.length>0&&_.ajax({url:e,type:n||"GET",dataType:"html",data:t}).done((function(e){s=arguments,o.html(r?_("<div>").append(_.parseHTML(e)).find(r):e)})).always(i&&function(e,t){o.each((function(){i.apply(this,s||[e.responseText,t,e])}))}),this},_.expr.pseudos.animated=function(e){return _.grep(_.timers,(function(t){return e===t.elem})).length},_.offset={setOffset:function(e,t,i){var r,n,s,o,a,c,l=_.css(e,"position"),d=_(e),u={};"static"===l&&(e.style.position="relative"),a=d.offset(),s=_.css(e,"top"),c=_.css(e,"left"),("absolute"===l||"fixed"===l)&&(s+c).indexOf("auto")>-1?(o=(r=d.position()).top,n=r.left):(o=parseFloat(s)||0,n=parseFloat(c)||0),v(t)&&(t=t.call(e,i,_.extend({},a))),null!=t.top&&(u.top=t.top-a.top+o),null!=t.left&&(u.left=t.left-a.left+n),"using"in t?t.using.call(e,u):("number"==typeof u.top&&(u.top+="px"),"number"==typeof u.left&&(u.left+="px"),d.css(u))}},_.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each((function(t){_.offset.setOffset(this,e,t)}));var t,i,r=this[0];return r?r.getClientRects().length?(t=r.getBoundingClientRect(),i=r.ownerDocument.defaultView,{top:t.top+i.pageYOffset,left:t.left+i.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,i,r=this[0],n={top:0,left:0};if("fixed"===_.css(r,"position"))t=r.getBoundingClientRect();else{for(t=this.offset(),i=r.ownerDocument,e=r.offsetParent||i.documentElement;e&&(e===i.body||e===i.documentElement)&&"static"===_.css(e,"position");)e=e.parentNode;e&&e!==r&&1===e.nodeType&&((n=_(e).offset()).top+=_.css(e,"borderTopWidth",true),n.left+=_.css(e,"borderLeftWidth",true))}return{top:t.top-n.top-_.css(r,"marginTop",true),left:t.left-n.left-_.css(r,"marginLeft",true)}}},offsetParent:function(){return this.map((function(){for(var e=this.offsetParent;e&&"static"===_.css(e,"position");)e=e.offsetParent;return e||se}))}}),_.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(e,t){var i="pageYOffset"===t;_.fn[e]=function(r){return Y(this,(function(e,r,n){var s;if(S(e)?s=e:9===e.nodeType&&(s=e.defaultView),void 0===n)return s?s[t]:e[r];s?s.scrollTo(i?s.pageXOffset:n,i?n:s.pageYOffset):e[r]=n}),e,r,arguments.length)}})),_.each(["top","left"],(function(e,t){_.cssHooks[t]=$e(m.pixelPosition,(function(e,i){if(i)return i=Ge(e,t),Be.test(i)?_(e).position()[t]+"px":i}))})),_.each({Height:"height",Width:"width"},(function(e,t){_.each({padding:"inner"+e,content:t,"":"outer"+e},(function(i,r){_.fn[r]=function(n,s){var o=arguments.length&&(i||"boolean"!=typeof n),a=i||(true===n||true===s?"margin":"border");return Y(this,(function(t,i,n){var s;return S(t)?0===r.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(s=t.documentElement,Math.max(t.body["scroll"+e],s["scroll"+e],t.body["offset"+e],s["offset"+e],s["client"+e])):void 0===n?_.css(t,i,a):_.style(t,i,n,a)}),t,o?n:void 0,o)}}))})),_.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(e,t){_.fn[t]=function(e){return this.on(t,e)}})),_.fn.extend({bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,i,r){return this.on(t,e,i,r)},undelegate:function(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),_.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(e,t){_.fn[t]=function(e,i){return arguments.length>0?this.on(t,null,e,i):this.trigger(t)}}));var Kt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;_.proxy=function(e,t){var i,r,n;if("string"==typeof t&&(i=e[t],t=e,e=i),v(e))return r=a.call(arguments,2),(n=function(){return e.apply(t||this,r.concat(a.call(arguments)))}).guid=e.guid=e.guid||_.guid++,n},_.holdReady=function(e){e?_.readyWait++:_.ready(true)},_.isArray=Array.isArray,_.parseJSON=JSON.parse,_.nodeName=M,_.isFunction=v,_.isWindow=S,_.camelCase=J,_.type=w,_.now=Date.now,_.isNumeric=function(e){var t=_.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},_.trim=function(e){return null==e?"":(e+"").replace(Kt,"")},void 0===(r=function(){return _}.apply(t,[]))||(e.exports=r);var Xt=i.jQuery,Qt=i.$;return _.noConflict=function(e){return i.$===_&&(i.$=Qt),e&&i.jQuery===_&&(i.jQuery=Xt),_},void 0===n&&(i.jQuery=i.$=_),_}))},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});t.ConferenceStats=class{constructor(){this.participants=[],this.talkDuration=0}};t.ConferenceStatsParticipant=class{constructor(e){this.talkerId=null,this.contact=null,this.talkDuration=0,this.activeSince=null,this.talkDisplay=0,this.talkerId=e}}},function(e,t,i){i.r(t);var r=i(19),n=i(8),s=i(151),o=i(6),a=i(24),c=i(101),l=i(71);angular.module("rainbow").service("adminCompanyService",["$q","$log","$http","$rootScope","errorHelperService","centralizedService","Site","CompanyRequest","Bot",function(e,t,i,d,u,h,f,p,g){const m=this,v=r.SettingsService.getInstance(),S=n.AuthService.getInstance(),b=s.CompanyService.getInstance(),y=o.ContactService.getInstance();m.start=function(){return t.info("[adminCompanyService] === STARTING ==="),m.portalURL=config.restServerUrl+"/api/rainbow/admin/v1.0/",t.info("[adminCompanyService] === STARTED ==="),e.when()},m.stop=function(){return t.info("[adminCompanyService] === STOPPING ==="),t.info("[adminCompanyService] === STOPPED ==="),e.when()},m.getCompanies=function(r,n,s,o,c,l,d,h,f,p,g,v){const C=e.defer(),w=y.userContact;if(!(w.isSuperadmin()||w.isBusinessAdmin()||w.isCustomerSuccessAdmin()||w.isBPAdmin()||w.isOrganizationAdmin()))return m.getCompany(w.company.id).then((function(e){return{companies:[e]}}));let _=m.portalURL+"companies?format="+(c||"full")+"&selectedThemeObj=true";return r&&(_+="&organisationId="+r),n&&s&&(_+="&offset="+s*(n-1)),s&&(_+="&limit="+s),o&&(_+="&name="+encodeURIComponent(o)),l&&(_+="&bpId="+l),d&&(Array.isArray(d)?d.forEach((function(e){_+="&status="+e})):_+="&status="+d),null!=h&&(_+="&isBP="+h),f&&(_+="&bpType="+f),p&&(_+="&offerCanBeSold="+p),g&&(_+="&externalReference="+encodeURIComponent(g)),i({method:"GET",url:_,headers:S.getRequestHeader()}).then((function(e){const i=e.data.data;t.info("[adminCompanyService] getCompanies success");const r=[];i.forEach((function(e){const t=a.Company.createFromData(e);!angular.isUndefined(v)&&v||b.getCompanyLogo(t),r.push(t)})),C.resolve({companies:r,limit:e.data.limit,offset:e.data.offset,total:e.data.total})}),(function(e){const i=u.handleError(e);C.reject(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"getCompanies"))})),C.promise},m.getAllCompaniesSmall=function(e,t,i,r,n){return m.getAllCompanies(e,t,i,r,n,"small")},m.getAllCompanies=function(t,i,r,n,s,o,a){const c=a?1:5;return e((function(a,l){let d;m.getCompanies(t,1,1e3,null,o,i,r,n,s).then((function(a){if(d=a,a.total>a.limit){const l=Math.ceil(a.total/1e3);let d=Array(...Array(l-1));d=d.map((function(e,t){return t+2}));const u=[];for(;d.length>0;)u.push(d.splice(0,c));return u.reduce((function(c,l){return c.then((function(){const c=l.map((function(e){return m.getCompanies(t,e,1e3,null,o,i,r,n,s).then((function(e){a.companies=a.companies.concat(e.companies),a.limit+=e.limit}))}));return e.all(c)}))}),e.resolve())}return e.resolve()})).then((function(){a(d)})).catch((function(e){l(e)}))}))},m.exportManagedCompaniesListCsvFile=function(i,r){return e((function(e,n){t.info("[adminCompanyService] === exportManagedCompaniesListCsvFile ===");const s=moment(),o=(r?"reseller_":"customer_")+"companies_"+s.format("YYYY-MM-DD_HH-mm")+".csv",a=Boolean(r);let c;m.buildManagedCompaniesListCsvBlob(i,a).then((function(e){return c=e,h.fileSaver.promptFolderPathAndSavePromise(o)})).then((function(){h.fileSaver.fileDownload(c,null,null,o,true),e()})).catch((function(e){n(e)}))}))},m.buildManagedCompaniesListCsvBlob=function(i,r){return e((function(n,s){t.info("[adminCompanyService] === buildManagedCompaniesListCsvBlob ===");const o=[];m.getAllCompanies(null,i,null,r,null,"full",true).then((function(t){return r?o.push("partnerTier2Name;partnerTier2Reference;partnerTier2AdditionalReference;customerName;customerReference;customerAdditionalReference;status;offerType;street;city;postalCode;country;state;timezone;supportEmail;adminHasRightToUpdateSubscriptions;adminAllowedUpdateSubscriptionsOps;creationDate"):o.push("customerName;customerReference;customerAdditionalReference;status;offerType;street;city;postalCode;country;state;timezone;supportEmail;adminHasRightToUpdateSubscriptions;adminAllowedUpdateSubscriptionsOps;creationDate"),t.companies.reduce((function(t,i){return t.then((function(){let t="";return t+=i.name,t+=";",t+=i.externalReference?i.externalReference:"",t+=";",t+=i.externalReference2?i.externalReference2:"",r&&(t+=";",t+=";",t+=";"),t+=";",t+=i.status,t+=";",t+=i.offerType,t+=";",t+=i.street?i.street:"",t+=";",t+=i.city?i.city:"",t+=";",t+=i.postalCode?i.postalCode:"",t+=";",t+=i.country?i.country:"",t+=";",t+=i.state?i.state:"",t+=";",t+=i.timezone?i.timezone:"",t+=";",t+=i.supportEmail?i.supportEmail:"",t+=";",t+=i.adminHasRightToUpdateSubscriptions,t+=";",t+=i.adminHasRightToUpdateSubscriptions?i.adminAllowedUpdateSubscriptionsOps:"",t+=";",t+=i.creationDate,o.push(t),r?m.getAllCompanies(null,i.id,null,false,null,"full",true).then((function(e){e.companies.forEach((function(e){let t="";t+=i.name,t+=";",t+=i.externalReference?i.externalReference:"",t+=";",t+=i.externalReference2?i.externalReference2:"",t+=";",t+=e.name,t+=";",t+=e.externalReference?e.externalReference:"",t+=";",t+=e.externalReference2?e.externalReference2:"",t+=";",t+=e.status,t+=";",t+=e.offerType,t+=";",t+=";",t+=";",t+=";",t+=";",t+=";",t+=";",t+=";",t+=";",t+=";",o.push(t)}))})):e.resolve()}))}),e.resolve())})).then((function(){const e=new Blob([o.join("\r\n")],{type:"text/csv; charset=utf-8"});n(e)})).catch((function(e){s(e)}))}))},m.getCompany=function(r,n){let s=m.portalURL+"companies/"+r+"?format="+(n||"full");return s+="&selectedThemeObj=true",e((function(e,r){i({method:"GET",url:s,headers:S.getRequestHeader()}).then((function(i){t.info("[adminCompanyService] getCompany success");const r=i.data.data,n=a.Company.createFromData(r);b.getCompanyLogo(n),b.getCompanyBanner(n),e(n)}),(function(e){const i=u.handleError(e);r(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"getCompany"))}))}))},m.getDefaultCompany=function(){return e((function(e,r){i({method:"GET",url:m.portalURL+"companies/default?selectedThemeObj=true",headers:S.getRequestHeader()}).then((function(i){t.info("[adminCompanyService] getDefaultCompany success");const r=i.data.data,n=a.Company.createFromData(r);e(n)}),(function(e){const i=u.handleError(e);r(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"getDefaultCompany"))}))}))},m.searchCompanies=function(t){const i=e.defer(),r=t.toLowerCase();return m.getCompanies().then((function(e){const t=e.companies.filter((function(e){return e.name.toLowerCase().indexOf(r)>-1}));i.resolve(t)})),i.promise},m.createCompany=function(r){const n=a.Company.prune(r,y.userContact),s=e.defer();return i({method:"POST",url:m.portalURL+"companies?selectedThemeObj=true",headers:S.getRequestHeader(),data:n}).then((function(e){t.info("[adminCompanyService] createCompany success");const i=a.Company.createFromData(e.data.data);d.$broadcast("ADMIN_COMPANIES_CHANGE"),s.resolve(i)}),(function(e){const i=u.handleError(e);s.reject(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"createCompany"))})),s.promise},m.createCompanyEndUser=function(r){const n=a.Company.prune(r,y.userContact),s=e.defer();return i({method:"POST",url:config.restServerUrl+"/api/rainbow/enduser/v1.0/companies?selectedThemeObj=true",headers:S.getRequestHeader(),data:n}).then((function(e){t.info("[adminCompanyService] createCompany success");const i=e.data.data,r=a.Company.createFromData(i);s.resolve(r)}),(function(e){const i=u.handleError(e);s.reject(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"createCompanyEndUser"))})),s.promise},m.updateCompany=function(r){const n=a.Company.prune(r,y.userContact),s=e.defer();return i({method:"PUT",url:m.portalURL+"companies/"+r.id+"?selectedThemeObj=true",headers:S.getRequestHeader(),data:n}).then((function(e){t.info("[adminCompanyService] updateCompany success");const i=e.data.data,n=a.Company.createFromData(i);s.resolve(n),d.$broadcast("ON_COMPANY_CHANGE_EVENT",r.id)}),(function(e){const i=u.handleError(e);s.reject(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"updateCompany"))})),s.promise},m.setDefaultLicenseGroup=function(e,t){const i={id:e,defaultLicenseGroup:t||null};return m.updateCompany(i)},m.addVisibility=function(r,n){const s=e.defer();return i({method:"POST",url:m.portalURL+"companies/"+r+"/visible-by/"+n,headers:S.getRequestHeader()}).then((function(){t.info("[adminCompanyService] addVisibility success"),s.resolve()}),(function(e){const i=u.handleError(e);s.reject(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"addVisibility"))})),s.promise},m.removeVisibility=function(r,n){const s=e.defer();return i({method:"DELETE",url:m.portalURL+"companies/"+r+"/visible-by/"+n,headers:S.getRequestHeader()}).then((function(){t.info("[adminCompanyService] removeVisibility success"),s.resolve()}),(function(e){const i=u.handleError(e);s.reject(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"removeVisibility"))})),s.promise},m.getAllSiteCompany=function(r){const n=e.defer();return i({method:"GET",url:m.portalURL+"companies/"+r+"/sites",headers:S.getRequestHeader()}).then((function(e){t.info("[adminCompanyService] getAllSiteCompany success");const i=e.data.data,r=[];i.forEach((function(e){const t=f.createFromData(e);r.push(t)})),n.resolve(r)}),(function(e){const i=u.handleError(e);n.reject(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"getAllSiteCompany"))})),n.promise},m.getCompanyAdministrators=function(r){return e((function(e,n){i({method:"GET",url:m.portalURL+"companies/"+r+"/administrators",headers:S.getRequestHeader()}).then((function(i){t.info("[adminCompanyService] getCompanyAdministrators success");const r=i.data.data,n=[];r.forEach((function(e){const t={id:e.id};n.push(t)})),e(n)}),(function(e){const i=u.handleError(e);n(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"getCompanyAdministrators"))}))}))},m.deleteCompany=function(r){const n=e.defer();return i({method:"DELETE",url:m.portalURL+"companies/"+r,headers:S.getRequestHeader()}).then((function(){t.info("[adminCompanyService] deleteCompany success"),n.resolve()}),(function(e){const i=u.handleError(e);n.reject(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"deleteCompany"))})),n.promise},m.pushImage=function(r,n,s){return e((function(o,a){let c=null;if(s&&s.nosize)c=function(){const t=new Image;return t.src=n,e.when(t)};else{const e=s&&s.width?s.width:512,t=s&&s.height?s.height:512;c=function(){return Object(l.resizeImage)(n,e,t)}}c().then((function(e){const n=Object(l.getBinaryData)(e);i({method:"POST",url:r,headers:S.getPostHeader("image/"+n.type),data:n.data,transformRequest:[]}).then((function(){t.info("[adminCompanyService] pushImage : success"),o()}),(function(e){const i=u.handleError(e);a(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"pushImage"))}))}))}))},m.pushLogo=function(i,r,n,s){return e((function(o,a){const c=m.portalURL+"companies/"+i+"/avatar";(angular.isDefined(r)&&null!==r?m.pushImage(c,r,s):e.resolve()).then((function(){return m.getCompany(i)})).then((function(e){return e.avatarShape=n,m.updateCompany(e)})).then((function(){t.info("[adminCompanyService] pushLogo success"),o()})).catch((function(e){a(e)}))}))},m.deleteLogo=function(r){return e((function(e,n){i({method:"DELETE",url:m.portalURL+"companies/"+r+"/avatar",headers:S.getRequestHeader()}).then((function(){m.getCompany(r).then((function(e){return e.avatarShape="circle",m.updateCompany(e)})).then((function(){t.info("[adminCompanyService] deleteLogo success"),e()})).catch((function(e){n(e)}))}),(function(e){const i=u.handleError(e);n(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"deleteLogo"))}))}))},m.pushBanner=function(t,i,r){return e((function(e,n){const s=m.portalURL+"companies/"+t+"/banner";return m.pushImage(s,i,r).then((function(){d.$broadcast("ON_COMPANY_CHANGE_EVENT",t),e()})).catch((function(e){n(e)}))}))},m.deleteBanner=function(r){return e((function(e,n){i({method:"DELETE",url:m.portalURL+"companies/"+r+"/banner",headers:S.getRequestHeader()}).then((function(){d.$broadcast("ON_COMPANY_CHANGE_EVENT",r),t.info("[adminCompanyService] deleteBanner success"),e()}),(function(e){const i=u.handleError(e);n(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"deleteBanner"))}))}))},m.getCompanySupportBot=function(r){return e((function(e,n){let s=m.portalURL+"bots/rainbow-support";r&&(s+="?companyId="+r),i({method:"GET",url:s,headers:S.getRequestHeader()}).then((function(i){t.info("[companyService] getCompanySupportBot success");const r=g.create(i.data.data);e(r)})).catch((function(e){const i="getCompanySupportBot failure "+e.data.errorDetails+" with status "+e.status;t.error("[companyService] "+i),n(new Error(i))}))}))},m.pushCompanyBotAvatar=function(i,r,n){return e((function(s,o){const a=m.portalURL+"bots/"+i+"/companies/"+r+"/avatar";(angular.isDefined(n)&&null!==n?m.pushImage(a,n):e.resolve()).then((function(){t.info("[adminCompanyService] pushCompanyBotAvatar success"),s()})).catch((function(e){o(e)}))}))},m.deleteCompanyBotAvatar=function(r,n){return e((function(e,s){i({method:"DELETE",url:m.portalURL+"bots/"+r+"/companies/"+n+"/avatar",headers:S.getRequestHeader()}).then((function(){t.info("[adminCompanyService] deleteCompanyBotAvatar success"),e()}),(function(e){const i=u.handleError(e);s(i),t.error("[botService] "+u.getErrorFullMessage(e,"deleteCompanyBotAvatar"))}))}))},m.getCompanyInvitations=function(r,n,s){return e((function(e,o){let a=m.portalURL+"companies/"+r+"/join-companies/invitations?format=medium&status=pending declined failed&limit="+s;n&&(a+="&offset="+s*(n-1)),i({method:"GET",url:a,headers:S.getRequestHeader()}).then((function(i){const r=[];i.data.data.forEach((function(e){const t=c.CompanyInvitation.createFromData(e);r.push(t)})),t.info("[adminCompanyService] getCompanyInvitations success (found "+r.length+" invitation(s))"),e({invitations:r,total:i.data.total})}),(function(e){const i=u.handleError(e);o(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"getCompanyInvitations"))}))}))},m.joinCompanyInvitation=function(r,n,s,o,a,c){const l=e.defer(),d={lang:v.getAppliLanguageCodeForServer()};return o&&(d.customMessage=o),s?d.invitedUserId=s:n&&(d.email=n),a&&(d.invitedToBeCompanyAdmin=a),c&&(d.invitedToBeBpAdmin=c),i({method:"POST",url:m.portalURL+"companies/"+r+"/join-companies/invitations",headers:S.getRequestHeader(),data:d}).then((function(){t.info("[adminCompanyService] joinCompanyInvitation success"),l.resolve()}),(function(e){const i=u.handleError(e);l.reject(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"joinCompanyInvitation"))})),l.promise},m.cancelJoinCompanyInvitation=function(r,n){const s=e.defer();return i({method:"POST",url:m.portalURL+"companies/"+r+"/join-companies/invitations/"+n+"/cancel",headers:S.getRequestHeader()}).then((function(e){const i=c.CompanyInvitation.createFromData(e.data.data);t.info("[adminCompanyService] cancelJoinCompanyInvitation success"),s.resolve(i)}),(function(e){const i=u.handleError(e);s.reject(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"cancelJoinCompanyInvitation"))})),s.promise},m.resendJoinCompanyInvitation=function(r,n){const s=e.defer();return i({method:"POST",url:m.portalURL+"companies/"+r+"/join-companies/invitations/"+n+"/re-send",headers:S.getRequestHeader()}).then((function(e){const i=c.CompanyInvitation.createFromData(e.data.data);t.info("[adminCompanyService] resendJoinCompanyInvitation success"),s.resolve(i)}),(function(e){const i=u.handleError(e);s.reject(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"resendJoinCompanyInvitation"))})),s.promise},m.getCompanyJoinRequests=function(r){return e((function(e,n){i({method:"GET",url:m.portalURL+"companies/"+r+"/join-companies/requests?format=medium&status=pending",headers:S.getRequestHeader()}).then((function(i){const r=[];i.data.data.forEach((function(e){const t=p.createFromData(e);r.push(t)})),t.info("[adminCompanyService] getCompanyJoinRequests success (found "+i.data.total+" invitation(s))"),e({companyRequests:r,total:i.data.total})}),(function(e){const i=u.handleError(e);n(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"getCompanyJoinRequests"))}))}))},m.getJoinCompanyRequest=function(r,n){return e((function(e,s){i({method:"GET",url:m.portalURL+"companies/"+r+"/join-companies/requests/"+n+"?status=pending",headers:S.getRequestHeader()}).then((function(i){const r=p.createFromData(i.data.data);t.info("[adminCompanyService] getJoinCompanyRequest success"),e(r)}),(function(e){const i=u.handleError(e);s(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"getJoinCompanyRequest"))}))}))},m.acceptCompanyJoinRequests=function(r,n){return e((function(e,s){i({method:"POST",url:m.portalURL+"companies/"+r+"/join-companies/requests/"+n+"/accept",headers:S.getRequestHeader()}).then((function(i){const r=p.createFromData(i.data.data);t.info("[adminCompanyService] acceptCompanyJoinRequests success"),e(r)}),(function(e){const i=u.handleError(e);t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"acceptCompanyJoinRequests")),s(i)}))}))},m.declineCompanyJoinRequests=function(r,n){return e((function(e,s){i({method:"POST",url:m.portalURL+"companies/"+r+"/join-companies/requests/"+n+"/decline",headers:S.getRequestHeader()}).then((function(i){const r=p.createFromData(i.data.data);t.info("[adminCompanyService] declineCompanyJoinRequests success"),e(r)}),(function(e){const i=u.handleError(e);t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"declineCompanyJoinRequests")),s(i)}))}))},m.getOAuthConsentUrl=function(){const r=v.getAppliLanguage().code;return e((function(e,n){i({method:"GET",url:config.restServerUrl+"/api/rainbow/office365/v1.0/consent?callback="+window.location.origin+"/redirectO365.html?provider=o365AD&lang="+r,headers:S.getRequestHeader()}).then((function(i){const r=i.data.url;t.info("[adminCompanyService] getOAuthConsentUrl success: "+r),e(r)}),(function(e){const i=u.handleError(e);t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"getOAuthConsentUrl")),n(i)}))}))},m.updateCompanyPhoneNumbersVisibility=function(t,i){return e((function(e,r){const n={id:t,allowPhoneNumbersVisibility:i};m.updateCompany(n).then((function(t){e(t.allowPhoneNumbersVisibility)})).catch((function(e){r(e)}))}))},m.getCompanyConferenceSettings=function(r){return e((function(e,n){i({method:"GET",url:m.portalURL+"companies/"+r+"/settings/conferences",headers:S.getRequestHeader()}).then((function(i){t.info("[adminCompanyService] getCompanyConferenceSettings success");const r=i.data.data;e(r)}),(function(e){const i=u.handleError(e);n(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"getCompanyConferenceSettings"))}))}))},m.setCompanyConferenceSettings=function(r,n){return e((function(e,s){const o={confDialOutDisabled:!n};i({method:"PUT",url:m.portalURL+"companies/"+r+"/settings/conferences",headers:S.getRequestHeader(),data:o}).then((function(i){t.info("[adminCompanyService] setCompanyConferenceSettings success");const r=i.data.data;e(r)}),(function(e){const i=u.handleError(e);s(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"setCompanyConferenceSettings"))}))}))},m.getUserLoginPolicies=function(i){return e((function(e){const r=[{value:"RAINBOW",name:"Rainbow"}];let n=r[0];m.getCompanySingleSignOnServerConfig(i).then((function(e){e&&e.length>0&&e.forEach((function(e){const t={value:e.type,name:e.name,allowExternalAuthId:true};r.push(t),e.isDefault&&e.enabled&&(n=t)}))})).catch((function(e){t.error("[adminCompanyService] Failed to get user login policies - "+i+" - "+e.translatedMessage||false)})).finally((function(){n.isDefault=true,r.push({value:"DEFAULT",label:"defaultLogin"}),e(r)}))}))},m.getAllAvailableSingleSignOnTypes=function(){return e((function(e,r){i({method:"GET",url:m.portalURL+"/settings/sso/types",headers:S.getRequestHeader()}).then((function(i){t.info("[adminCompanyService] getAllAvailableSingleSignOnTypes success"),e(i.data.data)}),(function(e){const i=u.handleError(e);r(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"getAllAvailableSingleSignOnTypes"))}))}))},m.getCompanySAMLConfigurationFile=function(i){return e((function(e,r){S.getCompanySAMLConfiguration(i).then((function(t){const i=new Blob([t],{type:"application/xml"});e(i)})).catch((function(e){const i=u.handleError(e);r(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"getCompanySAMLConfigurationFile"))}))}))},m.createCompanySingleSignOnServerConfig=function(r,n,s){return e((function(e,o){s.type=n,i({method:"POST",url:m.portalURL+"companies/"+r+"/settings/sso",headers:S.getRequestHeader(),data:s}).then((function(i){t.info("[adminCompanyService] createCompanySingleSignOnServerConfig success");const r=i.data.data;e(r)}),(function(e){const i=u.handleError(e);o(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"createCompanySingleSignOnServerConfig"))}))}))},m.deleteCompanySingleSignOnServerConfig=function(r,n){return e((function(e,s){i({method:"DELETE",url:m.portalURL+"companies/"+r+"/settings/sso/"+n,headers:S.getRequestHeader()}).then((function(){t.info("[adminCompanyService] deleteCompanySingleSignOnServerConfig success"),e()}),(function(e){const i=u.handleError(e);s(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"deleteCompanySingleSignOnServerConfig"))}))}))},m.getCompanySingleSignOnServerConfig=function(r){return e((function(e,n){i({method:"GET",url:m.portalURL+"companies/"+r+"/settings/sso",headers:S.getRequestHeader()}).then((function(i){t.info("[adminCompanyService] getCompanySingleSignOnServerConfig success");const r=i.data.data?i.data.data:i.data;e(r)}),(function(e){const i=u.handleError(e);n(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"getCompanySingleSignOnServerConfig"))}))}))},m.updateCompanySingleSignOnServerConfig=function(r,n,s){return e((function(e,o){i({method:"PUT",url:m.portalURL+"companies/"+r+"/settings/sso/"+n,headers:S.getRequestHeader(),data:s}).then((function(i){t.info("[adminCompanyService] updateCompanySingleSignOnConfig success");const r=i.data.data;e(r)}),(function(e){const i=u.handleError(e);o(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"updateCompanySingleSignOnConfig"))}))}))},m.getCompanySingleSignOnSAMLOptions=function(r){return e((function(e,n){i({method:"GET",url:m.portalURL+"companies/"+r+"/settings/sso/SAML/shared-options",headers:S.getRequestHeader()}).then((function(i){t.info("[adminCompanyService] getCompanySingleSignOnSAMLOptions success"),e(i.data.data)}),(function(e){const i=u.handleError(e);n(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"getCompanySingleSignOnSAMLOptions"))}))}))},m.updateCompanySingleSignOnSAMLOptions=function(r,n){return e((function(e,s){i({method:"PUT",url:m.portalURL+"companies/"+r+"/settings/sso/SAML/shared-options",headers:S.getRequestHeader(),data:n}).then((function(i){t.info("[adminCompanyService] updateCompanySingleSignOnSAMLOptions success"),e(i.data.data)}),(function(e){const i=u.handleError(e);s(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"updateCompanySingleSignOnSAMLOptions"))}))}))},m.deleteCompanySingleSignOnSAMLOptions=function(r){return e((function(e,n){i({method:"DELETE",url:m.portalURL+"companies/"+r+"/settings/sso/SAML/shared-options",headers:S.getRequestHeader()}).then((function(){t.info("[adminCompanyService] deleteCompanySingleSignOnSAMLOptions success"),e()}),(function(i){const r=u.handleError(i);404===r.status?(e(),t.info("[adminCompanyService] "+u.getErrorFullMessage(i,"deleteCompanySingleSignOnSAMLOptions"))):(n(r),t.error("[adminCompanyService] "+u.getErrorFullMessage(i,"deleteCompanySingleSignOnSAMLOptions")))}))}))},m.getCompanyBpBusinessTypes=function(){return e((function(e,r){i({method:"GET",url:m.portalURL+"companies/bpbusinesstypes",headers:S.getRequestHeader()}).then((function(i){t.info("[adminCompanyService] getCompanyBpBusinessTypes success");const r=i.data.data;e(r)}),(function(e){const i=u.handleError(e);r(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"getCompanyBpBusinessTypes"))}))}))},m.getVoIPSettingsForCompany=function(r){return e((function(e,n){i({method:"GET",url:m.portalURL+"companies/"+r+"/settings/webrtcs",headers:S.getRequestHeader()}).then((function(i){t.info("[adminCompanyService] getVoIPSettingsForCompany success");const r=i.data.data;e(r)}),(function(e){const i=u.handleError(e);n(i),t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"getVoIPSettingsForCompany"))}))}))},m.createVoIPSettingsForCompany=function(r,n){return e((function(e,s){i({method:"POST",url:m.portalURL+"companies/"+r+"/settings/webrtcs",headers:S.getRequestHeader(),data:n}).then((function(){e()}),(function(e){const i=u.handleError(e);t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"createVoIPSettingsForCompany")),s(i)}))}))},m.updateVoIPSettingsForCompany=function(r,n,s){return e((function(e,o){i({method:"PUT",url:m.portalURL+"companies/"+r+"/settings/webrtcs/"+n,headers:S.getRequestHeader(),data:s}).then((function(){e()}),(function(e){const i=u.handleError(e);t.error("[adminCompanyService] "+u.getErrorFullMessage(e,"createVoIPSettingsForCompany")),o(i)}))}))}}])},function(e,t,i){i.r(t);var r=i(8),n=i(63),s=i(6),o=i(24),a=i(128);angular.module("rainbow").service("adminUserService",["$q","$log","$http","errorHelperService","User","Site","PhoneNumber",function(e,t,i,c,l,d,u){const h=this,f=r.AuthService.getInstance(),p=n.UserInfoService.getInstance(),g=s.ContactService.getInstance();h.start=function(){return t.info("[adminUserService] === STARTING ==="),h.portalURL=config.restServerUrl+"/api/rainbow/admin/v1.0/",t.info("[adminUserService] === STARTED ==="),e.when()},h.stop=function(){return t.info("[adminUserService] === STOPPING ==="),t.info("[adminUserService] === STOPPED ==="),e.when()},h.getUsersByEmail=function(r,n){return e((function(e,s){let u=h.portalURL+"users?format=full";r&&r.constructor&&r.constructor.name===a.Organisation.name&&(u+="&organisationId="+r.id),r&&r.constructor&&r.constructor.name===o.Company.name&&(u+="&companyId="+r.id),r&&r.constructor&&r.constructor.name===d.name&&(u+="&siteId="+r.id),n&&(u+="&email="+encodeURIComponent(n)),i({method:"GET",url:u,headers:f.getRequestHeader()}).then((function(i){const r=i.data.data;t.info("[adminUserService] getUsersByEmail success (find "+i.data.total+" user(s))");const n=[];r.forEach((function(e){const t=l.createFromData(e);n.push(t)})),e({users:n,total:i.data.total})}),(function(e){const i=c.handleError(e);s(i),t.error("[adminUserService] "+c.getErrorFullMessage(e,"getUsersByEmail"))}))}))},h.getUsersBasicSearch=function(e,t,i,r){return h.getUsersAdvancedSearch(e,t,i,r)},h.getUsersAdvancedSearch=function(r,n,s,u,p,g){return e((function(e,m){const v=new URL(h.portalURL+"users");"string"==typeof r&&v.searchParams.set("companyId",r),r&&r.constructor&&r.constructor.name===o.Company.name&&v.searchParams.set("companyId",r.id),r&&r.constructor&&r.constructor.name===a.Organisation.name&&v.searchParams.set("organisationId",r.id),r&&r.constructor&&r.constructor.name===d.name&&v.searchParams.set("siteId",r.id),v.searchParams.set("format","full"),v.searchParams.set("limit",String(s)),n&&v.searchParams.set("offset",String(s*(n-1))),p=p||{},(u=u||"")&&(p.searchByInternalNumber?v.searchParams.set("phoneNumber",u):(v.searchParams.set("displayName",u),v.searchParams.set("useEmails",true))),p.filterByTag&&v.searchParams.set("tags",p.filterByTag),p.filterByProfile&&v.searchParams.set("selectedAppCustomisationTemplate",p.filterByProfile),p.filterByDepartment&&v.searchParams.set("departments",p.filterByDepartment),p.isAdministrator&&(v.searchParams.append("roles",l.RoleValues.ADMIN),v.searchParams.append("roles",l.RoleValues.BP_ADMIN_OPERATIONS),v.searchParams.append("roles",l.RoleValues.BP_ADMIN_FINANCE),v.searchParams.append("roles",l.RoleValues.BUSINESS_ADMIN),v.searchParams.append("roles",l.RoleValues.CUSTOMER_SUCCESS_ADMIN),v.searchParams.append("roles",l.RoleValues.SUPERADMIN)),true!==p.isActivated&&false!==p.isActivated||v.searchParams.set("isActivated",String(p.isActivated)),true!==p.isTerminated&&false!==p.isTerminated||v.searchParams.set("isTerminated",String(p.isTerminated)),p.sortField&&v.searchParams.set("sortField",p.sortField),i({method:"GET",url:v.toString(),headers:f.getRequestHeader()}).then((function(i){const r=i.data.data;t.info("[adminUserService] getUsers success (find "+i.data.total+" user(s))");const n=[];r.forEach((function(e){const t=l.createFromData(e,g);n.push(t)})),e({users:n,limit:i.data.limit,offset:i.data.offset,total:i.data.total})}),(function(e){const i=c.handleError(e);m(i),t.error("[adminUserService] "+c.getErrorFullMessage(e,"getUsers"))}))}))},h.getUsers=function(e,t,i,r,n,s,o,a,c,l,d,u){const f={searchByInternalNumber:u,filterByTag:a,filterByProfile:l,filterByDepartment:d,isAdministrator:s,isActivated:c,isTerminated:n};return h.getUsersAdvancedSearch(e,t,i,r,f,o)},h.searchUsers=function(r,n,s,o){return e((function(e,a){let d=config.restServerUrl+"/api/rainbow/search/v1.0/users?limit="+s;r&&(d+="&companyId="+r.id),n&&(d+="&offset="+s*(n-1)),o&&(d+="&displayName="+encodeURIComponent(o)),i({method:"GET",url:d,headers:f.getRequestHeader()}).then((function(i){const r=i.data.data;t.info("[adminUserService] searchUsers success (find "+i.data.total+" user(s))");const n=[];r.forEach((function(e){const t=l.createFromData(e);n.push(t)})),e({users:n,total:i.data.total})}),(function(e){const i=c.handleError(e);a(i),t.error("[adminUserService] "+c.getErrorFullMessage(e,"searchUsers"))}))}))},h.getUser=function(r){const n=e.defer();return i({method:"GET",url:h.portalURL+"users/"+r,headers:f.getRequestHeader()}).then((function(e){t.info("[adminUserService] getUser success");const i=e.data.data,r=l.createFromData(i);n.resolve(r)}),(function(e){const i=c.handleError(e);n.reject(i),t.error("[adminUserService] "+c.getErrorFullMessage(e,"getUser"))})),n.promise},h.createUser=function(r,n){const s=l.prune(r,g.userContact);let o=h.portalURL+"users";n&&void 0!==n.sendInvitationEmail&&(o+="?sendInvitationEmail="+n.sendInvitationEmail);const a=e.defer();return i({method:"POST",url:o,headers:f.getRequestHeader(),data:s}).then((function(e){const i=l.createFromData(e.data.data);t.info("[adminUserService] createUser success"),a.resolve(i)}),(function(e){const i=c.handleError(e);a.reject(i),t.error("[adminUserService] "+c.getErrorFullMessage(e,"createUser"))})),a.promise},h.deleteUser=function(r){const n=e.defer();return i({method:"DELETE",url:h.portalURL+"users/"+r.id,headers:f.getRequestHeader()}).then((function(){t.info("[adminUserService] deleteUser success"),n.resolve()}),(function(e){const i=c.handleError(e);n.reject(i),t.error("[adminUserService] "+c.getErrorFullMessage(e,"deleteUser"))})),n.promise},h.updateUser=function(r){const n=l.prune(r,g.userContact),s=e.defer();return i({method:"PUT",url:h.portalURL+"users/"+r.id,headers:f.getRequestHeader(),data:n}).then((function(e){t.info("[adminUserService] updateUser success");const i=l.createFromData(e.data.data);s.resolve(i)}),(function(e){const i=c.handleError(e);s.reject(i),t.error("[adminUserService] "+c.getErrorFullMessage(e,"updateUser"))})),s.promise},h.getUserAvatar=function(e){const t=p.computeUserColor(e.firstName+" "+e.lastName).color;e.image=p.getAvatarImage(e.id,e.initials,t,50,e.lastAvatarUpdateDate)},h.expandTelephonyInfo=function(e){const t={};if(e.phoneNumbers){const i=[];e.phoneNumbers.forEach((function(e){const r=e.number,n=e.numberE164,s=e.deviceType;switch(e.type){case"work":if("landline"===s){const s=u.createFromData(e);i.push(s),e.isCloudPbxDDI||e.isOxoPbxDDI?(t.phonePro=e.number,t.phoneProCan=e.numberE164,t.phoneProDdiNumber=s):t.phoneProNumber&&t.phoneProNumber.systemId||(t.phoneProDdiNumber||(t.phonePro=r,t.phoneProCan=n),t.phoneProExt=e.shortNumber,t.phoneProIsMonitored=e.isMonitored,t.phoneProNumber=s)}"mobile"===s&&(t.mobilePro=r,t.mobileProCan=n);break;case"home":"landline"===s&&(t.phonePerso=r,t.phonePersoCan=n),"mobile"===s&&(t.mobilePerso=r,t.mobilePersoCan=n);break;case"rainbow":t.rainbowPhoneNumber=r}})),t.alternativePhoneProNumbers=i.filter((function(e){return!e.systemId&&!e.isFromSystem&&e.id!==t.phoneProNumber.id}))}return t},h.getAllUsers=function(t,i){return e((function(r,n){let s;h.getUsersAdvancedSearch(t,1,1e3,void 0,void 0,i).then((function(r){if(s=r,r.total>r.limit){const n=Math.ceil(r.total/1e3);let o=Array(...Array(n-1));o=o.map((function(e,t){return t+2}));const a=[];for(;o.length>0;)a.push(o.splice(0,5));return a.reduce((function(r,n){return r.then((function(){const r=n.map((function(e){return h.getUsersAdvancedSearch(t,e,1e3,void 0,void 0,i).then((function(e){s.users=s.users.concat(e.users),s.limit+=e.limit}))}));return e.all(r)}))}),e.resolve())}return e.resolve()})).then((function(){r(s)})).catch((function(e){n(e)}))}))},h.getUserTags=function(r){return e((function(e,n){let s=h.portalURL+"users/tags";r&&(s+="?companyId="+r),i({method:"GET",url:s,headers:f.getRequestHeader()}).then((function(i){const r=i.data.data.tags||[];t.info("[adminUserService] getUserTags success (find "+r.length+"tags(s))"),e(r)}),(function(e){const i=c.handleError(e);n(i),t.error("[adminUserService] "+c.getErrorFullMessage(e,"getUserTags"))}))}))},h.getTagsStats=function(r){return e((function(e,n){let s=h.portalURL+"users/tags/stats";r&&(s+="?companyId="+r),i({method:"GET",url:s,headers:f.getRequestHeader()}).then((function(i){const r=i.data.data.stats||[];t.info("[adminUserService] getTagsStats success (find "+r.length+"tags(s))"),e(r)}),(function(e){const i=c.handleError(e);n(i),t.error("[adminUserService] "+c.getErrorFullMessage(e,"getTagsStats"))}))}))},h.renameTag=function(r,n,s){return e((function(e,o){let a=h.portalURL+"users/tags?tag="+encodeURIComponent(r);s&&(a+="&companyId="+s),i({method:"PUT",url:a,headers:f.getRequestHeader(),data:{newTagName:n}}).then((function(i){t.info("[adminUserService] renameTag success => old tag: "+r+" => new tag: "+n+": found "+i.data.data.found+" occurence(s)"),e()}),(function(e){const i=c.handleError(e);o(i),t.error("[adminUserService] "+c.getErrorFullMessage(e,"renameTag"))}))}))},h.deleteTag=function(r,n){return e((function(e,s){let o=h.portalURL+"users/tags?tag="+encodeURIComponent(r);n&&(o+="&companyId="+n),i({method:"DELETE",url:o,headers:f.getRequestHeader()}).then((function(i){t.info("[adminUserService] deleteTag success (tag "+r+": found "+i.data.data.found+" occurence(s)"),e()}),(function(e){const i=c.handleError(e);s(i),t.error("[adminUserService] "+c.getErrorFullMessage(e,"deleteTag"))}))}))},h.getUserDepartments=function(r){return e((function(e,n){let s=h.portalURL+"users/departments";r&&(s+="?companyId="+r),i({method:"GET",url:s,headers:f.getRequestHeader()}).then((function(i){let r=i.data.data.departments||[];r=r.filter((function(e){return Boolean(e)})),t.info("[adminUserService] getUserDepartments success (find "+r.length+"department(s))"),e(r)}),(function(e){const i=c.handleError(e);n(i),t.error("[adminUserService] "+c.getErrorFullMessage(e,"getUserDepartments"))}))}))},h.getUserProfilesFeatures=function(r){return e((function(e,n){i({method:"GET",url:config.restServerUrl+"/api/rainbow/admin/v1.0/users/"+r+"/profiles/features",headers:f.getRequestHeader()}).then((function(i){const r={};i.data.data.forEach((function(e){t.debug("[adminUserService] getUserProfilesFeatures === response ==="+JSON.stringify(e)),e.hasOwnProperty("featureUniqueRef")&&(r[e.featureUniqueRef]=e)})),e(r)}),(function(i){if(404===i.status)t.debug("[adminUserService] getUserProfilesFeatures : features found for user: "+r),e();else{const e=c.handleError(i);n(e),t.error("[adminUserService] "+c.getErrorFullMessage(i,"getUserProfilesFeatures"))}}))}))},h.getUserPresenceInformation=function(r){return e((function(e,n){i({method:"GET",url:config.restServerUrl+"/api/rainbow/admin/v1.0/users/"+r+"/presences",headers:f.getRequestHeader()}).then((function(i){t.debug("[adminUserService] getUserPresenceInformation for user Id "+r+" === response === "+JSON.stringify(i.data.data));const n={};i.data.data.jid_im.forEach((function(e){n[e.resource]={},n[e.resource].show=e.show?e.show:"online",n[e.resource].status=e.status?e.status:"",n[e.resource].stamp=e.date,n[e.resource].type="jid_im"})),i.data.data.jid_tel.forEach((function(e){"calendar"!==e.resource&&(n[e.resource]={},n[e.resource].show=e.show?e.show:"online",n[e.resource].stamp=e.date,n[e.resource].type="phone")}));const s=h.calculatePresenceFromUserResources(n);e(s)}),(function(e){const i=c.handleError(e);t.error("[adminUserService] "+c.getErrorFullMessage(e,"getUserPresenceInformation")),n(i)}))}))},h.calculatePresenceFromUserResources=function(e){let t=false,i=false,r=false,n=false,s=false,o=false,a="",c=false,l=false,d=false,u="offline",h="";for(const f in e)if(e.hasOwnProperty(f)){const u=e[f];"phone"!==u.type?"xa"===u.show&&""===u.status?i=true:"dnd"===u.show&&""===u.status?r=true:"xa"===u.show&&"away"===u.status?n=true:"dnd"===u.show&&"presentation"===u.status?s=true:"dnd"===u.show&&u.status?(o=true,a=u.status):""!==u.show&&"online"!==u.show||""!==u.status&&"mode=auto"!==u.status?"away"===u.show&&""===u.status&&(d=true):-1!==f.indexOf("mobile_")?l=true:c=true:t="EVT_SERVICE_INITIATED"===u.status||"EVT_ESTABLISHED"===u.status}return t?(u="busy",h="phone"):i?(u="xa",h=""):r?(u="dnd",h=""):n?(u="away",h=""):s?(u="dnd",h="presentation"):o?(u="busy",h=a):c?(u="online",h=""):l?(u="online-mobile",h=""):d&&(u="away",h=""),{presence:u,status:h}}}])},function(e,t){angular.module("rainbow").filter("emojione",(function(){return function(e){return e}})),angular.module("rainbow").filter("emojiUnicodeToShort",(function(){return function(e){return e}})),angular.module("rainbow").filter("emojiShortToUnicode",(function(){return function(e){return e}}))},function(e,t){angular.module("rainbow").service("centralizedService",(function(){}))},function(e,t){angular.module("rainbow").factory("TransfertPromiseQueue",["$log","$q",function(e,t){function i(){const i=this;i.fileQueue=[],i.clearContext=function(){i.currentId=null,i.currentQueue=[],i.promiseCompletion=void 0,i.promiseReject=void 0,i.initialQueueSize=0,i.promisesDone=0,i.chunkErrorCounter=0,i.currentPromise=void 0},i.clearContext(),i.addPromiseArray=function(r,n,s,o){e.debug("[TransfertPromiseQueue] adding promiseArray");const a={};return a.id=r,a.promiseArray=n,a.promiseCompletion=s,a.promiseReject=o,0!==i.fileQueue.length||i.currentPromise?(i.fileQueue.push(a),e.debug("[TransfertPromiseQueue] adding PromiseArray in FileQueue: "+i.fileQueue.length)):(e.debug("[TransfertPromiseQueue] configuring file to transfert: "+a.promiseArray.length),i.fileQueue.push(a),i.popFileQueue()),e.debug("[TransfertPromiseQueue] adding promise on FileQueue: "+i.fileQueue.length),t},i.popFileQueue=function(){if(i.fileQueue.length>0){e.debug("[TransfertPromiseQueue] go to next file");const t=i.fileQueue.shift();i.currentId=t.id,i.currentQueue=t.promiseArray,i.promiseCompletion=t.promiseCompletion,i.promiseReject=t.promiseReject,i.initialQueueSize=i.currentQueue.length,i.promisesDone=0,i.chunkErrorCounter=0,i.currentPromise=[];for(let e=0;e<10&&i.currentQueue.length>0;e++)i.currentPromise.push(i.currentQueue.shift()());i.execute()}else e.debug("[TransfertPromiseQueue] no more file to transfert"),i.clearContext()},i.execute=function(){e.debug("[TransfertPromiseQueue] execute"),i.currentPromise?t.all(i.currentPromise).then((function(){if(e.debug("[TransfertPromiseQueue] promise success go to next one"),i.chunkErrorCounter=0,0===i.currentQueue.length)i.promiseCompletion&&i.promiseCompletion(),i.popFileQueue();else{i.currentPromise=[];for(let e=0;e<10&&i.currentQueue.length>0;e++)i.currentPromise.push(i.currentQueue.shift()());i.execute()}})).catch((function(t){const r=t&&t.message?t.message:"Unknown error";if(e.error("[TransfertPromiseQueue] failure executing promise -- "+r),i.chunkErrorCounter++,t&&t.errorDetailsCode>=500&&i.chunkErrorCounter<=3&&i.currentPromise){const e=i.currentPromise;i.currentPromise=[],e.forEach((function(e){i.currentPromise.push(e())})),i.execute()}else e.error("[TransfertPromiseQueue] 3 chunk failed - ABORT File Upload"),i.promiseReject(t),i.popFileQueue()})):(e.debug("[TransfertPromiseQueue] no promise to perform"),i.currentPromise=void 0)},i.isTransferInProgress=function(){return e.debug("[TransfertPromiseQueue] >isTransferInProgress: "+i.fileQueue.length+"/"+i.currentQueue.length),i.fileQueue.length>0||i.currentQueue.length>0||i.currentPromise},i.cancelAllTransfers=function(){e.debug("[TransfertPromiseQueue] cancelAllTransfers"),i.fileQueue=[],i.currentQueue=[]},i.cancelCurrentFiletransfer=function(t){if(e.debug("[TransfertPromiseQueue] cancelCurrentFiletransfer"),i.currentId===t)e.debug("[TransfertPromiseQueue] cancelling current promise"),i.popFileQueue();else{const r=i.fileQueue.find((function(e){return e.id===t}));if(r){const t=i.fileQueue.indexOf(r);e.debug("[TransfertPromiseQueue] promise to remove at position="+t),i.fileQueue.splice(t,1)}}}}return i.create=function(){return e.debug("[TransfertPromiseQueue] >create"),new i},i}])},function(e,t,i){i.r(t),window.sdk=angular.module("sdk",["pascalprecht.translate","ngSanitize","ngFileSaver","rainbow","rainbowAdmin"],(function(){})),t.default={sdk:sdk}},function(e,t,i){i.r(t);var r=i(39);sdk.remoteConsole={debug:false,log:false,info:false,warn:false,error:false},sdk.hasVerboseLog=false,sdk.hasBeenLaunchedFromConfig=false,sdk.key={appID:"",appSecret:"",host:"openrainbow.com"},sdk.config(["consoleLogsProvider","$provide","$httpProvider","$translateProvider",function(e,t,i,n){const s=function(e){return e.toDateString()+" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)+":"+("0"+e.getSeconds()).slice(-2)};t.decorator("$log",["$delegate",function(t){const i=t.debug;t.debug=function(){const t=[].slice.call(arguments);sdk.remoteConsole.debug&&console.re.debug(t[0]),r.sdkConfig.verboseLog&&i.apply(null,t),e.setLogs(["["+s(new Date)+"]"]+"debug : "+t+"\n")};const n=t.log;t.log=function(){const t=[].slice.call(arguments);sdk.remoteConsole.log&&console.re.log(t[0]),r.sdkConfig.verboseLog&&n.apply(null,t),e.setLogs(["["+s(new Date)+"]"]+"log : "+t+"\n")};const o=t.info;t.info=function(){const t=[].slice.call(arguments);sdk.remoteConsole.info&&console.re.info(t[0]),r.sdkConfig.verboseLog&&o.apply(null,t),e.setLogs(["["+s(new Date)+"]"]+"info : "+t+"\n")};const a=t.warn;t.warn=function(){const t=[].slice.call(arguments);sdk.remoteConsole.warn&&console.re.warn(t[0]),a.apply(null,t),e.setLogs(["["+s(new Date)+"]"]+"warn : "+t+"\n")};const c=t.error;return t.error=function(){const t=[].slice.call(arguments);sdk.remoteConsole.error&&console.re.error(t[0]),c.apply(null,t),e.setLogs(["["+s(new Date)+"]"]+"error : "+t+"\n")},t.webrtc=function(){const t=[].slice.call(arguments),r="rtcweb : "+t[0];t[0]="%c "+s(new Date)+" | RTCWEB | "+t[0],t[t.length]="color:green",sdk.remoteConsole.log&&console.re.log(t[0]),i.apply(null,t),e.setLogs(["["+s(new Date)+"]"]+r+"\n")},t.sdk=function(){const t=[].slice.call(arguments),r="RBW-SDK : "+t[0];t[0]="%c "+s(new Date)+" | RBW-SDK | "+t[0],t[t.length]="color:green",sdk.remoteConsole.log&&console.re.log(t[0]),i.apply(null,t),e.setLogs(["["+s(new Date)+"]"]+r+"\n")},t}]),i.defaults.useXDomain=true,n.useSanitizeValueStrategy(null)}]),sdk.run([function(){}]),sdk.provider("consoleLogs",[function(){this.logsBuffer=[],this.logsMaxLength=2e6,this.$get=function(){const e=this.logsBuffer;return{getLogs:function(){return e}}},this.cleanBuffer=function(){this.logsBuffer.length>this.logsMaxLength&&(this.logsBuffer=this.logsBuffer.slice(-this.logsMaxLength))},this.setLogs=function(e){1e3===this.logsBuffer&&this.logsBuffer.shift(),this.logsBuffer.push(e)}}])},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(7);class n{constructor(){this.id=null,this.type=null,this.message=null,this.from=null,this.images=null,this.attachments=null,this.contact=null,this.video=null,this.isNew=true,this.isModified=false,this.rxSubject=new r.Subject}static createFromData(e,t){const i=new n;return i.isNew=t.new,i.isModified=t.modified,i.id=t.id,i.type=t.type,i.from=t.from,i.timestamp=t.timestamp,i.timestampDisplay=new Date(t.timestamp),i.channel=e,i.video=t.video,t.entry.message&&(i.message=t.entry.message.replace(/<a/gi,"<a target='_blank' rel='noopener noreferrer' ")),t.entry.video&&(i.video=t.entry.video),t.entry.images&&"null"!==t.entry.images&&void 0!==t.entry.images&&(t.entry.images instanceof Array?t.entry.images.length>0&&(i.images=t.entry.images):i.images=[t.entry.images]),t.entry.attachments&&"null"!==t.entry.attachments&&void 0!==t.entry.attachments&&(t.entry.attachments instanceof Array?t.entry.attachments.length>0&&(i.attachments=t.entry.attachments):i.attachments=[t.entry.attachments]),i.myLike=t.my_appreciation?t.my_appreciation:"none",i.likeCounters=t.appreciations?t.appreciations:{like:0,fantastic:0,applause:0,doubt:0,happy:0},i}static updateFromData(e,t,i){const r=new n;return Object.assign(r,t),r.id=i.id,r.isModified=i.modified,r.type=i.type,r.from=i.from,r.timestamp=i.timestamp,r.timestampDisplay=new Date(i.timestamp),r.channel=e,r.video=null,r.images=null,r.attachments=null,r.message=null,i.entry.type&&(r.type=i.entry.type),i.entry.message&&(r.message=i.entry.message.replace(/<a/gi,"<a target='_blank' rel='noopener noreferrer' ")),i.entry.video&&(r.video=i.entry.video),i.entry.images&&"null"!==i.entry.images&&void 0!==i.entry.images&&(i.entry.images instanceof Array?i.entry.images.length>0&&(r.images=i.entry.images):r.images=[i.entry.images]),i.entry.attachments&&"null"!==i.entry.attachments&&void 0!==i.entry.attachments&&(i.entry.attachments instanceof Array?i.entry.attachments.length>0&&(r.attachments=i.entry.attachments):r.attachments=[i.entry.attachments]),r}subscribe(e){return this.rxSubject.subscribe(e)}}t.ChannelMessage=n},function(e,t,i){function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:true}),r(i(159)),r(i(24)),r(i(463)),r(i(106)),r(i(464)),r(i(18)),r(i(316)),r(i(163)),r(i(137)),r(i(142)),r(i(138)),r(i(465))},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});t.ConferenceRecordingFile=class{};t.ConferenceRecord=class{}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});t.DialInPhoneNumber=class{constructor(){this.location="",this.locationcode="",this.number="",this.numberE164="",this.numberType="",this.locationAlpha2Code="",this.prettyDisplayName=""}};class r{constructor(e,t,i,r){this.country="",this.language="",this.shortList=[],this.phoneNumberList=[],this.country=e,this.language=t,this.shortList=i,this.phoneNumberList=r}static createPhoneNumberListFromData(e){return new r(e.country,e.language,e.shortList,e.phoneNumberList)}}t.DialInPhoneNumberList=r},function(e,t,i){function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:true}),r(i(139)),r(i(154)),r(i(76)),r(i(165)),r(i(104)),r(i(466)),r(i(321))},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(321),n=i(7),s=i(17);class o{constructor(e){if(this.lastAvatarUpdateDate=null,this.website=null,this.isThemeSelectedByUser=false,this.isThemeSelectedByAdmin=false,this.type="white",this.ownedByCompany="",this._logoSrc=null,this.logoSrcSubject=new n.BehaviorSubject(this._logoSrc),this._avatarShape="square",this.avatarShapeSubject=new n.BehaviorSubject(this._avatarShape),this.id=e.id,this.name=e.name,this.displayName=e.displayName?e.displayName:e.name,this.logoSrc=e.logoSrc,this.avatarShape=e.avatarShape,this.website=e.website,this.cssClassName=e.cssClassName,this.visibility=e.visibility,this.type=e.type,this.isRainbowDefaultTheme=e.isRainbowDefaultTheme,this.isWhiteLabelTheme=e.isWhiteLabelTheme,this.lastAvatarUpdateDate=e.lastAvatarUpdateDate,this.isThemeSelectedByUser=e.isThemeSelectedByUser,this.isThemeSelectedByAdmin=e.isThemeSelectedByAdmin,this.isColorsAvailable=false,this.ownedByCompany=e.ownedByCompany,this.themeColors=[],this.id&&this.lastAvatarUpdateDate){let e=config.webservices.protocol+"://"+config.webservices.currentServer+"/api/theme-avatar/"+this.id+"?size=256";e+="&update="+s.MainService.MD5(this.lastAvatarUpdateDate),this.logoSrc=e}}static create(e,t,i,r,n){const s="theme--"+t.toLowerCase().replace(/\s/g,"");return new o({id:e,name:t,cssClassName:s,displayName:i,visibility:r,isRainbowDefaultTheme:n})}static createStaticWebTheme(e,t,i,r,n){return new o({id:this.generateUUID24Char(e),name:e,cssClassName:t,displayName:i,visibility:r,isRainbowDefaultTheme:n})}static generateUUID24Char(e){return s.MainService.MD5(e).slice(0,24)}static duplicateTheme(e){const t=new o(e);return this.duplicateThemeColorsFromTheme(t,e),t}static duplicateThemeColorsFromTheme(e,t){t.themeColors.forEach((t=>{e.themeColors.push(r.ThemeColor.createFromThemeColor(t))}))}static createNewThemeWithConfigurableThemeColors(e,t=false){const i=new o({id:null,name:"",cssClassName:null,displayName:"",visibility:"PRIVATE",isRainbowDefaultTheme:false,isWhiteLabelTheme:t,type:e.type});return e.themeColors.forEach((e=>{e.configurable&&i.themeColors.push(r.ThemeColor.createFromThemeColor(e))})),i}compareTo(e){return this.logoSrc===e.logoSrc&&this.compareToWithoutLogo(e)}compareToWithoutLogo(e){if(this.id!==e.id)return false;if(this.name!==e.name)return false;if(this.avatarShape!==e.avatarShape)return false;if(this.website!==e.website)return false;if(this.cssClassName!==e.cssClassName)return false;if(this.isRainbowDefaultTheme!==e.isRainbowDefaultTheme)return false;if(this.isWhiteLabelTheme!==e.isWhiteLabelTheme)return false;if(this.visibility!==e.visibility)return false;if(this.isColorsAvailable!==e.isColorsAvailable)return false;if(!e.themeColors)return false;if(this.themeColors.length!==e.themeColors.length)return false;let t=true;return this.themeColors.some((i=>{const r=e.getThemeColorOfKey(i.cssVariableName);return r?r.cssValue!==i.cssValue&&(t=false,true):(t=false,true)})),t}getThemeColorOfKey(e){let t=null;return this.themeColors.some((i=>e===i.cssVariableName&&(t=i,true))),t}static createFromData(e){return new o(e)}get logoSrc(){return this._logoSrc}set logoSrc(e){this._logoSrc=e,this.logoSrcSubject.next(this._logoSrc)}get avatarShape(){return this._avatarShape}set avatarShape(e){this._avatarShape=e,this.avatarShapeSubject.next(this._avatarShape)}isPublic(){return"PUBLIC"===this.visibility.toUpperCase()}isPrivate(){return"PRIVATE"===this.visibility.toUpperCase()}isOwnedBy(e){return this.ownedByCompany===e}isWhiteLabel(){return Boolean(this.isWhiteLabelTheme)}isLogoAvailable(){return this.id&&this.lastAvatarUpdateDate}isWhiteType(){return this.type&&"light"===this.type.toLowerCase()}}o.THEME_NAMESPACE="1b671a64-40d5-491e-99b0-da01ff1f3341",t.Theme=o},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(96),n=i(34),s=i(6),o=i(11),a=i(4),c=i(43);class l{constructor(){this.webConferenceServiceV2=r.WebConferenceServiceV2.getInstance(),this.logger=a.LoggerService.getInstance(),this.contactService=s.ContactService.getInstance(),this.eventService=o.EventService.getInstance(),this.webrtcP2PService=n.WebrtcP2PService.getInstance(),this.webrtcConfigAndUtils=c.WebrtcConfigAndUtils.getInstance(),this.subscriptions=[]}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.presenceHelperService||(e.rainbow.presenceHelperService=new l),e.rainbow.presenceHelperService}async start(){this.subscriptions.push(this.eventService.subscribe("CHECK_AND_RESET_BUSY_STATE",(()=>{this.resetBusyStateIfNeeded()}))),this.subscriptions.push(this.eventService.subscribe("RESET_PRESENCE_AFTER_RECONNECT",(()=>{this.resendPresenceAfterReconnect()}))),this.webinarService=window&&window.rainbow&&window.rainbow.webinarService?window.rainbow.webinarService:null}stop(){this.subscriptions.forEach((e=>{e()})),this.subscriptions=[]}resendPresenceAfterReconnect(){setTimeout((()=>{this.logger.debug("[PresenceHelperService] resendPresenceAfterReconnect");this.isUserCurrentlyInCall()?this.contactService.setBusyState("dnd","audio"):this.contactService.sendPresenceFromConfiguration(true)}),100)}resetBusyStateIfNeeded(){setTimeout((()=>{this.logger.debug("[PresenceHelperService] resetBusyStateIfNeeded");this.isUserCurrentlyInCall()||(this.contactService.resetBusyState(),document.getElementById("globalAudioTag")&&document.getElementById("globalAudioTag").srcObject&&!document.getElementById("globalAudioTag").srcObject.active&&this.webrtcConfigAndUtils.RTC.clearMediaStream([document.getElementById("globalAudioTag")]))}),100)}isUserCurrentlyInCall(){const e=this.webrtcP2PService.isUserContactInCall(),t=this.webConferenceServiceV2.hasActiveWebConferenceSession(),i=this.webinarService&&this.webinarService.conference&&this.webinarService.conference.hasActiveWebinarSession();return!!(t||e||i)&&(this.logger.debug(`[PresenceHelperService] user is currently in a call -- ${e} / ${t} / ${i}`),true)}}t.PresenceHelperService=l},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});var r=i(469);t.Decoder=r.default;var n=i(325);t.Encoder=n.default;var s=i(474);t.Reader=s.default;var o=i(80);t.tools=o;var a=i(476).version;t.version=a},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});var r,n=i(80),s=i(324),o=i(80),a=i(326).byEbmlID;!function(e){e[e.STATE_TAG=1]="STATE_TAG",e[e.STATE_SIZE=2]="STATE_SIZE",e[e.STATE_CONTENT=3]="STATE_CONTENT"}(r||(r={}));var c=function(){function e(){this._buffer=new n.Buffer(0),this._tag_stack=[],this._state=r.STATE_TAG,this._cursor=0,this._total=0,this._schema=a,this._result=[]}return e.prototype.decode=function(e){this.readChunk(e);var t=this._result;return this._result=[],t},e.prototype.readChunk=function(e){for(this._buffer=o.concat([this._buffer,new n.Buffer(e)]);this._cursor<this._buffer.length&&(this._state!==r.STATE_TAG||this.readTag())&&(this._state!==r.STATE_SIZE||this.readSize())&&(this._state!==r.STATE_CONTENT||this.readContent()););},e.prototype.getSchemaInfo=function(e){return this._schema[e]||{name:"unknown",level:-1,type:"unknown",description:"unknown"}},e.prototype.readTag=function(){if(this._cursor>=this._buffer.length)return false;var e=n.readVint(this._buffer,this._cursor);if(null==e)return false;var t=this._buffer.slice(this._cursor,this._cursor+e.length).reduce((function(e,t,i,r){return e+t*Math.pow(16,2*(r.length-1-i))}),0),i=this.getSchemaInfo(t),s={EBML_ID:t.toString(16),schema:i,type:i.type,name:i.name,level:i.level,tagStart:this._total,tagEnd:this._total+e.length,sizeStart:this._total+e.length,sizeEnd:null,dataStart:null,dataEnd:null,dataSize:null,data:null};return this._tag_stack.push(s),this._cursor+=e.length,this._total+=e.length,this._state=r.STATE_SIZE,true},e.prototype.readSize=function(){if(this._cursor>=this._buffer.length)return false;var e=n.readVint(this._buffer,this._cursor);if(null==e)return false;var t=this._tag_stack[this._tag_stack.length-1];return t.sizeEnd=t.sizeStart+e.length,t.dataStart=t.sizeEnd,t.dataSize=e.value,-1===e.value?(t.dataEnd=-1,"m"===t.type&&(t.unknownSize=true)):t.dataEnd=t.sizeEnd+e.value,this._cursor+=e.length,this._total+=e.length,this._state=r.STATE_CONTENT,true},e.prototype.readContent=function(){var e=this._tag_stack[this._tag_stack.length-1];if("m"===e.type){if(e.isEnd=false,this._result.push(e),this._state=r.STATE_TAG,0===e.dataSize){var t=Object.assign({},e,{isEnd:true});this._result.push(t),this._tag_stack.pop()}return true}if(this._buffer.length<this._cursor+e.dataSize)return false;var i=this._buffer.slice(this._cursor,this._cursor+e.dataSize);switch(this._buffer=this._buffer.slice(this._cursor+e.dataSize),e.data=i,e.type){case"u":e.value=i.readUIntBE(0,i.length);break;case"i":e.value=i.readIntBE(0,i.length);break;case"f":e.value=4===e.dataSize?i.readFloatBE(0):8===e.dataSize?i.readDoubleBE(0):(console.warn("cannot read "+e.dataSize+" octets float. failback to 0"),0);break;case"s":e.value=i.toString("ascii");break;case"8":e.value=i.toString("utf8");break;case"b":e.value=i;break;case"d":e.value=n.convertEBMLDateToJSDate(new s.Int64BE(i).toNumber())}if(null===e.value)throw new Error("unknown tag type:"+e.type);for(this._result.push(e),this._total+=e.dataSize,this._state=r.STATE_TAG,this._cursor=0,this._tag_stack.pop();this._tag_stack.length>0;){var o=this._tag_stack[this._tag_stack.length-1];if(o.dataEnd<0)return this._tag_stack.pop(),true;if(this._total<o.dataEnd)break;if("m"!==o.type)throw new Error("parent element is not master element");t=Object.assign({},o,{isEnd:true});this._result.push(t),this._tag_stack.pop()}return true},e}();t.default=c},function(e,t,i){(function(t){var i={readVint:function(e,t){t=t||0;for(var i=1;i<=8&&!(e[t]>=Math.pow(2,8-i));i++);if(i>8)throw new Error("Unrepresentable length: "+i+" "+e.toString("hex",t,t+i));if(t+i>e.length)return null;for(var r=e[t]&(1<<8-i)-1,n=1;n<i;n++){if(7===n&&r>=Math.pow(2,45)&&e[t+7]>0)return{length:i,value:-1};r*=Math.pow(2,8),r+=e[t+n]}return{length:i,value:r}},writeVint:function(e){if(e<0||e>Math.pow(2,53))throw new Error("Unrepresentable value: "+e);for(var i=1;i<=8&&!(e<Math.pow(2,7*i)-1);i++);for(var r=new t(i),n=1;n<=i;n++){var s=255&e;r[i-n]=s,e-=s,e/=Math.pow(2,8)}return r[0]=r[0]|1<<8-i,r}};e.exports=i}).call(this,i(97).Buffer)},function(e,t,i){var r=i(472);e.exports=function(e){var t={},i=new r(e);t.trackNumber=i.nextUIntV(),t.timecode=i.nextInt16BE();var n=i.nextUInt8();t.invisible=!!(8&n),t.keyframe=!!(128&n),t.discardable=!!(1&n);var s=(6&n)>>1;return t.frames=function(e,t){if(!t)return[e.nextBuffer()];var i,r,n=[],s=e.nextUInt8()+1;if(2===t){if(e.length%s!=0)throw new Error("Fixed-Size Lacing Error");for(r=e.length/s,i=0;i<s;i++)n.push(e.nextBuffer(r));return n}var o=[];if(1===t)for(i=0;i<s-1;i++){var a;r=0;do{a=e.nextUInt8(),r+=a}while(255===a);o.push(r)}else if(3===t)for(r=e.nextUIntV(),o.push(r),i=1;i<s-1;i++)r+=e.nextIntV(),o.push(r);for(i=0;i<s-1;i++)n.push(e.nextBuffer(o[i]));return n.push(e.nextBuffer()),n}(i,s),t}},function(e,t,i){var r=i(473);function n(e){this.buffer=e,this.offset=0}n.prototype.nextInt16BE=function(){var e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e},n.prototype.nextUInt8=function(){var e=this.buffer.readUInt8(this.offset);return this.offset+=1,e},n.prototype.nextUIntV=function(){var e=r(this.buffer,this.offset);return this.offset+=e.length,e.value},n.prototype.nextIntV=function(){var e=r(this.buffer,this.offset,true);return this.offset+=e.length,e.value},n.prototype.nextBuffer=function(e){var t=e?this.buffer.slice(this.offset,this.offset+e):this.buffer.slice(this.offset);return this.offset+=e||this.length,t},Object.defineProperty(n.prototype,"length",{get:function(){return this.buffer.length-this.offset}}),e.exports=n},function(e,t){e.exports=function(e,t,i){t=t||0;for(var r=1;r<=8&&!(e[t]>=Math.pow(2,8-r));r++);if(r>8)throw new Error("Unrepresentable length: "+r+" "+e.toString("hex",t,t+r));if(t+r>e.length)return null;var n,s=e[t]&(1<<8-r)-1;for(n=1;n<r;n++){if(7===n&&s>=Math.pow(2,45)&&e[t+7]>0)return{length:r,value:-1};s*=Math.pow(2,8),s+=e[t+n]}return i&&(s-=Math.pow(2,7*r-1)-1),{length:r,value:s}}},function(e,t,i){var r,n=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)});Object.defineProperty(t,"__esModule",{value:true});var s=i(475),o=i(80),a=function(e){function t(){var t=e.call(this)||this;return t.logGroup="",t.hasLoggingStarted=false,t.metadataloaded=false,t.chunks=[],t.stack=[],t.segmentOffset=0,t.last2SimpleBlockVideoTrackTimecode=[0,0],t.last2SimpleBlockAudioTrackTimecode=[0,0],t.lastClusterTimecode=0,t.lastClusterPosition=0,t.timecodeScale=1e6,t.metadataSize=0,t.metadatas=[],t.cues=[],t.firstVideoBlockRead=false,t.firstAudioBlockRead=false,t.currentTrack={TrackNumber:-1,TrackType:-1,DefaultDuration:null,CodecDelay:null},t.trackTypes=[],t.trackDefaultDuration=[],t.trackCodecDelay=[],t.trackInfo={type:"nothing"},t.ended=false,t.logging=false,t.use_duration_every_simpleblock=false,t.use_webp=false,t.use_segment_info=true,t.drop_default_duration=true,t}return n(t,e),t.prototype.stop=function(){for(this.ended=true,this.emit_segment_info();this.stack.length;)this.stack.pop(),this.logging&&console.groupEnd();this.logging&&this.hasLoggingStarted&&this.logGroup&&console.groupEnd()},t.prototype.emit_segment_info=function(){var e=this.chunks;if(this.chunks=[],this.metadataloaded){if(!this.use_segment_info)return;var t=this.lastClusterTimecode,i=this.duration,r=this.timecodeScale;this.emit("cluster",{timecode:t,data:e}),this.emit("duration",{timecodeScale:r,duration:i})}else{this.metadataloaded=true,this.metadatas=e;var n=this.trackTypes.indexOf(1),s=this.trackTypes.indexOf(2);if(this.trackInfo=n>=0&&s>=0?{type:"both",trackNumber:n}:n>=0?{type:"video",trackNumber:n}:s>=0?{type:"audio",trackNumber:s}:{type:"nothing"},!this.use_segment_info)return;this.emit("metadata",{data:e,metadataSize:this.metadataSize})}},t.prototype.read=function(e){var t=this,i=false;if(!this.ended){if("m"===e.type)if(e.isEnd)this.stack.pop();else{var r=this.stack[this.stack.length-1];if(null!=r&&r.level>=e.level){this.stack.pop(),this.logging&&console.groupEnd(),r.dataEnd=e.dataEnd,r.dataSize=e.dataEnd-r.dataStart,r.unknownSize=false;var n=Object.assign({},r,{name:r.name,type:r.type,isEnd:true});this.chunks.push(n)}this.stack.push(e)}if("m"===e.type&&"Segment"==e.name)0!=this.segmentOffset&&console.warn("Multiple segments detected!"),this.segmentOffset=e.dataStart,this.emit("segment_offset",this.segmentOffset);else if("b"===e.type&&"SimpleBlock"===e.name){var s=o.ebmlBlock(e.data),a=s.timecode,c=s.trackNumber,l=s.frames;if(1===this.trackTypes[c]){if(!this.firstVideoBlockRead&&(this.firstVideoBlockRead=true,"both"===this.trackInfo.type||"video"===this.trackInfo.type)){var d=this.lastClusterTimecode+a;this.cues.push({CueTrack:c,CueClusterPosition:this.lastClusterPosition,CueTime:d}),this.emit("cue_info",{CueTrack:c,CueClusterPosition:this.lastClusterPosition,CueTime:this.lastClusterTimecode}),this.emit("cue",{CueTrack:c,CueClusterPosition:this.lastClusterPosition,CueTime:d})}this.last2SimpleBlockVideoTrackTimecode=[this.last2SimpleBlockVideoTrackTimecode[1],a]}else if(2===this.trackTypes[c]){if(!this.firstAudioBlockRead&&(this.firstAudioBlockRead=true,"audio"===this.trackInfo.type)){d=this.lastClusterTimecode+a;this.cues.push({CueTrack:c,CueClusterPosition:this.lastClusterPosition,CueTime:d}),this.emit("cue_info",{CueTrack:c,CueClusterPosition:this.lastClusterPosition,CueTime:this.lastClusterTimecode}),this.emit("cue",{CueTrack:c,CueClusterPosition:this.lastClusterPosition,CueTime:d})}this.last2SimpleBlockAudioTrackTimecode=[this.last2SimpleBlockAudioTrackTimecode[1],a]}this.use_duration_every_simpleblock&&this.emit("duration",{timecodeScale:this.timecodeScale,duration:this.duration}),this.use_webp&&l.forEach((function(e){if("9d012a"===e.slice(3,6).toString("hex")){var i=o.VP8BitStreamToRiffWebPBuffer(e),r=new Blob([i],{type:"image/webp"}),n=t.duration;t.emit("webp",{currentTime:n,webp:r})}}))}else"m"===e.type&&"Cluster"===e.name&&false===e.isEnd?(this.firstVideoBlockRead=false,this.firstAudioBlockRead=false,this.emit_segment_info(),this.emit("cluster_ptr",e.tagStart),this.lastClusterPosition=e.tagStart):"u"===e.type&&"Timecode"===e.name?this.lastClusterTimecode=e.value:"u"===e.type&&"TimecodeScale"===e.name?this.timecodeScale=e.value:"m"===e.type&&"TrackEntry"===e.name?e.isEnd?(this.trackTypes[this.currentTrack.TrackNumber]=this.currentTrack.TrackType,this.trackDefaultDuration[this.currentTrack.TrackNumber]=this.currentTrack.DefaultDuration,this.trackCodecDelay[this.currentTrack.TrackNumber]=this.currentTrack.CodecDelay):this.currentTrack={TrackNumber:-1,TrackType:-1,DefaultDuration:null,CodecDelay:null}:"u"===e.type&&"TrackType"===e.name?this.currentTrack.TrackType=e.value:"u"===e.type&&"TrackNumber"===e.name?this.currentTrack.TrackNumber=e.value:"u"===e.type&&"CodecDelay"===e.name?this.currentTrack.CodecDelay=e.value:"u"===e.type&&"DefaultDuration"===e.name?this.drop_default_duration?(console.warn("DefaultDuration detected!, remove it"),i=true):this.currentTrack.DefaultDuration=e.value:"unknown"===e.name&&console.warn(e);!this.metadataloaded&&e.dataEnd>0&&(this.metadataSize=e.dataEnd),i||this.chunks.push(e),this.logging&&this.put(e)}},Object.defineProperty(t.prototype,"duration",{get:function(){if("nothing"===this.trackInfo.type)return console.warn("no video, no audio track"),0;var e=0,t=0,i=0,r=this.trackDefaultDuration[this.trackInfo.trackNumber];if("number"==typeof r)e=r;else if("both"===this.trackInfo.type)this.last2SimpleBlockAudioTrackTimecode[1]>this.last2SimpleBlockVideoTrackTimecode[1]?(e=(this.last2SimpleBlockAudioTrackTimecode[1]-this.last2SimpleBlockAudioTrackTimecode[0])*this.timecodeScale,"number"==typeof(n=this.trackCodecDelay[this.trackTypes.indexOf(2)])&&(t=n),i=this.last2SimpleBlockAudioTrackTimecode[1]):(e=(this.last2SimpleBlockVideoTrackTimecode[1]-this.last2SimpleBlockVideoTrackTimecode[0])*this.timecodeScale,"number"==typeof(n=this.trackCodecDelay[this.trackTypes.indexOf(1)])&&(t=n),i=this.last2SimpleBlockVideoTrackTimecode[1]);else if("video"===this.trackInfo.type){e=(this.last2SimpleBlockVideoTrackTimecode[1]-this.last2SimpleBlockVideoTrackTimecode[0])*this.timecodeScale,"number"==typeof(n=this.trackCodecDelay[this.trackInfo.trackNumber])&&(t=n),i=this.last2SimpleBlockVideoTrackTimecode[1]}else if("audio"===this.trackInfo.type){var n;e=(this.last2SimpleBlockAudioTrackTimecode[1]-this.last2SimpleBlockAudioTrackTimecode[0])*this.timecodeScale,"number"==typeof(n=this.trackCodecDelay[this.trackInfo.trackNumber])&&(t=n),i=this.last2SimpleBlockAudioTrackTimecode[1]}var s=((this.lastClusterTimecode+i)*this.timecodeScale+e-t)/this.timecodeScale;return Math.floor(s)},enumerable:true,configurable:true}),t.prototype.addListener=function(t,i){return e.prototype.addListener.call(this,t,i)},t.prototype.put=function(e){this.hasLoggingStarted||(this.hasLoggingStarted=true,this.logging&&this.logGroup&&console.groupCollapsed(this.logGroup)),"m"===e.type?e.isEnd?console.groupEnd():console.group(e.name+":"+e.tagStart):"b"===e.type?console.log(e.name,e.type):console.log(e.name,e.tagStart,e.type,e.value)},t}(s.EventEmitter);t.default=a},function(e,t,i){var r,n="object"==typeof Reflect?Reflect:null,s=n&&"function"==typeof n.apply?n.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};r=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(i,r){function n(){void 0!==s&&e.removeListener("error",s),i([].slice.call(arguments))}var s;"error"!==t&&(s=function(i){e.removeListener(t,n),r(i)},e.once("error",s)),e.once(t,n)}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function l(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function d(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function u(e,t,i,r){var n,s,o,a;if(l(i),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),s=e._events),o=s[t]),void 0===o)o=s[t]=i,++e._eventsCount;else if("function"==typeof o?o=s[t]=r?[i,o]:[o,i]:r?o.unshift(i):o.push(i),(n=d(e))>0&&o.length>n&&!o.warned){o.warned=true;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,a=c,console&&console.warn&&console.warn(a)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=true,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,i){var r={fired:false,wrapFn:void 0,target:e,type:t,listener:i},n=h.bind(r);return n.listener=i,r.wrapFn=n,n}function p(e,t,i){var r=e._events;if(void 0===r)return[];var n=r[t];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(n):m(n,n.length)}function g(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function m(e,t){for(var i=new Array(t),r=0;r<t;++r)i[r]=e[r];return i}Object.defineProperty(a,"defaultMaxListeners",{enumerable:true,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return d(this)},a.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,n=this._events;if(void 0!==n)r=r&&void 0===n.error;else if(!r)return false;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=n[e];if(void 0===c)return false;if("function"==typeof c)s(c,this,t);else{var l=c.length,d=m(c,l);for(i=0;i<l;++i)s(d[i],this,t)}return true},a.prototype.addListener=function(e,t){return u(this,e,t,false)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return u(this,e,t,true)},a.prototype.once=function(e,t){return l(t),this.on(e,f(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,f(this,e,t)),this},a.prototype.removeListener=function(e,t){var i,r,n,s,o;if(l(t),void 0===(r=this._events))return this;if(void 0===(i=r[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,s=i.length-1;s>=0;s--)if(i[s]===t||i[s].listener===t){o=i[s].listener,n=s;break}if(n<0)return this;0===n?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,n),1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var n,s=Object.keys(i);for(r=0;r<s.length;++r)"removeListener"!==(n=s[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return p(this,e,true)},a.prototype.rawListeners=function(e){return p(this,e,false)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},a.prototype.listenerCount=g,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e){e.exports=JSON.parse(`{"_args":[["ts-ebml@2.0.2","C:\\\\Git\\\\Rainbow"]],"_from":"ts-ebml@2.0.2","_id":"ts-ebml@2.0.2","_inBundle":false,"_integrity":"sha512-V/HdlCn3FITQrFHQlVE02XtfMiRLab2QB/YOCfkbJWqiFYG/j5v7gHKV+wem6g0PD6/uxXs5oxMQfDXILmts/Q==","_location":"/ts-ebml","_phantomChildren":{},"_requested":{"type":"version","registry":true,"raw":"ts-ebml@2.0.2","name":"ts-ebml","escapedName":"ts-ebml","rawSpec":"2.0.2","saveSpec":null,"fetchSpec":"2.0.2"},"_requiredBy":["/"],"_resolved":"https://registry.npmjs.org/ts-ebml/-/ts-ebml-2.0.2.tgz","_spec":"2.0.2","_where":"C:\\\\Git\\\\Rainbow","author":{"name":"legokichi duckscallion"},"bin":{"ts-ebml":"lib/cli.js"},"bugs":{"url":"https://github.com/legokichi/ts-ebml/issues"},"dependencies":{"buffer":"^5.0.7","commander":"^2.11.0","ebml":"^2.2.1","ebml-block":"^1.1.0","events":"^1.1.1","int64-buffer":"^0.1.9","matroska":"^2.2.3"},"description":"ebml decoder and encoder","devDependencies":{"@types/commander":"^2.9.1","@types/qunit":"^2.0.31","browserify":"^13.1.0","empower":"^1.2.3","espower-cli":"^1.1.0","power-assert":"^1.4.4","power-assert-formatter":"^1.4.1","qunit-tap":"^1.5.1","qunitjs":"^2.4.0","tslint":"^3.15.1","typedoc":"^0.5.3","typescript":"^2.4.2","watchify":"^3.7.0"},"homepage":"https://github.com/legokichi/ts-ebml#readme","keywords":["ebml","webm","mkv","matrosika","webp"],"license":"MIT","main":"./lib/index.js","name":"ts-ebml","repository":{"type":"git","url":"git+https://github.com/legokichi/ts-ebml.git"},"scripts":{"browserify":"browserify lib/index.js --standalone EBML -o dist/EBML.js","build":"npm run clean   && tsc    -p .; npm run browserify","check":"tsc -w --noEmit -p ./","clean":"rm -rf lib/* dist/* test/*.js; mkdir -p dist","doc":"typedoc --mode modules --out doc --disableOutputCheck","example":"tsc; browserify lib/example_seekable.js -o test/example_seekable.js","examples":"tsc; for file in \`find lib -name 'example_*.js' -type f -printf '%f\\\\n'\`; do browserify lib/$file -o test/$file; done","examples_bsd":"tsc; for file in \`find lib -name 'example_*.js' -type f -print\`; do browserify lib/$(basename $file) -o test/$(basename $file); done","init":"npm run update; npm run mkdir; npm run build","lint":"tslint -c ./tslint.json --project ./tsconfig.json --type-check","mkdir":"mkdir lib dist 2>/dev/null","reset":"rm -rf node_modules","setup":"npm install -g http-server;","start":"http-server . -s & tsc -w -p .& watchify lib/example_seekable.js -o test/example_seekable.js","stop":"killall -- node */tsc -w -p","test":"tsc; espower lib/test.js > lib/test.tmp; mv -f lib/test.tmp lib/test.js; browserify lib/test.js -o test/test.js","update":"npm run reset; npm update","watchify":"watchify lib/index.js --standalone EBML -o dist/EBMl.js -v"},"typings":"./lib/index.d.ts","version":"2.0.2"}`)},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(19),n=i(6),s=i(14),o=i(30),a=i(56),c=i(11),l=i(4),d=i(13);var u;!function(e){e.NOTIFICATIONTYPE_STANDARD="std",e.NOTIFICATIONTYPE_LOW="low",e.NOTIFICATIONTYPE_MIDDLE="middle",e.NOTIFICATIONTYPE_HIGH="high"}(u=t.NotificationType||(t.NotificationType={}));class h{constructor(){this.settingsService=r.SettingsService.getInstance(),this.contactService=n.ContactService.getInstance(),this.profileService=s.ProfileService.getInstance(),this.roomService=o.RoomService.getInstance(),this.deviceManagementService=a.DeviceManagementService.getInstance(),this.eventService=c.EventService.getInstance(),this.logger=l.LoggerService.getInstance(),this.errorHelperService=d.ErrorHelperService.getInstance(),this.notifs=["noSound","ding","harp","hello","complete","duck","appointed","chime","stairs","wet","wilhelm","important"],this.alarms=["noRingtone","lightBounce","discovery","lounge","uptown","morningLights","miami","farEast","highSpeed","rainDrops","deepSpace","steamTrain","happy","decrescendo","strident","peacefulness","classic1","classic2","classic3","cosy1","cosy2","cosy3","dynamic1","dynamic2","dynamic3","quiet1","quiet2","quiet3","relax1","relax2","relax3"],this.emergencyAlarms=["noSound","pager1"],this.audioFileType="",this.recordTone=null,this.joinWebConfTone=null,this.alarmNotifOnce=null,this.audioNotifOnce=null,this.pingAudio=null,this.pingAudioSecondary=null,this.pushToTalkActivateTone=null,this.pushToTalkDeactivateTone=null,this.informationImSoundAudio=null,this.informationImSoundAudioSecondary=null,this.importantImSoundAudio=null,this.importantImSoundAudioSecondary=null,this.emergencyImSoundAudio=null,this.emergencyImSoundAudioSecondary=null,this.incomingRingingTone={},this.incomingRingingSecondaryTone={},this.ringbackTone={},this.secondCallTone={},this.holdTone={},this.informationImSound="",this.importantImSound="",this.emergencyImSound="",this.activeNotif="",this.activeAlarm="",this.stopWebrtcSounds=false,this.subscriptions=[],this.listeners=[]}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.ringingService||(e.rainbow.ringingService=new h),e.rainbow.ringingService}async start(){try{this.logger.info("[ringingService] === STARTING ==="),this.setAudioCapability(),this.ringbackTone={audio:new Audio,starting:false,id:"ringbackTone"},this.recordTone=new Audio("/assets/sounds/beep-01a"+this.audioFileType),this.secondCallTone={audio:new Audio("/assets/sounds/beep-beep"+this.audioFileType),starting:false,id:"secondCallTone"},this.joinWebConfTone=new Audio("/assets/sounds/join_meeting"+this.audioFileType),this.holdTone={audio:new Audio("/assets/sounds/new-hold"+this.audioFileType),starting:false},this.pushToTalkActivateTone=new Audio("/assets/sounds/ptt_activate"+this.audioFileType),this.pushToTalkDeactivateTone=new Audio("/assets/sounds/ptt_deactivate"+this.audioFileType),this.ringbackTone.audio.onloadeddata=()=>{this.logger.info("[ringingService] === ringbackTone -- loaded")},this.ringbackTone.audio.oncanplay=()=>{this.logger.info("[ringingService] === ringbackTone -- oncanplay ")},this.ringbackTone.audio.onerror=()=>{this.logger.error("[ringingService] === ringbackTone -- onerror ")},this.ringbackTone.audio.src="/assets/sounds/outgoing-rings"+this.audioFileType,this.ringbackTone.audio.currentTime=0,this.ringbackTone.audio.loop=true,this.ringbackTone.audio.load(),this.holdTone.audio.loop=true,this.secondCallTone.audio.loop=true,this.alarmNotifOnce=null,this.informationImSound=this.contactService.userContact.customData.informationImSound,this.informationImSound||(this.informationImSound=this.settingsService.getSetting("informationImSound")),this.importantImSound=this.contactService.userContact.customData.importantImSound,this.importantImSound||(this.importantImSound=this.settingsService.getSetting("importantImSound")),this.manageEmergencyNotifs();const e=this.settingsService.getSetting("activeNotif"),t=this.settingsService.getSetting("activeAlarm");this.setActive(e,t,this.informationImSound,this.importantImSound),this.addListeners(),this.logger.info("[ringingService] === STARTED ===")}catch(e){this.logger.error("[ringingService] === STARTING FAILURE === "+e.message)}}async stop(){this.logger.info("[ringingService] === STOPPING ==="),this.listeners.forEach((e=>{e()})),this.listeners=[],this.subscriptions.forEach((e=>{e.unsubscribe()})),this.ringbackTone&&(this.ringbackTone.starting=false,this.ringbackTone.audio=null),this.incomingRingingTone&&(this.incomingRingingTone.starting=false,this.incomingRingingTone.audio=null),this.incomingRingingSecondaryTone&&(this.incomingRingingSecondaryTone.starting=false,this.incomingRingingSecondaryTone.audio=null),this.secondCallTone&&(this.secondCallTone.starting=false,this.secondCallTone.audio=null),this.holdTone&&(this.holdTone.starting=false,this.holdTone.audio=null),this.recordTone=null,this.joinWebConfTone=null,this.alarmNotifOnce=null,this.audioNotifOnce=null,this.pingAudio=null,this.pingAudioSecondary=null,this.pushToTalkActivateTone=null,this.pushToTalkDeactivateTone=null,this.informationImSoundAudio=null,this.informationImSoundAudioSecondary=null,this.importantImSoundAudio=null,this.importantImSoundAudioSecondary=null,this.emergencyImSoundAudio=null,this.emergencyImSoundAudioSecondary=null,this.incomingRingingTone={},this.incomingRingingSecondaryTone={},this.ringbackTone={},this.secondCallTone={},this.holdTone={},this.informationImSound="",this.importantImSound="",this.emergencyImSound="",this.activeNotif="",this.activeAlarm="",this.logger.info("[ringingService] === STOPPED ===")}addListeners(){this.listeners.push(this.eventService.subscribe("ON_WEB_CONFENRECE_PARTICIPANT_JOINED_EVENT",this.playWebConferenceJoinNotif.bind(this))),this.listeners.push(this.eventService.subscribe("ON_PRESS_PUSH_TO_TALK_EVENT",this.playActivatePtT.bind(this))),this.listeners.push(this.eventService.subscribe("ON_RELEASE_PUSH_TO_TALK_EVENT",this.playDeactivatePtT.bind(this))),this.subscriptions.push(this.profileService.subscribe((()=>{this.manageEmergencyNotifs()}))),this.subscriptions.push(this.deviceManagementService.subscribe((e=>{try{e.name===this.deviceManagementService.RAINBOW_ONNEWAUDIOVIDEODEVICESELECTED&&"audiooutput"===e.data.kind?this.onAudioOutputDeviceChange():e.name===this.deviceManagementService.RAINBOW_ONNEWSECONDARYOUTPUTDEVICESELECTED&&this.onSecondaryAudioOutputDeviceChange()}catch{}})))}async onAudioOutputDeviceChange(){if(this.incomingRingingTone&&this.incomingRingingTone.audio&&!this.incomingRingingTone.audio.paused)try{await this.deviceManagementService.setSetSinkIdForAudioElement(this.incomingRingingTone.audio,this.deviceManagementService.getCurrentAudioOutputDevice()),this.incomingRingingTone.audio.pause(),this.incomingRingingTone.audio.currentTime=0,this.logger.info("[ringingService] startIncomingRinging main device -- play"),this.play(this.incomingRingingTone)}catch(e){}}async onSecondaryAudioOutputDeviceChange(){if("true"===this.settingsService.getSetting("hasSecondRinger")&&this.incomingRingingSecondaryTone&&this.incomingRingingSecondaryTone.audio&&!this.incomingRingingSecondaryTone.audio.paused)try{await this.deviceManagementService.setSetSinkIdForAudioElement(this.incomingRingingSecondaryTone.audio,this.deviceManagementService.getCurrentSecondaryOutputDevice()),this.incomingRingingSecondaryTone.audio.pause(),this.incomingRingingSecondaryTone.audio.currentTime=0,this.logger.info("[ringingService] startIncomingRinging secondary device -- play"),this.play(this.incomingRingingSecondaryTone)}catch(e){}}setAudioCapability(){let e=new Audio;const t=Boolean(e.canPlayType)&&Boolean(e.canPlayType('audio/ogg; codecs="vorbis"'));this.audioFileType=t?".ogg":".mp3",e=null}manageEmergencyNotifs(){this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.ALERT_NOTIFICATIONS_ALLOWED)&&(this.logger.debug("[ringingService] manageEmergencyNotifs -- Emergency alarms set to default"),this.emergencyAlarms=["noSound","emergency"]),this.emergencyImSound=this.contactService.userContact.customData.emergencyImSound,this.emergencyImSound||(this.emergencyImSound=this.settingsService.getSetting("emergencyImSound"),this.logger.debug("[ringingService] manageEmergencyNotifs -- Emergency notif sound set to "+this.emergencyImSound)),this.setEmergencyAlarm()}setEmergencyAlarm(){let e=false;(!this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.ALERT_NOTIFICATIONS_ALLOWED)||"noSound"!==this.emergencyImSound&&-1!==this.emergencyAlarms.indexOf(this.emergencyImSound))&&(this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.ALERT_NOTIFICATIONS_ALLOWED)||-1!==this.emergencyAlarms.indexOf(this.emergencyImSound))||(e=true),e&&(this.emergencyImSound=this.emergencyAlarms[1],this.contactService.userContact.customData.emergencyImSound=this.emergencyImSound,this.contactService.updateUserContact({customData:this.contactService.userContact.customData})),"noSound"!==this.emergencyImSound?(this.emergencyImSoundAudio=new Audio("/assets/sounds/notifs/"+this.emergencyImSound+this.audioFileType),this.emergencyImSoundAudioSecondary=new Audio("/assets/sounds/notifs/"+this.emergencyImSound+this.audioFileType),this.logger.debug("[ringingService] setEmergencyAlarm -- Emergency notif sound set to "+this.emergencyImSound)):(this.emergencyImSoundAudio=null,this.emergencyImSoundAudioSecondary=null,this.logger.info("[ringingService] Emergency notif sound set to null"))}setActive(e,t,i,r){this.logger.info(`[ringingService] setActive wih notif=${e}, alarm=${t}, informationImSound=${i}, importantImSound=${r}`),this.activeNotif=e,this.activeAlarm=t,"noSound"!==e?(this.pingAudio=new Audio("/assets/sounds/notifs/"+this.activeNotif+this.audioFileType),this.pingAudioSecondary=new Audio("/assets/sounds/notifs/"+this.activeNotif+this.audioFileType)):(this.pingAudio=null,this.pingAudioSecondary=null,this.logger.info("[ringingService] setActive -- Notif sound set to null")),"noRingtone"!==t?(this.incomingRingingTone={audio:new Audio,starting:false,id:"incomingRingingTone"},this.incomingRingingSecondaryTone={audio:new Audio,starting:false,id:"incomingRingingSecondaryTone"},this.incomingRingingTone.audio.onloadeddata=()=>{this.logger.info("[ringingService] === incomingRingingTone -- loaded")},this.incomingRingingTone.audio.oncanplay=()=>{this.logger.info("[ringingService] === incomingRingingTone -- oncanplay ")},this.incomingRingingTone.audio.onerror=()=>{this.logger.error("[ringingService] === incomingRingingTone -- onerror "),this.incomingRingingTone.audio.error&&this.logger.error("[ringingService] === incomingRingingTone -- onerror msg = "+this.incomingRingingTone.audio.error.message)},this.incomingRingingSecondaryTone.audio.onloadeddata=()=>{this.logger.info("[ringingService] === incomingRingingSecondaryTone -- loaded")},this.incomingRingingSecondaryTone.audio.oncanplay=()=>{this.logger.info("[ringingService] === incomingRingingSecondaryTone -- oncanplay ")},this.incomingRingingSecondaryTone.audio.onerror=()=>{this.logger.error("[ringingService] === incomingRingingSecondaryTone -- onerror "),this.incomingRingingSecondaryTone.audio.error&&this.logger.error("[ringingService] === incomingRingingSecondaryTone -- onerror msg = "+this.incomingRingingSecondaryTone.audio.error.message)},this.incomingRingingTone.audio.src="/assets/sounds/alarms/"+this.activeAlarm+this.audioFileType,this.incomingRingingSecondaryTone.audio.src="/assets/sounds/alarms/"+this.activeAlarm+this.audioFileType,this.incomingRingingTone.audio.currentTime=0,this.incomingRingingTone.audio.loop=true,this.incomingRingingTone.audio.load(),this.incomingRingingSecondaryTone.audio.currentTime=0,this.incomingRingingSecondaryTone.audio.loop=true,this.incomingRingingSecondaryTone.audio.load()):(this.incomingRingingTone=null,this.incomingRingingSecondaryTone=null,this.logger.info("[ringingService] setActive -- Ringtone sound set to null")),"noSound"!==i?(this.informationImSoundAudio=new Audio("/assets/sounds/notifs/"+i+this.audioFileType),this.informationImSoundAudioSecondary=new Audio("/assets/sounds/notifs/"+i+this.audioFileType),this.logger.debug("[ringingService] setActive -- Information notif sound set to "+i)):(this.informationImSoundAudio=null,this.informationImSoundAudioSecondary=null,this.logger.info("[ringingService] setActive -- Information notif sound set to null")),"noSound"!==r?(this.importantImSoundAudio=new Audio("/assets/sounds/notifs/"+r+this.audioFileType),this.importantImSoundAudioSecondary=new Audio("/assets/sounds/notifs/"+r+this.audioFileType),this.logger.debug("[ringingService] setActive -- Important notif sound set to "+r)):(this.importantImSoundAudio=null,this.importantImSoundAudioSecondary=null,this.logger.info("[ringingService] setActive -- Important notif sound set to null"))}shouldPlayImNotif(){let e=true;return"busy"!==this.contactService.userContact.status&&"dnd"!==this.contactService.userContact.status||(e=false),this.logger.debug("[ringingService] shouldPlayImNotif -- result = "+e),e}play(e,t=0){if(this.logger.debug(`[ringingService] play -- id = ${e.id} - count = ${t}`),!e||!e.audio)return void this.logger.warn("[ringingService] play tone is missing -- return");if(e.stopDefered)return this.logger.warn(`[ringingService] play tone for id ${e.id} aborted because stop request is pending`),void(e.starting=false);if(4!==e.audio.readyState){if(t<6)return this.logger.warn(`[ringingService] play tone for id ${e.id} is not ready -- retry in 500 ms`),void setTimeout((()=>{t+=1,this.play(e,t)}),500);if("incomingRingingTone"===e.id){this.logger.warn(`[ringingService] play tone for id ${e.id} does not load .. try another type`);const t=".ogg"===this.audioFileType?".mp3":".ogg";return this.incomingRingingTone={audio:new Audio("/assets/sounds/alarms/"+this.activeAlarm+t),starting:true,id:"incomingRingingTone"},this.incomingRingingTone.audio.loop=true,void this.play(this.incomingRingingTone)}if("incomingRingingSecondaryTone"===e.id){this.logger.warn(`[ringingService] play tone for id ${e.id} does not load .. try another type`);const t=".ogg"===this.audioFileType?".mp3":".ogg";return this.incomingRingingSecondaryTone={audio:new Audio("/assets/sounds/alarms/"+this.activeAlarm+t),starting:true,id:"incomingRingingSecondaryTone"},this.incomingRingingSecondaryTone.audio.loop=true,void this.play(this.incomingRingingSecondaryTone)}this.logger.warn(`[ringingService] play tone for id ${e.id} is not ready -- try to play it anyway`)}const i=e.audio.play();i&&"function"==typeof i.finally?i.then((()=>{this.logger.info(`[ringingService] play for id ${e.id} ok`)})).catch((t=>{this.logger.error(`[ringingService] play for id ${e.id} error: ${t}`)})).finally((()=>{e.starting=false})):(this.logger.info(`[ringingService] (no promise) play for id ${e.id} ok`),e.starting=false)}addEvents(e,t){e.onended=()=>{this.alarmNotifOnce=null,t.iconPlayer="play"}}async playActivatePtT(){if(this.pushToTalkActivateTone&&this.contactService.userContact.customData.enablePushToTalkTone){this.pushToTalkActivateTone.currentTime=0;try{await this.deviceManagementService.setSetSinkIdForAudioElement(this.pushToTalkActivateTone,this.deviceManagementService.getCurrentAudioOutputDevice()),this.logger.debug("[ringingService] playActivatePtT -- play"),this.pushToTalkActivateTone.play()}catch(e){}}}async playDeactivatePtT(){if(this.logger.info("[ringingService] playDeactivatePtT"),this.pushToTalkDeactivateTone&&this.contactService.userContact.customData.enablePushToTalkTone){this.pushToTalkDeactivateTone.currentTime=0;try{await this.deviceManagementService.setSetSinkIdForAudioElement(this.pushToTalkDeactivateTone,this.deviceManagementService.getCurrentAudioOutputDevice()),this.logger.debug("[ringingService] playDeactivatePtT -- play"),this.pushToTalkDeactivateTone.play()}catch(e){}}}stopRingBackToneDefered(e){this.logger.debug("[ringingService] stopRingBackToneDefered -- count = "+e),this.ringbackTone.stopDefered=void 0,(e+=1)>=3?this.ringbackTone.audio&&(this.logger.info("[ringingService] stopRingBackToneDefered: tone is blocked on starting, stop it"),this.ringbackTone.audio.pause(),this.ringbackTone.audio.currentTime=0,this.ringbackTone.audio.src="",this.ringbackTone.audio.src="/assets/sounds/outgoing-rings"+this.audioFileType,this.ringbackTone.audio.load()):this.stopRingBackTone(e)}stopIncomingRingingDefered(e){this.logger.debug("[ringingService] stopIncomingRingingDefered -- count = "+e),this.incomingRingingTone.stopDefered=void 0,(e+=1)>=30?this.incomingRingingTone.audio&&(this.logger.info("[ringingService] stopIncomingRingingDefered: tone is blocked on starting, stop it"),this.incomingRingingTone.audio.pause(),this.incomingRingingTone.audio.src="",this.incomingRingingTone.audio.src="/assets/sounds/alarms/"+this.activeAlarm+this.audioFileType,this.incomingRingingTone.audio.currentTime=0,this.incomingRingingTone.audio.loop=true,this.incomingRingingTone.audio.load()):this.stopIncomingRinging(e)}stopIncomingRingingSecondaryDefered(e){this.logger.debug("[ringingService] stopIncomingRingingSecondaryDefered -- count = "+e),this.incomingRingingSecondaryTone.stopDefered=void 0,(e+=1)>=30?this.incomingRingingSecondaryTone.audio&&(this.logger.info("[ringingService] stopIncomingRingingSecondaryDefered: tone is blocked on starting, stop it"),this.incomingRingingSecondaryTone.audio.pause(),this.incomingRingingSecondaryTone.audio.src="",this.incomingRingingSecondaryTone.audio.src="/assets/sounds/alarms/"+this.activeAlarm+this.audioFileType,this.incomingRingingSecondaryTone.audio.currentTime=0,this.incomingRingingSecondaryTone.audio.loop=true,this.incomingRingingSecondaryTone.audio.load()):this.stopIncomingRinging(e)}stopSecondToneDefered(){this.logger.debug("[ringingService] stopSecondToneDefered"),this.secondCallTone.stopDefered=void 0,this.stopSecondCallTone()}stopHoldToneDefered(){this.logger.debug("[ringingService] stopHoldToneDefered"),this.holdTone.stopDefered=void 0,this.stopHoldTone()}getAudioFileType(){return this.audioFileType}async playWebConferenceJoinNotif(e,t){let i=null;if(t&&(i=this.roomService.getRoomById(t.id),i||(i=this.roomService.getRoomById(t.roomId))),this.joinWebConfTone&&i&&i.getPlayEntryTone()){this.logger.info("[ringingService] playWebConferenceJoinNotif"),this.joinWebConfTone.currentTime=0;try{await this.deviceManagementService.setSetSinkIdForAudioElement(this.joinWebConfTone,this.deviceManagementService.getCurrentAudioOutputDevice()),this.joinWebConfTone.play()}catch(r){}}}setActiveAlarm(e){this.logger.info("[ringingService] setActiveAlarm to "+e),this.activeAlarm=e,this.contactService.setUserSettings({activeAlarm:this.activeAlarm}),"noRingtone"!==e?(this.incomingRingingTone={audio:new Audio,starting:false,id:"incomingRingingTone"},this.incomingRingingSecondaryTone={audio:new Audio("/assets/sounds/alarms/"+this.activeAlarm+this.audioFileType),starting:false,id:"incomingRingingSecondaryTone"},this.incomingRingingTone.audio.onloadeddata=()=>{this.logger.info("[ringingService] === incomingRingingTone -- loaded")},this.incomingRingingTone.audio.oncanplay=()=>{this.logger.info("[ringingService] === incomingRingingTone -- oncanplay ")},this.incomingRingingTone.audio.onerror=()=>{this.logger.error("[ringingService] === incomingRingingTone -- onerror "),this.incomingRingingTone.audio.error&&this.logger.error("[ringingService] === incomingRingingTone -- onerror msg = "+this.incomingRingingTone.audio.error.message)},this.incomingRingingTone.audio.src="/assets/sounds/alarms/"+this.activeAlarm+this.audioFileType,this.incomingRingingTone.audio.currentTime=0,this.incomingRingingTone.audio.loop=true,this.incomingRingingTone.audio.load()):(this.incomingRingingTone=null,this.incomingRingingSecondaryTone=null,this.logger.info("[ringingService] setActiveAlarm -- Ringtone sound set to null"))}playAlarmOnce(e){this.logger.info("[ringingService] playAlarmOnce "+e.name),null!==this.alarmNotifOnce&&this.alarmNotifOnce.pause(),this.alarmNotifOnce=new Audio("/assets/sounds/alarms/"+e.name+this.audioFileType),this.alarmNotifOnce.currentTime=0,this.alarmNotifOnce.play(),this.addEvents(this.alarmNotifOnce,e)}stopAlarmOnce(){this.logger.info("[ringingService] stopAlarmOnce"),this.alarmNotifOnce&&(this.alarmNotifOnce.pause(),this.alarmNotifOnce=null)}alarmCurPlay(){return this.alarmNotifOnce instanceof Audio}setActiveNotif(e){this.logger.info("[ringingService] setActiveNotif to "+e),this.activeNotif=e,this.contactService.setUserSettings({activeNotif:this.activeNotif}),"noSound"!==e?(this.pingAudio=new Audio("/assets/sounds/notifs/"+this.activeNotif+this.audioFileType),this.pingAudioSecondary=new Audio("/assets/sounds/notifs/"+this.activeNotif+this.audioFileType)):(this.pingAudio=null,this.pingAudioSecondary=null,this.logger.info("Notif sound set to null"))}playNotifOnce(e){this.logger.info("[ringingService] playNotifOnce "+e.name),this.audioNotifOnce=new Audio("/assets/sounds/notifs/"+e.name+this.audioFileType),this.audioNotifOnce.currentTime=0,this.audioNotifOnce.play(),this.addEvents(this.audioNotifOnce,e)}stopNotifOnce(){this.logger.info("[ringingService] stopNotifOnce"),this.audioNotifOnce.pause(),this.audioNotifOnce=null}notifCurPlay(){return this.audioNotifOnce instanceof Audio}setInformationImSound(e){this.logger.info("[ringingService] setInformationImSound to "+e),this.informationImSound=e,this.settingsService.setSetting("informationImSound",e),this.contactService.userContact.customData.informationImSound=e,this.contactService.updateUserContact({customData:this.contactService.userContact.customData}),"noSound"!==e?(this.informationImSoundAudio=new Audio("/assets/sounds/notifs/"+this.informationImSound+this.audioFileType),this.informationImSoundAudioSecondary=new Audio("/assets/sounds/notifs/"+this.informationImSound+this.audioFileType)):(this.informationImSoundAudio=null,this.informationImSoundAudioSecondary=null)}setImportantImSound(e){this.logger.info("[ringingService] setImportantImSound to "+e),this.importantImSound=e,this.settingsService.setSetting("importantImSound",e),this.contactService.userContact.customData.importantImSound=e,this.contactService.updateUserContact({customData:this.contactService.userContact.customData}),"noSound"!==e?(this.importantImSoundAudio=new Audio("/assets/sounds/notifs/"+this.importantImSound+this.audioFileType),this.importantImSoundAudioSecondary=new Audio("/assets/sounds/notifs/"+this.importantImSound+this.audioFileType)):(this.importantImSoundAudio=null,this.importantImSoundAudioSecondary=null)}setEmergencyImSound(e){this.logger.info("[ringingService] setEmergencyImSound to "+e),this.emergencyImSound=e,this.settingsService.setSetting("emergencyImSound",e),this.contactService.userContact.customData.emergencyImSound=e,this.contactService.updateUserContact({customData:this.contactService.userContact.customData}),"noSound"!==e?(this.emergencyImSoundAudio=new Audio("/assets/sounds/notifs/"+this.emergencyImSound+this.audioFileType),this.emergencyImSoundAudioSecondary=new Audio("/assets/sounds/notifs/"+this.emergencyImSound+this.audioFileType)):(this.emergencyImSoundAudio=null,this.emergencyImSoundAudioSecondary=null)}stopUrgencyNotif(){this.logger.info("[ringingService] stopUrgencyNotif"),this.emergencyImSoundAudio&&(this.emergencyImSoundAudio.pause(),this.emergencyImSoundAudio=null),this.emergencyImSoundAudioSecondary&&(this.emergencyImSoundAudioSecondary.pause(),this.emergencyImSoundAudioSecondary=null)}async playCustomNotif(e){if(this.logger.info("[ringingService] playCustomNotif -- typeNotif = "+e),this.stopWebrtcSounds)return void this.logger.info("[ringingService] playCustomNotif -- playImNotif is blocked...");let t,i;if(e===u.NOTIFICATIONTYPE_STANDARD||e===u.NOTIFICATIONTYPE_HIGH&&!this.contactService.userContact.alertNotificationEnabledForMyCompany)this.playImNotif();else if(e!==u.NOTIFICATIONTYPE_LOW&&e!==u.NOTIFICATIONTYPE_MIDDLE||this.shouldPlayImNotif()){switch(e){case u.NOTIFICATIONTYPE_LOW:t=this.informationImSoundAudio,i=this.informationImSoundAudioSecondary;break;case u.NOTIFICATIONTYPE_MIDDLE:t=this.importantImSoundAudio,i=this.importantImSoundAudioSecondary;break;case u.NOTIFICATIONTYPE_HIGH:this.emergencyImSoundAudio&&this.emergencyImSoundAudio.pause(),this.emergencyImSoundAudio=new Audio("/assets/sounds/notifs/"+this.emergencyImSound+this.audioFileType),this.emergencyImSoundAudio.currentTime=0,this.profileService.isFeatureEnabled(this.profileService.FeaturesEnum.ALERT_NOTIFICATIONS_ALLOWED)&&(this.emergencyImSoundAudio.loop=true),t=this.emergencyImSoundAudio,i=this.emergencyImSoundAudioSecondary;break;default:return void this.playImNotif()}if("true"===this.settingsService.getSetting("hasSecondRinger"))try{await this.deviceManagementService.setSetSinkIdForAudioElement(i,this.deviceManagementService.getCurrentSecondaryOutputDevice()),i.play()}catch(r){}try{await this.deviceManagementService.setSetSinkIdForAudioElement(t,this.deviceManagementService.getCurrentAudioOutputDevice()),t.play()}catch(r){}}else this.logger.info("[ringingService] playCustomNotif  -- ignored")}async startRingBackTone(e){if(e&&this.stopWebrtcSounds)this.logger.info("[ringingService] startRingBackTone is blocked for webrtc calls...");else if(this.logger.info("[ringingService] startRingBackTone..."),this.ringbackTone&&this.ringbackTone.stopDefered&&(this.logger.info("[ringingService] startRingBackTone: cancel defered stop operation"),clearTimeout(this.ringbackTone.stopDefered),this.ringbackTone.stopDefered=void 0),this.ringbackTone&&this.ringbackTone.audio&&this.ringbackTone.audio.paused&&!this.ringbackTone.starting){this.logger.info("[ringingService] startRingBackTone currently paused"),this.ringbackTone.starting=true;try{await this.deviceManagementService.setSetSinkIdForAudioElement(this.ringbackTone.audio,this.deviceManagementService.getCurrentAudioOutputDevice()),this.play(this.ringbackTone)}catch(t){}}else this.logger.info("[ringingService] startRingBackTone -- nothing to do (already starting or playing)")}stopRingBackTone(e=1){if(this.logger.debug("[ringingService] stopRingBackTone -- count = "+e),this.ringbackTone){if(this.ringbackTone.starting)return void(this.ringbackTone.stopDefered?this.logger.debug("[ringingService] stopRingBackTone: nothing to do : stop already defered"):(this.logger.debug("[ringingService] stopRingBackTone: tone still starting: defer stop 1s later"),this.ringbackTone.stopDefered=setTimeout((()=>{this.stopRingBackToneDefered(e)}),1e3)));this.ringbackTone.stopDefered=void 0,this.ringbackTone.audio&&!this.ringbackTone.audio.paused?(this.logger.info("[ringingService] stopRingBackTone: tone is playing: stop it"),this.ringbackTone.audio.pause(),this.ringbackTone.audio.currentTime=0,this.ringbackTone.audio.load()):this.logger.debug("[ringingService] stopRingBackTone: nothing to do : tone is already stopped")}}async startIncomingRinging(e=false){if(e&&this.stopWebrtcSounds)this.logger.info("[ringingService] startIncomingRinging is blocked for webrtc calls...");else if(this.logger.info("[ringingService] startIncomingRinging..."),this.incomingRingingTone&&this.incomingRingingTone.stopDefered&&(this.logger.info("[ringingService] startIncomingRinging: cancel defered stop operation"),clearTimeout(this.incomingRingingTone.stopDefered),this.incomingRingingTone.stopDefered=void 0),this.incomingRingingTone&&this.incomingRingingTone.audio&&this.incomingRingingTone.audio.paused&&!this.incomingRingingTone.starting){if(this.logger.info("[ringingService] startIncomingRinging currently paused"),"true"===this.settingsService.getSetting("hasSecondRinger")){this.incomingRingingSecondaryTone.starting=true;try{await this.deviceManagementService.setSetSinkIdForAudioElement(this.incomingRingingSecondaryTone.audio,this.deviceManagementService.getCurrentSecondaryOutputDevice()),this.logger.info("[ringingService] startIncomingRinging secondary device -- play"),this.play(this.incomingRingingSecondaryTone)}catch(t){}}if(!("true"===this.settingsService.getSetting("hasSecondRinger")&&"true"===this.settingsService.getSetting("toneOnSecondaryRingerOnly")))try{this.incomingRingingTone.starting=true,await this.deviceManagementService.setSetSinkIdForAudioElement(this.incomingRingingTone.audio,this.deviceManagementService.getCurrentAudioOutputDevice()),this.play(this.incomingRingingTone)}catch(t){}}else this.logger.info("[ringingService] startIncomingRinging -- nothing to do (already starting or playing)")}stopIncomingRinging(e=1){if(this.logger.debug("[ringingService] stopIncomingRinging -- count = "+e),this.incomingRingingTone){if(this.incomingRingingTone.starting)return void(this.incomingRingingTone.stopDefered?this.logger.debug("[ringingService] stopIncomingRinging: nothing to do : stop already defered"):(this.logger.debug("[ringingService] stopIncomingRinging: tone still starting: defer stop 1s later"),this.incomingRingingTone.stopDefered=setTimeout((()=>{this.stopIncomingRingingDefered(e)}),1e3)));this.incomingRingingTone.stopDefered=void 0,this.incomingRingingTone.audio&&!this.incomingRingingTone.audio.paused?(this.logger.info("[ringingService] stopIncomingRinging: tone is playing: stop it"),this.incomingRingingTone.audio.pause(),this.incomingRingingTone.audio.currentTime=0):this.logger.debug("[ringingService] stopIncomingRinging: nothing to do : tone is already stopped")}if(this.incomingRingingSecondaryTone){if(this.incomingRingingSecondaryTone.starting)return void(this.incomingRingingSecondaryTone.stopDefered?this.logger.debug("[ringingService] stopIncomingRinging: nothing to do : secondary stop already defered"):(this.logger.debug("[ringingService] stopIncomingRinging: secondary tone still starting: defer stop 1s later"),this.incomingRingingSecondaryTone.stopDefered=setTimeout((()=>{this.stopIncomingRingingSecondaryDefered(e)}),1e3)));this.incomingRingingSecondaryTone.stopDefered=void 0,this.incomingRingingSecondaryTone.audio&&!this.incomingRingingSecondaryTone.audio.paused?(this.logger.info("[ringingService] stopIncomingRinging: secondary tone is playing: stop it"),this.incomingRingingSecondaryTone.audio.pause(),this.incomingRingingSecondaryTone.audio.currentTime=0):this.logger.debug("[ringingService] stopIncomingRinging: nothing to do : secondary tone is already stopped")}}async playSecondCallTone(){if(this.settingsService.getBooleanSetting("disableWaitingCallTone"))this.logger.info("[ringingService] disableWaitingCallTone is TRUE, user has disabled second ringing");else if(this.logger.info("[ringingService] playSecondCallTone..."),this.incomingRingingTone&&this.incomingRingingTone.audio)if(this.secondCallTone&&this.secondCallTone.stopDefered&&(this.logger.info("[ringingService] playSecondCallTone: cancel defered stop operation"),clearTimeout(this.secondCallTone.stopDefered),this.secondCallTone.stopDefered=void 0),this.secondCallTone&&this.secondCallTone.audio&&this.secondCallTone.audio.paused&&!this.secondCallTone.starting){this.secondCallTone.starting=true,this.secondCallTone.audio.currentTime=0,this.secondCallTone.audio.volume=.5;try{await this.deviceManagementService.setSetSinkIdForAudioElement(this.secondCallTone.audio,this.deviceManagementService.getCurrentAudioOutputDevice()),this.logger.info("[ringingService] playSecondCallTone play"),this.play(this.secondCallTone)}catch(e){}}else this.logger.info("[ringingService] playSecondCallTone -- nothing to do (already starting or playing)");else this.logger.info("[ringingService] playSecondCallTone -- ignored as settings is disabled")}stopSecondCallTone(){if(this.logger.debug("[ringingService] stopSecondCallTone"),this.secondCallTone){if(this.secondCallTone.starting)return void(this.secondCallTone.stopDefered?this.logger.debug("[ringingService] stopSecondCallTone: nothing to do : stop already defered"):(this.logger.debug("[ringingService] stopSecondCallTone: tone still starting: defer stop 1s later"),this.secondCallTone.stopDefered=setTimeout((()=>{this.stopSecondToneDefered()}),1e3)));this.secondCallTone.stopDefered=void 0,this.secondCallTone.audio&&!this.secondCallTone.audio.paused?(this.logger.info("[ringingService] stopSecondCallTone: tone is playing: stop it"),this.secondCallTone.audio.pause(),this.secondCallTone.audio.currentTime=0):this.logger.debug("[ringingService] stopSecondCallTone: nothing to do : tone is already stopped")}}async playHoldTone(){if(this.logger.info("[ringingService] playHoldTone..."),this.holdTone&&this.holdTone.stopDefered&&(this.logger.info("[ringingService] playHoldTone: cancel defered stop operation"),clearTimeout(this.holdTone.stopDefered),this.holdTone.stopDefered=void 0),this.holdTone&&this.holdTone.audio&&this.holdTone.audio.paused&&!this.holdTone.starting){this.holdTone.starting=true,this.holdTone.audio.currentTime=0;try{await this.deviceManagementService.setSetSinkIdForAudioElement(this.holdTone.audio,this.deviceManagementService.getCurrentAudioOutputDevice()),this.logger.info("[ringingService] playHoldTone play"),this.play(this.holdTone)}catch(e){}}else this.logger.info("[ringingService] playHoldTone -- nothing to do (already starting or playing)")}stopHoldTone(){if(this.logger.debug("[ringingService] stopHoldTone"),this.holdTone){if(this.holdTone.starting)return void(this.holdTone.stopDefered?this.logger.debug("[ringingService] stopHoldTone: nothing to do : stop already defered"):(this.logger.debug("[ringingService] stopHoldTone: tone still starting: defer stop 1s later"),this.holdTone.stopDefered=setTimeout((()=>{this.stopHoldToneDefered()}),1e3)));this.holdTone.stopDefered=void 0,this.holdTone.audio&&!this.holdTone.audio.paused?(this.logger.info("[ringingService] stopHoldTone: tone is playing: stop it"),this.holdTone.audio.pause(),this.holdTone.audio.currentTime=0):this.logger.debug("[ringingService] stopHoldTone: nothing to do : tone is already stopped")}}async playImNotif(){if(this.stopWebrtcSounds)this.logger.info("[ringingService] playImNotif is blocked...");else if(this.shouldPlayImNotif()){if(this.settingsService.getSetting("imSound")&&this.pingAudio){if(this.logger.info("[ringingService] playImNotif"),this.pingAudio.currentTime=0,this.pingAudioSecondary.currentTime=0,"true"===this.settingsService.getSetting("hasSecondRinger"))try{await this.deviceManagementService.setSetSinkIdForAudioElement(this.pingAudioSecondary,this.deviceManagementService.getCurrentSecondaryOutputDevice()),this.pingAudioSecondary.play()}catch(e){}try{await this.deviceManagementService.setSetSinkIdForAudioElement(this.pingAudio,this.deviceManagementService.getCurrentAudioOutputDevice()),this.pingAudio.play()}catch(e){}}}else this.logger.info("[ringingService] playImNotif  -- ignored")}async playRecordTone(){this.logger.info("[ringingService] playRecordTone"),this.recordTone.currentTime=0;try{await this.deviceManagementService.setSetSinkIdForAudioElement(this.recordTone,this.deviceManagementService.getCurrentAudioOutputDevice()),this.recordTone.play()}catch(e){}}stopIncomingWebrtcSounds(){this.stopWebrtcSounds=true}}t.RingingService=h},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{constructor(e,t,i,n,s,o,a,c,l,d,u){this.count=0,this.editable=false,this.isMissed=false,this.isNotAnswered=false,this.id=e,this.contact=t,this.state=i,this.durationInfos=n,this.type=s,this.read=o,this.date=a,this.direction=c,this.callSubject=l,this.isLatestCall=d,this.calledNumber=u,this.type="unknown"===s||"audio"===s||"webrtc"===s?r.Type.WEBRTC:"telephone"===s?r.Type.TELEPHONE:r.Type.CONFERENCE,this.directoryContactId=null}static create(e,t,i,n,s,o,a,c,l,d,u=null){return new r(e,t,i,n,s,o,a,c,l,d,u)}static getDate(e){return e&&e.date?e.date.getTime():0}updateCallLogDisplayInfo(e=false){"incoming"===this.direction?(this.svgClass="missed"===this.state?"missed":"active",this.svgId="call_made","forwarded"===this.state?(this.svgId="call_missed",this.title="incomingCallForwarded"):this.title="incommingCall","missed"===this.state&&(this.title=e&&this.count>1?"missedCalls":"missedCall")):(this.svgId="call_received",this.title="outgoingCall",this.svgClass="active","missed"===this.state&&(this.svgClass=""))}static getNames(e){let t="",i="",r=null;return e&&e.contact&&(t=e.contact.firstname.toUpperCase(),i=e.contact.lastname.toUpperCase(),r=e.date?e.date.getTime():null),{firstname:t,lastname:i,date:r}}static sortByContact(e,t){let i=-1;if(e&&e.value.lastname&&t&&t.value.lastname){let r=e.value.lastname,n=t.value.lastname;i=r.localeCompare(n),0===i&&(r=e.value.firstname,n=t.value.firstname,i=r.localeCompare(n),0===i&&t.value.date&&e.value.date&&(i=t.value.date-e.value.date))}return i}static sortByDate(e,t){let i=1;return e&&t&&(i=t.value-e.value),i}}r.Type={WEBRTC:"webrtc",TELEPHONE:"telephone",CONFERENCE:"conference"},t.CallLog=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{constructor(){this.currentMode=r.modeType.NOTELEPHONY,this.changeModePossible=false,this.computerModeAvailable=false,this.officePhoneModeAvailable=false,this.mobileProModeAvailable=false,this.mobilePersoModeAvailable=false,this.phonePersoModeAvailable=false,this.otherPhoneModeAvailable=false}static create(){return new r}getData(){return JSON.stringify({currentMode:this.currentMode,changeModePossible:this.changeModePossible,computerModeAvailable:this.computerModeAvailable,officePhoneModeAvailable:this.officePhoneModeAvailable,mobileProModeAvailable:this.mobileProModeAvailable,mobilePersoModeAvailable:this.mobilePersoModeAvailable,phonePersoModeAvailable:this.phonePersoModeAvailable,otherPhoneModeAvailable:this.otherPhoneModeAvailable})}setFromData(e,t){t.currentMode&&(e.currentMode=t.currentMode),t.changeModePossible&&(e.changeModePossible=t.changeModePossible),t.computerModeAvailable&&(e.computerModeAvailable=t.computerModeAvailable),t.officePhoneModeAvailable&&(e.officePhoneModeAvailable=t.officePhoneModeAvailable),t.mobileProModeAvailable&&(e.mobileProModeAvailable=t.mobileProModeAvailable),t.mobilePersoModeAvailable&&(e.mobilePersoModeAvailable=t.mobilePersoModeAvailable),t.phonePersoModeAvailable&&(e.phonePersoModeAvailable=t.phonePersoModeAvailable),t.otherPhoneModeAvailable&&(e.otherPhoneModeAvailable=t.otherPhoneModeAvailable)}}r.modeType={NOTELEPHONY:"noTelephony",COMPUTER:"computer",OFFICEPHONE:"officePhone",MOBILEPRO:"mobilePro",MOBILEPERSO:"mobilePerso",PHONEPERSO:"phonePerso",OTHERPHONE:"otherPhone",HELP:"help",CALLWARN:"callWarn",VOICEMAIL:"voicemail",NOFORWARD:"noForward",CONTACT:"contact"},t.TelephonyMode=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});class r{constructor(){this.currentMode=r.modeType.NOFORWARD,this.changeModePossible=false,this.destination="",this.mobileProModeAvailable=false,this.mobilePersoModeAvailable=false,this.phonePersoModeAvailable=false,this.voiceMailModeAvailable=false,this.otherPhoneModeAvailable=false}static create(){return new r}getData(){return JSON.stringify({currentMode:this.currentMode,changeModePossible:this.changeModePossible,destination:this.destination})}setFromData(e,t){t.currentMode&&(e.currentMode=t.currentMode),t.changeModePossible&&(e.changeModePossible=t.changeModePossible),t.destination&&(e.destination=t.destination),t.voiceMailModeAvailable&&(e.voiceMailModeAvailable=t.voiceMailModeAvailable),t.mobileProModeAvailable&&(e.mobileProModeAvailable=t.mobileProModeAvailable),t.mobilePersoModeAvailable&&(e.mobilePersoModeAvailable=t.mobilePersoModeAvailable),t.phonePersoModeAvailable&&(e.phonePersoModeAvailable=t.phonePersoModeAvailable),t.otherPhoneModeAvailable&&(e.otherPhoneModeAvailable=t.otherPhoneModeAvailable)}}r.modeType={NOFORWARD:"noForward",MOBILEPRO:"mobilePro",MOBILEPERSO:"mobilePerso",PHONEPERSO:"phonePerso",OTHERPHONE:"otherPhone",VOICEMAIL:"voicemail"},r.conditionalForwardType={IMMEDIATE:"immediate",BUSY:"busy",NOREPLY:"noreply"},t.ForwardMode=r},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});t.default=class{constructor(e,t){this.message=e,this.code=t}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});t.InvitationSDK=class{constructor(e){this.id=e.id,this.invitedUserId=e.invitedUserId,this.invitedUserEmail=e.invitedUserEmail,this.invitedUserPhoneNumber=e.invitedUserPhoneNumber,this.invitingUserId=e.invitingUserId,this.invitingUserEmail=e.invitingUserEmail,this.date=e.invitingDate,this.status=e.status}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(150);t.CallSDK=class{constructor(e){this.isVm=false,this.remoteMedia=0,this.localMedia=0,this.startDate=Date,this.isInitiator=false,this.participants=null,this.isMuted=false,this.globalCallId=null,this.correlatorData=null,this.id=e.id,this.status=e.status,this.conversationId=e.conversationId,this.type=e.type,this.isVm=e.isVm,this.contact=e.contact?new r.ContactSDK(e.contact):"",this.remoteMedia=e.remoteMedia,this.localMedia=e.localMedia,this.startDate=e.startDate,this.isInitiator=e.isInitiator,this.participants=e.participants?e.participants.map((e=>{if(e)return new r.ContactSDK(e)})):null,this.isMuted=e.isMuted,this.globalCallId=e.globalCallId,this.correlatorData=e.correlatorData}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});t.ChannelSDK=class{constructor(e){this.id=e.id,this.name=e.name,this.visibility=e.visibility,this.topic=e.topic,this.creatorId=e.creatorId,this.companyId=e.companyId,this.creationDate=e.creationDate,this.usersCount=e.usersCount,this.avatar=e.avatar,this.lastAvatarUpdateDate=e.lastAvatarUpdateDate,this.userRole=e.userRole,this.messages=e.messages,this.subscribed=e.subscribed,this.deleted=e.deleted,this.invited=e.invited,this.category=e.category,this.users=e.users,this.subscribersCount=e.subscribers_count,this.messagesCount=e.messagesCount}}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(4),n=i(8),s=i(13),o=i(37),a=i(6),c=i(7),l=i(18),d=i(9);class u{constructor(e=null,t=null,i=null,r=null,n=null,s=null,o=null,a=null){this.startRecording=e,this.pauseRecording=t,this.resumeRecording=i,this.stopRecording=r,this.getConferenceRecordingFiles=n,this.getSharedWithMeConferenceRecordingFiles=s,this.deleteConferenceRecordingFile=o,this.getConferenceRecordingAssociatedFiles=a}}class h{constructor(){this.RAINBOW_ONWEBCONFERENCERECORDINGREADY="rainbowonwebconferencerecordingready",this.logger=r.LoggerService.getInstance(),this.authService=n.AuthService.getInstance(),this.errorHelperService=s.ErrorHelperService.getInstance(),this.fileStorageService=o.FileStorageService.getInstance(),this.xmppService=d.XmppService.getInstance(),this.contactService=a.ContactService.getInstance(),this.time=0,this.timeMinutes=0,this.timeHours=0,this.timer=null,this.conferenceRecordingFilesFetched=false,this.sharedWithMeConferenceRecordingFilesFetched=false,this.subscription=null,this.rxSubject=new c.Subject,this.conferenceRecordingFilesInProgress=[],this.conferenceRecordingFetchPromise=null,this._sdkApis=Object.keys(new u),this.xmppService.connected&&this.attachHandlers(),this.subscription=this.xmppService.subscribeToConnectionEvents((e=>{this.onConnectionStateChangeEvent(e)}))}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.conferenceRecordingService||(e.rainbow.conferenceRecordingService=new h),e.rainbow.conferenceRecordingService}attachHandlers(){this.removeHandlers(),this.messageHandlerRef=this.xmppService.addHandler((e=>(setTimeout((()=>{this.onManagementMessageReceived(e)}),250),true)),null,"message","management")}removeHandlers(){this.messageHandlerRef&&(this.xmppService.deleteHandler(this.messageHandlerRef),this.messageHandlerRef=null)}onConnectionStateChangeEvent(e){"ON_XMPP_DISCONNECTED"===e.name?"LOGOUT"===e.data.reason&&(this.removeHandlers(),this.sharedWithMeConferenceRecordingFilesFetched=false,this.conferenceRecordingFilesFetched=false):"ON_XMPP_CONNECTED"===e.name&&this.attachHandlers()}onManagementMessageReceived(e){try{const t=$(e);return t.find("recordingfile").length>0&&this.manageRecordingStanzaData(t),true}catch(t){return this.logger.error("[ConferenceRecordingService] onManagementMessageReceived ERROR "+t),true}}async manageRecordingStanzaData(e){const t=e.find("recordingfile"),i=e[0]&&e[0].firstChild&&e[0].firstChild.id?e[0].firstChild.id:null;if(this.logger.info("[ConferenceRecordingService] onRecordingFileReceived"),t.find("status")&&"release_complete"!==t.find("status").text())return void(i&&-1===this.conferenceRecordingFilesInProgress.indexOf(i)&&(this.conferenceRecordingFilesInProgress.push(i),this.conferenceRecordingFilesFetched=false,await this.getConferenceRecordingFiles()));this.logger.info("[ConferenceRecordingService] - manage recording files"),i&&this.conferenceRecordingFilesInProgress.indexOf(i)>-1&&this.conferenceRecordingFilesInProgress.splice(this.conferenceRecordingFilesInProgress.indexOf(i),1);const r=$(t).find("records").find("recordingfile");if(r){let e=null;const i=$(t[0]).find("roomid").text();for(let t=0;t<r.length;t++){const i=$(r[t]).find("fileid").text(),n=$(r[t]).find("typemime").text(),s=await this.fileStorageService.retrieveAndStoreOneFileDescriptor(i,true);this.logger.info("[ConferenceRecordingService] ConferenceRecordingFile retrieved"),s.ownerId!==this.contactService.userContact.dbId&&this.fileStorageService.retrieveUserConsumption(),"video/mp4"===n&&(e=s)}await this.fileStorageService.getRecordingFilesFromServer(),this.sendEvent(this.RAINBOW_ONWEBCONFERENCERECORDINGREADY,{roomDbId:i,fileDescriptor:e})}}subscribe(e){return this.rxSubject.subscribe(e)}sendEvent(e,t=null){this.rxSubject.next(l.RBEvent.create(e,t))}async startRecording(e){try{if(this.logger.debug("[ConferenceRecordingService] startRecording"),!e||!e.id)throw Error("Wrong or missing parameters");const t=this.fileStorageService.getConsumptionData();if(t.maxValue-t.currentValue<=0)throw Error("Not enough storage space");const i=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.id}/start-recording`,r="PUT",n=this.authService.getPostHeader(),s=await fetch(i,{method:r,headers:n});if(!s.ok)throw s;return e.record.isRecording=true,e.record.recordingIsPaused=false,this.logger.info("[ConferenceRecordingService] startRecording -- successfully"),e}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"startRecording");throw this.logger.error(e.message),e.error}}async pauseRecording(e){try{if(this.logger.debug("[ConferenceRecordingService] pauseRecording"),!e||!e.id)throw Error("Wrong or missing parameters");const t=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.id}/pause-recording`,i="PUT",r=this.authService.getPostHeader(),n=await fetch(t,{method:i,headers:r});if(!n.ok)throw n;return e.record.isRecording=true,e.record.recordingIsPaused=true,this.logger.info("[ConferenceRecordingService] pauseRecording -- successfully"),e}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"pauseRecording");throw this.logger.error(e.message),e.error}}async resumeRecording(e){try{if(this.logger.debug("[ConferenceRecordingService] resumeRecording"),!e||!e.id)throw Error("Wrong or missing parameters");const t=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.id}/resume-recording`,i="PUT",r=this.authService.getPostHeader(),n=await fetch(t,{method:i,headers:r});if(!n.ok)throw n;return e.record.isRecording=true,e.record.recordingIsPaused=false,this.logger.info("[ConferenceRecordingService] resumeRecording -- successfully"),e}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"resumeRecording");throw this.logger.error(e.message),e.error}}async stopRecording(e){try{if(this.logger.debug("[ConferenceRecordingService] stopRecording"),!e||!e.id)throw Error("Wrong or missing parameters");const t=`${config.restServerUrl}/api/rainbow/conference/v1.0/rooms/${e.id}/stop-recording`,i="PUT",r=this.authService.getPostHeader(),n=await fetch(t,{method:i,headers:r});if(!n.ok)throw n;return e.record.isRecording=false,e.record.recordingIsPaused=false,this.logger.info("[ConferenceRecordingService] stopRecording -- successfully"),e}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"stopRecording");throw this.logger.error(e.message),e.error}}async getConferenceRecordingFiles(){return this.logger.info("[ConferenceRecordingService] getConferenceRecordingFiles"),this.conferenceRecordingFilesFetched||this.conferenceRecordingFetchPromise?!this.conferenceRecordingFilesFetched&&this.conferenceRecordingFetchPromise?this.conferenceRecordingFetchPromise:this.fileStorageService.getRecordingFiles():(this.conferenceRecordingFetchPromise=this.fetchConferenceRecordingFiles(),this.conferenceRecordingFetchPromise)}async fetchConferenceRecordingFiles(){try{this.logger.info("[ConferenceRecordingService] fetchConferenceRecordingFiles");const e=await this.fileStorageService.getRecordingFilesFromServer();return this.conferenceRecordingFilesFetched=true,this.conferenceRecordingFetchPromise=null,e}catch(e){this.conferenceRecordingFilesFetched=false,this.conferenceRecordingFetchPromise=null;const t=await this.errorHelperService.getErrorInfo(e,"stopRecording");throw this.logger.error(t.message),t.error}}async getSharedWithMeConferenceRecordingFiles(){return this.logger.info("[ConferenceRecordingService] getSharedWithMeConferenceRecordingFiles"),this.sharedWithMeConferenceRecordingFilesFetched?this.fileStorageService.getSharedWithMeConferenceRecordingFiles():await this.fetchSharedWithMeConferenceRecordingFiles()}async fetchSharedWithMeConferenceRecordingFiles(){try{return this.logger.info("[ConferenceRecordingService] fetchSharedWithMeConferenceRecordingFiles"),this.sharedWithMeConferenceRecordingFilesFetched=true,await this.fileStorageService.getSharedWithMeConferenceRecordingFilesFromServer()}catch(e){this.sharedWithMeConferenceRecordingFilesFetched=false;const t=await this.errorHelperService.getErrorInfo(e,"stopRecording");throw this.logger.error(t.message),t.error}}async deleteConferenceRecordingFile(e){try{if(!e)throw new Error("[ConferenceRecordingService] deleteConferenceRecordingFile - ERROR: no conferenceRecordingFileId");return this.logger.info("[ConferenceRecordingService] deleteConferenceRecordingFile"),await this.fileStorageService.deleteConferenceRecordingFile(e)}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"stopRecording");throw this.logger.error(e.message),e.error}}async getConferenceRecordingAssociatedFiles(e){try{if(!e)throw new Error("[ConferenceRecordingService] getConferenceRecordingAssociatedFiles - ERROR: no conferenceRecordingFile");return this.logger.info("[ConferenceRecordingService] getConferenceRecordingAssociatedFiles"),await this.fileStorageService.getConferenceRecordingAssociatedFiles(e)}catch(t){const e=await this.errorHelperService.getErrorInfo(t,"stopRecording");throw this.logger.error(e.message),e.error}}startTimer(){this.timer=setInterval((async()=>{this.time++,this.time%60==0&&(this.time=0,this.timeMinutes++,this.timeMinutes%60==0&&(this.timeMinutes=0,this.timeHours++))}),1e3)}clearTimer(){clearInterval(this.timer),this.time=0,this.timeMinutes=0,this.timeHours=0}getTime(){return{hours:this.timeHours,minutes:this.timeMinutes,seconds:this.time}}setTime(e,t,i){this.time=i,this.timeMinutes=t,this.timeHours=e}isMyRecord(e){return e.recordingUserId===this.contactService.userContact.dbId}}t.ConferenceRecordingService=h},function(e,t,i){Object.defineProperty(t,"__esModule",{value:true});const r=i(6),n=i(8),s=i(4),o=i(13);class a{constructor(){this.authService=n.AuthService.getInstance(),this.logger=s.LoggerService.getInstance(),this.contactService=r.ContactService.getInstance(),this.errorHelperService=o.ErrorHelperService.getInstance()}static getInstance(){const e=window;return e.rainbow||(e.rainbow={}),e.rainbow.suggestionsService||(e.rainbow.suggestionsService=new a),e.rainbow.suggestionsService}async getSuggestedContacts(e=50,t="small"){const i=`${config.restServerUrl}/api/rainbow/suggestions/v1.0/suggestions?nbSuggestions=${e}&format=${t}`,r=this.authService.getRequestHeader();try{const e=await fetch(i,{headers:r});if(!e.ok)throw e;const t=(await e.json()).data.map((e=>{const t=this.contactService.createContact();return t.updateFromUserData(e),t.getAvatar(),t}));return this.logger.info(`[SuggestionsService] getSuggestedContact success -- find ${t.length} suggested contact(s)`),t}catch(n){const e=await this.errorHelperService.getErrorInfo(n,"getIssuesList");throw this.logger.error(e.message),e.error}}async getSuggestedContactsLargeCompany(e=[],t=20,i=0,r=false,n=false,s=false,o=false,a="small"){let c=`${config.restServerUrl}/api/rainbow/suggestions/v1.0/suggestions?limit=${t}&offset=${i}&format=${a}`;r&&(c+="&department=true"),n&&(c+="&jobtitle=true"),s&&(c+="&tags=true"),o&&(c+="&more=true");const l=this.authService.getPostHeader();try{const t=await fetch(c,{method:"POST",headers:l,body:JSON.stringify({excludeIds:e})});if(!t.ok)throw t;const i=await t.json();let r,n=[],s=[],o=[],a=[];return i.data.department||i.data.jobTitle||i.data.tags||i.data.more?(i.data.department&&(n=i.data.department.map((e=>this.manageContact(e)))),i.data.jobTitle&&(s=i.data.jobTitle.map((e=>this.manageContact(e))),n.length>0&&(s=this.clearDuplicateInSecondArray(n,s))),i.data.tags&&(o=i.data.tags.map((e=>this.manageContact(e))),n.length>0&&(o=this.clearDuplicateInSecondArray(n,o)),s.length>0&&(o=this.clearDuplicateInSecondArray(s,o))),i.data.more&&(a=i.data.more.map((e=>this.manageContact(e))),n.length>0&&(a=this.clearDuplicateInSecondArray(n,a)),s.length>0&&(a=this.clearDuplicateInSecondArray(s,a)),o.length>0&&(a=this.clearDuplicateInSecondArray(o,a))),r={department:n,jobTitle:s,tags:o,more:a}):r=i.data.map((e=>this.manageContact(e))),this.logger.info(`[SuggestionsService] getSuggestedContactsLargeCompany success -- find ${r.length} suggested contact(s)`),r}catch(d){const e=await this.errorHelperService.getErrorInfo(d,"getSuggestedContactsLargeCompany");throw this.logger.error(e.message),e.error}}clearDuplicateInSecondArray(e,t){const i=e.map((e=>e.jid));return t.filter((e=>!i.some((t=>t===e.jid))))}manageContact(e){const t=this.contactService.createContact();return t.updateFromUserData(e),t.getAvatar(),t}}t.SuggestionsService=a},function(e,t){Strophe.addNamespace("RSM","http://jabber.org/protocol/rsm"),Strophe.RSM=function(e){if(this.attribs=["max","first","last","after","before","index","count"],void 0!==e.xml)this.fromXMLElement(e.xml);else for(let t=0;t<this.attribs.length;t++){const i=this.attribs[t];this[i]=e[i]}},Strophe.RSM.prototype={toXML:function(){let e=$build("set",{xmlns:Strophe.NS.RSM});for(let t=0;t<this.attribs.length;t++){const i=this.attribs[t];void 0!==this[i]&&(e=e.c(i).t(this[i].toString()).up())}return e.tree()},next:function(e){return new Strophe.RSM({max:e,after:this.last})},previous:function(e){return new Strophe.RSM({max:e,before:this.first})},fromXMLElement:function(e){for(let t=0;t<this.attribs.length;t++){const i=this.attribs[t],r=e.getElementsByTagName(i)[0];null!=r&&(this[i]=Strophe.getText(r),"first"==i&&(this.index=r.getAttribute("index")))}}}},function(e,t){Strophe.addConnectionPlugin("ping",{_c:null,init:function(e){this._c=e,Strophe.addNamespace("PING","urn:xmpp:ping")},ping:function(e,t,i,r){const n=this._c.getUniqueId("ping"),s=$iq({type:"get",to:e,id:n}).c("ping",{xmlns:Strophe.NS.PING});this._c.sendIQ(s,t,i,r)},pong:function(e){const t=e.getAttribute("from"),i=e.getAttribute("id"),r=$iq({type:"result",to:t,id:i});this._c.sendIQ(r)},addPingHandler:function(e){return this._c.addHandler(e,Strophe.NS.PING,"iq","get")}})},function(e,t){Strophe.addConnectionPlugin("lastactivity",{_c:null,_n:0,init:function(e){this._c=e,Strophe.addNamespace("LAST_ACTIVITY","jabber:iq:last")},query:function(e,t){const i={type:"get",id:"lastActivityId"+this._n++,from:this._c.jid,to:e},r={xmlns:Strophe.NS.LAST_ACTIVITY},n=$iq(i).c("query",r),s=t.onResponse;return delete t.onResponse,this._c.addHandler(null,Strophe.NS.LAST_ACTIVITY,"message",null),this._c.sendIQ(n,s)}})},function(e,t,i){i.r(t);var r=i(4),n=i(12);Strophe.addConnectionPlugin("jingle",{connection:null,sessions:{},jid2session:{},ice_config:{iceServers:[]},company_config:{},pc_constraints:{rtcpMuxPolicy:"require",bundlePolicy:"max-bundle"},media_constraints:{},localStream:null,connectionRef:null,jingleIqTimeout:15e3,init:function(e){this.connection=e,this.connection.disco&&(this.connection.disco.addFeature("urn:xmpp:jingle:1"),this.connection.disco.addFeature("urn:xmpp:jingle:apps:rtp:1"),this.connection.disco.addFeature("urn:xmpp:jingle:transports:ice-udp:1"),this.connection.disco.addFeature("urn:xmpp:jingle:apps:rtp:audio"),this.connection.disco.addFeature("urn:xmpp:jingle:apps:rtp:video"),this.connection.disco.addFeature("urn:ietf:rfc:5761")),this.connectionRef&&(this.connection.deleteHandler(this.connectionRef),this.connectionRef=null),config&&config.jingleIqTimeout?this.jingleIqTimeout=config.jingleIqTimeout:this.jingleIqTimeout=15e3,this.connectionRef=this.connection.addHandler(this.onJingle.bind(this),"urn:xmpp:jingle:1","iq","set",null,null);for(const t in this.sessions)if(this.sessions.hasOwnProperty(t)){this.sessions[t].connection=this.connection}this.rxSubject||(this.rxSubject=new n.a),this.logger=r.LoggerService.getInstance()},attachHandlers:function(){this.connectionRef&&(this.connection.deleteHandler(this.connectionRef),this.connectionRef=null),this.connectionRef=this.connection.addHandler(this.onJingle.bind(this),"urn:xmpp:jingle:1","iq","set",null,null)},onJingle:function(e){console.log("[Strophe.jingle] onJingle");try{const n=$(e).find("jingle").attr("sid"),s=$(e).find("jingle").attr("action"),o=$iq({type:"result",to:e.getAttribute("from"),id:e.getAttribute("id")});let a=this.sessions[n];if("session-initiate"!==s){if(null==a)return o.type="error",o.c("error",{type:"cancel"}).c("item-not-found",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("unknown-session",{xmlns:"urn:xmpp:jingle:errors:1"}),this.connection.send(o),$(document).trigger("callterminated.jingle",[n]),this.rxSubject.next({name:"callterminated.jingle",data:{sid:n}}),true;if(Strophe.getBareJidFromJid(e.getAttribute("from"))!=Strophe.getBareJidFromJid(a.peerjid))return console.warn("[Strophe.jingle] jid mismatch for session id",n,e.getAttribute("from"),a.peerjid),o.type="error",o.c("error",{type:"cancel"}).c("item-not-found",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("unknown-session",{xmlns:"urn:xmpp:jingle:errors:1"}),this.connection.send(o),true}else if(void 0!==a)return o.type="error",o.c("error",{type:"cancel"}).c("service-unavailable",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up(),console.warn("[Strophe.jingle] duplicate session id",n),this.connection.send(o),true;switch("transport-replace"!==s&&this.connection.send(o),s){case"session-initiate":var t=$(e).find("jingle").attr("localType");console.log("REMOTE TYPE || "+t),a=new JingleSession($(e).attr("to"),$(e).find("jingle").attr("sid"),this.connection,this.jingleIqTimeout),a.media_constraints=this.media_constraints,a.pc_constraints=this.pc_constraints,a.ice_config=this.ice_config,a.company_config=this.company_config,a.logger=this.logger;var i=$(e).find("conference").attr("id");i&&(a.conference_id=i),a.initiate($(e).attr("from"),false),a.remoteType=t,a.confId=$(e).find("jingle").attr("confId"),a.publisherId=$(e).find("conference").attr("publisherId"),a.replaceSid=$(e).find("replaces").attr("sid"),a.setRemoteDescription($(e).find(">jingle"),"offer"),this.sessions[a.sid]=a,this.jid2session[a.peerjid]=a,$(document).trigger("callincoming.jingle",[a.sid]),this.rxSubject.next({name:"jingleSessionInvitation",data:{sid:a.sid}});break;case"transport-replace":a.isReconnecting=true,console.log("[strophe jingle] Transport replace");t=$(e).find("jingle").attr("localType");console.log("REMOTE TYPE || "+t),a.media_constraints=this.media_constraints,a.pc_constraints=this.pc_constraints,a.ice_config=this.ice_config,a.company_config=this.company_config,a.remoteType=t,this.sessions[a.sid]=a,this.jid2session[a.peerjid]=a,a.hasSentTransportReplace?(console.log("[strophe jingle] Transport replace -- put on hold"),a.saveIncomingTransportReplace($(e).find(">jingle"),"offer",o)):(console.log("[strophe jingle] Transport replace is accepted"),this.connection.send(o),a.setRemoteDescription($(e).find(">jingle"),"offer"),this.rxSubject.next({name:"transportreplace.jingle",data:{sid:a.sid}}));break;case"session-accept":a.setRemoteDescription($(e).find(">jingle"),"answer");t=$(e).find(">jingle").attr("localType");a.remoteType=t,console.log("REMOTE TYPE || session-accept remoteType "+a.remoteType),console.log("REMOTE TYPE || session-accept localType "+a.localType),a.accept(),this.rxSubject.next({name:"callaccepted.jingle",data:{sid:a.sid}});break;case"transport-accept":a.setRemoteDescription($(e).find(">jingle"),"answer"),a.isReconnecting=false;t=$(e).find(">jingle").attr("localType");a.remoteType=t,console.log("REMOTE TYPE || transport-accept remoteType "+a.remoteType),console.log("REMOTE TYPE || transport-accept localType "+a.localType),this.rxSubject.next({name:"callaccepted.jingle",data:{sid:a.sid}});break;case"session-terminate":a.terminate(),this.terminate(a.sid),$(e).find(">jingle>conference").length&&$(e).find(">jingle>conference").attr("reason")?($(document).trigger("callterminated.jingle",[a.sid,"multi-device"]),this.rxSubject.next({name:"callterminated.jingle",data:{sid:a.sid,confId:a.conference_id,reason:"multi-device"}})):$(e).find(">jingle>reason").length?($(document).trigger("callterminated.jingle",[a.sid,$(e).find(">jingle>reason>:first")[0].tagName,$(e).find(">jingle>reason>text").text()]),this.rxSubject.next({name:"callterminated.jingle",data:{sid:a.sid,confId:a.conference_id,reason:$(e).find(">jingle>reason>:first")[0].tagName,reasonText:$(e).find(">jingle>reason>text").text()}})):($(document).trigger("callterminated.jingle",[a.sid]),this.rxSubject.next({name:"callterminated.jingle",data:{sid:a.sid,confId:a.conference_id}}));break;case"transport-info":console.log("[JINGLE] transport-info"),a.addIceCandidate($(e).find(">jingle>content"));break;case"session-info":if($(e).find('>jingle>ringing[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').length)this.rxSubject.next({name:"ringing.jingle",data:{sid:a.sid}});else if($(e).find('>jingle>iceFailed[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').length)this.logger.warn("[JINGLE] remoteIceFailed.jingle for "+a.sid);else if($(e).find('>jingle>hold[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').length)this.rxSubject.next({name:"hold.jingle",data:{sid:a.sid}});else if($(e).find('>jingle>unhold[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').length)this.rxSubject.next({name:"unhold.jingle",data:{sid:a.sid}});else if($(e).find('>jingle>refer[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').length){const t=$(e).find('>jingle>refer[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').attr("status"),i=$(e).find('>jingle>refer[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').attr("confEndpointId"),r=$(e).find('>jingle>refer[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').attr("referTo"),n=$(e).find('>jingle>refer[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').attr("method"),s=$(e).find('>jingle>refer[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').attr("sid");$(document).trigger("refer.jingle",[a.sid,t,i,r,n]),this.rxSubject.next({name:"refer.jingle",data:{sid:a.sid,status:t,confEndpointId:i,referTo:r,method:n,otherSid:s}})}else if($(e).find('>jingle>slowlink[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').length){const t=$(e).find('>jingle>slowlink[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').attr("direction"),i=$(e).find('>jingle>slowlink[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').attr("media"),r=$(e).find('>jingle>slowlink[xmlns="urn:xmpp:jingle:apps:rtp:info:1"]').attr("lost");this.rxSubject.next({name:"slowlink.jingle",data:{sid:a.sid,direction:t,media:i,lost:r}})}break;case"content-add":console.log("[Strophe Jingle] Content-add");var r=$(e).find(">jingle").attr("mediaType");a.remoteType=r,console.log("REMOTE TYPE || content-add remoteType "+a.remoteType),console.log("REMOTE TYPE || content-add localType "+a.localType),a.setRemoteDescription($(e).find(">jingle"),"offer"),a.mediaModified(),"BUNDLE"===$(e).find("group").attr("semantics")&&a.conference_id&&-1!==a.conference_id?this.rxSubject.next({name:"jingleContentAdd",data:{sid:a.sid,mediaType:r}}):this.rxSubject.next({name:"mediamodified.jingle",data:{sid:a.sid,mediaType:r}});break;case"content-modify":console.log("[Strophe Jingle] Content-modify");r=$(e).find(">jingle").attr("mediaType");if(a.remoteType=r,console.log("REMOTE TYPE || content-modify remoteType "+a.remoteType),console.log("REMOTE TYPE || content-modify localType "+a.localType),a.setRemoteDescription($(e).find(">jingle"),"offer"),a.mediaModified(),"BUNDLE"===$(e).find("group").attr("semantics")&&a.conference_id&&-1!==a.conference_id){const t={};$(e).find("jingle").find("content").each(((e,i)=>{t[$(i).attr("name")]="none"!==$(i).attr("senders")})),this.connection.jingle.rxSubject.next({name:"jingleUpdateStream",data:{sid:a.sid,medias:t}})}else this.rxSubject.next({name:"mediamodified.jingle",data:{sid:a.sid,mediaType:r}});break;case"content-remove":console.log("[Strophe Jingle] Content-remove");r=$(e).find(">jingle").attr("mediaType");a.remoteType=r,console.log("REMOTE TYPE || Content-remove remoteType "+a.remoteType),console.log("REMOTE TYPE || Content-remove localType "+a.localType),a.setRemoteDescription($(e).find(">jingle"),"offer"),a.mediaModified(true),this.rxSubject.next({name:"mediamodified.jingle",data:{sid:a.sid,mediaType:r}}),this.rxSubject.next({name:"contentRemove.jingle",data:{sid:a.sid,mediaType:r}});break;case"content-accept":console.log("[Strophe Jingle] Content-accept"),a.isReconnecting=false,a.setRemoteDescription($(e).find(">jingle"),"answer");break;case"addsource":a.addSource($(e).find(">jingle>content"));break;case"removesource":a.removeSource($(e).find(">jingle>content"));break;default:console.warn("[Strophe.jingle] jingle action not implemented",s)}}catch(n){return console.error("[Strophe.jingle] On Jingle error catch: "+n),true}return true},initiate:function(e,t,i,r,n,s,o,a,c,l){const d=n||"web_"+Math.random().toString(36).substr(2,12),u=new JingleSession(t||this.connection.jid,d,this.connection,this.jingleIqTimeout);if(r&&r.length)for(let h=0;h<r.length;h++)u.localStreams.push(r[h]);return this.ice_config.iceTransportPolicy=a?"relay":"all",u.media_constraints=this.media_constraints,u.ice_config=this.ice_config,u.company_config=this.company_config,u.logger=this.logger,u.replaceSid=l,i&&(u.localType=i),void 0!==s&&(u.conference_id=s),u.calledNumber=o&&""!==o?o:null,c&&(u.isEchoTest=true),u.initiate(e,true),this.sessions[u.sid]=u,this.jid2session[u.peerjid]=u,window.setTimeout((()=>{u.sendOffer(true)}),100),u},initiateBundle:function(e,t,i,r){return(async(e,t,i,r)=>{const n=Math.random().toString(36).slice(2,12),s=new JingleSession(t,n,this.connection,this.jingleIqTimeout);return s.localType="audio+video",s.media_constraints=this.media_constraints,s.ice_config=this.ice_config,s.company_config=this.company_config,s.logger=this.logger,s.conference_id=r,s.localStreams.push(i),this.ice_config.iceTransportPolicy="all",s.initiate(e,true,false),await s.addBundleStream(i),this.sessions[s.sid]=s,this.jid2session[s.peerjid]=s,s.sendOffer(true),s})(e,t,i,r)},terminate:function(e,t,i){if(null==e)for(e in this.sessions)"ended"!=this.sessions[e].state&&(this.sessions[e].sendTerminate(t||(this.sessions[e].active()?null:"cancel"),i),this.sessions[e].terminate()),delete this.jid2session[this.sessions[e].peerjid],delete this.sessions[e];else this.sessions.hasOwnProperty(e)&&("ended"!=this.sessions[e].state&&(this.sessions[e].sendTerminate(t||(this.sessions[e].active()?null:"cancel"),i),this.sessions[e].terminate()),delete this.jid2session[this.sessions[e].peerjid],delete this.sessions[e])},terminateByJid:function(e){if(this.jid2session.hasOwnProperty(e)){const t=this.jid2session[e];t&&(t.terminate(),delete this.sessions[t.sid],delete this.jid2session[e],$(document).trigger("callterminated.jingle",[t.sid,"gone"]),this.rxSubject.next({name:"callterminated.jingle",data:{sid:t.sid,confId:t.conference_id,reason:"gone"}}))}}})},function(e,t){window.SDP=function(e){this.media=e.split("\r\nm=");for(let t=1;t<this.media.length;t++)this.media[t]="m="+this.media[t],t!=this.media.length-1&&(this.media[t]+="\r\n");this.session=this.media.shift()+"\r\n",this.raw=this.session+this.media.join("")},SDP.prototype.mangle=function(){let e,t,i,r,n,s;for(e=0;e<this.media.length;e++)if(r=this.media[e].split("\r\n"),r.pop(),i=SDPUtil.parse_mline(r.shift()),"audio"==i.media){for(s="",i.fmt.length=0,t=0;t<r.length;t++)if("a=rtpmap:"==r[t].substr(0,9)){if(n=SDPUtil.parse_rtpmap(r[t]),"CN"==n.name||"ISAC"==n.name)continue;i.fmt.push(n.id),s+=r[t]+"\r\n"}else s+=r[t]+"\r\n";this.media[e]=SDPUtil.build_mline(i)+"\r\n",this.media[e]+=s}this.raw=this.session+this.media.join("")},SDP.prototype.removeSessionLines=function(e){const t=this,i=SDPUtil.find_lines(this.session,e);return i.forEach((function(e){t.session=t.session.replace(e+"\r\n","")})),this.raw=this.session+this.media.join(""),i},SDP.prototype.removeMediaLines=function(e,t){const i=this,r=SDPUtil.find_lines(this.media[e],t);return r.forEach((function(t){i.media[e]=i.media[e].replace(t+"\r\n","")})),this.raw=this.session+this.media.join(""),r},SDP.prototype.toJingle=function(e,t,i,r){let n,s,o,a,c,l,d,u,h,f=0;if(SDPUtil.find_line(this.session,"a=group:"))for(u=SDPUtil.find_lines(this.session,"a=group:"),n=0;n<u.length;n++){d=u[n].split(" ");const t=d.shift().substr(8);for(e.c("group",{xmlns:"urn:xmpp:jingle:apps:grouping:0",semantics:t}),s=0;s<d.length;s++)e.c("content",{name:d[s]}).up();e.up()}let p=[];for(SDPUtil.find_line(this.session,"a=group:BUNDLE")&&(p=SDPUtil.find_line(this.session,"a=group:BUNDLE ").split(" "),p.shift()),n=0;n<this.media.length;n++)if(a=SDPUtil.parse_mline(this.media[n].split("\r\n")[0]),"audio"==a.media||"video"==a.media){if(c=!!SDPUtil.find_line(this.media[n],"a=ssrc:")&&SDPUtil.find_line(this.media[n],"a=ssrc:").substring(7).split(" ")[0],h=!!SDPUtil.find_line(this.media[n],"a=simulcast:")&&SDPUtil.find_line(this.media[n],"a=simulcast:").substring(12).trim(),e.c("content",{creator:t,name:a.media}),SDPUtil.find_line(this.media[n],"a=mid:")){const t=SDPUtil.parse_mid(SDPUtil.find_line(this.media[n],"a=mid:"));e.attrs({name:t})}if(SDPUtil.find_line(this.media[n],"a=rtpmap:").length){if(e.c("description",{xmlns:"urn:xmpp:jingle:apps:rtp:1",media:a.media}),c&&e.attrs({ssrc:c}),(!i||-1===i)&&"video"===a.media){const t=0===f?r.video:r.sharing;f+=1,e.c("bandwidth",{type:"AS"}).t(t),e.up()}for(s=0;s<a.fmt.length;s++)if(l=SDPUtil.find_line(this.media[n],"a=rtpmap:"+a.fmt[s]+" "),l){if(e.c("payload-type",SDPUtil.parse_rtpmap(l)),SDPUtil.find_line(this.media[n],"a=fmtp:"+a.fmt[s]+" "))for(d=SDPUtil.parse_fmtp(SDPUtil.find_line(this.media[n],"a=fmtp:"+a.fmt[s]+" ")),o=0;o<d.length;o++)e.c("parameter",d[o]).up();this.RtcpFbToJingle(n,e,a.fmt[s]),e.up()}if(SDPUtil.find_line(this.media[n],"a=crypto:",this.session)){e.c("encryption",{required:1});SDPUtil.find_lines(this.media[n],"a=crypto:",this.session).forEach((function(t){e.c("crypto",SDPUtil.parse_crypto(t)).up()})),e.up()}if(c){e.c("source",{ssrc:c,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"});SDPUtil.find_lines(this.media[n],"a=ssrc:").forEach((function(t){const i=t.indexOf(" "),r=t.substr(0,i).substr(7);r!=c&&(e.up(),c=r,e.c("source",{ssrc:c,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}));const n=t.substr(i+1);e.c("parameter"),-1==n.indexOf(":")?e.attrs({name:n}):(e.attrs({name:n.split(":",2)[0]}),e.attrs({value:n.split(":",2)[1]})),e.up()})),e.up()}if(h){e.c("simulcast",{rids:h,xmlns:"urn:xmpp:jingle:apps:rtp:sim:0"});SDPUtil.find_lines(this.media[n],"a=rid:").forEach((function(t){const i=t.indexOf(" "),r=t.substr(0,i).substr(6);e.c("rid",{xmlns:"urn:xmpp:jingle:apps:rtp:rid:0",name:r}),e.up()})),e.up()}if(SDPUtil.find_lines(this.media[n],"a=ssrc-group").forEach((function(t){let i=t.indexOf(" ");const r=t.substr(0,i).substr(13);e.c("ssrc-group",{xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0",semantics:r});let n=t.substr(i+1);for(;n.length>0;){var s;i=n.indexOf(" "),i>0?(s=n.substr(0,i),n=n.substr(i+1)):(s=n.substr(0,n.length),n=""),e.c("source",{ssrc:s}).up()}e.up()})),SDPUtil.find_line(this.media[n],"a=rtcp-mux")&&e.c("rtcp-mux").up(),this.RtcpFbToJingle(n,e,"*"),SDPUtil.find_line(this.media[n],"a=extmap:"))for(u=SDPUtil.find_lines(this.media[n],"a=extmap:"),s=0;s<u.length;s++){if(d=SDPUtil.parse_extmap(u[s]),e.c("rtp-hdrext",{xmlns:"urn:xmpp:jingle:apps:rtp:rtp-hdrext:0",uri:d.uri,id:d.value}),d.hasOwnProperty("direction"))switch(d.direction){case"sendonly":e.attrs({senders:"responder"});break;case"recvonly":e.attrs({senders:"initiator"});break;case"sendrecv":e.attrs({senders:"both"});break;case"inactive":e.attrs({senders:"none"})}e.up()}e.up()}this.TransportToJingle(n,e),SDPUtil.find_line(this.media[n],"a=sendrecv",this.session)?e.attrs({senders:"both"}):SDPUtil.find_line(this.media[n],"a=sendonly",this.session)?e.attrs({senders:"initiator"}):SDPUtil.find_line(this.media[n],"a=recvonly",this.session)?e.attrs({senders:"responder"}):SDPUtil.find_line(this.media[n],"a=inactive",this.session)&&e.attrs({senders:"none"}),"0"!=a.port||SDPUtil.find_line(this.media[n],"a=bundle-only",this.session)||e.attrs({senders:"rejected"}),e.up()}return i&&-1!==i&&(e.c("conference",{xmlns:"urn:xmpp:janus:1",id:i}),e.up()),e.up(),e},SDP.prototype.TransportToJingle=function(e,t){let i;const r=this;t.c("transport");if(SDPUtil.find_lines(this.media[e],"a=fingerprint:",this.session).forEach((function(n){i=SDPUtil.parse_fingerprint(n),i.xmlns="urn:xmpp:jingle:apps:dtls:0",t.c("fingerprint").t(i.fingerprint),delete i.fingerprint,(n=SDPUtil.find_line(r.media[e],"a=setup:",r.session))&&(i.setup=n.substr(8)),t.attrs(i),t.up()})),i=SDPUtil.iceparams(this.media[e],this.session),i&&(i.xmlns="urn:xmpp:jingle:transports:ice-udp:1",t.attrs(i),SDPUtil.find_line(this.media[e],"a=candidate:",this.session))){SDPUtil.find_lines(this.media[e],"a=candidate:",this.session).forEach((function(e){t.c("candidate",SDPUtil.candidateToJingle(e)).up()}))}t.up()},SDP.prototype.RtcpFbToJingle=function(e,t,i){SDPUtil.find_lines(this.media[e],"a=rtcp-fb:"+i).forEach((function(e){const i=SDPUtil.parse_rtcpfb(e);"trr-int"==i.type?(t.c("rtcp-fb-trr-int",{xmlns:"urn:xmpp:jingle:apps:rtp:rtcp-fb:0",value:i.params[0]}),t.up()):(t.c("rtcp-fb",{xmlns:"urn:xmpp:jingle:apps:rtp:rtcp-fb:0",type:i.type}),i.params.length>0&&t.attrs({subtype:i.params[0]}),t.up())}))},SDP.prototype.RtcpFbFromJingle=function(e,t){let i="",r=e.find('>rtcp-fb-trr-int[xmlns="urn:xmpp:jingle:apps:rtp:rtcp-fb:0"]');return r.length&&(i+="a=rtcp-fb:* trr-int ",r.attr("value")?i+=r.attr("value"):i+="0",i+="\r\n"),r=e.find('>rtcp-fb[xmlns="urn:xmpp:jingle:apps:rtp:rtcp-fb:0"]'),r.each((function(){i+="a=rtcp-fb:"+t+" "+$(this).attr("type"),$(this).attr("subtype")&&(i+=" "+$(this).attr("subtype")),i+="\r\n"})),i},SDP.prototype.fromJingle=function(e){const t=this;if(this.raw="v=0\r\no=- 1923518516 2 IN IP4 0.0.0.0\r\ns=-\r\nt=0 0\r\n",$(e).find('>group[xmlns="urn:xmpp:jingle:apps:grouping:0"]').length)$(e).find('>group[xmlns="urn:xmpp:jingle:apps:grouping:0"]').each((function(e,i){const r=$(i).find(">content").map((function(e,t){return t.getAttribute("name")})).get();r.length>0&&(t.raw+="a=group:"+(i.getAttribute("semantics")||i.getAttribute("type"))+" "+r.join(" ")+"\r\n")}));else if($(e).find('>group[xmlns="urn:ietf:rfc:5888"]').length)$(e).find('>group[xmlns="urn:ietf:rfc:5888"]').each((function(e,i){const r=$(i).find(">content").map((function(e,t){return t.getAttribute("name")})).get();null!==i.getAttribute("type")&&r.length>0&&(t.raw+="a=group:"+i.getAttribute("type")+" "+r.join(" ")+"\r\n")}));else{const t=$(e).find(">content").filter((function(e,t){return $(t).find(">bundle").length>0})).map((function(e,t){return t.getAttribute("name")})).get();t.length&&(this.raw+="a=group:BUNDLE "+t.join(" ")+"\r\n")}this.raw+="a=ice-options:trickle\r\n",this.session=this.raw,e.find(">content").each((function(){const e=t.jingle2media($(this));t.media.push(e)}));const i=SDPUtil.parse_ssrc(this.raw);i.hasOwnProperty("mslabel")&&i.mslabel&&(this.session+="a=msid-semantic: WMS "+i.mslabel+"\r\n"),this.raw=this.session+this.media.join("")},SDP.prototype.jingle2media=function(e){let t="";const i=e.find("description"),r=(i.attr("ssrc"),this);let n;n={media:i.attr("media")},n.port="1","rejected"==e.attr("senders")&&(n.port="0"),e.find(">transport>fingerprint").length||i.find("encryption").length?n.proto="RTP/SAVPF":n.proto="RTP/AVPF",n.fmt=i.find("payload-type").map((function(){return this.getAttribute("id")})).get();let s=i.find("bandwidth").map((function(){return $(this).text()}));if(s=s.length?s[0]:null,t+=SDPUtil.build_mline(n)+"\r\n",t+="c=IN IP4 0.0.0.0\r\n",s){s=parseInt(s);let e="AS";"firefox"===adapter.default.browserDetails.browser&&(s=1e3*(s>>>0),e="TIAS"),t+="b="+e+":"+s+"\r\n"}if(t+="a=rtcp:1 IN IP4 0.0.0.0\r\n",n=e.find('>transport[xmlns="urn:xmpp:jingle:transports:ice-udp:1"]'),n.length&&(n.attr("ufrag")&&(t+=SDPUtil.build_iceufrag(n.attr("ufrag"))+"\r\n"),n.attr("pwd")&&(t+=SDPUtil.build_icepwd(n.attr("pwd"))+"\r\n"),n.find(">fingerprint").each((function(){t+="a=fingerprint:"+this.getAttribute("hash"),t+=" "+$(this).text(),t+="\r\n",this.getAttribute("setup")&&(t+="a=setup:"+this.getAttribute("setup")+"\r\n")}))),n=e.find('description>simulcast[xmlns="urn:xmpp:jingle:apps:rtp:sim:0"]'),n.length){const e=n.attr("rids");e&&(t+="a=simulcast: "+e+"\r\n"),n.find(">rid").each((function(){t+="a=rid:"+this.getAttribute("name")+" recv",t+="\r\n"}))}switch(e.attr("senders")){case"initiator":t+="a=sendonly\r\n";break;case"responder":t+="a=recvonly\r\n";break;case"none":t+="a=inactive\r\n";break;case"both":t+="a=sendrecv\r\n"}return t+="a=mid:"+e.attr("name")+"\r\n",i.find("rtcp-mux").length&&(t+="a=rtcp-mux\r\n"),i.find("encryption").length&&i.find("encryption>crypto").each((function(){t+="a=crypto:"+this.getAttribute("tag"),t+=" "+this.getAttribute("crypto-suite"),t+=" "+this.getAttribute("key-params"),this.getAttribute("session-params")&&(t+=" "+this.getAttribute("session-params")),t+="\r\n"})),i.find("payload-type").each((function(){t+=SDPUtil.build_rtpmap(this)+"\r\n",$(this).find(">parameter").length&&(t+="a=fmtp:"+this.getAttribute("id")+" ",t+=$(this).find("parameter").map((function(){return(this.getAttribute("name")?this.getAttribute("name")+"=":"")+this.getAttribute("value")})).get().join(";"),t+="\r\n"),t+=r.RtcpFbFromJingle($(this),this.getAttribute("id"))})),t+=r.RtcpFbFromJingle(i,"*"),n=i.find('>rtp-hdrext[xmlns="urn:xmpp:jingle:apps:rtp:rtp-hdrext:0"]'),n.each((function(){t+="a=extmap:"+this.getAttribute("id")+" "+this.getAttribute("uri")+"\r\n"})),e.find('>transport[xmlns="urn:xmpp:jingle:transports:ice-udp:1"]>candidate').each((function(){t+=SDPUtil.candidateFromJingle(this)})),n=e.find('description>source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]'),n.each((function(){const e=this.getAttribute("ssrc");$(this).find(">parameter").each((function(){this.getAttribute("name")&&this.getAttribute("name").length&&this.getAttribute("value")&&this.getAttribute("value").length&&(t+="a=ssrc:"+e+" "+this.getAttribute("name")+":"+this.getAttribute("value")),t+="\r\n"}))})),n=e.find('description>ssrc-group[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]'),n.each((function(){const e=this.getAttribute("semantics");t+="a=ssrc-group:"+e,$(this).find(">source").each((function(){t+=" "+this.getAttribute("ssrc")})),t+="\r\n"})),t},window.SDPUtil={iceparams:function(e,t){let i=null;return SDPUtil.find_line(e,"a=ice-ufrag:",t)&&SDPUtil.find_line(e,"a=ice-pwd:",t)&&(i={ufrag:SDPUtil.parse_iceufrag(SDPUtil.find_line(e,"a=ice-ufrag:",t)),pwd:SDPUtil.parse_icepwd(SDPUtil.find_line(e,"a=ice-pwd:",t))}),i},parse_iceufrag:function(e){return e.substring(12)},build_iceufrag:function(e){return"a=ice-ufrag:"+e},parse_icepwd:function(e){return e.substring(10)},build_icepwd:function(e){return"a=ice-pwd:"+e},parse_mid:function(e){return e.substring(6)},parse_mline:function(e){const t=e.substring(2).split(" "),i={};return i.media=t.shift(),i.port=t.shift(),i.proto=t.shift(),""===t[t.length-1]&&t.pop(),i.fmt=t,i},build_mline:function(e){return"m="+e.media+" "+e.port+" "+e.proto+" "+e.fmt.join(" ")},parse_rtpmap:function(e){let t=e.substring(9).split(" ");const i={};return i.id=t.shift(),t=t[0].split("/"),i.name=t.shift(),i.clockrate=t.shift(),i.channels=t.length?t.shift():"1",i},build_rtpmap:function(e){let t="a=rtpmap:"+e.getAttribute("id")+" "+e.getAttribute("name")+"/"+e.getAttribute("clockrate");return e.getAttribute("channels")&&"1"!=e.getAttribute("channels")&&(t+="/"+e.getAttribute("channels")),t},parse_simulcast:function(e){const t=e.substr(13).split(" "),i={};return i.direction=t.shift(),i.rid=t.shift().substr(4),i},parse_crypto:function(e){const t=e.substring(9).split(" "),i={};return i.tag=t.shift(),i["crypto-suite"]=t.shift(),i["key-params"]=t.shift(),t.length&&(i["session-params"]=t.join(" ")),i},parse_fingerprint:function(e){const t=e.substring(14).split(" "),i={};return i.hash=t.shift(),i.fingerprint=t.shift(),i},parse_fmtp:function(e){let t,i,r,n=e.split(" ");const s=[];for(n.shift(),n=n.join(" ").split(";"),t=0;t<n.length;t++){for(i=n[t].split("=")[0];i.length&&" "==i[0];)i=i.substring(1);r=n[t].split("=")[1],i&&r?s.push({name:i,value:r}):i&&s.push({name:"",value:i})}return s},parse_icecandidate:function(e){console.log("[Strophe.jingle] jingle.sdp.parse_icecandidate "+e);const t={},i=e.split(" ");t.foundation=i[0].substring(12),t.component=i[1],t.protocol=i[2].toLowerCase(),t.priority=i[3],t.ip=i[4],t.port=i[5],t.type=i[7],t.generation=0;for(let r=8;r<i.length;r+=2)switch(i[r]){case"raddr":t["rel-addr"]=i[r+1];break;case"rport":t["rel-port"]=i[r+1];break;case"generation":t.generation=i[r+1];break;case"tcptype":t.tcptype=i[r+1]}return t.network="1",t.id=Math.random().toString(36).substr(2,10),t},build_icecandidate:function(e){let t=["a=candidate:"+e.foundation,e.component,e.protocol,e.priority,e.ip,e.port,"typ",e.type].join(" ");switch(t+=" ",e.type){case"srflx":case"prflx":case"relay":e.hasOwnAttribute("rel-addr")&&e.hasOwnAttribute("rel-port")&&(t+="raddr",t+=" ",t+=e["rel-addr"],t+=" ",t+="rport",t+=" ",t+=e["rel-port"],t+=" ")}return e.hasOwnAttribute("tcptype")&&(t+="tcptype",t+=" ",t+=e.tcptype,t+=" "),t+="generation",t+=" ",t+=e.hasOwnAttribute("generation")?e.generation:"0",console.log("[Strophe.jingle] jingle.sdp.build_icecandidate "+t),t},parse_ssrc:function(e){const t=e.split("\r\n"),i={};for(let r=0;r<t.length;r++)if("a=ssrc:"==t[r].substring(0,7)){const e=t[r].indexOf(" ");i[t[r].substr(e+1).split(":",2)[0]]=t[r].substr(e+1).split(":",2)[1]}return i},parse_rtcpfb:function(e){const t=e.substr(10).split(" "),i={};return i.pt=t.shift(),i.type=t.shift(),i.params=t,i},parse_extmap:function(e){const t=e.substr(9).split(" "),i={};return i.value=t.shift(),-1!=i.value.indexOf("/")?(i.direction=i.value.substr(i.value.indexOf("/")+1),i.value=i.value.substr(0,i.value.indexOf("/"))):i.direction="both",i.uri=t.shift(),i.params=t,i},find_line:function(e,t,i){let r=e.split("\r\n");for(let n=0;n<r.length;n++)if(r[n].substring(0,t.length)==t)return r[n];if(!i)return false;r=i.split("\r\n");for(let n=0;n<r.length;n++)if(r[n].substring(0,t.length)==t)return r[n];return false},find_lines:function(e,t,i){let r=e.split("\r\n");const n=[];for(let s=0;s<r.length;s++)r[s].substring(0,t.length)==t&&n.push(r[s]);if(n.length||!i)return n;r=i.split("\r\n");for(let s=0;s<r.length;s++)r[s].substring(0,t.length)==t&&n.push(r[s]);return n},candidateToJingle:function(e){if(console.log("[Strophe.jingle] !!! jingle.sdp.candidateToJingle "+e),0===e.indexOf("candidate:"))e="a="+e;else if("a=candidate:"!=e.substring(0,12))return console.log("[Strophe.jingle] parseCandidate called with a line that is not a candidate line"),console.log("[Strophe.jingle] "+e),null;"\r\n"==e.substring(e.length-2)&&(e=e.substring(0,e.length-2));const t={},i=e.split(" ");let r;if("typ"!=i[6])return console.log("[Strophe.jingle] did not find typ in the right place"),console.log("[Strophe.jingle] "+e),null;for(t.foundation=i[0].substring(12),t.component=i[1],t.protocol=i[2].toLowerCase(),t.priority=i[3],t.ip=i[4],t.port=i[5],t.type=i[7],t.generation="0",r=8;r<i.length;r+=2)switch(i[r]){case"raddr":t["rel-addr"]=i[r+1];break;case"rport":t["rel-port"]=i[r+1];break;case"generation":t.generation=i[r+1];break;case"tcptype":t.tcptype=i[r+1];break;case"network-cost":t.cost=i[r+1];break;case"network-id":t.network=i[r+1];break;default:console.log('[Strophe.jingle] not translating "'+i[r]+'" = "'+i[r+1]+'"')}return t.id=Math.random().toString(36).substr(2,10),t},candidateFromJingle:function(e,t,i){const r=["a=candidate:"+e.getAttribute("foundation"),e.getAttribute("component"),e.getAttribute("protocol"),e.getAttribute("priority"),e.getAttribute("ip"),e.getAttribute("port"),"typ",e.getAttribute("type")];switch(e.getAttribute("type")){case"srflx":case"prflx":case"relay":e.getAttribute("rel-addr")&&e.getAttribute("rel-port")&&(r.push("raddr"),r.push(e.getAttribute("rel-addr")),r.push("rport"),r.push(e.getAttribute("rel-port")))}return r.push("generation"),r.push(e.getAttribute("generation")||"0"),e.getAttribute("network")&&(r.push("network-id"),r.push(e.getAttribute("network"))),e.getAttribute("cost")&&(r.push("network-cost"),r.push(e.getAttribute("cost"))),t&&(r.push("ufrag"),r.push(t)),i&&(r.push("pwd"),r.push(i)),r.join(" ")+"\r\n"}}},function(e,t){window.JingleSession=function(e,t,i,r){this.me=e,this.sid=t,this.connection=i,this.initiator=null,this.responder=null,this.isInitiator=null,this.peerjid=null,this.state=null,this.peerconnection=null,this.remoteStream=null,this.localSDP=null,this.remoteSDP=null,this.localStreams=[],this.localTransceivers=[],this.remoteStreams=[],this.remoteStreamsObject={},this.media_constraints=null,this.pc_constraints=null,this.ice_config={},this.company_config={},this.hadstuncandidate=false,this.hadturncandidate=false,this.hqEncodingEnabled=true,this.statsinterval=null,this.reason=null,this.addssrc=[],this.removessrc=[],this.pendingop=null,this.wait=true,this.isRenegotiating=false,this.remoteType=null,this.localType=null,this.videoSender=null,this.simulcastSettings={high:13e5,medium:4e5,low:15e4},this.bandwidthLimitSettings={video:1200,sharing:1500},this.jingleIqTimeout=15e3,r&&(this.jingleIqTimeout=r),this.conference_id=-1,this.calledNumber=null,this.DTX=false,this.hasSentTransportReplace=false,this.iceFilterList=[],this.onHold=false,this.logger=null,this.isEchoTest=false,this.transceiverStats={framesReceivedDelta:-1,framesReceivedDeltaErrorCount:0,lastPacketLostValue:0},this.transceiverStatsframesReceivedDeltaErrorCount=0,this.transceiverStatsPacketLostErrorCount=0,this.transceiverStatsPacketLostOKCount=0,this.qualityLimitation=false,this.reconnectionOptions=null,this.sendIceCandidatesPromise=null,this.replaceSid=""},JingleSession.prototype.initiate=function(e,t,i){const r=this;if(r.logger.log("[Strophe.jingle] initiate"),null!==this.state)return void r.logger.log("[Strophe.jingle] attempt to initiate on session "+this.sid+"in state "+this.state);this.isInitiator=t,this.initiator=t?this.me:e,this.responder=t?e:this.me,this.peerjid=e;const n={optional:[{googScreencastMinBitrate:100},{googCpuOveruseDetection:true}]};this.ice_config.sdpSemantics="unified-plan",r.logger.log("[Strophe.jingle] SDP activated: "+this.ice_config.sdpSemantics),this.ice_config.enableDSCP&&(r.logger.log("[Strophe.jingle] googDscp activated"),n.optional.push({googDscp:true})),this.ice_config.dtx&&(r.logger.log("[Strophe.jingle] Discontinuous Transmission (DTX) activated"),this.DTX=true),this.company_config&&(this.company_config.negotiation&&this.company_config.negotiation.iceFiltering&&(this.iceFilterList=this.company_config.negotiation.iceFiltering.length?this.company_config.negotiation.iceFiltering:[]),this.company_config.videoExt&&(this.company_config.videoExt.simulcastProfileBandwidth&&(this.simulcastSettings.low=this.company_config.videoExt.simulcastProfileBandwidth.low?this.company_config.videoExt.simulcastProfileBandwidth.low:this.simulcastSettings.low,this.simulcastSettings.medium=this.company_config.videoExt.simulcastProfileBandwidth.medium?this.company_config.videoExt.simulcastProfileBandwidth.medium:this.simulcastSettings.medium,this.simulcastSettings.high=this.company_config.videoExt.simulcastProfileBandwidth.high?this.company_config.videoExt.simulcastProfileBandwidth.high:this.simulcastSettings.high),this.bandwidthLimitSettings.video=this.company_config.videoExt.maxBandwidth?this.company_config.videoExt.maxBandwidth:this.bandwidthLimitSettings.video),this.company_config.sharingExt&&(this.bandwidthLimitSettings.sharing=this.company_config.sharingExt.maxBandwidth?this.company_config.sharingExt.maxBandwidth:this.bandwidthLimitSettings.sharing));try{this.peerconnection=new window.RTCPeerConnection(this.ice_config,n)}catch(s){r.logger.log("[Strophe.jingle] Failed to create PeerConnection, exception: ",s.message),r.logger.log(s);try{this.peerconnection=new window.RTCPeerConnection,this.peerconnection.setConfiguration&&this.peerconnection.setConfiguration(this.ice_config)}catch(o){return r.logger.log("[Strophe.jingle] Failed to create PeerConnection, exception: ",s.message),void r.logger.log(o)}}this.sendIceCandidatesPromise=new Promise((e=>{setTimeout((()=>{e(),this.sendIceCandidatesPromise=null}),500)})),this.peerconnection.onicecandidate=function(e){r&&!r.isRenegotiating?r.sendIceCandidatesPromise?(r.logger.log("[Strophe.jingle] onicecandidate on standby..."),r.sendIceCandidatesPromise.then((()=>{r.sendIceCandidate(e.candidate)}))):r.sendIceCandidate(e.candidate):r.logger.log("[Strophe.jingle] onicecandidate not added due to renegotiation")},this.peerconnection.onicecandidateerror=function(e){e&&(e.errorCode>=300&&e.errorCode<=699?r.logger.debug("[Strophe.jingle] onicecandidateerror -- TURN/STUN error received : ".concat(e.address," ").concat(e.port," ").concat(e.errorCode," ").concat(e.url," ").concat(e.errorText)):e.errorCode>=700&&e.errorCode<=799&&r.logger.debug("[Strophe.jingle] onicecandidateerror -- Server could not be reached error received : ".concat(e.address," ").concat(e.port," ").concat(e.errorCode," ").concat(e.url," ").concat(e.errorText)))},this.peerconnection.ontrack=function(e){r.conference_id&&-1!==r.conference_id?r.createRemoteStreamForConference(e.transceiver):r.createOrUpdateRemoteStreams(e.transceiver)},this.peerconnection.onremovetrack=function(e){r.logger.log("[Strophe.jingle] peer.onremovetrack")},this.peerconnection.onremovestream=function(e){r.logger.log("[Strophe.jingle] peer.onremovestream"),r.connection.jingle.rxSubject.next({name:"remotestreamremoved.jingle",data:{sid:r.sid}})},this.peerconnection.onsignalingstatechange=function(){r&&r.peerconnection&&($(document).trigger("iceconnectionstatechange.jingle",[r.sid,r]),r.connection.jingle.rxSubject.next({name:"iceconnectionstatechange.jingle",data:{sid:r.sid,session:r}}))},this.peerconnection.onconnectionstatechange=()=>{this&&this.peerconnection&&(this.logger.debug("[Strophe.jingle] onconnectionstatechange for session ".concat(this.sid," -- ").concat(this.peerconnection.connectionState)),r.connection.jingle.rxSubject.next({name:"iceconnectionstatechange.jingle",data:{sid:r.sid,session:r}}))},adapter&&adapter.default&&"firefox"===adapter.default.browserDetails.browser&&(this.peerconnection.oniceconnectionstatechange=function(){r&&r.peerconnection&&($(document).trigger("iceconnectionstatechange.jingle",[r.sid,r]),r.connection.jingle.rxSubject.next({name:"iceconnectionstatechange.jingle",data:{sid:r.sid,session:r}}))}),!this.localStreams.length&&-1!==this.conference_id&&this.conference_id&&(this.localTransceivers[0]||(this.localTransceivers[0]=r.peerconnection.addTransceiver("audio"),this.localTransceivers[0].direction="recvonly")),false!==i&&this.localStreams.forEach((function(e){r.addStream(e)}))},JingleSession.prototype.createRemoteStreamForConference=function(e){let t=this.remoteStreamsObject[0];t||(t=this.remoteStreamsObject[0]=new MediaStream);let i=null;"audio"===e.receiver.track.kind&&(i=t.getAudioTracks()[0]),"video"===e.receiver.track.kind&&(i=t.getVideoTracks()[0]),i&&t.removeTrack(i),t.addTrack(e.receiver.track);const r={audio:void 0!==t.getAudioTracks()[0],video:void 0!==t.getVideoTracks()[0]};this.connection.jingle.rxSubject.next({name:"jingleUpdateStream",data:{sid:this.sid,medias:r,confId:this.conference_id}})},JingleSession.prototype.createOrUpdateRemoteStreams=function(e){let t=parseInt(e.mid,10);isNaN(t)&&(t=0);const i=new MediaStream;this.remoteStreamsObject[t]?(this.remoteStreamsObject[t].removeTrack(this.remoteStreamsObject[t].getTracks()[0]),this.remoteStreamsObject[t].addTrack(e.receiver.track)):(i.addTrack(e.receiver.track),this.remoteStreamsObject[t]=i),this.connection.jingle.rxSubject.next({name:"jingleP2PUpdateStream",data:{sid:this.sid}})},JingleSession.prototype.updateRemoteStreams=function(){const e=this;this.localTransceivers.forEach((function(t){t.currentDirection&&"sendonly"!==t.currentDirection&&"inactive"!==t.currentDirection||(e.remoteStreamsObject[t.mid]=null)}))},JingleSession.prototype.replaceVideoTrack=function(e){this.localTransceivers[1]&&(this.localTransceivers[1].sender.replaceTrack(e),this.localTransceivers[1].direction="sendonly")},JingleSession.prototype.replaceTransceiverTrack=function(e,t){return new Promise(((i,r)=>{try{t||(t=0),this.localTransceivers[t]&&this.localTransceivers[t].sender.replaceTrack(e).then((()=>{i()})).catch((()=>{r()}))}catch(n){r()}}))},JingleSession.prototype.addBundleStream=function(e){return(async e=>{try{this.logger.log("[Strophe.jingle.session] addBundleStream"),this.localTransceivers[0]||(this.localTransceivers[0]=this.peerconnection.addTransceiver("audio")),this.localTransceivers[1]||(this.localTransceivers[1]=this.peerconnection.addTransceiver("video",{sendEncodings:[{rid:"l",active:true,maxBitrate:this.simulcastSettings.low,scaleResolutionDownBy:4},{rid:"m",active:true,maxBitrate:this.simulcastSettings.medium,scaleResolutionDownBy:2},{rid:"h",active:true,maxBitrate:this.simulcastSettings.high}]})),await this.localTransceivers[0].sender.replaceTrack(e.getAudioTracks()[0]),this.localTransceivers[0].direction="sendonly";const t=this.localTransceivers[1].sender,i=e.getVideoTracks()[0]?e.getVideoTracks()[0]:null;await t.replaceTrack(i),await this.enableHQEncoding(true),this.localTransceivers[1].direction=i?"sendonly":"inactive"}catch(t){throw this.logger.error("[Strophe.jingle.session] addBundleStream"+t.message),t}})(e)},JingleSession.prototype.addStream=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this;if(i.conference_id&&-1!==i.conference_id){if(t||"audio+video"===i.localType)return void i.addBundleStream(e);if("sharing"===i.localType)i.localTransceivers[0]=i.peerconnection.addTransceiver("video"),i.localTransceivers[0].sender.replaceTrack(e.getVideoTracks()[0]),i.localTransceivers[0].direction="sendonly",e.getAudioTracks().length&&(i.localTransceivers[1]=i.peerconnection.addTransceiver("audio"),i.localTransceivers[1].sender.replaceTrack(e.getAudioTracks()[0]),i.localTransceivers[1].direction="sendonly");else{const t=e.getAudioTracks().length?"audio":"video";i.localTransceivers[0]||(i.ice_config.simulcast&&adapter&&adapter.default&&"chrome"===adapter.default.browserDetails.browser&&adapter.default.browserDetails.version>=70&&"video"===t&&"video"===i.localType?(i.logger.log("[Strophe.jingle] Enabling Simulcasting for Chrome (via transceiver configuration)"),i.localTransceivers[0]=i.peerconnection.addTransceiver(t,{sendEncodings:[{rid:"l",active:true,maxBitrate:i.simulcastSettings.low,scaleResolutionDownBy:4},{rid:"m",active:true,maxBitrate:i.simulcastSettings.medium,scaleResolutionDownBy:2},{rid:"h",active:true,maxBitrate:i.simulcastSettings.high}]})):i.localTransceivers[0]=i.peerconnection.addTransceiver(t)),i.localTransceivers[0].sender.replaceTrack("audio"===t?e.getAudioTracks()[0]:e.getVideoTracks()[0]),i.localTransceivers[0].direction="audio"===t?"sendrecv":"sendonly"}}else e.getAudioTracks().length>0&&(i.localTransceivers[0]||(i.localTransceivers[0]=i.peerconnection.addTransceiver("audio")),i.localTransceivers[0].sender.replaceTrack(e.getAudioTracks()[0]),i.localTransceivers[0].direction="sendrecv"),e.getVideoTracks().length>0&&e.getAudioTracks().length>0&&(i.localTransceivers[0]||(i.localTransceivers[0]=i.peerconnection.addTransceiver("audio",{direction:"recvonly"})),i.localTransceivers[1]||(i.localTransceivers[1]=i.peerconnection.addTransceiver("video")),i.localTransceivers[1].sender.replaceTrack(e.getVideoTracks()[0]),i.localTransceivers[1].direction="sendrecv"),e.getVideoTracks().length>0&&!e.getAudioTracks().length&&(i.localTransceivers[0]||(i.localTransceivers[0]=i.peerconnection.addTransceiver("audio",{direction:"recvonly"})),i.localTransceivers[1]||i.localTransceivers.push(i.peerconnection.addTransceiver("video",{direction:"recvonly"})),"videoOnly"===i.localType?(i.localTransceivers[1].sender.replaceTrack(e.getVideoTracks()[0]),i.localTransceivers[1].direction="sendrecv"):(i.localTransceivers[2]||i.localTransceivers.push(i.peerconnection.addTransceiver("video")),i.localTransceivers[2].sender.replaceTrack(e.getVideoTracks()[0]),i.localTransceivers[2].direction="sendrecv"))},JingleSession.prototype.removeStream=function(e,t){this.logger.log("[Strophe.jingle] removeStream API"),this.peerconnection.getTransceivers().forEach((function(e){e.sender.replaceTrack(null),e.direction="recvonly"})),this.localTransceivers=this.peerconnection.getTransceivers()},JingleSession.prototype.accept=function(){try{const e=this;this.state="active";let t=this.peerconnection.localDescription;if(!t||"pranswer"!=t.type)return;for(e.logger.log("[Strophe.jingle] going from pranswer to answer");SDPUtil.find_line(t.sdp,"a=inactive");)t.sdp=t.sdp.replace("a=inactive","a=sendrecv");t=this.hackMsLabelSDP(t);const i=new SDP(t.sdp),r=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-accept",initiator:this.initiator,responder:this.responder,sid:this.sid,localType:this.localType});i.toJingle(r,this.initiator==this.me?"initiator":"responder",this.conference_id,this.bandwidthLimitSettings),this.connection.sendIQ(r,(function(){const t={source:"answer"};$(document).trigger("ack.jingle",[e.sid,t]),e.connection.jingle.rxSubject.next({name:"ack.jingle",data:{sid:e.sid,ack:t}})}),(function(t){const i=$(t).find("error").length?{code:$(t).find("error").attr("code"),reason:$(t).find("error :first")[0].tagName}:{};i.source="answer",$(document).trigger("error.jingle",{sid:e.sid,error:i}),e.connection.jingle.rxSubject.next({name:"error.jingle",data:{sid:e.sid,error:i}})}),this.jingleIqTimeout);let n=this.peerconnection.localDescription.sdp;for(;SDPUtil.find_line(n,"a=inactive");)n=n.replace("a=inactive","a=sendrecv");this.peerconnection.setLocalDescription(new window.RTCSessionDescription({type:"answer",sdp:n}),(function(){$(document).trigger("setLocalDescription.jingle",[e.sid]),e.connection.jingle.rxSubject.next({name:"setLocalDescription.jingle",data:{sid:e.sid}}),e.logger.log("[Strophe.jingle] setLocalDescription success, try to update the RTP Sender "),e.ice_config.enableDSCP&&e.peerconnection.getSenders().forEach((function(t){if(t.getParameters&&t.setParameters){const i=t.getParameters();i.encodings.forEach((function(e){e.priority="high",e.networkPriority="high"})),t.setParameters(i),e.logger.log("[Strophe.jingle] RTP Sender parameters are updated "+t.getParameters())}}))}),(function(t){const i=t&&t.toString?t.toString():t;e.logger.error("[Strophe.jingle] JingleSession.prototype.accept -- setLocalDescription failed -- "+i)}))}catch(e){self.logger.log("[Strophe.jingle] JingleSession.prototype.accept failed: "+e)}},JingleSession.prototype.terminate=function(e){if(this.state="ended",this.reason=e,this.peerconnection&&"closed"!==this.peerconnection.signalingState&&this.peerconnection.close(),this.peerconnection&&(this.peerconnection.onicecandidate=null,this.peerconnection.onconnectionstatechange=null,this.peerconnection.onicecandidateerror=null,this.peerconnection.onsignalingstatechange=null,this.peerconnection.oniceconnectionstatechange=null,this.peerconnection.onremovetrack=null,this.peerconnection.onaddstream=null,this.peerconnection.onaddtrack=null,this.peerconnection.ontrack=null,this.peerconnection.onremovestream=null),this.logger.log("[Strophe.jingle] Clear peerconnection"),this.peerconnection=null,null!==this.statsinterval&&(window.clearInterval(this.statsinterval),this.statsinterval=null),this.localStreams&&this.localStreams.length)for(;this.localStreams.length;){let e=this.localStreams.pop();e.getTracks().forEach((function(e){e.enabled=false,e.stop(),e=null})),e.stop&&e.stop(),e=null}if(this.localTransceivers&&this.localTransceivers.length)for(;this.localTransceivers.length;){let e=this.localTransceivers.pop();e&&e.sender&&e.sender.track&&e.sender.track.stop&&e.sender.track.stop(),e&&e.receiver&&e.receiver.track&&e.receiver.track.stop&&e.receiver.track.stop(),e=null}Object.keys(this.remoteStreamsObject).forEach((e=>{this.remoteStreamsObject[e]&&(this.remoteStreamsObject[e].getTracks().forEach((function(e){e.enabled=false,e.stop(),e=null})),this.remoteStreamsObject[e]=null)})),this.remoteStreamsObject={},this.localTransceivers=[],this.transceiverStats={}},JingleSession.prototype.active=function(){return"active"==this.state},JingleSession.prototype.sendIceCandidate=function(e){const t=this;if(e&&t.iceFilterList&&t.iceFilterList.length&&-1!==t.iceFilterList.indexOf(e.type))t.logger.log("[Strophe.jingle] ICE candidate "+e.type+" is filtered");else if(e){const i=SDPUtil.iceparams(this.localSDP.media[e.sdpMLineIndex],this.localSDP.session),r=SDPUtil.candidateToJingle(e.candidate);if(!i||!r)return void t.logger.log("[Strophe.jingle] failed to get ice && jcand");i.xmlns="urn:xmpp:jingle:transports:ice-udp:1",t.logger.log("[Strophe.jingle] sending single candidate"),t.isRenegotiating?t.logger.log("[Strophe.jingle] NOT sending candidate due to Renegotiation"):t.sendIceCandidates([e])}},JingleSession.prototype.sendIceCandidates=function(e){const t=this;try{const r=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"transport-info",initiator:this.initiator,sid:this.sid,localType:this.localType});for(var i=0;i<this.localSDP.media.length;i++){const t=e.filter((function(e){return e.sdpMLineIndex==i})),n=SDPUtil.parse_mline(this.localSDP.media[i].split("\r\n")[0]);if(t.length>0){const e=SDPUtil.iceparams(this.localSDP.media[i],this.localSDP.session);e.xmlns="urn:xmpp:jingle:transports:ice-udp:1",r.c("content",{creator:this.initiator==this.me?"initiator":"responder",name:t[0].sdpMid?t[0].sdpMid:n.media}).c("transport",e);for(let i=0;i<t.length;i++)r.c("candidate",SDPUtil.candidateToJingle(t[i].candidate)).up();if(SDPUtil.find_line(this.localSDP.media[i],"a=fingerprint:",this.localSDP.session)){const e=SDPUtil.parse_fingerprint(SDPUtil.find_line(this.localSDP.media[i],"a=fingerprint:",this.localSDP.session));e.required=true,e.xmlns="urn:xmpp:jingle:apps:dtls:0",r.c("fingerprint").t(e.fingerprint),delete e.fingerprint,r.attrs(e),r.up()}r.up(),r.up()}}if(config.turnOn&&!(r.node.innerHTML.indexOf('type="relay')>-1))return void t.logger.log("[Strophe.jingle] Debug flag turnOn : Ignore candidate");this.connection.sendIQ(r,(function(){const e={source:"transportinfo"};$(document).trigger("ack.jingle",[t.sid,e]),t.connection.jingle.rxSubject.next({name:"ack.jingle",data:{sid:t.sid,ack:e}})}),(function(e){const i=$(e).find("error").length?{code:$(e).find("error").attr("code"),reason:$(e).find("error :first")[0].tagName}:{};i.source="transportinfo",$(document).trigger("error.jingle",{sid:t.sid,error:i}),t.connection.jingle.rxSubject.next({name:"error.jingle",data:{sid:t.sid,error:i}})}),this.jingleIqTimeout)}catch(r){t.logger.log("[Strophe.jingle] JingleSession.prototype.sendIceCandidates failed: "+r)}},JingleSession.prototype.hackOfferSDP=function(e){return"firefox"!==adapter.default.browserDetails.browser&&(e.sdp=e.sdp.replace(/a=sendonly/g,"a=sendrecv")),!this.conference_id||-1===this.conference_id||"video"!==this.localType&&"sharing"!==this.localType||(e.sdp=e.sdp.replace(/a=sendrecv/g,"a=sendonly")),this.conference_id&&-1!==this.conference_id&&"audio+video"===this.localType&&(e.sdp=e.sdp.replace(/a=sendrecv/g,"a=sendonly")),navigator.platform.toUpperCase().indexOf("MAC")>=0&&(e.sdp=this.forceCodecTo(e.sdp,"H264/90000","video")),this.conference_id&&-1!==this.conference_id||"firefox"!==adapter.default.browserDetails.browser||(e.sdp=this.removeSsrcGroupFidForFirefox(e.sdp)),e},JingleSession.prototype.hackMsLabelSDP=function(e){try{const t=e.sdp.split("\r\n");for(let e=0;e<t.length;e++)if("a=ssrc:"==t[e].substring(0,7)){const i=t[e].indexOf(" ");!t[e].substr(i+1).split(":",2)[0]||void 0!==t[e].substr(i+1).split(":",2)[1]&&""!==t[e].substr(i+1).split(":",2)[1]||t.splice(e,1)}return e.sdp=t.join("\r\n"),e}catch(t){return e}},JingleSession.prototype.sendTransportReplace=function(){const e=this;e.logger.log("[Strophe.jingle] sendTransportReplace");const t={iceRestart:true};e.isReconnecting?e.logger.log("[Strophe.jingle] sendTransportReplace ignored because we're already connecting"):(e.isReconnecting=true,this.peerconnection.createOffer((function(t){e.createdOffer(t,"transport-replace")}),(function(t){e.logger.log("[Strophe.jingle] createOffer failed",t)}),t))},JingleSession.prototype.reconnectSession=function(){const e=this;e.logger.log("[Strophe.jingle] reconnectSession");let t={iceRestart:true},i=false;if(e.isReconnecting)e.logger.log("[Strophe.jingle] reconnectSession ignored because we're already connecting");else{if(e.isReconnecting=true,e.hasSentTransportReplace=true,e.reconnectionOptions&&(t=e.reconnectionOptions),-1!==e.peerjid.indexOf("mp_rvcp"))if("plan-b"===e.ice_config.sdpSemantics){e.checkIfRemoteSdpHasSendonlyAudioMedia(e.remoteSDP.raw)&&(e.removeStream(e.localStreams[0]),i=true)}else"recvonly"===e.localTransceivers[0].currentDirection&&(e.localTransceivers[0].direction="recvonly");this.peerconnection.createOffer((function(t){e.sendCreatedOfferWithAckWait(t,"transport-replace"),i&&e.peerconnection.addStream(e.localStreams[0])}),(function(t){e.logger.log("[Strophe.jingle] createOffer failed",t)}),t)}},JingleSession.prototype.saveIncomingTransportReplace=function(e,t,i){this.logger.log("[Strophe.jingle] saveIncomingTransportReplace"),this.savedIncomingTransportReplace={elem:e,desctype:t,ack:i}},JingleSession.prototype.acceptSavedIncomingTransportReplace=function(){this.logger.log("[Strophe.jingle] acceptSavedIncomingTransportReplace"),this.connection.send(this.savedIncomingTransportReplace.ack),this.setRemoteDescription(this.savedIncomingTransportReplace.elem,this.savedIncomingTransportReplace.desctype),this.connection.jingle.rxSubject.next({name:"transportreplace.jingle",data:{sid:this.sid}}),this.savedIncomingTransportReplace=null},JingleSession.prototype.rejectSavedIncomingTransportReplace=function(){if(this.logger.log("[Strophe.jingle] rejectSavedIncomingTransportReplace"),this.savedIncomingTransportReplace&&this.savedIncomingTransportReplace.ack){const e=this.savedIncomingTransportReplace.ack;e.type="error",e.c("error",{type:"reject"}),this.connection.send(e)}this.savedIncomingTransportReplace=null},JingleSession.prototype.sendCreatedOfferWithAckWait=function(e,t){try{e=this.hackMsLabelSDP(e);const i=this;this.localSDP=new SDP(e.sdp);const r=t||"session-initiate";i.logger.log("[Strophe.jingle] sendCreatedOfferWithAckWait with SDP : "+e.sdp+" and action : "+r);let n=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:r,initiator:this.initiator,sid:this.sid,localType:this.localType});this.calledNumber&&""!==this.calledNumber&&(n=n.c("mediapillar",{xmlns:"urn:xmpp:janus:1"}).c("callednumber").t(this.calledNumber),n.up(),n.up()),this.localSDP.toJingle(n,this.initiator==this.me?"initiator":"responder",this.conference_id,this.bandwidthLimitSettings),this.createdOfferTimeout=setTimeout((()=>{this.logger.log("[Strophe.jingle] sendCreatedOfferWithAckWait -- timeout expires -- reset all"),this.hasSentTransportReplace=false,this.savedIncomingTransportReplace?this.acceptSavedIncomingTransportReplace():this.isReconnecting=false}),this.jingleIqTimeout+1e3),this.connection.sendIQ(n,(function(t){if(i.createdOfferTimeout&&(clearTimeout(i.createdOfferTimeout),i.createdOfferTimeout=null),t&&$(t).find("error").length)return i.logger.log("[Strophe.jingle] sendCreatedOfferWithAckWait -- IQ ACK with error"),i.hasSentTransportReplace=false,void(i.savedIncomingTransportReplace&&i.acceptSavedIncomingTransportReplace());if(i.logger.log("[Strophe.jingle] sendCreatedOfferWithAckWait -- IQ ACK received, set local description"),i.hasSentTransportReplace=false,i.savedIncomingTransportReplace){if(!i.isInitiator)return void i.acceptSavedIncomingTransportReplace();i.rejectSavedIncomingTransportReplace()}e.sdp=i.localSDP.raw,i.peerconnection.setLocalDescription(e,(function(){$(document).trigger("setLocalDescription.jingle",[i.sid]),i.connection.jingle.rxSubject.next({name:"setLocalDescription.jingle",data:{sid:i.sid}}),i.logger.log("[Strophe.jingle] setLocalDescription success")}),(function(e){const t=e&&e.toString?e.toString():e;i.logger.error("[Strophe.jingle] sendCreatedOfferWithAckWait -- setLocalDescription failed -- "+t),i.logger.error(e)}))}),(function(){i.createdOfferTimeout&&(clearTimeout(this.createdOfferTimeout),i.createdOfferTimeout=null),i.logger.log("[Strophe.jingle] sendCreatedOfferWithAckWait -- IQ rejected"),i.hasSentTransportReplace=false,i.savedIncomingTransportReplace?i.acceptSavedIncomingTransportReplace():i.isReconnecting=false}),this.jingleIqTimeout)}catch(i){self.createdOfferTimeout&&(clearTimeout(this.createdOfferTimeout),self.createdOfferTimeout=null),self.logger.log("[Strophe.jingle] JingleSession.prototype.createdOffer failed: "+i)}},JingleSession.prototype.sendOffer=function(e){const t=this;if(t.logger.log("[Strophe.jingle] sendOffer"),e){t.logger.log("[Strophe.jingle] ice restart");const e={};if((-1===this.conference_id&&!this.calledNumber||"video"!==this.localType)&&(e.iceRestart=true),-1!==this.conference_id&&(e.iceRestart=true),this.ice_config.simulcast&&-1!==this.conference_id&&"video"===this.localType&&adapter&&adapter.default&&"firefox"===adapter.default.browserDetails.browser){t.logger.log("[Strophe.jingle] Enabling Simulcasting for Firefox (RID)");const e=this.peerconnection.getSenders().find((function(e){return"video"==e.track.kind}));if(e){let i=e.getParameters();i||(i={}),i.encodings=[{rid:"l",active:true,maxBitrate:t.simulcastSettings.low,scaleResolutionDownBy:4},{rid:"m",active:true,maxBitrate:t.simulcastSettings.medium,scaleResolutionDownBy:2},{rid:"h",active:true,maxBitrate:t.simulcastSettings.high}],e.setParameters(i)}}this.peerconnection.createOffer((function(e){t.createdOffer(e)}),(function(e){t.logger.log("[Strophe.jingle] createOffer failed "+e),t.logger.log(e)}),e)}else this.peerconnection.createOffer((function(e){t.createdOffer(e)}),(function(e){t.logger.log("[Strophe.jingle] createOffer failed "+e),t.logger.log(e)}),this.media_constraints)},JingleSession.prototype.createdOffer=function(e,t){try{const i=this;e=this.hackOfferSDP(e),e=this.hackMsLabelSDP(e),this.localSDP=new SDP(e.sdp);const r=t||"session-initiate";i.logger.log("[Strophe.jingle] createdOffer with SDP : "+e.sdp+" and action : "+r);let n=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:r,initiator:this.initiator,sid:this.sid,localType:this.localType});this.calledNumber&&""!==this.calledNumber&&(n=n.c("mediapillar",{xmlns:"urn:xmpp:janus:1"}).c("callednumber").t(this.calledNumber),n.up(),n.up()),this.isEchoTest&&(n=n.c("echotest",{xmlns:"urn:xmpp:janus:1"}),n.up()),this.replaceSid&&(n=n.c("replaces",{sid:this.replaceSid}),n.up()),this.localSDP.toJingle(n,this.initiator===this.me?"initiator":"responder",this.conference_id,this.bandwidthLimitSettings),this.connection.sendIQ(n,(function(){const e={source:"offer"};$(document).trigger("ack.jingle",[i.sid,e]),i.connection.jingle.rxSubject.next({name:"ack.jingle",data:{sid:i.sid,ack:e}})}),(function(e){i.state="error",i.peerconnection&&"closed"!==i.peerconnection.signalingState&&(i.logger.log("[Strophe.jingle] Clear peerconnection"),i.peerconnection.close(),i.peerconnection=null);const t=$(e).find("error").length?{code:$(e).find("error").attr("code"),reason:$(e).find("error :first")[0].tagName}:{};t.source="offer",$(document).trigger("error.jingle",{sid:i.sid,error:t}),i.connection.jingle.rxSubject.next({name:"error.jingle",data:{sid:i.sid,error:t}})}),this.jingleIqTimeout),e.sdp=this.localSDP.raw,this.peerconnection.setLocalDescription(e,(function(){$(document).trigger("setLocalDescription.jingle",[i.sid]),i.connection.jingle.rxSubject.next({name:"setLocalDescription.jingle",data:{sid:i.sid}}),i.logger.log("[Strophe.jingle] setLocalDescription success")}),(function(e){const t=e&&e.toString?e.toString():e;i.logger.error("[Strophe.jingle] createdOffer -- setLocalDescription failed -- "+t),i.logger.log("[Strophe.jingle] setLocalDescription failed "+e)}))}catch(i){self.logger.log("[Strophe.jingle] JingleSession.prototype.createdOffer failed: "+i)}},JingleSession.prototype.contentRemoveOld=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this;i.logger.log("[Strophe.jingle] contentRemove"),this.peerconnection.createOffer((function(r){i.contentUpdateOffer(r,e,"remove",t)}),(function(e){i.logger.log("[Strophe.jingle] contentRemove failed "+e),i.logger.log(e)}),this.media_constraints)},JingleSession.prototype.contentAdd=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(async(e,t)=>{try{this.logger.log("[Strophe.jingle] contentAdd");const i=await this.peerconnection.createOffer(this.media_constraints);this.contentUpdateOffer(i,e,"add",t)}catch(i){this.logger.log("[Strophe.jingle] contentAdd failed "+i.message)}})(e,t)},JingleSession.prototype.contentRemove=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(async(e,t)=>{try{this.logger.log("[Strophe.jingle] contentRemove");const i=await this.peerconnection.createOffer(this.media_constraints);this.contentUpdateOffer(i,e,"remove",t)}catch(i){this.logger.log("[Strophe.jingle] contentRemove failed "+i.message)}})(e,t)},JingleSession.prototype.contentModify=function(e,t){const i=this;i.logger.log("[Strophe.jingle] contentModify");let r=false;if(!t&&i.reconnectionOptions&&(t={offerToReceiveAudio:i.reconnectionOptions.offerToReceiveAudio}),t||(t={}),-1!==i.peerjid.indexOf("mp_rvcp"))if("plan-b"===i.ice_config.sdpSemantics){i.checkIfRemoteSdpHasSendonlyAudioMedia(i.remoteSDP.raw)&&(i.removeStream(i.localStreams[0]),r=true)}else"recvonly"===i.localTransceivers[0].currentDirection&&(i.localTransceivers[0].direction="recvonly");this.peerconnection.createOffer((function(t){i.contentUpdateOffer(t,e,"modify"),r&&i.peerconnection.addStream(i.localStreams[0])}),(function(e){i.logger.log("[Strophe.jingle] contentModify failed "+e),i.logger.error(e)}),t)},JingleSession.prototype.contentUpdateOffer=function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n=this;try{if(e=this.hackMsLabelSDP(e),n.conference_id&&-1!==n.conference_id||"firefox"!==adapter.default.browserDetails.browser||(e.sdp=this.removeSsrcGroupFidForFirefox(e.sdp)),n.logger.log("[Strophe.jingle] contentUpdateOffer: "+e.sdp),this.localSDP=new SDP(e.sdp),"audio"===t?n.localType="audio":"video"===t?n.localType="audio+video":"sharing"===t?n.localType="sharing":"sharing+video"===t&&(n.localType="sharing+video"),r)var s=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"content-"+i,initiator:this.initiator,sid:this.sid,mediaType:t,localType:n.localType});else s=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"content-"+i,initiator:this.initiator,sid:this.sid,mediaType:t});this.calledNumber&&""!==this.calledNumber&&((s=s.c("mediapillar",{xmlns:"urn:xmpp:janus:1"}).c("callednumber").t(this.calledNumber)).up(),s.up()),this.localSDP.toJingle(s,this.initiator==this.me?"initiator":"responder",this.conference_id,this.bandwidthLimitSettings),this.connection.sendIQ(s,(function(){const e={source:"offer"};$(document).trigger("ack.jingle",[n.sid,e]),n.connection.jingle.rxSubject.next({name:"ack.jingle",data:{sid:n.sid,ack:e}})}),(function(e){n.state="error",n.peerconnection&&(n.logger.log("[Strophe.jingle] Clear peerconnection"),n.peerconnection.close(),n.peerconnection=null);const t=$(e).find("error").length?{code:$(e).find("error").attr("code"),reason:$(e).find("error :first")[0].tagName}:{};t.source="offer",$(document).trigger("error.jingle",{sid:n.sid,error:t}),n.connection.jingle.rxSubject.next({name:"error.jingle",data:{sid:n.sid,error:t}})}),this.jingleIqTimeout),e.sdp=this.localSDP.raw,this.peerconnection.setLocalDescription(e,(function(){$(document).trigger("setLocalDescription.jingle",[n.sid]),n.connection.jingle.rxSubject.next({name:"setLocalDescription.jingle",data:{sid:n.sid}}),n.logger.log("[Strophe.jingle] setLocalDescription success")}),(function(e){const t=e&&e.toString?e.toString():e;n.logger.error("[Strophe.jingle] contentUpdateOffer -- setLocalDescription failed -- "+t),n.logger.error(e)}))}catch(o){n.logger.log("[Strophe.jingle] JingleSession.prototype.contentUpdateOffer failed: "+o)}},JingleSession.prototype.contentChangeAnswer=function(e,t){const i=this;try{i.logger.log("[Strophe.jingle] contentChangeAnswer: "+e.sdp),e=this.hackMsLabelSDP(e),i.conference_id&&-1!==i.conference_id||"firefox"!==adapter.default.browserDetails.browser||(e.sdp=this.removeSsrcGroupFidForFirefox(e.sdp)),this.localSDP=new SDP(e.sdp);let r=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"content-accept",initiator:this.initiator,sid:this.sid});this.calledNumber&&""!==this.calledNumber&&(r=r.c("mediapillar",{xmlns:"urn:xmpp:janus:1"}).c("callednumber").t(this.calledNumber),r.up(),r.up()),this.localSDP.toJingle(r,this.initiator==this.me?"initiator":"responder",this.conference_id,this.bandwidthLimitSettings),this.connection.sendIQ(r,(function(){const e={source:"offer"};$(document).trigger("ack.jingle",[i.sid,e]),i.connection.jingle.rxSubject.next({name:"ack.jingle",data:{sid:i.sid,ack:e}})}),(function(e){i.state="error",i.peerconnection&&(i.logger.log("[Strophe.jingle] Clear peerconnection"),i.peerconnection.close(),i.peerconnection=null);const t=$(e).find("error").length?{code:$(e).find("error").attr("code"),reason:$(e).find("error :first")[0].tagName}:{};t.source="offer",$(document).trigger("error.jingle",{sid:i.sid,error:t}),i.connection.jingle.rxSubject.next({name:"error.jingle",data:{sid:i.sid,error:t}})}),this.jingleIqTimeout),e.sdp=this.localSDP.raw,this.peerconnection.setLocalDescription(e,(function(){$(document).trigger("setLocalDescription.jingle",[i.sid]),i.connection.jingle.rxSubject.next({name:"setLocalDescription.jingle",data:{sid:i.sid}}),i.logger.log("[Strophe.jingle] setLocalDescription success"),t&&i.updateRemoteStreams()}),(function(e){const t=e&&e.toString?e.toString():e;i.logger.error("[Strophe.jingle] contentChangeAnswer -- setLocalDescription failed -- "+t),i.logger.error(e)}))}catch(r){i.logger.log("[Strophe.jingle] JingleSession.prototype.contentChangeAnswer failed: "+r)}},JingleSession.prototype.setRemoteDescription=function(e,t){const i=this;i.logger.log("[Strophe.jingle] setRemoteDescription "+t),this.remoteSDP=new SDP(""),this.remoteSDP.fromJingle(e),this.isInitiator?this.remoteSDP.raw=this.remoteSDP.raw.replace(/a=setup:passive/g,"a=setup:active"):this.remoteSDP.raw=this.remoteSDP.raw.replace(/a=setup:active/g,"a=setup:passive"),navigator.platform.toUpperCase().indexOf("MAC")>=0&&(this.remoteSDP.raw=this.forceCodecTo(this.remoteSDP.raw,"H264/90000","video")),this.DTX&&(i.logger.log("[Strophe.jingle] activate Discontinuous Transmission (DTX)"),this.remoteSDP.raw=this.remoteSDP.raw.replace("useinbandfec=1","useinbandfec=1;usedtx=1")),i.logger.log("[Strophe.jingle] setRemoteDescription after parsing for session "+this.sid+" : "+this.remoteSDP.raw);const r=new window.RTCSessionDescription({type:t,sdp:this.remoteSDP.raw});this.peerconnection.setRemoteDescription(r,(function(){i.logger.log("[Strophe.jingle] setRemoteDescription success"),i.localTransceivers=i.peerconnection.getTransceivers()}),(function(e){const t=e&&e.toString?e.toString():e;i.logger.error("[Strophe.jingle] setRemoteDescription -- setRemoteDescription failed -- "+t),i.logger.error(e)})),this.ice_config.enableDSCP&&(i.logger.log("[Strophe.jingle] setRemoteDescription is setting, try to update the RTP Sender "),this.peerconnection.getSenders().forEach((function(e){if(e.getParameters&&e.setParameters){const t=e.getParameters();t.encodings.forEach((function(e){e.priority="high",e.networkPriority="high"})),e.setParameters(t)}})))},JingleSession.prototype.addIceCandidate=function(e){const t=this;t.logger.log("[Strophe.jingle] addIceCandidate"),e.each((function(){let e,i=-1;for(e=0;e<t.remoteSDP.media.length;e++)if(SDPUtil.find_line(t.remoteSDP.media[e],"a=mid:"+$(this).attr("name"))||0===t.remoteSDP.media[e].indexOf("m="+$(this).attr("name"))){i=e;break}if(-1==i){for(e=0;e<t.localSDP.media.length;e++)if(SDPUtil.find_line(t.localSDP.media[e],"a=mid:"+$(this).attr("name"))||0===t.localSDP.media[e].indexOf("m="+$(this).attr("name"))){i=e;break}}const r=$(this).attr("name");let n,s;$(this).find("content>transport").each((function(){n=this.getAttribute("ufrag"),s=this.getAttribute("pwd")})),$(this).find("transport>candidate").each((function(){let e,o;e=SDPUtil.candidateFromJingle(this,n,s),o=new window.RTCIceCandidate({sdpMLineIndex:i,sdpMid:r,candidate:e});try{if(o&&t.iceFilterList&&t.iceFilterList.length&&-1!==t.iceFilterList.indexOf(o.type))return void t.logger.log("[Strophe.jingle] Received ICE candidate "+o.type+" is filtered");t.peerconnection.addIceCandidate(o)}catch(a){t.logger.error("[Strophe.jingle] addIceCandidate failed "+a.toString())}}))}))},JingleSession.prototype.sendAnswer=function(e,t){const i=this;i.logger.log("[Strophe.jingle] sendAnswer: "+e),this.peerconnection.createAnswer((function(r){i.createdAnswer(r,e,t)}),(function(e){i.logger.error("[Strophe.jingle] createAnswer failed: "+e)}),this.media_constraints)},JingleSession.prototype.createdAnswer=function(e,t,i){const r=this;try{r.logger.log("[Strophe.jingle] createdAnswer"),e=this.hackMsLabelSDP(e),r.conference_id&&-1!==r.conference_id||"firefox"!==adapter.default.browserDetails.browser||(e.sdp=this.removeSsrcGroupFidForFirefox(e.sdp)),this.localSDP=new SDP(e.sdp),this.usepranswer=true===t;const n=i||"session-accept";i&&(r.isReconnecting=false),r.logger.log("[Strophe.jingle] createdAnswer -- sdp is "+e.sdp);let s=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:n,initiator:this.initiator,responder:this.responder,sid:this.sid,localType:this.localType});this.calledNumber&&""!==this.calledNumber&&(s=s.c("mediapillar",{xmlns:"urn:xmpp:janus:1"}).c("callednumber").t(this.calledNumber),s.up(),s.up()),this.localSDP.toJingle(s,this.initiator==this.me?"initiator":"responder",this.conference_id,this.bandwidthLimitSettings),this.connection.sendIQ(s,(function(){const e={source:"answer"};$(document).trigger("ack.jingle",[r.sid,e]),r.connection.jingle.rxSubject.next({name:"ack.jingle",data:{sid:r.sid,ack:e}})}),(function(e){const t=$(e).find("error").length?{code:$(e).find("error").attr("code"),reason:$(e).find("error :first")[0].tagName}:{};t.source="answer",$(document).trigger("error.jingle",{sid:r.sid,error:t}),r.connection.jingle.rxSubject.next({name:"error.jingle",data:{sid:r.sid,error:t}})}),this.jingleIqTimeout),e.sdp=this.localSDP.raw,this.peerconnection.setLocalDescription(e,(function(){$(document).trigger("setLocalDescription.jingle",[r.sid]),r.connection.jingle.rxSubject.next({name:"setLocalDescription.jingle",data:{sid:r.sid}}),r.logger.log("[Strophe.jingle] createdAnswer -- setLocalDescription success, try to update the RTP Sender "),r.ice_config.enableDSCP&&r.peerconnection.getSenders().forEach((function(e){if(e.getParameters&&e.setParameters){const t=e.getParameters();t.encodings.forEach((function(e){e.priority="high",e.networkPriority="high"})),e.setParameters(t),r.logger.log("[Strophe.jingle] RTP Sender parameters are updated "+e.getParameters())}}))}),(function(e){const t=e&&e.toString?e.toString():e;r.logger.error("[Strophe.jingle] createdAnswer -- setLocalDescription failed -- "+t),r.logger.error(e)}));const o=SDPUtil.find_lines(this.localSDP.raw,"a=candidate:");for(let e=0;e<o.length;e++){const t=SDPUtil.parse_icecandidate(o[e]);"srflx"==t.type?this.hadstuncandidate=true:"relay"==t.type&&(this.hadturncandidate=true)}}catch(n){r.logger.error("[Strophe.jingle] JingleSession.prototype.createdAnswer failed: "+n)}},JingleSession.prototype.sendTerminate=function(e,t){const i=this;try{const r=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-terminate",initiator:this.initiator,sid:this.sid}).c("reason").c(e||"success");t&&r.up().c("text").t(t),this.connection.sendIQ(r,(function(){!i.peerconnection||"closed"===i.peerconnection.signalingState&&"undefined"!=i.peerconnection.signalingState||(i.peerconnection.close(),i.terminate()),i.logger.log("[Strophe.jingle] Clear peerconnection"),i.peerconnection=null;const e={source:"terminate"};$(document).trigger("ack.jingle",[i.sid,e]),i.connection.jingle.rxSubject.next({name:"ack.jingle",data:{sid:i.sid,ack:e}})}),(function(e){const t=$(e).find("error").length?{code:$(e).find("error").attr("code"),reason:$(e).find("error :first")[0].tagName}:{};$(document).trigger("ack.jingle",[i.sid,t]),i.connection.jingle.rxSubject.next({name:"add.jingle",data:{sid:i.sid,error:t}})}),this.jingleIqTimeout),null!==this.statsinterval&&(window.clearInterval(this.statsinterval),this.statsinterval=null)}catch(r){i.logger.log("[Strophe.jingle] JingleSession.prototype.sendTerminate failed: "+r)}},JingleSession.prototype.mediaModified=function(e){const t=this;this.peerconnection.createAnswer((function(i){t.contentChangeAnswer(i,e)}),(function(e){t.logger.error("[Strophe.jingle] contentChange failed "+e)}),this.media_constraints)},JingleSession.prototype.addSource=function(e){const t=this;t.logger.log("[Strophe.jingle] addssrc",(new Date).getTime()),t.logger.log("[Strophe.jingle] ice",this.peerconnection.iceConnectionState);const i=new SDP(this.peerconnection.remoteDescription.sdp);$(e).each((function(e,r){const n=$(r).attr("name");let s="";tmp=$(r).find('>source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]'),tmp.each((function(){const e=$(this).attr("ssrc");$(this).find(">parameter").each((function(){s+="a=ssrc:"+e+" "+$(this).attr("name"),$(this).attr("value")&&$(this).attr("value").length&&(s+=":"+$(this).attr("value")),s+="\r\n"}))})),i.media.forEach((function(e,r){SDPUtil.find_line(e,"a=mid:"+n)&&(i.media[r]+=s,t.addssrc[r]||(t.addssrc[r]=""),t.addssrc[r]+=s)})),i.raw=i.session+i.media.join("")})),this.modifySources()},JingleSession.prototype.removeSource=function(e){const t=this;t.logger.log("[Strophe.jingle] removessrc",(new Date).getTime()),t.logger.log("[Strophe.jingle] ice",this.peerconnection.iceConnectionState);const i=new SDP(this.peerconnection.remoteDescription.sdp);$(e).each((function(e,r){const n=$(r).attr("name");let s="";tmp=$(r).find('>source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]'),tmp.each((function(){const e=$(this).attr("ssrc");$(this).find(">parameter").each((function(){s+="a=ssrc:"+e+" "+$(this).attr("name"),$(this).attr("value")&&$(this).attr("value").length&&(s+=":"+$(this).attr("value")),s+="\r\n"}))})),i.media.forEach((function(e,r){SDPUtil.find_line(e,"a=mid:"+n)&&(i.media[r]+=s,t.addssrc[r]||(t.removessrc[r]=""),t.removessrc[r]+=s)})),i.raw=i.session+i.media.join("")})),this.modifySources()},JingleSession.prototype.modifySources=function(){const e=this;if(!this.peerconnection||"closed"==this.peerconnection.signalingState)return;if(!this.addssrc.length&&!this.removessrc.length&&null===this.pendingop)return;if(!this.wait&&("stable"!=this.peerconnection.signalingState||"connected"!=this.peerconnection.iceConnectionState&&"completed"!=this.peerconnection.iceConnectionState))return e.logger.warn("[Strophe.jingle] modifySources not yet "+this.peerconnection.signalingState+" "+this.peerconnection.iceConnectionState),this.wait=true,void window.setTimeout((function(){e.modifySources()}),1500);if(this.wait)return window.setTimeout((function(){e.modifySources()}),2500),void(this.wait=false);const t=new SDP(this.peerconnection.remoteDescription.sdp);this.addssrc.forEach((function(e,i){t.media[i]+=e})),this.addssrc=[],this.removessrc.forEach((function(e,i){(e=e.split("\r\n")).pop(),e.forEach((function(e){t.media[i]=t.media[i].replace(e+"\r\n","")}))})),this.removessrc=[],t.raw=t.session+t.media.join(""),this.peerconnection.setRemoteDescription(new window.RTCSessionDescription({type:"offer",sdp:t.raw}),(function(){e.peerconnection.createAnswer((function(t){if(null!==e.pendingop){const i=new SDP(t.sdp);if(i.media.length>1){switch(e.pendingop){case"mute":i.media[1]=i.media[1].replace("a=sendrecv","a=recvonly");break;case"unmute":i.media[1]=i.media[1].replace("a=recvonly","a=sendrecv")}i.raw=i.session+i.media.join(""),t.sdp=i.raw}e.pendingop=null}e.peerconnection.setLocalDescription(t,(function(){$(document).trigger("setLocalDescription.jingle",[e.sid]),e.connection.jingle.rxSubject.next({name:"setLocalDescription.jingle",data:{sid:e.sid}})}),(function(t){e.logger.log("[Strophe.jingle] modified setLocalDescription failed")}))}),(function(t){e.logger.log("[Strophe.jingle] modified answer failed")}))}),(function(t){e.logger.log("[Strophe.jingle] modify failed")}))},JingleSession.prototype.hardMuteVideo=function(e){this.connection.jingle.localStream&&(this.pendingop=e?"mute":"unmute",this.modifySources(),this.connection.jingle.localStream.getVideoTracks().forEach((function(t){t.enabled=!e})))},JingleSession.prototype.muteAudio=function(e){this.connection.jingle.localStream&&this.connection.jingle.localStream.getAudioTracks().forEach((function(t){t.enabled=!e})),this.localStreams.length>=1&&this.localStreams.forEach((function(t){t.getAudioTracks().forEach((function(t){t.enabled=!e}))}))},JingleSession.prototype.sendMute=function(e,t){try{const i=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-info",initiator:this.initiator,sid:this.sid});i.c(e?"mute":"unmute",{xmlns:"urn:xmpp:jingle:apps:rtp:info:1"}),i.attrs({creator:this.me==this.initiator?"creator":"responder"}),t&&i.attrs({name:t}),this.connection.sendIQ(i)}catch(i){this.logger.error("[Strophe.jingle] JingleSession.prototype.sendMute failed: "+i)}},JingleSession.prototype.sendRefer=function(e,t){try{const i=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-info",initiator:this.initiator,sid:this.sid});i.c("refer",{xmlns:"urn:xmpp:jingle:apps:rtp:info:1"}),i.attrs({confEndpointId:e,referTo:t}),this.connection.sendIQ(i)}catch(i){this.logger.error("[Strophe.jingle] JingleSession.prototype.sendRefer failed: "+i)}},JingleSession.prototype.sendP2PTrasnferCallRefer=function(e,t){try{const i=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-info",initiator:this.initiator,sid:this.sid});i.c("refer",{xmlns:"urn:xmpp:jingle:apps:rtp:info:1"}),i.attrs({sid:e,referTo:t}),this.connection.sendIQ(i)}catch(i){this.logger.error("[Strophe.jingle] JingleSession.prototype.sendP2PTrasnferCallRefer failed: "+i)}},JingleSession.prototype.sendReferStatus=function(e){try{const t=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-info",initiator:this.initiator,sid:this.sid});t.c("refer",{xmlns:"urn:xmpp:jingle:apps:rtp:info:1"}),t.attrs({status:e}),this.connection.sendIQ(t)}catch(t){this.logger.error("[Strophe.jingle] JingleSession.prototype.sendReferStatus failed: "+t)}},JingleSession.prototype.sendReferTransfer=function(e,t){try{const i=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-info",initiator:this.initiator,sid:this.sid});i.c("refer",{xmlns:"urn:xmpp:jingle:apps:rtp:info:1"}),i.attrs({method:e,referTo:t}),this.connection.sendIQ(i)}catch(i){this.logger.error("[Strophe.jingle] JingleSession.prototype.sendRefertransfer failed: "+i)}},JingleSession.prototype.sendHold=function(e){try{const t=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-info",initiator:this.initiator,sid:this.sid});t.c(e?"hold":"unhold",{xmlns:"urn:xmpp:jingle:apps:rtp:info:1"}),this.connection.sendIQ(t),this.onHold=e}catch(t){this.logger.error("[Strophe.jingle] JingleSession.prototype.sendMute failed: "+t)}},JingleSession.prototype.sendIceFailed=function(){try{const e=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-info",initiator:this.initiator,sid:this.sid});e.c("iceFailed",{xmlns:"urn:xmpp:jingle:apps:rtp:info:1"}),this.connection.sendIQ(e)}catch(e){this.logger.error("[Strophe.jingle] JingleSession.prototype.sendIceFailed failed: "+e)}},JingleSession.prototype.sendRinging=function(){try{const e=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-info",initiator:this.initiator,sid:this.sid});e.c("ringing",{xmlns:"urn:xmpp:jingle:apps:rtp:info:1"}),this.connection.sendIQ(e)}catch(e){this.logger.error("[Strophe.jingle] JingleSession.prototype.sendRinging failed: "+e)}},JingleSession.prototype.modifyEncodingState=function(e,t){this.logger.log("[Strophe.jingle] modifyEncodingState "+e);const i=this.peerconnection.getSenders().find((e=>"video"===e.track.kind)),r=i.getParameters();let n=2;r.encodings[0].rid&&"h"===r.encodings[0].rid&&(n=0),r.encodings[n].active=e,t&&(r.encodings[0].active=e,r.encodings[2].active=e),i.setParameters(r)},JingleSession.prototype.enableHQEncoding=function(e){return(async e=>{try{this.logger.log("[Strophe.jingle.session] enableHQEncoding "+e);const t=this.peerconnection.getSenders()[1];if(t){const i=t.getParameters();this.hqEncodingEnabled=e,i.encodings.forEach((t=>{"l"!==t.rid&&(t.active=e)})),await t.setParameters(i)}}catch(t){this.logger.error("[Strophe.jingle.session] enableHQEncoding("+e+") -- failure -- "+t.message)}})(e)},JingleSession.prototype.disableSubStreamLevel=function(e){const t=this.peerconnection.getSenders().find((e=>"video"===e.track.kind)),i=t.getParameters();2===e&&i.encodings[0].rid&&"h"===i.encodings[0].rid?e=0:0===e&&i.encodings[2].rid&&"l"===i.encodings[2].rid&&(e=2),this.logger.log("[Strophe.jingle] disableSubStreamLevel "+e+" state: "+!i.encodings[e].active),this.logger.log(i.encodings[e].rid),i.encodings[e].active=!i.encodings[e].active,t.setParameters(i)},JingleSession.prototype.forceCodecTo=function(e,t,i){try{const r=e.split("\r\n");let n=-1,s=-1;const o=[];let a,c,l,d,u,h=[];for(let e=0,f=r.length;e<f;e++){const f=r[e];if(f.indexOf("m="+i)>-1&&(n=e,s=f.indexOf("RTP/SAVPF")+10,h=f.substring(s).split(" ")),f.indexOf(t)>-1){for(a=f.indexOf(":"),c=f.indexOf(" "),l=f.substring(a+1,c),d=-1,o.push(l),u=0;u<h.length;u++)if(h[u]===l){d=u;break}d>-1&&h.splice(d,1)}if("PCMU/8000"===t&&f.indexOf("PCMA/8000")>-1){for(a=f.indexOf(":"),c=f.indexOf(" "),l=f.substring(a+1,c),d=-1,o.push(l),u=0;u<h.length;u++)if(h[u]===l){d=u;break}d>-1&&h.splice(d,1)}}if(-1!==n){r[n]=r[n].substr(0,s-1);for(let e=0;e<o.length;e++)r[n]+=" "+o[e];h.length>0&&(r[n]+=" "+h.join(" ")),e=r.join("\r\n")}return e}catch(dp){return e}},JingleSession.prototype.removeSsrcGroupFidForFirefox=function(e){this.logger.log("[Strophe.jingle] session -- removeSsrcGroupFidForFirefox");const t=e.split("\r\n");let i=false;for(let r=0;r<t.length;r++){if(t[r]&&-1!==t[r].indexOf("m=video")&&(i=true),i&&-1!==t[r].indexOf("a=ssrc:")){const e=r+1;t[e]&&-1!==t[e].indexOf("a=ssrc:")&&t.splice(e,1)}i&&t[r]&&-1!==t[r].indexOf("a=ssrc-group:FID")&&t.splice(r,1)}return(e=t.join("\r\n")).endsWith("\r\n")||(e+="\r\n"),e},JingleSession.prototype.checkIfRemoteSdpHasSendonlyAudioMedia=function(e){this.logger.log("[Strophe.jingle] session -- checkIfRemoteSdpHasSendonlyAudioMedia");const t=e.split("\r\n");let i=false;for(let r=0;r<t.length;r++)t[r]&&"a=mid:audio"===t[r]&&t[r-1]&&"a=sendonly"===t[r-1]&&(i=true);return i},JingleSession.prototype.getStats=function(e){const t=this,i={audio:0,video:0},r={audio:0,video:0},n=e/1e3;let s=true,o=0,a=0,c=0,l=0,d=0,u=0,h=0,f=0,p=0,g=0,m="";const v={bitrate:{}};let S="",b="";return this.statsinterval&&(window.clearInterval(this.statsinterval),this.statsinterval=null),this.ice_config.debugWeRTC&&(e=1e3),this.statsinterval=window.setInterval((function(){t&&t.peerconnection?(navigator.mozGetUserMedia&&t.peerconnection.getStats?t.peerconnection.getStats().then((function(e){const i=[];e.forEach((function(e){i.push(e)})),function(e){const i=new Object;let o,a,c=0,l=0,d=0,u=0;const h=[];for(let f=0;f<e.length;++f){if("inbound-rtp"===e[f].type&&"audio"===e[f].mediaType){r.audio||(r.audio=e[f].bytesReceived);const t=e[f].bytesReceived-r.audio;r.audio=e[f].bytesReceived,c=t?8*t/(1024*n):0,i.audioReceived={bytesReceived:r.audio,packetsLost:e[f].packetsLost,packetsReceived:e[f].packetsReceived},parseInt(e[f].packetsReceived,10)-u,u=parseInt(e[f].packetsReceived,10),parseInt(e[f].packetsLost,10)-d,d=parseInt(e[f].packetsLost,10),e[f].googCurrentDelayMs}else if("outbound-rtp"===e[f].type&&"audio"===e[f].mediaType)i.audioSent={bytesSent:e[f].bytesSent,packetsSent:e[f].packetsSent};else if("inbound-rtp"===e[f].type&&"video"===e[f].mediaType){r.video||(r.video=e[f].bytesReceived);const t=e[f].bytesReceived-r.video;r.video=e[f].bytesReceived,l=t?8*t/(1024*n):0,i.videoReceived={bytesReceived:r.video,packetsLost:e[f].packetsLost,packetsReceived:e[f].packetsReceived}}else"outbound-rtp"===e[f].type&&"video"===e[f].mediaType?i.videoSent={bytesSent:e[f].bytesSent,packetsSent:e[f].packetsSent}:"candidate-pair"===e[f].type&&"succeeded"===e[f].state&&true===e[f].selected&&true===e[f].writable?(o=e[f].localCandidateId,a=e[f].remoteCandidateId):s&&"local-candidate"===e[f].type&&e[f].id===o?(i.connectionType||(i.connectionType={}),i.connectionType.local={candidateType:e[f].candidateType,ipAddress:e[f].address+":"+e[f].port,transport:e[f].protocol}):s&&"remote-candidate"===e[f].type&&e[f].id===a?(i.connectionType||(i.connectionType={}),i.connectionType.remote={candidateType:e[f].candidateType,ipAddress:e[f].address+":"+e[f].port}):("candidate-pair"!==e[f].type||e[f].selected)&&("local-candidate"===e[f].type&&e[f].id!==o||"remote-candidate"===e[f].type&&e[f].id!==a||h.push(e[f]));const p=e[f];let g=false;if(("video"===p.mediaType||p.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===p.type&&p.id.indexOf("rtcp")<0?g=true:"ssrc"!==p.type||!p.bytesReceived||"VP8"!==p.googCodecName&&""!==p.googCodecName||(g=true),g)if(v.bitrate.bsnow=p.bytesReceived,v.bitrate.tsnow=p.timestamp,void 0===v.bitrate.bsbefore||void 0===v.bitrate.tsbefore)v.bitrate.bsbefore=v.bitrate.bsnow,v.bitrate.tsbefore=v.bitrate.tsnow;else{let e=v.bitrate.tsnow-v.bitrate.tsbefore;"safari"===adapter.default.browserDetails.browser&&(e/=1e3);let i=Math.round(8*(v.bitrate.bsnow-v.bitrate.bsbefore)/e);"safari"===adapter.default.browserDetails.browser&&(i=parseInt(i/1e3)),v.bitrate.value=i+" kbits/sec",v.bitrate.bsbefore=v.bitrate.bsnow,v.bitrate.tsbefore=v.bitrate.tsnow,$(document).trigger("webrtcSessionBitRate.jingle",[t.sid,v.bitrate]),t.connection.jingle.rxSubject.next({name:"webrtcSessionBitRate.jingle",data:{sid:t.sid,bitrate:v.bitrate}})}}i.availableIncomingAudioBandwidth=c,i.availableIncomingVideoBandwidth=l,i.connectionType&&(s=false,t.connection.jingle.rxSubject.next({name:"webrtcConnectionType.jingle",data:{sid:t.sid,data:i.connectionType}})),t.connection.jingle.rxSubject.next({name:"webrtcFirefoxStats.jingle",data:{sid:t.sid,data:i}})}(i)})):t.peerconnection.getStats?t.peerconnection.getStats((function(e){const y=[];e.result().forEach((function(e){const t={};e.names().forEach((function(i){t[i]=e.stat(i)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,y.push(t)})),function(e){let y=0,C=0,w=0,_=0,E=0,T=0,I=0,P=0;const A=new Object,M=[];let D=0,R=0,O=0,N=0,x=0,L=0,k=0,F=0,U=0,j=0,W=0,B=0,H=0,V=0,Y=0,G=false,z=false,J=false,q=false;const K={};for(let c=e.length-1;c>=0;c--){if("ssrc"==e[c].type)if(-1!==e[c].id.indexOf("send"))if("opus"!==e[c].googCodecName&&"PCMA"!==e[c].googCodecName&&"PCMU"!==e[c].googCodecName||G){if("VP8"==e[c].googCodecName&&!z){z=true,C=e[c].packetsSent,T+=e[c].packetsLost,e[c].googFrameRateSent&&e[c].googFrameRateSent,i.video||(i.video=e[c].bytesSent),e[c].googRtt&&!O&&(O=parseInt(e[c].googRtt,10));e[c].bytesSent-i.video;i.video=e[c].bytesSent}}else{G=true,y=e[c].packetsSent,E+=e[c].packetsLost,D=e[c].audioInputLevel,e[c].googRtt&&!O&&(O=parseInt(e[c].googRtt,10)),i.audio||(i.audio=e[c].bytesSent);e[c].bytesSent-i.audio;i.audio=e[c].bytesSent}else if("opus"!==e[c].googCodecName&&"PCMA"!==e[c].googCodecName&&"PCMU"!==e[c].googCodecName||J){if("VP8"==e[c].googCodecName&&!q){q=true,_=e[c].packetsReceived,P+=e[c].packetsLost,e[c].googFrameRateReceived&&e[c].googFrameRateReceived,r.video||(r.video=e[c].bytesReceived);e[c].bytesReceived-r.video;r.video=e[c].bytesReceived}}else{J=true,w=e[c].packetsReceived,I+=e[c].packetsLost,R=e[c].audioOutputLevel,N=parseInt(e[c].googJitterBufferMs,10),x=parseInt(e[c].googJitterReceived,10),L=parseInt(e[c].packetsReceived,10)-a,a=parseInt(e[c].packetsReceived,10),L<0&&(L=0),k=parseInt(e[c].packetsLost,10)-o,o=parseInt(e[c].packetsLost,10),k<0&&(k=0),Y=k/(50*n)*100,V=parseInt(e[c].googCurrentDelayMs,10),r.audio||(r.audio=e[c].bytesReceived);e[c].bytesReceived-r.audio;r.audio=e[c].bytesReceived}"googCandidatePair"==e[c].type&&"true"===e[c].googWritable&&s&&(A.localCandidateType=e[c].googLocalCandidateType,A.localAddress=e[c].googLocalAddress,A.localTransportType=e[c].googTransportType,A.remoteCandidateType=e[c].googRemoteCandidateType,A.remoteAddress=e[c].googRemoteAddress,b=e[c].googLocalAddress.split(":")[0],e[c].googRemoteAddress.split(":")[0],m=A.localAddress+" [ "+A.localCandidateType+" ] <-> "+A.remoteAddress+" [ "+A.remoteCandidateType+" ] || "+A.localTransportType),"localcandidate"===e[c].type&&e[c].ipAddress===b&&(A.networkType=e[c].networkType,S=A.networkType),"VideoBwe"===e[c].type&&"bweforvideo"===e[c].id&&(K.type="VideoBwe",K.googActualEncBitrate=e[c].googActualEncBitrate,K.googAvailableReceiveBandwidth=e[c].googAvailableReceiveBandwidth,K.googAvailableSendBandwidth=e[c].googAvailableSendBandwidth,K.googBucketDelay=e[c].googBucketDelay,K.googRetransmitBitrate=e[c].googRetransmitBitrate,K.googTargetEncBitrate=e[c].googTargetEncBitrate,K.googTransmitBitrate=e[c].googTransmitBitrate),"googCandidatePair"===e[c].type&&"0"===e[c].requestsReceived||"remotecandidate"===e[c].type||"localcandidate"===e[c].type||"googCertificate"===e[c].type||"googComponent"===e[c].type||"googTrack"===e[c].type||"googLibjingleSession"===e[c].type||M.push(e[c]);const l=e[c];let d=false;if(("video"===l.mediaType||l.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===l.type&&l.id.indexOf("rtcp")<0?d=true:"ssrc"!=l.type||!l.bytesReceived||"VP8"!==l.googCodecName&&""!==l.googCodecName||(d=true),d)if(v.bitrate.bsnow=l.bytesReceived,v.bitrate.tsnow=l.timestamp,void 0===v.bitrate.bsbefore||void 0===v.bitrate.tsbefore)v.bitrate.bsbefore=v.bitrate.bsnow,v.bitrate.tsbefore=v.bitrate.tsnow;else{let e=v.bitrate.tsnow-v.bitrate.tsbefore;"safari"==adapter.default.browserDetails.browser&&(e/=1e3);let i=Math.round(8*(v.bitrate.bsnow-v.bitrate.bsbefore)/e);"safari"===adapter.default.browserDetails.browser&&(i=parseInt(i/1e3)),v.bitrate.value=i+" kbits/sec",v.bitrate.bsbefore=v.bitrate.bsnow,v.bitrate.tsbefore=v.bitrate.tsnow,$(document).trigger("webrtcSessionBitRate.jingle",[t.sid,v.bitrate]),t.connection.jingle.rxSubject.next({name:"webrtcSessionBitRate.jingle",data:{sid:t.sid,bitrate:v.bitrate}})}}L&&(F=93.2-Y,U=.18*F*F-27.9*F+1126.62),j=V;W=.024*j+.11*(j-177.3)*(j-177.3<0?0:1),B=U-W,H=B<0||Y>20?1:B>100?4.5:1+.035*B+B*(B-60)*(100-B)*7*1e-6;let X=0;B>=80?X=2:B<80&&B>=60&&(X=1),!O&&V&&(O=V),A.googRTTAudio=O,A.googJitterBufferMsAudio=N,A.googJitterReceived=x,A.mosPacketsReceivedAudio=L,A.mosPacketsLostAudio=k,A.MOS=H,A.candidatePair=m,A.packetsAudioSent=parseInt(y,10),A.packetsAudioReceived=parseInt(w,10),A.audioInputLevel=parseInt(D,10),A.audioOutputLevel=parseInt(R,10),H&&A.packetsAudioReceived&&(c+=1,l+=H,d+=O,u+=x,h+=N,A.iteration=c,A.currentDelay=j,A.MOS=H,A.networkQualityFlag=X,A.meanMOS=l/c,A.packetsLost=o,A.packetsReceived=parseInt(w,10),f=f<parseFloat(O)?parseFloat(O):f,p=p<x?x:p,g=g<N?N:g),A.packetsVideoSent=parseInt(C,10),A.packetsVideoReceived=parseInt(_,10),A.bytesSent=i,A.bytesReceived=r,t.conference_id&&-1!==t.conference_id&&(A.conferenceId=t.conference_id,A.sessionType="",t.publisherId&&(A.publisherId=t.publisherId),"audio"===t.localType&&(A.sessionType="AUDIO"),"video"!==t.localType&&"video"!==t.remoteType||(A.sessionType="VIDEO",A.sessionType+=t.isInitiator?" / PUBLISHER ":" / SUBSCRIBER",t.isInitiator||A.publisherId||(A.sessionType+=" / DYNAMIC FEED")),"sharing"!==t.localType&&"sharing"!==t.remoteType||(A.sessionType="SHARING",A.sessionType+=t.isInitiator?" / PUBLISHER ":" / SUBSCRIBER"),"audio"!==t.localType&&"audio"!==t.remoteType&&(delete A.packetsAudioSent,delete A.packetsAudioReceived,delete A.audioInputLevel,delete A.audioOutputLevel,delete A.googRTTAudio,delete A.googJitterBufferMsAudio,delete A.googJitterReceived,delete A.mosPacketsLostAudio,delete A.mosPacketsReceivedAudio,delete A.MOS,delete A.networkQualityFlag,delete A.meanMOS,delete A.currentDelay),"audio"===t.localType&&(delete A.packetsVideoSent,delete A.packetsVideoReceived)),A.localCandidateType&&(s=false,t.connection.jingle.rxSubject.next({name:"webrtcConnectionType.jingle",data:{sid:t.sid,data:A}})),M.RainMetrics={type:"mscore",meanRTT:Math.round(d/c*100)/100,maxRTT:f,meanJitter:Math.round(u/c*100)/100,maxJitter:p,meanJitterDepth:Math.round(h/c*100)/100,maxJitterDepth:g,candidatePair:A.candidatePair,networkType:S,meanMOS:A.meanMOS,packetsLost:A.packetsLost,packetsReceived:A.packetsReceived},K&&(M.VideoBweMetrics=K),t.connection.jingle.rxSubject.next({name:"webrtcSessionStats.jingle",data:{sid:t.sid,stats:M}}),t.connection.jingle.rxSubject.next({name:"webrtcSessionStatsSimplyfied.jingle",data:{sid:t.sid,data:A}})}(y)})):t.logger.log("[Strophe.jingle] getStats does not exist..."),t.localTransceivers&&t.localTransceivers.length&&t.localTransceivers.forEach((e=>{!e||"sendrecv"!==e.currentDirection&&"sendonly"!==e.currentDirection||e.sender.track&&"video"===e.sender.track.kind&&e.sender.getStats&&e.sender.getStats().then((e=>{const i={},r=e.entries();let n=r.next();for(;!n.done;)-1!==n.value[0].indexOf("RTCMediaStreamTrack_sender")&&(i[n.value[0]]={frameWidth:n.value[1].frameWidth,frameHeight:n.value[1].frameHeight,framesSent:n.value[1].framesSent,mediaSourceId:n.value[1].mediaSourceId}),-1!==n.value[0].indexOf("RTCOutboundRTPVideoStream")&&(i[n.value[0]]={rid:n.value[1].rid,mediaSourceId:n.value[1].mediaSourceId,frameWidth:n.value[1].frameWidth,frameHeight:n.value[1].frameHeight,framesPerSecond:n.value[1].framesPerSecond,framesSent:n.value[1].framesSent,qualityLimitationReason:n.value[1].qualityLimitationReason},t.connection.jingle.rxSubject.next({name:"RTCOutboundRTPVideoStats",data:{sid:t.sid,transceiverStats:i[n.value[0]]}})),n=r.next();t.logger.log("RTC Sender stats for session "+t.sid+" : "+JSON.stringify(i))})),!e||"sendrecv"!==e.currentDirection&&"recvonly"!==e.currentDirection||e.receiver.track&&"video"===e.receiver.track.kind&&e.receiver.getStats&&e.receiver.getStats().then((e=>{const i=e.entries();let r=i.next();const n={};let s=false;for(;!r.done;)-1!==r.value[0].indexOf("RTCInboundRTPVideoStream")&&(n[r.value[0]]={frameWidth:r.value[1].frameWidth,frameHeight:r.value[1].frameHeight,framesPerSecond:r.value[1].framesPerSecond,framesReceived:r.value[1].framesReceived,nackCount:r.value[1].nackCount,pliCount:r.value[1].pliCount,firCount:r.value[1].firCount,packetsLost:r.value[1].packetsLost},!s&&t.transceiverStats&&(n[r.value[0]].framesReceived?void 0===t.transceiverStats.framesReceived||0===t.transceiverStats.framesReceived?(t.transceiverStats.framesReceivedDelta=n[r.value[0]].framesReceived,s=true):t.transceiverStats.framesReceived&&(t.transceiverStats.framesReceivedDelta=n[r.value[0]].framesReceived-t.transceiverStats.framesReceived,t.transceiverStats.framesReceivedDelta<0&&(t.transceiverStats.framesReceivedDelta=-1),s=true):0===t.transceiverStats.framesReceived&&0===n[r.value[0]].framesReceived&&(t.transceiverStats.framesReceivedDelta=0)),t.transceiverStats.frameWidth=void 0!==n[r.value[0]].frameWidth?n[r.value[0]].frameWidth:t.transceiverStats.frameWidth,t.transceiverStats.frameHeight=void 0!==n[r.value[0]].frameHeight?n[r.value[0]].frameHeight:t.transceiverStats.frameHeight,t.transceiverStats.framesPerSecond=void 0!==n[r.value[0]].framesPerSecond?n[r.value[0]].framesPerSecond:t.transceiverStats.framesPerSecond,t.transceiverStats.framesReceived=void 0!==n[r.value[0]].framesReceived?n[r.value[0]].framesReceived:t.transceiverStats.framesReceived,t.transceiverStats.nackCount=void 0!==n[r.value[0]].nackCount?n[r.value[0]].nackCount:t.transceiverStats.nackCount,t.transceiverStats.pliCount=void 0!==n[r.value[0]].pliCount?n[r.value[0]].pliCount:t.transceiverStats.pliCount,t.transceiverStats.firCount=void 0!==n[r.value[0]].firCount?n[r.value[0]].firCount:t.transceiverStats.firCount,t.transceiverStats.packetsLost=void 0!==n[r.value[0]].packetsLost?n[r.value[0]].packetsLost:t.transceiverStats.packetsLost),-1!==r.value[0].indexOf("RTCMediaStreamTrack_receiver")&&(n[r.value[0]]={frameWidth:r.value[1].frameWidth,frameHeight:r.value[1].frameHeight,framesPerSecond:r.value[1].framesPerSecond,framesReceived:r.value[1].framesReceived},!s&&t.transceiverStats&&(n[r.value[0]].framesReceived?void 0===t.transceiverStats.framesReceived||0===t.transceiverStats.framesReceived?(t.transceiverStats.framesReceivedDelta=n[r.value[0]].framesReceived,s=true):t.transceiverStats.framesReceived&&(t.transceiverStats.framesReceivedDelta=n[r.value[0]].framesReceived-t.transceiverStats.framesReceived,t.transceiverStats.framesReceivedDelta<0&&(t.transceiverStats.framesReceivedDelta=-1),s=true):0===t.transceiverStats.framesReceived&&0===n[r.value[0]].framesReceived&&(t.transceiverStats.framesReceivedDelta=0)),t.transceiverStats.frameWidth=void 0!==n[r.value[0]].frameWidth?n[r.value[0]].frameWidth:t.transceiverStats.frameWidth,t.transceiverStats.frameHeight=void 0!==n[r.value[0]].frameHeight?n[r.value[0]].frameHeight:t.transceiverStats.frameHeight,t.transceiverStats.framesReceived=void 0!==n[r.value[0]].framesReceived?n[r.value[0]].framesReceived:t.transceiverStats.framesReceived),r=i.next();if(n.framesReceivedDelta=t.transceiverStats.framesReceivedDelta,t.logger.log("RTC Receiver stats for session "+t.sid+" with hold state ("+t.onHold+") / qualityLimitation ("+t.qualityLimitation+") : "+JSON.stringify(n)),t.onHold)t.transceiverStats.framesReceivedDelta=-1;else if(t.connection.jingle.rxSubject.next({name:"transceiverStats",data:{sid:t.sid,transceiverStats:t.transceiverStats}}),0===t.transceiverStats.framesReceivedDelta?(t.transceiverStatsframesReceivedDeltaErrorCount+=1,t.transceiverStatsframesReceivedDeltaErrorCount>=5&&t.connection.jingle.rxSubject.next({name:"resubscriptionNeeded",data:{sid:t.sid,confId:this.conference_id}})):t.transceiverStatsframesReceivedDeltaErrorCount=0,void 0!==t.transceiverStats.packetsLost&&t.transceiverStats.packetsLost>0&&!t.isInitiator&&"video"===t.remoteType){if(t.transceiverStats.packetsLost!==t.transceiverStats.lastPacketLostValue){const e=t.transceiverStats.packetsLost-t.transceiverStats.lastPacketLostValue;e>0&&t.transceiverStats.framesReceivedDelta>0&&Math.round(t.transceiverStats.framesReceivedDelta/100*5)<e?(t.transceiverStatsPacketLostErrorCount+=1,t.transceiverStatsPacketLostOKCount=0):(t.transceiverStatsPacketLostErrorCount=0,t.transceiverStatsPacketLostOKCount+=1)}else t.transceiverStatsPacketLostOKCount+=1;t.transceiverStatsPacketLostOKCount>=10&&(t.transceiverStatsPacketLostOKCount=0,t.connection.jingle.rxSubject.next({name:"packetLostQualityImpactEvent",data:{decreaseQuality:false,sid:t.sid,confId:this.conference_id}})),t.transceiverStatsPacketLostErrorCount>=2&&(t.transceiverStatsPacketLostErrorCount=0,t.connection.jingle.rxSubject.next({name:"packetLostQualityImpactEvent",data:{decreaseQuality:true,sid:t.sid,confId:this.conference_id}})),t.transceiverStats.lastPacketLostValue=t.transceiverStats.packetsLost}}))}))):t.logger.log("[Strophe.jingle] getStats no peerconnection")}),e||1e3),this.statsinterval}},function(e,t){Strophe.addConnectionPlugin("mam",{_c:null,_p:["with","start","end"],init:function(e){this._c=e,Strophe.addNamespace("MAM","urn:xmpp:mam:1")},query:function(e,t){const i=this._p,r={type:"set",id:e},n={xmlns:Strophe.NS.MAM};t.queryid&&(n.queryid=t.queryid,delete t.queryid);const s=$iq(r).c("query",n).c("x",{xmlns:"jabber:x:data",type:"submit"});let o;for(s.c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("urn:xmpp:mam:1").up().up(),o=0;o<this._p.length;o++){const e=i[o],r=t[e];delete t[e],r&&s.c("field",{var:e}).c("value").t(r).up().up()}s.up(),delete t.onMessage;const a=t.onComplete;return delete t.onComplete,s.cnode(new Strophe.RSM(t).toXML()),this._c.sendIQ(s,a)},querymuc:function(e,t,i){const r=this._p,n={to:t,type:"set",id:e},s={xmlns:Strophe.NS.MAM};i.queryid&&(s.queryid=i.queryid,delete i.queryid);const o=$iq(n).c("query",s).c("x",{xmlns:"jabber:x:data",type:"submit"});let a;for(o.c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(Strophe.NS.MAM).up().up(),a=0;a<this._p.length;a++){const e=r[a],t=i[e];delete i[e],t&&o.c("field",{var:e}).c("value").t(t).up().up()}o.up();const c=i.onComplete;return delete i.onComplete,o.cnode(new Strophe.RSM(i).toXML()),this._c.sendIQ(o,c)},delete:function(e,t){const i=this._p,r={type:"set",id:e},n={xmlns:Strophe.NS.MAM};t.queryid&&(n.queryid=t.queryid,delete t.queryid);const s=$iq(r).c("delete",n).c("x",{xmlns:"jabber:x:data",type:"submit"});let o;for(s.c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(Strophe.NS.MAM).up().up(),o=0;o<this._p.length;o++){const e=i[o],r=t[e];r&&s.c("field",{var:e}).c("value").t(r).up().up()}s.up(),delete t.onMessage;const a=t.onComplete;return delete t.onComplete,s.cnode(new Strophe.RSM(t).toXML()),this._c.sendIQ(s,a)}})},function(e,t){Strophe.addConnectionPlugin("calllog",{_c:null,_p:["with"],init:function(e){this._c=e,Strophe.addNamespace("CALLLOG","jabber:iq:telephony:call:log")},query:function(e,t){const i=this._p,r={type:"set",id:130,from:e},n={xmlns:Strophe.NS.CALLLOG},s=$iq(r).c("query",n).c("x",{xmlns:"jabber:x:data",type:"submit"});let o;for(s.c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("jabber:iq:telephony:call:log").up().up(),o=0;o<this._p.length;o++){const e=i[o],r=t[e];delete t[e],r&&s.c("field",{var:e}).c("value").t(r).up().up()}s.up(),t.onMessage,delete t.onMessage;const a=t.onComplete;return delete t.onComplete,s.cnode(new Strophe.RSM(t).toXML()),this._c.sendIQ(s,a)}})},function(e,t){!function(){function e(){}function t(e,t){let i=false;return $('si feature x field[var="stream-method"] value',e).each((function(e,r){$(r).text()===t&&(i=true)})),i}Strophe.addConnectionPlugin("si_filetransfer",{_c:null,_cb:null,init:function(e){this._c=e,Strophe.addNamespace("SI","http://jabber.org/protocol/si"),Strophe.addNamespace("SI_FILE_TRANSFER",Strophe.NS.SI+"/profile/file-transfer"),Strophe.addNamespace("FEATURE_NEG","http://jabber.org/protocol/feature-neg"),e.addHandler(this._receive.bind(this),Strophe.NS.SI,"iq","set")},_receive:function(e){const i=$(e),r=i.attr("from"),n=i.attr("id"),s=$("si",i).attr("id");if(Object.hasOwnProperty.call(this._c,"ibb")&&t(e,Strophe.NS.IBB))var o=$("file",i);const a=o.attr("name"),c=o.attr("size"),l=$("si",i).attr("mime-type"),d=$("desc",i).text();return"function"==typeof this._cb&&this._cb(r,s,a,c,l,n,d),true},_success:function(e,i){let r;t(i,Strophe.NS.IBB)||(r=new Error("In-Band Bytestream not supported")),e(r)},_fail:function(e,t){let i="timed out";t&&(i=t),e(new Error(i))},_send:function(e,t,i){this._c.sendIQ(e,t,i,18e4)},send:function(e,t,i,r,n,s,o){if(!Object.hasOwnProperty.call(this._c,"ibb"))return void Strophe.warn("The In-Band Bytestream plugin is required.");const a=$iq({type:"set",to:e,id:this._c.getUniqueId("si-filetransfer")}).c("si",{xmlns:Strophe.NS.SI,id:t,profile:Strophe.NS.SI_FILE_TRANSFER,"mime-type":n}).c("file",{xmlns:Strophe.NS.SI_FILE_TRANSFER,name:i,size:r}).c("desc").t(s).up().c("feature",{xmlns:Strophe.NS.FEATURE_NEG}).c("x",{xmlns:"jabber:x:data",type:"form"}).c("field",{var:"stream-method",type:"list-single"}).c("option").c("value").t(Strophe.NS.IBB);this._send(a,this._success.bind(this,o),this._fail.bind(this,o))},responseOk:function(t,i,r){const n=$iq({type:"result",to:t,id:r}).c("si",{xmlns:Strophe.NS.SI,id:i}).c("file",{xmlns:Strophe.NS.SI_FILE_TRANSFER}).up().c("feature",{xmlns:Strophe.NS.FEATURE_NEG}).c("x",{xmlns:"jabber:x:data",type:"submit"}).c("field",{var:"stream-method"});n.c("value").t(Strophe.NS.IBB),this._send(n,e,e)},responseError:function(t,i,r,n){const s=$iq({type:"error",to:t,id:r}).c("error",{code:n,type:"cancel"}).c("forbidden",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("text",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"});s.c("value").t(Strophe.NS.IBB),this._send(s,e,e)},addFileHandler:function(e){this._cb=e}})}()},function(e,t){"randomUUID"in crypto||(crypto.randomUUID=()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))))},function(e,t,i){i.r(t);var r=i(0),n=i(3);function s(e){return function(t){return t.lift(new o(e))}}var o=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.durationSelector))},e}(),a=function(e){function t(t,i){var r=e.call(this,t)||this;return r.durationSelector=i,r.hasValue=false,r}return r.a(t,e),t.prototype._next=function(e){if(this.value=e,this.hasValue=true,!this.throttled){var t=void 0;try{t=(0,this.durationSelector)(e)}catch(dp){return this.destination.error(dp)}var i=Object(n.c)(t,new n.a(this));!i||i.closed?this.clearThrottle():this.add(this.throttled=i)}},t.prototype.clearThrottle=function(){var e=this.value,t=this.hasValue,i=this.throttled;i&&(this.remove(i),this.throttled=void 0,i.unsubscribe()),t&&(this.value=void 0,this.hasValue=false,this.destination.next(e))},t.prototype.notifyNext=function(){this.clearThrottle()},t.prototype.notifyComplete=function(){this.clearThrottle()},t}(n.b),c=i(15),l=i(117);function d(e,t){return void 0===t&&(t=c.a),s((function(){return Object(l.a)(e,t)}))}function u(e){return function(t){return t.lift(new h(e))}}var h=function(){function e(e){this.closingNotifier=e}return e.prototype.call=function(e,t){return t.subscribe(new f(e,this.closingNotifier))},e}(),f=function(e){function t(t,i){var r=e.call(this,t)||this;return r.buffer=[],r.add(Object(n.c)(i,new n.a(r))),r}return r.a(t,e),t.prototype._next=function(e){this.buffer.push(e)},t.prototype.notifyNext=function(){var e=this.buffer;this.buffer=[],this.destination.next(e)},t}(n.b),p=i(2);function g(e,t){return void 0===t&&(t=null),function(i){return i.lift(new m(e,t))}}var m=function(){function e(e,t){this.bufferSize=e,this.startBufferEvery=t,this.subscriberClass=t&&e!==t?S:v}return e.prototype.call=function(e,t){return t.subscribe(new this.subscriberClass(e,this.bufferSize,this.startBufferEvery))},e}(),v=function(e){function t(t,i){var r=e.call(this,t)||this;return r.bufferSize=i,r.buffer=[],r}return r.a(t,e),t.prototype._next=function(e){var t=this.buffer;t.push(e),t.length==this.bufferSize&&(this.destination.next(t),this.buffer=[])},t.prototype._complete=function(){var t=this.buffer;t.length>0&&this.destination.next(t),e.prototype._complete.call(this)},t}(p.a),S=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.bufferSize=i,n.startBufferEvery=r,n.buffers=[],n.count=0,n}return r.a(t,e),t.prototype._next=function(e){var t=this.bufferSize,i=this.startBufferEvery,r=this.buffers,n=this.count;this.count++,n%i==0&&r.push([]);for(var s=r.length;s--;){var o=r[s];o.push(e),o.length===t&&(r.splice(s,1),this.destination.next(o))}},t.prototype._complete=function(){for(var t=this.buffers,i=this.destination;t.length>0;){var r=t.shift();r.length>0&&i.next(r)}e.prototype._complete.call(this)},t}(p.a),b=i(21);function y(e){var t=arguments.length,i=c.a;Object(b.a)(arguments[arguments.length-1])&&(i=arguments[arguments.length-1],t--);var r=null;t>=2&&(r=arguments[1]);var n=Number.POSITIVE_INFINITY;return t>=3&&(n=arguments[2]),function(t){return t.lift(new C(e,r,n,i))}}var C=function(){function e(e,t,i,r){this.bufferTimeSpan=e,this.bufferCreationInterval=t,this.maxBufferSize=i,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new _(e,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},e}(),w=function(){return function(){this.buffer=[]}}(),_=function(e){function t(t,i,r,n,s){var o=e.call(this,t)||this;o.bufferTimeSpan=i,o.bufferCreationInterval=r,o.maxBufferSize=n,o.scheduler=s,o.contexts=[];var a=o.openContext();if(o.timespanOnly=null==r||r<0,o.timespanOnly){var c={subscriber:o,context:a,bufferTimeSpan:i};o.add(a.closeAction=s.schedule(E,i,c))}else{var l={subscriber:o,context:a},d={bufferTimeSpan:i,bufferCreationInterval:r,subscriber:o,scheduler:s};o.add(a.closeAction=s.schedule(I,i,l)),o.add(s.schedule(T,r,d))}return o}return r.a(t,e),t.prototype._next=function(e){for(var t,i=this.contexts,r=i.length,n=0;n<r;n++){var s=i[n],o=s.buffer;o.push(e),o.length==this.maxBufferSize&&(t=s)}t&&this.onBufferFull(t)},t.prototype._error=function(t){this.contexts.length=0,e.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts,i=this.destination;t.length>0;){var r=t.shift();i.next(r.buffer)}e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.contexts=null},t.prototype.onBufferFull=function(e){this.closeContext(e);var t=e.closeAction;if(t.unsubscribe(),this.remove(t),!this.closed&&this.timespanOnly){e=this.openContext();var i=this.bufferTimeSpan,r={subscriber:this,context:e,bufferTimeSpan:i};this.add(e.closeAction=this.scheduler.schedule(E,i,r))}},t.prototype.openContext=function(){var e=new w;return this.contexts.push(e),e},t.prototype.closeContext=function(e){this.destination.next(e.buffer);var t=this.contexts;(t?t.indexOf(e):-1)>=0&&t.splice(t.indexOf(e),1)},t}(p.a);function E(e){var t=e.subscriber,i=e.context;i&&t.closeContext(i),t.closed||(e.context=t.openContext(),e.context.closeAction=this.schedule(e,e.bufferTimeSpan))}function T(e){var t=e.bufferCreationInterval,i=e.bufferTimeSpan,r=e.subscriber,n=e.scheduler,s=r.openContext();r.closed||(r.add(s.closeAction=n.schedule(I,i,{subscriber:r,context:s})),this.schedule(e,t))}function I(e){var t=e.subscriber,i=e.context;t.closeContext(i)}var P=i(10),A=i(25),M=i(31);function D(e,t){return function(i){return i.lift(new R(e,t))}}var R=function(){function e(e,t){this.openings=e,this.closingSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new O(e,this.openings,this.closingSelector))},e}(),O=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.closingSelector=r,n.contexts=[],n.add(Object(A.a)(n,i)),n}return r.a(t,e),t.prototype._next=function(e){for(var t=this.contexts,i=t.length,r=0;r<i;r++)t[r].buffer.push(e)},t.prototype._error=function(t){for(var i=this.contexts;i.length>0;){var r=i.shift();r.subscription.unsubscribe(),r.buffer=null,r.subscription=null}this.contexts=null,e.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts;t.length>0;){var i=t.shift();this.destination.next(i.buffer),i.subscription.unsubscribe(),i.buffer=null,i.subscription=null}this.contexts=null,e.prototype._complete.call(this)},t.prototype.notifyNext=function(e,t){e?this.closeBuffer(e):this.openBuffer(t)},t.prototype.notifyComplete=function(e){this.closeBuffer(e.context)},t.prototype.openBuffer=function(e){try{var t=this.closingSelector.call(this,e);t&&this.trySubscribe(t)}catch(dp){this._error(dp)}},t.prototype.closeBuffer=function(e){var t=this.contexts;if(t&&e){var i=e.buffer,r=e.subscription;this.destination.next(i),t.splice(t.indexOf(e),1),this.remove(r),r.unsubscribe()}},t.prototype.trySubscribe=function(e){var t=this.contexts,i=new P.a,r={buffer:[],subscription:i};t.push(r);var n=Object(A.a)(this,e,r);!n||n.closed?this.closeBuffer(r):(n.context=r,this.add(n),i.add(n))},t}(M.a);function N(e){return function(t){return t.lift(new x(e))}}var x=function(){function e(e){this.closingSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new L(e,this.closingSelector))},e}(),L=function(e){function t(t,i){var r=e.call(this,t)||this;return r.closingSelector=i,r.subscribing=false,r.openBuffer(),r}return r.a(t,e),t.prototype._next=function(e){this.buffer.push(e)},t.prototype._complete=function(){var t=this.buffer;t&&this.destination.next(t),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.buffer=void 0,this.subscribing=false},t.prototype.notifyNext=function(){this.openBuffer()},t.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},t.prototype.openBuffer=function(){var e=this.closingSubscription;e&&(this.remove(e),e.unsubscribe());var t,i=this.buffer;this.buffer&&this.destination.next(i),this.buffer=[];try{t=(0,this.closingSelector)()}catch(dp){return this.error(dp)}e=new P.a,this.closingSubscription=e,this.add(e),this.subscribing=true,e.add(Object(n.c)(t,new n.a(this))),this.subscribing=false},t}(n.b);function k(e){return function(t){var i=new F(e),r=t.lift(i);return i.caught=r}}var F=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new U(e,this.selector,this.caught))},e}(),U=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.selector=i,n.caught=r,n}return r.a(t,e),t.prototype.error=function(t){if(!this.isStopped){var i=void 0;try{i=this.selector(t,this.caught)}catch(o){return void e.prototype.error.call(this,o)}this._unsubscribeAndRecycle();var r=new n.a(this);this.add(r);var s=Object(n.c)(i,r);s!==r&&this.add(s)}},t}(n.b),j=i(84);function W(e){return function(t){return t.lift(new j.a(e))}}var B=i(16),H=i(23);function V(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=null;return"function"==typeof e[e.length-1]&&(i=e.pop()),1===e.length&&Object(B.a)(e[0])&&(e=e[0].slice()),function(t){return t.lift.call(Object(H.a)([t].concat(e)),new j.a(i))}}var Y=i(58);function G(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(Y.a.apply(void 0,[t].concat(e)))}}var $=i(114),z=i(49);function J(e,t){return Object(z.b)(e,t,1)}function q(e,t){return J((function(){return e}),t)}function K(e){return function(t){return t.lift(new X(e,t))}}var X=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Q(e,this.predicate,this.source))},e}(),Q=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.predicate=i,n.source=r,n.count=0,n.index=0,n}return r.a(t,e),t.prototype._next=function(e){this.predicate?this._tryPredicate(e):this.count++},t.prototype._tryPredicate=function(e){var t;try{t=this.predicate(e,this.index++,this.source)}catch(dp){return void this.destination.error(dp)}t&&this.count++},t.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()},t}(p.a);function Z(e){return function(t){return t.lift(new ee(e))}}var ee=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new te(e,this.durationSelector))},e}(),te=function(e){function t(t,i){var r=e.call(this,t)||this;return r.durationSelector=i,r.hasValue=false,r}return r.a(t,e),t.prototype._next=function(e){try{var t=this.durationSelector.call(this,e);t&&this._tryNext(e,t)}catch(dp){this.destination.error(dp)}},t.prototype._complete=function(){this.emitValue(),this.destination.complete()},t.prototype._tryNext=function(e,t){var i=this.durationSubscription;this.value=e,this.hasValue=true,i&&(i.unsubscribe(),this.remove(i)),(i=Object(n.c)(t,new n.a(this)))&&!i.closed&&this.add(this.durationSubscription=i)},t.prototype.notifyNext=function(){this.emitValue()},t.prototype.notifyComplete=function(){this.emitValue()},t.prototype.emitValue=function(){if(this.hasValue){var t=this.value,i=this.durationSubscription;i&&(this.durationSubscription=void 0,i.unsubscribe(),this.remove(i)),this.value=void 0,this.hasValue=false,e.prototype._next.call(this,t)}},t}(n.b);function ie(e,t){return void 0===t&&(t=c.a),function(i){return i.lift(new re(e,t))}}var re=function(){function e(e,t){this.dueTime=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new ne(e,this.dueTime,this.scheduler))},e}(),ne=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.dueTime=i,n.scheduler=r,n.debouncedSubscription=null,n.lastValue=null,n.hasValue=false,n}return r.a(t,e),t.prototype._next=function(e){this.clearDebounce(),this.lastValue=e,this.hasValue=true,this.add(this.debouncedSubscription=this.scheduler.schedule(se,this.dueTime,this))},t.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},t.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var e=this.lastValue;this.lastValue=null,this.hasValue=false,this.destination.next(e)}},t.prototype.clearDebounce=function(){var e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)},t}(p.a);function se(e){e.debouncedNext()}function oe(e){return void 0===e&&(e=null),function(t){return t.lift(new ae(e))}}var ae=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new ce(e,this.defaultValue))},e}(),ce=function(e){function t(t,i){var r=e.call(this,t)||this;return r.defaultValue=i,r.isEmpty=true,r}return r.a(t,e),t.prototype._next=function(e){this.isEmpty=false,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(p.a);function le(e){return e instanceof Date&&!isNaN(+e)}var de=i(33);function ue(e,t){void 0===t&&(t=c.a);var i=le(e)?+e-t.now():Math.abs(e);return function(e){return e.lift(new he(i,t))}}var he=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new fe(e,this.delay,this.scheduler))},e}(),fe=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.delay=i,n.scheduler=r,n.queue=[],n.active=false,n.errored=false,n}return r.a(t,e),t.dispatch=function(e){for(var t=e.source,i=t.queue,r=e.scheduler,n=e.destination;i.length>0&&i[0].time-r.now()<=0;)i.shift().notification.observe(n);if(i.length>0){var s=Math.max(0,i[0].time-r.now());this.schedule(e,s)}else this.unsubscribe(),t.active=false},t.prototype._schedule=function(e){this.active=true,this.destination.add(e.schedule(t.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},t.prototype.scheduleNotification=function(e){if(true!==this.errored){var t=this.scheduler,i=new pe(t.now()+this.delay,e);this.queue.push(i),false===this.active&&this._schedule(t)}},t.prototype._next=function(e){this.scheduleNotification(de.a.createNext(e))},t.prototype._error=function(e){this.errored=true,this.queue=[],this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.scheduleNotification(de.a.createComplete()),this.unsubscribe()},t}(p.a),pe=function(){return function(e,t){this.time=e,this.notification=t}}(),ge=i(5);function me(e,t){return t?function(i){return new be(i,t).lift(new ve(e))}:function(t){return t.lift(new ve(e))}}var ve=function(){function e(e){this.delayDurationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new Se(e,this.delayDurationSelector))},e}(),Se=function(e){function t(t,i){var r=e.call(this,t)||this;return r.delayDurationSelector=i,r.completed=false,r.delayNotifierSubscriptions=[],r.index=0,r}return r.a(t,e),t.prototype.notifyNext=function(e,t,i,r,n){this.destination.next(e),this.removeSubscription(n),this.tryComplete()},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype.notifyComplete=function(e){var t=this.removeSubscription(e);t&&this.destination.next(t),this.tryComplete()},t.prototype._next=function(e){var t=this.index++;try{var i=this.delayDurationSelector(e,t);i&&this.tryDelay(i,e)}catch(dp){this.destination.error(dp)}},t.prototype._complete=function(){this.completed=true,this.tryComplete(),this.unsubscribe()},t.prototype.removeSubscription=function(e){e.unsubscribe();var t=this.delayNotifierSubscriptions.indexOf(e);return-1!==t&&this.delayNotifierSubscriptions.splice(t,1),e.outerValue},t.prototype.tryDelay=function(e,t){var i=Object(A.a)(this,e,t);i&&!i.closed&&(this.destination.add(i),this.delayNotifierSubscriptions.push(i))},t.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},t}(M.a),be=function(e){function t(t,i){var r=e.call(this)||this;return r.source=t,r.subscriptionDelay=i,r}return r.a(t,e),t.prototype._subscribe=function(e){this.subscriptionDelay.subscribe(new ye(e,this.source))},t}(ge.a),ye=function(e){function t(t,i){var r=e.call(this)||this;return r.parent=t,r.source=i,r.sourceSubscribed=false,r}return r.a(t,e),t.prototype._next=function(e){this.subscribeToSource()},t.prototype._error=function(e){this.unsubscribe(),this.parent.error(e)},t.prototype._complete=function(){this.unsubscribe(),this.subscribeToSource()},t.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=true,this.unsubscribe(),this.source.subscribe(this.parent))},t}(p.a);function Ce(){return function(e){return e.lift(new we)}}var we=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new _e(e))},e}(),_e=function(e){function t(t){return e.call(this,t)||this}return r.a(t,e),t.prototype._next=function(e){e.observe(this.destination)},t}(p.a);function Ee(e,t){return function(i){return i.lift(new Te(e,t))}}var Te=function(){function e(e,t){this.keySelector=e,this.flushes=t}return e.prototype.call=function(e,t){return t.subscribe(new Ie(e,this.keySelector,this.flushes))},e}(),Ie=function(e){function t(t,i,r){var s=e.call(this,t)||this;return s.keySelector=i,s.values=new Set,r&&s.add(Object(n.c)(r,new n.a(s))),s}return r.a(t,e),t.prototype.notifyNext=function(){this.values.clear()},t.prototype.notifyError=function(e){this._error(e)},t.prototype._next=function(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)},t.prototype._useKeySelector=function(e){var t,i=this.destination;try{t=this.keySelector(e)}catch(dp){return void i.error(dp)}this._finalizeNext(t,e)},t.prototype._finalizeNext=function(e,t){var i=this.values;i.has(e)||(i.add(e),this.destination.next(t))},t}(n.b);function Pe(e,t){return function(i){return i.lift(new Ae(e,t))}}var Ae=function(){function e(e,t){this.compare=e,this.keySelector=t}return e.prototype.call=function(e,t){return t.subscribe(new Me(e,this.compare,this.keySelector))},e}(),Me=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.keySelector=r,n.hasKey=false,"function"==typeof i&&(n.compare=i),n}return r.a(t,e),t.prototype.compare=function(e,t){return e===t},t.prototype._next=function(e){var t;try{var i=this.keySelector;t=i?i(e):e}catch(dp){return this.destination.error(dp)}var r=false;if(this.hasKey)try{r=(0,this.compare)(this.key,t)}catch(dp){return this.destination.error(dp)}else this.hasKey=true;r||(this.key=t,this.destination.next(e))},t}(p.a);function De(e,t){return Pe((function(i,r){return t?t(i[e],r[e]):i[e]===r[e]}))}var Re=i(44),Oe=i(32),Ne=i(48);function xe(e){return void 0===e&&(e=Fe),function(t){return t.lift(new Le(e))}}var Le=function(){function e(e){this.errorFactory=e}return e.prototype.call=function(e,t){return t.subscribe(new ke(e,this.errorFactory))},e}(),ke=function(e){function t(t,i){var r=e.call(this,t)||this;return r.errorFactory=i,r.hasValue=false,r}return r.a(t,e),t.prototype._next=function(e){this.hasValue=true,this.destination.next(e)},t.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var e=void 0;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)},t}(p.a);function Fe(){return new Ne.a}var Ue=i(22);function je(e){return function(t){return 0===e?Object(Ue.b)():t.lift(new We(e))}}var We=function(){function e(e){if(this.total=e,this.total<0)throw new Re.a}return e.prototype.call=function(e,t){return t.subscribe(new Be(e,this.total))},e}(),Be=function(e){function t(t,i){var r=e.call(this,t)||this;return r.total=i,r.count=0,r}return r.a(t,e),t.prototype._next=function(e){var t=this.total,i=++this.count;i<=t&&(this.destination.next(e),i===t&&(this.destination.complete(),this.unsubscribe()))},t}(p.a);function He(e,t){if(e<0)throw new Re.a;var i=arguments.length>=2;return function(r){return r.pipe(Object(Oe.a)((function(t,i){return i===e})),je(1),i?oe(t):xe((function(){return new Re.a})))}}var Ve=i(64);function Ye(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return Object(Y.a)(t,Ve.a.apply(void 0,e))}}function Ge(e,t){return function(i){return i.lift(new $e(e,t,i))}}var $e=function(){function e(e,t,i){this.predicate=e,this.thisArg=t,this.source=i}return e.prototype.call=function(e,t){return t.subscribe(new ze(e,this.predicate,this.thisArg,this.source))},e}(),ze=function(e){function t(t,i,r,n){var s=e.call(this,t)||this;return s.predicate=i,s.thisArg=r,s.source=n,s.index=0,s.thisArg=r||s,s}return r.a(t,e),t.prototype.notifyComplete=function(e){this.destination.next(e),this.destination.complete()},t.prototype._next=function(e){var t=false;try{t=this.predicate.call(this.thisArg,e,this.index++,this.source)}catch(dp){return void this.destination.error(dp)}t||this.notifyComplete(false)},t.prototype._complete=function(){this.notifyComplete(true)},t}(p.a);function Je(){return function(e){return e.lift(new qe)}}var qe=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Ke(e))},e}(),Ke=function(e){function t(t){var i=e.call(this,t)||this;return i.hasCompleted=false,i.hasSubscription=false,i}return r.a(t,e),t.prototype._next=function(e){this.hasSubscription||(this.hasSubscription=true,this.add(Object(n.c)(e,new n.a(this))))},t.prototype._complete=function(){this.hasCompleted=true,this.hasSubscription||this.destination.complete()},t.prototype.notifyComplete=function(){this.hasSubscription=false,this.hasCompleted&&this.destination.complete()},t}(n.b),Xe=i(20);function Qe(e,t){return t?function(i){return i.pipe(Qe((function(i,r){return Object(H.a)(e(i,r)).pipe(Object(Xe.a)((function(e,n){return t(i,e,r,n)})))})))}:function(t){return t.lift(new Ze(e))}}var Ze=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new et(e,this.project))},e}(),et=function(e){function t(t,i){var r=e.call(this,t)||this;return r.project=i,r.hasSubscription=false,r.hasCompleted=false,r.index=0,r}return r.a(t,e),t.prototype._next=function(e){this.hasSubscription||this.tryNext(e)},t.prototype.tryNext=function(e){var t,i=this.index++;try{t=this.project(e,i)}catch(dp){return void this.destination.error(dp)}this.hasSubscription=true,this._innerSub(t)},t.prototype._innerSub=function(e){var t=new n.a(this),i=this.destination;i.add(t);var r=Object(n.c)(e,t);r!==t&&i.add(r)},t.prototype._complete=function(){this.hasCompleted=true,this.hasSubscription||this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.hasSubscription=false,this.hasCompleted&&this.destination.complete()},t}(n.b);function tt(e,t,i){return void 0===t&&(t=Number.POSITIVE_INFINITY),t=(t||0)<1?Number.POSITIVE_INFINITY:t,function(r){return r.lift(new it(e,t,i))}}var it=function(){function e(e,t,i){this.project=e,this.concurrent=t,this.scheduler=i}return e.prototype.call=function(e,t){return t.subscribe(new rt(e,this.project,this.concurrent,this.scheduler))},e}(),rt=function(e){function t(t,i,r,n){var s=e.call(this,t)||this;return s.project=i,s.concurrent=r,s.scheduler=n,s.index=0,s.active=0,s.hasCompleted=false,r<Number.POSITIVE_INFINITY&&(s.buffer=[]),s}return r.a(t,e),t.dispatch=function(e){var t=e.subscriber,i=e.result,r=e.value,n=e.index;t.subscribeToProjection(i,r,n)},t.prototype._next=function(e){var i=this.destination;if(i.closed)this._complete();else{var r=this.index++;if(this.active<this.concurrent){i.next(e);try{var n=(0,this.project)(e,r);if(this.scheduler){var s={subscriber:this,result:n,value:e,index:r};this.destination.add(this.scheduler.schedule(t.dispatch,0,s))}else this.subscribeToProjection(n,e,r)}catch(o){i.error(o)}}else this.buffer.push(e)}},t.prototype.subscribeToProjection=function(e,t,i){this.active++,this.destination.add(Object(n.c)(e,new n.a(this)))},t.prototype._complete=function(){this.hasCompleted=true,this.hasCompleted&&0===this.active&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this._next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e&&e.length>0&&this._next(e.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},t}(n.b);function nt(e){return function(t){return t.lift(new st(e))}}var st=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new ot(e,this.callback))},e}(),ot=function(e){function t(t,i){var r=e.call(this,t)||this;return r.add(new P.a(i)),r}return r.a(t,e),t}(p.a);function at(e,t){if("function"!=typeof e)throw new TypeError("predicate is not a function");return function(i){return i.lift(new ct(e,i,false,t))}}var ct=function(){function e(e,t,i,r){this.predicate=e,this.source=t,this.yieldIndex=i,this.thisArg=r}return e.prototype.call=function(e,t){return t.subscribe(new lt(e,this.predicate,this.source,this.yieldIndex,this.thisArg))},e}(),lt=function(e){function t(t,i,r,n,s){var o=e.call(this,t)||this;return o.predicate=i,o.source=r,o.yieldIndex=n,o.thisArg=s,o.index=0,o}return r.a(t,e),t.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete(),this.unsubscribe()},t.prototype._next=function(e){var t=this.predicate,i=this.thisArg,r=this.index++;try{t.call(i||this,e,r,this.source)&&this.notifyComplete(this.yieldIndex?r:e)}catch(dp){this.destination.error(dp)}},t.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)},t}(p.a);function dt(e,t){return function(i){return i.lift(new ct(e,i,true,t))}}var ut=i(29);function ht(e,t){var i=arguments.length>=2;return function(r){return r.pipe(e?Object(Oe.a)((function(t,i){return e(t,i,r)})):ut.a,je(1),i?oe(t):xe((function(){return new Ne.a})))}}var ft=i(102);function pt(){return function(e){return e.lift(new gt)}}var gt=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new mt(e))},e}(),mt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.a(t,e),t.prototype._next=function(e){},t}(p.a);function vt(){return function(e){return e.lift(new St)}}var St=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new bt(e))},e}(),bt=function(e){function t(t){return e.call(this,t)||this}return r.a(t,e),t.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete()},t.prototype._next=function(e){this.notifyComplete(false)},t.prototype._complete=function(){this.notifyComplete(true)},t}(p.a);function yt(e){return function(t){return 0===e?Object(Ue.b)():t.lift(new Ct(e))}}var Ct=function(){function e(e){if(this.total=e,this.total<0)throw new Re.a}return e.prototype.call=function(e,t){return t.subscribe(new wt(e,this.total))},e}(),wt=function(e){function t(t,i){var r=e.call(this,t)||this;return r.total=i,r.ring=new Array,r.count=0,r}return r.a(t,e),t.prototype._next=function(e){var t=this.ring,i=this.total,r=this.count++;t.length<i?t.push(e):t[r%i]=e},t.prototype._complete=function(){var e=this.destination,t=this.count;if(t>0)for(var i=this.count>=this.total?this.total:this.count,r=this.ring,n=0;n<i;n++){var s=t++%i;e.next(r[s])}e.complete()},t}(p.a);function _t(e,t){var i=arguments.length>=2;return function(r){return r.pipe(e?Object(Oe.a)((function(t,i){return e(t,i,r)})):ut.a,yt(1),i?oe(t):xe((function(){return new Ne.a})))}}function Et(e){return function(t){return t.lift(new Tt(e))}}var Tt=function(){function e(e){this.value=e}return e.prototype.call=function(e,t){return t.subscribe(new It(e,this.value))},e}(),It=function(e){function t(t,i){var r=e.call(this,t)||this;return r.value=i,r}return r.a(t,e),t.prototype._next=function(e){this.destination.next(this.value)},t}(p.a);function Pt(){return function(e){return e.lift(new At)}}var At=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Mt(e))},e}(),Mt=function(e){function t(t){return e.call(this,t)||this}return r.a(t,e),t.prototype._next=function(e){this.destination.next(de.a.createNext(e))},t.prototype._error=function(e){var t=this.destination;t.next(de.a.createError(e)),t.complete()},t.prototype._complete=function(){var e=this.destination;e.next(de.a.createComplete()),e.complete()},t}(p.a);function Dt(e,t){var i=false;return arguments.length>=2&&(i=true),function(r){return r.lift(new Rt(e,t,i))}}var Rt=function(){function e(e,t,i){void 0===i&&(i=false),this.accumulator=e,this.seed=t,this.hasSeed=i}return e.prototype.call=function(e,t){return t.subscribe(new Ot(e,this.accumulator,this.seed,this.hasSeed))},e}(),Ot=function(e){function t(t,i,r,n){var s=e.call(this,t)||this;return s.accumulator=i,s._seed=r,s.hasSeed=n,s.index=0,s}return r.a(t,e),Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=true,this._seed=e},enumerable:true,configurable:true}),t.prototype._next=function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)},t.prototype._tryNext=function(e){var t,i=this.index++;try{t=this.accumulator(this.seed,e,i)}catch(dp){this.destination.error(dp)}this.seed=t,this.destination.next(t)},t}(p.a),Nt=i(72);function xt(e,t){return arguments.length>=2?function(i){return Object(Nt.a)(Dt(e,t),yt(1),oe(t))(i)}:function(t){return Object(Nt.a)(Dt((function(t,i,r){return e(t,i,r+1)})),yt(1))(t)}}function Lt(e){return xt("function"==typeof e?function(t,i){return e(t,i)>0?t:i}:function(e,t){return e>t?e:t})}var kt=i(115);function Ft(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(kt.a.apply(void 0,[t].concat(e)))}}var Ut=i(85);function jt(e,t,i){return void 0===i&&(i=Number.POSITIVE_INFINITY),"function"==typeof t?Object(z.b)((function(){return e}),t,i):("number"==typeof t&&(i=t),Object(z.b)((function(){return e}),i))}function Wt(e,t,i){return void 0===i&&(i=Number.POSITIVE_INFINITY),function(r){return r.lift(new Bt(e,t,i))}}var Bt=function(){function e(e,t,i){this.accumulator=e,this.seed=t,this.concurrent=i}return e.prototype.call=function(e,t){return t.subscribe(new Ht(e,this.accumulator,this.seed,this.concurrent))},e}(),Ht=function(e){function t(t,i,r,n){var s=e.call(this,t)||this;return s.accumulator=i,s.acc=r,s.concurrent=n,s.hasValue=false,s.hasCompleted=false,s.buffer=[],s.active=0,s.index=0,s}return r.a(t,e),t.prototype._next=function(e){if(this.active<this.concurrent){var t=this.index++,i=this.destination,r=void 0;try{r=(0,this.accumulator)(this.acc,e,t)}catch(n){return i.error(n)}this.active++,this._innerSub(r)}else this.buffer.push(e)},t.prototype._innerSub=function(e){var t=new n.a(this),i=this.destination;i.add(t);var r=Object(n.c)(e,t);r!==t&&i.add(r)},t.prototype._complete=function(){this.hasCompleted=true,0===this.active&&0===this.buffer.length&&(false===this.hasValue&&this.destination.next(this.acc),this.destination.complete()),this.unsubscribe()},t.prototype.notifyNext=function(e){var t=this.destination;this.acc=e,this.hasValue=true,t.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&(false===this.hasValue&&this.destination.next(this.acc),this.destination.complete())},t}(n.b);function Vt(e){return xt("function"==typeof e?function(t,i){return e(t,i)<0?t:i}:function(e,t){return e<t?e:t})}var Yt=i(111);function Gt(e,t){return function(i){var r;if(r="function"==typeof e?e:function(){return e},"function"==typeof t)return i.lift(new $t(r,t));var n=Object.create(i,Yt.b);return n.source=i,n.subjectFactory=r,n}}var $t=function(){function e(e,t){this.subjectFactory=e,this.selector=t}return e.prototype.call=function(e,t){var i=this.selector,r=this.subjectFactory(),n=i(r).subscribe(e);return n.add(t.subscribe(r)),n},e}(),zt=i(112);function Jt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 1===e.length&&Object(B.a)(e[0])&&(e=e[0]),function(t){return t.lift(new qt(e))}}var qt=function(){function e(e){this.nextSources=e}return e.prototype.call=function(e,t){return t.subscribe(new Kt(e,this.nextSources))},e}(),Kt=function(e){function t(t,i){var r=e.call(this,t)||this;return r.destination=t,r.nextSources=i,r}return r.a(t,e),t.prototype.notifyError=function(){this.subscribeToNextSource()},t.prototype.notifyComplete=function(){this.subscribeToNextSource()},t.prototype._error=function(e){this.subscribeToNextSource(),this.unsubscribe()},t.prototype._complete=function(){this.subscribeToNextSource(),this.unsubscribe()},t.prototype.subscribeToNextSource=function(){var e=this.nextSources.shift();if(e){var t=new n.a(this),i=this.destination;i.add(t);var r=Object(n.c)(e,t);r!==t&&i.add(r)}else this.destination.complete()},t}(n.b);function Xt(){return function(e){return e.lift(new Qt)}}var Qt=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Zt(e))},e}(),Zt=function(e){function t(t){var i=e.call(this,t)||this;return i.hasPrev=false,i}return r.a(t,e),t.prototype._next=function(e){var t;this.hasPrev?t=[this.prev,e]:this.hasPrev=true,this.prev=e,t&&this.destination.next(t)},t}(p.a),ei=i(127);function ti(e,t){return function(i){return[Object(Oe.a)(e,t)(i),Object(Oe.a)(Object(ei.a)(e,t))(i)]}}function ii(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=e.length;if(0===i)throw new Error("list of properties cannot be empty.");return function(t){return Object(Xe.a)(ri(e,i))(t)}}function ri(e,t){return function(i){for(var r=i,n=0;n<t;n++){var s=null!=r?r[e[n]]:void 0;if(void 0===s)return;r=s}return r}}var ni=i(12);function si(e){return e?Gt((function(){return new ni.a}),e):Gt(new ni.a)}var oi=i(99);function ai(e){return function(t){return Gt(new oi.a(e))(t)}}var ci=i(52);function li(){return function(e){return Gt(new ci.a)(e)}}var di=i(82);function ui(e,t,i,r){i&&"function"!=typeof i&&(r=i);var n="function"==typeof i?i:void 0,s=new di.a(e,t,r);return function(e){return Gt((function(){return s}),n)(e)}}var hi=i(116);function fi(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return 1===e.length&&Object(B.a)(e[0])&&(e=e[0]),t.lift.call(hi.a.apply(void 0,[t].concat(e)))}}function pi(e){return void 0===e&&(e=-1),function(t){return 0===e?Object(Ue.b)():e<0?t.lift(new gi(-1,t)):t.lift(new gi(e-1,t))}}var gi=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new mi(e,this.count,this.source))},e}(),mi=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.count=i,n.source=r,n}return r.a(t,e),t.prototype.complete=function(){if(!this.isStopped){var t=this.source,i=this.count;if(0===i)return e.prototype.complete.call(this);i>-1&&(this.count=i-1),t.subscribe(this._unsubscribeAndRecycle())}},t}(p.a);function vi(e){return function(t){return t.lift(new Si(e))}}var Si=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new bi(e,this.notifier,t))},e}(),bi=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.notifier=i,n.source=r,n.sourceIsBeingSubscribedTo=true,n}return r.a(t,e),t.prototype.notifyNext=function(){this.sourceIsBeingSubscribedTo=true,this.source.subscribe(this)},t.prototype.notifyComplete=function(){if(false===this.sourceIsBeingSubscribedTo)return e.prototype.complete.call(this)},t.prototype.complete=function(){if(this.sourceIsBeingSubscribedTo=false,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return e.prototype.complete.call(this);this._unsubscribeAndRecycle(),this.notifications.next(void 0)}},t.prototype._unsubscribe=function(){var e=this.notifications,t=this.retriesSubscription;e&&(e.unsubscribe(),this.notifications=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},t.prototype._unsubscribeAndRecycle=function(){var t=this._unsubscribe;return this._unsubscribe=null,e.prototype._unsubscribeAndRecycle.call(this),this._unsubscribe=t,this},t.prototype.subscribeToRetries=function(){var t;this.notifications=new ni.a;try{t=(0,this.notifier)(this.notifications)}catch(i){return e.prototype.complete.call(this)}this.retries=t,this.retriesSubscription=Object(n.c)(t,new n.a(this))},t}(n.b);function yi(e){return void 0===e&&(e=-1),function(t){return t.lift(new Ci(e,t))}}var Ci=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new wi(e,this.count,this.source))},e}(),wi=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.count=i,n.source=r,n}return r.a(t,e),t.prototype.error=function(t){if(!this.isStopped){var i=this.source,r=this.count;if(0===r)return e.prototype.error.call(this,t);r>-1&&(this.count=r-1),i.subscribe(this._unsubscribeAndRecycle())}},t}(p.a);function _i(e){return function(t){return t.lift(new Ei(e,t))}}var Ei=function(){function e(e,t){this.notifier=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Ti(e,this.notifier,this.source))},e}(),Ti=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.notifier=i,n.source=r,n}return r.a(t,e),t.prototype.error=function(t){if(!this.isStopped){var i=this.errors,r=this.retries,s=this.retriesSubscription;if(r)this.errors=void 0,this.retriesSubscription=void 0;else{i=new ni.a;try{r=(0,this.notifier)(i)}catch(o){return e.prototype.error.call(this,o)}s=Object(n.c)(r,new n.a(this))}this._unsubscribeAndRecycle(),this.errors=i,this.retries=r,this.retriesSubscription=s,i.next(t)}},t.prototype._unsubscribe=function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},t.prototype.notifyNext=function(){var e=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=e,this.source.subscribe(this)},t}(n.b),Ii=i(81);function Pi(e){return function(t){return t.lift(new Ai(e))}}var Ai=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var i=new Mi(e),r=t.subscribe(i);return r.add(Object(n.c)(this.notifier,new n.a(i))),r},e}(),Mi=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasValue=false,t}return r.a(t,e),t.prototype._next=function(e){this.value=e,this.hasValue=true},t.prototype.notifyNext=function(){this.emitValue()},t.prototype.notifyComplete=function(){this.emitValue()},t.prototype.emitValue=function(){this.hasValue&&(this.hasValue=false,this.destination.next(this.value))},t}(n.b);function Di(e,t){return void 0===t&&(t=c.a),function(i){return i.lift(new Ri(e,t))}}var Ri=function(){function e(e,t){this.period=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new Oi(e,this.period,this.scheduler))},e}(),Oi=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.period=i,n.scheduler=r,n.hasValue=false,n.add(r.schedule(Ni,i,{subscriber:n,period:i})),n}return r.a(t,e),t.prototype._next=function(e){this.lastValue=e,this.hasValue=true},t.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=false,this.destination.next(this.lastValue))},t}(p.a);function Ni(e){var t=e.subscriber,i=e.period;t.notifyNext(),this.schedule(e,i)}function xi(e,t){return function(i){return i.lift(new Li(e,t))}}var Li=function(){function e(e,t){this.compareTo=e,this.comparator=t}return e.prototype.call=function(e,t){return t.subscribe(new ki(e,this.compareTo,this.comparator))},e}(),ki=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.compareTo=i,n.comparator=r,n._a=[],n._b=[],n._oneComplete=false,n.destination.add(i.subscribe(new Fi(t,n))),n}return r.a(t,e),t.prototype._next=function(e){this._oneComplete&&0===this._b.length?this.emit(false):(this._a.push(e),this.checkValues())},t.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=true,this.unsubscribe()},t.prototype.checkValues=function(){for(var e=this._a,t=this._b,i=this.comparator;e.length>0&&t.length>0;){var r=e.shift(),n=t.shift(),s=false;try{s=i?i(r,n):r===n}catch(o){this.destination.error(o)}s||this.emit(false)}},t.prototype.emit=function(e){var t=this.destination;t.next(e),t.complete()},t.prototype.nextB=function(e){this._oneComplete&&0===this._a.length?this.emit(false):(this._b.push(e),this.checkValues())},t.prototype.completeB=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=true},t}(p.a),Fi=function(e){function t(t,i){var r=e.call(this,t)||this;return r.parent=i,r}return r.a(t,e),t.prototype._next=function(e){this.parent.nextB(e)},t.prototype._error=function(e){this.parent.error(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.completeB(),this.unsubscribe()},t}(p.a);function Ui(){return new ni.a}function ji(){return function(e){return Object(Ii.a)()(Gt(Ui)(e))}}function Wi(e,t,i){var r;return r=e&&"object"==typeof e?e:{bufferSize:e,windowTime:t,refCount:false,scheduler:i},function(e){return e.lift(function(e){var t,i,r=e.bufferSize,n=void 0===r?Number.POSITIVE_INFINITY:r,s=e.windowTime,o=void 0===s?Number.POSITIVE_INFINITY:s,a=e.refCount,c=e.scheduler,l=0,d=false,u=false;return function(e){var r;l++,!t||d?(d=false,t=new di.a(n,o,c),r=t.subscribe(this),i=e.subscribe({next:function(e){t.next(e)},error:function(e){d=true,t.error(e)},complete:function(){u=true,i=void 0,t.complete()}})):r=t.subscribe(this),this.add((function(){l--,r.unsubscribe(),i&&!u&&a&&0===l&&(i.unsubscribe(),i=void 0,t=void 0)}))}}(r))}}function Bi(e){return function(t){return t.lift(new Hi(e,t))}}var Hi=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Vi(e,this.predicate,this.source))},e}(),Vi=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.predicate=i,n.source=r,n.seenValue=false,n.index=0,n}return r.a(t,e),t.prototype.applySingleValue=function(e){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=true,this.singleValue=e)},t.prototype._next=function(e){var t=this.index++;this.predicate?this.tryNext(e,t):this.applySingleValue(e)},t.prototype.tryNext=function(e,t){try{this.predicate(e,t,this.source)&&this.applySingleValue(e)}catch(dp){this.destination.error(dp)}},t.prototype._complete=function(){var e=this.destination;this.index>0?(e.next(this.seenValue?this.singleValue:void 0),e.complete()):e.error(new Ne.a)},t}(p.a);function Yi(e){return function(t){return t.lift(new Gi(e))}}var Gi=function(){function e(e){this.total=e}return e.prototype.call=function(e,t){return t.subscribe(new $i(e,this.total))},e}(),$i=function(e){function t(t,i){var r=e.call(this,t)||this;return r.total=i,r.count=0,r}return r.a(t,e),t.prototype._next=function(e){++this.count>this.total&&this.destination.next(e)},t}(p.a);function zi(e){return function(t){return t.lift(new Ji(e))}}var Ji=function(){function e(e){if(this._skipCount=e,this._skipCount<0)throw new Re.a}return e.prototype.call=function(e,t){return 0===this._skipCount?t.subscribe(new p.a(e)):t.subscribe(new qi(e,this._skipCount))},e}(),qi=function(e){function t(t,i){var r=e.call(this,t)||this;return r._skipCount=i,r._count=0,r._ring=new Array(i),r}return r.a(t,e),t.prototype._next=function(e){var t=this._skipCount,i=this._count++;if(i<t)this._ring[i]=e;else{var r=i%t,n=this._ring,s=n[r];n[r]=e,this.destination.next(s)}},t}(p.a);function Ki(e){return function(t){return t.lift(new Xi(e))}}var Xi=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new Qi(e,this.notifier))},e}(),Qi=function(e){function t(t,i){var r=e.call(this,t)||this;r.hasValue=false;var s=new n.a(r);r.add(s),r.innerSubscription=s;var o=Object(n.c)(i,s);return o!==s&&(r.add(o),r.innerSubscription=o),r}return r.a(t,e),t.prototype._next=function(t){this.hasValue&&e.prototype._next.call(this,t)},t.prototype.notifyNext=function(){this.hasValue=true,this.innerSubscription&&this.innerSubscription.unsubscribe()},t.prototype.notifyComplete=function(){},t}(n.b);function Zi(e){return function(t){return t.lift(new er(e))}}var er=function(){function e(e){this.predicate=e}return e.prototype.call=function(e,t){return t.subscribe(new tr(e,this.predicate))},e}(),tr=function(e){function t(t,i){var r=e.call(this,t)||this;return r.predicate=i,r.skipping=true,r.index=0,r}return r.a(t,e),t.prototype._next=function(e){var t=this.destination;this.skipping&&this.tryCallPredicate(e),this.skipping||t.next(e)},t.prototype.tryCallPredicate=function(e){try{var t=this.predicate(e,this.index++);this.skipping=Boolean(t)}catch(dp){this.destination.error(dp)}},t}(p.a);function ir(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=e[e.length-1];return Object(b.a)(i)?(e.pop(),function(t){return Object(Y.a)(e,t,i)}):function(t){return Object(Y.a)(e,t)}}var rr=i(73),nr=i(54),sr=function(e){function t(t,i,r){void 0===i&&(i=0),void 0===r&&(r=rr.a);var n=e.call(this)||this;return n.source=t,n.delayTime=i,n.scheduler=r,(!Object(nr.a)(i)||i<0)&&(n.delayTime=0),r&&"function"==typeof r.schedule||(n.scheduler=rr.a),n}return r.a(t,e),t.create=function(e,i,r){return void 0===i&&(i=0),void 0===r&&(r=rr.a),new t(e,i,r)},t.dispatch=function(e){var t=e.source,i=e.subscriber;return this.add(t.subscribe(i))},t.prototype._subscribe=function(e){var i=this.delayTime,r=this.source;return this.scheduler.schedule(t.dispatch,i,{source:r,subscriber:e})},t}(ge.a);function or(e,t){return void 0===t&&(t=0),function(i){return i.lift(new ar(e,t))}}var ar=function(){function e(e,t){this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return new sr(t,this.delay,this.scheduler).subscribe(e)},e}();function cr(e,t){return"function"==typeof t?function(i){return i.pipe(cr((function(i,r){return Object(H.a)(e(i,r)).pipe(Object(Xe.a)((function(e,n){return t(i,e,r,n)})))})))}:function(t){return t.lift(new lr(e))}}var lr=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new dr(e,this.project))},e}(),dr=function(e){function t(t,i){var r=e.call(this,t)||this;return r.project=i,r.index=0,r}return r.a(t,e),t.prototype._next=function(e){var t,i=this.index++;try{t=this.project(e,i)}catch(r){return void this.destination.error(r)}this._innerSub(t)},t.prototype._innerSub=function(e){var t=this.innerSubscription;t&&t.unsubscribe();var i=new n.a(this),r=this.destination;r.add(i),this.innerSubscription=Object(n.c)(e,i),this.innerSubscription!==i&&r.add(this.innerSubscription)},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=void 0},t.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e){this.destination.next(e)},t}(n.b);function ur(){return cr(ut.a)}function hr(e,t){return t?cr((function(){return e}),t):cr((function(){return e}))}function fr(e){return function(t){return t.lift(new pr(e))}}var pr=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var i=new gr(e),r=Object(n.c)(this.notifier,new n.a(i));return r&&!i.seenValue?(i.add(r),t.subscribe(i)):i},e}(),gr=function(e){function t(t){var i=e.call(this,t)||this;return i.seenValue=false,i}return r.a(t,e),t.prototype.notifyNext=function(){this.seenValue=true,this.complete()},t.prototype.notifyComplete=function(){},t}(n.b);function mr(e,t){return void 0===t&&(t=false),function(i){return i.lift(new vr(e,t))}}var vr=function(){function e(e,t){this.predicate=e,this.inclusive=t}return e.prototype.call=function(e,t){return t.subscribe(new Sr(e,this.predicate,this.inclusive))},e}(),Sr=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.predicate=i,n.inclusive=r,n.index=0,n}return r.a(t,e),t.prototype._next=function(e){var t,i=this.destination;try{t=this.predicate(e,this.index++)}catch(dp){return void i.error(dp)}this.nextOrComplete(e,t)},t.prototype.nextOrComplete=function(e,t){var i=this.destination;Boolean(t)?i.next(e):(this.inclusive&&i.next(e),i.complete())},t}(p.a),br=i(36),yr=i(45);function Cr(e,t,i){return function(r){return r.lift(new wr(e,t,i))}}var wr=function(){function e(e,t,i){this.nextOrObserver=e,this.error=t,this.complete=i}return e.prototype.call=function(e,t){return t.subscribe(new _r(e,this.nextOrObserver,this.error,this.complete))},e}(),_r=function(e){function t(t,i,r,n){var s=e.call(this,t)||this;return s._tapNext=br.a,s._tapError=br.a,s._tapComplete=br.a,s._tapError=r||br.a,s._tapComplete=n||br.a,Object(yr.a)(i)?(s._context=s,s._tapNext=i):i&&(s._context=i,s._tapNext=i.next||br.a,s._tapError=i.error||br.a,s._tapComplete=i.complete||br.a),s}return r.a(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(dp){return void this.destination.error(dp)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(dp){return void this.destination.error(dp)}return this.destination.complete()},t}(p.a),Er={leading:true,trailing:false};function Tr(e,t){return void 0===t&&(t=Er),function(i){return i.lift(new Ir(e,!!t.leading,!!t.trailing))}}var Ir=function(){function e(e,t,i){this.durationSelector=e,this.leading=t,this.trailing=i}return e.prototype.call=function(e,t){return t.subscribe(new Pr(e,this.durationSelector,this.leading,this.trailing))},e}(),Pr=function(e){function t(t,i,r,n){var s=e.call(this,t)||this;return s.destination=t,s.durationSelector=i,s._leading=r,s._trailing=n,s._hasValue=false,s}return r.a(t,e),t.prototype._next=function(e){this._hasValue=true,this._sendValue=e,this._throttled||(this._leading?this.send():this.throttle(e))},t.prototype.send=function(){var e=this._hasValue,t=this._sendValue;e&&(this.destination.next(t),this.throttle(t)),this._hasValue=false,this._sendValue=void 0},t.prototype.throttle=function(e){var t=this.tryDurationSelector(e);t&&this.add(this._throttled=Object(n.c)(t,new n.a(this)))},t.prototype.tryDurationSelector=function(e){try{return this.durationSelector(e)}catch(dp){return this.destination.error(dp),null}},t.prototype.throttlingDone=function(){var e=this._throttled,t=this._trailing;e&&e.unsubscribe(),this._throttled=void 0,t&&this.send()},t.prototype.notifyNext=function(){this.throttlingDone()},t.prototype.notifyComplete=function(){this.throttlingDone()},t}(n.b);function Ar(e,t,i){return void 0===t&&(t=c.a),void 0===i&&(i=Er),function(r){return r.lift(new Mr(e,t,i.leading,i.trailing))}}var Mr=function(){function e(e,t,i,r){this.duration=e,this.scheduler=t,this.leading=i,this.trailing=r}return e.prototype.call=function(e,t){return t.subscribe(new Dr(e,this.duration,this.scheduler,this.leading,this.trailing))},e}(),Dr=function(e){function t(t,i,r,n,s){var o=e.call(this,t)||this;return o.duration=i,o.scheduler=r,o.leading=n,o.trailing=s,o._hasTrailingValue=false,o._trailingValue=null,o}return r.a(t,e),t.prototype._next=function(e){this.throttled?this.trailing&&(this._trailingValue=e,this._hasTrailingValue=true):(this.add(this.throttled=this.scheduler.schedule(Rr,this.duration,{subscriber:this})),this.leading?this.destination.next(e):this.trailing&&(this._trailingValue=e,this._hasTrailingValue=true))},t.prototype._complete=function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()},t.prototype.clearThrottle=function(){var e=this.throttled;e&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=false),e.unsubscribe(),this.remove(e),this.throttled=null)},t}(p.a);function Rr(e){e.subscriber.clearThrottle()}var Or=i(86);function Nr(e){return void 0===e&&(e=c.a),function(t){return Object(Or.a)((function(){return t.pipe(Dt((function(t,i){var r=t.current;return{value:i,current:e.now(),last:r}}),{current:e.now(),value:void 0,last:void 0}),Object(Xe.a)((function(e){var t=e.current,i=e.last,r=e.value;return new xr(r,t-i)})))}))}}var xr=function(){return function(e,t){this.value=e,this.interval=t}}(),Lr=i(113);function kr(e,t,i){return void 0===i&&(i=c.a),function(r){var n=le(e),s=n?+e-i.now():Math.abs(e);return r.lift(new Fr(s,n,t,i))}}var Fr=function(){function e(e,t,i,r){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=i,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new Ur(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),Ur=function(e){function t(t,i,r,n,s){var o=e.call(this,t)||this;return o.absoluteTimeout=i,o.waitFor=r,o.withObservable=n,o.scheduler=s,o.scheduleTimeout(),o}return r.a(t,e),t.dispatchTimeout=function(e){var t=e.withObservable;e._unsubscribeAndRecycle(),e.add(Object(n.c)(t,new n.a(e)))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},t.prototype._unsubscribe=function(){this.action=void 0,this.scheduler=null,this.withObservable=null},t}(n.b),jr=i(83);function Wr(e,t){return void 0===t&&(t=c.a),kr(e,Object(jr.a)(new Lr.a),t)}function Br(e){return void 0===e&&(e=c.a),Object(Xe.a)((function(t){return new Hr(t,e.now())}))}var Hr=function(){return function(e,t){this.value=e,this.timestamp=t}}();function Vr(e,t,i){return 0===i?[t]:(e.push(t),e)}function Yr(){return xt(Vr,[])}function Gr(e){return function(t){return t.lift(new $r(e))}}var $r=function(){function e(e){this.windowBoundaries=e}return e.prototype.call=function(e,t){var i=new zr(e),r=t.subscribe(i);return r.closed||i.add(Object(n.c)(this.windowBoundaries,new n.a(i))),r},e}(),zr=function(e){function t(t){var i=e.call(this,t)||this;return i.window=new ni.a,t.next(i.window),i}return r.a(t,e),t.prototype.notifyNext=function(){this.openWindow()},t.prototype.notifyError=function(e){this._error(e)},t.prototype.notifyComplete=function(){this._complete()},t.prototype._next=function(e){this.window.next(e)},t.prototype._error=function(e){this.window.error(e),this.destination.error(e)},t.prototype._complete=function(){this.window.complete(),this.destination.complete()},t.prototype._unsubscribe=function(){this.window=null},t.prototype.openWindow=function(){var e=this.window;e&&e.complete();var t=this.destination,i=this.window=new ni.a;t.next(i)},t}(n.b);function Jr(e,t){return void 0===t&&(t=0),function(i){return i.lift(new qr(e,t))}}var qr=function(){function e(e,t){this.windowSize=e,this.startWindowEvery=t}return e.prototype.call=function(e,t){return t.subscribe(new Kr(e,this.windowSize,this.startWindowEvery))},e}(),Kr=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.destination=t,n.windowSize=i,n.startWindowEvery=r,n.windows=[new ni.a],n.count=0,t.next(n.windows[0]),n}return r.a(t,e),t.prototype._next=function(e){for(var t=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,i=this.destination,r=this.windowSize,n=this.windows,s=n.length,o=0;o<s&&!this.closed;o++)n[o].next(e);var a=this.count-r+1;if(a>=0&&a%t==0&&!this.closed&&n.shift().complete(),++this.count%t==0&&!this.closed){var c=new ni.a;n.push(c),i.next(c)}},t.prototype._error=function(e){var t=this.windows;if(t)for(;t.length>0&&!this.closed;)t.shift().error(e);this.destination.error(e)},t.prototype._complete=function(){var e=this.windows;if(e)for(;e.length>0&&!this.closed;)e.shift().complete();this.destination.complete()},t.prototype._unsubscribe=function(){this.count=0,this.windows=null},t}(p.a);function Xr(e){var t=c.a,i=null,r=Number.POSITIVE_INFINITY;return Object(b.a)(arguments[3])&&(t=arguments[3]),Object(b.a)(arguments[2])?t=arguments[2]:Object(nr.a)(arguments[2])&&(r=Number(arguments[2])),Object(b.a)(arguments[1])?t=arguments[1]:Object(nr.a)(arguments[1])&&(i=Number(arguments[1])),function(n){return n.lift(new Qr(e,i,r,t))}}var Qr=function(){function e(e,t,i,r){this.windowTimeSpan=e,this.windowCreationInterval=t,this.maxWindowSize=i,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new en(e,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))},e}(),Zr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._numberOfNextedValues=0,t}return r.a(t,e),t.prototype.next=function(t){this._numberOfNextedValues++,e.prototype.next.call(this,t)},Object.defineProperty(t.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:true,configurable:true}),t}(ni.a),en=function(e){function t(t,i,r,n,s){var o=e.call(this,t)||this;o.destination=t,o.windowTimeSpan=i,o.windowCreationInterval=r,o.maxWindowSize=n,o.scheduler=s,o.windows=[];var a=o.openWindow();if(null!==r&&r>=0){var c={subscriber:o,window:a,context:null},l={windowTimeSpan:i,windowCreationInterval:r,subscriber:o,scheduler:s};o.add(s.schedule(nn,i,c)),o.add(s.schedule(rn,r,l))}else{var d={subscriber:o,window:a,windowTimeSpan:i};o.add(s.schedule(tn,i,d))}return o}return r.a(t,e),t.prototype._next=function(e){for(var t=this.windows,i=t.length,r=0;r<i;r++){var n=t[r];n.closed||(n.next(e),n.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(n))}},t.prototype._error=function(e){for(var t=this.windows;t.length>0;)t.shift().error(e);this.destination.error(e)},t.prototype._complete=function(){for(var e=this.windows;e.length>0;){var t=e.shift();t.closed||t.complete()}this.destination.complete()},t.prototype.openWindow=function(){var e=new Zr;return this.windows.push(e),this.destination.next(e),e},t.prototype.closeWindow=function(e){e.complete();var t=this.windows;t.splice(t.indexOf(e),1)},t}(p.a);function tn(e){var t=e.subscriber,i=e.windowTimeSpan,r=e.window;r&&t.closeWindow(r),e.window=t.openWindow(),this.schedule(e,i)}function rn(e){var t=e.windowTimeSpan,i=e.subscriber,r=e.scheduler,n=e.windowCreationInterval,s=i.openWindow(),o={action:this,subscription:null},a={subscriber:i,window:s,context:o};o.subscription=r.schedule(nn,t,a),this.add(o.subscription),this.schedule(e,n)}function nn(e){var t=e.subscriber,i=e.window,r=e.context;r&&r.action&&r.subscription&&r.action.remove(r.subscription),t.closeWindow(i)}function sn(e,t){return function(i){return i.lift(new on(e,t))}}var on=function(){function e(e,t){this.openings=e,this.closingSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new an(e,this.openings,this.closingSelector))},e}(),an=function(e){function t(t,i,r){var n=e.call(this,t)||this;return n.openings=i,n.closingSelector=r,n.contexts=[],n.add(n.openSubscription=Object(A.a)(n,i,i)),n}return r.a(t,e),t.prototype._next=function(e){var t=this.contexts;if(t)for(var i=t.length,r=0;r<i;r++)t[r].window.next(e)},t.prototype._error=function(t){var i=this.contexts;if(this.contexts=null,i)for(var r=i.length,n=-1;++n<r;){var s=i[n];s.window.error(t),s.subscription.unsubscribe()}e.prototype._error.call(this,t)},t.prototype._complete=function(){var t=this.contexts;if(this.contexts=null,t)for(var i=t.length,r=-1;++r<i;){var n=t[r];n.window.complete(),n.subscription.unsubscribe()}e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.contexts;if(this.contexts=null,e)for(var t=e.length,i=-1;++i<t;){var r=e[i];r.window.unsubscribe(),r.subscription.unsubscribe()}},t.prototype.notifyNext=function(e,t,i,r,n){if(e===this.openings){var s=void 0;try{s=(0,this.closingSelector)(t)}catch(d){return this.error(d)}var o=new ni.a,a=new P.a,c={window:o,subscription:a};this.contexts.push(c);var l=Object(A.a)(this,s,c);l.closed?this.closeWindow(this.contexts.length-1):(l.context=c,a.add(l)),this.destination.next(o)}else this.closeWindow(this.contexts.indexOf(e))},t.prototype.notifyError=function(e){this.error(e)},t.prototype.notifyComplete=function(e){e!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(e.context))},t.prototype.closeWindow=function(e){if(-1!==e){var t=this.contexts,i=t[e],r=i.window,n=i.subscription;t.splice(e,1),r.complete(),n.unsubscribe()}},t}(M.a);function cn(e){return function(t){return t.lift(new ln(e))}}var ln=function(){function e(e){this.closingSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new dn(e,this.closingSelector))},e}(),dn=function(e){function t(t,i){var r=e.call(this,t)||this;return r.destination=t,r.closingSelector=i,r.openWindow(),r}return r.a(t,e),t.prototype.notifyNext=function(e,t,i,r,n){this.openWindow(n)},t.prototype.notifyError=function(e){this._error(e)},t.prototype.notifyComplete=function(e){this.openWindow(e)},t.prototype._next=function(e){this.window.next(e)},t.prototype._error=function(e){this.window.error(e),this.destination.error(e),this.unsubscribeClosingNotification()},t.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},t.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},t.prototype.openWindow=function(e){void 0===e&&(e=null),e&&(this.remove(e),e.unsubscribe());var t=this.window;t&&t.complete();var i,r=this.window=new ni.a;this.destination.next(r);try{i=(0,this.closingSelector)()}catch(n){return this.destination.error(n),void this.window.error(n)}this.add(this.closingNotification=Object(A.a)(this,i))},t}(M.a);function un(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){var i;"function"==typeof e[e.length-1]&&(i=e.pop());var r=e;return t.lift(new hn(r,i))}}var hn=function(){function e(e,t){this.observables=e,this.project=t}return e.prototype.call=function(e,t){return t.subscribe(new fn(e,this.observables,this.project))},e}(),fn=function(e){function t(t,i,r){var n=e.call(this,t)||this;n.observables=i,n.project=r,n.toRespond=[];var s=i.length;n.values=new Array(s);for(var o=0;o<s;o++)n.toRespond.push(o);for(o=0;o<s;o++){var a=i[o];n.add(Object(A.a)(n,a,void 0,o))}return n}return r.a(t,e),t.prototype.notifyNext=function(e,t,i){this.values[i]=t;var r=this.toRespond;if(r.length>0){var n=r.indexOf(i);-1!==n&&r.splice(n,1)}},t.prototype.notifyComplete=function(){},t.prototype._next=function(e){if(0===this.toRespond.length){var t=[e].concat(this.values);this.project?this._tryProject(t):this.destination.next(t)}},t.prototype._tryProject=function(e){var t;try{t=this.project.apply(this,e)}catch(dp){return void this.destination.error(dp)}this.destination.next(t)},t}(M.a),pn=i(87);function gn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(pn.b.apply(void 0,[t].concat(e)))}}function mn(e){return function(t){return t.lift(new pn.a(e))}}i.d(t,"audit",(function(){return s})),i.d(t,"auditTime",(function(){return d})),i.d(t,"buffer",(function(){return u})),i.d(t,"bufferCount",(function(){return g})),i.d(t,"bufferTime",(function(){return y})),i.d(t,"bufferToggle",(function(){return D})),i.d(t,"bufferWhen",(function(){return N})),i.d(t,"catchError",(function(){return k})),i.d(t,"combineAll",(function(){return W})),i.d(t,"combineLatest",(function(){return V})),i.d(t,"concat",(function(){return G})),i.d(t,"concatAll",(function(){return $.a})),i.d(t,"concatMap",(function(){return J})),i.d(t,"concatMapTo",(function(){return q})),i.d(t,"count",(function(){return K})),i.d(t,"debounce",(function(){return Z})),i.d(t,"debounceTime",(function(){return ie})),i.d(t,"defaultIfEmpty",(function(){return oe})),i.d(t,"delay",(function(){return ue})),i.d(t,"delayWhen",(function(){return me})),i.d(t,"dematerialize",(function(){return Ce})),i.d(t,"distinct",(function(){return Ee})),i.d(t,"distinctUntilChanged",(function(){return Pe})),i.d(t,"distinctUntilKeyChanged",(function(){return De})),i.d(t,"elementAt",(function(){return He})),i.d(t,"endWith",(function(){return Ye})),i.d(t,"every",(function(){return Ge})),i.d(t,"exhaust",(function(){return Je})),i.d(t,"exhaustMap",(function(){return Qe})),i.d(t,"expand",(function(){return tt})),i.d(t,"filter",(function(){return Oe.a})),i.d(t,"finalize",(function(){return nt})),i.d(t,"find",(function(){return at})),i.d(t,"findIndex",(function(){return dt})),i.d(t,"first",(function(){return ht})),i.d(t,"groupBy",(function(){return ft.b})),i.d(t,"ignoreElements",(function(){return pt})),i.d(t,"isEmpty",(function(){return vt})),i.d(t,"last",(function(){return _t})),i.d(t,"map",(function(){return Xe.a})),i.d(t,"mapTo",(function(){return Et})),i.d(t,"materialize",(function(){return Pt})),i.d(t,"max",(function(){return Lt})),i.d(t,"merge",(function(){return Ft})),i.d(t,"mergeAll",(function(){return Ut.a})),i.d(t,"mergeMap",(function(){return z.b})),i.d(t,"flatMap",(function(){return z.a})),i.d(t,"mergeMapTo",(function(){return jt})),i.d(t,"mergeScan",(function(){return Wt})),i.d(t,"min",(function(){return Vt})),i.d(t,"multicast",(function(){return Gt})),i.d(t,"observeOn",(function(){return zt.b})),i.d(t,"onErrorResumeNext",(function(){return Jt})),i.d(t,"pairwise",(function(){return Xt})),i.d(t,"partition",(function(){return ti})),i.d(t,"pluck",(function(){return ii})),i.d(t,"publish",(function(){return si})),i.d(t,"publishBehavior",(function(){return ai})),i.d(t,"publishLast",(function(){return li})),i.d(t,"publishReplay",(function(){return ui})),i.d(t,"race",(function(){return fi})),i.d(t,"reduce",(function(){return xt})),i.d(t,"repeat",(function(){return pi})),i.d(t,"repeatWhen",(function(){return vi})),i.d(t,"retry",(function(){return yi})),i.d(t,"retryWhen",(function(){return _i})),i.d(t,"refCount",(function(){return Ii.a})),i.d(t,"sample",(function(){return Pi})),i.d(t,"sampleTime",(function(){return Di})),i.d(t,"scan",(function(){return Dt})),i.d(t,"sequenceEqual",(function(){return xi})),i.d(t,"share",(function(){return ji})),i.d(t,"shareReplay",(function(){return Wi})),i.d(t,"single",(function(){return Bi})),i.d(t,"skip",(function(){return Yi})),i.d(t,"skipLast",(function(){return zi})),i.d(t,"skipUntil",(function(){return Ki})),i.d(t,"skipWhile",(function(){return Zi})),i.d(t,"startWith",(function(){return ir})),i.d(t,"subscribeOn",(function(){return or})),i.d(t,"switchAll",(function(){return ur})),i.d(t,"switchMap",(function(){return cr})),i.d(t,"switchMapTo",(function(){return hr})),i.d(t,"take",(function(){return je})),i.d(t,"takeLast",(function(){return yt})),i.d(t,"takeUntil",(function(){return fr})),i.d(t,"takeWhile",(function(){return mr})),i.d(t,"tap",(function(){return Cr})),i.d(t,"throttle",(function(){return Tr})),i.d(t,"throttleTime",(function(){return Ar})),i.d(t,"throwIfEmpty",(function(){return xe})),i.d(t,"timeInterval",(function(){return Nr})),i.d(t,"timeout",(function(){return Wr})),i.d(t,"timeoutWith",(function(){return kr})),i.d(t,"timestamp",(function(){return Br})),i.d(t,"toArray",(function(){return Yr})),i.d(t,"window",(function(){return Gr})),i.d(t,"windowCount",(function(){return Jr})),i.d(t,"windowTime",(function(){return Xr})),i.d(t,"windowToggle",(function(){return sn})),i.d(t,"windowWhen",(function(){return cn})),i.d(t,"withLatestFrom",(function(){return un})),i.d(t,"zip",(function(){return gn})),i.d(t,"zipAll",(function(){return mn}))},function(e,t,i){i.r(t);var r={};i.r(r),i.d(r,"shimGetUserMedia",(function(){return w})),i.d(r,"shimGetDisplayMedia",(function(){return _})),i.d(r,"shimMediaStream",(function(){return E})),i.d(r,"shimOnTrack",(function(){return T})),i.d(r,"shimGetSendersWithDtmf",(function(){return I})),i.d(r,"shimGetStats",(function(){return P})),i.d(r,"shimSenderReceiverGetStats",(function(){return A})),i.d(r,"shimAddTrackRemoveTrackWithNative",(function(){return M})),i.d(r,"shimAddTrackRemoveTrack",(function(){return D})),i.d(r,"shimPeerConnection",(function(){return R})),i.d(r,"fixNegotiationNeeded",(function(){return O}));var n={};i.r(n),i.d(n,"shimGetUserMedia",(function(){return L})),i.d(n,"shimGetDisplayMedia",(function(){return k})),i.d(n,"shimPeerConnection",(function(){return F})),i.d(n,"shimReplaceTrack",(function(){return U}));var s={};i.r(s),i.d(s,"shimGetUserMedia",(function(){return j})),i.d(s,"shimGetDisplayMedia",(function(){return W})),i.d(s,"shimOnTrack",(function(){return B})),i.d(s,"shimPeerConnection",(function(){return H})),i.d(s,"shimSenderGetStats",(function(){return V})),i.d(s,"shimReceiverGetStats",(function(){return Y})),i.d(s,"shimRemoveStream",(function(){return G})),i.d(s,"shimRTCDataChannel",(function(){return $})),i.d(s,"shimAddTransceiver",(function(){return z})),i.d(s,"shimCreateOffer",(function(){return J})),i.d(s,"shimCreateAnswer",(function(){return q}));var o={};i.r(o),i.d(o,"shimLocalStreamsAPI",(function(){return K})),i.d(o,"shimRemoteStreamsAPI",(function(){return X})),i.d(o,"shimCallbacksAPI",(function(){return Q})),i.d(o,"shimGetUserMedia",(function(){return Z})),i.d(o,"shimConstraints",(function(){return ee})),i.d(o,"shimRTCIceServerUrls",(function(){return te})),i.d(o,"shimTrackEventTransceiver",(function(){return ie})),i.d(o,"shimCreateOfferLegacy",(function(){return re}));var a={};i.r(a),i.d(a,"shimRTCIceCandidate",(function(){return oe})),i.d(a,"shimMaxMessageSize",(function(){return ae})),i.d(a,"shimSendThrowTypeError",(function(){return ce})),i.d(a,"shimConnectionState",(function(){return le})),i.d(a,"removeAllowExtmapMixed",(function(){return de}));var c={};i.r(c),i.d(c,"default",(function(){return ue}));let l=true,d=true;function u(e,t,i){const r=e.match(t);return r&&r.length>=i&&parseInt(r[i],10)}function h(e,t,i){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,n=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return n.apply(this,arguments);const s=e=>{const t=i(e);t&&r(t)};return this._eventMap=this._eventMap||{},this._eventMap[r]=s,n.apply(this,[e,s])};const s=r.removeEventListener;r.removeEventListener=function(e,i){if(e!==t||!this._eventMap||!this._eventMap[i])return s.apply(this,arguments);const r=this._eventMap[i];return delete this._eventMap[i],s.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:true,configurable:true})}function f(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(l=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function p(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(d=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function g(){if("object"==typeof window){if(l)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function m(e,t){d&&console.warn(e+" is deprecated, please use "+t+" instead.")}function v(e){const{navigator:t}=e,i={browser:null,version:null};if(void 0===e||!e.navigator)return i.browser="Not a browser.",i;if(t.mozGetUserMedia)i.browser="firefox",i.version=u(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||false===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)i.browser="chrome",i.version=u(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))i.browser="edge",i.version=u(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return i.browser="Not a supported browser.",i;i.browser="safari",i.version=u(t.userAgent,/AppleWebKit\/(\d+)\./,1),i.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return i}function S(e){return"[object Object]"===Object.prototype.toString.call(e)}function b(e){return S(e)?Object.keys(e).reduce((function(t,i){const r=S(e[i]),n=r?b(e[i]):e[i],s=r&&!Object.keys(n).length;return void 0===n||s?t:Object.assign(t,{[i]:n})}),{}):e}function y(e,t,i){const r=i?"outbound-rtp":"inbound-rtp",n=new Map;if(null===t)return n;const s=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&s.push(e)})),s.forEach((t=>{e.forEach((i=>{i.type===r&&i.trackId===t.id&&function e(t,i,r){i&&!r.has(i.id)&&(r.set(i.id,i),Object.keys(i).forEach((n=>{n.endsWith("Id")?e(t,t.get(i[n]),r):n.endsWith("Ids")&&i[n].forEach((i=>{e(t,t.get(i),r)}))})))}(e,i,n)}))})),n}const C=g;function w(e){const t=e&&e.navigator;if(!t.mediaDevices)return;const i=v(e),r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((i=>{if("require"===i||"advanced"===i||"mediaSource"===i)return;const r="object"==typeof e[i]?e[i]:{ideal:e[i]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const n=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[n("min",i)]=r.ideal,t.optional.push(e),e={},e[n("max",i)]=r.ideal,t.optional.push(e)):(e[n("",i)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[n("",i)]=r.exact):["min","max"].forEach((e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[n(e,i)]=r[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},n=function(e,n){if(i.version>=61)return n(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});const o=i.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||o)){let i;if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?i=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(i=["front"]),i)return t.mediaDevices.enumerateDevices().then((t=>{let o=(t=t.filter((e=>"videoinput"===e.kind))).find((e=>i.some((t=>e.label.toLowerCase().includes(t)))));return!o&&t.length&&i.includes("back")&&(o=t[t.length-1]),o&&(e.video.deviceId=s.exact?{exact:o.deviceId}:{ideal:o.deviceId}),e.video=r(e.video),C("chrome: "+JSON.stringify(e)),n(e)}))}e.video=r(e.video)}return C("chrome: "+JSON.stringify(e)),n(e)},s=function(e){return i.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=function(e,i,r){n(e,(e=>{t.webkitGetUserMedia(e,i,(e=>{r&&r(s(e))}))}))}.bind(t),t.mediaDevices.getUserMedia){const e=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(t){return n(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(s(e))))))}}}function _(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(i){return t(i).then((t=>{const r=i.video&&i.video.width,n=i.video&&i.video.height,s=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:s||3}},r&&(i.video.mandatory.maxWidth=r),n&&(i.video.mandatory.maxHeight=n),e.navigator.mediaDevices.getUserMedia(i)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function E(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function T(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:true,configurable:true});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(i=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===i.track.id)):{track:i.track};const n=new Event("track");n.track=i.track,n.receiver=r,n.transceiver={receiver:r},n.streams=[t.stream],this.dispatchEvent(n)})),t.stream.getTracks().forEach((i=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===i.id)):{track:i};const n=new Event("track");n.track=i,n.receiver=r,n.transceiver={receiver:r},n.streams=[t.stream],this.dispatchEvent(n)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else h(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function I(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let n=i.apply(this,arguments);return n||(n=t(this,e),this._senders.push(n)),n};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function P(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const n=function(e){const t={};return e.result().forEach((e=>{const i={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{i[t]=e.stat(t)})),t[i.id]=i})),t},s=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const r=function(e){i(s(n(e)))};return t.apply(this,[r,e])}return new Promise(((e,i)=>{t.apply(this,[function(t){e(s(n(t)))},i])})).then(i,r)}}function A(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>y(t,e.track,true)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),h(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>y(t,e.track,false)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,i,r;return this.getSenders().forEach((i=>{i.track===e&&(t?r=true:t=i)})),this.getReceivers().forEach((t=>(t.track===e&&(i?r=true:i=t),t.track===e))),r||t&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function M(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){if(!i)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[i.id]?-1===this._shimmedLocalStreams[i.id].indexOf(r)&&this._shimmedLocalStreams[i.id].push(r):this._shimmedLocalStreams[i.id]=[i,r],r};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();i.apply(this,arguments);const r=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const i=this._shimmedLocalStreams[t].indexOf(e);-1!==i&&this._shimmedLocalStreams[t].splice(i,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),n.apply(this,arguments)}}function D(e){if(!e.RTCPeerConnection)return;const t=v(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return M(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=i.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}r.apply(this,[t])};const n=e.RTCPeerConnection.prototype.removeStream;function s(e,t){let i=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],n=e._streams[r.id];i=i.replace(new RegExp(n.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:i})}function o(e,t){let i=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],n=e._streams[r.id];i=i.replace(new RegExp(r.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:i})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,i){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const n=this.getSenders().find((e=>e.track===t));if(n)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const s=this._streams[i.id];if(s)s.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const r=new e.MediaStream([t]);this._streams[i.id]=r,this._reverseStreams[r.id]=i,this.addStream(r)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const i=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?i.apply(this,[t=>{const i=s(this,t);e[0].apply(null,[i])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):i.apply(this,arguments).then((e=>s(this,e)))}};e.RTCPeerConnection.prototype[t]=r[t]}));const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=o(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=c.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((i=>{this._streams[i].getTracks().find((t=>e.track===t))&&(t=this._streams[i])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function R(e){const t=v(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),!e.RTCPeerConnection)return;const i=0===e.RTCPeerConnection.prototype.addIceCandidate.length;t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const i=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));const r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return i||arguments[0]?t.version<78&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}function O(e){h(e,"negotiationneeded",(e=>{if("stable"===e.target.signalingState)return e}))}var N=i(331),x=i.n(N);function L(e){const t=e&&e.navigator,i=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return i(e).catch((e=>Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString(){return this.name}}}(e))))}}function k(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function F(e){const t=v(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){const t=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set(e){t.set.call(this,e);const i=new Event("enabled");i.enabled=e,this.dispatchEvent(i)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);const i=x()(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=function(e,t){let i=false;return(e=JSON.parse(JSON.stringify(e))).filter((e=>{if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&m("RTCIceServer.url","RTCIceServer.urls");const r="string"==typeof t;return r&&(t=[t]),t=t.filter((e=>{if(0===e.indexOf("stun:"))return false;const t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!i?(i=true,true):t&&!i})),delete e.url,e.urls=r?t[0]:t,!!t.length}}))}(e.iceServers,t.version),g("ICE servers after filtering:",e.iceServers)),new i(e)},e.RTCPeerConnection.prototype=i.prototype}function U(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}function j(e){const t=v(e),i=e&&e.navigator,r=e&&e.MediaStreamTrack;if(i.getUserMedia=function(e,t,r){m("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const e=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])},t=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(i){return"object"==typeof i&&"object"==typeof i.audio&&(i=JSON.parse(JSON.stringify(i)),e(i.audio,"autoGainControl","mozAutoGainControl"),e(i.audio,"noiseSuppression","mozNoiseSuppression")),t(i)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const i=t.apply(this,arguments);return e(i,"mozAutoGainControl","autoGainControl"),e(i,"mozNoiseSuppression","noiseSuppression"),i}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(i){return"audio"===this.kind&&"object"==typeof i&&(i=JSON.parse(JSON.stringify(i)),e(i,"autoGainControl","mozAutoGainControl"),e(i,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[i])}}}}function W(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return true===i.video?i.video={mediaSource:t}:i.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(i)})}function B(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function H(e){const t=v(e);if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;if(!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const i=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]})),t.version<68){const t=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&""===arguments[0].candidate?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,s]=arguments;return r.apply(this,[e||null]).then((e=>{if(t.version<53&&!n)try{e.forEach((e=>{e.type=i[e.type]||e.type}))}catch(r){if("TypeError"!==r.name)throw r;e.forEach(((t,r)=>{e.set(r,Object.assign({},t,{type:i[t.type]||t.type}))}))}return e})).then(n,s)}}function V(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Y(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),h(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function G(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){m("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function $(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function z(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1],i=e&&"sendEncodings"in e;i&&e.sendEncodings.forEach((e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const r=t.apply(this,arguments);if(i){const{sender:t}=r,i=t.getParameters();"encodings"in i||(i.encodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(i).catch((()=>{}))))}return r})}function J(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function q(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function K(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((i=>t.call(this,i,e))),e.getVideoTracks().forEach((i=>t.call(this,i,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...i){return i&&i.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const i=e.getTracks();this.getSenders().forEach((e=>{i.includes(e.track)&&this.removeTrack(e)}))})}}function X(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const i=new Event("addstream");i.stream=t,e.dispatchEvent(i)}))}),t.apply(e,arguments)}}}function Q(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,i=t.createOffer,r=t.createAnswer,n=t.setLocalDescription,s=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],n=i.apply(this,[r]);return t?(n.then(e,t),Promise.resolve()):n},t.createAnswer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],n=r.apply(this,[i]);return t?(n.then(e,t),Promise.resolve()):n};let a=function(e,t,i){const r=n.apply(this,[e]);return i?(r.then(t,i),Promise.resolve()):r};t.setLocalDescription=a,a=function(e,t,i){const r=s.apply(this,[e]);return i?(r.then(t,i),Promise.resolve()):r},t.setRemoteDescription=a,a=function(e,t,i){const r=o.apply(this,[e]);return i?(r.then(t,i),Promise.resolve()):r},t.addIceCandidate=a}function Z(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,i=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>i(ee(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,i,r){t.mediaDevices.getUserMedia(e).then(i,r)}.bind(t))}function ee(e){return e&&void 0!==e.video?Object.assign({},e,{video:b(e.video)}):e}function te(e){const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,i){if(e&&e.iceServers){const t=[];for(let i=0;i<e.iceServers.length;i++){let r=e.iceServers[i];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(m("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[i])}e.iceServers=t}return new t(e,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function ie(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function re(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));false===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):true!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const i=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));false===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):true!==e.offerToReceiveVideo||i||this.addTransceiver("video")}return t.apply(this,arguments)}}var ne=i(91),se=i.n(ne);function oe(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const i=new t(e),r=se.a.parseCandidate(e.candidate),n=Object.assign(i,r);return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,h(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function ae(e){if(!e.RTCPeerConnection)return;const t=v(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const i=function(e){if(!e||!e.sdp)return false;const t=se.a.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=se.a.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},r=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const i=parseInt(t[1],10);return i!=i?-1:i},n=function(e){let i=65536;return"firefox"===t.browser&&(i=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),i},s=function(e,i){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const n=se.a.matchPrefix(e.sdp,"a=max-message-size:");return n.length>0?r=parseInt(n[0].substr(19),10):"firefox"===t.browser&&-1!==i&&(r=2147483637),r},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:true,configurable:true})}if(i(arguments[0])){const e=r(arguments[0]),t=n(e),i=s(arguments[0],e);let o;o=0===t&&0===i?Number.POSITIVE_INFINITY:0===t||0===i?Math.max(t,i):Math.min(t,i);const a={};Object.defineProperty(a,"maxMessageSize",{get:()=>o}),this._sctp=a}return o.apply(this,arguments)}}function ce(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const i=e.send;e.send=function(){const r=arguments[0],n=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&n>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return i.apply(e,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=i.apply(this,arguments);return t(e,this),e},h(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function le(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:true,configurable:true}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:true,configurable:true}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const i=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const i=new Event("connectionstatechange",e);t.dispatchEvent(i)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}}))}function de(e){if(!e.RTCPeerConnection)return;const t=v(e);if("chrome"===t.browser&&t.version>=71)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n")),i.apply(this,arguments)}}var ue=function({window:e}={},t={shimChrome:true,shimFirefox:true,shimEdge:true,shimSafari:true}){const i=g,c=v(e),l={browserDetails:c,commonShim:a,extractVersion:u,disableLog:f,disableWarnings:p};switch(c.browser){case"chrome":if(!r||!R||!t.shimChrome)return i("Chrome shim is not included in this adapter release."),l;i("adapter.js shimming chrome."),l.browserShim=r,w(e),E(e),R(e),T(e),D(e),I(e),P(e),A(e),O(e),oe(e),le(e),ae(e),ce(e),de(e);break;case"firefox":if(!s||!H||!t.shimFirefox)return i("Firefox shim is not included in this adapter release."),l;i("adapter.js shimming firefox."),l.browserShim=s,j(e),H(e),B(e),G(e),V(e),Y(e),$(e),z(e),J(e),q(e),oe(e),le(e),ae(e),ce(e);break;case"edge":if(!n||!F||!t.shimEdge)return i("MS edge shim is not included in this adapter release."),l;i("adapter.js shimming edge."),l.browserShim=n,L(e),k(e),F(e),U(e),ae(e),ce(e);break;case"safari":if(!o||!t.shimSafari)return i("Safari shim is not included in this adapter release."),l;i("adapter.js shimming safari."),l.browserShim=o,te(e),re(e),Q(e),K(e),X(e),ie(e),Z(e),oe(e),ae(e),ce(e),de(e);break;default:i("Unsupported browser!")}return l}({window:window}),he=i(334),fe=i(335),pe=i(336),ge=i(337),me=i(338),ve=i(339),Se=i(340),be=i(341),ye=i(342),Ce=i(343),we=i(344),_e=i(345),Ee=i(346),Te=i(347),Ie=i(348),Pe=i(349),Ae=i(350),Me=i(351),De=i(38),Re=i(28),Oe=i(352);i(353),i(354),i(355),i(129),i(356),window.adapter=c,window.emojione=null,i(357),i(358),i(459),i(38),i(460),i(129),angular.module("sdk").service("connectionService",he.ConnectionService),angular.module("sdk").service("configService",fe.ConfigService),angular.module("sdk").service("presenceService",pe.PresenceService),angular.module("sdk").service("userProfileService",ge.UserProfileService),angular.module("sdk").service("contactsService",me.ContactsService),angular.module("sdk").service("pbxService",ve.PbxService),angular.module("sdk").service("conversationsService",Se.ConversationsService),angular.module("sdk").service("imService",be.ImService),angular.module("sdk").service("webRTCService",ye.WebRTCService),angular.module("sdk").service("bubblesService",Ce.BubblesService),angular.module("sdk").service("conferencesService",we.ConferencesService),angular.module("sdk").service("groupsService",_e.GroupsService),angular.module("sdk").service("callsLogService",Ee.CallsLogService),angular.module("sdk").service("favoritesService",Te.FavoritesService),angular.module("sdk").service("filesStorageService",Ie.FilesStorageService),angular.module("sdk").service("capabilitiesService",Pe.CapabilitiesService),angular.module("sdk").service("sdkAdminService",Ae.SdkAdminService),angular.module("sdk").service("channelsService",Me.ChannelsService),angular.module("sdk").service("rainbowSDK",Oe.SdkService),angular.module("sdk")||angular.bootstrap(document,["sdk"]).get("rainbowSDK"),i(487),i(488),i(489),i(490),i(491),i(492),i(493),i(494),i(495),i(496);const Ne=angular.injector(["sdk"]).get("rainbowSDK");Ne.Call=Re.Call,Ne.SDK=De.SDK;t.default=Ne}]);const jf=Uf.default;const Wf='.sc-launcher{width:60px;height:60px;background-position:center;background-repeat:no-repeat;position:fixed;right:25px;bottom:25px;border-radius:50%;box-shadow:none;transition:box-shadow .2s ease-in-out;cursor:pointer}.sc-launcher:before{content:"";position:relative;display:block;width:60px;height:60px;border-radius:50%;transition:box-shadow .2s ease-in-out}.sc-launcher .sc-open-icon,.sc-launcher .sc-closed-icon{width:60px;height:60px;position:fixed;right:25px;bottom:25px;transition:opacity .1s ease-in-out,transform .1s ease-in-out}.sc-launcher .sc-closed-icon{transition:opacity .1s ease-in-out,transform .1s ease-in-out;width:60px;height:60px}.sc-launcher .sc-open-icon{padding:20px;box-sizing:border-box;opacity:1}.sc-launcher.opened .sc-open-icon,.sc-launcher.opened .sc-closed-icon{transform:rotate(-90deg);opacity:1}.sc-launcher.opened:before{box-shadow:0 0 400px 250px #94959633}.sc-launcher:hover{box-shadow:0 0 27px 1.5px #0003}.sc-new-messsages-count{position:absolute;top:-3px;left:41px;display:flex;justify-content:center;flex-direction:column;border-radius:50%;width:22px;height:22px;background:#ff4646;color:#fff;text-align:center;margin:auto;font-size:12px;font-weight:500}.sc-chat-window{width:370px;height:calc(100% - 120px);max-height:590px;position:fixed;right:25px;bottom:100px;box-sizing:border-box;box-shadow:0 7px 40px 2px #9495961a;background:white;display:flex;flex-direction:column;justify-content:space-between;border-radius:10px;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;animation:fadeIn;animation-duration:.3s;animation-timing-function:ease-in-out}.sc-chat-window.closed{opacity:0;display:none;bottom:90px}@keyframes fadeIn{0%{display:none;opacity:0}to{display:flex;opacity:1}}.sc-message--me{text-align:right}.sc-message--them{text-align:left}@media (max-width: 450px){.sc-chat-window{width:100%;height:100%;max-height:100%;right:0;bottom:0;border-radius:0}.sc-chat-window{transition:.1s ease-in-out}.sc-chat-window.closed{bottom:0}}\n';const Bf=".sc-header{min-height:75px;border-top-left-radius:9px;border-top-right-radius:9px;padding:10px;box-shadow:0 1px 4px #0003;position:relative;box-sizing:border-box;display:flex}.sc-header--img{border-radius:50%;align-self:center;padding:10px}.sc-header--title{align-self:center;padding:10px;flex:1;-webkit-user-select:none;user-select:none;font-size:20px}.sc-header--title.enabled{cursor:pointer;border-radius:5px}.sc-header--title.enabled:hover{box-shadow:0 2px 5px #0000011a}.sc-header--close-button{width:40px;align-self:center;height:40px;margin-right:10px;box-sizing:border-box;cursor:pointer;border-radius:5px;margin-left:auto}.sc-header--close-button:hover{box-shadow:0 2px 5px #0000011a}.sc-header--close-button img{width:100%;height:100%;padding:13px;box-sizing:border-box}@media (max-width: 450px){.sc-header{border-radius:0}}\n";const Hf=".sc-chat-window{width:370px;height:calc(100% - 120px);max-height:590px;position:fixed;right:25px;bottom:100px;box-sizing:border-box;box-shadow:0 7px 40px 2px #9495961a;background:white;display:flex;flex-direction:column;justify-content:space-between;border-radius:10px;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;animation:fadeIn;animation-duration:.3s;animation-timing-function:ease-in-out}.sc-chat-window.closed{opacity:0;display:none;bottom:90px}@keyframes fadeIn{0%{display:none;opacity:0}to{display:flex;opacity:1}}.sc-message--me{text-align:right}.sc-message--them{text-align:left}@media (max-width: 450px){.sc-chat-window{width:100%;height:100%;max-height:100%;right:0;bottom:0;border-radius:0}.sc-chat-window{transition:.1s ease-in-out}.sc-chat-window.closed{bottom:0}}.sc-header{min-height:75px;border-top-left-radius:9px;border-top-right-radius:9px;padding:10px;box-shadow:0 1px 4px #0003;position:relative;box-sizing:border-box;display:flex}.sc-header--img{border-radius:50%;align-self:center;padding:10px}.sc-header--title{align-self:center;padding:10px;flex:1;-webkit-user-select:none;user-select:none;font-size:20px}.sc-header--title.enabled{cursor:pointer;border-radius:5px}.sc-header--title.enabled:hover{box-shadow:0 2px 5px #0000011a}.sc-header--close-button{width:40px;align-self:center;height:40px;margin-right:10px;box-sizing:border-box;cursor:pointer;border-radius:5px;margin-left:auto}.sc-header--close-button:hover{box-shadow:0 2px 5px #0000011a}.sc-header--close-button img{width:100%;height:100%;padding:13px;box-sizing:border-box}@media (max-width: 450px){.sc-header{border-radius:0}}\n";const Vf='.sc-emoji-picker{position:absolute;bottom:50px;right:0;width:330px;max-height:215px;box-shadow:0 7px 40px 2px #9495964d;background:white;border-radius:10px;outline:none}.sc-emoji-picker:after{content:"";width:14px;height:14px;background:white;position:absolute;bottom:-6px;right:55px;transform:rotate(45deg);border-radius:2px}.sc-emoji-picker--content{padding:10px;overflow:auto;width:100%;max-height:195px;margin-top:7px;box-sizing:border-box}.sc-emoji-picker--category{display:flex;flex-direction:row;flex-wrap:wrap}.sc-emoji-picker--category-title{min-width:100%;color:#b8c3ca;font-weight:200;font-size:13px;margin:5px;letter-spacing:1px}.sc-emoji-picker--emoji{margin:5px;width:30px;line-height:30px;text-align:center;cursor:pointer;vertical-align:middle;font-size:28px;transition:transform 60ms ease-out}.sc-emoji-picker--emoji:hover{transform:scale(1.4)}\n';const Yf=".sc-message{width:300px;margin:auto;padding-bottom:10px;display:flex}.sc-message .sc-message--edited{opacity:.7;word-wrap:normal;font-size:xx-small;text-align:center}.sc-message--content{width:100%;display:flex}.sc-message--content.sent{justify-content:flex-end}.sc-message--content.system{justify-content:center}.sc-message--content.sent .sc-message--avatar{display:none}.sc-message--avatar{background-repeat:no-repeat;background-size:100%;background-position:center;min-width:30px;min-height:30px;border-radius:50%;align-self:center;margin-right:15px}@media (max-width: 450px){.sc-message{width:80%}}.sc-message--text{padding:5px 20px;border-radius:6px;font-weight:300;font-size:14px;line-height:1.4;position:relative;-webkit-font-smoothing:subpixel-antialiased}.sc-message--text .sc-message--text-body .sc-message--text-content{white-space:pre-wrap}.sc-message--text:hover .sc-message--toolbox{left:-20px;opacity:1}.sc-message--text.confirm-delete:hover .sc-message--toolbox{left:-90px}.sc-message--text.confirm-delete .sc-message--toolbox{width:auto}.sc-message--text .sc-message--toolbox{transition:left .2s ease-out 0s;white-space:normal;opacity:0;position:absolute;left:0;width:25px;top:0}.sc-message--text .sc-message--toolbox button{background:none;border:none;padding:0;margin:0;outline:none;width:100%;text-align:center;cursor:pointer}.sc-message--text .sc-message--toolbox button:focus{outline:none}.sc-message--content.sent .sc-message--text{color:#fff;background-color:#4e8cff;max-width:calc(100% - 120px);word-wrap:break-word}.sc-message--text code{font-family:Courier New,Courier,monospace!important}.sc-message--content.received .sc-message--text{color:#263238;background-color:#f4f7f9;margin-right:40px}.tooltip{display:block!important;z-index:10000}.tooltip .tooltip-inner{background:black;color:#fff;border-radius:16px;padding:5px 10px 4px}.tooltip .tooltip-arrow{width:0;height:0;border-style:solid;position:absolute;margin:5px;border-color:#000;z-index:1}.tooltip[x-placement^=top]{margin-bottom:5px}.tooltip[x-placement^=top] .tooltip-arrow{border-width:5px 5px 0 5px;border-left-color:transparent!important;border-right-color:transparent!important;border-bottom-color:transparent!important;bottom:-5px;left:calc(50% - 5px);margin-top:0;margin-bottom:0}.tooltip[x-placement^=bottom]{margin-top:5px}.tooltip[x-placement^=bottom] .tooltip-arrow{border-width:0 5px 5px 5px;border-left-color:transparent!important;border-right-color:transparent!important;border-top-color:transparent!important;top:-5px;left:calc(50% - 5px);margin-top:0;margin-bottom:0}.tooltip[x-placement^=right]{margin-left:5px}.tooltip[x-placement^=right] .tooltip-arrow{border-width:5px 5px 5px 0;border-left-color:transparent!important;border-top-color:transparent!important;border-bottom-color:transparent!important;left:-5px;top:calc(50% - 5px);margin-left:0;margin-right:0}.tooltip[x-placement^=left]{margin-right:5px}.tooltip[x-placement^=left] .tooltip-arrow{border-width:5px 0 5px 5px;border-top-color:transparent!important;border-right-color:transparent!important;border-bottom-color:transparent!important;right:-5px;top:calc(50% - 5px);margin-left:0;margin-right:0}.tooltip[aria-hidden=true]{visibility:hidden;opacity:0;transition:opacity .15s,visibility .15s}.tooltip[aria-hidden=false]{visibility:visible;opacity:1;transition:opacity .15s}.tooltip.info .tooltip-inner{background:rgba(0,68,153,.9);color:#fff;padding:24px;border-radius:5px;box-shadow:0 5px 30px #0000001a}.tooltip.info .tooltip-arrow{border-color:#004499e6}.tooltip.popover .popover-inner{background:#f9f9f9;color:#000;padding:24px;border-radius:5px;box-shadow:0 5px 30px #0000001a}.tooltip.popover .popover-arrow{border-color:#f9f9f9}\n";const Gf=".sc-message-list{height:80%;overflow-y:auto;background-size:100%;padding:40px 0}\n";const $f=".sc-suggestions-row{text-align:center;background:inherit}.sc-suggestions-element{margin:3px;padding:5px 10px;border:1px solid;border-radius:15px;font-size:14px;background:inherit;cursor:pointer}\n";const zf=".sc-user-input{min-height:55px;margin:0;position:relative;bottom:0;display:flex;background-color:#f4f7f9;border-bottom-left-radius:10px;border-bottom-right-radius:10px;transition:background-color .2s ease,box-shadow .2s ease}.sc-user-input--text{width:300px;resize:none;border:none;outline:none;border-bottom-left-radius:10px;box-sizing:border-box;padding:18px;font-size:15px;font-weight:400;line-height:1.33;white-space:pre-wrap;word-wrap:break-word;color:#565867;-webkit-font-smoothing:antialiased;max-height:200px;overflow:scroll;bottom:0;overflow-x:hidden;overflow-y:auto}.sc-user-input--text:empty:before{content:attr(placeholder);display:block;filter:contrast(15%);outline:none;cursor:text}.sc-user-input--buttons{width:100px;position:absolute;right:30px;height:100%;display:flex;justify-content:flex-end}.sc-user-input--button:first-of-type{width:40px}.sc-user-input--button{width:30px;height:55px;margin-left:2px;margin-right:2px;display:flex;flex-direction:column;justify-content:center}.sc-user-input.active{box-shadow:none;background-color:#fff;box-shadow:0 -5px 20px #96a5be33}.sc-user-input--button label{position:relative;height:24px;padding-left:3px;cursor:pointer}.sc-user-input--button label:hover path{fill:#565867}.sc-user-input--button input{position:absolute;left:0;top:0;width:100%;z-index:99999;height:100%;opacity:0;cursor:pointer;overflow:hidden}.file-container{background-color:#f4f7f9;border-top-left-radius:10px;padding:5px 20px;color:#565867}.delete-file-message{font-style:normal;float:right;cursor:pointer;color:#c8cad0}.delete-file-message:hover{color:#5d5e6d}.icon-file-message{margin-right:5px}\n";const Jf=".sc-user-input--button-icon-wrapper{background:none;border:none;padding:0;margin:0;outline:none;cursor:pointer}\n";const qf=".sc-user-input--emoji-icon-wrapper{background:none;border:none;padding:0;margin:0;outline:none}.sc-user-input--emoji-icon-wrapper:focus{outline:none}.sc-user-input--emoji-icon{height:18px;cursor:pointer;align-self:center}.sc-user-input--emoji-icon-wrapper:focus .sc-user-input--emoji-icon path,.sc-user-input--emoji-icon-wrapper:focus .sc-user-input--emoji-icon circle,.sc-user-input--emoji-icon.active path,.sc-user-input--emoji-icon.active circle,.sc-user-input--emoji-icon:hover path,.sc-user-input--emoji-icon:hover circle{filter:contrast(15%)}\n";const Kf="#file-input{cursor:pointer}.sc-user-input--file-icon-wrapper{background:none;border:none;padding:0;margin:0;outline:none;cursor:pointer}.sc-user-input--file-icon{height:20px;width:20px;align-self:center;outline:none}.sc-user-input--file-icon:hover path{filter:contrast(15%)}\n";const Xf="svg{display:inline-block;vertical-align:baseline;margin-bottom:-2px}\n";const Qf=".sc-message--emoji{font-size:40px}\n";const Zf=".sc-message--file{border-radius:6px;font-weight:300;font-size:14px;line-height:1.4;-webkit-font-smoothing:subpixel-antialiased}.sc-message--content.sent .sc-message--file{word-wrap:break-word}.sc-message--file-icon{text-align:center;margin:15px auto 0}.sc-image{max-width:100%;min-width:100%}.sc-message--file-text{padding:17px 20px;border-radius:6px;font-weight:300;font-size:14px;line-height:1.4;white-space:pre-wrap;-webkit-font-smoothing:subpixel-antialiased}.sc-message--file-name{color:#fff;padding-left:15px;padding-right:15px;padding-top:0;font-size:x-small;text-align:center}.sc-message--file-name a{text-decoration:none;color:#ece7e7}.sc-message--file-name a:hover{color:#fff}.sc-message--content.sent .sc-message--file-text{color:#fff;background-color:#4e8cff;word-wrap:break-word}.sc-message--content.received .sc-message--file{color:#263238;background-color:#f4f7f9;margin-right:40px}.sc-message--content.received .sc-message--file-name{color:#000}.sc-message--content.received .sc-message--file a{color:#2b2828b3}.sc-message--content.received .sc-message--file a:hover{color:#0c0c0c}\n";const ep=".sc-message--system{padding:8px 20px;border-radius:6px;font-weight:300;font-size:12px;line-height:1.2;white-space:pre-wrap;-webkit-font-smoothing:subpixel-antialiased;font-style:italic;opacity:.55}\n";const tp=".sc-message--text{padding:5px 20px;border-radius:6px;font-weight:300;font-size:14px;line-height:1.4;position:relative;-webkit-font-smoothing:subpixel-antialiased}.sc-message--text .sc-message--text-content{white-space:pre-wrap}.sc-message--text:hover .sc-message--toolbox{left:-20px;opacity:1}.sc-message--text .sc-message--toolbox{transition:left .2s ease-out 0s;white-space:normal;opacity:0;position:absolute;left:0;width:25px;top:0}.sc-message--text .sc-message--toolbox button{background:none;border:none;padding:0;margin:0;outline:none;width:100%;text-align:center;cursor:pointer}.sc-message--text .sc-message--toolbox button:focus{outline:none}.sc-message--text .sc-message--toolbox :deep(svg){margin-left:5px}.sc-message--text code{font-family:Courier New,Courier,monospace!important}.sc-message--content.sent .sc-message--text{color:#fff;background-color:#4e8cff;max-width:calc(100% - 120px);word-wrap:break-word}.sc-message--content.received .sc-message--text{color:#263238;background-color:#f4f7f9;margin-right:40px}a.chatLink{color:inherit!important}\n";const ip=".sc-typing-indicator{text-align:center;padding:17px 20px;border-radius:6px}.sc-typing-indicator span{display:inline-block;background-color:#b6b5ba;width:10px;height:10px;border-radius:100%;margin-right:3px;animation:bob 2s infinite}.sc-typing-indicator span:nth-child(1){animation-delay:-1s}.sc-typing-indicator span:nth-child(2){animation-delay:-.85s}.sc-typing-indicator span:nth-child(3){animation-delay:-.7s}@keyframes bob{10%{transform:translateY(-10px);background-color:#9e9da2}50%{transform:translateY(0);background-color:#b6b5ba}}\n";const rp={components:{ChatWindow:Bu},data(){return{isCallAuthorized:false,isCallEstablished:false,isChatOpen:false,socket:Rf,messageList:[],newMessagesCount:0,contactId:"",callId:"",appId:"",appSecret:"",login:"",password:""}},props:{icons:{type:Object,default:function(){return{open:{img:Vu,name:"default"},close:{img:Hu,name:"default"}}}},autoFocus:{type:Boolean,default:true},showHeader:{type:Boolean,default:true},placeholder:{type:String,default:"Write a message..."},tenant_id:{type:String,required:true},colors:{type:Object,validator:e=>"header"in e&&"bg"in e.header&&"text"in e.header&&"launcher"in e&&"bg"in e.launcher&&"messageList"in e&&"bg"in e.messageList&&"sentMessage"in e&&"bg"in e.sentMessage&&"text"in e.sentMessage&&"receivedMessage"in e&&"bg"in e.receivedMessage&&"text"in e.receivedMessage&&"userInput"in e&&"bg"in e.userInput&&"text"in e.userInput,default:function(){return{header:{bg:"#4e8cff",text:"#ffffff"},launcher:{bg:"#4e8cff"},messageList:{bg:"#ffffff"},sentMessage:{bg:"#4e8cff",text:"#ffffff"},receivedMessage:{bg:"#eaeaea",text:"#222222"},userInput:{bg:"#f4f7f9",text:"#565867"},userList:{bg:"#fff",text:"#212121"}}}},alwaysScrollToBottom:{type:Boolean,default:()=>false}},computed:{},watch:{$props:{deep:true,immediate:true,handler(e){for(const t in e){ma.setState(t,e[t])}}}},methods:{close(){this.isChatOpen=false},openAndFocus(){this.isChatOpen=true;this.newMessagesCount=0;if(this.autoFocus){this.$emit("focusUserInput")}},sendMessageToBot(e){var t,i;if(this.messageList[this.messageList.length-1].suggestions){this.socket.emit("Message",this.messageList[this.messageList.length-1].suggestions.indexOf((t=e==null?void 0:e.data)==null?void 0:t.text)+1)}else{this.socket.emit("Message",(i=e==null?void 0:e.data)==null?void 0:i.text)}this.messageList=[...this.messageList,e]},initiateCall(){console.log("[RAINBOW] Initiating a call with the Agent");jf.webRTC.callInAudio(this.contactId).then((e=>{console.error("[RAINBOW] Call established correctly with the agent")})).catch((e=>{console.error("[RAINBOW] Something went wrong in initiating the call",e)}))},releaseCall(){console.log("[RAINBOW] Realising the call with the Agent");jf.webRTC.release(this.callId)},establishConnectionWithWS(){this.socket=Lf(`https://app.dxcc.fr/web/medium/webhook`,{path:"/web/medium/webhook",extraHeaders:{tenant_id:this.tenant_id}});this.socket.on("connect_error",(()=>{console.log("Connected to server")}));this.socket.on("connect",(()=>{console.log("Connected to server")}));this.socket.on("disconnect",(()=>{console.log("Disconnected from server")}));this.socket.on(kf.MESSAGE,(e=>{console.log(e);console.log(e.data);if(e.type===Ff.TEXT){this.messageList=[...this.messageList,{type:"text",author:`support`,id:Math.random(),data:{text:e.data}}];console.log(this.messageList)}else if(e.type===Ff.CHOICES){this.messageList=[...this.messageList,{type:"text",author:`support`,id:Math.random(),data:{text:""},suggestions:e.data}]}this.newMessagesCount=this.isChatOpen?this.newMessagesCount:this.newMessagesCount+1}));this.socket.on(kf.GUEST_USER_CREDENTIALS,(e=>{this.login=e.login;this.password=e.password;this.appId=e.app_id;this.appSecret=e.app_secret;this.contactId=e.agent_id;document.addEventListener(jf.RAINBOW_ONREADY,this.onReady);document.addEventListener(jf.RAINBOW_ONLOADED,this.onLoaded);document.addEventListener(jf.connection.RAINBOW_ONSIGNED,this.onSigned);document.addEventListener(jf.webRTC.RAINBOW_ONWEBRTCCALLSTATECHANGED,this.onWebRTCCallChanged);jf.load()}))},onReady(){console.log("[RAINBOW] Rainbow SDK is ready");jf.connection.signin(this.login,this.password).then((function(){console.log("[RAINBOW] Connected correctly to the guest rainbow account");if(jf.webRTC.canMakeAudioVideoCall()){console.log("[RAINBOW] Browser is compliant: audio and video call are possible using WebRTC")}else{console.log("[RAINBOW] Browser is not compliant: audio and video call are not possible using WebRTC")}})).catch((function(e){console.error("[RAINBOW] Something went wrong during logining in using guest credentials.",e)}))},onLoaded(){console.log("[RAINBOW] Rainbow SDK is loaded correctly");jf.initialize(this.appId,this.appSecret).then((()=>{console.log("[RAINBOW] Rainbow SDK is initialized correctly")})).catch((e=>{console.error("[RAINBOW] Something went wrong during Rainbow SDK initialisation.",e)}))},onWebRTCCallChanged(e){this.callId=e.detail.id;let t=jf.webRTC.getCallById(this.callId);if(t){this.isCallEstablished=true}else{this.isCallEstablished=false}},onSigned(e){this.isCallAuthorized=true}},mounted(){this.establishConnectionWithWS();this.socket.emit("Message","")}};const np={key:0,class:"sc-new-messsages-count"};const sp=["src","alt"];const op=["src","alt"];function ap(e,t,i,r,n,s){const o=Jr("ChatWindow");return Es(),Ms("div",null,[Fs("div",{class:z(["sc-launcher",{opened:n.isChatOpen}]),style:B({backgroundColor:i.colors.launcher.bg}),onClick:t[0]||(t[0]=da((e=>n.isChatOpen?s.close():s.openAndFocus()),["prevent"]))},[n.newMessagesCount>0&&!n.isChatOpen?(Es(),Ms("div",np,X(n.newMessagesCount),1)):Ys("",true),n.isChatOpen?(Es(),Ms("img",{key:1,class:"sc-closed-icon",src:i.icons.close.img,alt:i.icons.close.name},null,8,sp)):(Es(),Ms("img",{key:2,class:"sc-open-icon",src:i.icons.open.img,alt:i.icons.open.name},null,8,op))],6),Us(o,{"message-list":n.messageList,"on-user-input-submit":s.sendMessageToBot,"on-user-initiate-call":s.initiateCall,"on-user-release-call":s.releaseCall,"is-open":n.isChatOpen,"is-call-authorized":n.isCallAuthorized,"is-call-established":n.isCallEstablished,"show-file":false,"show-header":i.showHeader,placeholder:i.placeholder,"show-typing-indicator":false,colors:i.colors,"always-scroll-to-bottom":true,onScrollToTop:t[1]||(t[1]=t=>e.$emit("scrollToTop"))},{header:or((()=>[Zr(e.$slots,"header")])),"user-avatar":or((t=>[Zr(e.$slots,"user-avatar",{user:t.user,message:t.message})])),"text-message-body":or((t=>[Zr(e.$slots,"text-message-body",{message:t.message,messageText:t.messageText,messageColors:t.messageColors,me:t.me})])),"system-message-body":or((t=>[Zr(e.$slots,"system-message-body",{message:t.message})])),"text-message-toolbox":or((t=>[Zr(e.$slots,"text-message-toolbox",{message:t.message,me:t.me})])),_:3},8,["message-list","on-user-input-submit","on-user-initiate-call","on-user-release-call","is-open","is-call-authorized","is-call-established","show-header","placeholder","colors"])])}const cp=ya(rp,[["render",ap],["styles",[Wf,Bf,Hf,Vf,Yf,Gf,$f,zf,Jf,qf,Kf,Xf,Qf,Zf,ep,tp,ip]]]);const lp=sa(cp);customElements.define("dx-chatbox",lp)}));
